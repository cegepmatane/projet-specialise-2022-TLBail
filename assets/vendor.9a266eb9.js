var oP=Object.defineProperty,aP=Object.defineProperties;var lP=Object.getOwnPropertyDescriptors;var tm=Object.getOwnPropertySymbols;var jM=Object.prototype.hasOwnProperty,qM=Object.prototype.propertyIsEnumerable;var $M=(i,e,t)=>e in i?oP(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Oe=(i,e)=>{for(var t in e||(e={}))jM.call(e,t)&&$M(i,t,e[t]);if(tm)for(var t of tm(e))qM.call(e,t)&&$M(i,t,e[t]);return i},pt=(i,e)=>aP(i,lP(e));var Gt=(i,e)=>{var t={};for(var n in i)jM.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&tm)for(var n of tm(i))e.indexOf(n)<0&&qM.call(i,n)&&(t[n]=i[n]);return t};function cP(i){if(i.__esModule)return i;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(t){var n=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return i[t]}})}),e}var ue={exports:{}},on={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var eW=Object.getOwnPropertySymbols,gP=Object.prototype.hasOwnProperty,uP=Object.prototype.propertyIsEnumerable;function dP(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function hP(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(n.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(s){r[s]=s}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var nw=hP()?Object.assign:function(i,e){for(var t,n=dP(i),r,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var o in t)gP.call(t,o)&&(n[o]=t[o]);if(eW){r=eW(t);for(var a=0;a<r.length;a++)uP.call(t,r[a])&&(n[r[a]]=t[r[a]])}}return n};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iw=nw,ku=60103,tW=60106;on.Fragment=60107;on.StrictMode=60108;on.Profiler=60114;var nW=60109,iW=60110,rW=60112;on.Suspense=60113;var sW=60115,oW=60116;if(typeof Symbol=="function"&&Symbol.for){var so=Symbol.for;ku=so("react.element"),tW=so("react.portal"),on.Fragment=so("react.fragment"),on.StrictMode=so("react.strict_mode"),on.Profiler=so("react.profiler"),nW=so("react.provider"),iW=so("react.context"),rW=so("react.forward_ref"),on.Suspense=so("react.suspense"),sW=so("react.memo"),oW=so("react.lazy")}var aW=typeof Symbol=="function"&&Symbol.iterator;function fP(i){return i===null||typeof i!="object"?null:(i=aW&&i[aW]||i["@@iterator"],typeof i=="function"?i:null)}function $f(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cW={};function Yu(i,e,t){this.props=i,this.context=e,this.refs=cW,this.updater=t||lW}Yu.prototype.isReactComponent={};Yu.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error($f(85));this.updater.enqueueSetState(this,i,e,"setState")};Yu.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function gW(){}gW.prototype=Yu.prototype;function rw(i,e,t){this.props=i,this.context=e,this.refs=cW,this.updater=t||lW}var sw=rw.prototype=new gW;sw.constructor=rw;iw(sw,Yu.prototype);sw.isPureReactComponent=!0;var ow={current:null},uW=Object.prototype.hasOwnProperty,dW={key:!0,ref:!0,__self:!0,__source:!0};function hW(i,e,t){var n,r={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)uW.call(e,n)&&!dW.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:ku,type:i,key:s,ref:o,props:r,_owner:ow.current}}function IP(i,e){return{$$typeof:ku,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function aw(i){return typeof i=="object"&&i!==null&&i.$$typeof===ku}function CP(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var fW=/\/+/g;function lw(i,e){return typeof i=="object"&&i!==null&&i.key!=null?CP(""+i.key):e.toString(36)}function nm(i,e,t,n,r){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case ku:case tW:o=!0}}if(o)return o=i,r=r(o),i=n===""?"."+lw(o,0):n,Array.isArray(r)?(t="",i!=null&&(t=i.replace(fW,"$&/")+"/"),nm(r,e,t,"",function(c){return c})):r!=null&&(aw(r)&&(r=IP(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(fW,"$&/")+"/")+i)),e.push(r)),1;if(o=0,n=n===""?".":n+":",Array.isArray(i))for(var a=0;a<i.length;a++){s=i[a];var l=n+lw(s,a);o+=nm(s,e,t,l,r)}else if(l=fP(i),typeof l=="function")for(i=l.call(i),a=0;!(s=i.next()).done;)s=s.value,l=n+lw(s,a++),o+=nm(s,e,t,l,r);else if(s==="object")throw e=""+i,Error($f(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e));return o}function im(i,e,t){if(i==null)return i;var n=[],r=0;return nm(i,n,"","",function(s){return e.call(t,s,r++)}),n}function pP(i){if(i._status===-1){var e=i._result;e=e(),i._status=0,i._result=e,e.then(function(t){i._status===0&&(t=t.default,i._status=1,i._result=t)},function(t){i._status===0&&(i._status=2,i._result=t)})}if(i._status===1)return i._result;throw i._result}var IW={current:null};function Za(){var i=IW.current;if(i===null)throw Error($f(321));return i}var mP={ReactCurrentDispatcher:IW,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:ow,IsSomeRendererActing:{current:!1},assign:iw};on.Children={map:im,forEach:function(i,e,t){im(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return im(i,function(){e++}),e},toArray:function(i){return im(i,function(e){return e})||[]},only:function(i){if(!aw(i))throw Error($f(143));return i}};on.Component=Yu;on.PureComponent=rw;on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mP;on.cloneElement=function(i,e,t){if(i==null)throw Error($f(267,i));var n=iw({},i.props),r=i.key,s=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=ow.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(l in e)uW.call(e,l)&&!dW.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:ku,type:i.type,key:r,ref:s,props:n,_owner:o}};on.createContext=function(i,e){return e===void 0&&(e=null),i={$$typeof:iW,_calculateChangedBits:e,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null},i.Provider={$$typeof:nW,_context:i},i.Consumer=i};on.createElement=hW;on.createFactory=function(i){var e=hW.bind(null,i);return e.type=i,e};on.createRef=function(){return{current:null}};on.forwardRef=function(i){return{$$typeof:rW,render:i}};on.isValidElement=aw;on.lazy=function(i){return{$$typeof:oW,_payload:{_status:-1,_result:i},_init:pP}};on.memo=function(i,e){return{$$typeof:sW,type:i,compare:e===void 0?null:e}};on.useCallback=function(i,e){return Za().useCallback(i,e)};on.useContext=function(i,e){return Za().useContext(i,e)};on.useDebugValue=function(){};on.useEffect=function(i,e){return Za().useEffect(i,e)};on.useImperativeHandle=function(i,e,t){return Za().useImperativeHandle(i,e,t)};on.useLayoutEffect=function(i,e){return Za().useLayoutEffect(i,e)};on.useMemo=function(i,e){return Za().useMemo(i,e)};on.useReducer=function(i,e,t){return Za().useReducer(i,e,t)};on.useRef=function(i){return Za().useRef(i)};on.useState=function(i){return Za().useState(i)};on.version="17.0.2";ue.exports=on;var Ra=ue.exports,CW={exports:{}},Fs={},Ku={exports:{}},pW={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){var e,t,n,r;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var l=null,c=null,g=function(){if(l!==null)try{var F=i.unstable_now();l(!0,F),l=null}catch(K){throw setTimeout(g,0),K}};e=function(F){l!==null?setTimeout(e,0,F):(l=F,setTimeout(g,0))},t=function(F,K){c=setTimeout(F,K)},n=function(){clearTimeout(c)},i.unstable_shouldYield=function(){return!1},r=i.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,u=window.clearTimeout;if(typeof console!="undefined"){var h=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof h!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var p=!1,b=null,y=-1,m=5,f=0;i.unstable_shouldYield=function(){return i.unstable_now()>=f},r=function(){},i.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m=0<F?Math.floor(1e3/F):5};var G=new MessageChannel,x=G.port2;G.port1.onmessage=function(){if(b!==null){var F=i.unstable_now();f=F+m;try{b(!0,F)?x.postMessage(null):(p=!1,b=null)}catch(K){throw x.postMessage(null),K}}else p=!1},e=function(F){b=F,p||(p=!0,x.postMessage(null))},t=function(F,K){y=d(function(){F(i.unstable_now())},K)},n=function(){u(y),y=-1}}function B(F,K){var j=F.length;F.push(K);e:for(;;){var O=j-1>>>1,Y=F[O];if(Y!==void 0&&0<z(Y,K))F[O]=K,F[j]=Y,j=O;else break e}}function M(F){return F=F[0],F===void 0?null:F}function E(F){var K=F[0];if(K!==void 0){var j=F.pop();if(j!==K){F[0]=j;e:for(var O=0,Y=F.length;O<Y;){var ee=2*(O+1)-1,ye=F[ee],Ce=ee+1,he=F[Ce];if(ye!==void 0&&0>z(ye,j))he!==void 0&&0>z(he,ye)?(F[O]=he,F[Ce]=j,O=Ce):(F[O]=ye,F[ee]=j,O=ee);else if(he!==void 0&&0>z(he,j))F[O]=he,F[Ce]=j,O=Ce;else break e}}return K}return null}function z(F,K){var j=F.sortIndex-K.sortIndex;return j!==0?j:F.id-K.id}var J=[],V=[],I=1,w=null,S=3,R=!1,W=!1,H=!1;function k(F){for(var K=M(V);K!==null;){if(K.callback===null)E(V);else if(K.startTime<=F)E(V),K.sortIndex=K.expirationTime,B(J,K);else break;K=M(V)}}function _(F){if(H=!1,k(F),!W)if(M(J)!==null)W=!0,e(Z);else{var K=M(V);K!==null&&t(_,K.startTime-F)}}function Z(F,K){W=!1,H&&(H=!1,n()),R=!0;var j=S;try{for(k(K),w=M(J);w!==null&&(!(w.expirationTime>K)||F&&!i.unstable_shouldYield());){var O=w.callback;if(typeof O=="function"){w.callback=null,S=w.priorityLevel;var Y=O(w.expirationTime<=K);K=i.unstable_now(),typeof Y=="function"?w.callback=Y:w===M(J)&&E(J),k(K)}else E(J);w=M(J)}if(w!==null)var ee=!0;else{var ye=M(V);ye!==null&&t(_,ye.startTime-K),ee=!1}return ee}finally{w=null,S=j,R=!1}}var T=r;i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(F){F.callback=null},i.unstable_continueExecution=function(){W||R||(W=!0,e(Z))},i.unstable_getCurrentPriorityLevel=function(){return S},i.unstable_getFirstCallbackNode=function(){return M(J)},i.unstable_next=function(F){switch(S){case 1:case 2:case 3:var K=3;break;default:K=S}var j=S;S=K;try{return F()}finally{S=j}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=T,i.unstable_runWithPriority=function(F,K){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var j=S;S=F;try{return K()}finally{S=j}},i.unstable_scheduleCallback=function(F,K,j){var O=i.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?O+j:O):j=O,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=j+Y,F={id:I++,callback:K,priorityLevel:F,startTime:j,expirationTime:Y,sortIndex:-1},j>O?(F.sortIndex=j,B(V,F),M(J)===null&&F===M(V)&&(H?n():H=!0,t(_,j-O))):(F.sortIndex=Y,B(J,F),W||R||(W=!0,e(Z))),F},i.unstable_wrapCallback=function(F){var K=S;return function(){var j=S;S=K;try{return F.apply(this,arguments)}finally{S=j}}}})(pW);Ku.exports=pW;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rm=ue.exports,Pn=nw,Vi=Ku.exports;function qe(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!rm)throw Error(qe(227));var mW=new Set,eI={};function sg(i,e){Pu(i,e),Pu(i+"Capture",e)}function Pu(i,e){for(eI[i]=e,i=0;i<e.length;i++)mW.add(e[i])}var Ma=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),AP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,AW=Object.prototype.hasOwnProperty,bW={},yW={};function bP(i){return AW.call(yW,i)?!0:AW.call(bW,i)?!1:AP.test(i)?yW[i]=!0:(bW[i]=!0,!1)}function yP(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function vP(i,e,t,n){if(e===null||typeof e=="undefined"||yP(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mr(i,e,t,n,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Di={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Di[i]=new Mr(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Di[e]=new Mr(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Di[i]=new Mr(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Di[i]=new Mr(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Di[i]=new Mr(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Di[i]=new Mr(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Di[i]=new Mr(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Di[i]=new Mr(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Di[i]=new Mr(i,5,!1,i.toLowerCase(),null,!1,!1)});var cw=/[\-:]([a-z])/g;function gw(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(cw,gw);Di[e]=new Mr(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(cw,gw);Di[e]=new Mr(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(cw,gw);Di[e]=new Mr(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Di[i]=new Mr(i,1,!1,i.toLowerCase(),null,!1,!1)});Di.xlinkHref=new Mr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Di[i]=new Mr(i,1,!1,i.toLowerCase(),null,!0,!0)});function uw(i,e,t,n){var r=Di.hasOwnProperty(e)?Di[e]:null,s=r!==null?r.type===0:n?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(vP(e,t,r,n)&&(t=null),n||r===null?bP(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var og=rm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tI=60103,ag=60106,Bl=60107,dw=60108,nI=60114,hw=60109,fw=60110,sm=60112,iI=60113,om=60120,am=60115,Iw=60116,Cw=60121,pw=60128,vW=60129,mw=60130,Aw=60131;if(typeof Symbol=="function"&&Symbol.for){var Ni=Symbol.for;tI=Ni("react.element"),ag=Ni("react.portal"),Bl=Ni("react.fragment"),dw=Ni("react.strict_mode"),nI=Ni("react.profiler"),hw=Ni("react.provider"),fw=Ni("react.context"),sm=Ni("react.forward_ref"),iI=Ni("react.suspense"),om=Ni("react.suspense_list"),am=Ni("react.memo"),Iw=Ni("react.lazy"),Cw=Ni("react.block"),Ni("react.scope"),pw=Ni("react.opaque.id"),vW=Ni("react.debug_trace_mode"),mw=Ni("react.offscreen"),Aw=Ni("react.legacy_hidden")}var xW=typeof Symbol=="function"&&Symbol.iterator;function rI(i){return i===null||typeof i!="object"?null:(i=xW&&i[xW]||i["@@iterator"],typeof i=="function"?i:null)}var bw;function sI(i){if(bw===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);bw=e&&e[1]||""}return`
`+bw+i}var yw=!1;function lm(i,e){if(!i||yw)return"";yw=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(i,[],e)}else{try{e.call()}catch(l){n=l}i.call(e.prototype)}else{try{throw Error()}catch(l){n=l}i()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=n.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a])return`
`+r[o].replace(" at new "," at ");while(1<=o&&0<=a);break}}}finally{yw=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?sI(i):""}function xP(i){switch(i.tag){case 5:return sI(i.type);case 16:return sI("Lazy");case 13:return sI("Suspense");case 19:return sI("SuspenseList");case 0:case 2:case 15:return i=lm(i.type,!1),i;case 11:return i=lm(i.type.render,!1),i;case 22:return i=lm(i.type._render,!1),i;case 1:return i=lm(i.type,!0),i;default:return""}}function Du(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Bl:return"Fragment";case ag:return"Portal";case nI:return"Profiler";case dw:return"StrictMode";case iI:return"Suspense";case om:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case fw:return(i.displayName||"Context")+".Consumer";case hw:return(i._context.displayName||"Context")+".Provider";case sm:var e=i.render;return e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case am:return Du(i.type);case Cw:return Du(i._render);case Iw:e=i._payload,i=i._init;try{return Du(i(e))}catch{}}return null}function Sl(i){switch(typeof i){case"boolean":case"number":case"object":case"string":case"undefined":return i;default:return""}}function wW(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function wP(i){var e=wW(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t!="undefined"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function cm(i){i._valueTracker||(i._valueTracker=wP(i))}function GW(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=wW(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function gm(i){if(i=i||(typeof document!="undefined"?document:void 0),typeof i=="undefined")return null;try{return i.activeElement||i.body}catch{return i.body}}function vw(i,e){var t=e.checked;return Pn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:i._wrapperState.initialChecked})}function BW(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Sl(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function SW(i,e){e=e.checked,e!=null&&uw(i,"checked",e,!1)}function xw(i,e){SW(i,e);var t=Sl(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?ww(i,e.type,t):e.hasOwnProperty("defaultValue")&&ww(i,e.type,Sl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function ZW(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function ww(i,e,t){(e!=="number"||gm(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}function GP(i){var e="";return rm.Children.forEach(i,function(t){t!=null&&(e+=t)}),e}function Gw(i,e){return i=Pn({children:void 0},e),(e=GP(e.children))&&(i.children=e),i}function Uu(i,e,t,n){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&n&&(i[t].defaultSelected=!0)}else{for(t=""+Sl(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,n&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function Bw(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(qe(91));return Pn({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function RW(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(qe(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(qe(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:Sl(t)}}function MW(i,e){var t=Sl(e.value),n=Sl(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function WW(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}var Sw={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function _W(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zw(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?_W(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var um,VW=function(i){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,r)})}:i}(function(i,e){if(i.namespaceURI!==Sw.svg||"innerHTML"in i)i.innerHTML=e;else{for(um=um||document.createElement("div"),um.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=um.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function oI(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var aI={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BP=["Webkit","ms","Moz","O"];Object.keys(aI).forEach(function(i){BP.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),aI[e]=aI[i]})});function NW(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||aI.hasOwnProperty(i)&&aI[i]?(""+e).trim():e+"px"}function EW(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=NW(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,r):i[t]=r}}var SP=Pn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Rw(i,e){if(e){if(SP[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(qe(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(qe(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(qe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(qe(62))}}function Mw(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ww(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var _w=null,Ou=null,Ju=null;function HW(i){if(i=BI(i)){if(typeof _w!="function")throw Error(qe(280));var e=i.stateNode;e&&(e=Rm(e),_w(i.stateNode,i.type,e))}}function FW(i){Ou?Ju?Ju.push(i):Ju=[i]:Ou=i}function LW(){if(Ou){var i=Ou,e=Ju;if(Ju=Ou=null,HW(i),e)for(i=0;i<e.length;i++)HW(e[i])}}function Vw(i,e){return i(e)}function TW(i,e,t,n,r){return i(e,t,n,r)}function Nw(){}var XW=Vw,lg=!1,Ew=!1;function Hw(){(Ou!==null||Ju!==null)&&(Nw(),LW())}function ZP(i,e,t){if(Ew)return i(e,t);Ew=!0;try{return XW(i,e,t)}finally{Ew=!1,Hw()}}function lI(i,e){var t=i.stateNode;if(t===null)return null;var n=Rm(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(qe(231,e,typeof t));return t}var Fw=!1;if(Ma)try{var cI={};Object.defineProperty(cI,"passive",{get:function(){Fw=!0}}),window.addEventListener("test",cI,cI),window.removeEventListener("test",cI,cI)}catch{Fw=!1}function RP(i,e,t,n,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(g){this.onError(g)}}var gI=!1,dm=null,hm=!1,Lw=null,MP={onError:function(i){gI=!0,dm=i}};function WP(i,e,t,n,r,s,o,a,l){gI=!1,dm=null,RP.apply(MP,arguments)}function _P(i,e,t,n,r,s,o,a,l){if(WP.apply(this,arguments),gI){if(gI){var c=dm;gI=!1,dm=null}else throw Error(qe(198));hm||(hm=!0,Lw=c)}}function cg(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,(e.flags&1026)!=0&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function zW(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function kW(i){if(cg(i)!==i)throw Error(qe(188))}function VP(i){var e=i.alternate;if(!e){if(e=cg(i),e===null)throw Error(qe(188));return e!==i?null:i}for(var t=i,n=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return kW(r),i;if(s===n)return kW(r),e;s=s.sibling}throw Error(qe(188))}if(t.return!==n.return)t=r,n=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,n=s;break}if(a===n){o=!0,n=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=r;break}if(a===n){o=!0,n=s,t=r;break}a=a.sibling}if(!o)throw Error(qe(189))}}if(t.alternate!==n)throw Error(qe(190))}if(t.tag!==3)throw Error(qe(188));return t.stateNode.current===t?i:e}function YW(i){if(i=VP(i),!i)return null;for(var e=i;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===i)break;for(;!e.sibling;){if(!e.return||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function KW(i,e){for(var t=i.alternate;e!==null;){if(e===i||e===t)return!0;e=e.return}return!1}var PW,Tw,DW,UW,Xw=!1,Fo=[],Zl=null,Rl=null,Ml=null,uI=new Map,dI=new Map,hI=[],OW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zw(i,e,t,n,r){return{blockedOn:i,domEventName:e,eventSystemFlags:t|16,nativeEvent:r,targetContainers:[n]}}function JW(i,e){switch(i){case"focusin":case"focusout":Zl=null;break;case"dragenter":case"dragleave":Rl=null;break;case"mouseover":case"mouseout":Ml=null;break;case"pointerover":case"pointerout":uI.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":dI.delete(e.pointerId)}}function fI(i,e,t,n,r,s){return i===null||i.nativeEvent!==s?(i=zw(e,t,n,r,s),e!==null&&(e=BI(e),e!==null&&Tw(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function NP(i,e,t,n,r){switch(e){case"focusin":return Zl=fI(Zl,i,e,t,n,r),!0;case"dragenter":return Rl=fI(Rl,i,e,t,n,r),!0;case"mouseover":return Ml=fI(Ml,i,e,t,n,r),!0;case"pointerover":var s=r.pointerId;return uI.set(s,fI(uI.get(s)||null,i,e,t,n,r)),!0;case"gotpointercapture":return s=r.pointerId,dI.set(s,fI(dI.get(s)||null,i,e,t,n,r)),!0}return!1}function EP(i){var e=gg(i.target);if(e!==null){var t=cg(e);if(t!==null){if(e=t.tag,e===13){if(e=zW(t),e!==null){i.blockedOn=e,UW(i.lanePriority,function(){Vi.unstable_runWithPriority(i.priority,function(){DW(t)})});return}}else if(e===3&&t.stateNode.hydrate){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function fm(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=Uw(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t!==null)return e=BI(t),e!==null&&Tw(e),i.blockedOn=t,!1;e.shift()}return!0}function QW(i,e,t){fm(i)&&t.delete(e)}function HP(){for(Xw=!1;0<Fo.length;){var i=Fo[0];if(i.blockedOn!==null){i=BI(i.blockedOn),i!==null&&PW(i);break}for(var e=i.targetContainers;0<e.length;){var t=Uw(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t!==null){i.blockedOn=t;break}e.shift()}i.blockedOn===null&&Fo.shift()}Zl!==null&&fm(Zl)&&(Zl=null),Rl!==null&&fm(Rl)&&(Rl=null),Ml!==null&&fm(Ml)&&(Ml=null),uI.forEach(QW),dI.forEach(QW)}function II(i,e){i.blockedOn===e&&(i.blockedOn=null,Xw||(Xw=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,HP)))}function jW(i){function e(r){return II(r,i)}if(0<Fo.length){II(Fo[0],i);for(var t=1;t<Fo.length;t++){var n=Fo[t];n.blockedOn===i&&(n.blockedOn=null)}}for(Zl!==null&&II(Zl,i),Rl!==null&&II(Rl,i),Ml!==null&&II(Ml,i),uI.forEach(e),dI.forEach(e),t=0;t<hI.length;t++)n=hI[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<hI.length&&(t=hI[0],t.blockedOn===null);)EP(t),t.blockedOn===null&&hI.shift()}function Im(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Qu={animationend:Im("Animation","AnimationEnd"),animationiteration:Im("Animation","AnimationIteration"),animationstart:Im("Animation","AnimationStart"),transitionend:Im("Transition","TransitionEnd")},kw={},qW={};Ma&&(qW=document.createElement("div").style,"AnimationEvent"in window||(delete Qu.animationend.animation,delete Qu.animationiteration.animation,delete Qu.animationstart.animation),"TransitionEvent"in window||delete Qu.transitionend.transition);function Cm(i){if(kw[i])return kw[i];if(!Qu[i])return i;var e=Qu[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in qW)return kw[i]=e[t];return i}var $W=Cm("animationend"),e5=Cm("animationiteration"),t5=Cm("animationstart"),n5=Cm("transitionend"),i5=new Map,Yw=new Map,FP=["abort","abort",$W,"animationEnd",e5,"animationIteration",t5,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",n5,"transitionEnd","waiting","waiting"];function Kw(i,e){for(var t=0;t<i.length;t+=2){var n=i[t],r=i[t+1];r="on"+(r[0].toUpperCase()+r.slice(1)),Yw.set(n,e),i5.set(n,r),sg(r,[n])}}var LP=Vi.unstable_now;LP();var En=8;function ju(i){if((1&i)!=0)return En=15,1;if((2&i)!=0)return En=14,2;if((4&i)!=0)return En=13,4;var e=24&i;return e!==0?(En=12,e):(i&32)!=0?(En=11,32):(e=192&i,e!==0?(En=10,e):(i&256)!=0?(En=9,256):(e=3584&i,e!==0?(En=8,e):(i&4096)!=0?(En=7,4096):(e=4186112&i,e!==0?(En=6,e):(e=62914560&i,e!==0?(En=5,e):i&67108864?(En=4,67108864):(i&134217728)!=0?(En=3,134217728):(e=805306368&i,e!==0?(En=2,e):(1073741824&i)!=0?(En=1,1073741824):(En=8,i))))))}function TP(i){switch(i){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function XP(i){switch(i){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(qe(358,i))}}function CI(i,e){var t=i.pendingLanes;if(t===0)return En=0;var n=0,r=0,s=i.expiredLanes,o=i.suspendedLanes,a=i.pingedLanes;if(s!==0)n=s,r=En=15;else if(s=t&134217727,s!==0){var l=s&~o;l!==0?(n=ju(l),r=En):(a&=s,a!==0&&(n=ju(a),r=En))}else s=t&~o,s!==0?(n=ju(s),r=En):a!==0&&(n=ju(a),r=En);if(n===0)return 0;if(n=31-Wl(n),n=t&((0>n?0:1<<n)<<1)-1,e!==0&&e!==n&&(e&o)==0){if(ju(e),r<=En)return e;En=r}if(e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-Wl(e),r=1<<t,n|=i[t],e&=~r;return n}function r5(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function pm(i,e){switch(i){case 15:return 1;case 14:return 2;case 12:return i=qu(24&~e),i===0?pm(10,e):i;case 10:return i=qu(192&~e),i===0?pm(8,e):i;case 8:return i=qu(3584&~e),i===0&&(i=qu(4186112&~e),i===0&&(i=512)),i;case 2:return e=qu(805306368&~e),e===0&&(e=268435456),e}throw Error(qe(358,i))}function qu(i){return i&-i}function Pw(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function mm(i,e,t){i.pendingLanes|=e;var n=e-1;i.suspendedLanes&=n,i.pingedLanes&=n,i=i.eventTimes,e=31-Wl(e),i[e]=t}var Wl=Math.clz32?Math.clz32:YP,zP=Math.log,kP=Math.LN2;function YP(i){return i===0?32:31-(zP(i)/kP|0)|0}var KP=Vi.unstable_UserBlockingPriority,PP=Vi.unstable_runWithPriority,Am=!0;function DP(i,e,t,n){lg||Nw();var r=Dw,s=lg;lg=!0;try{TW(r,i,e,t,n)}finally{(lg=s)||Hw()}}function UP(i,e,t,n){PP(KP,Dw.bind(null,i,e,t,n))}function Dw(i,e,t,n){if(Am){var r;if((r=(e&4)==0)&&0<Fo.length&&-1<OW.indexOf(i))i=zw(null,i,e,t,n),Fo.push(i);else{var s=Uw(i,e,t,n);if(s===null)r&&JW(i,n);else{if(r){if(-1<OW.indexOf(i)){i=zw(s,i,e,t,n),Fo.push(i);return}if(NP(s,i,e,t,n))return;JW(i,n)}N5(i,e,n,null,t)}}}}function Uw(i,e,t,n){var r=Ww(n);if(r=gg(r),r!==null){var s=cg(r);if(s===null)r=null;else{var o=s.tag;if(o===13){if(r=zW(s),r!==null)return r;r=null}else if(o===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return N5(i,e,n,r,t),null}var _l=null,Ow=null,bm=null;function s5(){if(bm)return bm;var i,e=Ow,t=e.length,n,r="value"in _l?_l.value:_l.textContent,s=r.length;for(i=0;i<t&&e[i]===r[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===r[s-n];n++);return bm=r.slice(i,1<n?1-n:void 0)}function ym(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function vm(){return!0}function o5(){return!1}function fs(i){function e(t,n,r,s,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(t=i[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?vm:o5,this.isPropagationStopped=o5,this}return Pn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=vm)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=vm)},persist:function(){},isPersistent:vm}),e}var $u={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jw=fs($u),pI=Pn({},$u,{view:0,detail:0}),OP=fs(pI),Qw,jw,mI,xm=Pn({},pI,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$w,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==mI&&(mI&&i.type==="mousemove"?(Qw=i.screenX-mI.screenX,jw=i.screenY-mI.screenY):jw=Qw=0,mI=i),Qw)},movementY:function(i){return"movementY"in i?i.movementY:jw}}),a5=fs(xm),JP=Pn({},xm,{dataTransfer:0}),QP=fs(JP),jP=Pn({},pI,{relatedTarget:0}),qw=fs(jP),qP=Pn({},$u,{animationName:0,elapsedTime:0,pseudoElement:0}),$P=fs(qP),eD=Pn({},$u,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),tD=fs(eD),nD=Pn({},$u,{data:0}),l5=fs(nD),iD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oD(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=sD[i])?!!e[i]:!1}function $w(){return oD}var aD=Pn({},pI,{key:function(i){if(i.key){var e=iD[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=ym(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?rD[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$w,charCode:function(i){return i.type==="keypress"?ym(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?ym(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),lD=fs(aD),cD=Pn({},xm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),c5=fs(cD),gD=Pn({},pI,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$w}),uD=fs(gD),dD=Pn({},$u,{propertyName:0,elapsedTime:0,pseudoElement:0}),hD=fs(dD),fD=Pn({},xm,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),ID=fs(fD),CD=[9,13,27,32],eG=Ma&&"CompositionEvent"in window,AI=null;Ma&&"documentMode"in document&&(AI=document.documentMode);var pD=Ma&&"TextEvent"in window&&!AI,g5=Ma&&(!eG||AI&&8<AI&&11>=AI),u5=String.fromCharCode(32),d5=!1;function h5(i,e){switch(i){case"keyup":return CD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function f5(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ed=!1;function mD(i,e){switch(i){case"compositionend":return f5(e);case"keypress":return e.which!==32?null:(d5=!0,u5);case"textInput":return i=e.data,i===u5&&d5?null:i;default:return null}}function AD(i,e){if(ed)return i==="compositionend"||!eG&&h5(i,e)?(i=s5(),bm=Ow=_l=null,ed=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return g5&&e.locale!=="ko"?null:e.data;default:return null}}var bD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function I5(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!bD[i.type]:e==="textarea"}function C5(i,e,t,n){FW(n),e=Gm(e,"onChange"),0<e.length&&(t=new Jw("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var bI=null,yI=null;function yD(i){R5(i,0)}function wm(i){var e=sd(i);if(GW(e))return i}function vD(i,e){if(i==="change")return e}var p5=!1;if(Ma){var tG;if(Ma){var nG="oninput"in document;if(!nG){var m5=document.createElement("div");m5.setAttribute("oninput","return;"),nG=typeof m5.oninput=="function"}tG=nG}else tG=!1;p5=tG&&(!document.documentMode||9<document.documentMode)}function A5(){bI&&(bI.detachEvent("onpropertychange",b5),yI=bI=null)}function b5(i){if(i.propertyName==="value"&&wm(yI)){var e=[];if(C5(e,yI,i,Ww(i)),i=yD,lg)i(e);else{lg=!0;try{Vw(i,e)}finally{lg=!1,Hw()}}}}function xD(i,e,t){i==="focusin"?(A5(),bI=e,yI=t,bI.attachEvent("onpropertychange",b5)):i==="focusout"&&A5()}function wD(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return wm(yI)}function GD(i,e){if(i==="click")return wm(e)}function BD(i,e){if(i==="input"||i==="change")return wm(e)}function SD(i,e){return i===e&&(i!==0||1/i==1/e)||i!==i&&e!==e}var Ls=typeof Object.is=="function"?Object.is:SD,ZD=Object.prototype.hasOwnProperty;function vI(i,e){if(Ls(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++)if(!ZD.call(e,t[n])||!Ls(i[t[n]],e[t[n]]))return!1;return!0}function y5(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function v5(i,e){var t=y5(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=y5(t)}}function x5(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?x5(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function w5(){for(var i=window,e=gm();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=gm(i.document)}return e}function iG(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}var RD=Ma&&"documentMode"in document&&11>=document.documentMode,td=null,rG=null,xI=null,sG=!1;function G5(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;sG||td==null||td!==gm(n)||(n=td,"selectionStart"in n&&iG(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),xI&&vI(xI,n)||(xI=n,n=Gm(rG,"onSelect"),0<n.length&&(e=new Jw("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=td)))}Kw("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Kw("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Kw(FP,2);for(var B5="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),oG=0;oG<B5.length;oG++)Yw.set(B5[oG],0);Pu("onMouseEnter",["mouseout","mouseover"]);Pu("onMouseLeave",["mouseout","mouseover"]);Pu("onPointerEnter",["pointerout","pointerover"]);Pu("onPointerLeave",["pointerout","pointerover"]);sg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sg("onBeforeInput",["compositionend","keypress","textInput","paste"]);sg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wI="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),S5=new Set("cancel close invalid load scroll toggle".split(" ").concat(wI));function Z5(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,_P(n,e,void 0,i),i.currentTarget=null}function R5(i,e){e=(e&4)!=0;for(var t=0;t<i.length;t++){var n=i[t],r=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Z5(r,a,c),s=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Z5(r,a,c),s=l}}}if(hm)throw i=Lw,hm=!1,Lw=null,i}function Tn(i,e){var t=X5(e),n=i+"__bubble";t.has(n)||(V5(e,i,2,!1),t.add(n))}var M5="_reactListening"+Math.random().toString(36).slice(2);function W5(i){i[M5]||(i[M5]=!0,mW.forEach(function(e){S5.has(e)||_5(e,!1,i,null),_5(e,!0,i,null)}))}function _5(i,e,t,n){var r=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=t;if(i==="selectionchange"&&t.nodeType!==9&&(s=t.ownerDocument),n!==null&&!e&&S5.has(i)){if(i!=="scroll")return;r|=2,s=n}var o=X5(s),a=i+"__"+(e?"capture":"bubble");o.has(a)||(e&&(r|=4),V5(s,i,r,e),o.add(a))}function V5(i,e,t,n){var r=Yw.get(e);switch(r===void 0?2:r){case 0:r=DP;break;case 1:r=UP;break;default:r=Dw}t=r.bind(null,e,t,i),r=void 0,!Fw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function N5(i,e,t,n,r){var s=n;if((e&1)==0&&(e&2)==0&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=gg(a),o===null)return;if(l=o.tag,l===5||l===6){n=s=o;continue e}a=a.parentNode}}n=n.return}ZP(function(){var c=s,g=Ww(t),d=[];e:{var u=i5.get(i);if(u!==void 0){var h=Jw,p=i;switch(i){case"keypress":if(ym(t)===0)break e;case"keydown":case"keyup":h=lD;break;case"focusin":p="focus",h=qw;break;case"focusout":p="blur",h=qw;break;case"beforeblur":case"afterblur":h=qw;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=a5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=QP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=uD;break;case $W:case e5:case t5:h=$P;break;case n5:h=hD;break;case"scroll":h=OP;break;case"wheel":h=ID;break;case"copy":case"cut":case"paste":h=tD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=c5}var b=(e&4)!=0,y=!b&&i==="scroll",m=b?u!==null?u+"Capture":null:u;b=[];for(var f=c,G;f!==null;){G=f;var x=G.stateNode;if(G.tag===5&&x!==null&&(G=x,m!==null&&(x=lI(f,m),x!=null&&b.push(GI(f,x,G)))),y)break;f=f.return}0<b.length&&(u=new h(u,p,null,t,g),d.push({event:u,listeners:b}))}}if((e&7)==0){e:{if(u=i==="mouseover"||i==="pointerover",h=i==="mouseout"||i==="pointerout",u&&(e&16)==0&&(p=t.relatedTarget||t.fromElement)&&(gg(p)||p[rd]))break e;if((h||u)&&(u=g.window===g?g:(u=g.ownerDocument)?u.defaultView||u.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=c,p=p?gg(p):null,p!==null&&(y=cg(p),p!==y||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=c),h!==p)){if(b=a5,x="onMouseLeave",m="onMouseEnter",f="mouse",(i==="pointerout"||i==="pointerover")&&(b=c5,x="onPointerLeave",m="onPointerEnter",f="pointer"),y=h==null?u:sd(h),G=p==null?u:sd(p),u=new b(x,f+"leave",h,t,g),u.target=y,u.relatedTarget=G,x=null,gg(g)===c&&(b=new b(m,f+"enter",p,t,g),b.target=G,b.relatedTarget=y,x=b),y=x,h&&p)t:{for(b=h,m=p,f=0,G=b;G;G=nd(G))f++;for(G=0,x=m;x;x=nd(x))G++;for(;0<f-G;)b=nd(b),f--;for(;0<G-f;)m=nd(m),G--;for(;f--;){if(b===m||m!==null&&b===m.alternate)break t;b=nd(b),m=nd(m)}b=null}else b=null;h!==null&&E5(d,u,h,b,!1),p!==null&&y!==null&&E5(d,y,p,b,!0)}}e:{if(u=c?sd(c):window,h=u.nodeName&&u.nodeName.toLowerCase(),h==="select"||h==="input"&&u.type==="file")var B=vD;else if(I5(u))if(p5)B=BD;else{B=wD;var M=xD}else(h=u.nodeName)&&h.toLowerCase()==="input"&&(u.type==="checkbox"||u.type==="radio")&&(B=GD);if(B&&(B=B(i,c))){C5(d,B,t,g);break e}M&&M(i,u,c),i==="focusout"&&(M=u._wrapperState)&&M.controlled&&u.type==="number"&&ww(u,"number",u.value)}switch(M=c?sd(c):window,i){case"focusin":(I5(M)||M.contentEditable==="true")&&(td=M,rG=c,xI=null);break;case"focusout":xI=rG=td=null;break;case"mousedown":sG=!0;break;case"contextmenu":case"mouseup":case"dragend":sG=!1,G5(d,t,g);break;case"selectionchange":if(RD)break;case"keydown":case"keyup":G5(d,t,g)}var E;if(eG)e:{switch(i){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else ed?h5(i,t)&&(z="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(z="onCompositionStart");z&&(g5&&t.locale!=="ko"&&(ed||z!=="onCompositionStart"?z==="onCompositionEnd"&&ed&&(E=s5()):(_l=g,Ow="value"in _l?_l.value:_l.textContent,ed=!0)),M=Gm(c,z),0<M.length&&(z=new l5(z,i,null,t,g),d.push({event:z,listeners:M}),E?z.data=E:(E=f5(t),E!==null&&(z.data=E)))),(E=pD?mD(i,t):AD(i,t))&&(c=Gm(c,"onBeforeInput"),0<c.length&&(g=new l5("onBeforeInput","beforeinput",null,t,g),d.push({event:g,listeners:c}),g.data=E))}R5(d,e)})}function GI(i,e,t){return{instance:i,listener:e,currentTarget:t}}function Gm(i,e){for(var t=e+"Capture",n=[];i!==null;){var r=i,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=lI(i,t),s!=null&&n.unshift(GI(i,s,r)),s=lI(i,e),s!=null&&n.push(GI(i,s,r))),i=i.return}return n}function nd(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function E5(i,e,t,n,r){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,r?(l=lI(t,s),l!=null&&o.unshift(GI(t,l,a))):r||(l=lI(t,s),l!=null&&o.push(GI(t,l,a)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}function Bm(){}var aG=null,lG=null;function H5(i,e){switch(i){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function cG(i,e){return i==="textarea"||i==="option"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var F5=typeof setTimeout=="function"?setTimeout:void 0,MD=typeof clearTimeout=="function"?clearTimeout:void 0;function gG(i){i.nodeType===1?i.textContent="":i.nodeType===9&&(i=i.body,i!=null&&(i.textContent=""))}function id(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break}return i}function L5(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var uG=0;function WD(i){return{$$typeof:pw,toString:i,valueOf:i}}var Sm=Math.random().toString(36).slice(2),Vl="__reactFiber$"+Sm,Zm="__reactProps$"+Sm,rd="__reactContainer$"+Sm,T5="__reactEvents$"+Sm;function gg(i){var e=i[Vl];if(e)return e;for(var t=i.parentNode;t;){if(e=t[rd]||t[Vl]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=L5(i);i!==null;){if(t=i[Vl])return t;i=L5(i)}return e}i=t,t=i.parentNode}return null}function BI(i){return i=i[Vl]||i[rd],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function sd(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(qe(33))}function Rm(i){return i[Zm]||null}function X5(i){var e=i[T5];return e===void 0&&(e=i[T5]=new Set),e}var dG=[],od=-1;function Nl(i){return{current:i}}function Xn(i){0>od||(i.current=dG[od],dG[od]=null,od--)}function ni(i,e){od++,dG[od]=i.current,i.current=e}var El={},lr=Nl(El),Or=Nl(!1),ug=El;function ad(i,e){var t=i.type.contextTypes;if(!t)return El;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function Jr(i){return i=i.childContextTypes,i!=null}function Mm(){Xn(Or),Xn(lr)}function z5(i,e,t){if(lr.current!==El)throw Error(qe(168));ni(lr,e),ni(Or,t)}function k5(i,e,t){var n=i.stateNode;if(i=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in i))throw Error(qe(108,Du(e)||"Unknown",r));return Pn({},t,n)}function Wm(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||El,ug=lr.current,ni(lr,i),ni(Or,Or.current),!0}function Y5(i,e,t){var n=i.stateNode;if(!n)throw Error(qe(169));t?(i=k5(i,e,ug),n.__reactInternalMemoizedMergedChildContext=i,Xn(Or),Xn(lr),ni(lr,i)):Xn(Or),ni(Or,t)}var hG=null,dg=null,_D=Vi.unstable_runWithPriority,fG=Vi.unstable_scheduleCallback,IG=Vi.unstable_cancelCallback,VD=Vi.unstable_shouldYield,K5=Vi.unstable_requestPaint,CG=Vi.unstable_now,ND=Vi.unstable_getCurrentPriorityLevel,_m=Vi.unstable_ImmediatePriority,P5=Vi.unstable_UserBlockingPriority,D5=Vi.unstable_NormalPriority,U5=Vi.unstable_LowPriority,O5=Vi.unstable_IdlePriority,pG={},ED=K5!==void 0?K5:function(){},Wa=null,Vm=null,mG=!1,J5=CG(),cr=1e4>J5?CG:function(){return CG()-J5};function ld(){switch(ND()){case _m:return 99;case P5:return 98;case D5:return 97;case U5:return 96;case O5:return 95;default:throw Error(qe(332))}}function Q5(i){switch(i){case 99:return _m;case 98:return P5;case 97:return D5;case 96:return U5;case 95:return O5;default:throw Error(qe(332))}}function hg(i,e){return i=Q5(i),_D(i,e)}function SI(i,e,t){return i=Q5(i),fG(i,e,t)}function Lo(){if(Vm!==null){var i=Vm;Vm=null,IG(i)}j5()}function j5(){if(!mG&&Wa!==null){mG=!0;var i=0;try{var e=Wa;hg(99,function(){for(;i<e.length;i++){var t=e[i];do t=t(!0);while(t!==null)}}),Wa=null}catch(t){throw Wa!==null&&(Wa=Wa.slice(i+1)),fG(_m,Lo),t}finally{mG=!1}}}var HD=og.ReactCurrentBatchConfig;function oo(i,e){if(i&&i.defaultProps){e=Pn({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var Nm=Nl(null),Em=null,cd=null,Hm=null;function AG(){Hm=cd=Em=null}function bG(i){var e=Nm.current;Xn(Nm),i.type._context._currentValue=e}function q5(i,e){for(;i!==null;){var t=i.alternate;if((i.childLanes&e)===e){if(t===null||(t.childLanes&e)===e)break;t.childLanes|=e}else i.childLanes|=e,t!==null&&(t.childLanes|=e);i=i.return}}function gd(i,e){Em=i,Hm=cd=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&e)!=0&&(ao=!0),i.firstContext=null)}function Ts(i,e){if(Hm!==i&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Hm=i,e=1073741823),e={context:i,observedBits:e,next:null},cd===null){if(Em===null)throw Error(qe(308));cd=e,Em.dependencies={lanes:0,firstContext:e,responders:null}}else cd=cd.next=e;return i._currentValue}var Hl=!1;function yG(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function $5(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Fl(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function Ll(i,e){if(i=i.updateQueue,i!==null){i=i.shared;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}}function e_(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function ZI(i,e,t,n){var r=i.updateQueue;Hl=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var g=i.alternate;if(g!==null){g=g.updateQueue;var d=g.lastBaseUpdate;d!==o&&(d===null?g.firstBaseUpdate=c:d.next=c,g.lastBaseUpdate=l)}}if(s!==null){d=r.baseState,o=0,g=c=l=null;do{a=s.lane;var u=s.eventTime;if((n&a)===a){g!==null&&(g=g.next={eventTime:u,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=i,p=s;switch(a=e,u=t,p.tag){case 1:if(h=p.payload,typeof h=="function"){d=h.call(u,d,a);break e}d=h;break e;case 3:h.flags=h.flags&-4097|64;case 0:if(h=p.payload,a=typeof h=="function"?h.call(u,d,a):h,a==null)break e;d=Pn({},d,a);break e;case 2:Hl=!0}}s.callback!==null&&(i.flags|=32,a=r.effects,a===null?r.effects=[s]:a.push(s))}else u={eventTime:u,lane:a,tag:s.tag,payload:s.payload,callback:s.callback,next:null},g===null?(c=g=u,l=d):g=g.next=u,o|=a;if(s=s.next,s===null){if(a=r.shared.pending,a===null)break;s=a.next,a.next=null,r.lastBaseUpdate=a,r.shared.pending=null}}while(1);g===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=g,XI|=o,i.lanes=o,i.memoizedState=d}}function t_(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(qe(191,r));r.call(n)}}}var n_=new rm.Component().refs;function Fm(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Pn({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var Lm={isMounted:function(i){return(i=i._reactInternals)?cg(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=Is(),r=zl(i),s=Fl(n,r);s.payload=e,t!=null&&(s.callback=t),Ll(i,s),kl(i,r,n)},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=Is(),r=zl(i),s=Fl(n,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),Ll(i,s),kl(i,r,n)},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=Is(),n=zl(i),r=Fl(t,n);r.tag=2,e!=null&&(r.callback=e),Ll(i,r),kl(i,n,t)}};function i_(i,e,t,n,r,s,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!vI(t,n)||!vI(r,s):!0}function r_(i,e,t){var n=!1,r=El,s=e.contextType;return typeof s=="object"&&s!==null?s=Ts(s):(r=Jr(e)?ug:lr.current,n=e.contextTypes,s=(n=n!=null)?ad(i,r):El),e=new e(t,s),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Lm,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=s),e}function s_(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&Lm.enqueueReplaceState(e,e.state,null)}function vG(i,e,t,n){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs=n_,yG(i);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ts(s):(s=Jr(e)?ug:lr.current,r.context=ad(i,s)),ZI(i,t,r,n),r.state=i.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Fm(i,e,s,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Lm.enqueueReplaceState(r,r.state,null),ZI(i,t,r,n),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4)}var Tm=Array.isArray;function RI(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(qe(309));var n=t.stateNode}if(!n)throw Error(qe(147,i));var r=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(s){var o=n.refs;o===n_&&(o=n.refs={}),s===null?delete o[r]:o[r]=s},e._stringRef=r,e)}if(typeof i!="string")throw Error(qe(284));if(!t._owner)throw Error(qe(290,i))}return i}function Xm(i,e){if(i.type!=="textarea")throw Error(qe(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function o_(i){function e(y,m){if(i){var f=y.lastEffect;f!==null?(f.nextEffect=m,y.lastEffect=m):y.firstEffect=y.lastEffect=m,m.nextEffect=null,m.flags=8}}function t(y,m){if(!i)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function n(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function r(y,m){return y=Pl(y,m),y.index=0,y.sibling=null,y}function s(y,m,f){return y.index=f,i?(f=y.alternate,f!==null?(f=f.index,f<m?(y.flags=2,m):f):(y.flags=2,m)):m}function o(y){return i&&y.alternate===null&&(y.flags=2),y}function a(y,m,f,G){return m===null||m.tag!==6?(m=r2(f,y.mode,G),m.return=y,m):(m=r(m,f),m.return=y,m)}function l(y,m,f,G){return m!==null&&m.elementType===f.type?(G=r(m,f.props),G.ref=RI(y,m,f),G.return=y,G):(G=rA(f.type,f.key,f.props,null,y.mode,G),G.ref=RI(y,m,f),G.return=y,G)}function c(y,m,f,G){return m===null||m.tag!==4||m.stateNode.containerInfo!==f.containerInfo||m.stateNode.implementation!==f.implementation?(m=s2(f,y.mode,G),m.return=y,m):(m=r(m,f.children||[]),m.return=y,m)}function g(y,m,f,G,x){return m===null||m.tag!==7?(m=md(f,y.mode,G,x),m.return=y,m):(m=r(m,f),m.return=y,m)}function d(y,m,f){if(typeof m=="string"||typeof m=="number")return m=r2(""+m,y.mode,f),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case tI:return f=rA(m.type,m.key,m.props,null,y.mode,f),f.ref=RI(y,null,m),f.return=y,f;case ag:return m=s2(m,y.mode,f),m.return=y,m}if(Tm(m)||rI(m))return m=md(m,y.mode,f,null),m.return=y,m;Xm(y,m)}return null}function u(y,m,f,G){var x=m!==null?m.key:null;if(typeof f=="string"||typeof f=="number")return x!==null?null:a(y,m,""+f,G);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case tI:return f.key===x?f.type===Bl?g(y,m,f.props.children,G,x):l(y,m,f,G):null;case ag:return f.key===x?c(y,m,f,G):null}if(Tm(f)||rI(f))return x!==null?null:g(y,m,f,G,null);Xm(y,f)}return null}function h(y,m,f,G,x){if(typeof G=="string"||typeof G=="number")return y=y.get(f)||null,a(m,y,""+G,x);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case tI:return y=y.get(G.key===null?f:G.key)||null,G.type===Bl?g(m,y,G.props.children,x,G.key):l(m,y,G,x);case ag:return y=y.get(G.key===null?f:G.key)||null,c(m,y,G,x)}if(Tm(G)||rI(G))return y=y.get(f)||null,g(m,y,G,x,null);Xm(m,G)}return null}function p(y,m,f,G){for(var x=null,B=null,M=m,E=m=0,z=null;M!==null&&E<f.length;E++){M.index>E?(z=M,M=null):z=M.sibling;var J=u(y,M,f[E],G);if(J===null){M===null&&(M=z);break}i&&M&&J.alternate===null&&e(y,M),m=s(J,m,E),B===null?x=J:B.sibling=J,B=J,M=z}if(E===f.length)return t(y,M),x;if(M===null){for(;E<f.length;E++)M=d(y,f[E],G),M!==null&&(m=s(M,m,E),B===null?x=M:B.sibling=M,B=M);return x}for(M=n(y,M);E<f.length;E++)z=h(M,y,E,f[E],G),z!==null&&(i&&z.alternate!==null&&M.delete(z.key===null?E:z.key),m=s(z,m,E),B===null?x=z:B.sibling=z,B=z);return i&&M.forEach(function(V){return e(y,V)}),x}function b(y,m,f,G){var x=rI(f);if(typeof x!="function")throw Error(qe(150));if(f=x.call(f),f==null)throw Error(qe(151));for(var B=x=null,M=m,E=m=0,z=null,J=f.next();M!==null&&!J.done;E++,J=f.next()){M.index>E?(z=M,M=null):z=M.sibling;var V=u(y,M,J.value,G);if(V===null){M===null&&(M=z);break}i&&M&&V.alternate===null&&e(y,M),m=s(V,m,E),B===null?x=V:B.sibling=V,B=V,M=z}if(J.done)return t(y,M),x;if(M===null){for(;!J.done;E++,J=f.next())J=d(y,J.value,G),J!==null&&(m=s(J,m,E),B===null?x=J:B.sibling=J,B=J);return x}for(M=n(y,M);!J.done;E++,J=f.next())J=h(M,y,E,J.value,G),J!==null&&(i&&J.alternate!==null&&M.delete(J.key===null?E:J.key),m=s(J,m,E),B===null?x=J:B.sibling=J,B=J);return i&&M.forEach(function(I){return e(y,I)}),x}return function(y,m,f,G){var x=typeof f=="object"&&f!==null&&f.type===Bl&&f.key===null;x&&(f=f.props.children);var B=typeof f=="object"&&f!==null;if(B)switch(f.$$typeof){case tI:e:{for(B=f.key,x=m;x!==null;){if(x.key===B){switch(x.tag){case 7:if(f.type===Bl){t(y,x.sibling),m=r(x,f.props.children),m.return=y,y=m;break e}break;default:if(x.elementType===f.type){t(y,x.sibling),m=r(x,f.props),m.ref=RI(y,x,f),m.return=y,y=m;break e}}t(y,x);break}else e(y,x);x=x.sibling}f.type===Bl?(m=md(f.props.children,y.mode,G,f.key),m.return=y,y=m):(G=rA(f.type,f.key,f.props,null,y.mode,G),G.ref=RI(y,m,f),G.return=y,y=G)}return o(y);case ag:e:{for(x=f.key;m!==null;){if(m.key===x)if(m.tag===4&&m.stateNode.containerInfo===f.containerInfo&&m.stateNode.implementation===f.implementation){t(y,m.sibling),m=r(m,f.children||[]),m.return=y,y=m;break e}else{t(y,m);break}else e(y,m);m=m.sibling}m=s2(f,y.mode,G),m.return=y,y=m}return o(y)}if(typeof f=="string"||typeof f=="number")return f=""+f,m!==null&&m.tag===6?(t(y,m.sibling),m=r(m,f),m.return=y,y=m):(t(y,m),m=r2(f,y.mode,G),m.return=y,y=m),o(y);if(Tm(f))return p(y,m,f,G);if(rI(f))return b(y,m,f,G);if(B&&Xm(y,f),typeof f=="undefined"&&!x)switch(y.tag){case 1:case 22:case 0:case 11:case 15:throw Error(qe(152,Du(y.type)||"Component"))}return t(y,m)}}var zm=o_(!0),a_=o_(!1),MI={},To=Nl(MI),WI=Nl(MI),_I=Nl(MI);function fg(i){if(i===MI)throw Error(qe(174));return i}function xG(i,e){switch(ni(_I,e),ni(WI,i),ni(To,MI),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Zw(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=Zw(e,i)}Xn(To),ni(To,e)}function ud(){Xn(To),Xn(WI),Xn(_I)}function l_(i){fg(_I.current);var e=fg(To.current),t=Zw(e,i.type);e!==t&&(ni(WI,i),ni(To,t))}function wG(i){WI.current===i&&(Xn(To),Xn(WI))}var ii=Nl(0);function km(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!=0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _a=null,Tl=null,Xo=!1;function c_(i,e){var t=ks(5,null,null,0);t.elementType="DELETED",t.type="DELETED",t.stateNode=e,t.return=i,t.flags=8,i.lastEffect!==null?(i.lastEffect.nextEffect=t,i.lastEffect=t):i.firstEffect=i.lastEffect=t}function g_(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function GG(i){if(Xo){var e=Tl;if(e){var t=e;if(!g_(i,e)){if(e=id(t.nextSibling),!e||!g_(i,e)){i.flags=i.flags&-1025|2,Xo=!1,_a=i;return}c_(_a,t)}_a=i,Tl=id(e.firstChild)}else i.flags=i.flags&-1025|2,Xo=!1,_a=i}}function u_(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;_a=i}function Ym(i){if(i!==_a)return!1;if(!Xo)return u_(i),Xo=!0,!1;var e=i.type;if(i.tag!==5||e!=="head"&&e!=="body"&&!cG(e,i.memoizedProps))for(e=Tl;e;)c_(i,e),e=id(e.nextSibling);if(u_(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(qe(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){Tl=id(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}Tl=null}}else Tl=_a?id(i.stateNode.nextSibling):null;return!0}function BG(){Tl=_a=null,Xo=!1}var dd=[];function SG(){for(var i=0;i<dd.length;i++)dd[i]._workInProgressVersionPrimary=null;dd.length=0}var VI=og.ReactCurrentDispatcher,Xs=og.ReactCurrentBatchConfig,NI=0,ai=null,gr=null,Ui=null,Km=!1,EI=!1;function Qr(){throw Error(qe(321))}function ZG(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!Ls(i[t],e[t]))return!1;return!0}function RG(i,e,t,n,r,s){if(NI=s,ai=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,VI.current=i===null||i.memoizedState===null?LD:TD,i=t(n,r),EI){s=0;do{if(EI=!1,!(25>s))throw Error(qe(301));s+=1,Ui=gr=null,e.updateQueue=null,VI.current=XD,i=t(n,r)}while(EI)}if(VI.current=Om,e=gr!==null&&gr.next!==null,NI=0,Ui=gr=ai=null,Km=!1,e)throw Error(qe(300));return i}function Ig(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?ai.memoizedState=Ui=i:Ui=Ui.next=i,Ui}function Cg(){if(gr===null){var i=ai.alternate;i=i!==null?i.memoizedState:null}else i=gr.next;var e=Ui===null?ai.memoizedState:Ui.next;if(e!==null)Ui=e,gr=i;else{if(i===null)throw Error(qe(310));gr=i,i={memoizedState:gr.memoizedState,baseState:gr.baseState,baseQueue:gr.baseQueue,queue:gr.queue,next:null},Ui===null?ai.memoizedState=Ui=i:Ui=Ui.next=i}return Ui}function zo(i,e){return typeof e=="function"?e(i):e}function HI(i){var e=Cg(),t=e.queue;if(t===null)throw Error(qe(311));t.lastRenderedReducer=i;var n=gr,r=n.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,t.pending=null}if(r!==null){r=r.next,n=n.baseState;var a=o=s=null,l=r;do{var c=l.lane;if((NI&c)===c)a!==null&&(a=a.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),n=l.eagerReducer===i?l.eagerState:i(n,l.action);else{var g={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};a===null?(o=a=g,s=n):a=a.next=g,ai.lanes|=c,XI|=c}l=l.next}while(l!==null&&l!==r);a===null?s=n:a.next=o,Ls(n,e.memoizedState)||(ao=!0),e.memoizedState=n,e.baseState=s,e.baseQueue=a,t.lastRenderedState=n}return[e.memoizedState,t.dispatch]}function FI(i){var e=Cg(),t=e.queue;if(t===null)throw Error(qe(311));t.lastRenderedReducer=i;var n=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=i(s,o.action),o=o.next;while(o!==r);Ls(s,e.memoizedState)||(ao=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function d_(i,e,t){var n=e._getVersion;n=n(e._source);var r=e._workInProgressVersionPrimary;if(r!==null?i=r===n:(i=i.mutableReadLanes,(i=(NI&i)===i)&&(e._workInProgressVersionPrimary=n,dd.push(e))),i)return t(e._source);throw dd.push(e),Error(qe(350))}function h_(i,e,t,n){var r=Wr;if(r===null)throw Error(qe(349));var s=e._getVersion,o=s(e._source),a=VI.current,l=a.useState(function(){return d_(r,e,t)}),c=l[1],g=l[0];l=Ui;var d=i.memoizedState,u=d.refs,h=u.getSnapshot,p=d.source;d=d.subscribe;var b=ai;return i.memoizedState={refs:u,source:e,subscribe:n},a.useEffect(function(){u.getSnapshot=t,u.setSnapshot=c;var y=s(e._source);if(!Ls(o,y)){y=t(e._source),Ls(g,y)||(c(y),y=zl(b),r.mutableReadLanes|=y&r.pendingLanes),y=r.mutableReadLanes,r.entangledLanes|=y;for(var m=r.entanglements,f=y;0<f;){var G=31-Wl(f),x=1<<G;m[G]|=y,f&=~x}}},[t,e,n]),a.useEffect(function(){return n(e._source,function(){var y=u.getSnapshot,m=u.setSnapshot;try{m(y(e._source));var f=zl(b);r.mutableReadLanes|=f&r.pendingLanes}catch(G){m(function(){throw G})}})},[e,n]),Ls(h,t)&&Ls(p,e)&&Ls(d,n)||(i={pending:null,dispatch:null,lastRenderedReducer:zo,lastRenderedState:g},i.dispatch=c=VG.bind(null,ai,i),l.queue=i,l.baseQueue=null,g=d_(r,e,t),l.memoizedState=l.baseState=g),g}function f_(i,e,t){var n=Cg();return h_(n,i,e,t)}function LI(i){var e=Ig();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i=e.queue={pending:null,dispatch:null,lastRenderedReducer:zo,lastRenderedState:i},i=i.dispatch=VG.bind(null,ai,i),[e.memoizedState,i]}function Pm(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=ai.updateQueue,e===null?(e={lastEffect:null},ai.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function I_(i){var e=Ig();return i={current:i},e.memoizedState=i}function Dm(){return Cg().memoizedState}function MG(i,e,t,n){var r=Ig();ai.flags|=i,r.memoizedState=Pm(1|e,t,void 0,n===void 0?null:n)}function WG(i,e,t,n){var r=Cg();n=n===void 0?null:n;var s=void 0;if(gr!==null){var o=gr.memoizedState;if(s=o.destroy,n!==null&&ZG(n,o.deps)){Pm(e,t,s,n);return}}ai.flags|=i,r.memoizedState=Pm(1|e,t,s,n)}function C_(i,e){return MG(516,4,i,e)}function Um(i,e){return WG(516,4,i,e)}function p_(i,e){return WG(4,2,i,e)}function m_(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function A_(i,e,t){return t=t!=null?t.concat([i]):null,WG(4,2,m_.bind(null,e,i),t)}function _G(){}function b_(i,e){var t=Cg();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ZG(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function y_(i,e){var t=Cg();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ZG(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function FD(i,e){var t=ld();hg(98>t?98:t,function(){i(!0)}),hg(97<t?97:t,function(){var n=Xs.transition;Xs.transition=1;try{i(!1),e()}finally{Xs.transition=n}})}function VG(i,e,t){var n=Is(),r=zl(i),s={lane:r,action:t,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=i.alternate,i===ai||o!==null&&o===ai)EI=Km=!0;else{if(i.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,l=o(a,t);if(s.eagerReducer=o,s.eagerState=l,Ls(l,a))return}catch{}finally{}kl(i,r,n)}}var Om={readContext:Ts,useCallback:Qr,useContext:Qr,useEffect:Qr,useImperativeHandle:Qr,useLayoutEffect:Qr,useMemo:Qr,useReducer:Qr,useRef:Qr,useState:Qr,useDebugValue:Qr,useDeferredValue:Qr,useTransition:Qr,useMutableSource:Qr,useOpaqueIdentifier:Qr,unstable_isNewReconciler:!1},LD={readContext:Ts,useCallback:function(i,e){return Ig().memoizedState=[i,e===void 0?null:e],i},useContext:Ts,useEffect:C_,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,MG(4,2,m_.bind(null,e,i),t)},useLayoutEffect:function(i,e){return MG(4,2,i,e)},useMemo:function(i,e){var t=Ig();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=Ig();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i=n.queue={pending:null,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},i=i.dispatch=VG.bind(null,ai,i),[n.memoizedState,i]},useRef:I_,useState:LI,useDebugValue:_G,useDeferredValue:function(i){var e=LI(i),t=e[0],n=e[1];return C_(function(){var r=Xs.transition;Xs.transition=1;try{n(i)}finally{Xs.transition=r}},[i]),t},useTransition:function(){var i=LI(!1),e=i[0];return i=FD.bind(null,i[1]),I_(i),[i,e]},useMutableSource:function(i,e,t){var n=Ig();return n.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:i,subscribe:t},h_(n,i,e,t)},useOpaqueIdentifier:function(){if(Xo){var i=!1,e=WD(function(){throw i||(i=!0,t("r:"+(uG++).toString(36))),Error(qe(355))}),t=LI(e)[1];return(ai.mode&2)==0&&(ai.flags|=516,Pm(5,function(){t("r:"+(uG++).toString(36))},void 0,null)),e}return e="r:"+(uG++).toString(36),LI(e),e},unstable_isNewReconciler:!1},TD={readContext:Ts,useCallback:b_,useContext:Ts,useEffect:Um,useImperativeHandle:A_,useLayoutEffect:p_,useMemo:y_,useReducer:HI,useRef:Dm,useState:function(){return HI(zo)},useDebugValue:_G,useDeferredValue:function(i){var e=HI(zo),t=e[0],n=e[1];return Um(function(){var r=Xs.transition;Xs.transition=1;try{n(i)}finally{Xs.transition=r}},[i]),t},useTransition:function(){var i=HI(zo)[0];return[Dm().current,i]},useMutableSource:f_,useOpaqueIdentifier:function(){return HI(zo)[0]},unstable_isNewReconciler:!1},XD={readContext:Ts,useCallback:b_,useContext:Ts,useEffect:Um,useImperativeHandle:A_,useLayoutEffect:p_,useMemo:y_,useReducer:FI,useRef:Dm,useState:function(){return FI(zo)},useDebugValue:_G,useDeferredValue:function(i){var e=FI(zo),t=e[0],n=e[1];return Um(function(){var r=Xs.transition;Xs.transition=1;try{n(i)}finally{Xs.transition=r}},[i]),t},useTransition:function(){var i=FI(zo)[0];return[Dm().current,i]},useMutableSource:f_,useOpaqueIdentifier:function(){return FI(zo)[0]},unstable_isNewReconciler:!1},zD=og.ReactCurrentOwner,ao=!1;function jr(i,e,t,n){e.child=i===null?a_(e,null,t,n):zm(e,i.child,t,n)}function v_(i,e,t,n,r){t=t.render;var s=e.ref;return gd(e,r),n=RG(i,e,t,n,s,r),i!==null&&!ao?(e.updateQueue=i.updateQueue,e.flags&=-517,i.lanes&=~r,Va(i,e,r)):(e.flags|=1,jr(i,e,n,r),e.child)}function x_(i,e,t,n,r,s){if(i===null){var o=t.type;return typeof o=="function"&&!n2(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,w_(i,e,o,n,r,s)):(i=rA(t.type,null,n,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}return o=i.child,(r&s)==0&&(r=o.memoizedProps,t=t.compare,t=t!==null?t:vI,t(r,n)&&i.ref===e.ref)?Va(i,e,s):(e.flags|=1,i=Pl(o,n),i.ref=e.ref,i.return=e,e.child=i)}function w_(i,e,t,n,r,s){if(i!==null&&vI(i.memoizedProps,n)&&i.ref===e.ref)if(ao=!1,(s&r)!=0)(i.flags&16384)!=0&&(ao=!0);else return e.lanes=i.lanes,Va(i,e,s);return EG(i,e,t,n,s)}function NG(i,e,t){var n=e.pendingProps,r=n.children,s=i!==null?i.memoizedState:null;if(n.mode==="hidden"||n.mode==="unstable-defer-without-hiding")if((e.mode&4)==0)e.memoizedState={baseLanes:0},iA(e,t);else if((t&1073741824)!=0)e.memoizedState={baseLanes:0},iA(e,s!==null?s.baseLanes:t);else return i=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i},iA(e,i),null;else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,iA(e,n);return jr(i,e,r,t),e.child}function G_(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=128)}function EG(i,e,t,n,r){var s=Jr(t)?ug:lr.current;return s=ad(e,s),gd(e,r),t=RG(i,e,t,n,s,r),i!==null&&!ao?(e.updateQueue=i.updateQueue,e.flags&=-517,i.lanes&=~r,Va(i,e,r)):(e.flags|=1,jr(i,e,t,r),e.child)}function B_(i,e,t,n,r){if(Jr(t)){var s=!0;Wm(e)}else s=!1;if(gd(e,r),e.stateNode===null)i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2),r_(e,t,n),vG(e,t,n,r),n=!0;else if(i===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Ts(c):(c=Jr(t)?ug:lr.current,c=ad(e,c));var g=t.getDerivedStateFromProps,d=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&s_(e,o,n,c),Hl=!1;var u=e.memoizedState;o.state=u,ZI(e,n,o,r),l=e.memoizedState,a!==n||u!==l||Or.current||Hl?(typeof g=="function"&&(Fm(e,t,g,n),l=e.memoizedState),(a=Hl||i_(e,t,a,n,u,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4),n=!1)}else{o=e.stateNode,$5(i,e),a=e.memoizedProps,c=e.type===e.elementType?a:oo(e.type,a),o.props=c,d=e.pendingProps,u=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Ts(l):(l=Jr(t)?ug:lr.current,l=ad(e,l));var h=t.getDerivedStateFromProps;(g=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||u!==l)&&s_(e,o,n,l),Hl=!1,u=e.memoizedState,o.state=u,ZI(e,n,o,r);var p=e.memoizedState;a!==d||u!==p||Or.current||Hl?(typeof h=="function"&&(Fm(e,t,h,n),p=e.memoizedState),(c=Hl||i_(e,t,c,n,u,p,l))?(g||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&u===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&u===i.memoizedState||(e.flags|=256),e.memoizedProps=n,e.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&u===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&u===i.memoizedState||(e.flags|=256),n=!1)}return HG(i,e,t,n,s,r)}function HG(i,e,t,n,r,s){G_(i,e);var o=(e.flags&64)!=0;if(!n&&!o)return r&&Y5(e,t,!1),Va(i,e,s);n=e.stateNode,zD.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=zm(e,i.child,null,s),e.child=zm(e,null,a,s)):jr(i,e,a,s),e.memoizedState=n.state,r&&Y5(e,t,!0),e.child}function S_(i){var e=i.stateNode;e.pendingContext?z5(i,e.pendingContext,e.pendingContext!==e.context):e.context&&z5(i,e.context,!1),xG(i,e.containerInfo)}var Jm={dehydrated:null,retryLane:0};function Z_(i,e,t){var n=e.pendingProps,r=ii.current,s=!1,o;return(o=(e.flags&64)!=0)||(o=i!==null&&i.memoizedState===null?!1:(r&2)!=0),o?(s=!0,e.flags&=-65):i!==null&&i.memoizedState===null||n.fallback===void 0||n.unstable_avoidThisFallback===!0||(r|=1),ni(ii,r&1),i===null?(n.fallback!==void 0&&GG(e),i=n.children,r=n.fallback,s?(i=R_(e,i,r,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Jm,i):typeof n.unstable_expectedLoadTime=="number"?(i=R_(e,i,r,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Jm,e.lanes=33554432,i):(t=i2({mode:"visible",children:i},e.mode,t,null),t.return=e,e.child=t)):i.memoizedState!==null?s?(n=W_(i,e,n.children,n.fallback,t),s=e.child,r=i.child.memoizedState,s.memoizedState=r===null?{baseLanes:t}:{baseLanes:r.baseLanes|t},s.childLanes=i.childLanes&~t,e.memoizedState=Jm,n):(t=M_(i,e,n.children,t),e.memoizedState=null,t):s?(n=W_(i,e,n.children,n.fallback,t),s=e.child,r=i.child.memoizedState,s.memoizedState=r===null?{baseLanes:t}:{baseLanes:r.baseLanes|t},s.childLanes=i.childLanes&~t,e.memoizedState=Jm,n):(t=M_(i,e,n.children,t),e.memoizedState=null,t)}function R_(i,e,t,n){var r=i.mode,s=i.child;return e={mode:"hidden",children:e},(r&2)==0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=i2(e,r,0,null),t=md(t,r,n,null),s.return=i,t.return=i,s.sibling=t,i.child=s,t}function M_(i,e,t,n){var r=i.child;return i=r.sibling,t=Pl(r,{mode:"visible",children:t}),(e.mode&2)==0&&(t.lanes=n),t.return=e,t.sibling=null,i!==null&&(i.nextEffect=null,i.flags=8,e.firstEffect=e.lastEffect=i),e.child=t}function W_(i,e,t,n,r){var s=e.mode,o=i.child;i=o.sibling;var a={mode:"hidden",children:t};return(s&2)==0&&e.child!==o?(t=e.child,t.childLanes=0,t.pendingProps=a,o=t.lastEffect,o!==null?(e.firstEffect=t.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):t=Pl(o,a),i!==null?n=Pl(i,n):(n=md(n,s,r,null),n.flags|=2),n.return=e,t.return=e,t.sibling=n,e.child=t,n}function __(i,e){i.lanes|=e;var t=i.alternate;t!==null&&(t.lanes|=e),q5(i.return,e)}function FG(i,e,t,n,r,s){var o=i.memoizedState;o===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=t,o.tailMode=r,o.lastEffect=s)}function V_(i,e,t){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(jr(i,e,n.children,t),n=ii.current,(n&2)!=0)n=n&1|2,e.flags|=64;else{if(i!==null&&(i.flags&64)!=0)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&__(i,t);else if(i.tag===19)__(i,t);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(ni(ii,n),(e.mode&2)==0)e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&km(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),FG(e,!1,r,t,s,e.lastEffect);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&km(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}FG(e,!0,t,null,s,e.lastEffect);break;case"together":FG(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Va(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),XI|=e.lanes,(t&e.childLanes)!=0){if(i!==null&&e.child!==i.child)throw Error(qe(153));if(e.child!==null){for(i=e.child,t=Pl(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=Pl(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}return null}var N_,LG,E_,H_;N_=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};LG=function(){};E_=function(i,e,t,n){var r=i.memoizedProps;if(r!==n){i=e.stateNode,fg(To.current);var s=null;switch(t){case"input":r=vw(i,r),n=vw(i,n),s=[];break;case"option":r=Gw(i,r),n=Gw(i,n),s=[];break;case"select":r=Pn({},r,{value:void 0}),n=Pn({},n,{value:void 0}),s=[];break;case"textarea":r=Bw(i,r),n=Bw(i,n),s=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=Bm)}Rw(t,n);var o;t=null;for(c in r)if(!n.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(eI.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in n){var l=n[c];if(a=r!=null?r[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(eI.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Tn("scroll",i),s||a===l||(s=[])):typeof l=="object"&&l!==null&&l.$$typeof===pw?l.toString():(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};H_=function(i,e,t,n){t!==n&&(e.flags|=4)};function TI(i,e){if(!Xo)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function kD(i,e,t){var n=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Jr(e.type)&&Mm(),null;case 3:return ud(),Xn(Or),Xn(lr),SG(),n=e.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(Ym(e)?e.flags|=4:n.hydrate||(e.flags|=256)),LG(e),null;case 5:wG(e);var r=fg(_I.current);if(t=e.type,i!==null&&e.stateNode!=null)E_(i,e,t,n,r),i.ref!==e.ref&&(e.flags|=128);else{if(!n){if(e.stateNode===null)throw Error(qe(166));return null}if(i=fg(To.current),Ym(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Vl]=e,n[Zm]=s,t){case"dialog":Tn("cancel",n),Tn("close",n);break;case"iframe":case"object":case"embed":Tn("load",n);break;case"video":case"audio":for(i=0;i<wI.length;i++)Tn(wI[i],n);break;case"source":Tn("error",n);break;case"img":case"image":case"link":Tn("error",n),Tn("load",n);break;case"details":Tn("toggle",n);break;case"input":BW(n,s),Tn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Tn("invalid",n);break;case"textarea":RW(n,s),Tn("invalid",n)}Rw(t,s),i=null;for(var o in s)s.hasOwnProperty(o)&&(r=s[o],o==="children"?typeof r=="string"?n.textContent!==r&&(i=["children",r]):typeof r=="number"&&n.textContent!==""+r&&(i=["children",""+r]):eI.hasOwnProperty(o)&&r!=null&&o==="onScroll"&&Tn("scroll",n));switch(t){case"input":cm(n),ZW(n,s,!0);break;case"textarea":cm(n),WW(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=Bm)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{switch(o=r.nodeType===9?r:r.ownerDocument,i===Sw.html&&(i=_W(t)),i===Sw.html?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[Vl]=e,i[Zm]=n,N_(i,e,!1,!1),e.stateNode=i,o=Mw(t,n),t){case"dialog":Tn("cancel",i),Tn("close",i),r=n;break;case"iframe":case"object":case"embed":Tn("load",i),r=n;break;case"video":case"audio":for(r=0;r<wI.length;r++)Tn(wI[r],i);r=n;break;case"source":Tn("error",i),r=n;break;case"img":case"image":case"link":Tn("error",i),Tn("load",i),r=n;break;case"details":Tn("toggle",i),r=n;break;case"input":BW(i,n),r=vw(i,n),Tn("invalid",i);break;case"option":r=Gw(i,n);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},r=Pn({},n,{value:void 0}),Tn("invalid",i);break;case"textarea":RW(i,n),r=Bw(i,n),Tn("invalid",i);break;default:r=n}Rw(t,r);var a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?EW(i,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&VW(i,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&oI(i,l):typeof l=="number"&&oI(i,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(eI.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Tn("scroll",i):l!=null&&uw(i,s,l,o))}switch(t){case"input":cm(i),ZW(i,n,!1);break;case"textarea":cm(i),WW(i);break;case"option":n.value!=null&&i.setAttribute("value",""+Sl(n.value));break;case"select":i.multiple=!!n.multiple,s=n.value,s!=null?Uu(i,!!n.multiple,s,!1):n.defaultValue!=null&&Uu(i,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=Bm)}H5(t,n)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(i&&e.stateNode!=null)H_(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(qe(166));t=fg(_I.current),fg(To.current),Ym(e)?(n=e.stateNode,t=e.memoizedProps,n[Vl]=e,n.nodeValue!==t&&(e.flags|=4)):(n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Vl]=e,e.stateNode=n)}return null;case 13:return Xn(ii),n=e.memoizedState,(e.flags&64)!=0?(e.lanes=t,e):(n=n!==null,t=!1,i===null?e.memoizedProps.fallback!==void 0&&Ym(e):t=i.memoizedState!==null,n&&!t&&(e.mode&2)!=0&&(i===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(ii.current&1)!=0?Oi===0&&(Oi=3):((Oi===0||Oi===3)&&(Oi=4),Wr===null||(XI&134217727)==0&&(fd&134217727)==0||Cd(Wr,ur))),(n||t)&&(e.flags|=4),null);case 4:return ud(),LG(e),i===null&&W5(e.stateNode.containerInfo),null;case 10:return bG(e),null;case 17:return Jr(e.type)&&Mm(),null;case 19:if(Xn(ii),n=e.memoizedState,n===null)return null;if(s=(e.flags&64)!=0,o=n.rendering,o===null)if(s)TI(n,!1);else{if(Oi!==0||i!==null&&(i.flags&64)!=0)for(i=e.child;i!==null;){if(o=km(i),o!==null){for(e.flags|=64,TI(n,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),n.lastEffect===null&&(e.firstEffect=null),e.lastEffect=n.lastEffect,n=t,t=e.child;t!==null;)s=t,i=n,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,o=s.alternate,o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return ni(ii,ii.current&1|2),e.child}i=i.sibling}n.tail!==null&&cr()>JG&&(e.flags|=64,s=!0,TI(n,!1),e.lanes=33554432)}else{if(!s)if(i=km(o),i!==null){if(e.flags|=64,s=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),TI(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!Xo)return e=e.lastEffect=n.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*cr()-n.renderingStartTime>JG&&t!==1073741824&&(e.flags|=64,s=!0,TI(n,!1),e.lanes=33554432);n.isBackwards?(o.sibling=e.child,e.child=o):(t=n.last,t!==null?t.sibling=o:e.child=o,n.last=o)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.lastEffect=e.lastEffect,n.renderingStartTime=cr(),t.sibling=null,e=ii.current,ni(ii,s?e&1|2:e&1),t):null;case 23:case 24:return t2(),i!==null&&i.memoizedState!==null!=(e.memoizedState!==null)&&n.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(qe(156,e.tag))}function YD(i){switch(i.tag){case 1:Jr(i.type)&&Mm();var e=i.flags;return e&4096?(i.flags=e&-4097|64,i):null;case 3:if(ud(),Xn(Or),Xn(lr),SG(),e=i.flags,(e&64)!=0)throw Error(qe(285));return i.flags=e&-4097|64,i;case 5:return wG(i),null;case 13:return Xn(ii),e=i.flags,e&4096?(i.flags=e&-4097|64,i):null;case 19:return Xn(ii),null;case 4:return ud(),null;case 10:return bG(i),null;case 23:case 24:return t2(),null;default:return null}}function TG(i,e){try{var t="",n=e;do t+=xP(n),n=n.return;while(n);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:e,stack:r}}function XG(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var KD=typeof WeakMap=="function"?WeakMap:Map;function F_(i,e,t){t=Fl(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){qm||(qm=!0,QG=n),XG(i,e)},t}function L_(i,e,t){t=Fl(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return XG(i,e),n(r)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){typeof n!="function"&&(ko===null?ko=new Set([this]):ko.add(this),XG(i,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}var PD=typeof WeakSet=="function"?WeakSet:Set;function T_(i){var e=i.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(t){Kl(i,t)}else e.current=null}function DD(i,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&i!==null){var t=i.memoizedProps,n=i.memoizedState;i=e.stateNode,e=i.getSnapshotBeforeUpdate(e.elementType===e.type?t:oo(e.type,t),n),i.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&gG(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(qe(163))}function UD(i,e,t){switch(t.tag){case 0:case 11:case 15:case 22:if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){i=e=e.next;do{if((i.tag&3)==3){var n=i.create;i.destroy=n()}i=i.next}while(i!==e)}if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){i=e=e.next;do{var r=i;n=r.next,r=r.tag,(r&4)!=0&&(r&1)!=0&&(eV(t,i),t4(t,i)),i=n}while(i!==e)}return;case 1:i=t.stateNode,t.flags&4&&(e===null?i.componentDidMount():(n=t.elementType===t.type?e.memoizedProps:oo(t.type,e.memoizedProps),i.componentDidUpdate(n,e.memoizedState,i.__reactInternalSnapshotBeforeUpdate))),e=t.updateQueue,e!==null&&t_(t,e,i);return;case 3:if(e=t.updateQueue,e!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}t_(t,e,i)}return;case 5:i=t.stateNode,e===null&&t.flags&4&&H5(t.type,t.memoizedProps)&&i.focus();return;case 6:return;case 4:return;case 12:return;case 13:t.memoizedState===null&&(t=t.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&jW(t))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(qe(163))}function X_(i,e){for(var t=i;;){if(t.tag===5){var n=t.stateNode;if(e)n=n.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none";else{n=t.stateNode;var r=t.memoizedProps.style;r=r!=null&&r.hasOwnProperty("display")?r.display:null,n.style.display=NW("display",r)}}else if(t.tag===6)t.stateNode.nodeValue=e?"":t.memoizedProps;else if((t.tag!==23&&t.tag!==24||t.memoizedState===null||t===i)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return;t=t.return}t.sibling.return=t.return,t=t.sibling}}function z_(i,e){if(dg&&typeof dg.onCommitFiberUnmount=="function")try{dg.onCommitFiberUnmount(hG,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(i=e.updateQueue,i!==null&&(i=i.lastEffect,i!==null)){var t=i=i.next;do{var n=t,r=n.destroy;if(n=n.tag,r!==void 0)if((n&4)!=0)eV(e,t);else{n=e;try{r()}catch(s){Kl(n,s)}}t=t.next}while(t!==i)}break;case 1:if(T_(e),i=e.stateNode,typeof i.componentWillUnmount=="function")try{i.props=e.memoizedProps,i.state=e.memoizedState,i.componentWillUnmount()}catch(s){Kl(e,s)}break;case 5:T_(e);break;case 4:P_(i,e)}}function k_(i){i.alternate=null,i.child=null,i.dependencies=null,i.firstEffect=null,i.lastEffect=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.return=null,i.updateQueue=null}function Y_(i){return i.tag===5||i.tag===3||i.tag===4}function K_(i){e:{for(var e=i.return;e!==null;){if(Y_(e))break e;e=e.return}throw Error(qe(160))}var t=e;switch(e=t.stateNode,t.tag){case 5:var n=!1;break;case 3:e=e.containerInfo,n=!0;break;case 4:e=e.containerInfo,n=!0;break;default:throw Error(qe(161))}t.flags&16&&(oI(e,""),t.flags&=-17);e:t:for(t=i;;){for(;t.sibling===null;){if(t.return===null||Y_(t.return)){t=null;break e}t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2)){t=t.stateNode;break e}}n?zG(i,t,e):kG(i,t,e)}function zG(i,e,t){var n=i.tag,r=n===5||n===6;if(r)i=r?i.stateNode:i.stateNode.instance,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bm));else if(n!==4&&(i=i.child,i!==null))for(zG(i,e,t),i=i.sibling;i!==null;)zG(i,e,t),i=i.sibling}function kG(i,e,t){var n=i.tag,r=n===5||n===6;if(r)i=r?i.stateNode:i.stateNode.instance,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(kG(i,e,t),i=i.sibling;i!==null;)kG(i,e,t),i=i.sibling}function P_(i,e){for(var t=e,n=!1,r,s;;){if(!n){n=t.return;e:for(;;){if(n===null)throw Error(qe(160));switch(r=n.stateNode,n.tag){case 5:s=!1;break e;case 3:r=r.containerInfo,s=!0;break e;case 4:r=r.containerInfo,s=!0;break e}n=n.return}n=!0}if(t.tag===5||t.tag===6){e:for(var o=i,a=t,l=a;;)if(z_(o,l),l.child!==null&&l.tag!==4)l.child.return=l,l=l.child;else{if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}s?(o=r,a=t.stateNode,o.nodeType===8?o.parentNode.removeChild(a):o.removeChild(a)):r.removeChild(t.stateNode)}else if(t.tag===4){if(t.child!==null){r=t.stateNode.containerInfo,s=!0,t.child.return=t,t=t.child;continue}}else if(z_(i,t),t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return,t.tag===4&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function YG(i,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var t=e.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do(n.tag&3)==3&&(i=n.destroy,n.destroy=void 0,i!==void 0&&i()),n=n.next;while(n!==t)}return;case 1:return;case 5:if(t=e.stateNode,t!=null){n=e.memoizedProps;var r=i!==null?i.memoizedProps:n;i=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(t[Zm]=n,i==="input"&&n.type==="radio"&&n.name!=null&&SW(t,n),Mw(i,r),e=Mw(i,n),r=0;r<s.length;r+=2){var o=s[r],a=s[r+1];o==="style"?EW(t,a):o==="dangerouslySetInnerHTML"?VW(t,a):o==="children"?oI(t,a):uw(t,o,a,e)}switch(i){case"input":xw(t,n);break;case"textarea":MW(t,n);break;case"select":i=t._wrapperState.wasMultiple,t._wrapperState.wasMultiple=!!n.multiple,s=n.value,s!=null?Uu(t,!!n.multiple,s,!1):i!==!!n.multiple&&(n.defaultValue!=null?Uu(t,!!n.multiple,n.defaultValue,!0):Uu(t,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(qe(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:t=e.stateNode,t.hydrate&&(t.hydrate=!1,jW(t.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(OG=cr(),X_(e.child,!0)),D_(e);return;case 19:D_(e);return;case 17:return;case 23:case 24:X_(e,e.memoizedState!==null);return}throw Error(qe(163))}function D_(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new PD),e.forEach(function(n){var r=r4.bind(null,i,n);t.has(n)||(t.add(n),n.then(r,r))})}}function OD(i,e){return i!==null&&(i=i.memoizedState,i===null||i.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var JD=Math.ceil,Qm=og.ReactCurrentDispatcher,KG=og.ReactCurrentOwner,Tt=0,Wr=null,wi=null,ur=0,pg=0,PG=Nl(0),Oi=0,jm=null,hd=0,XI=0,fd=0,DG=0,UG=null,OG=0,JG=1/0;function Id(){JG=cr()+500}var Ct=null,qm=!1,QG=null,ko=null,Xl=!1,zI=null,kI=90,jG=[],qG=[],Na=null,YI=0,$G=null,$m=-1,Ea=0,eA=0,KI=null,tA=!1;function Is(){return(Tt&48)!=0?cr():$m!==-1?$m:$m=cr()}function zl(i){if(i=i.mode,(i&2)==0)return 1;if((i&4)==0)return ld()===99?1:2;if(Ea===0&&(Ea=hd),HD.transition!==0){eA!==0&&(eA=UG!==null?UG.pendingLanes:0),i=Ea;var e=4186112&~eA;return e&=-e,e===0&&(i=4186112&~i,e=i&-i,e===0&&(e=8192)),e}return i=ld(),(Tt&4)!=0&&i===98?i=pm(12,Ea):(i=TP(i),i=pm(i,Ea)),i}function kl(i,e,t){if(50<YI)throw YI=0,$G=null,Error(qe(185));if(i=nA(i,e),i===null)return null;mm(i,e,t),i===Wr&&(fd|=e,Oi===4&&Cd(i,ur));var n=ld();e===1?(Tt&8)!=0&&(Tt&48)==0?e2(i):(zs(i,t),Tt===0&&(Id(),Lo())):((Tt&4)==0||n!==98&&n!==99||(Na===null?Na=new Set([i]):Na.add(i)),zs(i,t)),UG=i}function nA(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}function zs(i,e){for(var t=i.callbackNode,n=i.suspendedLanes,r=i.pingedLanes,s=i.expirationTimes,o=i.pendingLanes;0<o;){var a=31-Wl(o),l=1<<a,c=s[a];if(c===-1){if((l&n)==0||(l&r)!=0){c=e,ju(l);var g=En;s[a]=10<=g?c+250:6<=g?c+5e3:-1}}else c<=e&&(i.expiredLanes|=l);o&=~l}if(n=CI(i,i===Wr?ur:0),e=En,n===0)t!==null&&(t!==pG&&IG(t),i.callbackNode=null,i.callbackPriority=0);else{if(t!==null){if(i.callbackPriority===e)return;t!==pG&&IG(t)}e===15?(t=e2.bind(null,i),Wa===null?(Wa=[t],Vm=fG(_m,j5)):Wa.push(t),t=pG):e===14?t=SI(99,e2.bind(null,i)):(t=XP(e),t=SI(t,U_.bind(null,i))),i.callbackPriority=e,i.callbackNode=t}}function U_(i){if($m=-1,eA=Ea=0,(Tt&48)!=0)throw Error(qe(327));var e=i.callbackNode;if(Yl()&&i.callbackNode!==e)return null;var t=CI(i,i===Wr?ur:0);if(t===0)return null;var n=t,r=Tt;Tt|=16;var s=j_();(Wr!==i||ur!==n)&&(Id(),pd(i,n));do try{qD();break}catch(a){Q_(i,a)}while(1);if(AG(),Qm.current=s,Tt=r,wi!==null?n=0:(Wr=null,ur=0,n=Oi),(hd&fd)!=0)pd(i,0);else if(n!==0){if(n===2&&(Tt|=64,i.hydrate&&(i.hydrate=!1,gG(i.containerInfo)),t=r5(i),t!==0&&(n=PI(i,t))),n===1)throw e=jm,pd(i,0),Cd(i,t),zs(i,cr()),e;switch(i.finishedWork=i.current.alternate,i.finishedLanes=t,n){case 0:case 1:throw Error(qe(345));case 2:mg(i);break;case 3:if(Cd(i,t),(t&62914560)===t&&(n=OG+500-cr(),10<n)){if(CI(i,0)!==0)break;if(r=i.suspendedLanes,(r&t)!==t){Is(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=F5(mg.bind(null,i),n);break}mg(i);break;case 4:if(Cd(i,t),(t&4186112)===t)break;for(n=i.eventTimes,r=-1;0<t;){var o=31-Wl(t);s=1<<o,o=n[o],o>r&&(r=o),t&=~s}if(t=r,t=cr()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*JD(t/1960))-t,10<t){i.timeoutHandle=F5(mg.bind(null,i),t);break}mg(i);break;case 5:mg(i);break;default:throw Error(qe(329))}}return zs(i,cr()),i.callbackNode===e?U_.bind(null,i):null}function Cd(i,e){for(e&=~DG,e&=~fd,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Wl(e),n=1<<t;i[t]=-1,e&=~n}}function e2(i){if((Tt&48)!=0)throw Error(qe(327));if(Yl(),i===Wr&&(i.expiredLanes&ur)!=0){var e=ur,t=PI(i,e);(hd&fd)!=0&&(e=CI(i,e),t=PI(i,e))}else e=CI(i,0),t=PI(i,e);if(i.tag!==0&&t===2&&(Tt|=64,i.hydrate&&(i.hydrate=!1,gG(i.containerInfo)),e=r5(i),e!==0&&(t=PI(i,e))),t===1)throw t=jm,pd(i,0),Cd(i,e),zs(i,cr()),t;return i.finishedWork=i.current.alternate,i.finishedLanes=e,mg(i),zs(i,cr()),null}function QD(){if(Na!==null){var i=Na;Na=null,i.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,zs(e,cr())})}Lo()}function O_(i,e){var t=Tt;Tt|=1;try{return i(e)}finally{Tt=t,Tt===0&&(Id(),Lo())}}function J_(i,e){var t=Tt;Tt&=-2,Tt|=8;try{return i(e)}finally{Tt=t,Tt===0&&(Id(),Lo())}}function iA(i,e){ni(PG,pg),pg|=e,hd|=e}function t2(){pg=PG.current,Xn(PG)}function pd(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,MD(t)),wi!==null)for(t=wi.return;t!==null;){var n=t;switch(n.tag){case 1:n=n.type.childContextTypes,n!=null&&Mm();break;case 3:ud(),Xn(Or),Xn(lr),SG();break;case 5:wG(n);break;case 4:ud();break;case 13:Xn(ii);break;case 19:Xn(ii);break;case 10:bG(n);break;case 23:case 24:t2()}t=t.return}Wr=i,wi=Pl(i.current,null),ur=pg=hd=e,Oi=0,jm=null,DG=fd=XI=0}function Q_(i,e){do{var t=wi;try{if(AG(),VI.current=Om,Km){for(var n=ai.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}Km=!1}if(NI=0,Ui=gr=ai=null,EI=!1,KG.current=null,t===null||t.return===null){Oi=1,jm=e,wi=null;break}e:{var s=i,o=t.return,a=t,l=e;if(e=ur,a.flags|=2048,a.firstEffect=a.lastEffect=null,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l;if((a.mode&2)==0){var g=a.alternate;g?(a.updateQueue=g.updateQueue,a.memoizedState=g.memoizedState,a.lanes=g.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=(ii.current&1)!=0,u=o;do{var h;if(h=u.tag===13){var p=u.memoizedState;if(p!==null)h=p.dehydrated!==null;else{var b=u.memoizedProps;h=b.fallback===void 0?!1:b.unstable_avoidThisFallback!==!0?!0:!d}}if(h){var y=u.updateQueue;if(y===null){var m=new Set;m.add(c),u.updateQueue=m}else y.add(c);if((u.mode&2)==0){if(u.flags|=64,a.flags|=16384,a.flags&=-2981,a.tag===1)if(a.alternate===null)a.tag=17;else{var f=Fl(-1,1);f.tag=2,Ll(a,f)}a.lanes|=1;break e}l=void 0,a=e;var G=s.pingCache;if(G===null?(G=s.pingCache=new KD,l=new Set,G.set(c,l)):(l=G.get(c),l===void 0&&(l=new Set,G.set(c,l))),!l.has(a)){l.add(a);var x=i4.bind(null,s,c,a);c.then(x,x)}u.flags|=4096,u.lanes=e;break e}u=u.return}while(u!==null);l=Error((Du(a.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Oi!==5&&(Oi=2),l=TG(l,a),u=o;do{switch(u.tag){case 3:s=l,u.flags|=4096,e&=-e,u.lanes|=e;var B=F_(u,s,e);e_(u,B);break e;case 1:s=l;var M=u.type,E=u.stateNode;if((u.flags&64)==0&&(typeof M.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ko===null||!ko.has(E)))){u.flags|=4096,e&=-e,u.lanes|=e;var z=L_(u,s,e);e_(u,z);break e}}u=u.return}while(u!==null)}$_(t)}catch(J){e=J,wi===t&&t!==null&&(wi=t=t.return);continue}break}while(1)}function j_(){var i=Qm.current;return Qm.current=Om,i===null?Om:i}function PI(i,e){var t=Tt;Tt|=16;var n=j_();Wr===i&&ur===e||pd(i,e);do try{jD();break}catch(r){Q_(i,r)}while(1);if(AG(),Tt=t,Qm.current=n,wi!==null)throw Error(qe(261));return Wr=null,ur=0,Oi}function jD(){for(;wi!==null;)q_(wi)}function qD(){for(;wi!==null&&!VD();)q_(wi)}function q_(i){var e=nV(i.alternate,i,pg);i.memoizedProps=i.pendingProps,e===null?$_(i):wi=e,KG.current=null}function $_(i){var e=i;do{var t=e.alternate;if(i=e.return,(e.flags&2048)==0){if(t=kD(t,e,pg),t!==null){wi=t;return}if(t=e,t.tag!==24&&t.tag!==23||t.memoizedState===null||(pg&1073741824)!=0||(t.mode&4)==0){for(var n=0,r=t.child;r!==null;)n|=r.lanes|r.childLanes,r=r.sibling;t.childLanes=n}i!==null&&(i.flags&2048)==0&&(i.firstEffect===null&&(i.firstEffect=e.firstEffect),e.lastEffect!==null&&(i.lastEffect!==null&&(i.lastEffect.nextEffect=e.firstEffect),i.lastEffect=e.lastEffect),1<e.flags&&(i.lastEffect!==null?i.lastEffect.nextEffect=e:i.firstEffect=e,i.lastEffect=e))}else{if(t=YD(e),t!==null){t.flags&=2047,wi=t;return}i!==null&&(i.firstEffect=i.lastEffect=null,i.flags|=2048)}if(e=e.sibling,e!==null){wi=e;return}wi=e=i}while(e!==null);Oi===0&&(Oi=5)}function mg(i){var e=ld();return hg(99,$D.bind(null,i,e)),null}function $D(i,e){do Yl();while(zI!==null);if((Tt&48)!=0)throw Error(qe(327));var t=i.finishedWork;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(qe(177));i.callbackNode=null;var n=t.lanes|t.childLanes,r=n,s=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r,r=i.entanglements;for(var o=i.eventTimes,a=i.expirationTimes;0<s;){var l=31-Wl(s),c=1<<l;r[l]=0,o[l]=-1,a[l]=-1,s&=~c}if(Na!==null&&(n&24)==0&&Na.has(i)&&Na.delete(i),i===Wr&&(wi=Wr=null,ur=0),1<t.flags?t.lastEffect!==null?(t.lastEffect.nextEffect=t,n=t.firstEffect):n=t:n=t.firstEffect,n!==null){if(r=Tt,Tt|=32,KG.current=null,aG=Am,o=w5(),iG(o)){if("selectionStart"in o)a={start:o.selectionStart,end:o.selectionEnd};else e:if(a=(a=o.ownerDocument)&&a.defaultView||window,(c=a.getSelection&&a.getSelection())&&c.rangeCount!==0){a=c.anchorNode,s=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{a.nodeType,l.nodeType}catch{a=null;break e}var g=0,d=-1,u=-1,h=0,p=0,b=o,y=null;t:for(;;){for(var m;b!==a||s!==0&&b.nodeType!==3||(d=g+s),b!==l||c!==0&&b.nodeType!==3||(u=g+c),b.nodeType===3&&(g+=b.nodeValue.length),(m=b.firstChild)!==null;)y=b,b=m;for(;;){if(b===o)break t;if(y===a&&++h===s&&(d=g),y===l&&++p===c&&(u=g),(m=b.nextSibling)!==null)break;b=y,y=b.parentNode}b=m}a=d===-1||u===-1?null:{start:d,end:u}}else a=null;a=a||{start:0,end:0}}else a=null;lG={focusedElem:o,selectionRange:a},Am=!1,KI=null,tA=!1,Ct=n;do try{e4()}catch(J){if(Ct===null)throw Error(qe(330));Kl(Ct,J),Ct=Ct.nextEffect}while(Ct!==null);KI=null,Ct=n;do try{for(o=i;Ct!==null;){var f=Ct.flags;if(f&16&&oI(Ct.stateNode,""),f&128){var G=Ct.alternate;if(G!==null){var x=G.ref;x!==null&&(typeof x=="function"?x(null):x.current=null)}}switch(f&1038){case 2:K_(Ct),Ct.flags&=-3;break;case 6:K_(Ct),Ct.flags&=-3,YG(Ct.alternate,Ct);break;case 1024:Ct.flags&=-1025;break;case 1028:Ct.flags&=-1025,YG(Ct.alternate,Ct);break;case 4:YG(Ct.alternate,Ct);break;case 8:a=Ct,P_(o,a);var B=a.alternate;k_(a),B!==null&&k_(B)}Ct=Ct.nextEffect}}catch(J){if(Ct===null)throw Error(qe(330));Kl(Ct,J),Ct=Ct.nextEffect}while(Ct!==null);if(x=lG,G=w5(),f=x.focusedElem,o=x.selectionRange,G!==f&&f&&f.ownerDocument&&x5(f.ownerDocument.documentElement,f)){for(o!==null&&iG(f)&&(G=o.start,x=o.end,x===void 0&&(x=G),"selectionStart"in f?(f.selectionStart=G,f.selectionEnd=Math.min(x,f.value.length)):(x=(G=f.ownerDocument||document)&&G.defaultView||window,x.getSelection&&(x=x.getSelection(),a=f.textContent.length,B=Math.min(o.start,a),o=o.end===void 0?B:Math.min(o.end,a),!x.extend&&B>o&&(a=o,o=B,B=a),a=v5(f,B),s=v5(f,o),a&&s&&(x.rangeCount!==1||x.anchorNode!==a.node||x.anchorOffset!==a.offset||x.focusNode!==s.node||x.focusOffset!==s.offset)&&(G=G.createRange(),G.setStart(a.node,a.offset),x.removeAllRanges(),B>o?(x.addRange(G),x.extend(s.node,s.offset)):(G.setEnd(s.node,s.offset),x.addRange(G)))))),G=[],x=f;x=x.parentNode;)x.nodeType===1&&G.push({element:x,left:x.scrollLeft,top:x.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<G.length;f++)x=G[f],x.element.scrollLeft=x.left,x.element.scrollTop=x.top}Am=!!aG,lG=aG=null,i.current=t,Ct=n;do try{for(f=i;Ct!==null;){var M=Ct.flags;if(M&36&&UD(f,Ct.alternate,Ct),M&128){G=void 0;var E=Ct.ref;if(E!==null){var z=Ct.stateNode;switch(Ct.tag){case 5:G=z;break;default:G=z}typeof E=="function"?E(G):E.current=G}}Ct=Ct.nextEffect}}catch(J){if(Ct===null)throw Error(qe(330));Kl(Ct,J),Ct=Ct.nextEffect}while(Ct!==null);Ct=null,ED(),Tt=r}else i.current=t;if(Xl)Xl=!1,zI=i,kI=e;else for(Ct=n;Ct!==null;)e=Ct.nextEffect,Ct.nextEffect=null,Ct.flags&8&&(M=Ct,M.sibling=null,M.stateNode=null),Ct=e;if(n=i.pendingLanes,n===0&&(ko=null),n===1?i===$G?YI++:(YI=0,$G=i):YI=0,t=t.stateNode,dg&&typeof dg.onCommitFiberRoot=="function")try{dg.onCommitFiberRoot(hG,t,void 0,(t.current.flags&64)==64)}catch{}if(zs(i,cr()),qm)throw qm=!1,i=QG,QG=null,i;return(Tt&8)!=0||Lo(),null}function e4(){for(;Ct!==null;){var i=Ct.alternate;tA||KI===null||((Ct.flags&8)!=0?KW(Ct,KI)&&(tA=!0):Ct.tag===13&&OD(i,Ct)&&KW(Ct,KI)&&(tA=!0));var e=Ct.flags;(e&256)!=0&&DD(i,Ct),(e&512)==0||Xl||(Xl=!0,SI(97,function(){return Yl(),null})),Ct=Ct.nextEffect}}function Yl(){if(kI!==90){var i=97<kI?97:kI;return kI=90,hg(i,n4)}return!1}function t4(i,e){jG.push(e,i),Xl||(Xl=!0,SI(97,function(){return Yl(),null}))}function eV(i,e){qG.push(e,i),Xl||(Xl=!0,SI(97,function(){return Yl(),null}))}function n4(){if(zI===null)return!1;var i=zI;if(zI=null,(Tt&48)!=0)throw Error(qe(331));var e=Tt;Tt|=32;var t=qG;qG=[];for(var n=0;n<t.length;n+=2){var r=t[n],s=t[n+1],o=r.destroy;if(r.destroy=void 0,typeof o=="function")try{o()}catch(l){if(s===null)throw Error(qe(330));Kl(s,l)}}for(t=jG,jG=[],n=0;n<t.length;n+=2){r=t[n],s=t[n+1];try{var a=r.create;r.destroy=a()}catch(l){if(s===null)throw Error(qe(330));Kl(s,l)}}for(a=i.current.firstEffect;a!==null;)i=a.nextEffect,a.nextEffect=null,a.flags&8&&(a.sibling=null,a.stateNode=null),a=i;return Tt=e,Lo(),!0}function tV(i,e,t){e=TG(t,e),e=F_(i,e,1),Ll(i,e),e=Is(),i=nA(i,1),i!==null&&(mm(i,1,e),zs(i,e))}function Kl(i,e){if(i.tag===3)tV(i,i,e);else for(var t=i.return;t!==null;){if(t.tag===3){tV(t,i,e);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(ko===null||!ko.has(n))){i=TG(e,i);var r=L_(t,i,1);if(Ll(t,r),r=Is(),t=nA(t,1),t!==null)mm(t,1,r),zs(t,r);else if(typeof n.componentDidCatch=="function"&&(ko===null||!ko.has(n)))try{n.componentDidCatch(e,i)}catch{}break}}t=t.return}}function i4(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=Is(),i.pingedLanes|=i.suspendedLanes&t,Wr===i&&(ur&t)===t&&(Oi===4||Oi===3&&(ur&62914560)===ur&&500>cr()-OG?pd(i,0):DG|=t),zs(i,e)}function r4(i,e){var t=i.stateNode;t!==null&&t.delete(e),e=0,e===0&&(e=i.mode,(e&2)==0?e=1:(e&4)==0?e=ld()===99?1:2:(Ea===0&&(Ea=hd),e=qu(62914560&~Ea),e===0&&(e=4194304))),t=Is(),i=nA(i,e),i!==null&&(mm(i,e,t),zs(i,t))}var nV;nV=function(i,e,t){var n=e.lanes;if(i!==null)if(i.memoizedProps!==e.pendingProps||Or.current)ao=!0;else if((t&n)!=0)ao=(i.flags&16384)!=0;else{switch(ao=!1,e.tag){case 3:S_(e),BG();break;case 5:l_(e);break;case 1:Jr(e.type)&&Wm(e);break;case 4:xG(e,e.stateNode.containerInfo);break;case 10:n=e.memoizedProps.value;var r=e.type._context;ni(Nm,r._currentValue),r._currentValue=n;break;case 13:if(e.memoizedState!==null)return(t&e.child.childLanes)!=0?Z_(i,e,t):(ni(ii,ii.current&1),e=Va(i,e,t),e!==null?e.sibling:null);ni(ii,ii.current&1);break;case 19:if(n=(t&e.childLanes)!=0,(i.flags&64)!=0){if(n)return V_(i,e,t);e.flags|=64}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ni(ii,ii.current),n)break;return null;case 23:case 24:return e.lanes=0,NG(i,e,t)}return Va(i,e,t)}else ao=!1;switch(e.lanes=0,e.tag){case 2:if(n=e.type,i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2),i=e.pendingProps,r=ad(e,lr.current),gd(e,t),r=RG(null,e,n,i,r,t),e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,Jr(n)){var s=!0;Wm(e)}else s=!1;e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,yG(e);var o=n.getDerivedStateFromProps;typeof o=="function"&&Fm(e,n,o,i),r.updater=Lm,e.stateNode=r,r._reactInternals=e,vG(e,n,i,t),e=HG(null,e,n,!0,s,t)}else e.tag=0,jr(null,e,r,t),e=e.child;return e;case 16:r=e.elementType;e:{switch(i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2),i=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=o4(r),i=oo(r,i),s){case 0:e=EG(null,e,r,i,t);break e;case 1:e=B_(null,e,r,i,t);break e;case 11:e=v_(null,e,r,i,t);break e;case 14:e=x_(null,e,r,oo(r.type,i),n,t);break e}throw Error(qe(306,r,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:oo(n,r),EG(i,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:oo(n,r),B_(i,e,n,r,t);case 3:if(S_(e),n=e.updateQueue,i===null||n===null)throw Error(qe(282));if(n=e.pendingProps,r=e.memoizedState,r=r!==null?r.element:null,$5(i,e),ZI(e,n,null,t),n=e.memoizedState.element,n===r)BG(),e=Va(i,e,t);else{if(r=e.stateNode,(s=r.hydrate)&&(Tl=id(e.stateNode.containerInfo.firstChild),_a=e,s=Xo=!0),s){if(i=r.mutableSourceEagerHydrationData,i!=null)for(r=0;r<i.length;r+=2)s=i[r],s._workInProgressVersionPrimary=i[r+1],dd.push(s);for(t=a_(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|1024,t=t.sibling}else jr(i,e,n,t),BG();e=e.child}return e;case 5:return l_(e),i===null&&GG(e),n=e.type,r=e.pendingProps,s=i!==null?i.memoizedProps:null,o=r.children,cG(n,r)?o=null:s!==null&&cG(n,s)&&(e.flags|=16),G_(i,e),jr(i,e,o,t),e.child;case 6:return i===null&&GG(e),null;case 13:return Z_(i,e,t);case 4:return xG(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=zm(e,null,n,t):jr(i,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:oo(n,r),v_(i,e,n,r,t);case 7:return jr(i,e,e.pendingProps,t),e.child;case 8:return jr(i,e,e.pendingProps.children,t),e.child;case 12:return jr(i,e,e.pendingProps.children,t),e.child;case 10:e:{n=e.type._context,r=e.pendingProps,o=e.memoizedProps,s=r.value;var a=e.type._context;if(ni(Nm,a._currentValue),a._currentValue=s,o!==null)if(a=o.value,s=Ls(a,s)?0:(typeof n._calculateChangedBits=="function"?n._calculateChangedBits(a,s):1073741823)|0,s===0){if(o.children===r.children&&!Or.current){e=Va(i,e,t);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===n&&(c.observedBits&s)!=0){a.tag===1&&(c=Fl(-1,t&-t),c.tag=2,Ll(a,c)),a.lanes|=t,c=a.alternate,c!==null&&(c.lanes|=t),q5(a.return,t),l.lanes|=t;break}c=c.next}}else o=a.tag===10&&a.type===e.type?null:a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}jr(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps,n=s.children,gd(e,t),r=Ts(r,s.unstable_observedBits),n=n(r),e.flags|=1,jr(i,e,n,t),e.child;case 14:return r=e.type,s=oo(r,e.pendingProps),s=oo(r.type,s),x_(i,e,r,s,n,t);case 15:return w_(i,e,e.type,e.pendingProps,n,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:oo(n,r),i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,Jr(n)?(i=!0,Wm(e)):i=!1,gd(e,t),r_(e,n,r),vG(e,n,r,t),HG(null,e,n,!0,i,t);case 19:return V_(i,e,t);case 23:return NG(i,e,t);case 24:return NG(i,e,t)}throw Error(qe(156,e.tag))};function s4(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(i,e,t,n){return new s4(i,e,t,n)}function n2(i){return i=i.prototype,!(!i||!i.isReactComponent)}function o4(i){if(typeof i=="function")return n2(i)?1:0;if(i!=null){if(i=i.$$typeof,i===sm)return 11;if(i===am)return 14}return 2}function Pl(i,e){var t=i.alternate;return t===null?(t=ks(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.nextEffect=null,t.firstEffect=null,t.lastEffect=null),t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function rA(i,e,t,n,r,s){var o=2;if(n=i,typeof i=="function")n2(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case Bl:return md(t.children,r,s,e);case vW:o=8,r|=16;break;case dw:o=8,r|=1;break;case nI:return i=ks(12,t,e,r|8),i.elementType=nI,i.type=nI,i.lanes=s,i;case iI:return i=ks(13,t,e,r),i.type=iI,i.elementType=iI,i.lanes=s,i;case om:return i=ks(19,t,e,r),i.elementType=om,i.lanes=s,i;case mw:return i2(t,r,s,e);case Aw:return i=ks(24,t,e,r),i.elementType=Aw,i.lanes=s,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case hw:o=10;break e;case fw:o=9;break e;case sm:o=11;break e;case am:o=14;break e;case Iw:o=16,n=null;break e;case Cw:o=22;break e}throw Error(qe(130,i==null?i:typeof i,""))}return e=ks(o,t,e,r),e.elementType=i,e.type=n,e.lanes=s,e}function md(i,e,t,n){return i=ks(7,i,n,e),i.lanes=t,i}function i2(i,e,t,n){return i=ks(23,i,n,e),i.elementType=mw,i.lanes=t,i}function r2(i,e,t){return i=ks(6,i,null,e),i.lanes=t,i}function s2(i,e,t){return e=ks(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function a4(i,e,t){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=t,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Pw(0),this.expirationTimes=Pw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pw(0),this.mutableSourceEagerHydrationData=null}function l4(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ag,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function sA(i,e,t,n){var r=e.current,s=Is(),o=zl(r);e:if(t){t=t._reactInternals;t:{if(cg(t)!==t||t.tag!==1)throw Error(qe(170));var a=t;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(Jr(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(a!==null);throw Error(qe(171))}if(t.tag===1){var l=t.type;if(Jr(l)){t=k5(t,l,a);break e}}t=a}else t=El;return e.context===null?e.context=t:e.pendingContext=t,e=Fl(s,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),Ll(r,e),kl(r,o,s),o}function o2(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function iV(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function a2(i,e){iV(i,e),(i=i.alternate)&&iV(i,e)}function c4(){return null}function l2(i,e,t){var n=t!=null&&t.hydrationOptions!=null&&t.hydrationOptions.mutableSources||null;if(t=new a4(i,e,t!=null&&t.hydrate===!0),e=ks(3,null,null,e===2?7:e===1?3:0),t.current=e,e.stateNode=t,yG(e),i[rd]=t.current,W5(i.nodeType===8?i.parentNode:i),n)for(i=0;i<n.length;i++){e=n[i];var r=e._getVersion;r=r(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,r]:t.mutableSourceEagerHydrationData.push(e,r)}this._internalRoot=t}l2.prototype.render=function(i){sA(i,this._internalRoot,null,null)};l2.prototype.unmount=function(){var i=this._internalRoot,e=i.containerInfo;sA(null,i,null,function(){e[rd]=null})};function DI(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function g4(i,e){if(e||(e=i?i.nodeType===9?i.documentElement:i.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var t;t=i.lastChild;)i.removeChild(t);return new l2(i,0,e?{hydrate:!0}:void 0)}function oA(i,e,t,n,r){var s=t._reactRootContainer;if(s){var o=s._internalRoot;if(typeof r=="function"){var a=r;r=function(){var c=o2(o);a.call(c)}}sA(e,o,i,r)}else{if(s=t._reactRootContainer=g4(t,n),o=s._internalRoot,typeof r=="function"){var l=r;r=function(){var c=o2(o);l.call(c)}}J_(function(){sA(e,o,i,r)})}return o2(o)}PW=function(i){if(i.tag===13){var e=Is();kl(i,4,e),a2(i,4)}};Tw=function(i){if(i.tag===13){var e=Is();kl(i,67108864,e),a2(i,67108864)}};DW=function(i){if(i.tag===13){var e=Is(),t=zl(i);kl(i,t,e),a2(i,t)}};UW=function(i,e){return e()};_w=function(i,e,t){switch(e){case"input":if(xw(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var r=Rm(n);if(!r)throw Error(qe(90));GW(n),xw(n,r)}}}break;case"textarea":MW(i,t);break;case"select":e=t.value,e!=null&&Uu(i,!!t.multiple,e,!1)}};Vw=O_;TW=function(i,e,t,n,r){var s=Tt;Tt|=4;try{return hg(98,i.bind(null,e,t,n,r))}finally{Tt=s,Tt===0&&(Id(),Lo())}};Nw=function(){(Tt&49)==0&&(QD(),Yl())};XW=function(i,e){var t=Tt;Tt|=2;try{return i(e)}finally{Tt=t,Tt===0&&(Id(),Lo())}};function rV(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!DI(e))throw Error(qe(200));return l4(i,e,null,t)}var u4={Events:[BI,sd,Rm,FW,LW,Yl,{current:!1}]},UI={findFiberByHostInstance:gg,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},d4={bundleType:UI.bundleType,version:UI.version,rendererPackageName:UI.rendererPackageName,rendererConfig:UI.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:og.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=YW(i),i===null?null:i.stateNode},findFiberByHostInstance:UI.findFiberByHostInstance||c4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var aA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!aA.isDisabled&&aA.supportsFiber)try{hG=aA.inject(d4),dg=aA}catch{}}Fs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u4;Fs.createPortal=rV;Fs.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(qe(188)):Error(qe(268,Object.keys(i)));return i=YW(e),i=i===null?null:i.stateNode,i};Fs.flushSync=function(i,e){var t=Tt;if((t&48)!=0)return i(e);Tt|=1;try{if(i)return hg(99,i.bind(null,e))}finally{Tt=t,Lo()}};Fs.hydrate=function(i,e,t){if(!DI(e))throw Error(qe(200));return oA(null,i,e,!0,t)};Fs.render=function(i,e,t){if(!DI(e))throw Error(qe(200));return oA(null,i,e,!1,t)};Fs.unmountComponentAtNode=function(i){if(!DI(i))throw Error(qe(40));return i._reactRootContainer?(J_(function(){oA(null,null,i,!1,function(){i._reactRootContainer=null,i[rd]=null})}),!0):!1};Fs.unstable_batchedUpdates=O_;Fs.unstable_createPortal=function(i,e){return rV(i,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Fs.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!DI(t))throw Error(qe(200));if(i==null||i._reactInternals===void 0)throw Error(qe(38));return oA(i,e,t,!1,n)};Fs.version="17.0.2";function sV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sV)}catch(i){console.error(i)}}sV(),CW.exports=Fs;var OI=CW.exports,oV={exports:{}};/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(i){(function(){var e={}.hasOwnProperty;function t(){for(var n=[],r=0;r<arguments.length;r++){var s=arguments[r];if(!!s){var o=typeof s;if(o==="string"||o==="number")n.push(s);else if(Array.isArray(s)){if(s.length){var a=t.apply(null,s);a&&n.push(a)}}else if(o==="object")if(s.toString===Object.prototype.toString)for(var l in s)e.call(s,l)&&s[l]&&n.push(l);else n.push(s.toString())}}return n.join(" ")}i.exports?(t.default=t,i.exports=t):window.classNames=t})()})(oV);var Kt=oV.exports;function JI(){return JI=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},JI.apply(this,arguments)}function aV(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function lV(i){return"default"+i.charAt(0).toUpperCase()+i.substr(1)}function h4(i){var e=f4(i,"string");return typeof e=="symbol"?e:String(e)}function f4(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function I4(i,e,t){var n=ue.exports.useRef(i!==void 0),r=ue.exports.useState(e),s=r[0],o=r[1],a=i!==void 0,l=n.current;return n.current=a,!a&&l&&s!==e&&o(e),[a?i:s,ue.exports.useCallback(function(c){for(var g=arguments.length,d=new Array(g>1?g-1:0),u=1;u<g;u++)d[u-1]=arguments[u];t&&t.apply(void 0,[c].concat(d)),o(c)},[t])]}function lA(i,e){return Object.keys(e).reduce(function(t,n){var r,s=t,o=s[lV(n)],a=s[n],l=aV(s,[lV(n),n].map(h4)),c=e[n],g=I4(a,o,i[c]),d=g[0],u=g[1];return JI({},l,(r={},r[n]=d,r[c]=u,r))},i)}function c2(i,e){return c2=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},c2(i,e)}function C4(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,c2(i,e)}var cA={exports:{}},QI={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p4=ue.exports,cV=60103;QI.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var gV=Symbol.for;cV=gV("react.element"),QI.Fragment=gV("react.fragment")}var m4=p4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A4=Object.prototype.hasOwnProperty,b4={key:!0,ref:!0,__self:!0,__source:!0};function uV(i,e,t){var n,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)A4.call(e,n)&&!b4.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:cV,type:i,key:s,ref:o,props:r,_owner:m4.current}}QI.jsx=uV;QI.jsxs=uV;cA.exports=QI;const $e=cA.exports.jsx,jI=cA.exports.jsxs,g2=cA.exports.Fragment,y4=ue.exports.createContext({prefixes:{}});function $t(i,e){const{prefixes:t}=ue.exports.useContext(y4);return i||t[e]||e}function u2(i){return i&&i.ownerDocument||document}function v4(i){var e=u2(i);return e&&e.defaultView||window}function x4(i,e){return v4(i).getComputedStyle(i,e)}var w4=/([A-Z])/g;function G4(i){return i.replace(w4,"-$1").toLowerCase()}var B4=/^ms-/;function gA(i){return G4(i).replace(B4,"-ms-")}var S4=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Z4(i){return!!(i&&S4.test(i))}function Ha(i,e){var t="",n="";if(typeof e=="string")return i.style.getPropertyValue(gA(e))||x4(i).getPropertyValue(gA(e));Object.keys(e).forEach(function(r){var s=e[r];!s&&s!==0?i.style.removeProperty(gA(r)):Z4(r)?n+=r+"("+s+") ":t+=gA(r)+": "+s+";"}),n&&(t+="transform: "+n+";"),i.style.cssText+=";"+t}var dV={exports:{}},R4="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",M4=R4,W4=M4;function hV(){}function fV(){}fV.resetWarningCache=hV;var _4=function(){function i(n,r,s,o,a,l){if(l!==W4){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}i.isRequired=i;function e(){return i}var t={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:e,element:i,elementType:i,instanceOf:e,node:i,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:fV,resetWarningCache:hV};return t.PropTypes=t,t};dV.exports=_4();var Fa=dV.exports,IV={disabled:!1},CV=Ra.createContext(null),qI="unmounted",Dl="exited",lo="entering",La="entered",$I="exiting",Ta=function(i){C4(e,i);function e(n,r){var s;s=i.call(this,n,r)||this;var o=r,a=o&&!o.isMounting?n.enter:n.appear,l;return s.appearStatus=null,n.in?a?(l=Dl,s.appearStatus=lo):l=La:n.unmountOnExit||n.mountOnEnter?l=qI:l=Dl,s.state={status:l},s.nextCallback=null,s}e.getDerivedStateFromProps=function(r,s){var o=r.in;return o&&s.status===qI?{status:Dl}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(r){var s=null;if(r!==this.props){var o=this.state.status;this.props.in?o!==lo&&o!==La&&(s=lo):(o===lo||o===La)&&(s=$I)}this.updateStatus(!1,s)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var r=this.props.timeout,s,o,a;return s=o=a=r,r!=null&&typeof r!="number"&&(s=r.exit,o=r.enter,a=r.appear!==void 0?r.appear:o),{exit:s,enter:o,appear:a}},t.updateStatus=function(r,s){r===void 0&&(r=!1),s!==null?(this.cancelNextCallback(),s===lo?this.performEnter(r):this.performExit()):this.props.unmountOnExit&&this.state.status===Dl&&this.setState({status:qI})},t.performEnter=function(r){var s=this,o=this.props.enter,a=this.context?this.context.isMounting:r,l=this.props.nodeRef?[a]:[OI.findDOMNode(this),a],c=l[0],g=l[1],d=this.getTimeouts(),u=a?d.appear:d.enter;if(!r&&!o||IV.disabled){this.safeSetState({status:La},function(){s.props.onEntered(c)});return}this.props.onEnter(c,g),this.safeSetState({status:lo},function(){s.props.onEntering(c,g),s.onTransitionEnd(u,function(){s.safeSetState({status:La},function(){s.props.onEntered(c,g)})})})},t.performExit=function(){var r=this,s=this.props.exit,o=this.getTimeouts(),a=this.props.nodeRef?void 0:OI.findDOMNode(this);if(!s||IV.disabled){this.safeSetState({status:Dl},function(){r.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:$I},function(){r.props.onExiting(a),r.onTransitionEnd(o.exit,function(){r.safeSetState({status:Dl},function(){r.props.onExited(a)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(r,s){s=this.setNextCallback(s),this.setState(r,s)},t.setNextCallback=function(r){var s=this,o=!0;return this.nextCallback=function(a){o&&(o=!1,s.nextCallback=null,r(a))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},t.onTransitionEnd=function(r,s){this.setNextCallback(s);var o=this.props.nodeRef?this.props.nodeRef.current:OI.findDOMNode(this),a=r==null&&!this.props.addEndListener;if(!o||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],c=l[0],g=l[1];this.props.addEndListener(c,g)}r!=null&&setTimeout(this.nextCallback,r)},t.render=function(){var r=this.state.status;if(r===qI)return null;var s=this.props,o=s.children;s.in,s.mountOnEnter,s.unmountOnExit,s.appear,s.enter,s.exit,s.timeout,s.addEndListener,s.onEnter,s.onEntering,s.onEntered,s.onExit,s.onExiting,s.onExited,s.nodeRef;var a=aV(s,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Ra.createElement(CV.Provider,{value:null},typeof o=="function"?o(r,a):Ra.cloneElement(Ra.Children.only(o),a))},e}(Ra.Component);Ta.contextType=CV;Ta.propTypes={};function Ad(){}Ta.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Ad,onEntering:Ad,onEntered:Ad,onExit:Ad,onExiting:Ad,onExited:Ad};Ta.UNMOUNTED=qI;Ta.EXITED=Dl;Ta.ENTERING=lo;Ta.ENTERED=La;Ta.EXITING=$I;var uA=!!(typeof window!="undefined"&&window.document&&window.document.createElement),d2=!1,h2=!1;try{var f2={get passive(){return d2=!0},get once(){return h2=d2=!0}};uA&&(window.addEventListener("test",f2,f2),window.removeEventListener("test",f2,!0))}catch{}function V4(i,e,t,n){if(n&&typeof n!="boolean"&&!h2){var r=n.once,s=n.capture,o=t;!h2&&r&&(o=t.__once||function a(l){this.removeEventListener(e,a,s),t.call(this,l)},t.__once=o),i.addEventListener(e,o,d2?n:s)}i.addEventListener(e,t,n)}function N4(i,e,t,n){var r=n&&typeof n!="boolean"?n.capture:n;i.removeEventListener(e,t,r),t.__once&&i.removeEventListener(e,t.__once,r)}function dA(i,e,t,n){return V4(i,e,t,n),function(){N4(i,e,t,n)}}function E4(i,e,t,n){if(t===void 0&&(t=!1),n===void 0&&(n=!0),i){var r=document.createEvent("HTMLEvents");r.initEvent(e,t,n),i.dispatchEvent(r)}}function H4(i){var e=Ha(i,"transitionDuration")||"",t=e.indexOf("ms")===-1?1e3:1;return parseFloat(e)*t}function F4(i,e,t){t===void 0&&(t=5);var n=!1,r=setTimeout(function(){n||E4(i,"transitionend",!0)},e+t),s=dA(i,"transitionend",function(){n=!0},{once:!0});return function(){clearTimeout(r),s()}}function L4(i,e,t,n){t==null&&(t=H4(i)||0);var r=F4(i,t,n),s=dA(i,"transitionend",e);return function(){r(),s()}}function pV(i,e){const t=Ha(i,e)||"",n=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*n}function I2(i,e){const t=pV(i,"transitionDuration"),n=pV(i,"transitionDelay"),r=L4(i,s=>{s.target===i&&(r(),e(s))},t+n)}function eC(...i){return i.filter(e=>e!=null).reduce((e,t)=>{if(typeof t!="function")throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return e===null?t:function(...r){e.apply(this,r),t.apply(this,r)}},null)}function mV(i){i.offsetHeight}var AV=function(e){return!e||typeof e=="function"?e:function(t){e.current=t}};function T4(i,e){var t=AV(i),n=AV(e);return function(r){t&&t(r),n&&n(r)}}function bV(i,e){return ue.exports.useMemo(function(){return T4(i,e)},[i,e])}function X4(i){return i&&"setState"in i?OI.findDOMNode(i):i!=null?i:null}const z4=Ra.forwardRef((d,g)=>{var u=d,{onEnter:i,onEntering:e,onEntered:t,onExit:n,onExiting:r,onExited:s,addEndListener:o,children:a,childRef:l}=u,c=Gt(u,["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children","childRef"]);const h=ue.exports.useRef(null),p=bV(h,l),b=z=>{p(X4(z))},y=z=>J=>{z&&h.current&&z(h.current,J)},m=ue.exports.useCallback(y(i),[i]),f=ue.exports.useCallback(y(e),[e]),G=ue.exports.useCallback(y(t),[t]),x=ue.exports.useCallback(y(n),[n]),B=ue.exports.useCallback(y(r),[r]),M=ue.exports.useCallback(y(s),[s]),E=ue.exports.useCallback(y(o),[o]);return $e(Ta,pt(Oe({ref:g},c),{onEnter:m,onEntered:G,onEntering:f,onExit:x,onExited:M,onExiting:B,addEndListener:E,nodeRef:h,children:typeof a=="function"?(z,J)=>a(z,pt(Oe({},J),{ref:b})):Ra.cloneElement(a,{ref:b})}))});var C2=z4;const k4={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function yV(i,e){const t=`offset${i[0].toUpperCase()}${i.slice(1)}`,n=e[t],r=k4[i];return n+parseInt(Ha(e,r[0]),10)+parseInt(Ha(e,r[1]),10)}const Y4={[Dl]:"collapse",[$I]:"collapsing",[lo]:"collapsing",[La]:"collapse show"},K4={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,getDimensionValue:yV},vV=Ra.forwardRef((d,g)=>{var u=d,{onEnter:i,onEntering:e,onEntered:t,onExit:n,onExiting:r,className:s,children:o,dimension:a="height",getDimensionValue:l=yV}=u,c=Gt(u,["onEnter","onEntering","onEntered","onExit","onExiting","className","children","dimension","getDimensionValue"]);const h=typeof a=="function"?a():a,p=ue.exports.useMemo(()=>eC(G=>{G.style[h]="0"},i),[h,i]),b=ue.exports.useMemo(()=>eC(G=>{const x=`scroll${h[0].toUpperCase()}${h.slice(1)}`;G.style[h]=`${G[x]}px`},e),[h,e]),y=ue.exports.useMemo(()=>eC(G=>{G.style[h]=null},t),[h,t]),m=ue.exports.useMemo(()=>eC(G=>{G.style[h]=`${l(h,G)}px`,mV(G)},n),[n,l,h]),f=ue.exports.useMemo(()=>eC(G=>{G.style[h]=null},r),[h,r]);return $e(C2,pt(Oe({ref:g,addEndListener:I2},c),{"aria-expanded":c.role?c.in:null,onEnter:p,onEntering:b,onEntered:y,onExit:m,onExiting:f,childRef:o.ref,children:(G,x)=>Ra.cloneElement(o,pt(Oe({},x),{className:Kt(s,o.props.className,Y4[G],h==="width"&&"collapse-horizontal")}))}))});vV.defaultProps=K4;var xV=vV;function wV(i,e){return Array.isArray(i)?i.includes(e):i===e}const GV=ue.exports.createContext({});GV.displayName="AccordionContext";var hA=GV;const BV=ue.exports.forwardRef((a,o)=>{var l=a,{as:i="div",bsPrefix:e,className:t,children:n,eventKey:r}=l,s=Gt(l,["as","bsPrefix","className","children","eventKey"]);const{activeEventKey:c}=ue.exports.useContext(hA);return e=$t(e,"accordion-collapse"),$e(xV,pt(Oe({ref:o,in:wV(c,r)},s),{className:Kt(t,e),children:$e(i,{children:ue.exports.Children.only(n)})}))});BV.displayName="AccordionCollapse";var SV=BV;const ZV=ue.exports.createContext({eventKey:""});ZV.displayName="AccordionItemContext";var p2=ZV;const RV=ue.exports.forwardRef((s,r)=>{var o=s,{as:i="div",bsPrefix:e,className:t}=o,n=Gt(o,["as","bsPrefix","className"]);e=$t(e,"accordion-body");const{eventKey:a}=ue.exports.useContext(p2);return $e(SV,{eventKey:a,children:$e(i,pt(Oe({ref:r},n),{className:Kt(t,e)}))})});RV.displayName="AccordionBody";var P4=RV;function D4(i,e){const{activeEventKey:t,onSelect:n,alwaysOpen:r}=ue.exports.useContext(hA);return s=>{let o=i===t?null:i;r&&(Array.isArray(t)?t.includes(i)?o=t.filter(a=>a!==i):o=[...t,i]:o=[i]),n==null||n(o,s),e==null||e(s)}}const MV=ue.exports.forwardRef((o,s)=>{var a=o,{as:i="button",bsPrefix:e,className:t,onClick:n}=a,r=Gt(a,["as","bsPrefix","className","onClick"]);e=$t(e,"accordion-button");const{eventKey:l}=ue.exports.useContext(p2),c=D4(l,n),{activeEventKey:g}=ue.exports.useContext(hA);return i==="button"&&(r.type="button"),$e(i,pt(Oe({ref:s,onClick:c},r),{"aria-expanded":l===g,className:Kt(t,e,!wV(g,l)&&"collapsed")}))});MV.displayName="AccordionButton";var WV=MV;const _V=ue.exports.forwardRef((a,o)=>{var l=a,{as:i="h2",bsPrefix:e,className:t,children:n,onClick:r}=l,s=Gt(l,["as","bsPrefix","className","children","onClick"]);return e=$t(e,"accordion-header"),$e(i,pt(Oe({ref:o},s),{className:Kt(t,e),children:$e(WV,{onClick:r,children:n})}))});_V.displayName="AccordionHeader";var U4=_V;const VV=ue.exports.forwardRef((o,s)=>{var a=o,{as:i="div",bsPrefix:e,className:t,eventKey:n}=a,r=Gt(a,["as","bsPrefix","className","eventKey"]);e=$t(e,"accordion-item");const l=ue.exports.useMemo(()=>({eventKey:n}),[n]);return $e(p2.Provider,{value:l,children:$e(i,pt(Oe({ref:s},r),{className:Kt(t,e)}))})});VV.displayName="AccordionItem";var O4=VV;const NV=ue.exports.forwardRef((i,e)=>{const u=lA(i,{activeKey:"onSelect"}),{as:t="div",activeKey:n,bsPrefix:r,className:s,onSelect:o,flush:a,alwaysOpen:l}=u,c=Gt(u,["as","activeKey","bsPrefix","className","onSelect","flush","alwaysOpen"]),g=$t(r,"accordion"),d=ue.exports.useMemo(()=>({activeEventKey:n,onSelect:o,alwaysOpen:l}),[n,o,l]);return $e(hA.Provider,{value:d,children:$e(t,pt(Oe({ref:e},c),{className:Kt(s,g,a&&`${g}-flush`)}))})});NV.displayName="Accordion";var C0e=Object.assign(NV,{Button:WV,Collapse:SV,Item:O4,Header:U4,Body:P4});function J4(i){var e=ue.exports.useRef(i);return ue.exports.useEffect(function(){e.current=i},[i]),e}function co(i){var e=J4(i);return ue.exports.useCallback(function(){return e.current&&e.current.apply(e,arguments)},[e])}function Q4(){var i=ue.exports.useRef(!0),e=ue.exports.useRef(function(){return i.current});return ue.exports.useEffect(function(){return function(){i.current=!1}},[]),e.current}function j4(i){var e=ue.exports.useRef(null);return ue.exports.useEffect(function(){e.current=i}),e.current}const q4=["as","disabled"];function $4(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function eU(i){return!i||i.trim()==="#"}function m2({tagName:i,disabled:e,href:t,target:n,rel:r,onClick:s,tabIndex:o=0,type:a}){i||(t!=null||n!=null||r!=null?i="a":i="button");const l={tagName:i};if(i==="button")return[{type:a||"button",disabled:e},l];const c=d=>{if((e||i==="a"&&eU(t))&&d.preventDefault(),e){d.stopPropagation();return}s==null||s(d)},g=d=>{d.key===" "&&(d.preventDefault(),c(d))};return i==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:"button",disabled:void 0,tabIndex:e?void 0:o,href:t,target:i==="a"?n:void 0,"aria-disabled":e||void 0,rel:i==="a"?r:void 0,onClick:c,onKeyDown:g},l]}const EV=ue.exports.forwardRef((i,e)=>{let{as:t,disabled:n}=i,r=$4(i,q4);const[s,{tagName:o}]=m2(Object.assign({tagName:t,disabled:n},r));return $e(o,Object.assign({},r,s,{ref:e}))});EV.displayName="Button";const tU=["onKeyDown"];function nU(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function iU(i){return!i||i.trim()==="#"}const A2=ue.exports.forwardRef((i,e)=>{let{onKeyDown:t}=i,n=nU(i,tU);const[r]=m2(Object.assign({tagName:"a"},n)),s=co(o=>{r.onKeyDown(o),t==null||t(o)});return iU(n.href)&&!n.role||n.role==="button"?$e("a",Object.assign({ref:e},n,r,{onKeyDown:s})):$e("a",Object.assign({ref:e},n,{onKeyDown:t}))});A2.displayName="Anchor";const rU={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1},sU={[lo]:"show",[La]:"show"},b2=ue.exports.forwardRef((s,r)=>{var o=s,{className:i,children:e,transitionClasses:t={}}=o,n=Gt(o,["className","children","transitionClasses"]);const a=ue.exports.useCallback((l,c)=>{mV(l),n.onEnter==null||n.onEnter(l,c)},[n]);return $e(C2,pt(Oe({ref:r,addEndListener:I2},n),{onEnter:a,childRef:e.ref,children:(l,c)=>ue.exports.cloneElement(e,pt(Oe({},c),{className:Kt("fade",i,e.props.className,sU[l],t[l])}))}))});b2.defaultProps=rU;b2.displayName="Fade";var y2=b2;const oU={"aria-label":Fa.string,onClick:Fa.func,variant:Fa.oneOf(["white"])},aU={"aria-label":"Close"},fA=ue.exports.forwardRef((r,n)=>{var s=r,{className:i,variant:e}=s,t=Gt(s,["className","variant"]);return $e("button",Oe({ref:n,type:"button",className:Kt("btn-close",e&&`btn-close-${e}`,i)},t))});fA.displayName="CloseButton";fA.propTypes=oU;fA.defaultProps=aU;var HV=fA,IA=i=>ue.exports.forwardRef((e,t)=>$e("div",pt(Oe({},e),{ref:t,className:Kt(e.className,i)}))),lU=/-(.)/g;function cU(i){return i.replace(lU,function(e,t){return t.toUpperCase()})}const gU=i=>i[0].toUpperCase()+cU(i).slice(1);function _r(i,{displayName:e=gU(i),Component:t,defaultProps:n}={}){const r=ue.exports.forwardRef((g,c)=>{var d=g,{className:s,bsPrefix:o,as:a=t||"div"}=d,l=Gt(d,["className","bsPrefix","as"]);const u=$t(o,i);return $e(a,Oe({ref:c,className:Kt(s,u)},l))});return r.defaultProps=n,r.displayName=e,r}const FV=IA("h4");FV.displayName="DivStyledAsH4";const uU=_r("alert-heading",{Component:FV}),dU=_r("alert-link",{Component:A2}),hU={variant:"primary",show:!0,transition:y2,closeLabel:"Close alert"},v2=ue.exports.forwardRef((i,e)=>{const m=lA(i,{show:"onClose"}),{bsPrefix:t,show:n,closeLabel:r,closeVariant:s,className:o,children:a,variant:l,onClose:c,dismissible:g,transition:d}=m,u=Gt(m,["bsPrefix","show","closeLabel","closeVariant","className","children","variant","onClose","dismissible","transition"]),h=$t(t,"alert"),p=co(f=>{c&&c(!1,f)}),b=d===!0?y2:d,y=jI("div",pt(Oe({role:"alert"},b?void 0:u),{ref:e,className:Kt(o,h,l&&`${h}-${l}`,g&&`${h}-dismissible`),children:[g&&$e(HV,{onClick:p,"aria-label":r,variant:s}),a]}));return b?$e(b,pt(Oe({unmountOnExit:!0},u),{ref:void 0,in:n,children:y})):n?y:null});v2.displayName="Alert";v2.defaultProps=hU;var p0e=Object.assign(v2,{Link:dU,Heading:uU});const fU={variant:"primary",active:!1,disabled:!1},x2=ue.exports.forwardRef((l,a)=>{var c=l,{as:i,bsPrefix:e,variant:t,size:n,active:r,className:s}=c,o=Gt(c,["as","bsPrefix","variant","size","active","className"]);const g=$t(e,"btn"),[d,{tagName:u}]=m2(Oe({tagName:i},o));return $e(u,pt(Oe(Oe({},d),o),{ref:a,className:Kt(s,g,r&&"active",t&&`${g}-${t}`,n&&`${g}-${n}`,o.href&&o.disabled&&"disabled")}))});x2.displayName="Button";x2.defaultProps=fU;var m0e=x2;const LV=ue.exports.forwardRef((o,s)=>{var a=o,{bsPrefix:i,className:e,variant:t,as:n="img"}=a,r=Gt(a,["bsPrefix","className","variant","as"]);const l=$t(i,"card-img");return $e(n,Oe({ref:s,className:Kt(t?`${l}-${t}`:l,e)},r))});LV.displayName="CardImg";var IU=LV;const TV=ue.exports.createContext(null);TV.displayName="CardHeaderContext";var XV=TV;const zV=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,as:t="div"}=o,n=Gt(o,["bsPrefix","className","as"]);const a=$t(i,"card-header"),l=ue.exports.useMemo(()=>({cardHeaderBsPrefix:a}),[a]);return $e(XV.Provider,{value:l,children:$e(t,pt(Oe({ref:r},n),{className:Kt(e,a)}))})});zV.displayName="CardHeader";var CU=zV;const pU=IA("h5"),mU=IA("h6"),kV=_r("card-body"),AU=_r("card-title",{Component:pU}),bU=_r("card-subtitle",{Component:mU}),yU=_r("card-link",{Component:"a"}),vU=_r("card-text",{Component:"p"}),xU=_r("card-footer"),wU=_r("card-img-overlay"),GU={body:!1},w2=ue.exports.forwardRef((g,c)=>{var d=g,{bsPrefix:i,className:e,bg:t,text:n,border:r,body:s,children:o,as:a="div"}=d,l=Gt(d,["bsPrefix","className","bg","text","border","body","children","as"]);const u=$t(i,"card");return $e(a,pt(Oe({ref:c},l),{className:Kt(e,u,t&&`bg-${t}`,n&&`text-${n}`,r&&`border-${r}`),children:s?$e(kV,{children:o}):o}))});w2.displayName="Card";w2.defaultProps=GU;var A0e=Object.assign(w2,{Img:IU,Title:AU,Subtitle:bU,Body:kV,Link:yU,Text:vU,Header:CU,Footer:xU,ImgOverlay:wU}),b0e=_r("card-group");function BU(i){var e=ue.exports.useRef(i);return e.current=i,e}function SU(i){var e=BU(i);ue.exports.useEffect(function(){return function(){return e.current()}},[])}function ZU(i,e){return ue.exports.Children.toArray(i).some(t=>ue.exports.isValidElement(t)&&t.type===e)}const RU=["xxl","xl","lg","md","sm","xs"];function MU(r){var s=r,{as:i,bsPrefix:e,className:t}=s,n=Gt(s,["as","bsPrefix","className"]);e=$t(e,"col");const o=[],a=[];return RU.forEach(l=>{const c=n[l];delete n[l];let g,d,u;typeof c=="object"&&c!=null?{span:g,offset:d,order:u}=c:g=c;const h=l!=="xs"?`-${l}`:"";g&&o.push(g===!0?`${e}${h}`:`${e}${h}-${g}`),u!=null&&a.push(`order${h}-${u}`),d!=null&&a.push(`offset${h}-${d}`)}),[pt(Oe({},n),{className:Kt(t,...o,...a)}),{as:i,bsPrefix:e,spans:o}]}const YV=ue.exports.forwardRef((i,e)=>{const[a,...l]=MU(i),c=a,{className:t}=c,n=Gt(c,["className"]),[{as:r="div",bsPrefix:s,spans:o}]=l;return $e(r,pt(Oe({},n),{ref:e,className:Kt(t,!o.length&&s)}))});YV.displayName="Col";var WU=YV,_U=Function.prototype.bind.call(Function.prototype.call,[].slice);function Ag(i,e){return _U(i.querySelectorAll(e))}function VU(){var i=ue.exports.useReducer(function(t){return!t},!1),e=i[1];return e}function KV(i,e){if(i.contains)return i.contains(e);if(i.compareDocumentPosition)return i===e||!!(i.compareDocumentPosition(e)&16)}const CA=ue.exports.createContext(null),G2=(i,e=null)=>i!=null?String(i):e||null,B2=ue.exports.createContext(null);B2.displayName="NavContext";const NU="data-rr-ui-",EU="rrUi";function pA(i){return`${NU}${i}`}function HU(i){return`${EU}${i}`}const PV=ue.exports.createContext(uA?window:void 0);PV.Provider;function DV(){return ue.exports.useContext(PV)}const UV=ue.exports.createContext(null);UV.displayName="NavbarContext";var bd=UV;const FU={type:Fa.string,tooltip:Fa.bool,as:Fa.elementType},S2=ue.exports.forwardRef((o,s)=>{var a=o,{as:i="div",className:e,type:t="valid",tooltip:n=!1}=a,r=Gt(a,["as","className","type","tooltip"]);return $e(i,pt(Oe({},r),{ref:s,className:Kt(e,`${t}-${n?"tooltip":"feedback"}`)}))});S2.displayName="Feedback";S2.propTypes=FU;var OV=S2;const LU=ue.exports.createContext({});var Xa=LU;const JV=ue.exports.forwardRef((c,l)=>{var g=c,{id:i,bsPrefix:e,className:t,type:n="checkbox",isValid:r=!1,isInvalid:s=!1,as:o="input"}=g,a=Gt(g,["id","bsPrefix","className","type","isValid","isInvalid","as"]);const{controlId:d}=ue.exports.useContext(Xa);return e=$t(e,"form-check-input"),$e(o,pt(Oe({},a),{ref:l,type:n,id:i||d,className:Kt(t,e,r&&"is-valid",s&&"is-invalid")}))});JV.displayName="FormCheckInput";var QV=JV;const jV=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,htmlFor:t}=o,n=Gt(o,["bsPrefix","className","htmlFor"]);const{controlId:a}=ue.exports.useContext(Xa);return i=$t(i,"form-check-label"),$e("label",pt(Oe({},n),{ref:r,htmlFor:t||a,className:Kt(e,i)}))});jV.displayName="FormCheckLabel";var Z2=jV;const qV=ue.exports.forwardRef((G,f)=>{var x=G,{id:i,bsPrefix:e,bsSwitchPrefix:t,inline:n=!1,disabled:r=!1,isValid:s=!1,isInvalid:o=!1,feedbackTooltip:a=!1,feedback:l,feedbackType:c,className:g,style:d,title:u="",type:h="checkbox",label:p,children:b,as:y="input"}=x,m=Gt(x,["id","bsPrefix","bsSwitchPrefix","inline","disabled","isValid","isInvalid","feedbackTooltip","feedback","feedbackType","className","style","title","type","label","children","as"]);e=$t(e,"form-check"),t=$t(t,"form-switch");const{controlId:B}=ue.exports.useContext(Xa),M=ue.exports.useMemo(()=>({controlId:i||B}),[B,i]),E=!b&&p!=null&&p!==!1||ZU(b,Z2),z=$e(QV,pt(Oe({},m),{type:h==="switch"?"checkbox":h,ref:f,isValid:s,isInvalid:o,disabled:r,as:y}));return $e(Xa.Provider,{value:M,children:$e("div",{style:d,className:Kt(g,E&&e,n&&`${e}-inline`,h==="switch"&&t),children:b||jI(g2,{children:[z,E&&$e(Z2,{title:u,children:p}),l&&$e(OV,{type:c,tooltip:a,children:l})]})})})});qV.displayName="FormCheck";var mA=Object.assign(qV,{Input:QV,Label:Z2});const $V=ue.exports.forwardRef((h,u)=>{var p=h,{bsPrefix:i,type:e,size:t,htmlSize:n,id:r,className:s,isValid:o=!1,isInvalid:a=!1,plaintext:l,readOnly:c,as:g="input"}=p,d=Gt(p,["bsPrefix","type","size","htmlSize","id","className","isValid","isInvalid","plaintext","readOnly","as"]);const{controlId:b}=ue.exports.useContext(Xa);i=$t(i,"form-control");let y;return l?y={[`${i}-plaintext`]:!0}:y={[i]:!0,[`${i}-${t}`]:t},$e(g,pt(Oe({},d),{type:e,size:n,ref:u,readOnly:c,id:r||b,className:Kt(s,y,o&&"is-valid",a&&"is-invalid",e==="color"&&`${i}-color`)}))});$V.displayName="FormControl";var TU=Object.assign($V,{Feedback:OV}),XU=_r("form-floating");const e9=ue.exports.forwardRef((r,n)=>{var s=r,{controlId:i,as:e="div"}=s,t=Gt(s,["controlId","as"]);const o=ue.exports.useMemo(()=>({controlId:i}),[i]);return $e(Xa.Provider,{value:o,children:$e(e,pt(Oe({},t),{ref:n}))})});e9.displayName="FormGroup";var t9=e9;const zU={column:!1,visuallyHidden:!1},R2=ue.exports.forwardRef((l,a)=>{var c=l,{as:i="label",bsPrefix:e,column:t,visuallyHidden:n,className:r,htmlFor:s}=c,o=Gt(c,["as","bsPrefix","column","visuallyHidden","className","htmlFor"]);const{controlId:g}=ue.exports.useContext(Xa);e=$t(e,"form-label");let d="col-form-label";typeof t=="string"&&(d=`${d} ${d}-${t}`);const u=Kt(r,e,n&&"visually-hidden",t&&d);return s=s||g,t?$e(WU,Oe({ref:a,as:"label",className:u,htmlFor:s},o)):$e(i,Oe({ref:a,className:u,htmlFor:s},o))});R2.displayName="FormLabel";R2.defaultProps=zU;var kU=R2;const n9=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,id:t}=o,n=Gt(o,["bsPrefix","className","id"]);const{controlId:a}=ue.exports.useContext(Xa);return i=$t(i,"form-range"),$e("input",pt(Oe({},n),{type:"range",ref:r,className:Kt(e,i),id:t||a}))});n9.displayName="FormRange";var YU=n9;const i9=ue.exports.forwardRef((c,l)=>{var g=c,{bsPrefix:i,size:e,htmlSize:t,className:n,isValid:r=!1,isInvalid:s=!1,id:o}=g,a=Gt(g,["bsPrefix","size","htmlSize","className","isValid","isInvalid","id"]);const{controlId:d}=ue.exports.useContext(Xa);return i=$t(i,"form-select"),$e("select",pt(Oe({},a),{size:t,ref:l,className:Kt(n,i,e&&`${i}-${e}`,r&&"is-valid",s&&"is-invalid"),id:o||d}))});i9.displayName="FormSelect";var KU=i9;const r9=ue.exports.forwardRef((o,s)=>{var a=o,{bsPrefix:i,className:e,as:t="small",muted:n}=a,r=Gt(a,["bsPrefix","className","as","muted"]);return i=$t(i,"form-text"),$e(t,pt(Oe({},r),{ref:s,className:Kt(e,i,n&&"text-muted")}))});r9.displayName="FormText";var PU=r9;const s9=ue.exports.forwardRef((i,e)=>$e(mA,pt(Oe({},i),{ref:e,type:"switch"})));s9.displayName="Switch";var DU=Object.assign(s9,{Input:mA.Input,Label:mA.Label});const o9=ue.exports.forwardRef((a,o)=>{var l=a,{bsPrefix:i,className:e,children:t,controlId:n,label:r}=l,s=Gt(l,["bsPrefix","className","children","controlId","label"]);return i=$t(i,"form-floating"),jI(t9,pt(Oe({ref:o,className:Kt(e,i),controlId:n},s),{children:[t,$e("label",{htmlFor:n,children:r})]}))});o9.displayName="FloatingLabel";var UU=o9;const OU={_ref:Fa.any,validated:Fa.bool,as:Fa.elementType},M2=ue.exports.forwardRef((s,r)=>{var o=s,{className:i,validated:e,as:t="form"}=o,n=Gt(o,["className","validated","as"]);return $e(t,pt(Oe({},n),{ref:r,className:Kt(i,e&&"was-validated")}))});M2.displayName="Form";M2.propTypes=OU;var y0e=Object.assign(M2,{Group:t9,Control:TU,Floating:XU,Check:mA,Switch:DU,Label:kU,Text:PU,Range:YU,Select:KU,FloatingLabel:UU});const JU={fluid:!1},W2=ue.exports.forwardRef((o,s)=>{var a=o,{bsPrefix:i,fluid:e,as:t="div",className:n}=a,r=Gt(a,["bsPrefix","fluid","as","className"]);const l=$t(i,"container"),c=typeof e=="string"?`-${e}`:"-fluid";return $e(t,pt(Oe({ref:s},r),{className:Kt(n,e?`${l}${c}`:l)}))});W2.displayName="Container";W2.defaultProps=JU;var v0e=W2;const QU=ue.exports.createContext(null),jU=["as","active","eventKey"];function qU(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function a9({key:i,onClick:e,active:t,id:n,role:r,disabled:s}){const o=ue.exports.useContext(CA),a=ue.exports.useContext(B2);let l=t;const c={role:r};if(a){!r&&a.role==="tablist"&&(c.role="tab");const g=a.getControllerId(i!=null?i:null),d=a.getControlledId(i!=null?i:null);c[pA("event-key")]=i,c.id=g||n,c["aria-controls"]=d,l=t==null&&i!=null?a.activeKey===i:t}return c.role==="tab"&&(s&&(c.tabIndex=-1,c["aria-disabled"]=!0),l?c["aria-selected"]=l:c.tabIndex=-1),c.onClick=co(g=>{s||(e==null||e(g),i!=null&&o&&!g.isPropagationStopped()&&o(i,g))}),[c,{isActive:l}]}const l9=ue.exports.forwardRef((i,e)=>{let{as:t=EV,active:n,eventKey:r}=i,s=qU(i,jU);const[o,a]=a9(Object.assign({key:G2(r,s.href),active:n},s));return o[pA("active")]=a.isActive,$e(t,Object.assign({},s,o,{ref:e}))});l9.displayName="NavItem";const $U=["as","onSelect","activeKey","role","onKeyDown"];function eO(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}const c9=()=>{},g9=pA("event-key"),u9=ue.exports.forwardRef((i,e)=>{let{as:t="div",onSelect:n,activeKey:r,role:s,onKeyDown:o}=i,a=eO(i,$U);const l=VU(),c=ue.exports.useRef(!1),g=ue.exports.useContext(CA),d=ue.exports.useContext(QU);let u,h;d&&(s=s||"tablist",r=d.activeKey,u=d.getControlledId,h=d.getControllerId);const p=ue.exports.useRef(null),b=G=>{const x=p.current;if(!x)return null;const B=Ag(x,`[${g9}]:not([aria-disabled=true])`),M=x.querySelector("[aria-selected=true]");if(!M)return null;const E=B.indexOf(M);if(E===-1)return null;let z=E+G;return z>=B.length&&(z=0),z<0&&(z=B.length-1),B[z]},y=(G,x)=>{G!=null&&(n==null||n(G,x),g==null||g(G,x))},m=G=>{if(o==null||o(G),!d)return;let x;switch(G.key){case"ArrowLeft":case"ArrowUp":x=b(-1);break;case"ArrowRight":case"ArrowDown":x=b(1);break;default:return}!x||(G.preventDefault(),y(x.dataset[HU("EventKey")]||null,G),c.current=!0,l())};ue.exports.useEffect(()=>{if(p.current&&c.current){const G=p.current.querySelector(`[${g9}][aria-selected=true]`);G==null||G.focus()}c.current=!1});const f=bV(e,p);return $e(CA.Provider,{value:y,children:$e(B2.Provider,{value:{role:s,activeKey:G2(r),getControlledId:u||c9,getControllerId:h||c9},children:$e(t,Object.assign({},a,{onKeyDown:m,ref:f,role:s}))})})});u9.displayName="Nav";var tO=Object.assign(u9,{Item:l9});function _2(i){i===void 0&&(i=u2());try{var e=i.activeElement;return!e||!e.nodeName?null:e}catch{return i.body}}function nO(i=document){const e=i.defaultView;return Math.abs(e.innerWidth-i.documentElement.clientWidth)}const d9=pA("modal-open");class V2{constructor({ownerDocument:e,handleContainerOverflow:t=!0,isRTL:n=!1}={}){this.handleContainerOverflow=t,this.isRTL=n,this.modals=[],this.ownerDocument=e}getScrollbarWidth(){return nO(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(e){}removeModalAttributes(e){}setContainerStyle(e){const t={overflow:"hidden"},n=this.isRTL?"paddingLeft":"paddingRight",r=this.getElement();e.style={overflow:r.style.overflow,[n]:r.style[n]},e.scrollBarWidth&&(t[n]=`${parseInt(Ha(r,n)||"0",10)+e.scrollBarWidth}px`),r.setAttribute(d9,""),Ha(r,t)}reset(){[...this.modals].forEach(e=>this.remove(e))}removeContainerStyle(e){const t=this.getElement();t.removeAttribute(d9),Object.assign(t.style,e.style)}add(e){let t=this.modals.indexOf(e);return t!==-1||(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),t!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t}remove(e){const t=this.modals.indexOf(e);t!==-1&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}isTopModal(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}}const N2=(i,e)=>{var t;return uA?i==null?(e||u2()).body:(typeof i=="function"&&(i=i()),i&&"current"in i&&(i=i.current),(t=i)!=null&&t.nodeType&&i||null):null};function iO(i,e){const t=DV(),[n,r]=ue.exports.useState(()=>N2(i,t==null?void 0:t.document));if(!n){const s=N2(i);s&&r(s)}return ue.exports.useEffect(()=>{e&&n&&e(n)},[e,n]),ue.exports.useEffect(()=>{const s=N2(i);s!==n&&r(s)},[i,n]),n}const rO=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","backdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function sO(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}let E2;function oO(i){return E2||(E2=new V2({ownerDocument:i==null?void 0:i.document})),E2}function aO(i){const e=DV(),t=i||oO(e),n=ue.exports.useRef({dialog:null,backdrop:null});return Object.assign(n.current,{add:()=>t.add(n.current),remove:()=>t.remove(n.current),isTopModal:()=>t.isTopModal(n.current),setDialogRef:ue.exports.useCallback(r=>{n.current.dialog=r},[]),setBackdropRef:ue.exports.useCallback(r=>{n.current.backdrop=r},[])})}const h9=ue.exports.forwardRef((i,e)=>{let{show:t=!1,role:n="dialog",className:r,style:s,children:o,backdrop:a=!0,keyboard:l=!0,onBackdropClick:c,onEscapeKeyDown:g,transition:d,backdropTransition:u,autoFocus:h=!0,enforceFocus:p=!0,restoreFocus:b=!0,restoreFocusOptions:y,renderDialog:m,renderBackdrop:f=de=>$e("div",Object.assign({},de)),manager:G,container:x,onShow:B,onHide:M=()=>{},onExit:E,onExited:z,onExiting:J,onEnter:V,onEntering:I,onEntered:w}=i,S=sO(i,rO);const R=iO(x),W=aO(G),H=Q4(),k=j4(t),[_,Z]=ue.exports.useState(!t),T=ue.exports.useRef(null);ue.exports.useImperativeHandle(e,()=>W,[W]),uA&&!k&&t&&(T.current=_2()),!d&&!t&&!_?Z(!0):t&&_&&Z(!1);const F=co(()=>{if(W.add(),ye.current=dA(document,"keydown",Y),ee.current=dA(document,"focus",()=>setTimeout(j),!0),B&&B(),h){const de=_2(document);W.dialog&&de&&!KV(W.dialog,de)&&(T.current=de,W.dialog.focus())}}),K=co(()=>{if(W.remove(),ye.current==null||ye.current(),ee.current==null||ee.current(),b){var de;(de=T.current)==null||de.focus==null||de.focus(y),T.current=null}});ue.exports.useEffect(()=>{!t||!R||F()},[t,R,F]),ue.exports.useEffect(()=>{!_||K()},[_,K]),SU(()=>{K()});const j=co(()=>{if(!p||!H()||!W.isTopModal())return;const de=_2();W.dialog&&de&&!KV(W.dialog,de)&&W.dialog.focus()}),O=co(de=>{de.target===de.currentTarget&&(c==null||c(de),a===!0&&M())}),Y=co(de=>{l&&de.keyCode===27&&W.isTopModal()&&(g==null||g(de),de.defaultPrevented||M())}),ee=ue.exports.useRef(),ye=ue.exports.useRef(),Ce=(...de)=>{Z(!0),z==null||z(...de)},he=d;if(!R||!(t||he&&!_))return null;const Ne=Object.assign({role:n,ref:W.setDialogRef,"aria-modal":n==="dialog"?!0:void 0},S,{style:s,className:r,tabIndex:-1});let He=m?m(Ne):$e("div",Object.assign({},Ne,{children:ue.exports.cloneElement(o,{role:"document"})}));he&&(He=$e(he,{appear:!0,unmountOnExit:!0,in:!!t,onExit:E,onExiting:J,onExited:Ce,onEnter:V,onEntering:I,onEntered:w,children:He}));let ne=null;if(a){const de=u;ne=f({ref:W.setBackdropRef,onClick:O}),de&&(ne=$e(de,{appear:!0,in:!!t,children:ne}))}return $e(g2,{children:OI.createPortal(jI(g2,{children:[ne,He]}),R)})});h9.displayName="Modal";var lO=Object.assign(h9,{Manager:V2});function cO(i,e){return i.classList?!!e&&i.classList.contains(e):(" "+(i.className.baseVal||i.className)+" ").indexOf(" "+e+" ")!==-1}function gO(i,e){i.classList?i.classList.add(e):cO(i,e)||(typeof i.className=="string"?i.className=i.className+" "+e:i.setAttribute("class",(i.className&&i.className.baseVal||"")+" "+e))}function f9(i,e){return i.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function uO(i,e){i.classList?i.classList.remove(e):typeof i.className=="string"?i.className=f9(i.className,e):i.setAttribute("class",f9(i.className&&i.className.baseVal||"",e))}const yd={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class I9 extends V2{adjustAndStore(e,t,n){const r=t.style[e];t.dataset[e]=r,Ha(t,{[e]:`${parseFloat(Ha(t,e))+n}px`})}restore(e,t){const n=t.dataset[e];n!==void 0&&(delete t.dataset[e],Ha(t,{[e]:n}))}setContainerStyle(e){super.setContainerStyle(e);const t=this.getElement();if(gO(t,"modal-open"),!e.scrollBarWidth)return;const n=this.isRTL?"paddingLeft":"paddingRight",r=this.isRTL?"marginLeft":"marginRight";Ag(t,yd.FIXED_CONTENT).forEach(s=>this.adjustAndStore(n,s,e.scrollBarWidth)),Ag(t,yd.STICKY_CONTENT).forEach(s=>this.adjustAndStore(r,s,-e.scrollBarWidth)),Ag(t,yd.NAVBAR_TOGGLER).forEach(s=>this.adjustAndStore(r,s,e.scrollBarWidth))}removeContainerStyle(e){super.removeContainerStyle(e);const t=this.getElement();uO(t,"modal-open");const n=this.isRTL?"paddingLeft":"paddingRight",r=this.isRTL?"marginLeft":"marginRight";Ag(t,yd.FIXED_CONTENT).forEach(s=>this.restore(n,s)),Ag(t,yd.STICKY_CONTENT).forEach(s=>this.restore(r,s)),Ag(t,yd.NAVBAR_TOGGLER).forEach(s=>this.restore(r,s))}}let H2;function dO(i){return H2||(H2=new I9(i)),H2}var hO=I9;const fO=ue.exports.createContext({onHide(){}});var C9=fO;const IO={closeLabel:"Close",closeButton:!1},p9=ue.exports.forwardRef((a,o)=>{var l=a,{closeLabel:i,closeVariant:e,closeButton:t,onHide:n,children:r}=l,s=Gt(l,["closeLabel","closeVariant","closeButton","onHide","children"]);const c=ue.exports.useContext(C9),g=co(()=>{c==null||c.onHide(),n==null||n()});return jI("div",pt(Oe({ref:o},s),{children:[r,t&&$e(HV,{"aria-label":i,variant:e,onClick:g})]}))});p9.defaultProps=IO;var CO=p9,m9={exports:{}},F2={exports:{}};(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(n){function r(o,a,l,c,g,d){var u=c||"<<anonymous>>",h=d||l;if(a[l]==null)return o?new Error("Required "+g+" `"+h+"` was not specified "+("in `"+u+"`.")):null;for(var p=arguments.length,b=Array(p>6?p-6:0),y=6;y<p;y++)b[y-6]=arguments[y];return n.apply(void 0,[a,l,u,g,h].concat(b))}var s=r.bind(null,!1);return s.isRequired=r.bind(null,!0),s}i.exports=e.default})(F2,F2.exports);(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=F2.exports,n=r(t);function r(o){return o&&o.__esModule?o:{default:o}}function s(){for(var o=arguments.length,a=Array(o),l=0;l<o;l++)a[l]=arguments[l];function c(){for(var g=arguments.length,d=Array(g),u=0;u<g;u++)d[u]=arguments[u];var h=null;return a.forEach(function(p){if(h==null){var b=p.apply(void 0,d);b!=null&&(h=b)}}),h}return(0,n.default)(c)}i.exports=e.default})(m9,m9.exports);var pO=_r("nav-item");const mO={disabled:!1},L2=ue.exports.forwardRef((a,o)=>{var l=a,{bsPrefix:i,className:e,as:t=A2,active:n,eventKey:r}=l,s=Gt(l,["bsPrefix","className","as","active","eventKey"]);i=$t(i,"nav-link");const[c,g]=a9(Oe({key:G2(r,s.href),active:n},s));return $e(t,pt(Oe(Oe({},s),c),{ref:o,className:Kt(e,i,s.disabled&&"disabled",g.isActive&&"active")}))});L2.displayName="NavLink";L2.defaultProps=mO;var AO=L2;const bO={justify:!1,fill:!1},T2=ue.exports.forwardRef((i,e)=>{const f=lA(i,{activeKey:"onSelect"}),{as:t="div",bsPrefix:n,variant:r,fill:s,justify:o,navbar:a,navbarScroll:l,className:c,activeKey:g}=f,d=Gt(f,["as","bsPrefix","variant","fill","justify","navbar","navbarScroll","className","activeKey"]),u=$t(n,"nav");let h,p,b=!1;const y=ue.exports.useContext(bd),m=ue.exports.useContext(XV);return y?(h=y.bsPrefix,b=a==null?!0:a):m&&({cardHeaderBsPrefix:p}=m),$e(tO,Oe({as:t,ref:e,activeKey:g,className:Kt(c,{[u]:!b,[`${h}-nav`]:b,[`${h}-nav-scroll`]:b&&l,[`${p}-${r}`]:!!p,[`${u}-${r}`]:!!r,[`${u}-fill`]:s,[`${u}-justified`]:o})},d))});T2.displayName="Nav";T2.defaultProps=bO;var x0e=Object.assign(T2,{Item:pO,Link:AO});const A9=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,as:t}=o,n=Gt(o,["bsPrefix","className","as"]);i=$t(i,"navbar-brand");const a=t||(n.href?"a":"span");return $e(a,pt(Oe({},n),{ref:r,className:Kt(e,i)}))});A9.displayName="NavbarBrand";var yO=A9;const b9=ue.exports.forwardRef((r,n)=>{var s=r,{children:i,bsPrefix:e}=s,t=Gt(s,["children","bsPrefix"]);e=$t(e,"navbar-collapse");const o=ue.exports.useContext(bd);return $e(xV,pt(Oe({in:!!(o&&o.expanded)},t),{children:$e("div",{ref:n,className:e,children:i})}))});b9.displayName="NavbarCollapse";var vO=b9;const xO={label:"Toggle navigation"},X2=ue.exports.forwardRef((l,a)=>{var c=l,{bsPrefix:i,className:e,children:t,label:n,as:r="button",onClick:s}=c,o=Gt(c,["bsPrefix","className","children","label","as","onClick"]);i=$t(i,"navbar-toggler");const{onToggle:g,expanded:d}=ue.exports.useContext(bd)||{},u=co(h=>{s&&s(h),g&&g()});return r==="button"&&(o.type="button"),$e(r,pt(Oe({},o),{ref:a,onClick:u,"aria-label":n,className:Kt(e,i,!d&&"collapsed"),children:t||$e("span",{className:`${i}-icon`})}))});X2.displayName="NavbarToggle";X2.defaultProps=xO;var wO=X2,GO=_r("offcanvas-body");const BO={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1},SO={[lo]:"show",[La]:"show"},z2=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,children:t}=o,n=Gt(o,["bsPrefix","className","children"]);return i=$t(i,"offcanvas"),$e(C2,pt(Oe({ref:r,addEndListener:I2},n),{childRef:t.ref,children:(a,l)=>ue.exports.cloneElement(t,pt(Oe({},l),{className:Kt(e,t.props.className,(a===lo||a===$I)&&`${i}-toggling`,SO[a])}))}))});z2.defaultProps=BO;z2.displayName="OffcanvasToggling";var ZO=z2;const RO={closeLabel:"Close",closeButton:!1},k2=ue.exports.forwardRef((r,n)=>{var s=r,{bsPrefix:i,className:e}=s,t=Gt(s,["bsPrefix","className"]);return i=$t(i,"offcanvas-header"),$e(CO,pt(Oe({ref:n},t),{className:Kt(e,i)}))});k2.displayName="OffcanvasHeader";k2.defaultProps=RO;var MO=k2;const WO=IA("h5");var _O=_r("offcanvas-title",{Component:WO});const VO={show:!1,backdrop:!0,keyboard:!0,scroll:!1,autoFocus:!0,enforceFocus:!0,restoreFocus:!0,placement:"start"};function NO(i){return $e(ZO,Oe({},i))}function EO(i){return $e(y2,Oe({},i))}const Y2=ue.exports.forwardRef((I,V)=>{var w=I,{bsPrefix:i,className:e,children:t,"aria-labelledby":n,placement:r,show:s,backdrop:o,keyboard:a,scroll:l,onEscapeKeyDown:c,onShow:g,onHide:d,container:u,autoFocus:h,enforceFocus:p,restoreFocus:b,restoreFocusOptions:y,onEntered:m,onExit:f,onExiting:G,onEnter:x,onEntering:B,onExited:M,backdropClassName:E,manager:z}=w,J=Gt(w,["bsPrefix","className","children","aria-labelledby","placement","show","backdrop","keyboard","scroll","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"]);const S=ue.exports.useRef();i=$t(i,"offcanvas");const{onToggle:R}=ue.exports.useContext(bd)||{},W=co(()=>{R==null||R(),d==null||d()}),H=ue.exports.useMemo(()=>({onHide:W}),[W]);function k(){return z||(l?(S.current||(S.current=new hO({handleContainerOverflow:!1})),S.current):dO())}const _=(K,...j)=>{K&&(K.style.visibility="visible"),x==null||x(K,...j)},Z=(K,...j)=>{K&&(K.style.visibility=""),M==null||M(...j)},T=ue.exports.useCallback(K=>$e("div",pt(Oe({},K),{className:Kt(`${i}-backdrop`,E)})),[E,i]),F=K=>$e("div",pt(Oe(Oe({role:"dialog"},K),J),{className:Kt(e,i,`${i}-${r}`),"aria-labelledby":n,children:t}));return $e(C9.Provider,{value:H,children:$e(lO,{show:s,ref:V,backdrop:o,container:u,keyboard:a,autoFocus:h,enforceFocus:p&&!l,restoreFocus:b,restoreFocusOptions:y,onEscapeKeyDown:c,onShow:g,onHide:W,onEnter:_,onEntering:B,onEntered:m,onExit:f,onExiting:G,onExited:Z,manager:k(),transition:NO,backdropTransition:EO,renderBackdrop:T,renderDialog:F})})});Y2.displayName="Offcanvas";Y2.defaultProps=VO;var HO=Object.assign(Y2,{Body:GO,Header:MO,Title:_O});const y9=ue.exports.forwardRef((i,e)=>{const t=ue.exports.useContext(bd);return $e(HO,Oe({ref:e,show:!!(t!=null&&t.expanded)},i))});y9.displayName="NavbarOffcanvas";var FO=y9;const LO=_r("navbar-text",{Component:"span"}),TO={expand:!0,variant:"light",collapseOnSelect:!1},K2=ue.exports.forwardRef((i,e)=>{const G=lA(i,{expanded:"onToggle"}),{bsPrefix:t,expand:n,variant:r,bg:s,fixed:o,sticky:a,className:l,as:c="nav",expanded:g,onToggle:d,onSelect:u,collapseOnSelect:h}=G,p=Gt(G,["bsPrefix","expand","variant","bg","fixed","sticky","className","as","expanded","onToggle","onSelect","collapseOnSelect"]),b=$t(t,"navbar"),y=ue.exports.useCallback((...x)=>{u==null||u(...x),h&&g&&(d==null||d(!1))},[u,h,g,d]);p.role===void 0&&c!=="nav"&&(p.role="navigation");let m=`${b}-expand`;typeof n=="string"&&(m=`${m}-${n}`);const f=ue.exports.useMemo(()=>({onToggle:()=>d==null?void 0:d(!g),bsPrefix:b,expanded:!!g}),[b,g,d]);return $e(bd.Provider,{value:f,children:$e(CA.Provider,{value:y,children:$e(c,pt(Oe({ref:e},p),{className:Kt(l,b,n&&m,r&&`${b}-${r}`,s&&`bg-${s}`,a&&`sticky-${a}`,o&&`fixed-${o}`)}))})})});K2.defaultProps=TO;K2.displayName="Navbar";var w0e=Object.assign(K2,{Brand:yO,Collapse:vO,Offcanvas:FO,Text:LO,Toggle:wO});const XO=["xxl","xl","lg","md","sm","xs"],v9=ue.exports.forwardRef((s,r)=>{var o=s,{bsPrefix:i,className:e,as:t="div"}=o,n=Gt(o,["bsPrefix","className","as"]);const a=$t(i,"row"),l=`${a}-cols`,c=[];return XO.forEach(g=>{const d=n[g];delete n[g];let u;d!=null&&typeof d=="object"?{cols:u}=d:u=d;const h=g!=="xs"?`-${g}`:"";u!=null&&c.push(`${l}${h}-${u}`)}),$e(t,pt(Oe({ref:r},n),{className:Kt(e,a,...c)}))});v9.displayName="Row";var G0e=v9;const zO=ue.exports.forwardRef((d,g)=>{var u=d,{bsPrefix:i,className:e,striped:t,bordered:n,borderless:r,hover:s,size:o,variant:a,responsive:l}=u,c=Gt(u,["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"]);const h=$t(i,"table"),p=Kt(e,h,a&&`${h}-${a}`,o&&`${h}-${o}`,t&&`${h}-striped`,n&&`${h}-bordered`,r&&`${h}-borderless`,s&&`${h}-hover`),b=$e("table",pt(Oe({},c),{className:p,ref:g}));if(l){let y=`${h}-responsive`;return typeof l=="string"&&(y=`${y}-${l}`),$e("div",{className:y,children:b})}return b});var B0e=zO,bg,P2=bg||(bg={});P2.Pop="POP";P2.Push="PUSH";P2.Replace="REPLACE";var x9=function(i){return i};function w9(i){i.preventDefault(),i.returnValue=""}function G9(){var i=[];return{get length(){return i.length},push:function(e){return i.push(e),function(){i=i.filter(function(t){return t!==e})}},call:function(e){i.forEach(function(t){return t&&t(e)})}}}function kO(){return Math.random().toString(36).substr(2,8)}function tC(i){var e=i.pathname;e=e===void 0?"/":e;var t=i.search;return t=t===void 0?"":t,i=i.hash,i=i===void 0?"":i,t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Ul(i){var e={};if(i){var t=i.indexOf("#");0<=t&&(e.hash=i.substr(t),i=i.substr(0,t)),t=i.indexOf("?"),0<=t&&(e.search=i.substr(t),i=i.substr(0,t)),i&&(e.pathname=i)}return e}function YO(i){function e(){var m=Ul(c.location.hash.substr(1)),f=m.pathname,G=m.search;m=m.hash;var x=g.state||{};return[x.idx,x9({pathname:f===void 0?"/":f,search:G===void 0?"":G,hash:m===void 0?"":m,state:x.usr||null,key:x.key||"default"})]}function t(){if(d)y.call(d),d=null;else{var m=bg.Pop,f=e(),G=f[0];if(f=f[1],y.length){if(G!=null){var x=h-G;x&&(d={action:m,location:f,retry:function(){l(-1*x)}},l(x))}}else s(m)}}function n(m){var f=document.querySelector("base"),G="";return f&&f.getAttribute("href")&&(f=c.location.href,G=f.indexOf("#"),G=G===-1?f:f.slice(0,G)),G+"#"+(typeof m=="string"?m:tC(m))}function r(m,f){return f===void 0&&(f=null),x9(JI({pathname:p.pathname,hash:"",search:""},typeof m=="string"?Ul(m):m,{state:f,key:kO()}))}function s(m){u=m,m=e(),h=m[0],p=m[1],b.call({action:u,location:p})}function o(m,f){function G(){o(m,f)}var x=bg.Push,B=r(m,f);if(!y.length||(y.call({action:x,location:B,retry:G}),!1)){var M=[{usr:B.state,key:B.key,idx:h+1},n(B)];B=M[0],M=M[1];try{g.pushState(B,"",M)}catch{c.location.assign(M)}s(x)}}function a(m,f){function G(){a(m,f)}var x=bg.Replace,B=r(m,f);y.length&&(y.call({action:x,location:B,retry:G}),1)||(B=[{usr:B.state,key:B.key,idx:h},n(B)],g.replaceState(B[0],"",B[1]),s(x))}function l(m){g.go(m)}i===void 0&&(i={}),i=i.window;var c=i===void 0?document.defaultView:i,g=c.history,d=null;c.addEventListener("popstate",t),c.addEventListener("hashchange",function(){var m=e()[1];tC(m)!==tC(p)&&t()});var u=bg.Pop;i=e();var h=i[0],p=i[1],b=G9(),y=G9();return h==null&&(h=0,g.replaceState(JI({},g.state,{idx:h}),"")),{get action(){return u},get location(){return p},createHref:n,push:o,replace:a,go:l,back:function(){l(-1)},forward:function(){l(1)},listen:function(m){return b.push(m)},block:function(m){var f=y.push(m);return y.length===1&&c.addEventListener("beforeunload",w9),function(){f(),y.length||c.removeEventListener("beforeunload",w9)}}}}/**
 * React Router v6.2.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yo(i,e){if(!i)throw new Error(e)}const D2=ue.exports.createContext(null),U2=ue.exports.createContext(null),vd=ue.exports.createContext({outlet:null,matches:[]});function KO(i){return QO(i.context)}function PO(i){Yo(!1)}function DO(i){let{basename:e="/",children:t=null,location:n,navigationType:r=bg.Pop,navigator:s,static:o=!1}=i;nC()&&Yo(!1);let a=C7(e),l=ue.exports.useMemo(()=>({basename:a,navigator:s,static:o}),[a,s,o]);typeof n=="string"&&(n=Ul(n));let{pathname:c="/",search:g="",hash:d="",state:u=null,key:h="default"}=n,p=ue.exports.useMemo(()=>{let b=M9(c,a);return b==null?null:{pathname:b,search:g,hash:d,state:u,key:h}},[a,c,g,d,u,h]);return p==null?null:ue.exports.createElement(D2.Provider,{value:l},ue.exports.createElement(U2.Provider,{children:t,value:{location:p,navigationType:r}}))}function S0e(i){let{children:e,location:t}=i;return jO(O2(e),t)}function UO(i){nC()||Yo(!1);let{basename:e,navigator:t}=ue.exports.useContext(D2),{hash:n,pathname:r,search:s}=B9(i),o=r;if(e!=="/"){let a=I7(i),l=a!=null&&a.endsWith("/");o=r==="/"?e+(l?"/":""):Ol([e,r])}return t.createHref({pathname:o,search:s,hash:n})}function nC(){return ue.exports.useContext(U2)!=null}function AA(){return nC()||Yo(!1),ue.exports.useContext(U2).location}function OO(){nC()||Yo(!1);let{basename:i,navigator:e}=ue.exports.useContext(D2),{matches:t}=ue.exports.useContext(vd),{pathname:n}=AA(),r=JSON.stringify(t.map(a=>a.pathnameBase)),s=ue.exports.useRef(!1);return ue.exports.useEffect(()=>{s.current=!0}),ue.exports.useCallback(function(a,l){if(l===void 0&&(l={}),!s.current)return;if(typeof a=="number"){e.go(a);return}let c=R9(a,JSON.parse(r),n);i!=="/"&&(c.pathname=Ol([i,c.pathname])),(l.replace?e.replace:e.push)(c,l.state)},[i,e,r,n])}const JO=ue.exports.createContext(null);function QO(i){let e=ue.exports.useContext(vd).outlet;return e&&ue.exports.createElement(JO.Provider,{value:i},e)}function Z0e(){let{matches:i}=ue.exports.useContext(vd),e=i[i.length-1];return e?e.params:{}}function B9(i){let{matches:e}=ue.exports.useContext(vd),{pathname:t}=AA(),n=JSON.stringify(e.map(r=>r.pathnameBase));return ue.exports.useMemo(()=>R9(i,JSON.parse(n),t),[i,n,t])}function jO(i,e){nC()||Yo(!1);let{matches:t}=ue.exports.useContext(vd),n=t[t.length-1],r=n?n.params:{};n&&n.pathname;let s=n?n.pathnameBase:"/";n&&n.route;let o=AA(),a;if(e){var l;let u=typeof e=="string"?Ul(e):e;s==="/"||((l=u.pathname)==null?void 0:l.startsWith(s))||Yo(!1),a=u}else a=o;let c=a.pathname||"/",g=s==="/"?c:c.slice(s.length)||"/",d=qO(i,{pathname:g});return c7(d&&d.map(u=>Object.assign({},u,{params:Object.assign({},r,u.params),pathname:Ol([s,u.pathname]),pathnameBase:u.pathnameBase==="/"?s:Ol([s,u.pathnameBase])})),t)}function O2(i){let e=[];return ue.exports.Children.forEach(i,t=>{if(!ue.exports.isValidElement(t))return;if(t.type===ue.exports.Fragment){e.push.apply(e,O2(t.props.children));return}t.type!==PO&&Yo(!1);let n={caseSensitive:t.props.caseSensitive,element:t.props.element,index:t.props.index,path:t.props.path};t.props.children&&(n.children=O2(t.props.children)),e.push(n)}),e}function qO(i,e,t){t===void 0&&(t="/");let n=typeof e=="string"?Ul(e):e,r=M9(n.pathname||"/",t);if(r==null)return null;let s=S9(i);$O(s);let o=null;for(let a=0;o==null&&a<s.length;++a)o=l7(s[a],r);return o}function S9(i,e,t,n){return e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n=""),i.forEach((r,s)=>{let o={relativePath:r.path||"",caseSensitive:r.caseSensitive===!0,childrenIndex:s,route:r};o.relativePath.startsWith("/")&&(o.relativePath.startsWith(n)||Yo(!1),o.relativePath=o.relativePath.slice(n.length));let a=Ol([n,o.relativePath]),l=t.concat(o);r.children&&r.children.length>0&&(r.index===!0&&Yo(!1),S9(r.children,e,l,a)),!(r.path==null&&!r.index)&&e.push({path:a,score:o7(a,r.index),routesMeta:l})}),e}function $O(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:a7(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const e7=/^:\w+$/,t7=3,n7=2,i7=1,r7=10,s7=-2,Z9=i=>i==="*";function o7(i,e){let t=i.split("/"),n=t.length;return t.some(Z9)&&(n+=s7),e&&(n+=n7),t.filter(r=>!Z9(r)).reduce((r,s)=>r+(e7.test(s)?t7:s===""?i7:r7),n)}function a7(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function l7(i,e){let{routesMeta:t}=i,n={},r="/",s=[];for(let o=0;o<t.length;++o){let a=t[o],l=o===t.length-1,c=r==="/"?e:e.slice(r.length)||"/",g=g7({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},c);if(!g)return null;Object.assign(n,g.params);let d=a.route;s.push({params:n,pathname:Ol([r,g.pathname]),pathnameBase:Ol([r,g.pathnameBase]),route:d}),g.pathnameBase!=="/"&&(r=Ol([r,g.pathnameBase]))}return s}function c7(i,e){return e===void 0&&(e=[]),i==null?null:i.reduceRight((t,n,r)=>ue.exports.createElement(vd.Provider,{children:n.route.element!==void 0?n.route.element:ue.exports.createElement(KO,null),value:{outlet:t,matches:e.concat(i.slice(0,r+1))}}),null)}function g7(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=u7(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:n.reduce((c,g,d)=>{if(g==="*"){let u=a[d]||"";o=s.slice(0,s.length-u.length).replace(/(.)\/+$/,"$1")}return c[g]=d7(a[d]||""),c},{}),pathname:s,pathnameBase:o,pattern:i}}function u7(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(o,a)=>(n.push(a),"([^\\/]+)"));return i.endsWith("*")?(n.push("*"),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r+=t?"\\/*$":"(?:\\b|\\/|$)",[new RegExp(r,e?void 0:"i"),n]}function d7(i,e){try{return decodeURIComponent(i)}catch{return i}}function h7(i,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Ul(i):i;return{pathname:t?t.startsWith("/")?t:f7(t,e):e,search:p7(n),hash:m7(r)}}function f7(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function R9(i,e,t){let n=typeof i=="string"?Ul(i):i,r=i===""||n.pathname===""?"/":n.pathname,s;if(r==null)s=t;else{let a=e.length-1;if(r.startsWith("..")){let l=r.split("/");for(;l[0]==="..";)l.shift(),a-=1;n.pathname=l.join("/")}s=a>=0?e[a]:"/"}let o=h7(n,s);return r&&r!=="/"&&r.endsWith("/")&&!o.pathname.endsWith("/")&&(o.pathname+="/"),o}function I7(i){return i===""||i.pathname===""?"/":typeof i=="string"?Ul(i).pathname:i.pathname}function M9(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=i.charAt(e.length);return t&&t!=="/"?null:i.slice(e.length)||"/"}const Ol=i=>i.join("/").replace(/\/\/+/g,"/"),C7=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),p7=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,m7=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;/**
 * React Router DOM v6.2.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function J2(){return J2=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},J2.apply(this,arguments)}function A7(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}const b7=["onClick","reloadDocument","replace","state","target","to"];function R0e(i){let{basename:e,children:t,window:n}=i,r=ue.exports.useRef();r.current==null&&(r.current=YO({window:n}));let s=r.current,[o,a]=ue.exports.useState({action:s.action,location:s.location});return ue.exports.useLayoutEffect(()=>s.listen(a),[s]),ue.exports.createElement(DO,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:s})}function y7(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}const M0e=ue.exports.forwardRef(function(e,t){let{onClick:n,reloadDocument:r,replace:s=!1,state:o,target:a,to:l}=e,c=A7(e,b7),g=UO(l),d=v7(l,{replace:s,state:o,target:a});function u(h){n&&n(h),!h.defaultPrevented&&!r&&d(h)}return ue.exports.createElement("a",J2({},c,{href:g,onClick:u,ref:t,target:a}))});function v7(i,e){let{target:t,replace:n,state:r}=e===void 0?{}:e,s=OO(),o=AA(),a=B9(i);return ue.exports.useCallback(l=>{if(l.button===0&&(!t||t==="_self")&&!y7(l)){l.preventDefault();let c=!!n||tC(o)===tC(a);s(i,{replace:c,state:r})}},[o,s,a,n,r,t,i])}var yg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function bA(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Vr(i,e){return e={exports:{}},i(e,e.exports),e.exports}function W9(i){return i&&i.default||i}var x7={},w7=Object.freeze({default:x7}),G7=W9(w7),zt=Vr(function(i){(function(e,t){function n(V,I){if(!V)throw new Error(I||"Assertion failed")}function r(V,I){V.super_=I;var w=function(){};w.prototype=I.prototype,V.prototype=new w,V.prototype.constructor=V}function s(V,I,w){if(s.isBN(V))return V;this.negative=0,this.words=null,this.length=0,this.red=null,V!==null&&((I==="le"||I==="be")&&(w=I,I=10),this._init(V||0,I||10,w||"be"))}typeof e=="object"?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;var o;try{o=G7.Buffer}catch{}s.isBN=function(I){return I instanceof s?!0:I!==null&&typeof I=="object"&&I.constructor.wordSize===s.wordSize&&Array.isArray(I.words)},s.max=function(I,w){return I.cmp(w)>0?I:w},s.min=function(I,w){return I.cmp(w)<0?I:w},s.prototype._init=function(I,w,S){if(typeof I=="number")return this._initNumber(I,w,S);if(typeof I=="object")return this._initArray(I,w,S);w==="hex"&&(w=16),n(w===(w|0)&&w>=2&&w<=36),I=I.toString().replace(/\s+/g,"");var R=0;I[0]==="-"&&R++,w===16?this._parseHex(I,R):this._parseBase(I,w,R),I[0]==="-"&&(this.negative=1),this.strip(),S==="le"&&this._initArray(this.toArray(),w,S)},s.prototype._initNumber=function(I,w,S){I<0&&(this.negative=1,I=-I),I<67108864?(this.words=[I&67108863],this.length=1):I<4503599627370496?(this.words=[I&67108863,I/67108864&67108863],this.length=2):(n(I<9007199254740992),this.words=[I&67108863,I/67108864&67108863,1],this.length=3),S==="le"&&this._initArray(this.toArray(),w,S)},s.prototype._initArray=function(I,w,S){if(n(typeof I.length=="number"),I.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(I.length/3),this.words=new Array(this.length);for(var R=0;R<this.length;R++)this.words[R]=0;var W,H,k=0;if(S==="be")for(R=I.length-1,W=0;R>=0;R-=3)H=I[R]|I[R-1]<<8|I[R-2]<<16,this.words[W]|=H<<k&67108863,this.words[W+1]=H>>>26-k&67108863,k+=24,k>=26&&(k-=26,W++);else if(S==="le")for(R=0,W=0;R<I.length;R+=3)H=I[R]|I[R+1]<<8|I[R+2]<<16,this.words[W]|=H<<k&67108863,this.words[W+1]=H>>>26-k&67108863,k+=24,k>=26&&(k-=26,W++);return this.strip()};function a(V,I,w){for(var S=0,R=Math.min(V.length,w),W=I;W<R;W++){var H=V.charCodeAt(W)-48;S<<=4,H>=49&&H<=54?S|=H-49+10:H>=17&&H<=22?S|=H-17+10:S|=H&15}return S}s.prototype._parseHex=function(I,w){this.length=Math.ceil((I.length-w)/6),this.words=new Array(this.length);for(var S=0;S<this.length;S++)this.words[S]=0;var R,W,H=0;for(S=I.length-6,R=0;S>=w;S-=6)W=a(I,S,S+6),this.words[R]|=W<<H&67108863,this.words[R+1]|=W>>>26-H&4194303,H+=24,H>=26&&(H-=26,R++);S+6!==w&&(W=a(I,w,S+6),this.words[R]|=W<<H&67108863,this.words[R+1]|=W>>>26-H&4194303),this.strip()};function l(V,I,w,S){for(var R=0,W=Math.min(V.length,w),H=I;H<W;H++){var k=V.charCodeAt(H)-48;R*=S,k>=49?R+=k-49+10:k>=17?R+=k-17+10:R+=k}return R}s.prototype._parseBase=function(I,w,S){this.words=[0],this.length=1;for(var R=0,W=1;W<=67108863;W*=w)R++;R--,W=W/w|0;for(var H=I.length-S,k=H%R,_=Math.min(H,H-k)+S,Z=0,T=S;T<_;T+=R)Z=l(I,T,T+R,w),this.imuln(W),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z);if(k!==0){var F=1;for(Z=l(I,T,I.length,w),T=0;T<k;T++)F*=w;this.imuln(F),this.words[0]+Z<67108864?this.words[0]+=Z:this._iaddn(Z)}},s.prototype.copy=function(I){I.words=new Array(this.length);for(var w=0;w<this.length;w++)I.words[w]=this.words[w];I.length=this.length,I.negative=this.negative,I.red=this.red},s.prototype.clone=function(){var I=new s(null);return this.copy(I),I},s.prototype._expand=function(I){for(;this.length<I;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],g=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(I,w){I=I||10,w=w|0||1;var S;if(I===16||I==="hex"){S="";for(var R=0,W=0,H=0;H<this.length;H++){var k=this.words[H],_=((k<<R|W)&16777215).toString(16);W=k>>>24-R&16777215,W!==0||H!==this.length-1?S=c[6-_.length]+_+S:S=_+S,R+=2,R>=26&&(R-=26,H--)}for(W!==0&&(S=W.toString(16)+S);S.length%w!=0;)S="0"+S;return this.negative!==0&&(S="-"+S),S}if(I===(I|0)&&I>=2&&I<=36){var Z=g[I],T=d[I];S="";var F=this.clone();for(F.negative=0;!F.isZero();){var K=F.modn(T).toString(I);F=F.idivn(T),F.isZero()?S=K+S:S=c[Z-K.length]+K+S}for(this.isZero()&&(S="0"+S);S.length%w!=0;)S="0"+S;return this.negative!==0&&(S="-"+S),S}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var I=this.words[0];return this.length===2?I+=this.words[1]*67108864:this.length===3&&this.words[2]===1?I+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-I:I},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(I,w){return n(typeof o!="undefined"),this.toArrayLike(o,I,w)},s.prototype.toArray=function(I,w){return this.toArrayLike(Array,I,w)},s.prototype.toArrayLike=function(I,w,S){var R=this.byteLength(),W=S||Math.max(1,R);n(R<=W,"byte array longer than desired length"),n(W>0,"Requested array length <= 0"),this.strip();var H=w==="le",k=new I(W),_,Z,T=this.clone();if(H){for(Z=0;!T.isZero();Z++)_=T.andln(255),T.iushrn(8),k[Z]=_;for(;Z<W;Z++)k[Z]=0}else{for(Z=0;Z<W-R;Z++)k[Z]=0;for(Z=0;!T.isZero();Z++)_=T.andln(255),T.iushrn(8),k[W-Z-1]=_}return k},Math.clz32?s.prototype._countBits=function(I){return 32-Math.clz32(I)}:s.prototype._countBits=function(I){var w=I,S=0;return w>=4096&&(S+=13,w>>>=13),w>=64&&(S+=7,w>>>=7),w>=8&&(S+=4,w>>>=4),w>=2&&(S+=2,w>>>=2),S+w},s.prototype._zeroBits=function(I){if(I===0)return 26;var w=I,S=0;return(w&8191)==0&&(S+=13,w>>>=13),(w&127)==0&&(S+=7,w>>>=7),(w&15)==0&&(S+=4,w>>>=4),(w&3)==0&&(S+=2,w>>>=2),(w&1)==0&&S++,S},s.prototype.bitLength=function(){var I=this.words[this.length-1],w=this._countBits(I);return(this.length-1)*26+w};function u(V){for(var I=new Array(V.bitLength()),w=0;w<I.length;w++){var S=w/26|0,R=w%26;I[w]=(V.words[S]&1<<R)>>>R}return I}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var I=0,w=0;w<this.length;w++){var S=this._zeroBits(this.words[w]);if(I+=S,S!==26)break}return I},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(I){return this.negative!==0?this.abs().inotn(I).iaddn(1):this.clone()},s.prototype.fromTwos=function(I){return this.testn(I-1)?this.notn(I).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(I){for(;this.length<I.length;)this.words[this.length++]=0;for(var w=0;w<I.length;w++)this.words[w]=this.words[w]|I.words[w];return this.strip()},s.prototype.ior=function(I){return n((this.negative|I.negative)==0),this.iuor(I)},s.prototype.or=function(I){return this.length>I.length?this.clone().ior(I):I.clone().ior(this)},s.prototype.uor=function(I){return this.length>I.length?this.clone().iuor(I):I.clone().iuor(this)},s.prototype.iuand=function(I){var w;this.length>I.length?w=I:w=this;for(var S=0;S<w.length;S++)this.words[S]=this.words[S]&I.words[S];return this.length=w.length,this.strip()},s.prototype.iand=function(I){return n((this.negative|I.negative)==0),this.iuand(I)},s.prototype.and=function(I){return this.length>I.length?this.clone().iand(I):I.clone().iand(this)},s.prototype.uand=function(I){return this.length>I.length?this.clone().iuand(I):I.clone().iuand(this)},s.prototype.iuxor=function(I){var w,S;this.length>I.length?(w=this,S=I):(w=I,S=this);for(var R=0;R<S.length;R++)this.words[R]=w.words[R]^S.words[R];if(this!==w)for(;R<w.length;R++)this.words[R]=w.words[R];return this.length=w.length,this.strip()},s.prototype.ixor=function(I){return n((this.negative|I.negative)==0),this.iuxor(I)},s.prototype.xor=function(I){return this.length>I.length?this.clone().ixor(I):I.clone().ixor(this)},s.prototype.uxor=function(I){return this.length>I.length?this.clone().iuxor(I):I.clone().iuxor(this)},s.prototype.inotn=function(I){n(typeof I=="number"&&I>=0);var w=Math.ceil(I/26)|0,S=I%26;this._expand(w),S>0&&w--;for(var R=0;R<w;R++)this.words[R]=~this.words[R]&67108863;return S>0&&(this.words[R]=~this.words[R]&67108863>>26-S),this.strip()},s.prototype.notn=function(I){return this.clone().inotn(I)},s.prototype.setn=function(I,w){n(typeof I=="number"&&I>=0);var S=I/26|0,R=I%26;return this._expand(S+1),w?this.words[S]=this.words[S]|1<<R:this.words[S]=this.words[S]&~(1<<R),this.strip()},s.prototype.iadd=function(I){var w;if(this.negative!==0&&I.negative===0)return this.negative=0,w=this.isub(I),this.negative^=1,this._normSign();if(this.negative===0&&I.negative!==0)return I.negative=0,w=this.isub(I),I.negative=1,w._normSign();var S,R;this.length>I.length?(S=this,R=I):(S=I,R=this);for(var W=0,H=0;H<R.length;H++)w=(S.words[H]|0)+(R.words[H]|0)+W,this.words[H]=w&67108863,W=w>>>26;for(;W!==0&&H<S.length;H++)w=(S.words[H]|0)+W,this.words[H]=w&67108863,W=w>>>26;if(this.length=S.length,W!==0)this.words[this.length]=W,this.length++;else if(S!==this)for(;H<S.length;H++)this.words[H]=S.words[H];return this},s.prototype.add=function(I){var w;return I.negative!==0&&this.negative===0?(I.negative=0,w=this.sub(I),I.negative^=1,w):I.negative===0&&this.negative!==0?(this.negative=0,w=I.sub(this),this.negative=1,w):this.length>I.length?this.clone().iadd(I):I.clone().iadd(this)},s.prototype.isub=function(I){if(I.negative!==0){I.negative=0;var w=this.iadd(I);return I.negative=1,w._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(I),this.negative=1,this._normSign();var S=this.cmp(I);if(S===0)return this.negative=0,this.length=1,this.words[0]=0,this;var R,W;S>0?(R=this,W=I):(R=I,W=this);for(var H=0,k=0;k<W.length;k++)w=(R.words[k]|0)-(W.words[k]|0)+H,H=w>>26,this.words[k]=w&67108863;for(;H!==0&&k<R.length;k++)w=(R.words[k]|0)+H,H=w>>26,this.words[k]=w&67108863;if(H===0&&k<R.length&&R!==this)for(;k<R.length;k++)this.words[k]=R.words[k];return this.length=Math.max(this.length,k),R!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(I){return this.clone().isub(I)};function h(V,I,w){w.negative=I.negative^V.negative;var S=V.length+I.length|0;w.length=S,S=S-1|0;var R=V.words[0]|0,W=I.words[0]|0,H=R*W,k=H&67108863,_=H/67108864|0;w.words[0]=k;for(var Z=1;Z<S;Z++){for(var T=_>>>26,F=_&67108863,K=Math.min(Z,I.length-1),j=Math.max(0,Z-V.length+1);j<=K;j++){var O=Z-j|0;R=V.words[O]|0,W=I.words[j]|0,H=R*W+F,T+=H/67108864|0,F=H&67108863}w.words[Z]=F|0,_=T|0}return _!==0?w.words[Z]=_|0:w.length--,w.strip()}var p=function(I,w,S){var R=I.words,W=w.words,H=S.words,k=0,_,Z,T,F=R[0]|0,K=F&8191,j=F>>>13,O=R[1]|0,Y=O&8191,ee=O>>>13,ye=R[2]|0,Ce=ye&8191,he=ye>>>13,Ne=R[3]|0,He=Ne&8191,ne=Ne>>>13,de=R[4]|0,Ie=de&8191,Be=de>>>13,Re=R[5]|0,Xe=Re&8191,Le=Re>>>13,Qe=R[6]|0,et=Qe&8191,q=Qe>>>13,X=R[7]|0,D=X&8191,ge=X>>>13,Se=R[8]|0,Me=Se&8191,pe=Se>>>13,we=R[9]|0,re=we&8191,be=we>>>13,_e=W[0]|0,Ee=_e&8191,U=_e>>>13,Fe=W[1]|0,Ze=Fe&8191,Ye=Fe>>>13,me=W[2]|0,Ge=me&8191,Pe=me>>>13,ht=W[3]|0,wt=ht&8191,nt=ht>>>13,un=W[4]|0,Et=un&8191,Jt=un>>>13,sr=W[5]|0,en=sr&8191,qt=sr>>>13,Yr=W[6]|0,ln=Yr&8191,cn=Yr>>>13,ie=W[7]|0,P=ie&8191,$=ie>>>13,le=W[8]|0,ae=le&8191,xe=le>>>13,Je=W[9]|0,De=Je&8191,Ue=Je>>>13;S.negative=I.negative^w.negative,S.length=19,_=Math.imul(K,Ee),Z=Math.imul(K,U),Z=Z+Math.imul(j,Ee)|0,T=Math.imul(j,U);var st=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(st>>>26)|0,st&=67108863,_=Math.imul(Y,Ee),Z=Math.imul(Y,U),Z=Z+Math.imul(ee,Ee)|0,T=Math.imul(ee,U),_=_+Math.imul(K,Ze)|0,Z=Z+Math.imul(K,Ye)|0,Z=Z+Math.imul(j,Ze)|0,T=T+Math.imul(j,Ye)|0;var ut=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(ut>>>26)|0,ut&=67108863,_=Math.imul(Ce,Ee),Z=Math.imul(Ce,U),Z=Z+Math.imul(he,Ee)|0,T=Math.imul(he,U),_=_+Math.imul(Y,Ze)|0,Z=Z+Math.imul(Y,Ye)|0,Z=Z+Math.imul(ee,Ze)|0,T=T+Math.imul(ee,Ye)|0,_=_+Math.imul(K,Ge)|0,Z=Z+Math.imul(K,Pe)|0,Z=Z+Math.imul(j,Ge)|0,T=T+Math.imul(j,Pe)|0;var ct=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(ct>>>26)|0,ct&=67108863,_=Math.imul(He,Ee),Z=Math.imul(He,U),Z=Z+Math.imul(ne,Ee)|0,T=Math.imul(ne,U),_=_+Math.imul(Ce,Ze)|0,Z=Z+Math.imul(Ce,Ye)|0,Z=Z+Math.imul(he,Ze)|0,T=T+Math.imul(he,Ye)|0,_=_+Math.imul(Y,Ge)|0,Z=Z+Math.imul(Y,Pe)|0,Z=Z+Math.imul(ee,Ge)|0,T=T+Math.imul(ee,Pe)|0,_=_+Math.imul(K,wt)|0,Z=Z+Math.imul(K,nt)|0,Z=Z+Math.imul(j,wt)|0,T=T+Math.imul(j,nt)|0;var mt=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(mt>>>26)|0,mt&=67108863,_=Math.imul(Ie,Ee),Z=Math.imul(Ie,U),Z=Z+Math.imul(Be,Ee)|0,T=Math.imul(Be,U),_=_+Math.imul(He,Ze)|0,Z=Z+Math.imul(He,Ye)|0,Z=Z+Math.imul(ne,Ze)|0,T=T+Math.imul(ne,Ye)|0,_=_+Math.imul(Ce,Ge)|0,Z=Z+Math.imul(Ce,Pe)|0,Z=Z+Math.imul(he,Ge)|0,T=T+Math.imul(he,Pe)|0,_=_+Math.imul(Y,wt)|0,Z=Z+Math.imul(Y,nt)|0,Z=Z+Math.imul(ee,wt)|0,T=T+Math.imul(ee,nt)|0,_=_+Math.imul(K,Et)|0,Z=Z+Math.imul(K,Jt)|0,Z=Z+Math.imul(j,Et)|0,T=T+Math.imul(j,Jt)|0;var Pt=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,_=Math.imul(Xe,Ee),Z=Math.imul(Xe,U),Z=Z+Math.imul(Le,Ee)|0,T=Math.imul(Le,U),_=_+Math.imul(Ie,Ze)|0,Z=Z+Math.imul(Ie,Ye)|0,Z=Z+Math.imul(Be,Ze)|0,T=T+Math.imul(Be,Ye)|0,_=_+Math.imul(He,Ge)|0,Z=Z+Math.imul(He,Pe)|0,Z=Z+Math.imul(ne,Ge)|0,T=T+Math.imul(ne,Pe)|0,_=_+Math.imul(Ce,wt)|0,Z=Z+Math.imul(Ce,nt)|0,Z=Z+Math.imul(he,wt)|0,T=T+Math.imul(he,nt)|0,_=_+Math.imul(Y,Et)|0,Z=Z+Math.imul(Y,Jt)|0,Z=Z+Math.imul(ee,Et)|0,T=T+Math.imul(ee,Jt)|0,_=_+Math.imul(K,en)|0,Z=Z+Math.imul(K,qt)|0,Z=Z+Math.imul(j,en)|0,T=T+Math.imul(j,qt)|0;var ei=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(ei>>>26)|0,ei&=67108863,_=Math.imul(et,Ee),Z=Math.imul(et,U),Z=Z+Math.imul(q,Ee)|0,T=Math.imul(q,U),_=_+Math.imul(Xe,Ze)|0,Z=Z+Math.imul(Xe,Ye)|0,Z=Z+Math.imul(Le,Ze)|0,T=T+Math.imul(Le,Ye)|0,_=_+Math.imul(Ie,Ge)|0,Z=Z+Math.imul(Ie,Pe)|0,Z=Z+Math.imul(Be,Ge)|0,T=T+Math.imul(Be,Pe)|0,_=_+Math.imul(He,wt)|0,Z=Z+Math.imul(He,nt)|0,Z=Z+Math.imul(ne,wt)|0,T=T+Math.imul(ne,nt)|0,_=_+Math.imul(Ce,Et)|0,Z=Z+Math.imul(Ce,Jt)|0,Z=Z+Math.imul(he,Et)|0,T=T+Math.imul(he,Jt)|0,_=_+Math.imul(Y,en)|0,Z=Z+Math.imul(Y,qt)|0,Z=Z+Math.imul(ee,en)|0,T=T+Math.imul(ee,qt)|0,_=_+Math.imul(K,ln)|0,Z=Z+Math.imul(K,cn)|0,Z=Z+Math.imul(j,ln)|0,T=T+Math.imul(j,cn)|0;var Ht=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Ht>>>26)|0,Ht&=67108863,_=Math.imul(D,Ee),Z=Math.imul(D,U),Z=Z+Math.imul(ge,Ee)|0,T=Math.imul(ge,U),_=_+Math.imul(et,Ze)|0,Z=Z+Math.imul(et,Ye)|0,Z=Z+Math.imul(q,Ze)|0,T=T+Math.imul(q,Ye)|0,_=_+Math.imul(Xe,Ge)|0,Z=Z+Math.imul(Xe,Pe)|0,Z=Z+Math.imul(Le,Ge)|0,T=T+Math.imul(Le,Pe)|0,_=_+Math.imul(Ie,wt)|0,Z=Z+Math.imul(Ie,nt)|0,Z=Z+Math.imul(Be,wt)|0,T=T+Math.imul(Be,nt)|0,_=_+Math.imul(He,Et)|0,Z=Z+Math.imul(He,Jt)|0,Z=Z+Math.imul(ne,Et)|0,T=T+Math.imul(ne,Jt)|0,_=_+Math.imul(Ce,en)|0,Z=Z+Math.imul(Ce,qt)|0,Z=Z+Math.imul(he,en)|0,T=T+Math.imul(he,qt)|0,_=_+Math.imul(Y,ln)|0,Z=Z+Math.imul(Y,cn)|0,Z=Z+Math.imul(ee,ln)|0,T=T+Math.imul(ee,cn)|0,_=_+Math.imul(K,P)|0,Z=Z+Math.imul(K,$)|0,Z=Z+Math.imul(j,P)|0,T=T+Math.imul(j,$)|0;var Ln=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,_=Math.imul(Me,Ee),Z=Math.imul(Me,U),Z=Z+Math.imul(pe,Ee)|0,T=Math.imul(pe,U),_=_+Math.imul(D,Ze)|0,Z=Z+Math.imul(D,Ye)|0,Z=Z+Math.imul(ge,Ze)|0,T=T+Math.imul(ge,Ye)|0,_=_+Math.imul(et,Ge)|0,Z=Z+Math.imul(et,Pe)|0,Z=Z+Math.imul(q,Ge)|0,T=T+Math.imul(q,Pe)|0,_=_+Math.imul(Xe,wt)|0,Z=Z+Math.imul(Xe,nt)|0,Z=Z+Math.imul(Le,wt)|0,T=T+Math.imul(Le,nt)|0,_=_+Math.imul(Ie,Et)|0,Z=Z+Math.imul(Ie,Jt)|0,Z=Z+Math.imul(Be,Et)|0,T=T+Math.imul(Be,Jt)|0,_=_+Math.imul(He,en)|0,Z=Z+Math.imul(He,qt)|0,Z=Z+Math.imul(ne,en)|0,T=T+Math.imul(ne,qt)|0,_=_+Math.imul(Ce,ln)|0,Z=Z+Math.imul(Ce,cn)|0,Z=Z+Math.imul(he,ln)|0,T=T+Math.imul(he,cn)|0,_=_+Math.imul(Y,P)|0,Z=Z+Math.imul(Y,$)|0,Z=Z+Math.imul(ee,P)|0,T=T+Math.imul(ee,$)|0,_=_+Math.imul(K,ae)|0,Z=Z+Math.imul(K,xe)|0,Z=Z+Math.imul(j,ae)|0,T=T+Math.imul(j,xe)|0;var kt=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(kt>>>26)|0,kt&=67108863,_=Math.imul(re,Ee),Z=Math.imul(re,U),Z=Z+Math.imul(be,Ee)|0,T=Math.imul(be,U),_=_+Math.imul(Me,Ze)|0,Z=Z+Math.imul(Me,Ye)|0,Z=Z+Math.imul(pe,Ze)|0,T=T+Math.imul(pe,Ye)|0,_=_+Math.imul(D,Ge)|0,Z=Z+Math.imul(D,Pe)|0,Z=Z+Math.imul(ge,Ge)|0,T=T+Math.imul(ge,Pe)|0,_=_+Math.imul(et,wt)|0,Z=Z+Math.imul(et,nt)|0,Z=Z+Math.imul(q,wt)|0,T=T+Math.imul(q,nt)|0,_=_+Math.imul(Xe,Et)|0,Z=Z+Math.imul(Xe,Jt)|0,Z=Z+Math.imul(Le,Et)|0,T=T+Math.imul(Le,Jt)|0,_=_+Math.imul(Ie,en)|0,Z=Z+Math.imul(Ie,qt)|0,Z=Z+Math.imul(Be,en)|0,T=T+Math.imul(Be,qt)|0,_=_+Math.imul(He,ln)|0,Z=Z+Math.imul(He,cn)|0,Z=Z+Math.imul(ne,ln)|0,T=T+Math.imul(ne,cn)|0,_=_+Math.imul(Ce,P)|0,Z=Z+Math.imul(Ce,$)|0,Z=Z+Math.imul(he,P)|0,T=T+Math.imul(he,$)|0,_=_+Math.imul(Y,ae)|0,Z=Z+Math.imul(Y,xe)|0,Z=Z+Math.imul(ee,ae)|0,T=T+Math.imul(ee,xe)|0,_=_+Math.imul(K,De)|0,Z=Z+Math.imul(K,Ue)|0,Z=Z+Math.imul(j,De)|0,T=T+Math.imul(j,Ue)|0;var St=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(St>>>26)|0,St&=67108863,_=Math.imul(re,Ze),Z=Math.imul(re,Ye),Z=Z+Math.imul(be,Ze)|0,T=Math.imul(be,Ye),_=_+Math.imul(Me,Ge)|0,Z=Z+Math.imul(Me,Pe)|0,Z=Z+Math.imul(pe,Ge)|0,T=T+Math.imul(pe,Pe)|0,_=_+Math.imul(D,wt)|0,Z=Z+Math.imul(D,nt)|0,Z=Z+Math.imul(ge,wt)|0,T=T+Math.imul(ge,nt)|0,_=_+Math.imul(et,Et)|0,Z=Z+Math.imul(et,Jt)|0,Z=Z+Math.imul(q,Et)|0,T=T+Math.imul(q,Jt)|0,_=_+Math.imul(Xe,en)|0,Z=Z+Math.imul(Xe,qt)|0,Z=Z+Math.imul(Le,en)|0,T=T+Math.imul(Le,qt)|0,_=_+Math.imul(Ie,ln)|0,Z=Z+Math.imul(Ie,cn)|0,Z=Z+Math.imul(Be,ln)|0,T=T+Math.imul(Be,cn)|0,_=_+Math.imul(He,P)|0,Z=Z+Math.imul(He,$)|0,Z=Z+Math.imul(ne,P)|0,T=T+Math.imul(ne,$)|0,_=_+Math.imul(Ce,ae)|0,Z=Z+Math.imul(Ce,xe)|0,Z=Z+Math.imul(he,ae)|0,T=T+Math.imul(he,xe)|0,_=_+Math.imul(Y,De)|0,Z=Z+Math.imul(Y,Ue)|0,Z=Z+Math.imul(ee,De)|0,T=T+Math.imul(ee,Ue)|0;var Yt=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,_=Math.imul(re,Ge),Z=Math.imul(re,Pe),Z=Z+Math.imul(be,Ge)|0,T=Math.imul(be,Pe),_=_+Math.imul(Me,wt)|0,Z=Z+Math.imul(Me,nt)|0,Z=Z+Math.imul(pe,wt)|0,T=T+Math.imul(pe,nt)|0,_=_+Math.imul(D,Et)|0,Z=Z+Math.imul(D,Jt)|0,Z=Z+Math.imul(ge,Et)|0,T=T+Math.imul(ge,Jt)|0,_=_+Math.imul(et,en)|0,Z=Z+Math.imul(et,qt)|0,Z=Z+Math.imul(q,en)|0,T=T+Math.imul(q,qt)|0,_=_+Math.imul(Xe,ln)|0,Z=Z+Math.imul(Xe,cn)|0,Z=Z+Math.imul(Le,ln)|0,T=T+Math.imul(Le,cn)|0,_=_+Math.imul(Ie,P)|0,Z=Z+Math.imul(Ie,$)|0,Z=Z+Math.imul(Be,P)|0,T=T+Math.imul(Be,$)|0,_=_+Math.imul(He,ae)|0,Z=Z+Math.imul(He,xe)|0,Z=Z+Math.imul(ne,ae)|0,T=T+Math.imul(ne,xe)|0,_=_+Math.imul(Ce,De)|0,Z=Z+Math.imul(Ce,Ue)|0,Z=Z+Math.imul(he,De)|0,T=T+Math.imul(he,Ue)|0;var yt=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(yt>>>26)|0,yt&=67108863,_=Math.imul(re,wt),Z=Math.imul(re,nt),Z=Z+Math.imul(be,wt)|0,T=Math.imul(be,nt),_=_+Math.imul(Me,Et)|0,Z=Z+Math.imul(Me,Jt)|0,Z=Z+Math.imul(pe,Et)|0,T=T+Math.imul(pe,Jt)|0,_=_+Math.imul(D,en)|0,Z=Z+Math.imul(D,qt)|0,Z=Z+Math.imul(ge,en)|0,T=T+Math.imul(ge,qt)|0,_=_+Math.imul(et,ln)|0,Z=Z+Math.imul(et,cn)|0,Z=Z+Math.imul(q,ln)|0,T=T+Math.imul(q,cn)|0,_=_+Math.imul(Xe,P)|0,Z=Z+Math.imul(Xe,$)|0,Z=Z+Math.imul(Le,P)|0,T=T+Math.imul(Le,$)|0,_=_+Math.imul(Ie,ae)|0,Z=Z+Math.imul(Ie,xe)|0,Z=Z+Math.imul(Be,ae)|0,T=T+Math.imul(Be,xe)|0,_=_+Math.imul(He,De)|0,Z=Z+Math.imul(He,Ue)|0,Z=Z+Math.imul(ne,De)|0,T=T+Math.imul(ne,Ue)|0;var sn=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(sn>>>26)|0,sn&=67108863,_=Math.imul(re,Et),Z=Math.imul(re,Jt),Z=Z+Math.imul(be,Et)|0,T=Math.imul(be,Jt),_=_+Math.imul(Me,en)|0,Z=Z+Math.imul(Me,qt)|0,Z=Z+Math.imul(pe,en)|0,T=T+Math.imul(pe,qt)|0,_=_+Math.imul(D,ln)|0,Z=Z+Math.imul(D,cn)|0,Z=Z+Math.imul(ge,ln)|0,T=T+Math.imul(ge,cn)|0,_=_+Math.imul(et,P)|0,Z=Z+Math.imul(et,$)|0,Z=Z+Math.imul(q,P)|0,T=T+Math.imul(q,$)|0,_=_+Math.imul(Xe,ae)|0,Z=Z+Math.imul(Xe,xe)|0,Z=Z+Math.imul(Le,ae)|0,T=T+Math.imul(Le,xe)|0,_=_+Math.imul(Ie,De)|0,Z=Z+Math.imul(Ie,Ue)|0,Z=Z+Math.imul(Be,De)|0,T=T+Math.imul(Be,Ue)|0;var Ft=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,_=Math.imul(re,en),Z=Math.imul(re,qt),Z=Z+Math.imul(be,en)|0,T=Math.imul(be,qt),_=_+Math.imul(Me,ln)|0,Z=Z+Math.imul(Me,cn)|0,Z=Z+Math.imul(pe,ln)|0,T=T+Math.imul(pe,cn)|0,_=_+Math.imul(D,P)|0,Z=Z+Math.imul(D,$)|0,Z=Z+Math.imul(ge,P)|0,T=T+Math.imul(ge,$)|0,_=_+Math.imul(et,ae)|0,Z=Z+Math.imul(et,xe)|0,Z=Z+Math.imul(q,ae)|0,T=T+Math.imul(q,xe)|0,_=_+Math.imul(Xe,De)|0,Z=Z+Math.imul(Xe,Ue)|0,Z=Z+Math.imul(Le,De)|0,T=T+Math.imul(Le,Ue)|0;var In=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(In>>>26)|0,In&=67108863,_=Math.imul(re,ln),Z=Math.imul(re,cn),Z=Z+Math.imul(be,ln)|0,T=Math.imul(be,cn),_=_+Math.imul(Me,P)|0,Z=Z+Math.imul(Me,$)|0,Z=Z+Math.imul(pe,P)|0,T=T+Math.imul(pe,$)|0,_=_+Math.imul(D,ae)|0,Z=Z+Math.imul(D,xe)|0,Z=Z+Math.imul(ge,ae)|0,T=T+Math.imul(ge,xe)|0,_=_+Math.imul(et,De)|0,Z=Z+Math.imul(et,Ue)|0,Z=Z+Math.imul(q,De)|0,T=T+Math.imul(q,Ue)|0;var Bn=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,_=Math.imul(re,P),Z=Math.imul(re,$),Z=Z+Math.imul(be,P)|0,T=Math.imul(be,$),_=_+Math.imul(Me,ae)|0,Z=Z+Math.imul(Me,xe)|0,Z=Z+Math.imul(pe,ae)|0,T=T+Math.imul(pe,xe)|0,_=_+Math.imul(D,De)|0,Z=Z+Math.imul(D,Ue)|0,Z=Z+Math.imul(ge,De)|0,T=T+Math.imul(ge,Ue)|0;var Sn=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Sn>>>26)|0,Sn&=67108863,_=Math.imul(re,ae),Z=Math.imul(re,xe),Z=Z+Math.imul(be,ae)|0,T=Math.imul(be,xe),_=_+Math.imul(Me,De)|0,Z=Z+Math.imul(Me,Ue)|0,Z=Z+Math.imul(pe,De)|0,T=T+Math.imul(pe,Ue)|0;var Yn=(k+_|0)+((Z&8191)<<13)|0;k=(T+(Z>>>13)|0)+(Yn>>>26)|0,Yn&=67108863,_=Math.imul(re,De),Z=Math.imul(re,Ue),Z=Z+Math.imul(be,De)|0,T=Math.imul(be,Ue);var Rs=(k+_|0)+((Z&8191)<<13)|0;return k=(T+(Z>>>13)|0)+(Rs>>>26)|0,Rs&=67108863,H[0]=st,H[1]=ut,H[2]=ct,H[3]=mt,H[4]=Pt,H[5]=ei,H[6]=Ht,H[7]=Ln,H[8]=kt,H[9]=St,H[10]=Yt,H[11]=yt,H[12]=sn,H[13]=Ft,H[14]=In,H[15]=Bn,H[16]=Sn,H[17]=Yn,H[18]=Rs,k!==0&&(H[19]=k,S.length++),S};Math.imul||(p=h);function b(V,I,w){w.negative=I.negative^V.negative,w.length=V.length+I.length;for(var S=0,R=0,W=0;W<w.length-1;W++){var H=R;R=0;for(var k=S&67108863,_=Math.min(W,I.length-1),Z=Math.max(0,W-V.length+1);Z<=_;Z++){var T=W-Z,F=V.words[T]|0,K=I.words[Z]|0,j=F*K,O=j&67108863;H=H+(j/67108864|0)|0,O=O+k|0,k=O&67108863,H=H+(O>>>26)|0,R+=H>>>26,H&=67108863}w.words[W]=k,S=H,H=R}return S!==0?w.words[W]=S:w.length--,w.strip()}function y(V,I,w){var S=new m;return S.mulp(V,I,w)}s.prototype.mulTo=function(I,w){var S,R=this.length+I.length;return this.length===10&&I.length===10?S=p(this,I,w):R<63?S=h(this,I,w):R<1024?S=b(this,I,w):S=y(this,I,w),S};function m(V,I){this.x=V,this.y=I}m.prototype.makeRBT=function(I){for(var w=new Array(I),S=s.prototype._countBits(I)-1,R=0;R<I;R++)w[R]=this.revBin(R,S,I);return w},m.prototype.revBin=function(I,w,S){if(I===0||I===S-1)return I;for(var R=0,W=0;W<w;W++)R|=(I&1)<<w-W-1,I>>=1;return R},m.prototype.permute=function(I,w,S,R,W,H){for(var k=0;k<H;k++)R[k]=w[I[k]],W[k]=S[I[k]]},m.prototype.transform=function(I,w,S,R,W,H){this.permute(H,I,w,S,R,W);for(var k=1;k<W;k<<=1)for(var _=k<<1,Z=Math.cos(2*Math.PI/_),T=Math.sin(2*Math.PI/_),F=0;F<W;F+=_)for(var K=Z,j=T,O=0;O<k;O++){var Y=S[F+O],ee=R[F+O],ye=S[F+O+k],Ce=R[F+O+k],he=K*ye-j*Ce;Ce=K*Ce+j*ye,ye=he,S[F+O]=Y+ye,R[F+O]=ee+Ce,S[F+O+k]=Y-ye,R[F+O+k]=ee-Ce,O!==_&&(he=Z*K-T*j,j=Z*j+T*K,K=he)}},m.prototype.guessLen13b=function(I,w){var S=Math.max(w,I)|1,R=S&1,W=0;for(S=S/2|0;S;S=S>>>1)W++;return 1<<W+1+R},m.prototype.conjugate=function(I,w,S){if(!(S<=1))for(var R=0;R<S/2;R++){var W=I[R];I[R]=I[S-R-1],I[S-R-1]=W,W=w[R],w[R]=-w[S-R-1],w[S-R-1]=-W}},m.prototype.normalize13b=function(I,w){for(var S=0,R=0;R<w/2;R++){var W=Math.round(I[2*R+1]/w)*8192+Math.round(I[2*R]/w)+S;I[R]=W&67108863,W<67108864?S=0:S=W/67108864|0}return I},m.prototype.convert13b=function(I,w,S,R){for(var W=0,H=0;H<w;H++)W=W+(I[H]|0),S[2*H]=W&8191,W=W>>>13,S[2*H+1]=W&8191,W=W>>>13;for(H=2*w;H<R;++H)S[H]=0;n(W===0),n((W&~8191)==0)},m.prototype.stub=function(I){for(var w=new Array(I),S=0;S<I;S++)w[S]=0;return w},m.prototype.mulp=function(I,w,S){var R=2*this.guessLen13b(I.length,w.length),W=this.makeRBT(R),H=this.stub(R),k=new Array(R),_=new Array(R),Z=new Array(R),T=new Array(R),F=new Array(R),K=new Array(R),j=S.words;j.length=R,this.convert13b(I.words,I.length,k,R),this.convert13b(w.words,w.length,T,R),this.transform(k,H,_,Z,R,W),this.transform(T,H,F,K,R,W);for(var O=0;O<R;O++){var Y=_[O]*F[O]-Z[O]*K[O];Z[O]=_[O]*K[O]+Z[O]*F[O],_[O]=Y}return this.conjugate(_,Z,R),this.transform(_,Z,j,H,R,W),this.conjugate(j,H,R),this.normalize13b(j,R),S.negative=I.negative^w.negative,S.length=I.length+w.length,S.strip()},s.prototype.mul=function(I){var w=new s(null);return w.words=new Array(this.length+I.length),this.mulTo(I,w)},s.prototype.mulf=function(I){var w=new s(null);return w.words=new Array(this.length+I.length),y(this,I,w)},s.prototype.imul=function(I){return this.clone().mulTo(I,this)},s.prototype.imuln=function(I){n(typeof I=="number"),n(I<67108864);for(var w=0,S=0;S<this.length;S++){var R=(this.words[S]|0)*I,W=(R&67108863)+(w&67108863);w>>=26,w+=R/67108864|0,w+=W>>>26,this.words[S]=W&67108863}return w!==0&&(this.words[S]=w,this.length++),this},s.prototype.muln=function(I){return this.clone().imuln(I)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(I){var w=u(I);if(w.length===0)return new s(1);for(var S=this,R=0;R<w.length&&w[R]===0;R++,S=S.sqr());if(++R<w.length)for(var W=S.sqr();R<w.length;R++,W=W.sqr())w[R]!==0&&(S=S.mul(W));return S},s.prototype.iushln=function(I){n(typeof I=="number"&&I>=0);var w=I%26,S=(I-w)/26,R=67108863>>>26-w<<26-w,W;if(w!==0){var H=0;for(W=0;W<this.length;W++){var k=this.words[W]&R,_=(this.words[W]|0)-k<<w;this.words[W]=_|H,H=k>>>26-w}H&&(this.words[W]=H,this.length++)}if(S!==0){for(W=this.length-1;W>=0;W--)this.words[W+S]=this.words[W];for(W=0;W<S;W++)this.words[W]=0;this.length+=S}return this.strip()},s.prototype.ishln=function(I){return n(this.negative===0),this.iushln(I)},s.prototype.iushrn=function(I,w,S){n(typeof I=="number"&&I>=0);var R;w?R=(w-w%26)/26:R=0;var W=I%26,H=Math.min((I-W)/26,this.length),k=67108863^67108863>>>W<<W,_=S;if(R-=H,R=Math.max(0,R),_){for(var Z=0;Z<H;Z++)_.words[Z]=this.words[Z];_.length=H}if(H!==0)if(this.length>H)for(this.length-=H,Z=0;Z<this.length;Z++)this.words[Z]=this.words[Z+H];else this.words[0]=0,this.length=1;var T=0;for(Z=this.length-1;Z>=0&&(T!==0||Z>=R);Z--){var F=this.words[Z]|0;this.words[Z]=T<<26-W|F>>>W,T=F&k}return _&&T!==0&&(_.words[_.length++]=T),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(I,w,S){return n(this.negative===0),this.iushrn(I,w,S)},s.prototype.shln=function(I){return this.clone().ishln(I)},s.prototype.ushln=function(I){return this.clone().iushln(I)},s.prototype.shrn=function(I){return this.clone().ishrn(I)},s.prototype.ushrn=function(I){return this.clone().iushrn(I)},s.prototype.testn=function(I){n(typeof I=="number"&&I>=0);var w=I%26,S=(I-w)/26,R=1<<w;if(this.length<=S)return!1;var W=this.words[S];return!!(W&R)},s.prototype.imaskn=function(I){n(typeof I=="number"&&I>=0);var w=I%26,S=(I-w)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=S)return this;if(w!==0&&S++,this.length=Math.min(S,this.length),w!==0){var R=67108863^67108863>>>w<<w;this.words[this.length-1]&=R}return this.strip()},s.prototype.maskn=function(I){return this.clone().imaskn(I)},s.prototype.iaddn=function(I){return n(typeof I=="number"),n(I<67108864),I<0?this.isubn(-I):this.negative!==0?this.length===1&&(this.words[0]|0)<I?(this.words[0]=I-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(I),this.negative=1,this):this._iaddn(I)},s.prototype._iaddn=function(I){this.words[0]+=I;for(var w=0;w<this.length&&this.words[w]>=67108864;w++)this.words[w]-=67108864,w===this.length-1?this.words[w+1]=1:this.words[w+1]++;return this.length=Math.max(this.length,w+1),this},s.prototype.isubn=function(I){if(n(typeof I=="number"),n(I<67108864),I<0)return this.iaddn(-I);if(this.negative!==0)return this.negative=0,this.iaddn(I),this.negative=1,this;if(this.words[0]-=I,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var w=0;w<this.length&&this.words[w]<0;w++)this.words[w]+=67108864,this.words[w+1]-=1;return this.strip()},s.prototype.addn=function(I){return this.clone().iaddn(I)},s.prototype.subn=function(I){return this.clone().isubn(I)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(I,w,S){var R=I.length+S,W;this._expand(R);var H,k=0;for(W=0;W<I.length;W++){H=(this.words[W+S]|0)+k;var _=(I.words[W]|0)*w;H-=_&67108863,k=(H>>26)-(_/67108864|0),this.words[W+S]=H&67108863}for(;W<this.length-S;W++)H=(this.words[W+S]|0)+k,k=H>>26,this.words[W+S]=H&67108863;if(k===0)return this.strip();for(n(k===-1),k=0,W=0;W<this.length;W++)H=-(this.words[W]|0)+k,k=H>>26,this.words[W]=H&67108863;return this.negative=1,this.strip()},s.prototype._wordDiv=function(I,w){var S=this.length-I.length,R=this.clone(),W=I,H=W.words[W.length-1]|0,k=this._countBits(H);S=26-k,S!==0&&(W=W.ushln(S),R.iushln(S),H=W.words[W.length-1]|0);var _=R.length-W.length,Z;if(w!=="mod"){Z=new s(null),Z.length=_+1,Z.words=new Array(Z.length);for(var T=0;T<Z.length;T++)Z.words[T]=0}var F=R.clone()._ishlnsubmul(W,1,_);F.negative===0&&(R=F,Z&&(Z.words[_]=1));for(var K=_-1;K>=0;K--){var j=(R.words[W.length+K]|0)*67108864+(R.words[W.length+K-1]|0);for(j=Math.min(j/H|0,67108863),R._ishlnsubmul(W,j,K);R.negative!==0;)j--,R.negative=0,R._ishlnsubmul(W,1,K),R.isZero()||(R.negative^=1);Z&&(Z.words[K]=j)}return Z&&Z.strip(),R.strip(),w!=="div"&&S!==0&&R.iushrn(S),{div:Z||null,mod:R}},s.prototype.divmod=function(I,w,S){if(n(!I.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var R,W,H;return this.negative!==0&&I.negative===0?(H=this.neg().divmod(I,w),w!=="mod"&&(R=H.div.neg()),w!=="div"&&(W=H.mod.neg(),S&&W.negative!==0&&W.iadd(I)),{div:R,mod:W}):this.negative===0&&I.negative!==0?(H=this.divmod(I.neg(),w),w!=="mod"&&(R=H.div.neg()),{div:R,mod:H.mod}):(this.negative&I.negative)!=0?(H=this.neg().divmod(I.neg(),w),w!=="div"&&(W=H.mod.neg(),S&&W.negative!==0&&W.isub(I)),{div:H.div,mod:W}):I.length>this.length||this.cmp(I)<0?{div:new s(0),mod:this}:I.length===1?w==="div"?{div:this.divn(I.words[0]),mod:null}:w==="mod"?{div:null,mod:new s(this.modn(I.words[0]))}:{div:this.divn(I.words[0]),mod:new s(this.modn(I.words[0]))}:this._wordDiv(I,w)},s.prototype.div=function(I){return this.divmod(I,"div",!1).div},s.prototype.mod=function(I){return this.divmod(I,"mod",!1).mod},s.prototype.umod=function(I){return this.divmod(I,"mod",!0).mod},s.prototype.divRound=function(I){var w=this.divmod(I);if(w.mod.isZero())return w.div;var S=w.div.negative!==0?w.mod.isub(I):w.mod,R=I.ushrn(1),W=I.andln(1),H=S.cmp(R);return H<0||W===1&&H===0?w.div:w.div.negative!==0?w.div.isubn(1):w.div.iaddn(1)},s.prototype.modn=function(I){n(I<=67108863);for(var w=(1<<26)%I,S=0,R=this.length-1;R>=0;R--)S=(w*S+(this.words[R]|0))%I;return S},s.prototype.idivn=function(I){n(I<=67108863);for(var w=0,S=this.length-1;S>=0;S--){var R=(this.words[S]|0)+w*67108864;this.words[S]=R/I|0,w=R%I}return this.strip()},s.prototype.divn=function(I){return this.clone().idivn(I)},s.prototype.egcd=function(I){n(I.negative===0),n(!I.isZero());var w=this,S=I.clone();w.negative!==0?w=w.umod(I):w=w.clone();for(var R=new s(1),W=new s(0),H=new s(0),k=new s(1),_=0;w.isEven()&&S.isEven();)w.iushrn(1),S.iushrn(1),++_;for(var Z=S.clone(),T=w.clone();!w.isZero();){for(var F=0,K=1;(w.words[0]&K)==0&&F<26;++F,K<<=1);if(F>0)for(w.iushrn(F);F-- >0;)(R.isOdd()||W.isOdd())&&(R.iadd(Z),W.isub(T)),R.iushrn(1),W.iushrn(1);for(var j=0,O=1;(S.words[0]&O)==0&&j<26;++j,O<<=1);if(j>0)for(S.iushrn(j);j-- >0;)(H.isOdd()||k.isOdd())&&(H.iadd(Z),k.isub(T)),H.iushrn(1),k.iushrn(1);w.cmp(S)>=0?(w.isub(S),R.isub(H),W.isub(k)):(S.isub(w),H.isub(R),k.isub(W))}return{a:H,b:k,gcd:S.iushln(_)}},s.prototype._invmp=function(I){n(I.negative===0),n(!I.isZero());var w=this,S=I.clone();w.negative!==0?w=w.umod(I):w=w.clone();for(var R=new s(1),W=new s(0),H=S.clone();w.cmpn(1)>0&&S.cmpn(1)>0;){for(var k=0,_=1;(w.words[0]&_)==0&&k<26;++k,_<<=1);if(k>0)for(w.iushrn(k);k-- >0;)R.isOdd()&&R.iadd(H),R.iushrn(1);for(var Z=0,T=1;(S.words[0]&T)==0&&Z<26;++Z,T<<=1);if(Z>0)for(S.iushrn(Z);Z-- >0;)W.isOdd()&&W.iadd(H),W.iushrn(1);w.cmp(S)>=0?(w.isub(S),R.isub(W)):(S.isub(w),W.isub(R))}var F;return w.cmpn(1)===0?F=R:F=W,F.cmpn(0)<0&&F.iadd(I),F},s.prototype.gcd=function(I){if(this.isZero())return I.abs();if(I.isZero())return this.abs();var w=this.clone(),S=I.clone();w.negative=0,S.negative=0;for(var R=0;w.isEven()&&S.isEven();R++)w.iushrn(1),S.iushrn(1);do{for(;w.isEven();)w.iushrn(1);for(;S.isEven();)S.iushrn(1);var W=w.cmp(S);if(W<0){var H=w;w=S,S=H}else if(W===0||S.cmpn(1)===0)break;w.isub(S)}while(!0);return S.iushln(R)},s.prototype.invm=function(I){return this.egcd(I).a.umod(I)},s.prototype.isEven=function(){return(this.words[0]&1)==0},s.prototype.isOdd=function(){return(this.words[0]&1)==1},s.prototype.andln=function(I){return this.words[0]&I},s.prototype.bincn=function(I){n(typeof I=="number");var w=I%26,S=(I-w)/26,R=1<<w;if(this.length<=S)return this._expand(S+1),this.words[S]|=R,this;for(var W=R,H=S;W!==0&&H<this.length;H++){var k=this.words[H]|0;k+=W,W=k>>>26,k&=67108863,this.words[H]=k}return W!==0&&(this.words[H]=W,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(I){var w=I<0;if(this.negative!==0&&!w)return-1;if(this.negative===0&&w)return 1;this.strip();var S;if(this.length>1)S=1;else{w&&(I=-I),n(I<=67108863,"Number is too big");var R=this.words[0]|0;S=R===I?0:R<I?-1:1}return this.negative!==0?-S|0:S},s.prototype.cmp=function(I){if(this.negative!==0&&I.negative===0)return-1;if(this.negative===0&&I.negative!==0)return 1;var w=this.ucmp(I);return this.negative!==0?-w|0:w},s.prototype.ucmp=function(I){if(this.length>I.length)return 1;if(this.length<I.length)return-1;for(var w=0,S=this.length-1;S>=0;S--){var R=this.words[S]|0,W=I.words[S]|0;if(R!==W){R<W?w=-1:R>W&&(w=1);break}}return w},s.prototype.gtn=function(I){return this.cmpn(I)===1},s.prototype.gt=function(I){return this.cmp(I)===1},s.prototype.gten=function(I){return this.cmpn(I)>=0},s.prototype.gte=function(I){return this.cmp(I)>=0},s.prototype.ltn=function(I){return this.cmpn(I)===-1},s.prototype.lt=function(I){return this.cmp(I)===-1},s.prototype.lten=function(I){return this.cmpn(I)<=0},s.prototype.lte=function(I){return this.cmp(I)<=0},s.prototype.eqn=function(I){return this.cmpn(I)===0},s.prototype.eq=function(I){return this.cmp(I)===0},s.red=function(I){return new z(I)},s.prototype.toRed=function(I){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),I.convertTo(this)._forceRed(I)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(I){return this.red=I,this},s.prototype.forceRed=function(I){return n(!this.red,"Already a number in reduction context"),this._forceRed(I)},s.prototype.redAdd=function(I){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,I)},s.prototype.redIAdd=function(I){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,I)},s.prototype.redSub=function(I){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,I)},s.prototype.redISub=function(I){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,I)},s.prototype.redShl=function(I){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,I)},s.prototype.redMul=function(I){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,I),this.red.mul(this,I)},s.prototype.redIMul=function(I){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,I),this.red.imul(this,I)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(I){return n(this.red&&!I.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,I)};var f={k256:null,p224:null,p192:null,p25519:null};function G(V,I){this.name=V,this.p=new s(I,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}G.prototype._tmp=function(){var I=new s(null);return I.words=new Array(Math.ceil(this.n/13)),I},G.prototype.ireduce=function(I){var w=I,S;do this.split(w,this.tmp),w=this.imulK(w),w=w.iadd(this.tmp),S=w.bitLength();while(S>this.n);var R=S<this.n?-1:w.ucmp(this.p);return R===0?(w.words[0]=0,w.length=1):R>0?w.isub(this.p):w.strip(),w},G.prototype.split=function(I,w){I.iushrn(this.n,0,w)},G.prototype.imulK=function(I){return I.imul(this.k)};function x(){G.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}r(x,G),x.prototype.split=function(I,w){for(var S=4194303,R=Math.min(I.length,9),W=0;W<R;W++)w.words[W]=I.words[W];if(w.length=R,I.length<=9){I.words[0]=0,I.length=1;return}var H=I.words[9];for(w.words[w.length++]=H&S,W=10;W<I.length;W++){var k=I.words[W]|0;I.words[W-10]=(k&S)<<4|H>>>22,H=k}H>>>=22,I.words[W-10]=H,H===0&&I.length>10?I.length-=10:I.length-=9},x.prototype.imulK=function(I){I.words[I.length]=0,I.words[I.length+1]=0,I.length+=2;for(var w=0,S=0;S<I.length;S++){var R=I.words[S]|0;w+=R*977,I.words[S]=w&67108863,w=R*64+(w/67108864|0)}return I.words[I.length-1]===0&&(I.length--,I.words[I.length-1]===0&&I.length--),I};function B(){G.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}r(B,G);function M(){G.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}r(M,G);function E(){G.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}r(E,G),E.prototype.imulK=function(I){for(var w=0,S=0;S<I.length;S++){var R=(I.words[S]|0)*19+w,W=R&67108863;R>>>=26,I.words[S]=W,w=R}return w!==0&&(I.words[I.length++]=w),I},s._prime=function(I){if(f[I])return f[I];var w;if(I==="k256")w=new x;else if(I==="p224")w=new B;else if(I==="p192")w=new M;else if(I==="p25519")w=new E;else throw new Error("Unknown prime "+I);return f[I]=w,w};function z(V){if(typeof V=="string"){var I=s._prime(V);this.m=I.p,this.prime=I}else n(V.gtn(1),"modulus must be greater than 1"),this.m=V,this.prime=null}z.prototype._verify1=function(I){n(I.negative===0,"red works only with positives"),n(I.red,"red works only with red numbers")},z.prototype._verify2=function(I,w){n((I.negative|w.negative)==0,"red works only with positives"),n(I.red&&I.red===w.red,"red works only with red numbers")},z.prototype.imod=function(I){return this.prime?this.prime.ireduce(I)._forceRed(this):I.umod(this.m)._forceRed(this)},z.prototype.neg=function(I){return I.isZero()?I.clone():this.m.sub(I)._forceRed(this)},z.prototype.add=function(I,w){this._verify2(I,w);var S=I.add(w);return S.cmp(this.m)>=0&&S.isub(this.m),S._forceRed(this)},z.prototype.iadd=function(I,w){this._verify2(I,w);var S=I.iadd(w);return S.cmp(this.m)>=0&&S.isub(this.m),S},z.prototype.sub=function(I,w){this._verify2(I,w);var S=I.sub(w);return S.cmpn(0)<0&&S.iadd(this.m),S._forceRed(this)},z.prototype.isub=function(I,w){this._verify2(I,w);var S=I.isub(w);return S.cmpn(0)<0&&S.iadd(this.m),S},z.prototype.shl=function(I,w){return this._verify1(I),this.imod(I.ushln(w))},z.prototype.imul=function(I,w){return this._verify2(I,w),this.imod(I.imul(w))},z.prototype.mul=function(I,w){return this._verify2(I,w),this.imod(I.mul(w))},z.prototype.isqr=function(I){return this.imul(I,I.clone())},z.prototype.sqr=function(I){return this.mul(I,I)},z.prototype.sqrt=function(I){if(I.isZero())return I.clone();var w=this.m.andln(3);if(n(w%2==1),w===3){var S=this.m.add(new s(1)).iushrn(2);return this.pow(I,S)}for(var R=this.m.subn(1),W=0;!R.isZero()&&R.andln(1)===0;)W++,R.iushrn(1);n(!R.isZero());var H=new s(1).toRed(this),k=H.redNeg(),_=this.m.subn(1).iushrn(1),Z=this.m.bitLength();for(Z=new s(2*Z*Z).toRed(this);this.pow(Z,_).cmp(k)!==0;)Z.redIAdd(k);for(var T=this.pow(Z,R),F=this.pow(I,R.addn(1).iushrn(1)),K=this.pow(I,R),j=W;K.cmp(H)!==0;){for(var O=K,Y=0;O.cmp(H)!==0;Y++)O=O.redSqr();n(Y<j);var ee=this.pow(T,new s(1).iushln(j-Y-1));F=F.redMul(ee),T=ee.redSqr(),K=K.redMul(T),j=Y}return F},z.prototype.invm=function(I){var w=I._invmp(this.m);return w.negative!==0?(w.negative=0,this.imod(w).redNeg()):this.imod(w)},z.prototype.pow=function(I,w){if(w.isZero())return new s(1).toRed(this);if(w.cmpn(1)===0)return I.clone();var S=4,R=new Array(1<<S);R[0]=new s(1).toRed(this),R[1]=I;for(var W=2;W<R.length;W++)R[W]=this.mul(R[W-1],I);var H=R[0],k=0,_=0,Z=w.bitLength()%26;for(Z===0&&(Z=26),W=w.length-1;W>=0;W--){for(var T=w.words[W],F=Z-1;F>=0;F--){var K=T>>F&1;if(H!==R[0]&&(H=this.sqr(H)),K===0&&k===0){_=0;continue}k<<=1,k|=K,_++,!(_!==S&&(W!==0||F!==0))&&(H=this.mul(H,R[k]),_=0,k=0)}Z=26}return H},z.prototype.convertTo=function(I){var w=I.umod(this.m);return w===I?w.clone():w},z.prototype.convertFrom=function(I){var w=I.clone();return w.red=null,w},s.mont=function(I){return new J(I)};function J(V){z.call(this,V),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}r(J,z),J.prototype.convertTo=function(I){return this.imod(I.ushln(this.shift))},J.prototype.convertFrom=function(I){var w=this.imod(I.mul(this.rinv));return w.red=null,w},J.prototype.imul=function(I,w){if(I.isZero()||w.isZero())return I.words[0]=0,I.length=1,I;var S=I.imul(w),R=S.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),W=S.isub(R).iushrn(this.shift),H=W;return W.cmp(this.m)>=0?H=W.isub(this.m):W.cmpn(0)<0&&(H=W.iadd(this.m)),H._forceRed(this)},J.prototype.mul=function(I,w){if(I.isZero()||w.isZero())return new s(0)._forceRed(this);var S=I.mul(w),R=S.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),W=S.isub(R).iushrn(this.shift),H=W;return W.cmp(this.m)>=0?H=W.isub(this.m):W.cmpn(0)<0&&(H=W.iadd(this.m)),H._forceRed(this)},J.prototype.invm=function(I){var w=this.imod(I._invmp(this.m).mul(this.r2));return w._forceRed(this)}})(i,yg)}),iC=zt.BN;const B7="logger/5.0.0-beta.137";let _9=!1,V9=!1;const yA={debug:1,default:2,info:2,warning:3,error:4,off:5};let N9=yA.default,Q2=null;function S7(){try{const i=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{i.push(e)}}),i.length)throw new Error("missing "+i.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(i){return i.message}return null}const E9=S7();var vA;(function(i){i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF"})(vA||(vA={}));var rC;(function(i){i.UNKNOWN_ERROR="UNKNOWN_ERROR",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.TIMEOUT="TIMEOUT",i.BUFFER_OVERRUN="BUFFER_OVERRUN",i.NUMERIC_FAULT="NUMERIC_FAULT",i.MISSING_NEW="MISSING_NEW",i.INVALID_ARGUMENT="INVALID_ARGUMENT",i.MISSING_ARGUMENT="MISSING_ARGUMENT",i.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",i.CALL_EXCEPTION="CALL_EXCEPTION",i.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",i.NONCE_EXPIRED="NONCE_EXPIRED",i.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",i.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT"})(rC||(rC={}));class We{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,t){const n=e.toLowerCase();yA[n]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(N9>yA[n])&&console.log.apply(console,t)}debug(...e){this._log(We.levels.DEBUG,e)}info(...e){this._log(We.levels.INFO,e)}warn(...e){this._log(We.levels.WARNING,e)}makeError(e,t,n){if(V9)return this.makeError("censored error",t,{});t||(t=We.errors.UNKNOWN_ERROR),n||(n={});const r=[];Object.keys(n).forEach(a=>{try{r.push(a+"="+JSON.stringify(n[a]))}catch{r.push(a+"="+JSON.stringify(n[a].toString()))}}),r.push(`code=${t}`),r.push(`version=${this.version}`);const s=e;r.length&&(e+=" ("+r.join(", ")+")");const o=new Error(e);return o.reason=s,o.code=t,Object.keys(n).forEach(function(a){o[a]=n[a]}),o}throwError(e,t,n){throw this.makeError(e,t,n)}throwArgumentError(e,t,n){return this.throwError(e,We.errors.INVALID_ARGUMENT,{argument:t,value:n})}checkNormalize(e){E9&&this.throwError("platform missing String.prototype.normalize",We.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:E9})}checkSafeUint53(e,t){typeof e=="number"&&(t==null&&(t="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(t,We.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(t,We.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,t,n){n?n=": "+n:n="",e<t&&this.throwError("missing argument"+n,We.errors.MISSING_ARGUMENT,{count:e,expectedCount:t}),e>t&&this.throwError("too many arguments"+n,We.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:t})}checkNew(e,t){(e===Object||e==null)&&this.throwError("missing new",We.errors.MISSING_NEW,{name:t.name})}checkAbstract(e,t){e===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",We.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",We.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return Q2||(Q2=new We(B7)),Q2}static setCensorship(e,t){if(!e&&t&&this.globalLogger().throwError("cannot permanently disable censorship",We.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),_9){if(!e)return;this.globalLogger().throwError("error censorship permanent",We.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}V9=!!e,_9=!!t}static setLogLevel(e){const t=yA[e];if(t==null){We.globalLogger().warn("invalid log level - "+e);return}N9=t}}We.errors=rC;We.levels=vA;var xA=Object.freeze({get LogLevel(){return vA},get ErrorCode(){return rC},Logger:We});const Z7="bytes/5.0.0-beta.138",ri=new We(Z7);function H9(i){return!!i.toHexString}function xd(i){return i.slice||(i.slice=function(){const e=Array.prototype.slice.call(arguments);return xd(new Uint8Array(Array.prototype.slice.apply(i,e)))}),i}function sC(i){return Qt(i)&&!(i.length%2)||za(i)}function za(i){if(i==null)return!1;if(i.constructor===Uint8Array)return!0;if(typeof i=="string"||i.length==null)return!1;for(let e=0;e<i.length;e++){const t=i[e];if(t<0||t>=256||t%1)return!1}return!0}function tt(i,e){if(e||(e={}),typeof i=="number"){ri.checkSafeUint53(i,"invalid arrayify value");const t=[];for(;i;)t.unshift(i&255),i=parseInt(String(i/256));return t.length===0&&t.push(0),xd(new Uint8Array(t))}if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),H9(i)&&(i=i.toHexString()),Qt(i)){let t=i.substring(2);t.length%2&&(e.hexPad==="left"?t="0x0"+t.substring(2):e.hexPad==="right"?t+="0":ri.throwArgumentError("hex data is odd-length","value",i));const n=[];for(let r=0;r<t.length;r+=2)n.push(parseInt(t.substring(r,r+2),16));return xd(new Uint8Array(n))}return za(i)?xd(new Uint8Array(i)):ri.throwArgumentError("invalid arrayify value","value",i)}function li(i){const e=i.map(r=>tt(r)),t=e.reduce((r,s)=>r+s.length,0),n=new Uint8Array(t);return e.reduce((r,s)=>(n.set(s,r),r+s.length),0),xd(n)}function wd(i){let e=tt(i);if(e.length===0)return e;let t=0;for(;t<e.length&&e[t]===0;)t++;return t&&(e=e.slice(t)),e}function Gd(i,e){i=tt(i),i.length>e&&ri.throwArgumentError("value out of range","value",arguments[0]);const t=new Uint8Array(e);return t.set(i,e-i.length),xd(t)}function Qt(i,e){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||e&&i.length!==2+2*e)}const j2="0123456789abcdef";function at(i,e){if(e||(e={}),typeof i=="number"){ri.checkSafeUint53(i,"invalid hexlify value");let t="";for(;i;)t=j2[i&15]+t,i=Math.floor(i/16);return t.length?(t.length%2&&(t="0"+t),"0x"+t):"0x00"}if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),H9(i))return i.toHexString();if(Qt(i))return i.length%2&&(e.hexPad==="left"?i="0x0"+i.substring(2):e.hexPad==="right"?i+="0":ri.throwArgumentError("hex data is odd-length","value",i)),i.toLowerCase();if(za(i)){let t="0x";for(let n=0;n<i.length;n++){let r=i[n];t+=j2[(r&240)>>4]+j2[r&15]}return t}return ri.throwArgumentError("invalid hexlify value","value",i)}function Jl(i){if(typeof i!="string")i=at(i);else if(!Qt(i)||i.length%2)return null;return(i.length-2)/2}function go(i,e,t){return typeof i!="string"?i=at(i):(!Qt(i)||i.length%2)&&ri.throwArgumentError("invalid hexData","value",i),e=2+2*e,t!=null?"0x"+i.substring(e,2+2*t):"0x"+i.substring(e)}function R7(i){let e="0x";return i.forEach(t=>{e+=at(t).substring(2)}),e}function Bd(i){const e=q2(at(i,{hexPad:"left"}));return e==="0x"?"0x0":e}function q2(i){typeof i!="string"&&(i=at(i)),Qt(i)||ri.throwArgumentError("invalid hex string","value",i),i=i.substring(2);let e=0;for(;e<i.length&&i[e]==="0";)e++;return"0x"+i.substring(e)}function Ji(i,e){for(typeof i!="string"?i=at(i):Qt(i)||ri.throwArgumentError("invalid hex string","value",i),i.length>2*e+2&&ri.throwArgumentError("value out of range","value",arguments[1]);i.length<2*e+2;)i="0x0"+i.substring(2);return i}function Sd(i){const e={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0};if(sC(i)){const t=tt(i);t.length!==65&&ri.throwArgumentError("invalid signature string; must be 65 bytes","signature",i),e.r=at(t.slice(0,32)),e.s=at(t.slice(32,64)),e.v=t[64],e.recoveryParam=1-e.v%2,e.v<27&&(e.v===0||e.v===1?e.v+=27:ri.throwArgumentError("signature invalid v byte","signature",i)),e.recoveryParam&&(t[32]|=128),e._vs=at(t.slice(32,64))}else{if(e.r=i.r,e.s=i.s,e.v=i.v,e.recoveryParam=i.recoveryParam,e._vs=i._vs,e._vs!=null){const r=Gd(tt(e._vs),32);e._vs=at(r);const s=r[0]>=128?1:0;e.recoveryParam==null?e.recoveryParam=s:e.recoveryParam!==s&&ri.throwArgumentError("signature recoveryParam mismatch _vs","signature",i),r[0]&=127;const o=at(r);e.s==null?e.s=o:e.s!==o&&ri.throwArgumentError("signature v mismatch _vs","signature",i)}e.recoveryParam==null?e.v==null?ri.throwArgumentError("signature missing v and recoveryParam","signature",i):e.recoveryParam=1-e.v%2:e.v==null?e.v=27+e.recoveryParam:e.recoveryParam!==1-e.v%2&&ri.throwArgumentError("signature recoveryParam mismatch v","signature",i),e.r==null||!Qt(e.r)?ri.throwArgumentError("signature missing or invalid r","signature",i):e.r=Ji(e.r,32),e.s==null||!Qt(e.s)?ri.throwArgumentError("signature missing or invalid s","signature",i):e.s=Ji(e.s,32);const t=tt(e.s);t[0]>=128&&ri.throwArgumentError("signature s out of range","signature",i),e.recoveryParam&&(t[0]|=128);const n=at(t);e._vs&&(Qt(e._vs)||ri.throwArgumentError("signature invalid _vs","signature",i),e._vs=Ji(e._vs,32)),e._vs==null?e._vs=n:e._vs!==n&&ri.throwArgumentError("signature _vs mismatch v and s","signature",i)}return e}function $2(i){return i=Sd(i),at(li([i.r,i.s,i.recoveryParam?"0x1c":"0x1b"]))}var oC=Object.freeze({isBytesLike:sC,isBytes:za,arrayify:tt,concat:li,stripZeros:wd,zeroPad:Gd,isHexString:Qt,hexlify:at,hexDataLength:Jl,hexDataSlice:go,hexConcat:R7,hexValue:Bd,hexStripZeros:q2,hexZeroPad:Ji,splitSignature:Sd,joinSignature:$2});const F9="bignumber/5.0.0-beta.139",vg=new We(F9),e1={},L9=9007199254740991;function M7(i){return i!=null&&(ft.isBigNumber(i)||typeof i=="number"&&i%1==0||typeof i=="string"&&!!i.match(/^-?[0-9]+$/)||Qt(i)||typeof i=="bigint"||za(i))}class ft{constructor(e,t){vg.checkNew(new.target,ft),e!==e1&&vg.throwError("cannot call constructor directly; use BigNumber.from",We.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=t,this._isBigNumber=!0,Object.freeze(this)}fromTwos(e){return qr(jt(this).fromTwos(e))}toTwos(e){return qr(jt(this).toTwos(e))}abs(){return this._hex[0]==="-"?ft.from(this._hex.substring(1)):this}add(e){return qr(jt(this).add(jt(e)))}sub(e){return qr(jt(this).sub(jt(e)))}div(e){return ft.from(e).isZero()&&uo("division by zero","div"),qr(jt(this).div(jt(e)))}mul(e){return qr(jt(this).mul(jt(e)))}mod(e){const t=jt(e);return t.isNeg()&&uo("cannot modulo negative values","mod"),qr(jt(this).umod(t))}pow(e){return qr(jt(this).pow(jt(e)))}and(e){const t=jt(e);return(this.isNegative()||t.isNeg())&&uo("cannot 'and' negative values","and"),qr(jt(this).and(t))}or(e){const t=jt(e);return(this.isNegative()||t.isNeg())&&uo("cannot 'or' negative values","or"),qr(jt(this).or(t))}xor(e){const t=jt(e);return(this.isNegative()||t.isNeg())&&uo("cannot 'xor' negative values","xor"),qr(jt(this).xor(t))}mask(e){return(this.isNegative()||e<0)&&uo("cannot mask negative values","mask"),qr(jt(this).maskn(e))}shl(e){return(this.isNegative()||e<0)&&uo("cannot shift negative values","shl"),qr(jt(this).shln(e))}shr(e){return(this.isNegative()||e<0)&&uo("cannot shift negative values","shr"),qr(jt(this).shrn(e))}eq(e){return jt(this).eq(jt(e))}lt(e){return jt(this).lt(jt(e))}lte(e){return jt(this).lte(jt(e))}gt(e){return jt(this).gt(jt(e))}gte(e){return jt(this).gte(jt(e))}isNegative(){return this._hex[0]==="-"}isZero(){return jt(this).isZero()}toNumber(){try{return jt(this).toNumber()}catch{uo("overflow","toNumber",this.toString())}return null}toString(){return arguments.length!==0&&vg.throwError("bigNumber.toString does not accept parameters",We.errors.UNEXPECTED_ARGUMENT,{}),jt(this).toString(10)}toHexString(){return this._hex}static from(e){return e instanceof ft?e:typeof e=="string"?e.match(/-?0x[0-9a-f]+/i)?new ft(e1,aC(e)):e.match(/^-?[0-9]+$/)?new ft(e1,aC(new iC(e))):vg.throwArgumentError("invalid BigNumber string","value",e):typeof e=="number"?(e%1&&uo("underflow","BigNumber.from",e),(e>=L9||e<=-L9)&&uo("overflow","BigNumber.from",e),ft.from(String(e))):typeof e=="bigint"?ft.from(e.toString()):za(e)?ft.from(at(e)):e._hex&&Qt(e._hex)?ft.from(e._hex):e.toHexString&&(e=e.toHexString(),typeof e=="string")?ft.from(e):vg.throwArgumentError("invalid BigNumber value","value",e)}static isBigNumber(e){return!!(e&&e._isBigNumber)}}function aC(i){if(typeof i!="string")return aC(i.toString(16));if(i[0]==="-")return i=i.substring(1),i[0]==="-"&&vg.throwArgumentError("invalid hex","value",i),i=aC(i),i==="0x00"?i:"-"+i;if(i.substring(0,2)!=="0x"&&(i="0x"+i),i==="0x")return"0x00";for(i.length%2&&(i="0x0"+i.substring(2));i.length>4&&i.substring(0,4)==="0x00";)i="0x"+i.substring(4);return i}function qr(i){return ft.from(aC(i))}function jt(i){const e=ft.from(i).toHexString();return e[0]==="-"?new iC("-"+e.substring(3),16):new iC(e.substring(2),16)}function uo(i,e,t){const n={fault:i,operation:e};return t!=null&&(n.value=t),vg.throwError(i,We.errors.NUMERIC_FAULT,n)}const $r=new We(F9),t1={},T9=ft.from(0),X9=ft.from(-1);function z9(i,e,t,n){const r={fault:e,operation:t};return n!==void 0&&(r.value=n),$r.throwError(i,We.errors.NUMERIC_FAULT,r)}let lC="0";for(;lC.length<256;)lC+=lC;function n1(i){if(typeof i!="number")try{i=ft.from(i).toNumber()}catch{}return typeof i=="number"&&i>=0&&i<=256&&!(i%1)?"1"+lC.substring(0,i):$r.throwArgumentError("invalid decimal size","decimals",i)}function wA(i,e){e==null&&(e=0);const t=n1(e);i=ft.from(i);const n=i.lt(T9);n&&(i=i.mul(X9));let r=i.mod(t).toString();for(;r.length<t.length-1;)r="0"+r;return r=r.match(/^([0-9]*[1-9]|0)(0*)/)[1],i=i.div(t).toString()+"."+r,n&&(i="-"+i),i}function Ko(i,e){e==null&&(e=0);const t=n1(e);if((typeof i!="string"||!i.match(/^-?[0-9.,]+$/))&&$r.throwArgumentError("invalid decimal value","value",i),t.length-1==0)return ft.from(i);const n=i.substring(0,1)==="-";n&&(i=i.substring(1)),i==="."&&$r.throwArgumentError("missing value","value",i);const r=i.split(".");r.length>2&&$r.throwArgumentError("too many decimal points","value",i);let s=r[0],o=r[1];for(s||(s="0"),o||(o="0"),o.length>t.length-1&&z9("fractional component exceeds decimals","underflow","parseFixed");o.length<t.length-1;)o+="0";const a=ft.from(s),l=ft.from(o);let c=a.mul(t).add(l);return n&&(c=c.mul(X9)),c}class Zd{constructor(e,t,n,r){this.signed=t,this.width=n,this.decimals=r,this.name=(t?"":"u")+"fixed"+String(n)+"x"+String(r),this._multiplier=n1(r),Object.freeze(this)}static from(e){if(e instanceof Zd)return e;let t=!0,n=128,r=18;if(typeof e=="string"){if(e!=="fixed"){if(e==="ufixed")t=!1;else if(e!=null){const s=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);s||$r.throwArgumentError("invalid fixed format","format",e),t=s[1]!=="u",n=parseInt(s[2]),r=parseInt(s[3])}}}else if(e){const s=(o,a,l)=>e[o]==null?l:(typeof e[o]!==a&&$r.throwArgumentError("invalid fixed format ("+o+" not "+a+")","format."+o,e[o]),e[o]);t=s("signed","boolean",t),n=s("width","number",n),r=s("decimals","number",r)}return n%8&&$r.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",n),r>80&&$r.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",r),new Zd(t1,t,n,r)}}class dr{constructor(e,t,n,r){$r.checkNew(new.target,dr),this.format=r,this._hex=t,this._value=n,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(e){this.format.name!==e.format.name&&$r.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",e)}addUnsafe(e){this._checkFormat(e);const t=Ko(this._value,this.format.decimals),n=Ko(e._value,e.format.decimals);return dr.fromValue(t.add(n),this.format.decimals,this.format)}subUnsafe(e){this._checkFormat(e);const t=Ko(this._value,this.format.decimals),n=Ko(e._value,e.format.decimals);return dr.fromValue(t.sub(n),this.format.decimals,this.format)}mulUnsafe(e){this._checkFormat(e);const t=Ko(this._value,this.format.decimals),n=Ko(e._value,e.format.decimals);return dr.fromValue(t.mul(n).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(e){this._checkFormat(e);const t=Ko(this._value,this.format.decimals),n=Ko(e._value,e.format.decimals);return dr.fromValue(t.mul(this.format._multiplier).div(n),this.format.decimals,this.format)}round(e){e==null&&(e=0),(e<0||e>80||e%1)&&$r.throwArgumentError("invalid decimal count","decimals",e);let t=this.toString().split(".");if(t[1].length<=e)return this;const n="0."+lC.substring(0,e)+"5";return t=this.addUnsafe(dr.fromString(n,this.format))._value.split("."),dr.fromString(t[0]+"."+t[1].substring(0,e))}toString(){return this._value}toHexString(e){if(e==null)return this._hex;e%8&&$r.throwArgumentError("invalid byte width","width",e);const t=ft.from(this._hex).fromTwos(this.format.width).toTwos(e).toHexString();return Ji(t,e/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return dr.fromString(this._value,e)}static fromValue(e,t,n){return n==null&&t!=null&&!M7(t)&&(n=t,t=null),t==null&&(t=0),n==null&&(n="fixed"),dr.fromString(wA(e,t),Zd.from(n))}static fromString(e,t){t==null&&(t="fixed");const n=Zd.from(t),r=Ko(e,n.decimals);!n.signed&&r.lt(T9)&&z9("unsigned value cannot be negative","overflow","value",e);let s=null;n.signed?s=r.toTwos(n.width).toHexString():(s=r.toHexString(),s=Ji(s,n.width/8));const o=wA(r,n.decimals);return new dr(t1,s,o,n)}static fromBytes(e,t){t==null&&(t="fixed");const n=Zd.from(t);if(tt(e).length>n.width/8)throw new Error("overflow");let r=ft.from(e);n.signed&&(r=r.fromTwos(n.width));const s=r.toTwos((n.signed?0:1)+n.width).toHexString(),o=wA(r,n.decimals);return new dr(t1,s,o,n)}static from(e,t){if(typeof e=="string")return dr.fromString(e,t);if(za(e))return dr.fromBytes(e,t);try{return dr.fromValue(e,0,t)}catch(n){if(n.code!==We.errors.INVALID_ARGUMENT)throw n}return $r.throwArgumentError("invalid FixedNumber value","value",e)}static isFixedNumber(e){return!!(e&&e._isFixedNumber)}}const W7="properties/5.0.0-beta.143";var _7=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const GA=new We(W7);function ke(i,e,t){Object.defineProperty(i,e,{enumerable:!0,value:t,writable:!1})}function hr(i,e){for(let t=0;t<32;t++){if(i[e])return i[e];if(!i.prototype||typeof i.prototype!="object")break;i=Object.getPrototypeOf(i.prototype).constructor}return null}function ci(i){return _7(this,void 0,void 0,function*(){const e=Object.keys(i).map(n=>{const r=i[n];return Promise.resolve(r).then(s=>({key:n,value:s}))});return(yield Promise.all(e)).reduce((n,r)=>(n[r.key]=r.value,n),{})})}function i1(i,e){(!i||typeof i!="object")&&GA.throwArgumentError("invalid object","object",i),Object.keys(i).forEach(t=>{e[t]||GA.throwArgumentError("invalid object key - "+t,"transaction:"+t,i)})}function Ei(i){const e={};for(const t in i)e[t]=i[t];return e}const V7={bigint:!0,boolean:!0,function:!0,number:!0,string:!0};function k9(i){if(i==null||V7[typeof i])return!0;if(Array.isArray(i)||typeof i=="object"){if(!Object.isFrozen(i))return!1;const e=Object.keys(i);for(let t=0;t<e.length;t++)if(!k9(i[e[t]]))return!1;return!0}return GA.throwArgumentError(`Cannot deepCopy ${typeof i}`,"object",i)}function N7(i){if(k9(i))return i;if(Array.isArray(i))return Object.freeze(i.map(e=>Ys(e)));if(typeof i=="object"){const e={};for(const t in i){const n=i[t];n!==void 0&&ke(e,t,Ys(n))}return e}return GA.throwArgumentError(`Cannot deepCopy ${typeof i}`,"object",i)}function Ys(i){return N7(i)}class Rd{constructor(e){for(const t in e)this[t]=Ys(e[t])}}const cC="abi/5.0.0-beta.156",dn=new We(cC),Md={};let Y9={calldata:!0,memory:!0,storage:!0},E7={calldata:!0,memory:!0};function BA(i,e){if(i==="bytes"||i==="string"){if(Y9[e])return!0}else if(i==="address"){if(e==="payable")return!0}else if((i.indexOf("[")>=0||i==="tuple")&&E7[e])return!0;return(Y9[e]||e==="payable")&&dn.throwArgumentError("invalid modifier","name",e),!1}function H7(i,e){let t=i;function n(a){dn.throwArgumentError(`unexpected character at position ${a}`,"param",i)}i=i.replace(/\s/g," ");function r(a){let l={type:"",name:"",parent:a,state:{allowType:!0}};return e&&(l.indexed=!1),l}let s={type:"",name:"",state:{allowType:!0}},o=s;for(let a=0;a<i.length;a++){let l=i[a];switch(l){case"(":o.state.allowType&&o.type===""?o.type="tuple":o.state.allowParams||n(a),o.state.allowType=!1,o.type=Wd(o.type),o.components=[r(o)],o=o.components[0];break;case")":delete o.state,o.name==="indexed"&&(e||n(a),o.indexed=!0,o.name=""),BA(o.type,o.name)&&(o.name=""),o.type=Wd(o.type);let c=o;o=o.parent,o||n(a),delete c.parent,o.state.allowParams=!1,o.state.allowName=!0,o.state.allowArray=!0;break;case",":delete o.state,o.name==="indexed"&&(e||n(a),o.indexed=!0,o.name=""),BA(o.type,o.name)&&(o.name=""),o.type=Wd(o.type);let g=r(o.parent);o.parent.components.push(g),delete o.parent,o=g;break;case" ":o.state.allowType&&o.type!==""&&(o.type=Wd(o.type),delete o.state.allowType,o.state.allowName=!0,o.state.allowParams=!0),o.state.allowName&&o.name!==""&&(o.name==="indexed"?(e||n(a),o.indexed&&n(a),o.indexed=!0,o.name=""):BA(o.type,o.name)?o.name="":o.state.allowName=!1);break;case"[":o.state.allowArray||n(a),o.type+=l,o.state.allowArray=!1,o.state.allowName=!1,o.state.readArray=!0;break;case"]":o.state.readArray||n(a),o.type+=l,o.state.readArray=!1,o.state.allowArray=!0,o.state.allowName=!0;break;default:o.state.allowType?(o.type+=l,o.state.allowParams=!0,o.state.allowArray=!0):o.state.allowName?(o.name+=l,delete o.state.allowArray):o.state.readArray?o.type+=l:n(a)}}return o.parent&&dn.throwArgumentError("unexpected eof","param",i),delete s.state,o.name==="indexed"?(e||n(t.length-7),o.indexed&&n(t.length-7),o.indexed=!0,o.name=""):BA(o.type,o.name)&&(o.name=""),s.type=Wd(s.type),s}function SA(i,e){for(let t in e)ke(i,t,e[t])}const vn=Object.freeze({sighash:"sighash",minimal:"minimal",full:"full",json:"json"}),F7=new RegExp(/^(.*)\[([0-9]*)\]$/);class Qi{constructor(e,t){e!==Md&&dn.throwError("use fromString",We.errors.UNSUPPORTED_OPERATION,{operation:"new ParamType()"}),SA(this,t);let n=this.type.match(F7);n?SA(this,{arrayLength:parseInt(n[2]||"-1"),arrayChildren:Qi.fromObject({type:n[1],components:this.components}),baseType:"array"}):SA(this,{arrayLength:null,arrayChildren:null,baseType:this.components!=null?"tuple":this.type}),this._isParamType=!0,Object.freeze(this)}format(e){if(e||(e=vn.sighash),vn[e]||dn.throwArgumentError("invalid format type","format",e),e===vn.json){let n={type:this.baseType==="tuple"?"tuple":this.type,name:this.name||void 0};return typeof this.indexed=="boolean"&&(n.indexed=this.indexed),this.components&&(n.components=this.components.map(r=>JSON.parse(r.format(e)))),JSON.stringify(n)}let t="";return this.baseType==="array"?(t+=this.arrayChildren.format(e),t+="["+(this.arrayLength<0?"":String(this.arrayLength))+"]"):this.baseType==="tuple"?(e!==vn.sighash&&(t+=this.type),t+="("+this.components.map(n=>n.format(e)).join(e===vn.full?", ":",")+")"):t+=this.type,e!==vn.sighash&&(this.indexed===!0&&(t+=" indexed"),e===vn.full&&this.name&&(t+=" "+this.name)),t}static from(e,t){return typeof e=="string"?Qi.fromString(e,t):Qi.fromObject(e)}static fromObject(e){return Qi.isParamType(e)?e:new Qi(Md,{name:e.name||null,type:Wd(e.type),indexed:e.indexed==null?null:!!e.indexed,components:e.components?e.components.map(Qi.fromObject):null})}static fromString(e,t){function n(r){return Qi.fromObject({name:r.name,type:r.type,indexed:r.indexed,components:r.components})}return n(H7(e,!!t))}static isParamType(e){return!!(e!=null&&e._isParamType)}}function ZA(i,e){return T7(i).map(t=>Qi.fromString(t,e))}class ka{constructor(e,t){e!==Md&&dn.throwError("use a static from method",We.errors.UNSUPPORTED_OPERATION,{operation:"new Fragment()"}),SA(this,t),this._isFragment=!0,Object.freeze(this)}static from(e){return ka.isFragment(e)?e:typeof e=="string"?ka.fromString(e):ka.fromObject(e)}static fromObject(e){if(ka.isFragment(e))return e;switch(e.type){case"function":return Uo.fromObject(e);case"event":return Po.fromObject(e);case"constructor":return Do.fromObject(e);case"fallback":case"receive":return null}return dn.throwArgumentError("invalid fragment object","value",e)}static fromString(e){return e=e.replace(/\s/g," "),e=e.replace(/\(/g," (").replace(/\)/g,") ").replace(/\s+/g," "),e=e.trim(),e.split(" ")[0]==="event"?Po.fromString(e.substring(5).trim()):e.split(" ")[0]==="function"?Uo.fromString(e.substring(8).trim()):e.split("(")[0].trim()==="constructor"?Do.fromString(e.trim()):dn.throwArgumentError("unsupported fragment","value",e)}static isFragment(e){return!!(e&&e._isFragment)}}class Po extends ka{format(e){if(e||(e=vn.sighash),vn[e]||dn.throwArgumentError("invalid format type","format",e),e===vn.json)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});let t="";return e!==vn.sighash&&(t+="event "),t+=this.name+"("+this.inputs.map(n=>n.format(e)).join(e===vn.full?", ":",")+") ",e!==vn.sighash&&this.anonymous&&(t+="anonymous "),t.trim()}static from(e){return typeof e=="string"?Po.fromString(e):Po.fromObject(e)}static fromObject(e){if(Po.isEventFragment(e))return e;e.type!=="event"&&dn.throwArgumentError("invalid event object","value",e);const t={name:r1(e.name),anonymous:e.anonymous,inputs:e.inputs?e.inputs.map(Qi.fromObject):[],type:"event"};return new Po(Md,t)}static fromString(e){let t=e.match(RA);t||dn.throwArgumentError("invalid event string","value",e);let n=!1;return t[3].split(" ").forEach(r=>{switch(r.trim()){case"anonymous":n=!0;break;case"":break;default:dn.warn("unknown modifier: "+r)}}),Po.fromObject({name:t[1].trim(),anonymous:n,inputs:ZA(t[2],!0),type:"event"})}static isEventFragment(e){return e&&e._isFragment&&e.type==="event"}}function K9(i,e){e.gas=null;let t=i.split("@");return t.length!==1?(t.length>2&&dn.throwArgumentError("invalid human-readable ABI signature","value",i),t[1].match(/^[0-9]+$/)||dn.throwArgumentError("invalid human-readable ABI signature gas","value",i),e.gas=ft.from(t[1]),t[0]):i}function P9(i,e){e.constant=!1,e.payable=!1,e.stateMutability="nonpayable",i.split(" ").forEach(t=>{switch(t.trim()){case"constant":e.constant=!0;break;case"payable":e.payable=!0,e.stateMutability="payable";break;case"nonpayable":e.payable=!1,e.stateMutability="nonpayable";break;case"pure":e.constant=!0,e.stateMutability="pure";break;case"view":e.constant=!0,e.stateMutability="view";break;case"external":case"public":case"":break;default:console.log("unknown modifier: "+t)}})}function D9(i){let e={constant:!1,payable:!0,stateMutability:"payable"};return i.stateMutability!=null?(e.stateMutability=i.stateMutability,e.constant=e.stateMutability==="view"||e.stateMutability==="pure",i.constant!=null&&!!i.constant!==e.constant&&dn.throwArgumentError("cannot have constant function with mutability "+e.stateMutability,"value",i),e.payable=e.stateMutability==="payable",i.payable!=null&&!!i.payable!==e.payable&&dn.throwArgumentError("cannot have payable function with mutability "+e.stateMutability,"value",i)):i.payable!=null?(e.payable=!!i.payable,i.constant==null&&!e.payable&&i.type!=="constructor"&&dn.throwArgumentError("unable to determine stateMutability","value",i),e.constant=!!i.constant,e.constant?e.stateMutability="view":e.stateMutability=e.payable?"payable":"nonpayable",e.payable&&e.constant&&dn.throwArgumentError("cannot have constant payable function","value",i)):i.constant!=null?(e.constant=!!i.constant,e.payable=!e.constant,e.stateMutability=e.constant?"view":"payable"):i.type!=="constructor"&&dn.throwArgumentError("unable to determine stateMutability","value",i),e}class Do extends ka{format(e){if(e||(e=vn.sighash),vn[e]||dn.throwArgumentError("invalid format type","format",e),e===vn.json)return JSON.stringify({type:"constructor",stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payble:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});e===vn.sighash&&dn.throwError("cannot format a constructor for sighash",We.errors.UNSUPPORTED_OPERATION,{operation:"format(sighash)"});let t="constructor("+this.inputs.map(n=>n.format(e)).join(e===vn.full?", ":",")+") ";return this.stateMutability&&this.stateMutability!=="nonpayable"&&(t+=this.stateMutability+" "),t.trim()}static from(e){return typeof e=="string"?Do.fromString(e):Do.fromObject(e)}static fromObject(e){if(Do.isConstructorFragment(e))return e;e.type!=="constructor"&&dn.throwArgumentError("invalid constructor object","value",e);let t=D9(e);t.constant&&dn.throwArgumentError("constructor cannot be constant","value",e);const n={name:null,type:e.type,inputs:e.inputs?e.inputs.map(Qi.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?ft.from(e.gas):null};return new Do(Md,n)}static fromString(e){let t={type:"constructor"};e=K9(e,t);let n=e.match(RA);return(!n||n[1].trim()!=="constructor")&&dn.throwArgumentError("invalid constructor string","value",e),t.inputs=ZA(n[2].trim(),!1),P9(n[3].trim(),t),Do.fromObject(t)}static isConstructorFragment(e){return e&&e._isFragment&&e.type==="constructor"}}class Uo extends Do{format(e){if(e||(e=vn.sighash),vn[e]||dn.throwArgumentError("invalid format type","format",e),e===vn.json)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payble:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e))),ouputs:this.outputs.map(n=>JSON.parse(n.format(e)))});let t="";return e!==vn.sighash&&(t+="function "),t+=this.name+"("+this.inputs.map(n=>n.format(e)).join(e===vn.full?", ":",")+") ",e!==vn.sighash&&(this.stateMutability?this.stateMutability!=="nonpayable"&&(t+=this.stateMutability+" "):this.constant&&(t+="view "),this.outputs&&this.outputs.length&&(t+="returns ("+this.outputs.map(n=>n.format(e)).join(", ")+") "),this.gas!=null&&(t+="@"+this.gas.toString()+" ")),t.trim()}static from(e){return typeof e=="string"?Uo.fromString(e):Uo.fromObject(e)}static fromObject(e){if(Uo.isFunctionFragment(e))return e;e.type!=="function"&&dn.throwArgumentError("invalid function object","value",e);let t=D9(e);const n={type:e.type,name:r1(e.name),constant:t.constant,inputs:e.inputs?e.inputs.map(Qi.fromObject):[],outputs:e.outputs?e.outputs.map(Qi.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?ft.from(e.gas):null};return new Uo(Md,n)}static fromString(e){let t={type:"function"};e=K9(e,t);let n=e.split(" returns ");n.length>2&&dn.throwArgumentError("invalid function string","value",e);let r=n[0].match(RA);if(r||dn.throwArgumentError("invalid function signature","value",e),t.name=r[1].trim(),t.name&&r1(t.name),t.inputs=ZA(r[2],!1),P9(r[3].trim(),t),n.length>1){let s=n[1].match(RA);(s[1].trim()!=""||s[3].trim()!="")&&dn.throwArgumentError("unexpected tokens","value",e),t.outputs=ZA(s[2],!1)}else t.outputs=[];return Uo.fromObject(t)}static isFunctionFragment(e){return e&&e._isFragment&&e.type==="function"}}function Wd(i){return i.match(/^uint($|[^1-9])/)?i="uint256"+i.substring(4):i.match(/^int($|[^1-9])/)&&(i="int256"+i.substring(3)),i}const L7=new RegExp("^[A-Za-z_][A-Za-z0-9_]*$");function r1(i){return(!i||!i.match(L7))&&dn.throwArgumentError(`invalid identifier "${i}"`,"value",i),i}const RA=new RegExp("^([^)(]*)\\((.*)\\)([^)(]*)$");function T7(i){i=i.trim();let e=[],t="",n=0;for(let r=0;r<i.length;r++){let s=i[r];s===","&&n===0?(e.push(t),t=""):(t+=s,s==="("?n++:s===")"&&(n--,n===-1&&dn.throwArgumentError("unbalanced parenthesis","value",i)))}return t&&e.push(t),e}const s1=new We(cC);function U9(i){const e=[],t=function(n,r){if(!!Array.isArray(r))for(let s in r){const o=n.slice();o.push(s);try{t(o,r[s])}catch(a){e.push({path:o,error:a})}}};return t([],i),e}class Ya{constructor(e,t,n,r){this.name=e,this.type=t,this.localName=n,this.dynamic=r}_throwError(e,t){s1.throwArgumentError(e,this.localName,t)}}class o1{constructor(e){ke(this,"wordSize",e||32),this._data=tt([]),this._padding=new Uint8Array(e)}get data(){return at(this._data)}get length(){return this._data.length}_writeData(e){return this._data=li([this._data,e]),e.length}writeBytes(e){let t=tt(e);return t.length%this.wordSize&&(t=li([t,this._padding.slice(t.length%this.wordSize)])),this._writeData(t)}_getValue(e){let t=tt(ft.from(e));return t.length>this.wordSize&&s1.throwError("value out-of-bounds",We.errors.BUFFER_OVERRUN,{length:this.wordSize,offset:t.length}),t.length%this.wordSize&&(t=li([this._padding.slice(t.length%this.wordSize),t])),t}writeValue(e){return this._writeData(this._getValue(e))}writeUpdatableValue(){let e=this.length;return this.writeValue(0),t=>{this._data.set(this._getValue(t),e)}}}class MA{constructor(e,t,n){ke(this,"_data",tt(e)),ke(this,"wordSize",t||32),ke(this,"_coerceFunc",n),this._offset=0}get data(){return at(this._data)}get consumed(){return this._offset}static coerce(e,t){let n=e.match("^u?int([0-9]+)$");return n&&parseInt(n[1])<=48&&(t=t.toNumber()),t}coerce(e,t){return this._coerceFunc?this._coerceFunc(e,t):MA.coerce(e,t)}_peekBytes(e,t){let n=Math.ceil(t/this.wordSize)*this.wordSize;return this._offset+n>this._data.length&&s1.throwError("data out-of-bounds",We.errors.BUFFER_OVERRUN,{length:this._data.length,offset:this._offset+n}),this._data.slice(this._offset,this._offset+n)}subReader(e){return new MA(this._data.slice(this._offset+e),this.wordSize,this._coerceFunc)}readBytes(e){let t=this._peekBytes(0,e);return this._offset+=t.length,t.slice(0,e)}readValue(){return ft.from(this.readBytes(this.wordSize))}}var X7=Vr(function(i){/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.5.7
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2016
 * @license MIT
 */(function(){var e=typeof window=="object"?window:{},t=!e.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;t&&(e=yg);for(var n=!e.JS_SHA3_NO_COMMON_JS&&!0&&i.exports,r="0123456789abcdef".split(""),s=[31,7936,2031616,520093696],o=[1,256,65536,16777216],a=[6,1536,393216,100663296],l=[0,8,16,24],c=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],g=[224,256,384,512],d=[128,256],u=["hex","buffer","arrayBuffer","array"],h=function(I,w,S){return function(R){return new J(I,w,I).update(R)[S]()}},p=function(I,w,S){return function(R,W){return new J(I,w,W).update(R)[S]()}},b=function(I,w){var S=h(I,w,"hex");S.create=function(){return new J(I,w,I)},S.update=function(H){return S.create().update(H)};for(var R=0;R<u.length;++R){var W=u[R];S[W]=h(I,w,W)}return S},y=function(I,w){var S=p(I,w,"hex");S.create=function(H){return new J(I,w,H)},S.update=function(H,k){return S.create(k).update(H)};for(var R=0;R<u.length;++R){var W=u[R];S[W]=p(I,w,W)}return S},m=[{name:"keccak",padding:o,bits:g,createMethod:b},{name:"sha3",padding:a,bits:g,createMethod:b},{name:"shake",padding:s,bits:d,createMethod:y}],f={},G=[],x=0;x<m.length;++x)for(var B=m[x],M=B.bits,E=0;E<M.length;++E){var z=B.name+"_"+M[E];G.push(z),f[z]=B.createMethod(M[E],B.padding)}function J(I,w,S){this.blocks=[],this.s=[],this.padding=w,this.outputBits=S,this.reset=!0,this.block=0,this.start=0,this.blockCount=1600-(I<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=S>>5,this.extraBytes=(S&31)>>3;for(var R=0;R<50;++R)this.s[R]=0}J.prototype.update=function(I){var w=typeof I!="string";w&&I.constructor===ArrayBuffer&&(I=new Uint8Array(I));for(var S=I.length,R=this.blocks,W=this.byteCount,H=this.blockCount,k=0,_=this.s,Z,T;k<S;){if(this.reset)for(this.reset=!1,R[0]=this.block,Z=1;Z<H+1;++Z)R[Z]=0;if(w)for(Z=this.start;k<S&&Z<W;++k)R[Z>>2]|=I[k]<<l[Z++&3];else for(Z=this.start;k<S&&Z<W;++k)T=I.charCodeAt(k),T<128?R[Z>>2]|=T<<l[Z++&3]:T<2048?(R[Z>>2]|=(192|T>>6)<<l[Z++&3],R[Z>>2]|=(128|T&63)<<l[Z++&3]):T<55296||T>=57344?(R[Z>>2]|=(224|T>>12)<<l[Z++&3],R[Z>>2]|=(128|T>>6&63)<<l[Z++&3],R[Z>>2]|=(128|T&63)<<l[Z++&3]):(T=65536+((T&1023)<<10|I.charCodeAt(++k)&1023),R[Z>>2]|=(240|T>>18)<<l[Z++&3],R[Z>>2]|=(128|T>>12&63)<<l[Z++&3],R[Z>>2]|=(128|T>>6&63)<<l[Z++&3],R[Z>>2]|=(128|T&63)<<l[Z++&3]);if(this.lastByteIndex=Z,Z>=W){for(this.start=Z-W,this.block=R[H],Z=0;Z<H;++Z)_[Z]^=R[Z];V(_),this.reset=!0}else this.start=Z}return this},J.prototype.finalize=function(){var I=this.blocks,w=this.lastByteIndex,S=this.blockCount,R=this.s;if(I[w>>2]|=this.padding[w&3],this.lastByteIndex===this.byteCount)for(I[0]=I[S],w=1;w<S+1;++w)I[w]=0;for(I[S-1]|=2147483648,w=0;w<S;++w)R[w]^=I[w];V(R)},J.prototype.toString=J.prototype.hex=function(){this.finalize();for(var I=this.blockCount,w=this.s,S=this.outputBlocks,R=this.extraBytes,W=0,H=0,k="",_;H<S;){for(W=0;W<I&&H<S;++W,++H)_=w[W],k+=r[_>>4&15]+r[_&15]+r[_>>12&15]+r[_>>8&15]+r[_>>20&15]+r[_>>16&15]+r[_>>28&15]+r[_>>24&15];H%I==0&&(V(w),W=0)}return R&&(_=w[W],R>0&&(k+=r[_>>4&15]+r[_&15]),R>1&&(k+=r[_>>12&15]+r[_>>8&15]),R>2&&(k+=r[_>>20&15]+r[_>>16&15])),k},J.prototype.arrayBuffer=function(){this.finalize();var I=this.blockCount,w=this.s,S=this.outputBlocks,R=this.extraBytes,W=0,H=0,k=this.outputBits>>3,_;R?_=new ArrayBuffer(S+1<<2):_=new ArrayBuffer(k);for(var Z=new Uint32Array(_);H<S;){for(W=0;W<I&&H<S;++W,++H)Z[H]=w[W];H%I==0&&V(w)}return R&&(Z[W]=w[W],_=_.slice(0,k)),_},J.prototype.buffer=J.prototype.arrayBuffer,J.prototype.digest=J.prototype.array=function(){this.finalize();for(var I=this.blockCount,w=this.s,S=this.outputBlocks,R=this.extraBytes,W=0,H=0,k=[],_,Z;H<S;){for(W=0;W<I&&H<S;++W,++H)_=H<<2,Z=w[W],k[_]=Z&255,k[_+1]=Z>>8&255,k[_+2]=Z>>16&255,k[_+3]=Z>>24&255;H%I==0&&V(w)}return R&&(_=H<<2,Z=w[W],R>0&&(k[_]=Z&255),R>1&&(k[_+1]=Z>>8&255),R>2&&(k[_+2]=Z>>16&255)),k};var V=function(I){var w,S,R,W,H,k,_,Z,T,F,K,j,O,Y,ee,ye,Ce,he,Ne,He,ne,de,Ie,Be,Re,Xe,Le,Qe,et,q,X,D,ge,Se,Me,pe,we,re,be,_e,Ee,U,Fe,Ze,Ye,me,Ge,Pe,ht,wt,nt,un,Et,Jt,sr,en,qt,Yr,ln,cn,ie,P,$;for(R=0;R<48;R+=2)W=I[0]^I[10]^I[20]^I[30]^I[40],H=I[1]^I[11]^I[21]^I[31]^I[41],k=I[2]^I[12]^I[22]^I[32]^I[42],_=I[3]^I[13]^I[23]^I[33]^I[43],Z=I[4]^I[14]^I[24]^I[34]^I[44],T=I[5]^I[15]^I[25]^I[35]^I[45],F=I[6]^I[16]^I[26]^I[36]^I[46],K=I[7]^I[17]^I[27]^I[37]^I[47],j=I[8]^I[18]^I[28]^I[38]^I[48],O=I[9]^I[19]^I[29]^I[39]^I[49],w=j^(k<<1|_>>>31),S=O^(_<<1|k>>>31),I[0]^=w,I[1]^=S,I[10]^=w,I[11]^=S,I[20]^=w,I[21]^=S,I[30]^=w,I[31]^=S,I[40]^=w,I[41]^=S,w=W^(Z<<1|T>>>31),S=H^(T<<1|Z>>>31),I[2]^=w,I[3]^=S,I[12]^=w,I[13]^=S,I[22]^=w,I[23]^=S,I[32]^=w,I[33]^=S,I[42]^=w,I[43]^=S,w=k^(F<<1|K>>>31),S=_^(K<<1|F>>>31),I[4]^=w,I[5]^=S,I[14]^=w,I[15]^=S,I[24]^=w,I[25]^=S,I[34]^=w,I[35]^=S,I[44]^=w,I[45]^=S,w=Z^(j<<1|O>>>31),S=T^(O<<1|j>>>31),I[6]^=w,I[7]^=S,I[16]^=w,I[17]^=S,I[26]^=w,I[27]^=S,I[36]^=w,I[37]^=S,I[46]^=w,I[47]^=S,w=F^(W<<1|H>>>31),S=K^(H<<1|W>>>31),I[8]^=w,I[9]^=S,I[18]^=w,I[19]^=S,I[28]^=w,I[29]^=S,I[38]^=w,I[39]^=S,I[48]^=w,I[49]^=S,Y=I[0],ee=I[1],me=I[11]<<4|I[10]>>>28,Ge=I[10]<<4|I[11]>>>28,Qe=I[20]<<3|I[21]>>>29,et=I[21]<<3|I[20]>>>29,cn=I[31]<<9|I[30]>>>23,ie=I[30]<<9|I[31]>>>23,U=I[40]<<18|I[41]>>>14,Fe=I[41]<<18|I[40]>>>14,Se=I[2]<<1|I[3]>>>31,Me=I[3]<<1|I[2]>>>31,ye=I[13]<<12|I[12]>>>20,Ce=I[12]<<12|I[13]>>>20,Pe=I[22]<<10|I[23]>>>22,ht=I[23]<<10|I[22]>>>22,q=I[33]<<13|I[32]>>>19,X=I[32]<<13|I[33]>>>19,P=I[42]<<2|I[43]>>>30,$=I[43]<<2|I[42]>>>30,Jt=I[5]<<30|I[4]>>>2,sr=I[4]<<30|I[5]>>>2,pe=I[14]<<6|I[15]>>>26,we=I[15]<<6|I[14]>>>26,he=I[25]<<11|I[24]>>>21,Ne=I[24]<<11|I[25]>>>21,wt=I[34]<<15|I[35]>>>17,nt=I[35]<<15|I[34]>>>17,D=I[45]<<29|I[44]>>>3,ge=I[44]<<29|I[45]>>>3,Be=I[6]<<28|I[7]>>>4,Re=I[7]<<28|I[6]>>>4,en=I[17]<<23|I[16]>>>9,qt=I[16]<<23|I[17]>>>9,re=I[26]<<25|I[27]>>>7,be=I[27]<<25|I[26]>>>7,He=I[36]<<21|I[37]>>>11,ne=I[37]<<21|I[36]>>>11,un=I[47]<<24|I[46]>>>8,Et=I[46]<<24|I[47]>>>8,Ze=I[8]<<27|I[9]>>>5,Ye=I[9]<<27|I[8]>>>5,Xe=I[18]<<20|I[19]>>>12,Le=I[19]<<20|I[18]>>>12,Yr=I[29]<<7|I[28]>>>25,ln=I[28]<<7|I[29]>>>25,_e=I[38]<<8|I[39]>>>24,Ee=I[39]<<8|I[38]>>>24,de=I[48]<<14|I[49]>>>18,Ie=I[49]<<14|I[48]>>>18,I[0]=Y^~ye&he,I[1]=ee^~Ce&Ne,I[10]=Be^~Xe&Qe,I[11]=Re^~Le&et,I[20]=Se^~pe&re,I[21]=Me^~we&be,I[30]=Ze^~me&Pe,I[31]=Ye^~Ge&ht,I[40]=Jt^~en&Yr,I[41]=sr^~qt&ln,I[2]=ye^~he&He,I[3]=Ce^~Ne&ne,I[12]=Xe^~Qe&q,I[13]=Le^~et&X,I[22]=pe^~re&_e,I[23]=we^~be&Ee,I[32]=me^~Pe&wt,I[33]=Ge^~ht&nt,I[42]=en^~Yr&cn,I[43]=qt^~ln&ie,I[4]=he^~He&de,I[5]=Ne^~ne&Ie,I[14]=Qe^~q&D,I[15]=et^~X&ge,I[24]=re^~_e&U,I[25]=be^~Ee&Fe,I[34]=Pe^~wt&un,I[35]=ht^~nt&Et,I[44]=Yr^~cn&P,I[45]=ln^~ie&$,I[6]=He^~de&Y,I[7]=ne^~Ie&ee,I[16]=q^~D&Be,I[17]=X^~ge&Re,I[26]=_e^~U&Se,I[27]=Ee^~Fe&Me,I[36]=wt^~un&Ze,I[37]=nt^~Et&Ye,I[46]=cn^~P&Jt,I[47]=ie^~$&sr,I[8]=de^~Y&ye,I[9]=Ie^~ee&Ce,I[18]=D^~Be&Xe,I[19]=ge^~Re&Le,I[28]=U^~Se&pe,I[29]=Fe^~Me&we,I[38]=un^~Ze&me,I[39]=Et^~Ye&Ge,I[48]=P^~Jt&en,I[49]=$^~sr&qt,I[0]^=c[R],I[1]^=c[R+1]};if(n)i.exports=f;else for(var x=0;x<G.length;++x)e[G[x]]=f[G[x]]})()});function Gi(i){return"0x"+X7.keccak_256(tt(i))}const z7="rlp/5.0.0-beta.133",Oo=new We(z7);function O9(i){const e=[];for(;i;)e.unshift(i&255),i>>=8;return e}function J9(i,e,t){let n=0;for(let r=0;r<t;r++)n=n*256+i[e+r];return n}function Q9(i){if(Array.isArray(i)){let n=[];if(i.forEach(function(s){n=n.concat(Q9(s))}),n.length<=55)return n.unshift(192+n.length),n;const r=O9(n.length);return r.unshift(247+r.length),r.concat(n)}sC(i)||Oo.throwArgumentError("RLP object must be BytesLike","object",i);const e=Array.prototype.slice.call(tt(i));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=O9(e.length);return t.unshift(183+t.length),t.concat(e)}function gC(i){return at(Q9(i))}function j9(i,e,t,n){const r=[];for(;t<e+1+n;){const s=q9(i,t);r.push(s.result),t+=s.consumed,t>e+1+n&&Oo.throwError("child data too short",We.errors.BUFFER_OVERRUN,{})}return{consumed:1+n,result:r}}function q9(i,e){if(i.length===0&&Oo.throwError("data too short",We.errors.BUFFER_OVERRUN,{}),i[e]>=248){const t=i[e]-247;e+1+t>i.length&&Oo.throwError("data short segment too short",We.errors.BUFFER_OVERRUN,{});const n=J9(i,e+1,t);return e+1+t+n>i.length&&Oo.throwError("data long segment too short",We.errors.BUFFER_OVERRUN,{}),j9(i,e,e+1+t,t+n)}else if(i[e]>=192){const t=i[e]-192;return e+1+t>i.length&&Oo.throwError("data array too short",We.errors.BUFFER_OVERRUN,{}),j9(i,e,e+1,t)}else if(i[e]>=184){const t=i[e]-183;e+1+t>i.length&&Oo.throwError("data array too short",We.errors.BUFFER_OVERRUN,{});const n=J9(i,e+1,t);e+1+t+n>i.length&&Oo.throwError("data array too short",We.errors.BUFFER_OVERRUN,{});const r=at(i.slice(e+1+t,e+1+t+n));return{consumed:1+t+n,result:r}}else if(i[e]>=128){const t=i[e]-128;e+1+t>i.length&&Oo.throwError("data too short",We.errors.BUFFER_OVERRUN,{});const n=at(i.slice(e+1,e+1+t));return{consumed:1+t,result:n}}return{consumed:1,result:at(i[e])}}function $9(i){const e=tt(i),t=q9(e,0);return t.consumed!==e.length&&Oo.throwArgumentError("invalid rlp data","data",i),t.result}var k7=Object.freeze({encode:gC,decode:$9});const Y7="address/5.0.0-beta.135",Ql=new We(Y7);function eN(i){Qt(i,20)||Ql.throwArgumentError("invalid address","address",i),i=i.toLowerCase();const e=i.substring(2).split(""),t=new Uint8Array(40);for(let r=0;r<40;r++)t[r]=e[r].charCodeAt(0);const n=tt(Gi(t));for(let r=0;r<40;r+=2)n[r>>1]>>4>=8&&(e[r]=e[r].toUpperCase()),(n[r>>1]&15)>=8&&(e[r+1]=e[r+1].toUpperCase());return"0x"+e.join("")}const K7=9007199254740991;function P7(i){return Math.log10?Math.log10(i):Math.log(i)/Math.LN10}const a1={};for(let i=0;i<10;i++)a1[String(i)]=String(i);for(let i=0;i<26;i++)a1[String.fromCharCode(65+i)]=String(10+i);const tN=Math.floor(P7(K7));function nN(i){i=i.toUpperCase(),i=i.substring(4)+i.substring(0,2)+"00";let e=i.split("").map(n=>a1[n]).join("");for(;e.length>=tN;){let n=e.substring(0,tN);e=parseInt(n,10)%97+e.substring(n.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}function Dn(i){let e=null;if(typeof i!="string"&&Ql.throwArgumentError("invalid address","address",i),i.match(/^(0x)?[0-9a-fA-F]{40}$/))i.substring(0,2)!=="0x"&&(i="0x"+i),e=eN(i),i.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&e!==i&&Ql.throwArgumentError("bad address checksum","address",i);else if(i.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){for(i.substring(2,4)!==nN(i)&&Ql.throwArgumentError("bad icap checksum","address",i),e=new iC(i.substring(4),36).toString(16);e.length<40;)e="0"+e;e=eN("0x"+e)}else Ql.throwArgumentError("invalid address","address",i);return e}function D7(i){try{return Dn(i),!0}catch{}return!1}function U7(i){let e=new iC(Dn(i).substring(2),16).toString(36).toUpperCase();for(;e.length<30;)e="0"+e;return"XE"+nN("XE00"+e)+e}function WA(i){let e=null;try{e=Dn(i.from)}catch{Ql.throwArgumentError("missing from address","transaction",i)}const t=wd(tt(ft.from(i.nonce).toHexString()));return Dn(go(Gi(gC([e,t])),12))}function O7(i,e,t){return Jl(e)!==32&&Ql.throwArgumentError("salt must be 32 bytes","salt",e),Jl(t)!==32&&Ql.throwArgumentError("initCodeHash must be 32 bytes","initCodeHash",t),Dn(go(Gi(li(["0xff",Dn(i),e,t])),12))}class J7 extends Ya{constructor(e){super("address","address",e,!1)}encode(e,t){try{Dn(t)}catch(n){this._throwError(n.message,t)}return e.writeValue(t)}decode(e){return Dn(Ji(e.readValue().toHexString(),20))}}class Q7 extends Ya{constructor(e){super(e.name,e.type,void 0,e.dynamic);this.coder=e}encode(e,t){return this.coder.encode(e,t)}decode(e){return this.coder.decode(e)}}const uC=new We(cC);function iN(i,e,t){let n=null;if(Array.isArray(t))n=t;else if(t&&typeof t=="object"){let l={};n=e.map(c=>{const g=c.localName;return g||uC.throwError("cannot encode object for signature with missing names",We.errors.INVALID_ARGUMENT,{argument:"values",coder:c,value:t}),l[g]&&uC.throwError("cannot encode object for signature with duplicate names",We.errors.INVALID_ARGUMENT,{argument:"values",coder:c,value:t}),l[g]=!0,t[g]})}else uC.throwArgumentError("invalid tuple value","tuple",t);e.length!==n.length&&uC.throwArgumentError("types/value length mismatch","tuple",t);let r=new o1(i.wordSize),s=new o1(i.wordSize),o=[];e.forEach((l,c)=>{let g=n[c];if(l.dynamic){let d=s.length;l.encode(s,g);let u=r.writeUpdatableValue();o.push(h=>{u(h+d)})}else l.encode(r,g)}),o.forEach(l=>{l(r.length)});let a=i.writeBytes(r.data);return a+=i.writeBytes(s.data),a}function rN(i,e){let t=[],n=i.subReader(0),r=0;e.forEach(o=>{let a=null;if(o.dynamic){let l=i.readValue(),c=n.subReader(l.toNumber());try{a=o.decode(c)}catch(g){if(g.code===We.errors.BUFFER_OVERRUN)throw g;a=g,a.baseType=o.name,a.name=o.localName,a.type=o.type}r+=c.consumed}else try{a=o.decode(i)}catch(l){if(l.code===We.errors.BUFFER_OVERRUN)throw l;a=l,a.baseType=o.name,a.name=o.localName,a.type=o.type}a!=null&&t.push(a)}),i.readBytes(r);const s=e.reduce((o,a)=>{const l=a.localName;return l&&(o[l]||(o[l]=0),o[l]++),o},{});e.forEach((o,a)=>{let l=o.localName;if(!l||s[l]!==1||(l==="length"&&(l="_length"),t[l]!=null))return;const c=t[a];c instanceof Error?Object.defineProperty(t,l,{get:()=>{throw c}}):t[l]=c});for(let o=0;o<t.length;o++){const a=t[o];a instanceof Error&&Object.defineProperty(t,o,{get:()=>{throw a}})}return Object.freeze(t)}class j7 extends Ya{constructor(e,t,n){const r=e.type+"["+(t>=0?t:"")+"]",s=t===-1||e.dynamic;super("array",r,n,s);this.coder=e,this.length=t}encode(e,t){Array.isArray(t)||this._throwError("expected array value",t);let n=this.length;n===-1&&(n=t.length,e.writeValue(t.length)),uC.checkArgumentCount(n,t.length,"coder array"+(this.localName?" "+this.localName:""));let r=[];for(let s=0;s<t.length;s++)r.push(this.coder);return iN(e,r,t)}decode(e){let t=this.length;t===-1&&(t=e.readValue().toNumber());let n=[];for(let r=0;r<t;r++)n.push(new Q7(this.coder));return e.coerce(this.name,rN(e,n))}}class q7 extends Ya{constructor(e){super("bool","bool",e,!1)}encode(e,t){return e.writeValue(t?1:0)}decode(e){return e.coerce(this.type,!e.readValue().isZero())}}class sN extends Ya{constructor(e,t){super(e,e,t,!0)}encode(e,t){t=tt(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readValue().toNumber())}}class $7 extends sN{constructor(e){super("bytes",e)}decode(e){return e.coerce(this.name,at(super.decode(e)))}}class eJ extends Ya{constructor(e,t){let n="bytes"+String(e);super(n,n,t,!1);this.size=e}encode(e,t){let n=tt(t);return n.length!==this.size&&this._throwError("incorrect data length",t),e.writeBytes(n)}decode(e){return e.coerce(this.name,at(e.readBytes(this.size)))}}class tJ extends Ya{constructor(e){super("null","",e,!1)}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes([])}decode(e){return e.readBytes(0),e.coerce(this.name,null)}}const oN="0x0000000000000000000000000000000000000000",aN="0x0000000000000000000000000000000000000000000000000000000000000000",nJ="\u039E",lN=ft.from(-1),l1=ft.from(0),cN=ft.from(1),iJ=ft.from(2),rJ=ft.from("1000000000000000000"),gN=ft.from("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var sJ=Object.freeze({AddressZero:oN,HashZero:aN,EtherSymbol:nJ,NegativeOne:lN,Zero:l1,One:cN,Two:iJ,WeiPerEther:rJ,MaxUint256:gN});class oJ extends Ya{constructor(e,t,n){const r=(t?"int":"uint")+e*8;super(r,r,n,!1);this.size=e,this.signed=t}encode(e,t){let n=ft.from(t),r=gN.mask(e.wordSize*8);if(this.signed){let s=r.mask(this.size*8-1);(n.gt(s)||n.lt(s.add(cN).mul(lN)))&&this._throwError("value out-of-bounds",t)}else(n.lt(l1)||n.gt(r.mask(this.size*8)))&&this._throwError("value out-of-bounds",t);return n=n.toTwos(this.size*8).mask(this.size*8),this.signed&&(n=n.fromTwos(this.size*8).toTwos(8*e.wordSize)),e.writeValue(n)}decode(e){let t=e.readValue().mask(this.size*8);return this.signed&&(t=t.fromTwos(this.size*8)),e.coerce(this.name,t)}}const aJ="strings/5.0.0-beta.137",uN=new We(aJ);var Jo;(function(i){i.current="",i.NFC="NFC",i.NFD="NFD",i.NFKC="NFKC",i.NFKD="NFKD"})(Jo||(Jo={}));var es;(function(i){i.UNEXPECTED_CONTINUE="unexpected continuation byte",i.BAD_PREFIX="bad codepoint prefix",i.OVERRUN="string overrun",i.MISSING_CONTINUE="missing continuation byte",i.OUT_OF_RANGE="out of UTF-8 range",i.UTF16_SURROGATE="UTF-16 surrogate",i.OVERLONG="overlong representation"})(es||(es={}));function lJ(i,e,t,n,r){return uN.throwArgumentError(`invalid codepoint at offset ${e}; ${i}`,"bytes",t)}function dN(i,e,t,n,r){if(i===es.BAD_PREFIX||i===es.UNEXPECTED_CONTINUE){let s=0;for(let o=e+1;o<t.length&&t[o]>>6==2;o++)s++;return s}return i===es.OVERRUN?t.length-e-1:0}function cJ(i,e,t,n,r){return i===es.OVERLONG?(n.push(r),0):(n.push(65533),dN(i,e,t))}const hN=Object.freeze({error:lJ,ignore:dN,replace:cJ});function c1(i,e){e==null&&(e=hN.error),i=tt(i);const t=[];let n=0;for(;n<i.length;){const r=i[n++];if(r>>7==0){t.push(r);continue}let s=null,o=null;if((r&224)==192)s=1,o=127;else if((r&240)==224)s=2,o=2047;else if((r&248)==240)s=3,o=65535;else{(r&192)==128?n+=e(es.UNEXPECTED_CONTINUE,n-1,i,t):n+=e(es.BAD_PREFIX,n-1,i,t);continue}if(n-1+s>=i.length){n+=e(es.OVERRUN,n-1,i,t);continue}let a=r&(1<<8-s-1)-1;for(let l=0;l<s;l++){let c=i[n];if((c&192)!=128){n+=e(es.MISSING_CONTINUE,n,i,t),a=null;break}a=a<<6|c&63,n++}if(a!==null){if(a>1114111){n+=e(es.OUT_OF_RANGE,n-1-s,i,t,a);continue}if(a>=55296&&a<=57343){n+=e(es.UTF16_SURROGATE,n-1-s,i,t,a);continue}if(a<=o){n+=e(es.OVERLONG,n-1-s,i,t,a);continue}t.push(a)}}return t}function ji(i,e=Jo.current){e!=Jo.current&&(uN.checkNormalize(),i=i.normalize(e));let t=[];for(let n=0;n<i.length;n++){const r=i.charCodeAt(n);if(r<128)t.push(r);else if(r<2048)t.push(r>>6|192),t.push(r&63|128);else if((r&64512)==55296){n++;const s=i.charCodeAt(n);if(n>=i.length||(s&64512)!=56320)throw new Error("invalid utf-8 string");const o=65536+((r&1023)<<10)+(s&1023);t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(o&63|128)}else t.push(r>>12|224),t.push(r>>6&63|128),t.push(r&63|128)}return tt(t)}function g1(i){const e="0000"+i.toString(16);return"\\u"+e.substring(e.length-4)}function gJ(i,e){return'"'+c1(i,e).map(t=>{if(t<256){switch(t){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 13:return"\\r";case 34:return'\\"';case 92:return"\\\\"}if(t>=32&&t<127)return String.fromCharCode(t)}return t<=65535?g1(t):(t-=65536,g1((t>>10&1023)+55296)+g1((t&1023)+56320))}).join("")+'"'}function u1(i){return i.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function _A(i,e){return u1(c1(i,e))}function d1(i,e=Jo.current){return c1(ji(i,e))}function uJ(i){const e=ji(i);if(e.length>31)throw new Error("bytes32 string must be less than 32 bytes");return at(li([e,aN]).slice(0,32))}function dJ(i){const e=tt(i);if(e.length!==32)throw new Error("invalid bytes32 - not 32 bytes long");if(e[31]!==0)throw new Error("invalid bytes32 string - no null terminator");let t=31;for(;e[t-1]===0;)t--;return _A(e.slice(0,t))}function hJ(i){if(i.length%4!=0)throw new Error("bad data");let e=[];for(let t=0;t<i.length;t+=4)e.push(parseInt(i.substring(t,t+4),16));return e}function h1(i,e){e||(e=function(r){return[parseInt(r,16)]});let t=0,n={};return i.split(",").forEach(r=>{let s=r.split(":");t+=parseInt(s[0],16),n[t]=e(s[1])}),n}function fN(i){let e=0;return i.split(",").map(t=>{let n=t.split("-");n.length===1?n[1]="0":n[1]===""&&(n[1]="1");let r=e+parseInt(n[0],16);return e=parseInt(n[1],16),{l:r,h:e}})}function f1(i,e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];if(t+=r.l,i>=t&&i<=t+r.h&&(i-t)%(r.d||1)==0){if(r.e&&r.e.indexOf(i-t)!==-1)continue;return r}}return null}const fJ=fN("221,13-1b,5f-,40-10,51-f,11-3,3-3,2-2,2-4,8,2,15,2d,28-8,88,48,27-,3-5,11-20,27-,8,28,3-5,12,18,b-a,1c-4,6-16,2-d,2-2,2,1b-4,17-9,8f-,10,f,1f-2,1c-34,33-14e,4,36-,13-,6-2,1a-f,4,9-,3-,17,8,2-2,5-,2,8-,3-,4-8,2-3,3,6-,16-6,2-,7-3,3-,17,8,3,3,3-,2,6-3,3-,4-a,5,2-6,10-b,4,8,2,4,17,8,3,6-,b,4,4-,2-e,2-4,b-10,4,9-,3-,17,8,3-,5-,9-2,3-,4-7,3-3,3,4-3,c-10,3,7-2,4,5-2,3,2,3-2,3-2,4-2,9,4-3,6-2,4,5-8,2-e,d-d,4,9,4,18,b,6-3,8,4,5-6,3-8,3-3,b-11,3,9,4,18,b,6-3,8,4,5-6,3-6,2,3-3,b-11,3,9,4,18,11-3,7-,4,5-8,2-7,3-3,b-11,3,13-2,19,a,2-,8-2,2-3,7,2,9-11,4-b,3b-3,1e-24,3,2-,3,2-,2-5,5,8,4,2,2-,3,e,4-,6,2,7-,b-,3-21,49,23-5,1c-3,9,25,10-,2-2f,23,6,3,8-2,5-5,1b-45,27-9,2a-,2-3,5b-4,45-4,53-5,8,40,2,5-,8,2,5-,28,2,5-,20,2,5-,8,2,5-,8,8,18,20,2,5-,8,28,14-5,1d-22,56-b,277-8,1e-2,52-e,e,8-a,18-8,15-b,e,4,3-b,5e-2,b-15,10,b-5,59-7,2b-555,9d-3,5b-5,17-,7-,27-,7-,9,2,2,2,20-,36,10,f-,7,14-,4,a,54-3,2-6,6-5,9-,1c-10,13-1d,1c-14,3c-,10-6,32-b,240-30,28-18,c-14,a0,115-,3,66-,b-76,5,5-,1d,24,2,5-2,2,8-,35-2,19,f-10,1d-3,311-37f,1b,5a-b,d7-19,d-3,41,57-,68-4,29-3,5f,29-37,2e-2,25-c,2c-2,4e-3,30,78-3,64-,20,19b7-49,51a7-59,48e-2,38-738,2ba5-5b,222f-,3c-94,8-b,6-4,1b,6,2,3,3,6d-20,16e-f,41-,37-7,2e-2,11-f,5-b,18-,b,14,5-3,6,88-,2,bf-2,7-,7-,7-,4-2,8,8-9,8-2ff,20,5-b,1c-b4,27-,27-cbb1,f7-9,28-2,b5-221,56,48,3-,2-,3-,5,d,2,5,3,42,5-,9,8,1d,5,6,2-2,8,153-3,123-3,33-27fd,a6da-5128,21f-5df,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3,2-1d,61-ff7d"),IJ="ad,34f,1806,180b,180c,180d,200b,200c,200d,2060,feff".split(",").map(i=>parseInt(i,16)),CJ=[{h:25,s:32,l:65},{h:30,s:32,e:[23],l:127},{h:54,s:1,e:[48],l:64,d:2},{h:14,s:1,l:57,d:2},{h:44,s:1,l:17,d:2},{h:10,s:1,e:[2,6,8],l:61,d:2},{h:16,s:1,l:68,d:2},{h:84,s:1,e:[18,24,66],l:19,d:2},{h:26,s:32,e:[17],l:435},{h:22,s:1,l:71,d:2},{h:15,s:80,l:40},{h:31,s:32,l:16},{h:32,s:1,l:80,d:2},{h:52,s:1,l:42,d:2},{h:12,s:1,l:55,d:2},{h:40,s:1,e:[38],l:15,d:2},{h:14,s:1,l:48,d:2},{h:37,s:48,l:49},{h:148,s:1,l:6351,d:2},{h:88,s:1,l:160,d:2},{h:15,s:16,l:704},{h:25,s:26,l:854},{h:25,s:32,l:55915},{h:37,s:40,l:1247},{h:25,s:-119711,l:53248},{h:25,s:-119763,l:52},{h:25,s:-119815,l:52},{h:25,s:-119867,e:[1,4,5,7,8,11,12,17],l:52},{h:25,s:-119919,l:52},{h:24,s:-119971,e:[2,7,8,17],l:52},{h:24,s:-120023,e:[2,7,13,15,16,17],l:52},{h:25,s:-120075,l:52},{h:25,s:-120127,l:52},{h:25,s:-120179,l:52},{h:25,s:-120231,l:52},{h:25,s:-120283,l:52},{h:25,s:-120335,l:52},{h:24,s:-119543,e:[17],l:56},{h:24,s:-119601,e:[17],l:58},{h:24,s:-119659,e:[17],l:58},{h:24,s:-119717,e:[17],l:58},{h:24,s:-119775,e:[17],l:58}],pJ=h1("b5:3bc,c3:ff,7:73,2:253,5:254,3:256,1:257,5:259,1:25b,3:260,1:263,2:269,1:268,5:26f,1:272,2:275,7:280,3:283,5:288,3:28a,1:28b,5:292,3f:195,1:1bf,29:19e,125:3b9,8b:3b2,1:3b8,1:3c5,3:3c6,1:3c0,1a:3ba,1:3c1,1:3c3,2:3b8,1:3b5,1bc9:3b9,1c:1f76,1:1f77,f:1f7a,1:1f7b,d:1f78,1:1f79,1:1f7c,1:1f7d,107:63,5:25b,4:68,1:68,1:68,3:69,1:69,1:6c,3:6e,4:70,1:71,1:72,1:72,1:72,7:7a,2:3c9,2:7a,2:6b,1:e5,1:62,1:63,3:65,1:66,2:6d,b:3b3,1:3c0,6:64,1b574:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3"),mJ=h1("179:1,2:1,2:1,5:1,2:1,a:4f,a:1,8:1,2:1,2:1,3:1,5:1,3:1,4:1,2:1,3:1,4:1,8:2,1:1,2:2,1:1,2:2,27:2,195:26,2:25,1:25,1:25,2:40,2:3f,1:3f,33:1,11:-6,1:-9,1ac7:-3a,6d:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,b:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,c:-8,2:-8,2:-8,2:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,49:-8,1:-8,1:-4a,1:-4a,d:-56,1:-56,1:-56,1:-56,d:-8,1:-8,f:-8,1:-8,3:-7"),AJ=h1("df:00730073,51:00690307,19:02BC006E,a7:006A030C,18a:002003B9,16:03B903080301,20:03C503080301,1d7:05650582,190f:00680331,1:00740308,1:0077030A,1:0079030A,1:006102BE,b6:03C50313,2:03C503130300,2:03C503130301,2:03C503130342,2a:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,3:1F7003B9,1:03B103B9,1:03AC03B9,2:03B10342,1:03B1034203B9,5:03B103B9,6:1F7403B9,1:03B703B9,1:03AE03B9,2:03B70342,1:03B7034203B9,5:03B703B9,6:03B903080300,1:03B903080301,3:03B90342,1:03B903080342,b:03C503080300,1:03C503080301,1:03C10313,2:03C50342,1:03C503080342,b:1F7C03B9,1:03C903B9,1:03CE03B9,2:03C90342,1:03C9034203B9,5:03C903B9,ac:00720073,5b:00B00063,6:00B00066,d:006E006F,a:0073006D,1:00740065006C,1:0074006D,124f:006800700061,2:00610075,2:006F0076,b:00700061,1:006E0061,1:03BC0061,1:006D0061,1:006B0061,1:006B0062,1:006D0062,1:00670062,3:00700066,1:006E0066,1:03BC0066,4:0068007A,1:006B0068007A,1:006D0068007A,1:00670068007A,1:00740068007A,15:00700061,1:006B00700061,1:006D00700061,1:006700700061,8:00700076,1:006E0076,1:03BC0076,1:006D0076,1:006B0076,1:006D0076,1:00700077,1:006E0077,1:03BC0077,1:006D0077,1:006B0077,1:006D0077,1:006B03C9,1:006D03C9,2:00620071,3:00632215006B0067,1:0063006F002E,1:00640062,1:00670079,2:00680070,2:006B006B,1:006B006D,9:00700068,2:00700070006D,1:00700072,2:00730076,1:00770062,c723:00660066,1:00660069,1:0066006C,1:006600660069,1:00660066006C,1:00730074,1:00730074,d:05740576,1:05740565,1:0574056B,1:057E0576,1:0574056D",hJ),bJ=fN("80-20,2a0-,39c,32,f71,18e,7f2-f,19-7,30-4,7-5,f81-b,5,a800-20ff,4d1-1f,110,fa-6,d174-7,2e84-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,2,1f-5f,ff7f-20001");function yJ(i){return i.reduce((e,t)=>(t.forEach(n=>{e.push(n)}),e),[])}function vJ(i){return!!f1(i,fJ)}function xJ(i){let e=f1(i,CJ);if(e)return[i+e.s];let t=pJ[i];if(t)return t;let n=mJ[i];if(n)return[i+n[0]];let r=AJ[i];return r||null}function wJ(i){return!!f1(i,bJ)}function I1(i){if(i.match(/^[a-z0-9-]*$/i)&&i.length<=59)return i.toLowerCase();let e=d1(i);e=yJ(e.map(n=>{if(IJ.indexOf(n)>=0)return[];if(n>=65024&&n<=65039)return[];let r=xJ(n);return r||[n]})),e=d1(u1(e),Jo.NFKC),e.forEach(n=>{if(wJ(n))throw new Error("STRINGPREP_CONTAINS_PROHIBITED")}),e.forEach(n=>{if(vJ(n))throw new Error("STRINGPREP_CONTAINS_UNASSIGNED")});let t=u1(e);if(t.substring(0,1)==="-"||t.substring(2,4)==="--"||t.substring(t.length-1)==="-")throw new Error("invalid hyphen");if(t.length>63)throw new Error("too long");return t}class GJ extends sN{constructor(e){super("string",e)}encode(e,t){return super.encode(e,ji(t))}decode(e){return _A(super.decode(e))}}class C1 extends Ya{constructor(e,t){let n=!1;const r=[];e.forEach(o=>{o.dynamic&&(n=!0),r.push(o.type)});const s="tuple("+r.join(",")+")";super("tuple",s,t,n);this.coders=e}encode(e,t){return iN(e,this.coders,t)}decode(e){return e.coerce(this.name,rN(e,this.coders))}}const dC=new We(cC),BJ=new RegExp(/^bytes([0-9]*)$/),SJ=new RegExp(/^(u?int)([0-9]*)$/);class VA{constructor(e){dC.checkNew(new.target,VA),ke(this,"coerceFunc",e||null)}_getCoder(e){switch(e.baseType){case"address":return new J7(e.name);case"bool":return new q7(e.name);case"string":return new GJ(e.name);case"bytes":return new $7(e.name);case"array":return new j7(this._getCoder(e.arrayChildren),e.arrayLength,e.name);case"tuple":return new C1((e.components||[]).map(n=>this._getCoder(n)),e.name);case"":return new tJ(e.name)}let t=e.type.match(SJ);if(t){let n=parseInt(t[2]||"256");return(n===0||n>256||n%8!=0)&&dC.throwArgumentError("invalid "+t[1]+" bit length","param",e),new oJ(n/8,t[1]==="int",e.name)}if(t=e.type.match(BJ),t){let n=parseInt(t[1]);return(n===0||n>32)&&dC.throwArgumentError("invalid bytes length","param",e),new eJ(n,e.name)}return dC.throwArgumentError("invalid type","type",e.type)}_getWordSize(){return 32}_getReader(e){return new MA(e,this._getWordSize(),this.coerceFunc)}_getWriter(){return new o1(this._getWordSize())}encode(e,t){e.length!==t.length&&dC.throwError("types/values length mismatch",We.errors.INVALID_ARGUMENT,{count:{types:e.length,values:t.length},value:{types:e,values:t}});const n=e.map(o=>this._getCoder(Qi.from(o))),r=new C1(n,"_"),s=this._getWriter();return r.encode(s,t),s.data}decode(e,t){const n=e.map(s=>this._getCoder(Qi.from(s)));return new C1(n,"_").decode(this._getReader(tt(t)))}}const IN=new VA,ZJ="hash/5.0.0-beta.134",RJ=new We(ZJ),MJ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),WJ=new RegExp("^((.*)\\.)?([^.]+)$");function _J(i){try{const e=i.split(".");for(let t=0;t<e.length;t++)if(I1(e[t]).length===0)throw new Error("empty");return!0}catch{}return!1}function NA(i){typeof i!="string"&&RJ.throwArgumentError("invalid address - "+String(i),"name",i);let e=MJ;for(;i.length;){const t=i.match(WJ),n=ji(I1(t[3]));e=Gi(li([e,Gi(n)])),i=t[2]||""}return at(e)}function _d(i){return Gi(ji(i))}const VJ=`Ethereum Signed Message:
`;function p1(i){return typeof i=="string"&&(i=ji(i)),Gi(li([ji(VJ),ji(String(i.length)),i]))}const Bi=new We(cC);class CN extends Rd{}class pN extends Rd{}class EA extends Rd{static isIndexed(e){return!!(e&&e._isIndexed)}}function mN(i,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${i}`);return t.error=e,t}class hC{constructor(e){Bi.checkNew(new.target,hC);let t=[];typeof e=="string"?t=JSON.parse(e):t=e,ke(this,"fragments",t.map(n=>ka.from(n)).filter(n=>n!=null)),ke(this,"_abiCoder",hr(new.target,"getAbiCoder")()),ke(this,"functions",{}),ke(this,"errors",{}),ke(this,"events",{}),ke(this,"structs",{}),this.fragments.forEach(n=>{let r=null;switch(n.type){case"constructor":if(this.deploy){Bi.warn("duplicate definition - constructor");return}ke(this,"deploy",n);return;case"function":r=this.functions;break;case"event":r=this.events;break;default:return}let s=n.format();if(r[s]){Bi.warn("duplicate definition - "+s);return}r[s]=n}),this.deploy||ke(this,"deploy",Do.from({payable:!1,type:"constructor"})),ke(this,"_isInterface",!0)}format(e){e||(e=vn.full),e===vn.sighash&&Bi.throwArgumentError("interface does not support formatting sighash","format",e);const t=this.fragments.map(n=>n.format(e));return e===vn.json?JSON.stringify(t.map(n=>JSON.parse(n))):t}static getAbiCoder(){return IN}static getAddress(e){return Dn(e)}static getSighash(e){return go(_d(e.format()),0,4)}static getEventTopic(e){return _d(e.format())}getFunction(e){if(Qt(e)){for(const n in this.functions)if(e===this.getSighash(n))return this.functions[n];Bi.throwArgumentError("no matching function","sighash",e)}if(e.indexOf("(")===-1){const n=e.trim(),r=Object.keys(this.functions).filter(s=>s.split("(")[0]===n);return r.length===0?Bi.throwArgumentError("no matching function","name",n):r.length>1&&Bi.throwArgumentError("multiple matching functions","name",n),this.functions[r[0]]}const t=this.functions[Uo.fromString(e).format()];return t||Bi.throwArgumentError("no matching function","signature",e),t}getEvent(e){if(Qt(e)){const n=e.toLowerCase();for(const r in this.events)if(n===this.getEventTopic(r))return this.events[r];Bi.throwArgumentError("no matching event","topichash",n)}if(e.indexOf("(")===-1){const n=e.trim(),r=Object.keys(this.events).filter(s=>s.split("(")[0]===n);return r.length===0?Bi.throwArgumentError("no matching event","name",n):r.length>1&&Bi.throwArgumentError("multiple matching events","name",n),this.events[r[0]]}const t=this.events[Po.fromString(e).format()];return t||Bi.throwArgumentError("no matching event","signature",e),t}getSighash(e){return typeof e=="string"&&(e=this.getFunction(e)),hr(this.constructor,"getSighash")(e)}getEventTopic(e){return typeof e=="string"&&(e=this.getEvent(e)),hr(this.constructor,"getEventTopic")(e)}_decodeParams(e,t){return this._abiCoder.decode(e,t)}_encodeParams(e,t){return this._abiCoder.encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeFunctionData(e,t){typeof e=="string"&&(e=this.getFunction(e));const n=tt(t);return at(n.slice(0,4))!==this.getSighash(e)&&Bi.throwArgumentError(`data signature does not match function ${e.name}.`,"data",at(n)),this._decodeParams(e.inputs,n.slice(4))}encodeFunctionData(e,t){return typeof e=="string"&&(e=this.getFunction(e)),at(li([this.getSighash(e),this._encodeParams(e.inputs,t||[])]))}decodeFunctionResult(e,t){typeof e=="string"&&(e=this.getFunction(e));let n=tt(t),r=null,s=null;switch(n.length%this._abiCoder._getWordSize()){case 0:try{return this._abiCoder.decode(e.outputs,n)}catch{}break;case 4:at(n.slice(0,4))==="0x08c379a0"&&(s="Error(string)",r=this._abiCoder.decode(["string"],n.slice(4))[0]);break}return Bi.throwError("call revert exception",We.errors.CALL_EXCEPTION,{method:e.format(),errorSignature:s,errorArgs:[r],reason:r})}encodeFunctionResult(e,t){return typeof e=="string"&&(e=this.getFunction(e)),at(this._abiCoder.encode(e.outputs,t||[]))}encodeFilterTopics(e,t){typeof e=="string"&&(e=this.getEvent(e)),t.length>e.inputs.length&&Bi.throwError("too many arguments for "+e.format(),We.errors.UNEXPECTED_ARGUMENT,{argument:"values",value:t});let n=[];e.anonymous||n.push(this.getEventTopic(e));const r=(s,o)=>s.type==="string"?_d(o):s.type==="bytes"?Gi(at(o)):(s.type==="address"&&this._abiCoder.encode(["address"],[o]),Ji(at(o),32));for(t.forEach((s,o)=>{let a=e.inputs[o];if(!a.indexed){s!=null&&Bi.throwArgumentError("cannot filter non-indexed parameters; must be null","contract."+a.name,s);return}s==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?Bi.throwArgumentError("filtering with tuples or arrays not supported","contract."+a.name,s):Array.isArray(s)?n.push(s.map(l=>r(a,l))):n.push(r(a,s))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(e,t){typeof e=="string"&&(e=this.getEvent(e));const n=[],r=[],s=[];return e.anonymous||n.push(this.getEventTopic(e)),t.length!==e.inputs.length&&Bi.throwArgumentError("event arguments/values mismatch","values",t),e.inputs.forEach((o,a)=>{const l=t[a];if(o.indexed)if(o.type==="string")n.push(_d(l));else if(o.type==="bytes")n.push(Gi(l));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(this._abiCoder.encode([o.type],[l]))}else r.push(o),s.push(l)}),{data:this._abiCoder.encode(r,s),topics:n}}decodeEventLog(e,t,n){if(typeof e=="string"&&(e=this.getEvent(e)),n!=null&&!e.anonymous){let u=this.getEventTopic(e);(!Qt(n[0],32)||n[0].toLowerCase()!==u)&&Bi.throwError("fragment/topic mismatch",We.errors.INVALID_ARGUMENT,{argument:"topics[0]",expected:u,value:n[0]}),n=n.slice(1)}let r=[],s=[],o=[];e.inputs.forEach((u,h)=>{u.indexed?u.type==="string"||u.type==="bytes"||u.baseType==="tuple"||u.baseType==="array"?(r.push(Qi.fromObject({type:"bytes32",name:u.name})),o.push(!0)):(r.push(u),o.push(!1)):(s.push(u),o.push(!1))});let a=n!=null?this._abiCoder.decode(r,li(n)):null,l=this._abiCoder.decode(s,t),c=[],g=0,d=0;e.inputs.forEach((u,h)=>{if(u.indexed)if(a==null)c[h]=new EA({_isIndexed:!0,hash:null});else if(o[h])c[h]=new EA({_isIndexed:!0,hash:a[d++]});else try{c[h]=a[d++]}catch(p){c[h]=p}else try{c[h]=l[g++]}catch(p){c[h]=p}if(u.name&&c[u.name]==null){const p=c[h];p instanceof Error?Object.defineProperty(c,u.name,{get:()=>{throw mN(`property ${JSON.stringify(u.name)}`,p)}}):c[u.name]=p}});for(let u=0;u<c.length;u++){const h=c[u];h instanceof Error&&Object.defineProperty(c,u,{get:()=>{throw mN(`index ${u}`,h)}})}return Object.freeze(c)}parseTransaction(e){let t=this.getFunction(e.data.substring(0,10).toLowerCase());return t?new pN({args:this._abiCoder.decode(t.inputs,"0x"+e.data.substring(10)),functionFragment:t,name:t.name,signature:t.format(),sighash:this.getSighash(t),value:ft.from(e.value||"0")}):null}parseLog(e){let t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new CN({eventFragment:t,name:t.name,signature:t.format(),topic:this.getEventTopic(t),args:this.decodeEventLog(t,e.data,e.topics)})}static isInterface(e){return!!(e&&e._isInterface)}}const NJ="abstract-provider/5.0.0-beta.142",EJ=new We(NJ);class HJ extends Rd{static isForkEvent(e){return!!(e&&e._isForkEvent)}}class jl{constructor(){EJ.checkAbstract(new.target,jl),ke(this,"_isProvider",!0)}addListener(e,t){return this.on(e,t)}removeListener(e,t){return this.off(e,t)}static isProvider(e){return!!(e&&e._isProvider)}}const FJ="abstract-signer/5.0.0-beta.145";var ql=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const $l=new We(FJ),LJ=["chainId","data","from","gasLimit","gasPrice","nonce","to","value"];class ec{constructor(){$l.checkAbstract(new.target,ec),ke(this,"_isSigner",!0)}getBalance(e){return ql(this,void 0,void 0,function*(){return this._checkProvider("getBalance"),yield this.provider.getBalance(this.getAddress(),e)})}getTransactionCount(e){return ql(this,void 0,void 0,function*(){return this._checkProvider("getTransactionCount"),yield this.provider.getTransactionCount(this.getAddress(),e)})}estimateGas(e){return ql(this,void 0,void 0,function*(){this._checkProvider("estimateGas");const t=yield ci(this.checkTransaction(e));return yield this.provider.estimateGas(t)})}call(e,t){return ql(this,void 0,void 0,function*(){this._checkProvider("call");const n=yield ci(this.checkTransaction(e));return yield this.provider.call(n,t)})}sendTransaction(e){return this._checkProvider("sendTransaction"),this.populateTransaction(e).then(t=>this.signTransaction(t).then(n=>this.provider.sendTransaction(n)))}getChainId(){return ql(this,void 0,void 0,function*(){return this._checkProvider("getChainId"),(yield this.provider.getNetwork()).chainId})}getGasPrice(){return ql(this,void 0,void 0,function*(){return this._checkProvider("getGasPrice"),yield this.provider.getGasPrice()})}resolveName(e){return ql(this,void 0,void 0,function*(){return this._checkProvider("resolveName"),yield this.provider.resolveName(e)})}checkTransaction(e){for(const n in e)LJ.indexOf(n)===-1&&$l.throwArgumentError("invalid transaction key: "+n,"transaction",e);const t=Ei(e);return t.from==null?t.from=this.getAddress():t.from=Promise.all([Promise.resolve(t.from),this.getAddress()]).then(n=>(n[0]!==n[1]&&$l.throwArgumentError("from address mismatch","transaction",e),n[0])),t}populateTransaction(e){return ql(this,void 0,void 0,function*(){const t=yield ci(this.checkTransaction(e));return t.to!=null&&(t.to=Promise.resolve(t.to).then(n=>this.resolveName(n))),t.gasPrice==null&&(t.gasPrice=this.getGasPrice()),t.nonce==null&&(t.nonce=this.getTransactionCount("pending")),t.gasLimit==null&&(t.gasLimit=this.estimateGas(t).catch(n=>$l.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",We.errors.UNPREDICTABLE_GAS_LIMIT,{error:n,tx:t}))),t.chainId==null?t.chainId=this.getChainId():t.chainId=Promise.all([Promise.resolve(t.chainId),this.getChainId()]).then(n=>(n[1]!==0&&n[0]!==n[1]&&$l.throwArgumentError("chainId address mismatch","transaction",e),n[0])),yield ci(t)})}_checkProvider(e){this.provider||$l.throwError("missing provider",We.errors.UNSUPPORTED_OPERATION,{operation:e||"_checkProvider"})}static isSigner(e){return!!(e&&e._isSigner)}}class fC extends ec{constructor(e,t){$l.checkNew(new.target,fC);super();ke(this,"address",e),ke(this,"provider",t||null)}getAddress(){return Promise.resolve(this.address)}_fail(e,t){return Promise.resolve().then(()=>{$l.throwError(e,We.errors.UNSUPPORTED_OPERATION,{operation:t})})}signMessage(e){return this._fail("VoidSigner cannot sign messages","signMessage")}signTransaction(e){return this._fail("VoidSigner cannot sign transactions","signTransaction")}connect(e){return new fC(this.address,e)}}const TJ="contracts/5.0.0-beta.156";var tc=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Un=new We(TJ),XJ={chainId:!0,data:!0,from:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0};function m1(i,e){return tc(this,void 0,void 0,function*(){const t=yield e;try{return Dn(t)}catch{}return i||Un.throwError("a provider or signer is needed to resolve ENS names",We.errors.UNSUPPORTED_OPERATION,{operation:"resolveName"}),yield i.resolveName(t)})}function IC(i,e,t){if(Array.isArray(t))return Promise.all(t.map((n,r)=>IC(i,Array.isArray(e)?e[r]:e[n.name],n)));if(t.type==="address")return m1(i,e);if(t.type==="tuple")return IC(i,e,t.components);if(t.baseType==="array"){if(!Array.isArray(e))throw new Error("invalid value for array");return Promise.all(e.map(n=>IC(i,n,t.arrayChildren)))}return Promise.resolve(e)}function HA(i,e,t){return tc(this,void 0,void 0,function*(){let n={};t.length===e.inputs.length+1&&typeof t[t.length-1]=="object"&&(n=Ei(t.pop())),Un.checkArgumentCount(t.length,e.inputs.length,"passed to contract"),i.signer?n.from?n.from=ci({override:m1(i.signer,n.from),signer:i.signer.getAddress()}).then(l=>tc(this,void 0,void 0,function*(){return Dn(l.signer)!==l.override&&Un.throwError("Contract with a Signer cannot override from",We.errors.UNSUPPORTED_OPERATION,{operation:"overrides.from"}),l.override})):n.from=i.signer.getAddress():n.from&&(n.from=m1(i.provider,n.from));const r=yield ci({args:IC(i.signer||i.provider,t,e.inputs),address:i.resolvedAddress,overrides:ci(n)||{}}),s={data:i.interface.encodeFunctionData(e,r.args),to:r.address},o=r.overrides;if(o.nonce!=null&&(s.nonce=ft.from(o.nonce).toNumber()),o.gasLimit!=null&&(s.gasLimit=ft.from(o.gasLimit)),o.gasPrice!=null&&(s.gasPrice=ft.from(o.gasPrice)),o.from!=null&&(s.from=o.from),s.gasLimit==null&&e.gas!=null&&(s.gasLimit=ft.from(e.gas).add(21e3)),o.value){const l=ft.from(o.value);!l.isZero()&&!e.payable&&Un.throwError("non-payable method cannot override value",We.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:n.value}),s.value=l}delete n.nonce,delete n.gasLimit,delete n.gasPrice,delete n.from,delete n.value;const a=Object.keys(n).filter(l=>n[l]!=null);return a.length&&Un.throwError(`cannot override ${a.map(l=>JSON.stringify(l)).join(",")}`,We.errors.UNSUPPORTED_OPERATION,{operation:"overrides",overrides:a}),s})}function zJ(i,e){return function(...t){return tc(this,void 0,void 0,function*(){return HA(i,e,t)})}}function kJ(i,e){const t=i.signer||i.provider;return function(...n){return tc(this,void 0,void 0,function*(){t||Un.throwError("estimate require a provider or signer",We.errors.UNSUPPORTED_OPERATION,{operation:"estimateGas"});const r=yield HA(i,e,n);return yield t.estimateGas(r)})}}function AN(i,e,t){const n=i.signer||i.provider;return function(...r){return tc(this,void 0,void 0,function*(){let s;if(r.length===e.inputs.length+1&&typeof r[r.length-1]=="object"){const l=Ei(r.pop());l.blockTag!=null&&(s=yield l.blockTag),delete l.blockTag,r.push(l)}i.deployTransaction!=null&&(yield i._deployed(s));const o=yield HA(i,e,r),a=yield n.call(o,s);try{let l=i.interface.decodeFunctionResult(e,a);return t&&e.outputs.length===1&&(l=l[0]),l}catch(l){throw l.code===We.errors.CALL_EXCEPTION&&(l.address=i.address,l.args=r,l.transaction=o),l}})}}function YJ(i,e){return function(...t){return tc(this,void 0,void 0,function*(){i.signer||Un.throwError("sending a transaction requires a signer",We.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction"}),i.deployTransaction!=null&&(yield i._deployed());const n=yield HA(i,e,t),r=yield i.signer.sendTransaction(n),s=r.wait.bind(r);return r.wait=o=>s(o).then(a=>(a.events=a.logs.map(l=>{let c=Ys(l),g=null;try{g=i.interface.parseLog(l)}catch{}return g&&(c.args=g.args,c.decode=(d,u)=>i.interface.decodeEventLog(g.eventFragment,d,u),c.event=g.name,c.eventSignature=g.signature),c.removeListener=()=>i.provider,c.getBlock=()=>i.provider.getBlock(a.blockHash),c.getTransaction=()=>i.provider.getTransaction(a.transactionHash),c.getTransactionReceipt=()=>Promise.resolve(a),c}),a)),r})}}function bN(i,e,t){return e.constant?AN(i,e,t):YJ(i,e)}function yN(i){return i.address&&(i.topics==null||i.topics.length===0)?"*":(i.address||"*")+"@"+(i.topics?i.topics.map(e=>Array.isArray(e)?e.join("|"):e).join(":"):"")}class CC{constructor(e,t){ke(this,"tag",e),ke(this,"filter",t),this._listeners=[]}addListener(e,t){this._listeners.push({listener:e,once:t})}removeListener(e){let t=!1;this._listeners=this._listeners.filter(n=>t||n.listener!==e?!0:(t=!0,!1))}removeAllListeners(){this._listeners=[]}listeners(){return this._listeners.map(e=>e.listener)}listenerCount(){return this._listeners.length}run(e){const t=this.listenerCount();return this._listeners=this._listeners.filter(n=>{const r=e.slice();return setTimeout(()=>{n.listener.apply(this,r)},0),!n.once}),t}prepareEvent(e){}getEmit(e){return[e]}}class KJ extends CC{constructor(){super("error",null)}}class vN extends CC{constructor(e,t,n,r){const s={address:e};let o=t.getEventTopic(n);r?(o!==r[0]&&Un.throwArgumentError("topic mismatch","topics",r),s.topics=r.slice()):s.topics=[o];super(yN(s),s);ke(this,"address",e),ke(this,"interface",t),ke(this,"fragment",n)}prepareEvent(e){super.prepareEvent(e),e.event=this.fragment.name,e.eventSignature=this.fragment.format(),e.decode=(t,n)=>this.interface.decodeEventLog(this.fragment,t,n);try{e.args=this.interface.decodeEventLog(this.fragment,e.data,e.topics)}catch(t){e.args=null,e.decodeError=t}}getEmit(e){const t=U9(e.args);if(t.length)throw t[0].error;const n=(e.args||[]).slice();return n.push(e),n}}class xN extends CC{constructor(e,t){super("*",{address:e});ke(this,"address",e),ke(this,"interface",t)}prepareEvent(e){super.prepareEvent(e);try{const t=this.interface.parseLog(e);e.event=t.name,e.eventSignature=t.signature,e.decode=(n,r)=>this.interface.decodeEventLog(t.eventFragment,n,r),e.args=t.args}catch{}}}class pC{constructor(e,t,n){Un.checkNew(new.target,pC),ke(this,"interface",hr(new.target,"getInterface")(t)),n==null?(ke(this,"provider",null),ke(this,"signer",null)):ec.isSigner(n)?(ke(this,"provider",n.provider||null),ke(this,"signer",n)):jl.isProvider(n)?(ke(this,"provider",n),ke(this,"signer",null)):Un.throwArgumentError("invalid signer or provider","signerOrProvider",n),ke(this,"callStatic",{}),ke(this,"estimateGas",{}),ke(this,"functions",{}),ke(this,"populateTransaction",{}),ke(this,"filters",{});{const o={};Object.keys(this.interface.events).forEach(a=>{const l=this.interface.events[a];ke(this.filters,a,(...c)=>({address:this.address,topics:this.interface.encodeFilterTopics(l,c)})),o[l.name]||(o[l.name]=[]),o[l.name].push(a)}),Object.keys(o).forEach(a=>{const l=o[a];l.length===1?ke(this.filters,a,this.filters[l[0]]):Un.warn(`Duplicate definition of ${a} (${l.join(", ")})`)})}if(ke(this,"_runningEvents",{}),ke(this,"_wrappedEmits",{}),ke(this,"address",e),this.provider)ke(this,"resolvedAddress",this.provider.resolveName(e).then(o=>{if(o==null)throw new Error("name not found");return o}).catch(o=>{throw console.log("ERROR: Cannot find Contract - "+e),o}));else try{ke(this,"resolvedAddress",Promise.resolve(Dn(e)))}catch{Un.throwError("provider is required to use ENS name as contract address",We.errors.UNSUPPORTED_OPERATION,{operation:"new Contract"})}const r={},s={};Object.keys(this.interface.functions).forEach(o=>{const a=this.interface.functions[o];if(s[o]){Un.warn(`Duplicate ABI entry for ${JSON.stringify(name)}`);return}s[o]=!0;{const l=a.name;r[l]||(r[l]=[]),r[l].push(o)}this[o]==null&&ke(this,o,bN(this,a,!0)),this.functions[o]==null&&ke(this.functions,o,bN(this,a,!1)),this.callStatic[o]==null&&ke(this.callStatic,o,AN(this,a,!0)),this.populateTransaction[o]==null&&ke(this.populateTransaction,o,zJ(this,a)),this.estimateGas[o]==null&&ke(this.estimateGas,o,kJ(this,a))}),Object.keys(r).forEach(o=>{const a=r[o];if(a.length>1)return;const l=a[0];this[o]==null&&ke(this,o,this[l]),this.functions[o]==null&&ke(this.functions,o,this.functions[l]),this.callStatic[o]==null&&ke(this.callStatic,o,this.callStatic[l]),this.populateTransaction[o]==null&&ke(this.populateTransaction,o,this.populateTransaction[l]),this.estimateGas[o]==null&&ke(this.estimateGas,o,this.estimateGas[l])})}static getContractAddress(e){return WA(e)}static getInterface(e){return hC.isInterface(e)?e:new hC(e)}deployed(){return this._deployed()}_deployed(e){return this._deployedPromise||(this.deployTransaction?this._deployedPromise=this.deployTransaction.wait().then(()=>this):this._deployedPromise=this.provider.getCode(this.address,e).then(t=>(t==="0x"&&Un.throwError("contract not deployed",We.errors.UNSUPPORTED_OPERATION,{contractAddress:this.address,operation:"getDeployed"}),this))),this._deployedPromise}fallback(e){this.signer||Un.throwError("sending a transactions require a signer",We.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction(fallback)"});const t=Ei(e||{});return["from","to"].forEach(function(n){t[n]!=null&&Un.throwError("cannot override "+n,We.errors.UNSUPPORTED_OPERATION,{operation:n})}),t.to=this.resolvedAddress,this.deployed().then(()=>this.signer.sendTransaction(t))}connect(e){typeof e=="string"&&(e=new fC(e,this.provider));const t=new this.constructor(this.address,this.interface,e);return this.deployTransaction&&ke(t,"deployTransaction",this.deployTransaction),t}attach(e){return new this.constructor(e,this.interface,this.signer||this.provider)}static isIndexed(e){return EA.isIndexed(e)}_normalizeRunningEvent(e){return this._runningEvents[e.tag]?this._runningEvents[e.tag]:e}_getRunningEvent(e){if(typeof e=="string"){if(e==="error")return this._normalizeRunningEvent(new KJ);if(e==="event")return this._normalizeRunningEvent(new CC("event",null));if(e==="*")return this._normalizeRunningEvent(new xN(this.address,this.interface));const t=this.interface.getEvent(e);return this._normalizeRunningEvent(new vN(this.address,this.interface,t))}if(e.topics&&e.topics.length>0){try{const n=e.topics[0];if(typeof n!="string")throw new Error("invalid topic");const r=this.interface.getEvent(n);return this._normalizeRunningEvent(new vN(this.address,this.interface,r,e.topics))}catch{}const t={address:this.address,topics:e.topics};return this._normalizeRunningEvent(new CC(yN(t),t))}return this._normalizeRunningEvent(new xN(this.address,this.interface))}_checkRunningEvents(e){if(e.listenerCount()===0){delete this._runningEvents[e.tag];const t=this._wrappedEmits[e.tag];t&&(this.provider.off(e.filter,t),delete this._wrappedEmits[e.tag])}}_wrapEvent(e,t,n){const r=Ys(t);return r.removeListener=()=>{!n||(e.removeListener(n),this._checkRunningEvents(e))},r.getBlock=()=>this.provider.getBlock(t.blockHash),r.getTransaction=()=>this.provider.getTransaction(t.transactionHash),r.getTransactionReceipt=()=>this.provider.getTransactionReceipt(t.transactionHash),e.prepareEvent(r),r}_addEventListener(e,t,n){if(this.provider||Un.throwError("events require a provider or a signer with a provider",We.errors.UNSUPPORTED_OPERATION,{operation:"once"}),e.addListener(t,n),this._runningEvents[e.tag]=e,!this._wrappedEmits[e.tag]){const r=s=>{let o=this._wrapEvent(e,s,t);if(o.decodeError==null)try{const a=e.getEmit(o);this.emit(e.filter,...a)}catch(a){o.decodeError=a.error}e.filter!=null&&this.emit("event",o),o.decodeError!=null&&this.emit("error",o.decodeError,o)};this._wrappedEmits[e.tag]=r,e.filter!=null&&this.provider.on(e.filter,r)}}queryFilter(e,t,n){const r=this._getRunningEvent(e),s=Ei(r.filter);return typeof t=="string"&&Qt(t,32)?(n!=null&&Un.throwArgumentError("cannot specify toBlock with blockhash","toBlock",n),s.blockHash=t):(s.fromBlock=t!=null?t:0,s.toBlock=n!=null?n:"latest"),this.provider.getLogs(s).then(o=>o.map(a=>this._wrapEvent(r,a,null)))}on(e,t){return this._addEventListener(this._getRunningEvent(e),t,!1),this}once(e,t){return this._addEventListener(this._getRunningEvent(e),t,!0),this}emit(e,...t){if(!this.provider)return!1;const n=this._getRunningEvent(e),r=n.run(t)>0;return this._checkRunningEvents(n),r}listenerCount(e){return this.provider?this._getRunningEvent(e).listenerCount():0}listeners(e){if(!this.provider)return[];if(e==null){const t=[];for(let n in this._runningEvents)this._runningEvents[n].listeners().forEach(r=>{t.push(r)});return t}return this._getRunningEvent(e).listeners()}removeAllListeners(e){if(!this.provider)return this;if(e==null){for(const n in this._runningEvents){const r=this._runningEvents[n];r.removeAllListeners(),this._checkRunningEvents(r)}return this}const t=this._getRunningEvent(e);return t.removeAllListeners(),this._checkRunningEvents(t),this}off(e,t){if(!this.provider)return this;const n=this._getRunningEvent(e);return n.removeListener(t),this._checkRunningEvents(n),this}removeListener(e,t){return this.off(e,t)}}class PJ{constructor(e,t,n){let r=null;typeof t=="string"?r=t:za(t)?r=at(t):t&&typeof t.object=="string"?r=t.object:r="!",r.substring(0,2)!=="0x"&&(r="0x"+r),(!Qt(r)||r.length%2)&&Un.throwArgumentError("invalid bytecode","bytecode",t),n&&!ec.isSigner(n)&&Un.throwArgumentError("invalid signer","signer",n),ke(this,"bytecode",r),ke(this,"interface",hr(new.target,"getInterface")(e)),ke(this,"signer",n||null)}getDeployTransaction(...e){let t={};if(e.length===this.interface.deploy.inputs.length+1&&typeof e[e.length-1]=="object"){t=Ei(e.pop());for(const n in t)if(!XJ[n])throw new Error("unknown transaction override "+n)}return["data","from","to"].forEach(n=>{t[n]!=null&&Un.throwError("cannot override "+n,We.errors.UNSUPPORTED_OPERATION,{operation:n})}),Un.checkArgumentCount(e.length,this.interface.deploy.inputs.length," in Contract constructor"),t.data=at(li([this.bytecode,this.interface.encodeDeploy(e)])),t}deploy(...e){return tc(this,void 0,void 0,function*(){let t={};e.length===this.interface.deploy.inputs.length+1&&(t=e.pop()),Un.checkArgumentCount(e.length,this.interface.deploy.inputs.length," in Contract constructor");const n=yield IC(this.signer,e,this.interface.deploy.inputs);n.push(t);const r=this.getDeployTransaction(...n),s=yield this.signer.sendTransaction(r),o=hr(this.constructor,"getContractAddress")(s),a=hr(this.constructor,"getContract")(o,this.interface,this.signer);return ke(a,"deployTransaction",s),a})}attach(e){return this.constructor.getContract(e,this.interface,this.signer)}connect(e){return new this.constructor(this.interface,this.bytecode,e)}static fromSolidity(e,t){e==null&&Un.throwError("missing compiler output",We.errors.MISSING_ARGUMENT,{argument:"compilerOutput"}),typeof e=="string"&&(e=JSON.parse(e));const n=e.abi;let r=null;return e.bytecode?r=e.bytecode:e.evm&&e.evm.bytecode&&(r=e.evm.bytecode),new this(n,r,t)}static getInterface(e){return pC.getInterface(e)}static getContractAddress(e){return WA(e)}static getContract(e,t,n){return new pC(e,t,n)}}class wN{constructor(e){ke(this,"alphabet",e),ke(this,"base",e.length),ke(this,"_alphabetMap",{}),ke(this,"_leader",e.charAt(0));for(let t=0;t<e.length;t++)this._alphabetMap[e.charAt(t)]=t}encode(e){let t=tt(e);if(t.length===0)return"";let n=[0];for(let s=0;s<t.length;++s){let o=t[s];for(let a=0;a<n.length;++a)o+=n[a]<<8,n[a]=o%this.base,o=o/this.base|0;for(;o>0;)n.push(o%this.base),o=o/this.base|0}let r="";for(let s=0;t[s]===0&&s<t.length-1;++s)r+=this._leader;for(let s=n.length-1;s>=0;--s)r+=this.alphabet[n[s]];return r}decode(e){if(typeof e!="string")throw new TypeError("Expected String");let t=[];if(e.length===0)return new Uint8Array(t);t.push(0);for(let n=0;n<e.length;n++){let r=this._alphabetMap[e[n]];if(r===void 0)throw new Error("Non-base"+this.base+" character");let s=r;for(let o=0;o<t.length;++o)s+=t[o]*this.base,t[o]=s&255,s>>=8;for(;s>0;)t.push(s&255),s>>=8}for(let n=0;e[n]===this._leader&&n<e.length-1;++n)t.push(0);return tt(new Uint8Array(t.reverse()))}}new wN("abcdefghijklmnopqrstuvwxyz234567");const GN=new wN("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var nc=BN;function BN(i,e){if(!i)throw new Error(e||"Assertion failed")}BN.equal=function(e,t,n){if(e!=t)throw new Error(n||"Assertion failed: "+e+" != "+t)};var FA=Vr(function(i){typeof Object.create=="function"?i.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:i.exports=function(t,n){if(n){t.super_=n;var r=function(){};r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t}}}),DJ=FA;function UJ(i,e){if(Array.isArray(i))return i.slice();if(!i)return[];var t=[];if(typeof i=="string")if(e){if(e==="hex")for(i=i.replace(/[^a-z0-9]+/ig,""),i.length%2!=0&&(i="0"+i),n=0;n<i.length;n+=2)t.push(parseInt(i[n]+i[n+1],16))}else for(var n=0;n<i.length;n++){var r=i.charCodeAt(n),s=r>>8,o=r&255;s?t.push(s,o):t.push(o)}else for(n=0;n<i.length;n++)t[n]=i[n]|0;return t}var OJ=UJ;function JJ(i){for(var e="",t=0;t<i.length;t++)e+=ZN(i[t].toString(16));return e}var QJ=JJ;function SN(i){var e=i>>>24|i>>>8&65280|i<<8&16711680|(i&255)<<24;return e>>>0}var jJ=SN;function qJ(i,e){for(var t="",n=0;n<i.length;n++){var r=i[n];e==="little"&&(r=SN(r)),t+=RN(r.toString(16))}return t}var $J=qJ;function ZN(i){return i.length===1?"0"+i:i}var e8=ZN;function RN(i){return i.length===7?"0"+i:i.length===6?"00"+i:i.length===5?"000"+i:i.length===4?"0000"+i:i.length===3?"00000"+i:i.length===2?"000000"+i:i.length===1?"0000000"+i:i}var t8=RN;function n8(i,e,t,n){var r=t-e;nc(r%4==0);for(var s=new Array(r/4),o=0,a=e;o<s.length;o++,a+=4){var l;n==="big"?l=i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3]:l=i[a+3]<<24|i[a+2]<<16|i[a+1]<<8|i[a],s[o]=l>>>0}return s}var i8=n8;function r8(i,e){for(var t=new Array(i.length*4),n=0,r=0;n<i.length;n++,r+=4){var s=i[n];e==="big"?(t[r]=s>>>24,t[r+1]=s>>>16&255,t[r+2]=s>>>8&255,t[r+3]=s&255):(t[r+3]=s>>>24,t[r+2]=s>>>16&255,t[r+1]=s>>>8&255,t[r]=s&255)}return t}var s8=r8;function o8(i,e){return i>>>e|i<<32-e}var a8=o8;function l8(i,e){return i<<e|i>>>32-e}var c8=l8;function g8(i,e){return i+e>>>0}var u8=g8;function d8(i,e,t){return i+e+t>>>0}var h8=d8;function f8(i,e,t,n){return i+e+t+n>>>0}var I8=f8;function C8(i,e,t,n,r){return i+e+t+n+r>>>0}var p8=C8;function m8(i,e,t,n){var r=i[e],s=i[e+1],o=n+s>>>0,a=(o<n?1:0)+t+r;i[e]=a>>>0,i[e+1]=o}var A8=m8;function b8(i,e,t,n){var r=e+n>>>0,s=(r<e?1:0)+i+t;return s>>>0}var y8=b8;function v8(i,e,t,n){var r=e+n;return r>>>0}var x8=v8;function w8(i,e,t,n,r,s,o,a){var l=0,c=e;c=c+n>>>0,l+=c<e?1:0,c=c+s>>>0,l+=c<s?1:0,c=c+a>>>0,l+=c<a?1:0;var g=i+t+r+o+l;return g>>>0}var G8=w8;function B8(i,e,t,n,r,s,o,a){var l=e+n+s+a;return l>>>0}var S8=B8;function Z8(i,e,t,n,r,s,o,a,l,c){var g=0,d=e;d=d+n>>>0,g+=d<e?1:0,d=d+s>>>0,g+=d<s?1:0,d=d+a>>>0,g+=d<a?1:0,d=d+c>>>0,g+=d<c?1:0;var u=i+t+r+o+l+g;return u>>>0}var R8=Z8;function M8(i,e,t,n,r,s,o,a,l,c){var g=e+n+s+a+c;return g>>>0}var W8=M8;function _8(i,e,t){var n=e<<32-t|i>>>t;return n>>>0}var V8=_8;function N8(i,e,t){var n=i<<32-t|e>>>t;return n>>>0}var E8=N8;function H8(i,e,t){return i>>>t}var F8=H8;function L8(i,e,t){var n=i<<32-t|e>>>t;return n>>>0}var T8=L8,gn={inherits:DJ,toArray:OJ,toHex:QJ,htonl:jJ,toHex32:$J,zero2:e8,zero8:t8,join32:i8,split32:s8,rotr32:a8,rotl32:c8,sum32:u8,sum32_3:h8,sum32_4:I8,sum32_5:p8,sum64:A8,sum64_hi:y8,sum64_lo:x8,sum64_4_hi:G8,sum64_4_lo:S8,sum64_5_hi:R8,sum64_5_lo:W8,rotr64_hi:V8,rotr64_lo:E8,shr64_hi:F8,shr64_lo:T8};function LA(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}var X8=LA;LA.prototype.update=function(e,t){if(e=gn.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var n=e.length%this._delta8;this.pending=e.slice(e.length-n,e.length),this.pending.length===0&&(this.pending=null),e=gn.join32(e,0,e.length-n,this.endian);for(var r=0;r<e.length;r+=this._delta32)this._update(e,r,r+this._delta32)}return this};LA.prototype.digest=function(e){return this.update(this._pad()),nc(this.pending===null),this._digest(e)};LA.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,n=t-(e+this.padLength)%t,r=new Array(n+this.padLength);r[0]=128;for(var s=1;s<n;s++)r[s]=0;if(e<<=3,this.endian==="big"){for(var o=8;o<this.padLength;o++)r[s++]=0;r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=e>>>24&255,r[s++]=e>>>16&255,r[s++]=e>>>8&255,r[s++]=e&255}else for(r[s++]=e&255,r[s++]=e>>>8&255,r[s++]=e>>>16&255,r[s++]=e>>>24&255,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,o=8;o<this.padLength;o++)r[s++]=0;return r};var TA={BlockHash:X8},z8={},k8={},Qo=gn.rotr32;function Y8(i,e,t,n){if(i===0)return MN(e,t,n);if(i===1||i===3)return _N(e,t,n);if(i===2)return WN(e,t,n)}var K8=Y8;function MN(i,e,t){return i&e^~i&t}var P8=MN;function WN(i,e,t){return i&e^i&t^e&t}var D8=WN;function _N(i,e,t){return i^e^t}var U8=_N;function O8(i){return Qo(i,2)^Qo(i,13)^Qo(i,22)}var J8=O8;function Q8(i){return Qo(i,6)^Qo(i,11)^Qo(i,25)}var j8=Q8;function q8(i){return Qo(i,7)^Qo(i,18)^i>>>3}var $8=q8;function e6(i){return Qo(i,17)^Qo(i,19)^i>>>10}var t6=e6,Vd={ft_1:K8,ch32:P8,maj32:D8,p32:U8,s0_256:J8,s1_256:j8,g0_256:$8,g1_256:t6},ho=gn.sum32,n6=gn.sum32_4,i6=gn.sum32_5,r6=Vd.ch32,s6=Vd.maj32,o6=Vd.s0_256,a6=Vd.s1_256,l6=Vd.g0_256,c6=Vd.g1_256,VN=TA.BlockHash,g6=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function jo(){if(!(this instanceof jo))return new jo;VN.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=g6,this.W=new Array(64)}gn.inherits(jo,VN);var u6=jo;jo.blockSize=512;jo.outSize=256;jo.hmacStrength=192;jo.padLength=64;jo.prototype._update=function(e,t){for(var n=this.W,r=0;r<16;r++)n[r]=e[t+r];for(;r<n.length;r++)n[r]=n6(c6(n[r-2]),n[r-7],l6(n[r-15]),n[r-16]);var s=this.h[0],o=this.h[1],a=this.h[2],l=this.h[3],c=this.h[4],g=this.h[5],d=this.h[6],u=this.h[7];for(nc(this.k.length===n.length),r=0;r<n.length;r++){var h=i6(u,a6(c),r6(c,g,d),this.k[r],n[r]),p=ho(o6(s),s6(s,o,a));u=d,d=g,g=c,c=ho(l,h),l=a,a=o,o=s,s=ho(h,p)}this.h[0]=ho(this.h[0],s),this.h[1]=ho(this.h[1],o),this.h[2]=ho(this.h[2],a),this.h[3]=ho(this.h[3],l),this.h[4]=ho(this.h[4],c),this.h[5]=ho(this.h[5],g),this.h[6]=ho(this.h[6],d),this.h[7]=ho(this.h[7],u)};jo.prototype._digest=function(e){return e==="hex"?gn.toHex32(this.h,"big"):gn.split32(this.h,"big")};var d6={},qo=gn.rotr64_hi,$o=gn.rotr64_lo,NN=gn.shr64_hi,EN=gn.shr64_lo,ic=gn.sum64,A1=gn.sum64_hi,b1=gn.sum64_lo,h6=gn.sum64_4_hi,f6=gn.sum64_4_lo,I6=gn.sum64_5_hi,C6=gn.sum64_5_lo,HN=TA.BlockHash,p6=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function fo(){if(!(this instanceof fo))return new fo;HN.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=p6,this.W=new Array(160)}gn.inherits(fo,HN);var m6=fo;fo.blockSize=1024;fo.outSize=512;fo.hmacStrength=192;fo.padLength=128;fo.prototype._prepareBlock=function(e,t){for(var n=this.W,r=0;r<32;r++)n[r]=e[t+r];for(;r<n.length;r+=2){var s=R6(n[r-4],n[r-3]),o=M6(n[r-4],n[r-3]),a=n[r-14],l=n[r-13],c=S6(n[r-30],n[r-29]),g=Z6(n[r-30],n[r-29]),d=n[r-32],u=n[r-31];n[r]=h6(s,o,a,l,c,g,d,u),n[r+1]=f6(s,o,a,l,c,g,d,u)}};fo.prototype._update=function(e,t){this._prepareBlock(e,t);var n=this.W,r=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],l=this.h[4],c=this.h[5],g=this.h[6],d=this.h[7],u=this.h[8],h=this.h[9],p=this.h[10],b=this.h[11],y=this.h[12],m=this.h[13],f=this.h[14],G=this.h[15];nc(this.k.length===n.length);for(var x=0;x<n.length;x+=2){var B=f,M=G,E=G6(u,h),z=B6(u,h),J=A6(u,h,p,b,y),V=b6(u,h,p,b,y,m),I=this.k[x],w=this.k[x+1],S=n[x],R=n[x+1],W=I6(B,M,E,z,J,V,I,w,S,R),H=C6(B,M,E,z,J,V,I,w,S,R);B=x6(r,s),M=w6(r,s),E=y6(r,s,o,a,l),z=v6(r,s,o,a,l,c);var k=A1(B,M,E,z),_=b1(B,M,E,z);f=y,G=m,y=p,m=b,p=u,b=h,u=A1(g,d,W,H),h=b1(d,d,W,H),g=l,d=c,l=o,c=a,o=r,a=s,r=A1(W,H,k,_),s=b1(W,H,k,_)}ic(this.h,0,r,s),ic(this.h,2,o,a),ic(this.h,4,l,c),ic(this.h,6,g,d),ic(this.h,8,u,h),ic(this.h,10,p,b),ic(this.h,12,y,m),ic(this.h,14,f,G)};fo.prototype._digest=function(e){return e==="hex"?gn.toHex32(this.h,"big"):gn.split32(this.h,"big")};function A6(i,e,t,n,r){var s=i&t^~i&r;return s<0&&(s+=4294967296),s}function b6(i,e,t,n,r,s){var o=e&n^~e&s;return o<0&&(o+=4294967296),o}function y6(i,e,t,n,r){var s=i&t^i&r^t&r;return s<0&&(s+=4294967296),s}function v6(i,e,t,n,r,s){var o=e&n^e&s^n&s;return o<0&&(o+=4294967296),o}function x6(i,e){var t=qo(i,e,28),n=qo(e,i,2),r=qo(e,i,7),s=t^n^r;return s<0&&(s+=4294967296),s}function w6(i,e){var t=$o(i,e,28),n=$o(e,i,2),r=$o(e,i,7),s=t^n^r;return s<0&&(s+=4294967296),s}function G6(i,e){var t=qo(i,e,14),n=qo(i,e,18),r=qo(e,i,9),s=t^n^r;return s<0&&(s+=4294967296),s}function B6(i,e){var t=$o(i,e,14),n=$o(i,e,18),r=$o(e,i,9),s=t^n^r;return s<0&&(s+=4294967296),s}function S6(i,e){var t=qo(i,e,1),n=qo(i,e,8),r=NN(i,e,7),s=t^n^r;return s<0&&(s+=4294967296),s}function Z6(i,e){var t=$o(i,e,1),n=$o(i,e,8),r=EN(i,e,7),s=t^n^r;return s<0&&(s+=4294967296),s}function R6(i,e){var t=qo(i,e,19),n=qo(e,i,29),r=NN(i,e,6),s=t^n^r;return s<0&&(s+=4294967296),s}function M6(i,e){var t=$o(i,e,19),n=$o(e,i,29),r=EN(i,e,6),s=t^n^r;return s<0&&(s+=4294967296),s}var W6=z8,_6=k8,V6=u6,N6=d6,E6=m6,H6={sha1:W6,sha224:_6,sha256:V6,sha384:N6,sha512:E6},XA=gn.rotl32,FN=gn.sum32,mC=gn.sum32_3,LN=gn.sum32_4,TN=TA.BlockHash;function ea(){if(!(this instanceof ea))return new ea;TN.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}gn.inherits(ea,TN);var F6=ea;ea.blockSize=512;ea.outSize=160;ea.hmacStrength=192;ea.padLength=64;ea.prototype._update=function(e,t){for(var n=this.h[0],r=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],l=n,c=r,g=s,d=o,u=a,h=0;h<80;h++){var p=FN(XA(LN(n,XN(h,r,s,o),e[X6[h]+t],L6(h)),k6[h]),a);n=a,a=o,o=XA(s,10),s=r,r=p,p=FN(XA(LN(l,XN(79-h,c,g,d),e[z6[h]+t],T6(h)),Y6[h]),u),l=u,u=d,d=XA(g,10),g=c,c=p}p=mC(this.h[1],s,d),this.h[1]=mC(this.h[2],o,u),this.h[2]=mC(this.h[3],a,l),this.h[3]=mC(this.h[4],n,c),this.h[4]=mC(this.h[0],r,g),this.h[0]=p};ea.prototype._digest=function(e){return e==="hex"?gn.toHex32(this.h,"little"):gn.split32(this.h,"little")};function XN(i,e,t,n){return i<=15?e^t^n:i<=31?e&t|~e&n:i<=47?(e|~t)^n:i<=63?e&n|t&~n:e^(t|~n)}function L6(i){return i<=15?0:i<=31?1518500249:i<=47?1859775393:i<=63?2400959708:2840853838}function T6(i){return i<=15?1352829926:i<=31?1548603684:i<=47?1836072691:i<=63?2053994217:0}var X6=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],z6=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],k6=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],Y6=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],K6={ripemd160:F6};function Nd(i,e,t){if(!(this instanceof Nd))return new Nd(i,e,t);this.Hash=i,this.blockSize=i.blockSize/8,this.outSize=i.outSize/8,this.inner=null,this.outer=null,this._init(gn.toArray(e,t))}var P6=Nd;Nd.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),nc(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=new this.Hash().update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=new this.Hash().update(e)};Nd.prototype.update=function(e,t){return this.inner.update(e,t),this};Nd.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)};var ts=Vr(function(i,e){var t=e;t.utils=gn,t.common=TA,t.sha=H6,t.ripemd=K6,t.hmac=P6,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160});ts.hmac;ts.ripemd160;ts.sha256;ts.sha512;var y1=Vr(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.version="sha2/5.0.0-beta.137"});bA(y1);y1.version;var Ed=Vr(function(i,e){var t=yg&&yg.__importStar||function(g){if(g&&g.__esModule)return g;var d={};if(g!=null)for(var u in g)Object.hasOwnProperty.call(g,u)&&(d[u]=g[u]);return d.default=g,d};Object.defineProperty(e,"__esModule",{value:!0});var n=t(ts),r=new xA.Logger(y1.version),s;(function(g){g.sha256="sha256",g.sha512="sha512"})(s=e.SupportedAlgorithm||(e.SupportedAlgorithm={}));function o(g){return"0x"+n.ripemd160().update(oC.arrayify(g)).digest("hex")}e.ripemd160=o;function a(g){return"0x"+n.sha256().update(oC.arrayify(g)).digest("hex")}e.sha256=a;function l(g){return"0x"+n.sha512().update(oC.arrayify(g)).digest("hex")}e.sha512=l;function c(g,d,u){return s[g]||r.throwError("unsupported algorithm "+g,xA.Logger.errors.UNSUPPORTED_OPERATION,{operation:"hmac",algorithm:g}),"0x"+n.hmac(n[g],oC.arrayify(d)).update(oC.arrayify(u)).digest("hex")}e.computeHmac=c});bA(Ed);var v1=Ed.SupportedAlgorithm,zN=Ed.ripemd160,xg=Ed.sha256,D6=Ed.sha512,AC=Ed.computeHmac;function x1(i,e,t,n,r){i=tt(i),e=tt(e);let s,o=1;const a=new Uint8Array(n),l=new Uint8Array(e.length+4);l.set(e);let c,g;for(let d=1;d<=o;d++){l[e.length]=d>>24&255,l[e.length+1]=d>>16&255,l[e.length+2]=d>>8&255,l[e.length+3]=d&255;let u=tt(AC(r,i,l));s||(s=u.length,g=new Uint8Array(s),o=Math.ceil(n/s),c=n-(o-1)*s),g.set(u);for(let b=1;b<t;b++){u=tt(AC(r,i,u));for(let y=0;y<s;y++)g[y]^=u[y]}const h=(d-1)*s,p=d===o?c:s;a.set(tt(g).slice(0,p),h)}return at(a)}var kN="6.5.2",U6={version:kN},O6=Object.freeze({version:kN,default:U6}),Io=Vr(function(i,e){var t=e;function n(o,a){if(Array.isArray(o))return o.slice();if(!o)return[];var l=[];if(typeof o!="string"){for(var c=0;c<o.length;c++)l[c]=o[c]|0;return l}if(a==="hex"){o=o.replace(/[^a-z0-9]+/ig,""),o.length%2!=0&&(o="0"+o);for(var c=0;c<o.length;c+=2)l.push(parseInt(o[c]+o[c+1],16))}else for(var c=0;c<o.length;c++){var g=o.charCodeAt(c),d=g>>8,u=g&255;d?l.push(d,u):l.push(u)}return l}t.toArray=n;function r(o){return o.length===1?"0"+o:o}t.zero2=r;function s(o){for(var a="",l=0;l<o.length;l++)a+=r(o[l].toString(16));return a}t.toHex=s,t.encode=function(a,l){return l==="hex"?s(a):a}}),Cs=Vr(function(i,e){var t=e;t.assert=nc,t.toArray=Io.toArray,t.zero2=Io.zero2,t.toHex=Io.toHex,t.encode=Io.encode;function n(l,c,g){var d=new Array(Math.max(l.bitLength(),g)+1);d.fill(0);for(var u=1<<c+1,h=l.clone(),p=0;p<d.length;p++){var b,y=h.andln(u-1);h.isOdd()?(y>(u>>1)-1?b=(u>>1)-y:b=y,h.isubn(b)):b=0,d[p]=b,h.iushrn(1)}return d}t.getNAF=n;function r(l,c){var g=[[],[]];l=l.clone(),c=c.clone();for(var d=0,u=0;l.cmpn(-d)>0||c.cmpn(-u)>0;){var h=l.andln(3)+d&3,p=c.andln(3)+u&3;h===3&&(h=-1),p===3&&(p=-1);var b;if((h&1)==0)b=0;else{var y=l.andln(7)+d&7;(y===3||y===5)&&p===2?b=-h:b=h}g[0].push(b);var m;if((p&1)==0)m=0;else{var y=c.andln(7)+u&7;(y===3||y===5)&&h===2?m=-p:m=p}g[1].push(m),2*d===b+1&&(d=1-d),2*u===m+1&&(u=1-u),l.iushrn(1),c.iushrn(1)}return g}t.getJSF=r;function s(l,c,g){var d="_"+c;l.prototype[c]=function(){return this[d]!==void 0?this[d]:this[d]=g.call(this)}}t.cachedProperty=s;function o(l){return typeof l=="string"?t.toArray(l,"hex"):l}t.parseBytes=o;function a(l){return new zt(l,"hex","le")}t.intFromLE=a}),YN=function(i){var e=new Uint8Array(i);return(yg.crypto||yg.msCrypto).getRandomValues(e),e},zA=Cs.getNAF,J6=Cs.getJSF,kA=Cs.assert;function rc(i,e){this.type=i,this.p=new zt(e.p,16),this.red=e.prime?zt.red(e.prime):zt.mont(this.p),this.zero=new zt(0).toRed(this.red),this.one=new zt(1).toRed(this.red),this.two=new zt(2).toRed(this.red),this.n=e.n&&new zt(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var t=this.n&&this.p.div(this.n);!t||t.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var wg=rc;rc.prototype.point=function(){throw new Error("Not implemented")};rc.prototype.validate=function(){throw new Error("Not implemented")};rc.prototype._fixedNafMul=function(e,t){kA(e.precomputed);var n=e._getDoubles(),r=zA(t,1,this._bitLength),s=(1<<n.step+1)-(n.step%2==0?2:1);s/=3;for(var o=[],a=0;a<r.length;a+=n.step){for(var l=0,t=a+n.step-1;t>=a;t--)l=(l<<1)+r[t];o.push(l)}for(var c=this.jpoint(null,null,null),g=this.jpoint(null,null,null),d=s;d>0;d--){for(var a=0;a<o.length;a++){var l=o[a];l===d?g=g.mixedAdd(n.points[a]):l===-d&&(g=g.mixedAdd(n.points[a].neg()))}c=c.add(g)}return c.toP()};rc.prototype._wnafMul=function(e,t){var n=4,r=e._getNAFPoints(n);n=r.wnd;for(var s=r.points,o=zA(t,n,this._bitLength),a=this.jpoint(null,null,null),l=o.length-1;l>=0;l--){for(var t=0;l>=0&&o[l]===0;l--)t++;if(l>=0&&t++,a=a.dblp(t),l<0)break;var c=o[l];kA(c!==0),e.type==="affine"?c>0?a=a.mixedAdd(s[c-1>>1]):a=a.mixedAdd(s[-c-1>>1].neg()):c>0?a=a.add(s[c-1>>1]):a=a.add(s[-c-1>>1].neg())}return e.type==="affine"?a.toP():a};rc.prototype._wnafMulAdd=function(e,t,n,r,s){for(var o=this._wnafT1,a=this._wnafT2,l=this._wnafT3,c=0,g=0;g<r;g++){var d=t[g],u=d._getNAFPoints(e);o[g]=u.wnd,a[g]=u.points}for(var g=r-1;g>=1;g-=2){var h=g-1,p=g;if(o[h]!==1||o[p]!==1){l[h]=zA(n[h],o[h],this._bitLength),l[p]=zA(n[p],o[p],this._bitLength),c=Math.max(l[h].length,c),c=Math.max(l[p].length,c);continue}var b=[t[h],null,null,t[p]];t[h].y.cmp(t[p].y)===0?(b[1]=t[h].add(t[p]),b[2]=t[h].toJ().mixedAdd(t[p].neg())):t[h].y.cmp(t[p].y.redNeg())===0?(b[1]=t[h].toJ().mixedAdd(t[p]),b[2]=t[h].add(t[p].neg())):(b[1]=t[h].toJ().mixedAdd(t[p]),b[2]=t[h].toJ().mixedAdd(t[p].neg()));var y=[-3,-1,-5,-7,0,7,5,1,3],m=J6(n[h],n[p]);c=Math.max(m[0].length,c),l[h]=new Array(c),l[p]=new Array(c);for(var f=0;f<c;f++){var G=m[0][f]|0,x=m[1][f]|0;l[h][f]=y[(G+1)*3+(x+1)],l[p][f]=0,a[h]=b}}for(var B=this.jpoint(null,null,null),M=this._wnafT4,g=c;g>=0;g--){for(var E=0;g>=0;){for(var z=!0,f=0;f<r;f++)M[f]=l[f][g]|0,M[f]!==0&&(z=!1);if(!z)break;E++,g--}if(g>=0&&E++,B=B.dblp(E),g<0)break;for(var f=0;f<r;f++){var J=M[f],d;J!==0&&(J>0?d=a[f][J-1>>1]:J<0&&(d=a[f][-J-1>>1].neg()),d.type==="affine"?B=B.mixedAdd(d):B=B.add(d))}}for(var g=0;g<r;g++)a[g]=null;return s?B:B.toP()};function Ks(i,e){this.curve=i,this.type=e,this.precomputed=null}rc.BasePoint=Ks;Ks.prototype.eq=function(){throw new Error("Not implemented")};Ks.prototype.validate=function(){return this.curve.validate(this)};rc.prototype.decodePoint=function(e,t){e=Cs.toArray(e,t);var n=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1==2*n){e[0]===6?kA(e[e.length-1]%2==0):e[0]===7&&kA(e[e.length-1]%2==1);var r=this.point(e.slice(1,1+n),e.slice(1+n,1+2*n));return r}else if((e[0]===2||e[0]===3)&&e.length-1===n)return this.pointFromX(e.slice(1,1+n),e[0]===3);throw new Error("Unknown point format")};Ks.prototype.encodeCompressed=function(e){return this.encode(e,!0)};Ks.prototype._encode=function(e){var t=this.curve.p.byteLength(),n=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(n):[4].concat(n,this.getY().toArray("be",t))};Ks.prototype.encode=function(e,t){return Cs.encode(this._encode(t),e)};Ks.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this};Ks.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return t?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1};Ks.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var n=[this],r=this,s=0;s<t;s+=e){for(var o=0;o<e;o++)r=r.dbl();n.push(r)}return{step:e,points:n}};Ks.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],n=(1<<e)-1,r=n===1?null:this.dbl(),s=1;s<n;s++)t[s]=t[s-1].add(r);return{wnd:e,points:t}};Ks.prototype._getBeta=function(){return null};Ks.prototype.dblp=function(e){for(var t=this,n=0;n<e;n++)t=t.dbl();return t};var Q6=Cs.assert;function Ps(i){wg.call(this,"short",i),this.a=new zt(i.a,16).toRed(this.red),this.b=new zt(i.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(i),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}FA(Ps,wg);var j6=Ps;Ps.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var t,n;if(e.beta)t=new zt(e.beta,16).toRed(this.red);else{var r=this._getEndoRoots(this.p);t=r[0].cmp(r[1])<0?r[0]:r[1],t=t.toRed(this.red)}if(e.lambda)n=new zt(e.lambda,16);else{var s=this._getEndoRoots(this.n);this.g.mul(s[0]).x.cmp(this.g.x.redMul(t))===0?n=s[0]:(n=s[1],Q6(this.g.mul(n).x.cmp(this.g.x.redMul(t))===0))}var o;return e.basis?o=e.basis.map(function(a){return{a:new zt(a.a,16),b:new zt(a.b,16)}}):o=this._getEndoBasis(n),{beta:t,lambda:n,basis:o}}};Ps.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:zt.mont(e),n=new zt(2).toRed(t).redInvm(),r=n.redNeg(),s=new zt(3).toRed(t).redNeg().redSqrt().redMul(n),o=r.redAdd(s).fromRed(),a=r.redSub(s).fromRed();return[o,a]};Ps.prototype._getEndoBasis=function(e){for(var t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=e,r=this.n.clone(),s=new zt(1),o=new zt(0),a=new zt(0),l=new zt(1),c,g,d,u,h,p,b,y=0,m,f;n.cmpn(0)!==0;){var G=r.div(n);m=r.sub(G.mul(n)),f=a.sub(G.mul(s));var x=l.sub(G.mul(o));if(!d&&m.cmp(t)<0)c=b.neg(),g=s,d=m.neg(),u=f;else if(d&&++y==2)break;b=m,r=n,n=m,a=s,s=f,l=o,o=x}h=m.neg(),p=f;var B=d.sqr().add(u.sqr()),M=h.sqr().add(p.sqr());return M.cmp(B)>=0&&(h=c,p=g),d.negative&&(d=d.neg(),u=u.neg()),h.negative&&(h=h.neg(),p=p.neg()),[{a:d,b:u},{a:h,b:p}]};Ps.prototype._endoSplit=function(e){var t=this.endo.basis,n=t[0],r=t[1],s=r.b.mul(e).divRound(this.n),o=n.b.neg().mul(e).divRound(this.n),a=s.mul(n.a),l=o.mul(r.a),c=s.mul(n.b),g=o.mul(r.b),d=e.sub(a).sub(l),u=c.add(g).neg();return{k1:d,k2:u}};Ps.prototype.pointFromX=function(e,t){e=new zt(e,16),e.red||(e=e.toRed(this.red));var n=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),r=n.redSqrt();if(r.redSqr().redSub(n).cmp(this.zero)!==0)throw new Error("invalid point");var s=r.fromRed().isOdd();return(t&&!s||!t&&s)&&(r=r.redNeg()),this.point(e,r)};Ps.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,n=e.y,r=this.a.redMul(t),s=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return n.redSqr().redISub(s).cmpn(0)===0};Ps.prototype._endoWnafMulAdd=function(e,t,n){for(var r=this._endoWnafT1,s=this._endoWnafT2,o=0;o<e.length;o++){var a=this._endoSplit(t[o]),l=e[o],c=l._getBeta();a.k1.negative&&(a.k1.ineg(),l=l.neg(!0)),a.k2.negative&&(a.k2.ineg(),c=c.neg(!0)),r[o*2]=l,r[o*2+1]=c,s[o*2]=a.k1,s[o*2+1]=a.k2}for(var g=this._wnafMulAdd(1,r,s,o*2,n),d=0;d<o*2;d++)r[d]=null,s[d]=null;return g};function Hi(i,e,t,n){wg.BasePoint.call(this,i,"affine"),e===null&&t===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new zt(e,16),this.y=new zt(t,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}FA(Hi,wg.BasePoint);Ps.prototype.point=function(e,t,n){return new Hi(this,e,t,n)};Ps.prototype.pointFromJSON=function(e,t){return Hi.fromJSON(this,e,t)};Hi.prototype._getBeta=function(){if(!!this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var n=this.curve,r=function(s){return n.point(s.x.redMul(n.endo.beta),s.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(r)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(r)}}}return t}};Hi.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Hi.fromJSON=function(e,t,n){typeof t=="string"&&(t=JSON.parse(t));var r=e.point(t[0],t[1],n);if(!t[2])return r;function s(a){return e.point(a[0],a[1],n)}var o=t[2];return r.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[r].concat(o.doubles.points.map(s))},naf:o.naf&&{wnd:o.naf.wnd,points:[r].concat(o.naf.points.map(s))}},r};Hi.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Hi.prototype.isInfinity=function(){return this.inf};Hi.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var t=this.y.redSub(e.y);t.cmpn(0)!==0&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var n=t.redSqr().redISub(this.x).redISub(e.x),r=t.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,r)};Hi.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var t=this.curve.a,n=this.x.redSqr(),r=e.redInvm(),s=n.redAdd(n).redIAdd(n).redIAdd(t).redMul(r),o=s.redSqr().redISub(this.x.redAdd(this.x)),a=s.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,a)};Hi.prototype.getX=function(){return this.x.fromRed()};Hi.prototype.getY=function(){return this.y.fromRed()};Hi.prototype.mul=function(e){return e=new zt(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)};Hi.prototype.mulAdd=function(e,t,n){var r=[this,t],s=[e,n];return this.curve.endo?this.curve._endoWnafMulAdd(r,s):this.curve._wnafMulAdd(1,r,s,2)};Hi.prototype.jmulAdd=function(e,t,n){var r=[this,t],s=[e,n];return this.curve.endo?this.curve._endoWnafMulAdd(r,s,!0):this.curve._wnafMulAdd(1,r,s,2,!0)};Hi.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)};Hi.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var n=this.precomputed,r=function(s){return s.neg()};t.precomputed={naf:n.naf&&{wnd:n.naf.wnd,points:n.naf.points.map(r)},doubles:n.doubles&&{step:n.doubles.step,points:n.doubles.points.map(r)}}}return t};Hi.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function qi(i,e,t,n){wg.BasePoint.call(this,i,"jacobian"),e===null&&t===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new zt(0)):(this.x=new zt(e,16),this.y=new zt(t,16),this.z=new zt(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}FA(qi,wg.BasePoint);Ps.prototype.jpoint=function(e,t,n){return new qi(this,e,t,n)};qi.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),n=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return this.curve.point(n,r)};qi.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};qi.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),n=this.z.redSqr(),r=this.x.redMul(t),s=e.x.redMul(n),o=this.y.redMul(t.redMul(e.z)),a=e.y.redMul(n.redMul(this.z)),l=r.redSub(s),c=o.redSub(a);if(l.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var g=l.redSqr(),d=g.redMul(l),u=r.redMul(g),h=c.redSqr().redIAdd(d).redISub(u).redISub(u),p=c.redMul(u.redISub(h)).redISub(o.redMul(d)),b=this.z.redMul(e.z).redMul(l);return this.curve.jpoint(h,p,b)};qi.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),n=this.x,r=e.x.redMul(t),s=this.y,o=e.y.redMul(t).redMul(this.z),a=n.redSub(r),l=s.redSub(o);if(a.cmpn(0)===0)return l.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var c=a.redSqr(),g=c.redMul(a),d=n.redMul(c),u=l.redSqr().redIAdd(g).redISub(d).redISub(d),h=l.redMul(d.redISub(u)).redISub(s.redMul(g)),p=this.z.redMul(a);return this.curve.jpoint(u,h,p)};qi.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,n=0;n<e;n++)t=t.dbl();return t}for(var r=this.curve.a,s=this.curve.tinv,o=this.x,a=this.y,l=this.z,c=l.redSqr().redSqr(),g=a.redAdd(a),n=0;n<e;n++){var d=o.redSqr(),u=g.redSqr(),h=u.redSqr(),p=d.redAdd(d).redIAdd(d).redIAdd(r.redMul(c)),b=o.redMul(u),y=p.redSqr().redISub(b.redAdd(b)),m=b.redISub(y),f=p.redMul(m);f=f.redIAdd(f).redISub(h);var G=g.redMul(l);n+1<e&&(c=c.redMul(h)),o=y,l=G,g=f}return this.curve.jpoint(o,g.redMul(s),l)};qi.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};qi.prototype._zeroDbl=function(){var e,t,n;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(o);a=a.redIAdd(a);var l=r.redAdd(r).redIAdd(r),c=l.redSqr().redISub(a).redISub(a),g=o.redIAdd(o);g=g.redIAdd(g),g=g.redIAdd(g),e=c,t=l.redMul(a.redISub(c)).redISub(g),n=this.y.redAdd(this.y)}else{var d=this.x.redSqr(),u=this.y.redSqr(),h=u.redSqr(),p=this.x.redAdd(u).redSqr().redISub(d).redISub(h);p=p.redIAdd(p);var b=d.redAdd(d).redIAdd(d),y=b.redSqr(),m=h.redIAdd(h);m=m.redIAdd(m),m=m.redIAdd(m),e=y.redISub(p).redISub(p),t=b.redMul(p.redISub(e)).redISub(m),n=this.y.redMul(this.z),n=n.redIAdd(n)}return this.curve.jpoint(e,t,n)};qi.prototype._threeDbl=function(){var e,t,n;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(o);a=a.redIAdd(a);var l=r.redAdd(r).redIAdd(r).redIAdd(this.curve.a),c=l.redSqr().redISub(a).redISub(a);e=c;var g=o.redIAdd(o);g=g.redIAdd(g),g=g.redIAdd(g),t=l.redMul(a.redISub(c)).redISub(g),n=this.y.redAdd(this.y)}else{var d=this.z.redSqr(),u=this.y.redSqr(),h=this.x.redMul(u),p=this.x.redSub(d).redMul(this.x.redAdd(d));p=p.redAdd(p).redIAdd(p);var b=h.redIAdd(h);b=b.redIAdd(b);var y=b.redAdd(b);e=p.redSqr().redISub(y),n=this.y.redAdd(this.z).redSqr().redISub(u).redISub(d);var m=u.redSqr();m=m.redIAdd(m),m=m.redIAdd(m),m=m.redIAdd(m),t=p.redMul(b.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,n)};qi.prototype._dbl=function(){var e=this.curve.a,t=this.x,n=this.y,r=this.z,s=r.redSqr().redSqr(),o=t.redSqr(),a=n.redSqr(),l=o.redAdd(o).redIAdd(o).redIAdd(e.redMul(s)),c=t.redAdd(t);c=c.redIAdd(c);var g=c.redMul(a),d=l.redSqr().redISub(g.redAdd(g)),u=g.redISub(d),h=a.redSqr();h=h.redIAdd(h),h=h.redIAdd(h),h=h.redIAdd(h);var p=l.redMul(u).redISub(h),b=n.redAdd(n).redMul(r);return this.curve.jpoint(d,p,b)};qi.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),n=this.z.redSqr(),r=t.redSqr(),s=e.redAdd(e).redIAdd(e),o=s.redSqr(),a=this.x.redAdd(t).redSqr().redISub(e).redISub(r);a=a.redIAdd(a),a=a.redAdd(a).redIAdd(a),a=a.redISub(o);var l=a.redSqr(),c=r.redIAdd(r);c=c.redIAdd(c),c=c.redIAdd(c),c=c.redIAdd(c);var g=s.redIAdd(a).redSqr().redISub(o).redISub(l).redISub(c),d=t.redMul(g);d=d.redIAdd(d),d=d.redIAdd(d);var u=this.x.redMul(l).redISub(d);u=u.redIAdd(u),u=u.redIAdd(u);var h=this.y.redMul(g.redMul(c.redISub(g)).redISub(a.redMul(l)));h=h.redIAdd(h),h=h.redIAdd(h),h=h.redIAdd(h);var p=this.z.redAdd(a).redSqr().redISub(n).redISub(l);return this.curve.jpoint(u,h,p)};qi.prototype.mul=function(e,t){return e=new zt(e,t),this.curve._wnafMul(this,e)};qi.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),n=e.z.redSqr();if(this.x.redMul(n).redISub(e.x.redMul(t)).cmpn(0)!==0)return!1;var r=t.redMul(this.z),s=n.redMul(e.z);return this.y.redMul(s).redISub(e.y.redMul(r)).cmpn(0)===0};qi.prototype.eqXToP=function(e){var t=this.z.redSqr(),n=e.toRed(this.curve.red).redMul(t);if(this.x.cmp(n)===0)return!0;for(var r=e.clone(),s=this.curve.redN.redMul(t);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(s),this.x.cmp(n)===0)return!0}};qi.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};qi.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var q6={},$6={},YA=Vr(function(i,e){var t=e;t.base=wg,t.short=j6,t.mont=q6,t.edwards=$6}),eQ=void 0,KA=Vr(function(i,e){var t=e,n=Cs.assert;function r(a){a.type==="short"?this.curve=new YA.short(a):a.type==="edwards"?this.curve=new YA.edwards(a):this.curve=new YA.mont(a),this.g=this.curve.g,this.n=this.curve.n,this.hash=a.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}t.PresetCurve=r;function s(a,l){Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:function(){var c=new r(l);return Object.defineProperty(t,a,{configurable:!0,enumerable:!0,value:c}),c}})}s("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:ts.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),s("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:ts.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),s("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:ts.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),s("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:ts.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),s("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:ts.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),s("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:ts.sha256,gRed:!1,g:["9"]}),s("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:ts.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var o;try{o=eQ}catch{o=void 0}s("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:ts.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",o]})});function sc(i){if(!(this instanceof sc))return new sc(i);this.hash=i.hash,this.predResist=!!i.predResist,this.outLen=this.hash.outSize,this.minEntropy=i.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=Io.toArray(i.entropy,i.entropyEnc||"hex"),t=Io.toArray(i.nonce,i.nonceEnc||"hex"),n=Io.toArray(i.pers,i.persEnc||"hex");nc(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,t,n)}var KN=sc;sc.prototype._init=function(e,t,n){var r=e.concat(t).concat(n);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(r),this._reseed=1,this.reseedInterval=281474976710656};sc.prototype._hmac=function(){return new ts.hmac(this.hash,this.K)};sc.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),!!e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())};sc.prototype.reseed=function(e,t,n,r){typeof t!="string"&&(r=n,n=t,t=null),e=Io.toArray(e,t),n=Io.toArray(n,r),nc(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(n||[])),this._reseed=1};sc.prototype.generate=function(e,t,n,r){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof t!="string"&&(r=n,n=t,t=null),n&&(n=Io.toArray(n,r||"hex"),this._update(n));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,e);return this._update(n),this._reseed++,Io.encode(o,t)};var PN=Cs.assert;function fr(i,e){this.ec=i,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}var w1=fr;fr.fromPublic=function(e,t,n){return t instanceof fr?t:new fr(e,{pub:t,pubEnc:n})};fr.fromPrivate=function(e,t,n){return t instanceof fr?t:new fr(e,{priv:t,privEnc:n})};fr.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};fr.prototype.getPublic=function(e,t){return typeof e=="string"&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub};fr.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv};fr.prototype._importPrivate=function(e,t){this.priv=new zt(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)};fr.prototype._importPublic=function(e,t){if(e.x||e.y){this.ec.curve.type==="mont"?PN(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&PN(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,t)};fr.prototype.derive=function(e){return e.mul(this.priv).getX()};fr.prototype.sign=function(e,t,n){return this.ec.sign(e,this,t,n)};fr.prototype.verify=function(e,t){return this.ec.verify(e,t,this)};fr.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var tQ=Cs.assert;function PA(i,e){if(i instanceof PA)return i;this._importDER(i,e)||(tQ(i.r&&i.s,"Signature without r or s"),this.r=new zt(i.r,16),this.s=new zt(i.s,16),i.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=i.recoveryParam)}var DA=PA;function nQ(){this.place=0}function G1(i,e){var t=i[e.place++];if(!(t&128))return t;for(var n=t&15,r=0,s=0,o=e.place;s<n;s++,o++)r<<=8,r|=i[o];return e.place=o,r}function DN(i){for(var e=0,t=i.length-1;!i[e]&&!(i[e+1]&128)&&e<t;)e++;return e===0?i:i.slice(e)}PA.prototype._importDER=function(e,t){e=Cs.toArray(e,t);var n=new nQ;if(e[n.place++]!==48)return!1;var r=G1(e,n);if(r+n.place!==e.length||e[n.place++]!==2)return!1;var s=G1(e,n),o=e.slice(n.place,s+n.place);if(n.place+=s,e[n.place++]!==2)return!1;var a=G1(e,n);if(e.length!==a+n.place)return!1;var l=e.slice(n.place,a+n.place);return o[0]===0&&o[1]&128&&(o=o.slice(1)),l[0]===0&&l[1]&128&&(l=l.slice(1)),this.r=new zt(o),this.s=new zt(l),this.recoveryParam=null,!0};function B1(i,e){if(e<128){i.push(e);return}var t=1+(Math.log(e)/Math.LN2>>>3);for(i.push(t|128);--t;)i.push(e>>>(t<<3)&255);i.push(e)}PA.prototype.toDER=function(e){var t=this.r.toArray(),n=this.s.toArray();for(t[0]&128&&(t=[0].concat(t)),n[0]&128&&(n=[0].concat(n)),t=DN(t),n=DN(n);!n[0]&&!(n[1]&128);)n=n.slice(1);var r=[2];B1(r,t.length),r=r.concat(t),r.push(2),B1(r,n.length);var s=r.concat(n),o=[48];return B1(o,s.length),o=o.concat(s),Cs.encode(o,e)};var UN=Cs.assert;function Ds(i){if(!(this instanceof Ds))return new Ds(i);typeof i=="string"&&(UN(KA.hasOwnProperty(i),"Unknown curve "+i),i=KA[i]),i instanceof KA.PresetCurve&&(i={curve:i}),this.curve=i.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=i.curve.g,this.g.precompute(i.curve.n.bitLength()+1),this.hash=i.hash||i.curve.hash}var iQ=Ds;Ds.prototype.keyPair=function(e){return new w1(this,e)};Ds.prototype.keyFromPrivate=function(e,t){return w1.fromPrivate(this,e,t)};Ds.prototype.keyFromPublic=function(e,t){return w1.fromPublic(this,e,t)};Ds.prototype.genKeyPair=function(e){e||(e={});var t=new KN({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||YN(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),n=this.n.byteLength(),r=this.n.sub(new zt(2));do{var s=new zt(t.generate(n));if(!(s.cmp(r)>0))return s.iaddn(1),this.keyFromPrivate(s)}while(!0)};Ds.prototype._truncateToN=function(e,t){var n=e.byteLength()*8-this.n.bitLength();return n>0&&(e=e.ushrn(n)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e};Ds.prototype.sign=function(e,t,n,r){typeof n=="object"&&(r=n,n=null),r||(r={}),t=this.keyFromPrivate(t,n),e=this._truncateToN(new zt(e,16));for(var s=this.n.byteLength(),o=t.getPrivate().toArray("be",s),a=e.toArray("be",s),l=new KN({hash:this.hash,entropy:o,nonce:a,pers:r.pers,persEnc:r.persEnc||"utf8"}),c=this.n.sub(new zt(1)),g=0;;g++){var d=r.k?r.k(g):new zt(l.generate(this.n.byteLength()));if(d=this._truncateToN(d,!0),!(d.cmpn(1)<=0||d.cmp(c)>=0)){var u=this.g.mul(d);if(!u.isInfinity()){var h=u.getX(),p=h.umod(this.n);if(p.cmpn(0)!==0){var b=d.invm(this.n).mul(p.mul(t.getPrivate()).iadd(e));if(b=b.umod(this.n),b.cmpn(0)!==0){var y=(u.getY().isOdd()?1:0)|(h.cmp(p)!==0?2:0);return r.canonical&&b.cmp(this.nh)>0&&(b=this.n.sub(b),y^=1),new DA({r:p,s:b,recoveryParam:y})}}}}}};Ds.prototype.verify=function(e,t,n,r){e=this._truncateToN(new zt(e,16)),n=this.keyFromPublic(n,r),t=new DA(t,"hex");var s=t.r,o=t.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0||o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a=o.invm(this.n),l=a.mul(e).umod(this.n),c=a.mul(s).umod(this.n);if(!this.curve._maxwellTrick){var g=this.g.mulAdd(l,n.getPublic(),c);return g.isInfinity()?!1:g.getX().umod(this.n).cmp(s)===0}var g=this.g.jmulAdd(l,n.getPublic(),c);return g.isInfinity()?!1:g.eqXToP(s)};Ds.prototype.recoverPubKey=function(i,e,t,n){UN((3&t)===t,"The recovery param is more than two bits"),e=new DA(e,n);var r=this.n,s=new zt(i),o=e.r,a=e.s,l=t&1,c=t>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&c)throw new Error("Unable to find sencond key candinate");c?o=this.curve.pointFromX(o.add(this.curve.n),l):o=this.curve.pointFromX(o,l);var g=e.r.invm(r),d=r.sub(s).mul(g).umod(r),u=a.mul(g).umod(r);return this.g.mulAdd(d,o,u)};Ds.prototype.getKeyRecoveryParam=function(i,e,t,n){if(e=new DA(e,n),e.recoveryParam!==null)return e.recoveryParam;for(var r=0;r<4;r++){var s;try{s=this.recoverPubKey(i,e,r)}catch{continue}if(s.eq(t))return r}throw new Error("Unable to find valid recovery factor")};var rQ={},sQ=W9(O6),oQ=Vr(function(i,e){var t=e;t.version=sQ.version,t.utils=Cs,t.rand=YN,t.curve=YA,t.curves=KA,t.ec=iQ,t.eddsa=rQ}),aQ=oQ.ec;const lQ="signing-key/5.0.0-beta.136",cQ=new We(lQ);let S1=null;function ta(){return S1||(S1=new aQ("secp256k1")),S1}class Gg{constructor(e){ke(this,"curve","secp256k1"),ke(this,"privateKey",at(e));const t=ta().keyFromPrivate(tt(this.privateKey));ke(this,"publicKey","0x"+t.getPublic(!1,"hex")),ke(this,"compressedPublicKey","0x"+t.getPublic(!0,"hex")),ke(this,"_isSigningKey",!0)}_addPoint(e){const t=ta().keyFromPublic(tt(this.publicKey)),n=ta().keyFromPublic(tt(e));return"0x"+t.pub.add(n.pub).encodeCompressed("hex")}signDigest(e){const n=ta().keyFromPrivate(tt(this.privateKey)).sign(tt(e),{canonical:!0});return Sd({recoveryParam:n.recoveryParam,r:Ji("0x"+n.r.toString(16),32),s:Ji("0x"+n.s.toString(16),32)})}computeSharedSecret(e){const t=ta().keyFromPrivate(tt(this.privateKey)),n=ta().keyFromPublic(tt(Z1(e)));return Ji("0x"+t.derive(n.getPublic()).toString(16),32)}static isSigningKey(e){return!!(e&&e._isSigningKey)}}function ON(i,e){const t=Sd(e),n={r:tt(t.r),s:tt(t.s)};return"0x"+ta().recoverPubKey(tt(i),n,t.recoveryParam).encode("hex",!1)}function Z1(i,e){const t=tt(i);if(t.length===32){const n=new Gg(t);return e?"0x"+ta().keyFromPrivate(t).getPublic(!0,"hex"):n.publicKey}else{if(t.length===33)return e?at(t):"0x"+ta().keyFromPublic(t).getPublic(!1,"hex");if(t.length===65)return e?"0x"+ta().keyFromPublic(t).getPublic(!0,"hex"):at(t)}return cQ.throwArgumentError("invalid public or private key","key","[REDACTED]")}const gQ="transactions/5.0.0-beta.136",Hd=new We(gQ);function uQ(i){return i==="0x"?null:Dn(i)}function UA(i){return i==="0x"?l1:ft.from(i)}const dQ=[{name:"nonce",maxLength:32,numeric:!0},{name:"gasPrice",maxLength:32,numeric:!0},{name:"gasLimit",maxLength:32,numeric:!0},{name:"to",length:20},{name:"value",maxLength:32,numeric:!0},{name:"data"}],hQ={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0};function oc(i){const e=Z1(i);return Dn(go(Gi(go(e,1)),12))}function R1(i,e){return oc(ON(tt(i),e))}function M1(i,e){i1(i,hQ);const t=[];dQ.forEach(function(o){let a=i[o.name]||[];const l={};o.numeric&&(l.hexPad="left"),a=tt(at(a,l)),o.length&&a.length!==o.length&&a.length>0&&Hd.throwArgumentError("invalid length for "+o.name,"transaction:"+o.name,a),o.maxLength&&(a=wd(a),a.length>o.maxLength&&Hd.throwArgumentError("invalid length for "+o.name,"transaction:"+o.name,a)),t.push(at(a))});let n=0;if(i.chainId!=null?(n=i.chainId,typeof n!="number"&&Hd.throwArgumentError("invalid transaction.chainId","transaction",i)):e&&!sC(e)&&e.v>28&&(n=Math.floor((e.v-35)/2)),n!==0&&(t.push(at(n)),t.push("0x"),t.push("0x")),!e)return gC(t);const r=Sd(e);let s=27+r.recoveryParam;return n!==0?(t.pop(),t.pop(),t.pop(),s+=n*2+8,r.v>28&&r.v!==s&&Hd.throwArgumentError("transaction.chainId/signature.v mismatch","signature",e)):r.v!==s&&Hd.throwArgumentError("transaction.chainId/signature.v mismatch","signature",e),t.push(at(s)),t.push(wd(tt(r.r))),t.push(wd(tt(r.s))),gC(t)}function JN(i){const e=$9(i);e.length!==9&&e.length!==6&&Hd.throwArgumentError("invalid raw transaction","rawTransaction",i);const t={nonce:UA(e[0]).toNumber(),gasPrice:UA(e[1]),gasLimit:UA(e[2]),to:uQ(e[3]),value:UA(e[4]),data:e[5],chainId:0};if(e.length===6)return t;try{t.v=ft.from(e[6]).toNumber()}catch(n){return console.log(n),t}if(t.r=Ji(e[7],32),t.s=Ji(e[8],32),ft.from(t.r).isZero()&&ft.from(t.s).isZero())t.chainId=t.v,t.v=0;else{t.chainId=Math.floor((t.v-35)/2),t.chainId<0&&(t.chainId=0);let n=t.v-27;const r=e.slice(0,6);t.chainId!==0&&(r.push(at(t.chainId)),r.push("0x"),r.push("0x"),n-=t.chainId*2+8);const s=Gi(gC(r));try{t.from=R1(s,{r:at(t.r),s:at(t.s),recoveryParam:n})}catch(o){console.log(o)}t.hash=Gi(i)}return t}const fQ="wordlists/5.0.0-beta.137",IQ=new We(fQ);class Fd{constructor(e){IQ.checkAbstract(new.target,Fd),ke(this,"locale",e)}split(e){return e.toLowerCase().split(/ +/g)}join(e){return e.join(" ")}static check(e){const t=[];for(let n=0;n<2048;n++){const r=e.getWord(n);if(n!==e.getWordIndex(r))return"0x";t.push(r)}return _d(t.join(`
`)+`
`)}static register(e,t){}}const CQ="AbandonAbilityAbleAboutAboveAbsentAbsorbAbstractAbsurdAbuseAccessAccidentAccountAccuseAchieveAcidAcousticAcquireAcrossActActionActorActressActualAdaptAddAddictAddressAdjustAdmitAdultAdvanceAdviceAerobicAffairAffordAfraidAgainAgeAgentAgreeAheadAimAirAirportAisleAlarmAlbumAlcoholAlertAlienAllAlleyAllowAlmostAloneAlphaAlreadyAlsoAlterAlwaysAmateurAmazingAmongAmountAmusedAnalystAnchorAncientAngerAngleAngryAnimalAnkleAnnounceAnnualAnotherAnswerAntennaAntiqueAnxietyAnyApartApologyAppearAppleApproveAprilArchArcticAreaArenaArgueArmArmedArmorArmyAroundArrangeArrestArriveArrowArtArtefactArtistArtworkAskAspectAssaultAssetAssistAssumeAsthmaAthleteAtomAttackAttendAttitudeAttractAuctionAuditAugustAuntAuthorAutoAutumnAverageAvocadoAvoidAwakeAwareAwayAwesomeAwfulAwkwardAxisBabyBachelorBaconBadgeBagBalanceBalconyBallBambooBananaBannerBarBarelyBargainBarrelBaseBasicBasketBattleBeachBeanBeautyBecauseBecomeBeefBeforeBeginBehaveBehindBelieveBelowBeltBenchBenefitBestBetrayBetterBetweenBeyondBicycleBidBikeBindBiologyBirdBirthBitterBlackBladeBlameBlanketBlastBleakBlessBlindBloodBlossomBlouseBlueBlurBlushBoardBoatBodyBoilBombBoneBonusBookBoostBorderBoringBorrowBossBottomBounceBoxBoyBracketBrainBrandBrassBraveBreadBreezeBrickBridgeBriefBrightBringBriskBroccoliBrokenBronzeBroomBrotherBrownBrushBubbleBuddyBudgetBuffaloBuildBulbBulkBulletBundleBunkerBurdenBurgerBurstBusBusinessBusyButterBuyerBuzzCabbageCabinCableCactusCageCakeCallCalmCameraCampCanCanalCancelCandyCannonCanoeCanvasCanyonCapableCapitalCaptainCarCarbonCardCargoCarpetCarryCartCaseCashCasinoCastleCasualCatCatalogCatchCategoryCattleCaughtCauseCautionCaveCeilingCeleryCementCensusCenturyCerealCertainChairChalkChampionChangeChaosChapterChargeChaseChatCheapCheckCheeseChefCherryChestChickenChiefChildChimneyChoiceChooseChronicChuckleChunkChurnCigarCinnamonCircleCitizenCityCivilClaimClapClarifyClawClayCleanClerkCleverClickClientCliffClimbClinicClipClockClogCloseClothCloudClownClubClumpClusterClutchCoachCoastCoconutCodeCoffeeCoilCoinCollectColorColumnCombineComeComfortComicCommonCompanyConcertConductConfirmCongressConnectConsiderControlConvinceCookCoolCopperCopyCoralCoreCornCorrectCostCottonCouchCountryCoupleCourseCousinCoverCoyoteCrackCradleCraftCramCraneCrashCraterCrawlCrazyCreamCreditCreekCrewCricketCrimeCrispCriticCropCrossCrouchCrowdCrucialCruelCruiseCrumbleCrunchCrushCryCrystalCubeCultureCupCupboardCuriousCurrentCurtainCurveCushionCustomCuteCycleDadDamageDampDanceDangerDaringDashDaughterDawnDayDealDebateDebrisDecadeDecemberDecideDeclineDecorateDecreaseDeerDefenseDefineDefyDegreeDelayDeliverDemandDemiseDenialDentistDenyDepartDependDepositDepthDeputyDeriveDescribeDesertDesignDeskDespairDestroyDetailDetectDevelopDeviceDevoteDiagramDialDiamondDiaryDiceDieselDietDifferDigitalDignityDilemmaDinnerDinosaurDirectDirtDisagreeDiscoverDiseaseDishDismissDisorderDisplayDistanceDivertDivideDivorceDizzyDoctorDocumentDogDollDolphinDomainDonateDonkeyDonorDoorDoseDoubleDoveDraftDragonDramaDrasticDrawDreamDressDriftDrillDrinkDripDriveDropDrumDryDuckDumbDuneDuringDustDutchDutyDwarfDynamicEagerEagleEarlyEarnEarthEasilyEastEasyEchoEcologyEconomyEdgeEditEducateEffortEggEightEitherElbowElderElectricElegantElementElephantElevatorEliteElseEmbarkEmbodyEmbraceEmergeEmotionEmployEmpowerEmptyEnableEnactEndEndlessEndorseEnemyEnergyEnforceEngageEngineEnhanceEnjoyEnlistEnoughEnrichEnrollEnsureEnterEntireEntryEnvelopeEpisodeEqualEquipEraEraseErodeErosionErrorEruptEscapeEssayEssenceEstateEternalEthicsEvidenceEvilEvokeEvolveExactExampleExcessExchangeExciteExcludeExcuseExecuteExerciseExhaustExhibitExileExistExitExoticExpandExpectExpireExplainExposeExpressExtendExtraEyeEyebrowFabricFaceFacultyFadeFaintFaithFallFalseFameFamilyFamousFanFancyFantasyFarmFashionFatFatalFatherFatigueFaultFavoriteFeatureFebruaryFederalFeeFeedFeelFemaleFenceFestivalFetchFeverFewFiberFictionFieldFigureFileFilmFilterFinalFindFineFingerFinishFireFirmFirstFiscalFishFitFitnessFixFlagFlameFlashFlatFlavorFleeFlightFlipFloatFlockFloorFlowerFluidFlushFlyFoamFocusFogFoilFoldFollowFoodFootForceForestForgetForkFortuneForumForwardFossilFosterFoundFoxFragileFrameFrequentFreshFriendFringeFrogFrontFrostFrownFrozenFruitFuelFunFunnyFurnaceFuryFutureGadgetGainGalaxyGalleryGameGapGarageGarbageGardenGarlicGarmentGasGaspGateGatherGaugeGazeGeneralGeniusGenreGentleGenuineGestureGhostGiantGiftGiggleGingerGiraffeGirlGiveGladGlanceGlareGlassGlideGlimpseGlobeGloomGloryGloveGlowGlueGoatGoddessGoldGoodGooseGorillaGospelGossipGovernGownGrabGraceGrainGrantGrapeGrassGravityGreatGreenGridGriefGritGroceryGroupGrowGruntGuardGuessGuideGuiltGuitarGunGymHabitHairHalfHammerHamsterHandHappyHarborHardHarshHarvestHatHaveHawkHazardHeadHealthHeartHeavyHedgehogHeightHelloHelmetHelpHenHeroHiddenHighHillHintHipHireHistoryHobbyHockeyHoldHoleHolidayHollowHomeHoneyHoodHopeHornHorrorHorseHospitalHostHotelHourHoverHubHugeHumanHumbleHumorHundredHungryHuntHurdleHurryHurtHusbandHybridIceIconIdeaIdentifyIdleIgnoreIllIllegalIllnessImageImitateImmenseImmuneImpactImposeImproveImpulseInchIncludeIncomeIncreaseIndexIndicateIndoorIndustryInfantInflictInformInhaleInheritInitialInjectInjuryInmateInnerInnocentInputInquiryInsaneInsectInsideInspireInstallIntactInterestIntoInvestInviteInvolveIronIslandIsolateIssueItemIvoryJacketJaguarJarJazzJealousJeansJellyJewelJobJoinJokeJourneyJoyJudgeJuiceJumpJungleJuniorJunkJustKangarooKeenKeepKetchupKeyKickKidKidneyKindKingdomKissKitKitchenKiteKittenKiwiKneeKnifeKnockKnowLabLabelLaborLadderLadyLakeLampLanguageLaptopLargeLaterLatinLaughLaundryLavaLawLawnLawsuitLayerLazyLeaderLeafLearnLeaveLectureLeftLegLegalLegendLeisureLemonLendLengthLensLeopardLessonLetterLevelLiarLibertyLibraryLicenseLifeLiftLightLikeLimbLimitLinkLionLiquidListLittleLiveLizardLoadLoanLobsterLocalLockLogicLonelyLongLoopLotteryLoudLoungeLoveLoyalLuckyLuggageLumberLunarLunchLuxuryLyricsMachineMadMagicMagnetMaidMailMainMajorMakeMammalManManageMandateMangoMansionManualMapleMarbleMarchMarginMarineMarketMarriageMaskMassMasterMatchMaterialMathMatrixMatterMaximumMazeMeadowMeanMeasureMeatMechanicMedalMediaMelodyMeltMemberMemoryMentionMenuMercyMergeMeritMerryMeshMessageMetalMethodMiddleMidnightMilkMillionMimicMindMinimumMinorMinuteMiracleMirrorMiseryMissMistakeMixMixedMixtureMobileModelModifyMomMomentMonitorMonkeyMonsterMonthMoonMoralMoreMorningMosquitoMotherMotionMotorMountainMouseMoveMovieMuchMuffinMuleMultiplyMuscleMuseumMushroomMusicMustMutualMyselfMysteryMythNaiveNameNapkinNarrowNastyNationNatureNearNeckNeedNegativeNeglectNeitherNephewNerveNestNetNetworkNeutralNeverNewsNextNiceNightNobleNoiseNomineeNoodleNormalNorthNoseNotableNoteNothingNoticeNovelNowNuclearNumberNurseNutOakObeyObjectObligeObscureObserveObtainObviousOccurOceanOctoberOdorOffOfferOfficeOftenOilOkayOldOliveOlympicOmitOnceOneOnionOnlineOnlyOpenOperaOpinionOpposeOptionOrangeOrbitOrchardOrderOrdinaryOrganOrientOriginalOrphanOstrichOtherOutdoorOuterOutputOutsideOvalOvenOverOwnOwnerOxygenOysterOzonePactPaddlePagePairPalacePalmPandaPanelPanicPantherPaperParadeParentParkParrotPartyPassPatchPathPatientPatrolPatternPausePavePaymentPeacePeanutPearPeasantPelicanPenPenaltyPencilPeoplePepperPerfectPermitPersonPetPhonePhotoPhrasePhysicalPianoPicnicPicturePiecePigPigeonPillPilotPinkPioneerPipePistolPitchPizzaPlacePlanetPlasticPlatePlayPleasePledgePluckPlugPlungePoemPoetPointPolarPolePolicePondPonyPoolPopularPortionPositionPossiblePostPotatoPotteryPovertyPowderPowerPracticePraisePredictPreferPreparePresentPrettyPreventPricePridePrimaryPrintPriorityPrisonPrivatePrizeProblemProcessProduceProfitProgramProjectPromoteProofPropertyProsperProtectProudProvidePublicPuddingPullPulpPulsePumpkinPunchPupilPuppyPurchasePurityPurposePursePushPutPuzzlePyramidQualityQuantumQuarterQuestionQuickQuitQuizQuoteRabbitRaccoonRaceRackRadarRadioRailRainRaiseRallyRampRanchRandomRangeRapidRareRateRatherRavenRawRazorReadyRealReasonRebelRebuildRecallReceiveRecipeRecordRecycleReduceReflectReformRefuseRegionRegretRegularRejectRelaxReleaseReliefRelyRemainRememberRemindRemoveRenderRenewRentReopenRepairRepeatReplaceReportRequireRescueResembleResistResourceResponseResultRetireRetreatReturnReunionRevealReviewRewardRhythmRibRibbonRiceRichRideRidgeRifleRightRigidRingRiotRippleRiskRitualRivalRiverRoadRoastRobotRobustRocketRomanceRoofRookieRoomRoseRotateRoughRoundRouteRoyalRubberRudeRugRuleRunRunwayRuralSadSaddleSadnessSafeSailSaladSalmonSalonSaltSaluteSameSampleSandSatisfySatoshiSauceSausageSaveSayScaleScanScareScatterSceneSchemeSchoolScienceScissorsScorpionScoutScrapScreenScriptScrubSeaSearchSeasonSeatSecondSecretSectionSecuritySeedSeekSegmentSelectSellSeminarSeniorSenseSentenceSeriesServiceSessionSettleSetupSevenShadowShaftShallowShareShedShellSheriffShieldShiftShineShipShiverShockShoeShootShopShortShoulderShoveShrimpShrugShuffleShySiblingSickSideSiegeSightSignSilentSilkSillySilverSimilarSimpleSinceSingSirenSisterSituateSixSizeSkateSketchSkiSkillSkinSkirtSkullSlabSlamSleepSlenderSliceSlideSlightSlimSloganSlotSlowSlushSmallSmartSmileSmokeSmoothSnackSnakeSnapSniffSnowSoapSoccerSocialSockSodaSoftSolarSoldierSolidSolutionSolveSomeoneSongSoonSorrySortSoulSoundSoupSourceSouthSpaceSpareSpatialSpawnSpeakSpecialSpeedSpellSpendSphereSpiceSpiderSpikeSpinSpiritSplitSpoilSponsorSpoonSportSpotSpraySpreadSpringSpySquareSqueezeSquirrelStableStadiumStaffStageStairsStampStandStartStateStaySteakSteelStemStepStereoStickStillStingStockStomachStoneStoolStoryStoveStrategyStreetStrikeStrongStruggleStudentStuffStumbleStyleSubjectSubmitSubwaySuccessSuchSuddenSufferSugarSuggestSuitSummerSunSunnySunsetSuperSupplySupremeSureSurfaceSurgeSurpriseSurroundSurveySuspectSustainSwallowSwampSwapSwarmSwearSweetSwiftSwimSwingSwitchSwordSymbolSymptomSyrupSystemTableTackleTagTailTalentTalkTankTapeTargetTaskTasteTattooTaxiTeachTeamTellTenTenantTennisTentTermTestTextThankThatThemeThenTheoryThereTheyThingThisThoughtThreeThriveThrowThumbThunderTicketTideTigerTiltTimberTimeTinyTipTiredTissueTitleToastTobaccoTodayToddlerToeTogetherToiletTokenTomatoTomorrowToneTongueTonightToolToothTopTopicToppleTorchTornadoTortoiseTossTotalTouristTowardTowerTownToyTrackTradeTrafficTragicTrainTransferTrapTrashTravelTrayTreatTreeTrendTrialTribeTrickTriggerTrimTripTrophyTroubleTruckTrueTrulyTrumpetTrustTruthTryTubeTuitionTumbleTunaTunnelTurkeyTurnTurtleTwelveTwentyTwiceTwinTwistTwoTypeTypicalUglyUmbrellaUnableUnawareUncleUncoverUnderUndoUnfairUnfoldUnhappyUniformUniqueUnitUniverseUnknownUnlockUntilUnusualUnveilUpdateUpgradeUpholdUponUpperUpsetUrbanUrgeUsageUseUsedUsefulUselessUsualUtilityVacantVacuumVagueValidValleyValveVanVanishVaporVariousVastVaultVehicleVelvetVendorVentureVenueVerbVerifyVersionVeryVesselVeteranViableVibrantViciousVictoryVideoViewVillageVintageViolinVirtualVirusVisaVisitVisualVitalVividVocalVoiceVoidVolcanoVolumeVoteVoyageWageWagonWaitWalkWallWalnutWantWarfareWarmWarriorWashWaspWasteWaterWaveWayWealthWeaponWearWeaselWeatherWebWeddingWeekendWeirdWelcomeWestWetWhaleWhatWheatWheelWhenWhereWhipWhisperWideWidthWifeWildWillWinWindowWineWingWinkWinnerWinterWireWisdomWiseWishWitnessWolfWomanWonderWoodWoolWordWorkWorldWorryWorthWrapWreckWrestleWristWriteWrongYardYearYellowYouYoungYouthZebraZeroZoneZoo";let bC=null;function QN(i){if(bC==null&&(bC=CQ.replace(/([A-Z])/g," $1").toLowerCase().substring(1).split(" "),Fd.check(i)!=="0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60"))throw bC=null,new Error("BIP39 Wordlist for en (English) FAILED")}class pQ extends Fd{constructor(){super("en")}getWord(e){return QN(this),bC[e]}getWordIndex(e){return QN(this),bC.indexOf(e)}}const jN=new pQ;Fd.register(jN);const W1={en:jN},mQ="hdnode/5.0.0-beta.140",yC=new We(mQ),AQ=ft.from("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),bQ=ji("Bitcoin seed"),vC=2147483648;function qN(i){return(1<<i)-1<<8-i}function yQ(i){return(1<<i)-1}function OA(i){return Ji(at(i),32)}function $N(i){return GN.encode(li([i,go(xg(xg(i)),0,4)]))}function _1(i){if(i==null)return W1.en;if(typeof i=="string"){const e=W1[i];return e==null&&yC.throwArgumentError("unknown locale","wordlist",i),e}return i}const Ld={},Td="m/44'/60'/0'/0/0";class ns{constructor(e,t,n,r,s,o,a,l){if(yC.checkNew(new.target,ns),e!==Ld)throw new Error("HDNode constructor cannot be called directly");if(t){const c=new Gg(t);ke(this,"privateKey",c.privateKey),ke(this,"publicKey",c.compressedPublicKey)}else ke(this,"privateKey",null),ke(this,"publicKey",at(n));ke(this,"parentFingerprint",r),ke(this,"fingerprint",go(zN(xg(this.publicKey)),0,4)),ke(this,"address",oc(this.publicKey)),ke(this,"chainCode",s),ke(this,"index",o),ke(this,"depth",a),l==null?(ke(this,"mnemonic",null),ke(this,"path",null)):typeof l=="string"?(ke(this,"mnemonic",null),ke(this,"path",l)):(ke(this,"mnemonic",l),ke(this,"path",l.path))}get extendedKey(){if(this.depth>=256)throw new Error("Depth too large!");return $N(li([this.privateKey!=null?"0x0488ADE4":"0x0488B21E",at(this.depth),this.parentFingerprint,Ji(at(this.index),4),this.chainCode,this.privateKey!=null?li(["0x00",this.privateKey]):this.publicKey]))}neuter(){return new ns(Ld,null,this.publicKey,this.parentFingerprint,this.chainCode,this.index,this.depth,this.path)}_derive(e){if(e>4294967295)throw new Error("invalid index - "+String(e));let t=this.path;t&&(t+="/"+(e&~vC));const n=new Uint8Array(37);if(e&vC){if(!this.privateKey)throw new Error("cannot derive child of neutered node");n.set(tt(this.privateKey),1),t&&(t+="'")}else n.set(tt(this.publicKey));for(let d=24;d>=0;d-=8)n[33+(d>>3)]=e>>24-d&255;const r=tt(AC(v1.sha512,this.chainCode,n)),s=r.slice(0,32),o=r.slice(32);let a=null,l=null;this.privateKey?a=OA(ft.from(s).add(this.privateKey).mod(AQ)):l=new Gg(at(s))._addPoint(this.publicKey);let c=t;const g=this.mnemonic;return g&&(c=Object.freeze({phrase:g.phrase,path:t,locale:g.locale||"en"})),new ns(Ld,a,l,this.fingerprint,OA(o),e,this.depth+1,c)}derivePath(e){const t=e.split("/");if(t.length===0||t[0]==="m"&&this.depth!==0)throw new Error("invalid path - "+e);t[0]==="m"&&t.shift();let n=this;for(let r=0;r<t.length;r++){const s=t[r];if(s.match(/^[0-9]+'$/)){const o=parseInt(s.substring(0,s.length-1));if(o>=vC)throw new Error("invalid path index - "+s);n=n._derive(vC+o)}else if(s.match(/^[0-9]+$/)){const o=parseInt(s);if(o>=vC)throw new Error("invalid path index - "+s);n=n._derive(o)}else throw new Error("invalid path component - "+s)}return n}static _fromSeed(e,t){const n=tt(e);if(n.length<16||n.length>64)throw new Error("invalid seed");const r=tt(AC(v1.sha512,bQ,n));return new ns(Ld,OA(r.slice(0,32)),null,"0x00000000",OA(r.slice(32)),0,0,t)}static fromMnemonic(e,t,n){return n=_1(n),e=QA(JA(e,n),n),ns._fromSeed(eE(e,t),{phrase:e,path:"m",locale:n.locale})}static fromSeed(e){return ns._fromSeed(e,null)}static fromExtendedKey(e){const t=GN.decode(e);(t.length!==82||$N(t.slice(0,78))!==e)&&yC.throwArgumentError("invalid extended key","extendedKey","[REDACTED]");const n=t[4],r=at(t.slice(5,9)),s=parseInt(at(t.slice(9,13)).substring(2),16),o=at(t.slice(13,45)),a=t.slice(45,78);switch(at(t.slice(0,4))){case"0x0488b21e":case"0x043587cf":return new ns(Ld,null,at(a),r,o,s,n,null);case"0x0488ade4":case"0x04358394 ":if(a[0]!==0)break;return new ns(Ld,at(a.slice(1)),null,r,o,s,n,null)}return yC.throwArgumentError("invalid extended key","extendedKey","[REDACTED]")}}function eE(i,e){e||(e="");const t=ji("mnemonic"+e,Jo.NFKD);return x1(ji(i,Jo.NFKD),t,2048,64,"sha512")}function JA(i,e){e=_1(e),yC.checkNormalize();const t=e.split(i);if(t.length%3!=0)throw new Error("invalid mnemonic");const n=tt(new Uint8Array(Math.ceil(11*t.length/8)));let r=0;for(let c=0;c<t.length;c++){let g=e.getWordIndex(t[c].normalize("NFKD"));if(g===-1)throw new Error("invalid mnemonic");for(let d=0;d<11;d++)g&1<<10-d&&(n[r>>3]|=1<<7-r%8),r++}const s=32*t.length/3,o=t.length/3,a=qN(o);if((tt(xg(n.slice(0,s/8)))[0]&a)!==(n[n.length-1]&a))throw new Error("invalid checksum");return at(n.slice(0,s/8))}function QA(i,e){if(e=_1(e),i=tt(i),i.length%4!=0||i.length<16||i.length>32)throw new Error("invalid entropy");const t=[0];let n=11;for(let o=0;o<i.length;o++)n>8?(t[t.length-1]<<=8,t[t.length-1]|=i[o],n-=8):(t[t.length-1]<<=n,t[t.length-1]|=i[o]>>8-n,t.push(i[o]&yQ(8-n)),n+=3);const r=i.length/4,s=tt(xg(i))[0]&qN(r);return t[t.length-1]<<=r,t[t.length-1]|=s>>8-r,e.join(t.map(o=>e.getWord(o)))}function vQ(i,e){try{return JA(i,e),!0}catch{}return!1}const xQ="random/5.0.0-beta.136";function tE(i){i=i.slice();for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1)),n=i[e];i[e]=i[t],i[t]=n}return i}const V1=new We(xQ);let Bg=null;try{if(Bg=window,Bg==null)throw new Error("try next")}catch{try{if(Bg=global,Bg==null)throw new Error("try next")}catch{Bg={}}}let jA=Bg.crypto||Bg.msCrypto;(!jA||!jA.getRandomValues)&&(V1.warn("WARNING: Missing strong random number source"),jA={getRandomValues:function(i){return V1.throwError("no secure random source avaialble",We.errors.UNSUPPORTED_OPERATION,{operation:"crypto.getRandomValues"})}});function Xd(i){(i<=0||i>1024||i%1)&&V1.throwArgumentError("invalid length","length",i);const e=new Uint8Array(i);return jA.getRandomValues(e),tt(e)}var na=Vr(function(i,e){(function(t){function n(F){return parseInt(F)===F}function r(F){if(!n(F.length))return!1;for(var K=0;K<F.length;K++)if(!n(F[K])||F[K]<0||F[K]>255)return!1;return!0}function s(F,K){if(F.buffer&&ArrayBuffer.isView(F)&&F.name==="Uint8Array")return K&&(F.slice?F=F.slice():F=Array.prototype.slice.call(F)),F;if(Array.isArray(F)){if(!r(F))throw new Error("Array contains invalid value: "+F);return new Uint8Array(F)}if(n(F.length)&&r(F))return new Uint8Array(F);throw new Error("unsupported array-like object")}function o(F){return new Uint8Array(F)}function a(F,K,j,O,Y){(O!=null||Y!=null)&&(F.slice?F=F.slice(O,Y):F=Array.prototype.slice.call(F,O,Y)),K.set(F,j)}var l=function(){function F(j){var O=[],Y=0;for(j=encodeURI(j);Y<j.length;){var ee=j.charCodeAt(Y++);ee===37?(O.push(parseInt(j.substr(Y,2),16)),Y+=2):O.push(ee)}return s(O)}function K(j){for(var O=[],Y=0;Y<j.length;){var ee=j[Y];ee<128?(O.push(String.fromCharCode(ee)),Y++):ee>191&&ee<224?(O.push(String.fromCharCode((ee&31)<<6|j[Y+1]&63)),Y+=2):(O.push(String.fromCharCode((ee&15)<<12|(j[Y+1]&63)<<6|j[Y+2]&63)),Y+=3)}return O.join("")}return{toBytes:F,fromBytes:K}}(),c=function(){function F(O){for(var Y=[],ee=0;ee<O.length;ee+=2)Y.push(parseInt(O.substr(ee,2),16));return Y}var K="0123456789abcdef";function j(O){for(var Y=[],ee=0;ee<O.length;ee++){var ye=O[ee];Y.push(K[(ye&240)>>4]+K[ye&15])}return Y.join("")}return{toBytes:F,fromBytes:j}}(),g={16:10,24:12,32:14},d=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],u=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],h=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],p=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],b=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],y=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],m=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],f=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],G=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],x=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],B=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],M=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],E=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],z=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],J=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function V(F){for(var K=[],j=0;j<F.length;j+=4)K.push(F[j]<<24|F[j+1]<<16|F[j+2]<<8|F[j+3]);return K}var I=function(F){if(!(this instanceof I))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:s(F,!0)}),this._prepare()};I.prototype._prepare=function(){var F=g[this.key.length];if(F==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var K=0;K<=F;K++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var j=(F+1)*4,O=this.key.length/4,Y=V(this.key),ee,K=0;K<O;K++)ee=K>>2,this._Ke[ee][K%4]=Y[K],this._Kd[F-ee][K%4]=Y[K];for(var ye=0,Ce=O,he;Ce<j;){if(he=Y[O-1],Y[0]^=u[he>>16&255]<<24^u[he>>8&255]<<16^u[he&255]<<8^u[he>>24&255]^d[ye]<<24,ye+=1,O!=8)for(var K=1;K<O;K++)Y[K]^=Y[K-1];else{for(var K=1;K<O/2;K++)Y[K]^=Y[K-1];he=Y[O/2-1],Y[O/2]^=u[he&255]^u[he>>8&255]<<8^u[he>>16&255]<<16^u[he>>24&255]<<24;for(var K=O/2+1;K<O;K++)Y[K]^=Y[K-1]}for(var K=0,Ne,He;K<O&&Ce<j;)Ne=Ce>>2,He=Ce%4,this._Ke[Ne][He]=Y[K],this._Kd[F-Ne][He]=Y[K++],Ce++}for(var Ne=1;Ne<F;Ne++)for(var He=0;He<4;He++)he=this._Kd[Ne][He],this._Kd[Ne][He]=M[he>>24&255]^E[he>>16&255]^z[he>>8&255]^J[he&255]},I.prototype.encrypt=function(F){if(F.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var K=this._Ke.length-1,j=[0,0,0,0],O=V(F),Y=0;Y<4;Y++)O[Y]^=this._Ke[0][Y];for(var ee=1;ee<K;ee++){for(var Y=0;Y<4;Y++)j[Y]=p[O[Y]>>24&255]^b[O[(Y+1)%4]>>16&255]^y[O[(Y+2)%4]>>8&255]^m[O[(Y+3)%4]&255]^this._Ke[ee][Y];O=j.slice()}for(var ye=o(16),Ce,Y=0;Y<4;Y++)Ce=this._Ke[K][Y],ye[4*Y]=(u[O[Y]>>24&255]^Ce>>24)&255,ye[4*Y+1]=(u[O[(Y+1)%4]>>16&255]^Ce>>16)&255,ye[4*Y+2]=(u[O[(Y+2)%4]>>8&255]^Ce>>8)&255,ye[4*Y+3]=(u[O[(Y+3)%4]&255]^Ce)&255;return ye},I.prototype.decrypt=function(F){if(F.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var K=this._Kd.length-1,j=[0,0,0,0],O=V(F),Y=0;Y<4;Y++)O[Y]^=this._Kd[0][Y];for(var ee=1;ee<K;ee++){for(var Y=0;Y<4;Y++)j[Y]=f[O[Y]>>24&255]^G[O[(Y+3)%4]>>16&255]^x[O[(Y+2)%4]>>8&255]^B[O[(Y+1)%4]&255]^this._Kd[ee][Y];O=j.slice()}for(var ye=o(16),Ce,Y=0;Y<4;Y++)Ce=this._Kd[K][Y],ye[4*Y]=(h[O[Y]>>24&255]^Ce>>24)&255,ye[4*Y+1]=(h[O[(Y+3)%4]>>16&255]^Ce>>16)&255,ye[4*Y+2]=(h[O[(Y+2)%4]>>8&255]^Ce>>8)&255,ye[4*Y+3]=(h[O[(Y+1)%4]&255]^Ce)&255;return ye};var w=function(F){if(!(this instanceof w))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new I(F)};w.prototype.encrypt=function(F){if(F=s(F),F.length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var K=o(F.length),j=o(16),O=0;O<F.length;O+=16)a(F,j,0,O,O+16),j=this._aes.encrypt(j),a(j,K,O);return K},w.prototype.decrypt=function(F){if(F=s(F),F.length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var K=o(F.length),j=o(16),O=0;O<F.length;O+=16)a(F,j,0,O,O+16),j=this._aes.decrypt(j),a(j,K,O);return K};var S=function(F,K){if(!(this instanceof S))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!K)K=o(16);else if(K.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=s(K,!0),this._aes=new I(F)};S.prototype.encrypt=function(F){if(F=s(F),F.length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var K=o(F.length),j=o(16),O=0;O<F.length;O+=16){a(F,j,0,O,O+16);for(var Y=0;Y<16;Y++)j[Y]^=this._lastCipherblock[Y];this._lastCipherblock=this._aes.encrypt(j),a(this._lastCipherblock,K,O)}return K},S.prototype.decrypt=function(F){if(F=s(F),F.length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var K=o(F.length),j=o(16),O=0;O<F.length;O+=16){a(F,j,0,O,O+16),j=this._aes.decrypt(j);for(var Y=0;Y<16;Y++)K[O+Y]=j[Y]^this._lastCipherblock[Y];a(F,this._lastCipherblock,0,O,O+16)}return K};var R=function(F,K,j){if(!(this instanceof R))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!K)K=o(16);else if(K.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");j||(j=1),this.segmentSize=j,this._shiftRegister=s(K,!0),this._aes=new I(F)};R.prototype.encrypt=function(F){if(F.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var K=s(F,!0),j,O=0;O<K.length;O+=this.segmentSize){j=this._aes.encrypt(this._shiftRegister);for(var Y=0;Y<this.segmentSize;Y++)K[O+Y]^=j[Y];a(this._shiftRegister,this._shiftRegister,0,this.segmentSize),a(K,this._shiftRegister,16-this.segmentSize,O,O+this.segmentSize)}return K},R.prototype.decrypt=function(F){if(F.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var K=s(F,!0),j,O=0;O<K.length;O+=this.segmentSize){j=this._aes.encrypt(this._shiftRegister);for(var Y=0;Y<this.segmentSize;Y++)K[O+Y]^=j[Y];a(this._shiftRegister,this._shiftRegister,0,this.segmentSize),a(F,this._shiftRegister,16-this.segmentSize,O,O+this.segmentSize)}return K};var W=function(F,K){if(!(this instanceof W))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!K)K=o(16);else if(K.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=s(K,!0),this._lastPrecipherIndex=16,this._aes=new I(F)};W.prototype.encrypt=function(F){for(var K=s(F,!0),j=0;j<K.length;j++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),K[j]^=this._lastPrecipher[this._lastPrecipherIndex++];return K},W.prototype.decrypt=W.prototype.encrypt;var H=function(F){if(!(this instanceof H))throw Error("Counter must be instanitated with `new`");F!==0&&!F&&(F=1),typeof F=="number"?(this._counter=o(16),this.setValue(F)):this.setBytes(F)};H.prototype.setValue=function(F){if(typeof F!="number"||parseInt(F)!=F)throw new Error("invalid counter value (must be an integer)");for(var K=15;K>=0;--K)this._counter[K]=F%256,F=F>>8},H.prototype.setBytes=function(F){if(F=s(F,!0),F.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=F},H.prototype.increment=function(){for(var F=15;F>=0;F--)if(this._counter[F]===255)this._counter[F]=0;else{this._counter[F]++;break}};var k=function(F,K){if(!(this instanceof k))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",K instanceof H||(K=new H(K)),this._counter=K,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new I(F)};k.prototype.encrypt=function(F){for(var K=s(F,!0),j=0;j<K.length;j++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),K[j]^=this._remainingCounter[this._remainingCounterIndex++];return K},k.prototype.decrypt=k.prototype.encrypt;function _(F){F=s(F,!0);var K=16-F.length%16,j=o(F.length+K);a(F,j);for(var O=F.length;O<j.length;O++)j[O]=K;return j}function Z(F){if(F=s(F,!0),F.length<16)throw new Error("PKCS#7 invalid length");var K=F[F.length-1];if(K>16)throw new Error("PKCS#7 padding byte out of range");for(var j=F.length-K,O=0;O<K;O++)if(F[j+O]!==K)throw new Error("PKCS#7 invalid padding byte");var Y=o(j);return a(F,Y,0,0,j),Y}var T={AES:I,Counter:H,ModeOfOperation:{ecb:w,cbc:S,cfb:R,ofb:W,ctr:k},utils:{hex:c,utf8:l},padding:{pkcs7:{pad:_,strip:Z}},_arrayTest:{coerceArray:s,createArray:o,copyArray:a}};i.exports=T})()});const nE="json-wallets/5.0.0-beta.140";function Sg(i){return typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),tt(i)}function xC(i,e){for(i=String(i);i.length<e;)i="0"+i;return i}function N1(i){return typeof i=="string"?ji(i,Jo.NFKC):tt(i)}function gi(i,e){let t=i;const n=e.toLowerCase().split("/");for(let r=0;r<n.length;r++){let s=null;for(const o in t)if(o.toLowerCase()===n[r]){s=t[o];break}if(s===null)return null;t=s}return t}const wQ=new We(nE);class GQ extends Rd{isCrowdsaleAccount(e){return!!(e&&e._isCrowdsaleAccount)}}function iE(i,e){const t=JSON.parse(i);e=N1(e);const n=Dn(gi(t,"ethaddr")),r=Sg(gi(t,"encseed"));(!r||r.length%16!=0)&&wQ.throwArgumentError("invalid encseed","json",i);const s=tt(x1(e,e,2e3,32,"sha256")).slice(0,16),o=r.slice(0,16),a=r.slice(16),l=new na.ModeOfOperation.cbc(s,o),c=na.padding.pkcs7.strip(tt(l.decrypt(a)));let g="";for(let h=0;h<c.length;h++)g+=String.fromCharCode(c[h]);const d=ji(g),u=Gi(d);return new GQ({_isCrowdsaleAccount:!0,address:n,privateKey:u})}function E1(i){let e=null;try{e=JSON.parse(i)}catch{return!1}return e.encseed&&e.ethaddr}function H1(i){let e=null;try{e=JSON.parse(i)}catch{return!1}return!(!e.version||parseInt(e.version)!==e.version||parseInt(e.version)!==3)}function BQ(i){if(E1(i))try{return Dn(JSON.parse(i).ethaddr)}catch{return null}if(H1(i))try{return Dn(JSON.parse(i).address)}catch{return null}return null}var rE=Vr(function(i,e){(function(t){const n=2147483647;function r(b){const y=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let m=1779033703,f=3144134277,G=1013904242,x=2773480762,B=1359893119,M=2600822924,E=528734635,z=1541459225;const J=new Uint32Array(64);function V(k){let _=0,Z=k.length;for(;Z>=64;){let T=m,F=f,K=G,j=x,O=B,Y=M,ee=E,ye=z,Ce,he,Ne,He,ne;for(he=0;he<16;he++)Ne=_+he*4,J[he]=(k[Ne]&255)<<24|(k[Ne+1]&255)<<16|(k[Ne+2]&255)<<8|k[Ne+3]&255;for(he=16;he<64;he++)Ce=J[he-2],He=(Ce>>>17|Ce<<32-17)^(Ce>>>19|Ce<<32-19)^Ce>>>10,Ce=J[he-15],ne=(Ce>>>7|Ce<<32-7)^(Ce>>>18|Ce<<32-18)^Ce>>>3,J[he]=(He+J[he-7]|0)+(ne+J[he-16]|0)|0;for(he=0;he<64;he++)He=(((O>>>6|O<<32-6)^(O>>>11|O<<32-11)^(O>>>25|O<<32-25))+(O&Y^~O&ee)|0)+(ye+(y[he]+J[he]|0)|0)|0,ne=((T>>>2|T<<32-2)^(T>>>13|T<<32-13)^(T>>>22|T<<32-22))+(T&F^T&K^F&K)|0,ye=ee,ee=Y,Y=O,O=j+He|0,j=K,K=F,F=T,T=He+ne|0;m=m+T|0,f=f+F|0,G=G+K|0,x=x+j|0,B=B+O|0,M=M+Y|0,E=E+ee|0,z=z+ye|0,_+=64,Z-=64}}V(b);let I,w=b.length%64,S=b.length/536870912|0,R=b.length<<3,W=w<56?56:120,H=b.slice(b.length-w,b.length);for(H.push(128),I=w+1;I<W;I++)H.push(0);return H.push(S>>>24&255),H.push(S>>>16&255),H.push(S>>>8&255),H.push(S>>>0&255),H.push(R>>>24&255),H.push(R>>>16&255),H.push(R>>>8&255),H.push(R>>>0&255),V(H),[m>>>24&255,m>>>16&255,m>>>8&255,m>>>0&255,f>>>24&255,f>>>16&255,f>>>8&255,f>>>0&255,G>>>24&255,G>>>16&255,G>>>8&255,G>>>0&255,x>>>24&255,x>>>16&255,x>>>8&255,x>>>0&255,B>>>24&255,B>>>16&255,B>>>8&255,B>>>0&255,M>>>24&255,M>>>16&255,M>>>8&255,M>>>0&255,E>>>24&255,E>>>16&255,E>>>8&255,E>>>0&255,z>>>24&255,z>>>16&255,z>>>8&255,z>>>0&255]}function s(b,y,m){b=b.length<=64?b:r(b);const f=64+y.length+4,G=new Array(f),x=new Array(64);let B,M=[];for(B=0;B<64;B++)G[B]=54;for(B=0;B<b.length;B++)G[B]^=b[B];for(B=0;B<y.length;B++)G[64+B]=y[B];for(B=f-4;B<f;B++)G[B]=0;for(B=0;B<64;B++)x[B]=92;for(B=0;B<b.length;B++)x[B]^=b[B];function E(){for(let z=f-1;z>=f-4;z--){if(G[z]++,G[z]<=255)return;G[z]=0}}for(;m>=32;)E(),M=M.concat(r(x.concat(r(G)))),m-=32;return m>0&&(E(),M=M.concat(r(x.concat(r(G))).slice(0,m))),M}function o(b,y,m,f,G){let x;for(g(b,(2*m-1)*16,G,0,16),x=0;x<2*m;x++)c(b,x*16,G,16),l(G,f),g(G,0,b,y+x*16,16);for(x=0;x<m;x++)g(b,y+x*2*16,b,x*16,16);for(x=0;x<m;x++)g(b,y+(x*2+1)*16,b,(x+m)*16,16)}function a(b,y){return b<<y|b>>>32-y}function l(b,y){g(b,0,y,0,16);for(let m=8;m>0;m-=2)y[4]^=a(y[0]+y[12],7),y[8]^=a(y[4]+y[0],9),y[12]^=a(y[8]+y[4],13),y[0]^=a(y[12]+y[8],18),y[9]^=a(y[5]+y[1],7),y[13]^=a(y[9]+y[5],9),y[1]^=a(y[13]+y[9],13),y[5]^=a(y[1]+y[13],18),y[14]^=a(y[10]+y[6],7),y[2]^=a(y[14]+y[10],9),y[6]^=a(y[2]+y[14],13),y[10]^=a(y[6]+y[2],18),y[3]^=a(y[15]+y[11],7),y[7]^=a(y[3]+y[15],9),y[11]^=a(y[7]+y[3],13),y[15]^=a(y[11]+y[7],18),y[1]^=a(y[0]+y[3],7),y[2]^=a(y[1]+y[0],9),y[3]^=a(y[2]+y[1],13),y[0]^=a(y[3]+y[2],18),y[6]^=a(y[5]+y[4],7),y[7]^=a(y[6]+y[5],9),y[4]^=a(y[7]+y[6],13),y[5]^=a(y[4]+y[7],18),y[11]^=a(y[10]+y[9],7),y[8]^=a(y[11]+y[10],9),y[9]^=a(y[8]+y[11],13),y[10]^=a(y[9]+y[8],18),y[12]^=a(y[15]+y[14],7),y[13]^=a(y[12]+y[15],9),y[14]^=a(y[13]+y[12],13),y[15]^=a(y[14]+y[13],18);for(let m=0;m<16;++m)b[m]+=y[m]}function c(b,y,m,f){for(let G=0;G<f;G++)m[G]^=b[y+G]}function g(b,y,m,f,G){for(;G--;)m[f++]=b[y++]}function d(b){if(!b||typeof b.length!="number")return!1;for(let y=0;y<b.length;y++){const m=b[y];if(typeof m!="number"||m%1||m<0||m>=256)return!1}return!0}function u(b,y){if(typeof b!="number"||b%1)throw new Error("invalid "+y);return b}function h(b,y,m,f,G,x,B){if(m=u(m,"N"),f=u(f,"r"),G=u(G,"p"),x=u(x,"dkLen"),m===0||(m&m-1)!=0)throw new Error("N must be power of 2");if(m>n/128/f)throw new Error("N too large");if(f>n/128/G)throw new Error("r too large");if(!d(b))throw new Error("password must be an array or buffer");if(b=Array.prototype.slice.call(b),!d(y))throw new Error("salt must be an array or buffer");y=Array.prototype.slice.call(y);let M=s(b,y,G*128*f);const E=new Uint32Array(G*32*f);for(let O=0;O<E.length;O++){const Y=O*4;E[O]=(M[Y+3]&255)<<24|(M[Y+2]&255)<<16|(M[Y+1]&255)<<8|(M[Y+0]&255)<<0}const z=new Uint32Array(64*f),J=new Uint32Array(32*f*m),V=32*f,I=new Uint32Array(16),w=new Uint32Array(16),S=G*m*2;let R=0,W=null,H=!1,k=0,_=0,Z,T;const F=B?parseInt(1e3/f):4294967295,K=typeof setImmediate!="undefined"?setImmediate:setTimeout,j=function(){if(H)return B(new Error("cancelled"),R/S);let O;switch(k){case 0:T=_*32*f,g(E,T,z,0,V),k=1,Z=0;case 1:O=m-Z,O>F&&(O=F);for(let ee=0;ee<O;ee++)g(z,0,J,(Z+ee)*V,V),o(z,V,f,I,w);if(Z+=O,R+=O,B){const ee=parseInt(1e3*R/S);if(ee!==W){if(H=B(null,R/S),H)break;W=ee}}if(Z<m)break;Z=0,k=2;case 2:O=m-Z,O>F&&(O=F);for(let ee=0;ee<O;ee++){const ye=(2*f-1)*16,Ce=z[ye]&m-1;c(J,Ce*V,z,V),o(z,V,f,I,w)}if(Z+=O,R+=O,B){const ee=parseInt(1e3*R/S);if(ee!==W){if(H=B(null,R/S),H)break;W=ee}}if(Z<m)break;if(g(z,0,E,T,V),_++,_<G){k=0;break}M=[];for(let ee=0;ee<E.length;ee++)M.push(E[ee]>>0&255),M.push(E[ee]>>8&255),M.push(E[ee]>>16&255),M.push(E[ee]>>24&255);const Y=s(b,M,x);return B&&B(null,1,Y),Y}B&&K(j)};if(!B)for(;;){const O=j();if(O!=null)return O}j()}const p={scrypt:function(b,y,m,f,G,x,B){return new Promise(function(M,E){let z=0;B&&B(0),h(b,y,m,f,G,x,function(J,V,I){if(J)E(J);else if(I)B&&z!==1&&B(1),M(new Uint8Array(I));else if(B&&V!==z)return z=V,B(V)})})},syncScrypt:function(b,y,m,f,G,x){return new Uint8Array(h(b,y,m,f,G,x))}};i.exports=p})()}),sE=rE.scrypt,SQ=rE.syncScrypt,qA;if(yg.crypto&&crypto.getRandomValues){var oE=new Uint8Array(16);qA=function(){return crypto.getRandomValues(oE),oE}}if(!qA){var aE=new Array(16);qA=function(){for(var i=0,e;i<16;i++)(i&3)==0&&(e=Math.random()*4294967296),aE[i]=e>>>((i&3)<<3)&255;return aE}}var lE=qA,F1=[],cE={};for(var zd=0;zd<256;zd++)F1[zd]=(zd+256).toString(16).substr(1),cE[F1[zd]]=zd;function ZQ(i,e,t){var n=e&&t||0,r=0;for(e=e||[],i.toLowerCase().replace(/[0-9a-f]{2}/g,function(s){r<16&&(e[n+r++]=cE[s])});r<16;)e[n+r++]=0;return e}function L1(i,e){var t=e||0,n=F1;return n[i[t++]]+n[i[t++]]+n[i[t++]]+n[i[t++]]+"-"+n[i[t++]]+n[i[t++]]+"-"+n[i[t++]]+n[i[t++]]+"-"+n[i[t++]]+n[i[t++]]+"-"+n[i[t++]]+n[i[t++]]+n[i[t++]]+n[i[t++]]+n[i[t++]]+n[i[t++]]}var ac=lE(),RQ=[ac[0]|1,ac[1],ac[2],ac[3],ac[4],ac[5]],gE=(ac[6]<<8|ac[7])&16383,T1=0,X1=0;function MQ(i,e,t){var n=e&&t||0,r=e||[];i=i||{};var s=i.clockseq!==void 0?i.clockseq:gE,o=i.msecs!==void 0?i.msecs:new Date().getTime(),a=i.nsecs!==void 0?i.nsecs:X1+1,l=o-T1+(a-X1)/1e4;if(l<0&&i.clockseq===void 0&&(s=s+1&16383),(l<0||o>T1)&&i.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");T1=o,X1=a,gE=s,o+=122192928e5;var c=((o&268435455)*1e4+a)%4294967296;r[n++]=c>>>24&255,r[n++]=c>>>16&255,r[n++]=c>>>8&255,r[n++]=c&255;var g=o/4294967296*1e4&268435455;r[n++]=g>>>8&255,r[n++]=g&255,r[n++]=g>>>24&15|16,r[n++]=g>>>16&255,r[n++]=s>>>8|128,r[n++]=s&255;for(var d=i.node||RQ,u=0;u<6;u++)r[n+u]=d[u];return e||L1(r)}function uE(i,e,t){var n=e&&t||0;typeof i=="string"&&(e=i=="binary"?new Array(16):null,i=null),i=i||{};var r=i.random||(i.rng||lE)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e)for(var s=0;s<16;s++)e[n+s]=r[s];return e||L1(r)}var wC=uE;wC.v1=MQ;wC.v4=uE;wC.parse=ZQ;wC.unparse=L1;var WQ=wC,_Q=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const z1=new We(nE);function dE(i){return i!=null&&i.mnemonic&&i.mnemonic.phrase}class VQ extends Rd{isKeystoreAccount(e){return!!(e&&e._isKeystoreAccount)}}function NQ(i,e,t){if(gi(i,"crypto/cipher")==="aes-128-ctr"){const r=Sg(gi(i,"crypto/cipherparams/iv")),s=new na.Counter(r),o=new na.ModeOfOperation.ctr(e,s);return tt(o.decrypt(t))}return null}function hE(i,e){const t=Sg(gi(i,"crypto/ciphertext"));if(at(Gi(li([e.slice(16,32),t]))).substring(2)!==gi(i,"crypto/mac").toLowerCase())throw new Error("invalid password");const r=NQ(i,e.slice(0,16),t);r||z1.throwError("unsupported cipher",We.errors.UNSUPPORTED_OPERATION,{operation:"decrypt"});const s=e.slice(32,64),o=oc(r);if(i.address){let l=i.address.toLowerCase();if(l.substring(0,2)!=="0x"&&(l="0x"+l),Dn(l)!==o)throw new Error("address mismatch")}const a={_isKeystoreAccount:!0,address:o,privateKey:at(r)};if(gi(i,"x-ethers/version")==="0.1"){const l=Sg(gi(i,"x-ethers/mnemonicCiphertext")),c=Sg(gi(i,"x-ethers/mnemonicCounter")),g=new na.Counter(c),d=new na.ModeOfOperation.ctr(s,g),u=gi(i,"x-ethers/path")||Td,h=gi(i,"x-ethers/locale")||"en",p=tt(d.decrypt(l));try{const b=QA(p,h),y=ns.fromMnemonic(b,null,h).derivePath(u);if(y.privateKey!=a.privateKey)throw new Error("mnemonic mismatch");a.mnemonic=y.mnemonic}catch(b){if(b.code!==We.errors.INVALID_ARGUMENT||b.argument!=="wordlist")throw b}}return new VQ(a)}function fE(i,e,t,n,r){return tt(x1(i,e,t,n,r))}function EQ(i,e,t,n,r){return Promise.resolve(fE(i,e,t,n,r))}function IE(i,e,t,n,r){const s=N1(e),o=gi(i,"crypto/kdf");if(o&&typeof o=="string"){const a=function(l,c){return z1.throwArgumentError("invalid key-derivation function parameters",l,c)};if(o.toLowerCase()==="scrypt"){const l=Sg(gi(i,"crypto/kdfparams/salt")),c=parseInt(gi(i,"crypto/kdfparams/n")),g=parseInt(gi(i,"crypto/kdfparams/r")),d=parseInt(gi(i,"crypto/kdfparams/p"));(!c||!g||!d)&&a("kdf",o),(c&c-1)!=0&&a("N",c);const u=parseInt(gi(i,"crypto/kdfparams/dklen"));return u!==32&&a("dklen",u),n(s,l,c,g,d,64,r)}else if(o.toLowerCase()==="pbkdf2"){const l=Sg(gi(i,"crypto/kdfparams/salt"));let c=null;const g=gi(i,"crypto/kdfparams/prf");g==="hmac-sha256"?c="sha256":g==="hmac-sha512"?c="sha512":a("prf",g);const d=parseInt(gi(i,"crypto/kdfparams/c")),u=parseInt(gi(i,"crypto/kdfparams/dklen"));return u!==32&&a("dklen",u),t(s,l,d,u,c)}}return z1.throwArgumentError("unsupported key-derivation function","kdf",o)}function HQ(i,e){const t=JSON.parse(i),n=IE(t,e,fE,SQ);return hE(t,n)}function FQ(i,e,t){return _Q(this,void 0,void 0,function*(){const n=JSON.parse(i),r=yield IE(n,e,EQ,sE,t);return hE(n,r)})}function LQ(i,e,t,n){try{if(Dn(i.address)!==oc(i.privateKey))throw new Error("address/privateKey mismatch");if(dE(i)){const y=i.mnemonic;if(ns.fromMnemonic(y.phrase,null,y.locale).derivePath(y.path||Td).privateKey!=i.privateKey)throw new Error("mnemonic mismatch")}}catch(y){return Promise.reject(y)}typeof t=="function"&&!n&&(n=t,t={}),t||(t={});const r=tt(i.privateKey),s=N1(e);let o=null,a=null,l=null;if(dE(i)){const y=i.mnemonic;o=tt(JA(y.phrase,y.locale||"en")),a=y.path||Td,l=y.locale||"en"}let c=t.client;c||(c="ethers.js");let g=null;t.salt?g=tt(t.salt):g=Xd(32);let d=null;if(t.iv){if(d=tt(t.iv),d.length!==16)throw new Error("invalid iv")}else d=Xd(16);let u=null;if(t.uuid){if(u=tt(t.uuid),u.length!==16)throw new Error("invalid uuid")}else u=Xd(16);let h=1<<17,p=8,b=1;return t.scrypt&&(t.scrypt.N&&(h=t.scrypt.N),t.scrypt.r&&(p=t.scrypt.r),t.scrypt.p&&(b=t.scrypt.p)),sE(s,g,h,p,b,64,n).then(y=>{y=tt(y);const m=y.slice(0,16),f=y.slice(16,32),G=y.slice(32,64),x=new na.Counter(d),B=new na.ModeOfOperation.ctr(m,x),M=tt(B.encrypt(r)),E=Gi(li([f,M])),z={address:i.address.substring(2).toLowerCase(),id:WQ.v4({random:u}),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:at(d).substring(2)},ciphertext:at(M).substring(2),kdf:"scrypt",kdfparams:{salt:at(g).substring(2),n:h,dklen:32,p:b,r:p},mac:E.substring(2)}};if(o){const J=Xd(16),V=new na.Counter(J),I=new na.ModeOfOperation.ctr(G,V),w=tt(I.encrypt(o)),S=new Date,R=S.getUTCFullYear()+"-"+xC(S.getUTCMonth()+1,2)+"-"+xC(S.getUTCDate(),2)+"T"+xC(S.getUTCHours(),2)+"-"+xC(S.getUTCMinutes(),2)+"-"+xC(S.getUTCSeconds(),2)+".0Z";z["x-ethers"]={client:c,gethFilename:"UTC--"+R+"--"+z.address,mnemonicCounter:at(J).substring(2),mnemonicCiphertext:at(w).substring(2),path:a,locale:l,version:"0.1"}}return JSON.stringify(z)})}function TQ(i,e,t){if(E1(i)){t&&t(0);const n=iE(i,e);return t&&t(1),Promise.resolve(n)}return H1(i)?FQ(i,e,t):Promise.reject(new Error("invalid JSON wallet"))}function XQ(i,e){if(E1(i))return iE(i,e);if(H1(i))return HQ(i,e);throw new Error("invalid JSON wallet")}const zQ="wallet/5.0.0-beta.141",GC=new We(zQ);function kQ(i){return i!=null&&Qt(i.privateKey,32)&&i.address!=null}function YQ(i){const e=i.mnemonic;return e&&e.phrase}class lc extends ec{constructor(e,t){GC.checkNew(new.target,lc);super();if(kQ(e)){const n=new Gg(e.privateKey);if(ke(this,"_signingKey",()=>n),ke(this,"address",oc(this.publicKey)),this.address!==Dn(e.address)&&GC.throwArgumentError("privateKey/address mismatch","privateKey","[REDACTED]"),YQ(e)){const r=e.mnemonic;ke(this,"_mnemonic",()=>({phrase:r.phrase,path:r.path||Td,locale:r.locale||"en"}));const s=this.mnemonic,o=ns.fromMnemonic(s.phrase,null,s.locale).derivePath(s.path);oc(o.privateKey)!==this.address&&GC.throwArgumentError("mnemonic/address mismatch","privateKey","[REDACTED]")}else ke(this,"_mnemonic",()=>null)}else{if(Gg.isSigningKey(e))e.curve!=="secp256k1"&&GC.throwArgumentError("unsupported curve; must be secp256k1","privateKey","[REDACTED]"),ke(this,"_signingKey",()=>e);else{const n=new Gg(e);ke(this,"_signingKey",()=>n)}ke(this,"_mnemonic",()=>null),ke(this,"address",oc(this.publicKey))}t&&!jl.isProvider(t)&&GC.throwArgumentError("invalid provider","provider",t),ke(this,"provider",t||null)}get mnemonic(){return this._mnemonic()}get privateKey(){return this._signingKey().privateKey}get publicKey(){return this._signingKey().publicKey}getAddress(){return Promise.resolve(this.address)}connect(e){return new lc(this,e)}signTransaction(e){return ci(e).then(t=>{if(t.from!=null){if(Dn(t.from)!==this.address)throw new Error("transaction from address mismatch");delete t.from}const n=this._signingKey().signDigest(Gi(M1(t)));return M1(t,n)})}signMessage(e){return Promise.resolve($2(this._signingKey().signDigest(p1(e))))}encrypt(e,t,n){if(typeof t=="function"&&!n&&(n=t,t={}),n&&typeof n!="function")throw new Error("invalid callback");return t||(t={}),LQ(this,e,t,n)}static createRandom(e){let t=Xd(16);e||(e={}),e.extraEntropy&&(t=tt(go(Gi(li([t,e.extraEntropy])),0,16)));const n=QA(t,e.locale);return lc.fromMnemonic(n,e.path,e.locale)}static fromEncryptedJson(e,t,n){return TQ(e,t,n).then(r=>new lc(r))}static fromEncryptedJsonSync(e,t){return new lc(XQ(e,t))}static fromMnemonic(e,t,n){return t||(t=Td),new lc(ns.fromMnemonic(e,null,n).derivePath(t))}}function KQ(i,e){return R1(p1(i),e)}const PQ="networks/5.0.0-beta.137",CE=new We(PQ);function BC(i){return function(e,t){t==null&&(t={});const n=[];if(e.InfuraProvider)try{n.push(new e.InfuraProvider(i,t.infura))}catch{}if(e.EtherscanProvider)try{n.push(new e.EtherscanProvider(i,t.etherscan))}catch{}if(e.AlchemyProvider)try{n.push(new e.AlchemyProvider(i,t.alchemy))}catch{}if(e.CloudflareProvider)try{n.push(new e.CloudflareProvider(i))}catch{}if(n.length===0)return null;if(e.FallbackProvider){let r=1;return t.quorum!=null?r=t.quorum:i==="homestead"&&(r=2),new e.FallbackProvider(n,r)}return n[0]}}function k1(i,e){return function(t,n){return t.JsonRpcProvider?new t.JsonRpcProvider(i,e):null}}const pE={chainId:1,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"homestead",_defaultProvider:BC("homestead")},mE={chainId:3,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"ropsten",_defaultProvider:BC("ropsten")},AE={chainId:63,name:"classicMordor",_defaultProvider:k1("https://www.ethercluster.com/mordor","classicMordor")},$A={unspecified:{chainId:0,name:"unspecified"},homestead:pE,mainnet:pE,morden:{chainId:2,name:"morden"},ropsten:mE,testnet:mE,rinkeby:{chainId:4,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"rinkeby",_defaultProvider:BC("rinkeby")},kovan:{chainId:42,name:"kovan",_defaultProvider:BC("kovan")},goerli:{chainId:5,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"goerli",_defaultProvider:BC("goerli")},classic:{chainId:61,name:"classic",_defaultProvider:k1("https://www.ethercluster.com/etc","classic")},classicMorden:{chainId:62,name:"classicMorden"},classicMordor:AE,classicTestnet:AE,classicKotti:{chainId:6,name:"classicKotti",_defaultProvider:k1("https://www.ethercluster.com/kotti","classicKotti")}};function Y1(i){if(i==null)return null;if(typeof i=="number"){for(const t in $A){const n=$A[t];if(n.chainId===i)return{name:n.name,chainId:n.chainId,ensAddress:n.ensAddress||null,_defaultProvider:n._defaultProvider||null}}return{chainId:i,name:"unknown"}}if(typeof i=="string"){const t=$A[i];return t==null?null:{name:t.name,chainId:t.chainId,ensAddress:t.ensAddress,_defaultProvider:t._defaultProvider||null}}const e=$A[i.name];return e?(i.chainId!==0&&i.chainId!==e.chainId&&CE.throwArgumentError("network chainId mismatch","network",i),{name:i.name,chainId:e.chainId,ensAddress:i.ensAddress||e.ensAddress||null,_defaultProvider:i._defaultProvider||e._defaultProvider||null}):(typeof i.chainId!="number"&&CE.throwArgumentError("invalid network chainId","network",i),i)}function DQ(i){i=atob(i);const e=[];for(let t=0;t<i.length;t++)e.push(i.charCodeAt(t));return tt(e)}function bE(i){i=tt(i);let e="";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return btoa(e)}var UQ=Object.freeze({decode:DQ,encode:bE});const OQ="web/5.0.0-beta.142";var JQ=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};function QQ(i,e){return JQ(this,void 0,void 0,function*(){e==null&&(e={});const t={method:e.method||"GET",headers:e.headers||{},body:e.body||void 0,mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrer:"client"},n=yield fetch(i,t),r=yield n.text(),s={};return n.headers.forEach?n.headers.forEach((o,a)=>{s[a.toLowerCase()]=o}):n.headers.keys().forEach(o=>{s[o.toLowerCase()]=n.headers.get(o)}),{headers:s,statusCode:n.status,statusMessage:n.statusText,body:r}})}var jQ=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Zg=new We(OQ);function eb(i,e,t){const n={};let r=null;const s={method:"GET"};let o=!1,a=2*60*1e3;if(typeof i=="string")r=i;else if(typeof i=="object"){if((i==null||i.url==null)&&Zg.throwArgumentError("missing URL","connection.url",i),r=i.url,typeof i.timeout=="number"&&i.timeout>0&&(a=i.timeout),i.headers)for(const d in i.headers)n[d.toLowerCase()]={key:d,value:String(i.headers[d])},["if-none-match","if-modified-since"].indexOf(d.toLowerCase())>=0&&(o=!0);if(i.user!=null&&i.password!=null){r.substring(0,6)!=="https:"&&i.allowInsecureAuthentication!==!0&&Zg.throwError("basic authentication requires a secure https url",We.errors.INVALID_ARGUMENT,{argument:"url",url:r,user:i.user,password:"[REDACTED]"});const d=i.user+":"+i.password;n.authorization={key:"Authorization",value:"Basic "+bE(ji(d))}}}e&&(s.method="POST",s.body=e,n["content-type"]={key:"Content-Type",value:"application/json"});const l={};Object.keys(n).forEach(d=>{const u=n[d];l[u.key]=u.value}),s.headers=l;const c=function(){let d=null;return{promise:new Promise(function(p,b){a&&(d=setTimeout(()=>{d!=null&&(d=null,b(Zg.makeError("timeout",We.errors.TIMEOUT,{requestBody:s.body||null,requestMethod:s.method,timeout:a,url:r})))},a))}),cancel:function(){d!=null&&(clearTimeout(d),d=null)}}}(),g=function(){return jQ(this,void 0,void 0,function*(){let d=null;try{d=yield QQ(r,s)}catch(p){d=p.response,d==null&&(c.cancel(),Zg.throwError("missing response",We.errors.SERVER_ERROR,{requestBody:s.body||null,requestMethod:s.method,serverError:p,url:r}))}let u=d.body;o&&d.statusCode===304?u=null:(d.statusCode<200||d.statusCode>=300)&&(c.cancel(),Zg.throwError("bad response",We.errors.SERVER_ERROR,{status:d.statusCode,headers:d.headers,body:u,requestBody:s.body||null,requestMethod:s.method,url:r})),c.cancel();let h=null;if(u!=null)try{h=JSON.parse(u)}catch(p){Zg.throwError("invalid JSON",We.errors.SERVER_ERROR,{body:u,error:p,requestBody:s.body||null,requestMethod:s.method,url:r})}if(t)try{h=yield t(h,d)}catch(p){Zg.throwError("processing response error",We.errors.SERVER_ERROR,{body:h,error:p,requestBody:s.body||null,requestMethod:s.method,url:r})}return h})}();return Promise.race([c.promise,g])}function kd(i,e){return e||(e={}),e=Ei(e),e.floor==null&&(e.floor=0),e.ceiling==null&&(e.ceiling=1e4),e.interval==null&&(e.interval=250),new Promise(function(t,n){let r=null,s=!1;const o=()=>s?!1:(s=!0,r&&clearTimeout(r),!0);e.timeout&&(r=setTimeout(()=>{o()&&n(new Error("timeout"))},e.timeout));const a=e.retryLimit;let l=0;function c(){return i().then(function(g){if(g!==void 0)o()&&t(g);else if(e.oncePoll)e.oncePoll.once("poll",c);else if(e.onceBlock)e.onceBlock.once("block",c);else if(!s){if(l++,l>a){o()&&n(new Error("retry limit reached"));return}let d=e.interval*parseInt(String(Math.random()*Math.pow(2,l)));d<e.floor&&(d=e.floor),d>e.ceiling&&(d=e.ceiling),setTimeout(c,d)}return null},function(g){o()&&n(g)})}c()})}const ps="providers/5.0.0-beta.171",K1=new We(ps);class Mt{constructor(){K1.checkNew(new.target,Mt),this.formats=this.getDefaultFormats()}getDefaultFormats(){const e={},t=this.address.bind(this),n=this.bigNumber.bind(this),r=this.blockTag.bind(this),s=this.data.bind(this),o=this.hash.bind(this),a=this.hex.bind(this),l=this.number.bind(this),c=g=>this.data(g,!0);return e.transaction={hash:o,blockHash:Mt.allowNull(o,null),blockNumber:Mt.allowNull(l,null),transactionIndex:Mt.allowNull(l,null),confirmations:Mt.allowNull(l,null),from:t,gasPrice:n,gasLimit:n,to:Mt.allowNull(t,null),value:n,nonce:l,data:s,r:Mt.allowNull(this.uint256),s:Mt.allowNull(this.uint256),v:Mt.allowNull(l),creates:Mt.allowNull(t,null),raw:Mt.allowNull(s)},e.transactionRequest={from:Mt.allowNull(t),nonce:Mt.allowNull(l),gasLimit:Mt.allowNull(n),gasPrice:Mt.allowNull(n),to:Mt.allowNull(t),value:Mt.allowNull(n),data:Mt.allowNull(c)},e.receiptLog={transactionIndex:l,blockNumber:l,transactionHash:o,address:t,topics:Mt.arrayOf(o),data:s,logIndex:l,blockHash:o},e.receipt={to:Mt.allowNull(this.address,null),from:Mt.allowNull(this.address,null),contractAddress:Mt.allowNull(t,null),transactionIndex:l,root:Mt.allowNull(o),gasUsed:n,logsBloom:Mt.allowNull(s),blockHash:o,transactionHash:o,logs:Mt.arrayOf(this.receiptLog.bind(this)),blockNumber:l,confirmations:Mt.allowNull(l,null),cumulativeGasUsed:n,status:Mt.allowNull(l)},e.block={hash:o,parentHash:o,number:l,timestamp:l,nonce:Mt.allowNull(a),difficulty:this.difficulty.bind(this),gasLimit:n,gasUsed:n,miner:t,extraData:s,transactions:Mt.allowNull(Mt.arrayOf(o))},e.blockWithTransactions=Ei(e.block),e.blockWithTransactions.transactions=Mt.allowNull(Mt.arrayOf(this.transactionResponse.bind(this))),e.filter={fromBlock:Mt.allowNull(r,void 0),toBlock:Mt.allowNull(r,void 0),blockHash:Mt.allowNull(o,void 0),address:Mt.allowNull(t,void 0),topics:Mt.allowNull(this.topics.bind(this),void 0)},e.filterLog={blockNumber:Mt.allowNull(l),blockHash:Mt.allowNull(o),transactionIndex:l,removed:Mt.allowNull(this.boolean.bind(this)),address:t,data:Mt.allowFalsish(s,"0x"),topics:Mt.arrayOf(o),transactionHash:o,logIndex:l},e}number(e){return ft.from(e).toNumber()}bigNumber(e){return ft.from(e)}boolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){if(e=e.toLowerCase(),e==="true")return!0;if(e==="false")return!1}throw new Error("invalid boolean - "+e)}hex(e,t){return typeof e=="string"&&(!t&&e.substring(0,2)!=="0x"&&(e="0x"+e),Qt(e))?e.toLowerCase():K1.throwArgumentError("invalid hash","value",e)}data(e,t){const n=this.hex(e,t);if(n.length%2!=0)throw new Error("invalid data; odd-length - "+e);return n}address(e){return Dn(e)}callAddress(e){if(!Qt(e,32))return null;const t=Dn(go(e,12));return t===oN?null:t}contractAddress(e){return WA(e)}blockTag(e){if(e==null)return"latest";if(e==="earliest")return"0x0";if(e==="latest"||e==="pending")return e;if(typeof e=="number"||Qt(e))return Bd(e);throw new Error("invalid blockTag")}hash(e,t){const n=this.hex(e,t);return Jl(n)!==32?K1.throwArgumentError("invalid hash","value",e):n}difficulty(e){if(e==null)return null;const t=ft.from(e);try{return t.toNumber()}catch{}return null}uint256(e){if(!Qt(e))throw new Error("invalid uint256");return Ji(e,32)}_block(e,t){return e.author!=null&&e.miner==null&&(e.miner=e.author),Mt.check(t,e)}block(e){return this._block(e,this.formats.block)}blockWithTransactions(e){return this._block(e,this.formats.blockWithTransactions)}transactionRequest(e){return Mt.check(this.formats.transactionRequest,e)}transactionResponse(e){e.gas!=null&&e.gasLimit==null&&(e.gasLimit=e.gas),e.to&&ft.from(e.to).isZero()&&(e.to="0x0000000000000000000000000000000000000000"),e.input!=null&&e.data==null&&(e.data=e.input),e.to==null&&e.creates==null&&(e.creates=this.contractAddress(e));const t=Mt.check(this.formats.transaction,e);if(e.chainId!=null){let n=e.chainId;Qt(n)&&(n=ft.from(n).toNumber()),t.chainId=n}else{let n=e.networkId;n==null&&t.v==null&&(n=e.chainId),Qt(n)&&(n=ft.from(n).toNumber()),typeof n!="number"&&t.v!=null&&(n=(t.v-35)/2,n<0&&(n=0),n=parseInt(n)),typeof n!="number"&&(n=0),t.chainId=n}return t.blockHash&&t.blockHash.replace(/0/g,"")==="x"&&(t.blockHash=null),t}transaction(e){return JN(e)}receiptLog(e){return Mt.check(this.formats.receiptLog,e)}receipt(e){const t=Mt.check(this.formats.receipt,e);return e.status!=null&&(t.byzantium=!0),t}topics(e){return Array.isArray(e)?e.map(t=>this.topics(t)):e!=null?this.hash(e,!0):null}filter(e){return Mt.check(this.formats.filter,e)}filterLog(e){return Mt.check(this.formats.filterLog,e)}static check(e,t){const n={};for(const r in e)try{const s=e[r](t[r]);s!==void 0&&(n[r]=s)}catch(s){throw s.checkKey=r,s.checkValue=t[r],s}return n}static allowNull(e,t){return function(n){return n==null?t:e(n)}}static allowFalsish(e,t){return function(n){return n?e(n):t}}static arrayOf(e){return function(t){if(!Array.isArray(t))throw new Error("not an array");const n=[];return t.forEach(function(r){n.push(e(r))}),n}}}var hn=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Fi=new We(ps);function yE(i){return i==null?"null":(Jl(i)!==32&&Fi.throwArgumentError("invalid topic","topic",i),i.toLowerCase())}function vE(i){for(i=i.slice();i.length>0&&i[i.length-1]==null;)i.pop();return i.map(e=>{if(Array.isArray(e)){const t={};e.forEach(r=>{t[yE(r)]=!0});const n=Object.keys(t);return n.sort(),n.join("|")}else return yE(e)}).join("&")}function qQ(i){return i===""?[]:i.split(/&/g).map(e=>{if(e==="")return[];const t=e.split("|").map(n=>n==="null"?null:n);return t.length===1?t[0]:t})}function Yd(i){if(typeof i=="string"){if(i=i.toLowerCase(),Jl(i)===32)return"tx:"+i;if(i.indexOf(":")===-1)return i}else{if(Array.isArray(i))return"filter:*:"+vE(i);if(HJ.isForkEvent(i))throw Fi.warn("not implemented"),new Error("not implemented");if(i&&typeof i=="object")return"filter:"+(i.address||"*")+":"+vE(i.topics||[])}throw new Error("invalid event - "+i)}function SC(){return new Date().getTime()}function $Q(i){return new Promise(e=>{setTimeout(e,i)})}const ej=["block","network","pending","poll"];class tj{constructor(e,t,n){ke(this,"tag",e),ke(this,"listener",t),ke(this,"once",n)}get event(){switch(this.type){case"tx":return this.hash;case"filter":return this.filter}return this.tag}get type(){return this.tag.split(":")[0]}get hash(){const e=this.tag.split(":");return e[0]!=="tx"?null:e[1]}get filter(){const e=this.tag.split(":");if(e[0]!=="filter")return null;const t=e[1],n=qQ(e[2]),r={};return n.length>0&&(r.topics=n),t&&t!=="*"&&(r.address=t),r}pollable(){return this.tag.indexOf(":")>=0||ej.indexOf(this.tag)>=0}}let P1=null,nj=1;class tb extends jl{constructor(e){Fi.checkNew(new.target,jl);super();if(this._events=[],this._emitted={block:-2},this.formatter=new.target.getFormatter(),ke(this,"anyNetwork",e==="any"),this.anyNetwork&&(e=this.detectNetwork()),e instanceof Promise)this._networkPromise=e,e.catch(t=>{}),this._ready();else{const t=hr(new.target,"getNetwork")(e);t?(ke(this,"_network",t),this.emit("network",t,null)):Fi.throwArgumentError("invalid network","network",e)}this._maxInternalBlockNumber=-1024,this._lastBlockNumber=-2,this._pollingInterval=4e3,this._fastQueryDate=0}_ready(){return hn(this,void 0,void 0,function*(){if(this._network==null){let e=null;if(this._networkPromise)try{e=yield this._networkPromise}catch{}e==null&&(e=yield this.detectNetwork()),e||Fi.throwError("no network detected",We.errors.UNKNOWN_ERROR,{}),this._network==null&&(this.anyNetwork?this._network=e:ke(this,"_network",e),this.emit("network",e,null))}return this._network})}get ready(){return this._ready()}static getFormatter(){return P1==null&&(P1=new Mt),P1}static getNetwork(e){return Y1(e==null?"homestead":e)}_getInternalBlockNumber(e){return hn(this,void 0,void 0,function*(){yield this.ready;const t=this._internalBlockNumber;if(e>0&&this._internalBlockNumber){const s=yield t;if(SC()-s.respTime<=e)return s.blockNumber}const n=SC(),r=ci({blockNumber:this.perform("getBlockNumber",{}),networkError:this.getNetwork().then(s=>null,s=>s)}).then(({blockNumber:s,networkError:o})=>{if(o)throw this._internalBlockNumber===r&&(this._internalBlockNumber=null),o;const a=SC();return s=ft.from(s).toNumber(),s<this._maxInternalBlockNumber&&(s=this._maxInternalBlockNumber),this._maxInternalBlockNumber=s,this._setFastBlockNumber(s),{blockNumber:s,reqTime:n,respTime:a}});return this._internalBlockNumber=r,(yield r).blockNumber})}poll(){return hn(this,void 0,void 0,function*(){const e=nj++,t=[],n=yield this._getInternalBlockNumber(100+this.pollingInterval/2);if(this._setFastBlockNumber(n),this.emit("poll",e,n),n===this._lastBlockNumber){this.emit("didPoll",e);return}if(this._emitted.block===-2&&(this._emitted.block=n-1),Math.abs(this._emitted.block-n)>1e3)Fi.warn("network block skew detected; skipping block events"),this.emit("error",Fi.makeError("network block skew detected",We.errors.NETWORK_ERROR,{blockNumber:n,previousBlockNumber:this._emitted.block})),this.emit("block",n);else for(let r=this._emitted.block+1;r<=n;r++)this.emit("block",r);return this._emitted.block!==n&&(this._emitted.block=n,Object.keys(this._emitted).forEach(r=>{if(r==="block")return;const s=this._emitted[r];s!=="pending"&&n-s>12&&delete this._emitted[r]})),this._lastBlockNumber===-2&&(this._lastBlockNumber=n-1),this._events.forEach(r=>{switch(r.type){case"tx":{const s=r.hash;let o=this.getTransactionReceipt(s).then(a=>(!a||a.blockNumber==null||(this._emitted["t:"+s]=a.blockNumber,this.emit(s,a)),null)).catch(a=>{this.emit("error",a)});t.push(o);break}case"filter":{const s=r.filter;s.fromBlock=this._lastBlockNumber+1,s.toBlock=n;const o=this.getLogs(s).then(a=>{a.length!==0&&a.forEach(l=>{this._emitted["b:"+l.blockHash]=l.blockNumber,this._emitted["t:"+l.transactionHash]=l.blockNumber,this.emit(s,l)})}).catch(a=>{this.emit("error",a)});t.push(o);break}}}),this._lastBlockNumber=n,Promise.all(t).then(()=>{this.emit("didPoll",e)}),null})}resetEventsBlock(e){this._lastBlockNumber=e-1,this.polling&&this.poll()}get network(){return this._network}detectNetwork(){return hn(this,void 0,void 0,function*(){return Fi.throwError("provider does not support network detection",We.errors.UNSUPPORTED_OPERATION,{operation:"provider.detectNetwork"})})}getNetwork(){return hn(this,void 0,void 0,function*(){const e=yield this.ready,t=yield this.detectNetwork();if(e.chainId!==t.chainId){if(this.anyNetwork)return this._network=t,this._lastBlockNumber=-2,this._fastBlockNumber=null,this._fastBlockNumberPromise=null,this._fastQueryDate=0,this._emitted.block=-2,this._maxInternalBlockNumber=-1024,this._internalBlockNumber=null,this.emit("network",t,e),yield $Q(0),this._network;const n=Fi.makeError("underlying network changed",We.errors.NETWORK_ERROR,{event:"changed",network:e,detectedNetwork:t});throw this.emit("error",n),n}return e})}get blockNumber(){return this._getInternalBlockNumber(100+this.pollingInterval/2).then(e=>{this._setFastBlockNumber(e)}),this._fastBlockNumber!=null?this._fastBlockNumber:-1}get polling(){return this._poller!=null}set polling(e){e&&!this._poller?(this._poller=setInterval(this.poll.bind(this),this.pollingInterval),this._bootstrapPoll||(this._bootstrapPoll=setTimeout(()=>{this.poll(),this._bootstrapPoll=setTimeout(()=>{this._poller||this.poll(),this._bootstrapPoll=null},this.pollingInterval)},0))):!e&&this._poller&&(clearInterval(this._poller),this._poller=null)}get pollingInterval(){return this._pollingInterval}set pollingInterval(e){if(typeof e!="number"||e<=0||parseInt(String(e))!=e)throw new Error("invalid polling interval");this._pollingInterval=e,this._poller&&(clearInterval(this._poller),this._poller=setInterval(()=>{this.poll()},this._pollingInterval))}_getFastBlockNumber(){const e=SC();return e-this._fastQueryDate>2*this._pollingInterval&&(this._fastQueryDate=e,this._fastBlockNumberPromise=this.getBlockNumber().then(t=>((this._fastBlockNumber==null||t>this._fastBlockNumber)&&(this._fastBlockNumber=t),this._fastBlockNumber))),this._fastBlockNumberPromise}_setFastBlockNumber(e){this._fastBlockNumber!=null&&e<this._fastBlockNumber||(this._fastQueryDate=SC(),(this._fastBlockNumber==null||e>this._fastBlockNumber)&&(this._fastBlockNumber=e,this._fastBlockNumberPromise=Promise.resolve(e)))}waitForTransaction(e,t,n){return hn(this,void 0,void 0,function*(){t==null&&(t=1);const r=yield this.getTransactionReceipt(e);return(r?r.confirmations:0)>=t?r:new Promise((s,o)=>{let a=null,l=!1;const c=g=>{g.confirmations<t||(a&&clearTimeout(a),!l&&(l=!0,this.removeListener(e,c),s(g)))};this.on(e,c),typeof n=="number"&&n>0&&(a=setTimeout(()=>{l||(a=null,l=!0,this.removeListener(e,c),o(Fi.makeError("timeout exceeded",We.errors.TIMEOUT,{timeout:n})))},n),a.unref&&a.unref())})})}getBlockNumber(){return hn(this,void 0,void 0,function*(){return this._getInternalBlockNumber(0)})}getGasPrice(){return hn(this,void 0,void 0,function*(){return yield this.getNetwork(),ft.from(yield this.perform("getGasPrice",{}))})}getBalance(e,t){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ci({address:this._getAddress(e),blockTag:this._getBlockTag(t)});return ft.from(yield this.perform("getBalance",n))})}getTransactionCount(e,t){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ci({address:this._getAddress(e),blockTag:this._getBlockTag(t)});return ft.from(yield this.perform("getTransactionCount",n)).toNumber()})}getCode(e,t){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ci({address:this._getAddress(e),blockTag:this._getBlockTag(t)});return at(yield this.perform("getCode",n))})}getStorageAt(e,t,n){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const r=yield ci({address:this._getAddress(e),blockTag:this._getBlockTag(n),position:Promise.resolve(t).then(s=>Bd(s))});return at(yield this.perform("getStorageAt",r))})}_wrapTransaction(e,t){if(t!=null&&Jl(t)!==32)throw new Error("invalid response - sendTransaction");const n=e;return t!=null&&e.hash!==t&&Fi.throwError("Transaction hash mismatch from Provider.sendTransaction.",We.errors.UNKNOWN_ERROR,{expectedHash:e.hash,returnedHash:t}),n.wait=r=>hn(this,void 0,void 0,function*(){r!==0&&(this._emitted["t:"+e.hash]="pending");const s=yield this.waitForTransaction(e.hash,r);return s==null&&r===0?null:(this._emitted["t:"+e.hash]=s.blockNumber,s.status===0&&Fi.throwError("transaction failed",We.errors.CALL_EXCEPTION,{transactionHash:e.hash,transaction:e,receipt:s}),s)}),n}sendTransaction(e){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const t=yield Promise.resolve(e).then(r=>at(r)),n=this.formatter.transaction(e);try{const r=yield this.perform("sendTransaction",{signedTransaction:t});return this._wrapTransaction(n,r)}catch(r){throw r.transaction=n,r.transactionHash=n.hash,r}})}_getTransactionRequest(e){return hn(this,void 0,void 0,function*(){const t=yield e,n={};return["from","to"].forEach(r=>{t[r]!=null&&(n[r]=Promise.resolve(t[r]).then(s=>s?this._getAddress(s):null))}),["gasLimit","gasPrice","value"].forEach(r=>{t[r]!=null&&(n[r]=Promise.resolve(t[r]).then(s=>s?ft.from(s):null))}),["data"].forEach(r=>{t[r]!=null&&(n[r]=Promise.resolve(t[r]).then(s=>s?at(s):null))}),this.formatter.transactionRequest(yield ci(n))})}_getFilter(e){return hn(this,void 0,void 0,function*(){e=yield e;const t={};return e.address!=null&&(t.address=this._getAddress(e.address)),["blockHash","topics"].forEach(n=>{e[n]!=null&&(t[n]=e[n])}),["fromBlock","toBlock"].forEach(n=>{e[n]!=null&&(t[n]=this._getBlockTag(e[n]))}),this.formatter.filter(yield ci(t))})}call(e,t){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ci({transaction:this._getTransactionRequest(e),blockTag:this._getBlockTag(t)});return at(yield this.perform("call",n))})}estimateGas(e){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const t=yield ci({transaction:this._getTransactionRequest(e)});return ft.from(yield this.perform("estimateGas",t))})}_getAddress(e){return hn(this,void 0,void 0,function*(){const t=yield this.resolveName(e);return t==null&&Fi.throwError("ENS name not configured",We.errors.UNSUPPORTED_OPERATION,{operation:`resolveName(${JSON.stringify(e)})`}),t})}_getBlock(e,t){return hn(this,void 0,void 0,function*(){yield this.getNetwork(),e=yield e;let n=-128;const r={includeTransactions:!!t};if(Qt(e,32))r.blockHash=e;else try{r.blockTag=this.formatter.blockTag(yield this._getBlockTag(e)),Qt(r.blockTag)&&(n=parseInt(r.blockTag.substring(2),16))}catch{Fi.throwArgumentError("invalid block hash or block tag","blockHashOrBlockTag",e)}return kd(()=>hn(this,void 0,void 0,function*(){const s=yield this.perform("getBlock",r);if(s==null)return r.blockHash!=null&&this._emitted["b:"+r.blockHash]==null||r.blockTag!=null&&n>this._emitted.block?null:void 0;if(t){let o=null;for(let a=0;a<s.transactions.length;a++){const l=s.transactions[a];if(l.blockNumber==null)l.confirmations=0;else if(l.confirmations==null){o==null&&(o=yield this._getInternalBlockNumber(100+2*this.pollingInterval));let c=o-l.blockNumber+1;c<=0&&(c=1),l.confirmations=c}}return this.formatter.blockWithTransactions(s)}return this.formatter.block(s)}),{oncePoll:this})})}getBlock(e){return this._getBlock(e,!1)}getBlockWithTransactions(e){return this._getBlock(e,!0)}getTransaction(e){return hn(this,void 0,void 0,function*(){yield this.getNetwork(),e=yield e;const t={transactionHash:this.formatter.hash(e,!0)};return kd(()=>hn(this,void 0,void 0,function*(){const n=yield this.perform("getTransaction",t);if(n==null)return this._emitted["t:"+e]==null?null:void 0;const r=this.formatter.transactionResponse(n);if(r.blockNumber==null)r.confirmations=0;else if(r.confirmations==null){let o=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-r.blockNumber+1;o<=0&&(o=1),r.confirmations=o}return this._wrapTransaction(r)}),{oncePoll:this})})}getTransactionReceipt(e){return hn(this,void 0,void 0,function*(){yield this.getNetwork(),e=yield e;const t={transactionHash:this.formatter.hash(e,!0)};return kd(()=>hn(this,void 0,void 0,function*(){const n=yield this.perform("getTransactionReceipt",t);if(n==null)return this._emitted["t:"+e]==null?null:void 0;if(n.blockHash==null)return;const r=this.formatter.receipt(n);if(r.blockNumber==null)r.confirmations=0;else if(r.confirmations==null){let o=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-r.blockNumber+1;o<=0&&(o=1),r.confirmations=o}return r}),{oncePoll:this})})}getLogs(e){return hn(this,void 0,void 0,function*(){yield this.getNetwork();const t=yield ci({filter:this._getFilter(e)}),n=yield this.perform("getLogs",t);return n.forEach(r=>{r.removed==null&&(r.removed=!1)}),Mt.arrayOf(this.formatter.filterLog.bind(this.formatter))(n)})}getEtherPrice(){return hn(this,void 0,void 0,function*(){return yield this.getNetwork(),this.perform("getEtherPrice",{})})}_getBlockTag(e){return hn(this,void 0,void 0,function*(){if(e=yield e,typeof e=="number"&&e<0){e%1&&Fi.throwArgumentError("invalid BlockTag","blockTag",e);let t=yield this._getInternalBlockNumber(100+2*this.pollingInterval);return t+=e,t<0&&(t=0),this.formatter.blockTag(t)}return this.formatter.blockTag(e)})}_getResolver(e){return hn(this,void 0,void 0,function*(){const t=yield this.getNetwork();t.ensAddress||Fi.throwError("network does not support ENS",We.errors.UNSUPPORTED_OPERATION,{operation:"ENS",network:t.name});const n={to:t.ensAddress,data:"0x0178b8bf"+NA(e).substring(2)};return this.formatter.callAddress(yield this.call(n))})}resolveName(e){return hn(this,void 0,void 0,function*(){e=yield e;try{return Promise.resolve(this.formatter.address(e))}catch(r){if(Qt(e))throw r}typeof e!="string"&&Fi.throwArgumentError("invalid ENS name","name",e);const t=yield this._getResolver(e);if(!t)return null;const n={to:t,data:"0x3b3b57de"+NA(e).substring(2)};return this.formatter.callAddress(yield this.call(n))})}lookupAddress(e){return hn(this,void 0,void 0,function*(){e=yield e,e=this.formatter.address(e);const t=e.substring(2).toLowerCase()+".addr.reverse",n=yield this._getResolver(t);if(!n)return null;let r=tt(yield this.call({to:n,data:"0x691f3431"+NA(t).substring(2)}));if(r.length<32||!ft.from(r.slice(0,32)).eq(32)||(r=r.slice(32),r.length<32))return null;const s=ft.from(r.slice(0,32)).toNumber();if(r=r.slice(32),s>r.length)return null;const o=_A(r.slice(0,s));return(yield this.resolveName(o))!=e?null:o})}perform(e,t){return Fi.throwError(e+" not implemented",We.errors.NOT_IMPLEMENTED,{operation:e})}_startEvent(e){this.polling=this._events.filter(t=>t.pollable()).length>0}_stopEvent(e){this.polling=this._events.filter(t=>t.pollable()).length>0}_addEventListener(e,t,n){const r=new tj(Yd(e),t,n);return this._events.push(r),this._startEvent(r),this}on(e,t){return this._addEventListener(e,t,!1)}once(e,t){return this._addEventListener(e,t,!0)}emit(e,...t){let n=!1,r=[],s=Yd(e);return this._events=this._events.filter(o=>o.tag!==s?!0:(setTimeout(()=>{o.listener.apply(this,t)},0),n=!0,o.once?(r.push(o),!1):!0)),r.forEach(o=>{this._stopEvent(o)}),n}listenerCount(e){if(!e)return this._events.length;let t=Yd(e);return this._events.filter(n=>n.tag===t).length}listeners(e){if(e==null)return this._events.map(n=>n.listener);let t=Yd(e);return this._events.filter(n=>n.tag===t).map(n=>n.listener)}off(e,t){if(t==null)return this.removeAllListeners(e);const n=[];let r=!1,s=Yd(e);return this._events=this._events.filter(o=>o.tag!==s||o.listener!=t||r?!0:(r=!0,n.push(o),!1)),n.forEach(o=>{this._stopEvent(o)}),this}removeAllListeners(e){let t=[];if(e==null)t=this._events,this._events=[];else{const n=Yd(e);this._events=this._events.filter(r=>r.tag!==n?!0:(t.push(r),!1))}return t.forEach(n=>{this._stopEvent(n)}),this}}var ij=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Ir=new We(ps);function xE(i){return new Promise(function(e){setTimeout(e,i)})}function rj(i){if(i.error){const e=new Error(i.error.message);throw e.code=i.error.code,e.data=i.error.data,e}return i.result}function ZC(i){return i&&i.toLowerCase()}const D1={};class RC extends ec{constructor(e,t,n){Ir.checkNew(new.target,RC);super();if(e!==D1)throw new Error("do not call the JsonRpcSigner constructor directly; use provider.getSigner");ke(this,"provider",t),n==null&&(n=0),typeof n=="string"?(ke(this,"_address",this.provider.formatter.address(n)),ke(this,"_index",null)):typeof n=="number"?(ke(this,"_index",n),ke(this,"_address",null)):Ir.throwArgumentError("invalid address or index","addressOrIndex",n)}connect(e){return Ir.throwError("cannot alter JSON-RPC Signer connection",We.errors.UNSUPPORTED_OPERATION,{operation:"connect"})}connectUnchecked(){return new sj(D1,this.provider,this._address||this._index)}getAddress(){return this._address?Promise.resolve(this._address):this.provider.send("eth_accounts",[]).then(e=>(e.length<=this._index&&Ir.throwError("unknown account #"+this._index,We.errors.UNSUPPORTED_OPERATION,{operation:"getAddress"}),this.provider.formatter.address(e[this._index])))}sendUncheckedTransaction(e){e=Ei(e);const t=this.getAddress().then(n=>(n&&(n=n.toLowerCase()),n));if(e.gasLimit==null){const n=Ei(e);n.from=t,e.gasLimit=this.provider.estimateGas(n)}return ci({tx:ci(e),sender:t}).then(({tx:n,sender:r})=>{n.from!=null?n.from.toLowerCase()!==r&&Ir.throwArgumentError("from address mismatch","transaction",e):n.from=r;const s=this.provider.constructor.hexlifyTransaction(n,{from:!0});return this.provider.send("eth_sendTransaction",[s]).then(o=>o,o=>{throw o.responseText&&(o.responseText.indexOf("insufficient funds")>=0&&Ir.throwError("insufficient funds",We.errors.INSUFFICIENT_FUNDS,{transaction:n}),o.responseText.indexOf("nonce too low")>=0&&Ir.throwError("nonce has already been used",We.errors.NONCE_EXPIRED,{transaction:n}),o.responseText.indexOf("replacement transaction underpriced")>=0&&Ir.throwError("replacement fee too low",We.errors.REPLACEMENT_UNDERPRICED,{transaction:n})),o})})}signTransaction(e){return Ir.throwError("signing transactions is unsupported",We.errors.UNSUPPORTED_OPERATION,{operation:"signTransaction"})}sendTransaction(e){return this.sendUncheckedTransaction(e).then(t=>kd(()=>this.provider.getTransaction(t).then(n=>{if(n!==null)return this.provider._wrapTransaction(n,t)}),{onceBlock:this.provider}).catch(n=>{throw n.transactionHash=t,n}))}signMessage(e){const t=typeof e=="string"?ji(e):e;return this.getAddress().then(n=>this.provider.send("eth_sign",[n.toLowerCase(),at(t)]))}unlock(e){const t=this.provider;return this.getAddress().then(function(n){return t.send("personal_unlockAccount",[n.toLowerCase(),e,null])})}}class sj extends RC{sendTransaction(e){return this.sendUncheckedTransaction(e).then(t=>({hash:t,nonce:null,gasLimit:null,gasPrice:null,data:null,value:null,chainId:null,confirmations:0,from:null,wait:n=>this.provider.waitForTransaction(t,n)}))}}const oj={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0};class Rg extends tb{constructor(e,t){Ir.checkNew(new.target,Rg);let n=t;n==null&&(n=new Promise((r,s)=>{setTimeout(()=>{this.detectNetwork().then(o=>{r(o)},o=>{s(o)})},0)}));super(n);e||(e=hr(this.constructor,"defaultUrl")()),typeof e=="string"?ke(this,"connection",Object.freeze({url:e})):ke(this,"connection",Object.freeze(Ei(e))),this._nextId=42}static defaultUrl(){return"http://localhost:8545"}detectNetwork(){return ij(this,void 0,void 0,function*(){yield xE(0);let e=null;try{e=yield this.send("eth_chainId",[])}catch{try{e=yield this.send("net_version",[])}catch{}}if(e!=null){const t=hr(this.constructor,"getNetwork");try{return t(ft.from(e).toNumber())}catch(n){return Ir.throwError("could not detect network",We.errors.NETWORK_ERROR,{chainId:e,serverError:n})}}return Ir.throwError("could not detect network",We.errors.NETWORK_ERROR)})}getSigner(e){return new RC(D1,this,e)}getUncheckedSigner(e){return this.getSigner(e).connectUnchecked()}listAccounts(){return this.send("eth_accounts",[]).then(e=>e.map(t=>this.formatter.address(t)))}send(e,t){const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return this.emit("debug",{action:"request",request:Ys(n),provider:this}),eb(this.connection,JSON.stringify(n),rj).then(r=>(this.emit("debug",{action:"response",request:n,response:r,provider:this}),r),r=>{throw this.emit("debug",{action:"response",error:r,request:n,provider:this}),r})}prepareRequest(e,t){switch(e){case"getBlockNumber":return["eth_blockNumber",[]];case"getGasPrice":return["eth_gasPrice",[]];case"getBalance":return["eth_getBalance",[ZC(t.address),t.blockTag]];case"getTransactionCount":return["eth_getTransactionCount",[ZC(t.address),t.blockTag]];case"getCode":return["eth_getCode",[ZC(t.address),t.blockTag]];case"getStorageAt":return["eth_getStorageAt",[ZC(t.address),t.position,t.blockTag]];case"sendTransaction":return["eth_sendRawTransaction",[t.signedTransaction]];case"getBlock":return t.blockTag?["eth_getBlockByNumber",[t.blockTag,!!t.includeTransactions]]:t.blockHash?["eth_getBlockByHash",[t.blockHash,!!t.includeTransactions]]:null;case"getTransaction":return["eth_getTransactionByHash",[t.transactionHash]];case"getTransactionReceipt":return["eth_getTransactionReceipt",[t.transactionHash]];case"call":{const n=hr(this.constructor,"hexlifyTransaction");return["eth_call",[n(t.transaction,{from:!0}),t.blockTag]]}case"estimateGas":{const n=hr(this.constructor,"hexlifyTransaction");return["eth_estimateGas",[n(t.transaction,{from:!0})]]}case"getLogs":return t.filter&&t.filter.address!=null&&(t.filter.address=ZC(t.filter.address)),["eth_getLogs",[t.filter]]}return null}perform(e,t){const n=this.prepareRequest(e,t);return n==null&&Ir.throwError(e+" not implemented",We.errors.NOT_IMPLEMENTED,{operation:e}),e==="sendTransaction"?this.send(n[0],n[1]).catch(r=>{throw r.responseText&&(r.responseText.indexOf("insufficient funds")>0&&Ir.throwError("insufficient funds",We.errors.INSUFFICIENT_FUNDS,{}),r.responseText.indexOf("nonce too low")>0&&Ir.throwError("nonce has already been used",We.errors.NONCE_EXPIRED,{}),r.responseText.indexOf("replacement transaction underpriced")>0&&Ir.throwError("replacement fee too low",We.errors.REPLACEMENT_UNDERPRICED,{})),r}):this.send(n[0],n[1])}_startEvent(e){e.tag==="pending"&&this._startPending(),super._startEvent(e)}_startPending(){if(this._pendingFilter!=null)return;const e=this,t=this.send("eth_newPendingTransactionFilter",[]);this._pendingFilter=t,t.then(function(n){function r(){e.send("eth_getFilterChanges",[n]).then(function(s){if(e._pendingFilter!=t)return null;let o=Promise.resolve();return s.forEach(function(a){e._emitted["t:"+a.toLowerCase()]="pending",o=o.then(function(){return e.getTransaction(a).then(function(l){return e.emit("pending",l),null})})}),o.then(function(){return xE(1e3)})}).then(function(){if(e._pendingFilter!=t){e.send("eth_uninstallFilter",[n]);return}return setTimeout(function(){r()},0),null}).catch(s=>{})}return r(),n}).catch(n=>{})}_stopEvent(e){e.tag==="pending"&&this.listenerCount("pending")===0&&(this._pendingFilter=null),super._stopEvent(e)}static hexlifyTransaction(e,t){const n=Ei(oj);if(t)for(const s in t)t[s]&&(n[s]=!0);i1(e,n);const r={};return["gasLimit","gasPrice","nonce","value"].forEach(function(s){if(e[s]==null)return;const o=Bd(e[s]);s==="gasLimit"&&(s="gas"),r[s]=o}),["from","to","data"].forEach(function(s){e[s]!=null&&(r[s]=at(e[s]))}),r}}var aj=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const nb=new We(ps);class Kd extends Rg{constructor(e,t){nb.checkAbstract(new.target,Kd),e=hr(new.target,"getNetwork")(e),t=hr(new.target,"getApiKey")(t);const n=hr(new.target,"getUrl")(e,t);super(n,e);typeof t=="string"?ke(this,"apiKey",t):t!=null&&Object.keys(t).forEach(r=>{ke(this,r,t[r])})}detectNetwork(){return aj(this,void 0,void 0,function*(){return this.network})}_startPending(){nb.warn("WARNING: API provider does not support pending filters")}getSigner(e){return nb.throwError("API provider does not support signing",We.errors.UNSUPPORTED_OPERATION,{operation:"getSigner"})}listAccounts(){return Promise.resolve([])}static getApiKey(e){return e}static getUrl(e,t){return nb.throwError("not implemented; sub-classes must override getUrl",We.errors.NOT_IMPLEMENTED,{operation:"getUrl"})}}const wE=new We(ps),lj="_gg7wSSi0KMBsdKnGVfHDueq6xMB9EkC";class GE extends Kd{static getApiKey(e){return e==null?lj:(e&&typeof e!="string"&&wE.throwArgumentError("invalid apiKey","apiKey",e),e)}static getUrl(e,t){let n=null;switch(e.name){case"homestead":n="eth-mainnet.alchemyapi.io/jsonrpc/";break;case"ropsten":n="eth-ropsten.alchemyapi.io/jsonrpc/";break;case"rinkeby":n="eth-rinkeby.alchemyapi.io/jsonrpc/";break;case"goerli":n="eth-goerli.alchemyapi.io/jsonrpc/";break;case"kovan":n="eth-kovan.alchemyapi.io/jsonrpc/";break;default:wE.throwArgumentError("unsupported network","network",arguments[0])}return"https://"+n+t}}var cj=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const BE=new We(ps);class SE extends Kd{static getApiKey(e){return e!=null&&BE.throwArgumentError("apiKey not supported for cloudflare","apiKey",e),null}static getUrl(e,t){let n=null;switch(e.name){case"homestead":n="https://cloudflare-eth.com/";break;default:BE.throwArgumentError("unsupported network","network",arguments[0])}return n}perform(e,t){const n=Object.create(null,{perform:{get:()=>super.perform}});return cj(this,void 0,void 0,function*(){return e==="getBlockNumber"?(yield n.perform.call(this,"getBlock",{blockTag:"latest"})).number:n.perform.call(this,e,t)})}}var U1=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Pd=new We(ps);function ZE(i){const e=[];for(let t in i){if(i[t]==null)continue;let n=at(i[t]);({gasLimit:!0,gasPrice:!0,nonce:!0,value:!0})[t]&&(n=Bd(n)),e.push(t+"="+n)}return e.join("&")}function ib(i){if(i.status==0&&(i.message==="No records found"||i.message==="No transactions found"))return i.result;if(i.status!=1||i.message!="OK"){const e=new Error("invalid response");throw e.result=JSON.stringify(i),e}return i.result}function O1(i){if(i.jsonrpc!="2.0"){const e=new Error("invalid response");throw e.result=JSON.stringify(i),e}if(i.error){const e=new Error(i.error.message||"unknown error");throw i.error.code&&(e.code=i.error.code),i.error.data&&(e.data=i.error.data),e}return i.result}function RE(i){if(i==="pending")throw new Error("pending not supported");return i==="latest"?i:parseInt(i.substring(2),16)}const gj="9D13ZE7XSBTJ94N9BNJ2MA33VMAY2YPIRB";class rb extends tb{constructor(e,t){Pd.checkNew(new.target,rb);super(e);let n="invalid";this.network&&(n=this.network.name);let r=null;switch(n){case"homestead":r="https://api.etherscan.io";break;case"ropsten":r="https://api-ropsten.etherscan.io";break;case"rinkeby":r="https://api-rinkeby.etherscan.io";break;case"kovan":r="https://api-kovan.etherscan.io";break;case"goerli":r="https://api-goerli.etherscan.io";break;default:throw new Error("unsupported network")}ke(this,"baseUrl",r),ke(this,"apiKey",t||gj)}detectNetwork(){return U1(this,void 0,void 0,function*(){return this.network})}perform(e,t){const n=Object.create(null,{perform:{get:()=>super.perform}});return U1(this,void 0,void 0,function*(){let r=this.baseUrl,s="";this.apiKey&&(s+="&apikey="+this.apiKey);const o=(a,l)=>U1(this,void 0,void 0,function*(){this.emit("debug",{action:"request",request:a,provider:this});const c=yield eb(a,null,l||O1);return this.emit("debug",{action:"response",request:a,response:Ys(c),provider:this}),c});switch(e){case"getBlockNumber":return r+="/api?module=proxy&action=eth_blockNumber"+s,o(r);case"getGasPrice":return r+="/api?module=proxy&action=eth_gasPrice"+s,o(r);case"getBalance":return r+="/api?module=account&action=balance&address="+t.address,r+="&tag="+t.blockTag+s,o(r,ib);case"getTransactionCount":return r+="/api?module=proxy&action=eth_getTransactionCount&address="+t.address,r+="&tag="+t.blockTag+s,o(r);case"getCode":return r+="/api?module=proxy&action=eth_getCode&address="+t.address,r+="&tag="+t.blockTag+s,o(r,O1);case"getStorageAt":return r+="/api?module=proxy&action=eth_getStorageAt&address="+t.address,r+="&position="+t.position,r+="&tag="+t.blockTag+s,o(r,O1);case"sendTransaction":return r+="/api?module=proxy&action=eth_sendRawTransaction&hex="+t.signedTransaction,r+=s,o(r).catch(a=>{throw a.responseText&&(a.responseText.toLowerCase().indexOf("insufficient funds")>=0&&Pd.throwError("insufficient funds",We.errors.INSUFFICIENT_FUNDS,{}),a.responseText.indexOf("same hash was already imported")>=0&&Pd.throwError("nonce has already been used",We.errors.NONCE_EXPIRED,{}),a.responseText.indexOf("another transaction with same nonce")>=0&&Pd.throwError("replacement fee too low",We.errors.REPLACEMENT_UNDERPRICED,{})),a});case"getBlock":if(t.blockTag)return r+="/api?module=proxy&action=eth_getBlockByNumber&tag="+t.blockTag,t.includeTransactions?r+="&boolean=true":r+="&boolean=false",r+=s,o(r);throw new Error("getBlock by blockHash not implemented");case"getTransaction":return r+="/api?module=proxy&action=eth_getTransactionByHash&txhash="+t.transactionHash,r+=s,o(r);case"getTransactionReceipt":return r+="/api?module=proxy&action=eth_getTransactionReceipt&txhash="+t.transactionHash,r+=s,o(r);case"call":{let a=ZE(t.transaction);if(a&&(a="&"+a),r+="/api?module=proxy&action=eth_call"+a,t.blockTag!=="latest")throw new Error("EtherscanProvider does not support blockTag for call");return r+=s,o(r)}case"estimateGas":{let a=ZE(t.transaction);return a&&(a="&"+a),r+="/api?module=proxy&action=eth_estimateGas&"+a,r+=s,o(r)}case"getLogs":{if(r+="/api?module=logs&action=getLogs",t.filter.fromBlock&&(r+="&fromBlock="+RE(t.filter.fromBlock)),t.filter.toBlock&&(r+="&toBlock="+RE(t.filter.toBlock)),t.filter.address&&(r+="&address="+t.filter.address),t.filter.topics&&t.filter.topics.length>0&&(t.filter.topics.length>1&&Pd.throwError("unsupported topic count",We.errors.UNSUPPORTED_OPERATION,{topics:t.filter.topics}),t.filter.topics.length===1)){const c=t.filter.topics[0];(typeof c!="string"||c.length!==66)&&Pd.throwError("unsupported topic format",We.errors.UNSUPPORTED_OPERATION,{topic0:c}),r+="&topic0="+c}r+=s;const a=yield o(r,ib);let l={};for(let c=0;c<a.length;c++){const g=a[c];if(g.blockHash==null){if(l[g.transactionHash]==null){const d=yield this.getTransaction(g.transactionHash);d&&(l[g.transactionHash]=d.blockHash)}g.blockHash=l[g.transactionHash]}}return a}case"getEtherPrice":return this.network.name!=="homestead"?0:(r+="/api?module=stats&action=ethprice",r+=s,parseFloat((yield o(r,ib)).ethusd))}return n.perform.call(this,e,t)})}getHistory(e,t,n){let r=this.baseUrl,s="";return this.apiKey&&(s+="&apikey="+this.apiKey),t==null&&(t=0),n==null&&(n=99999999),this.resolveName(e).then(o=>(r+="/api?module=account&action=txlist&address="+o,r+="&startblock="+t,r+="&endblock="+n,r+="&sort=asc"+s,this.emit("debug",{action:"request",request:r,provider:this}),eb(r,null,ib).then(a=>{this.emit("debug",{action:"response",request:r,response:Ys(a),provider:this});let l=[];return a.forEach(c=>{["contractAddress","to"].forEach(function(d){c[d]==""&&delete c[d]}),c.creates==null&&c.contractAddress!=null&&(c.creates=c.contractAddress);let g=this.formatter.transactionResponse(c);c.timeStamp&&(g.timestamp=parseInt(c.timeStamp)),l.push(g)}),l})))}}var sb=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Mg=new We(ps);function ob(){return new Date().getTime()}function ME(i){let e=null;for(let t=0;t<i.length;t++){const n=i[t];if(n==null)return null;e?e.name===n.name&&e.chainId===n.chainId&&(e.ensAddress===n.ensAddress||e.ensAddress==null&&n.ensAddress==null)||Mg.throwArgumentError("provider mismatch","networks",i):e=n}return e}function WE(i,e){i=i.slice().sort();const t=Math.floor(i.length/2);if(i.length%2)return i[t];const n=i[t-1],r=i[t];return e!=null&&Math.abs(n-r)>e?null:(n+r)/2}function Dd(i){if(i===null)return"null";if(typeof i=="number"||typeof i=="boolean")return JSON.stringify(i);if(typeof i=="string")return i;if(ft.isBigNumber(i))return i.toString();if(Array.isArray(i))return JSON.stringify(i.map(e=>Dd(e)));if(typeof i=="object"){const e=Object.keys(i);return e.sort(),"{"+e.map(t=>{let n=i[t];return typeof n=="function"?n="[function]":n=Dd(n),JSON.stringify(t)+":"+n}).join(",")+"}"}throw new Error("unknown value type: "+typeof i)}let uj=1;function _E(i){let e=null,t=null,n=new Promise(o=>{e=function(){t&&(clearTimeout(t),t=null),o()},t=setTimeout(e,i)});const r=o=>(n=n.then(o),n);function s(){return n}return{cancel:e,getPromise:s,wait:r}}function ab(i,e){const t={provider:i.provider,weight:i.weight};return i.start&&(t.start=i.start),e&&(t.duration=e-i.start),i.done&&(i.error?t.error=i.error:t.result=i.result||null),t}function dj(i,e){return function(t){const n={};t.forEach(s=>{const o=i(s.result);n[o]||(n[o]={count:0,result:s.result}),n[o].count++});const r=Object.keys(n);for(let s=0;s<r.length;s++){const o=n[r[s]];if(o.count>=e)return o.result}}}function hj(i,e,t){let n=Dd;switch(e){case"getBlockNumber":return function(r){const s=r.map(a=>a.result);let o=WE(r.map(a=>a.result),2);if(o!=null)return o=Math.ceil(o),s.indexOf(o+1)>=0&&o++,o>=i._highestBlockNumber&&(i._highestBlockNumber=o),i._highestBlockNumber};case"getGasPrice":return function(r){const s=r.map(o=>o.result);return s.sort(),s[Math.floor(s.length/2)]};case"getEtherPrice":return function(r){return WE(r.map(s=>s.result))};case"getBalance":case"getTransactionCount":case"getCode":case"getStorageAt":case"call":case"estimateGas":case"getLogs":break;case"getTransaction":case"getTransactionReceipt":n=function(r){return r==null?null:(r=Ei(r),r.confirmations=-1,Dd(r))};break;case"getBlock":t.includeTransactions?n=function(r){return r==null?null:(r=Ei(r),r.transactions=r.transactions.map(s=>(s=Ei(s),s.confirmations=-1,s)),Dd(r))}:n=function(r){return r==null?null:Dd(r)};break;default:throw new Error("unknown method: "+e)}return dj(n,i.quorum)}function MC(i,e){return sb(this,void 0,void 0,function*(){const t=i.provider;return t.blockNumber!=null&&t.blockNumber>=e||e===-1?t:kd(()=>new Promise((n,r)=>{setTimeout(function(){return t.blockNumber>=e?n(t):i.cancelled?n(null):n(void 0)},0)}),{oncePoll:t})})}function fj(i,e,t,n){return sb(this,void 0,void 0,function*(){let r=i.provider;switch(t){case"getBlockNumber":case"getGasPrice":return r[t]();case"getEtherPrice":if(r.getEtherPrice)return r.getEtherPrice();break;case"getBalance":case"getTransactionCount":case"getCode":return n.blockTag&&Qt(n.blockTag)&&(r=yield MC(i,e)),r[t](n.address,n.blockTag||"latest");case"getStorageAt":return n.blockTag&&Qt(n.blockTag)&&(r=yield MC(i,e)),r.getStorageAt(n.address,n.position,n.blockTag||"latest");case"getBlock":return n.blockTag&&Qt(n.blockTag)&&(r=yield MC(i,e)),r[n.includeTransactions?"getBlockWithTransactions":"getBlock"](n.blockTag||n.blockHash);case"call":case"estimateGas":return n.blockTag&&Qt(n.blockTag)&&(r=yield MC(i,e)),r[t](n.transaction);case"getTransaction":case"getTransactionReceipt":return r[t](n.transactionHash);case"getLogs":{let s=n.filter;return(s.fromBlock&&Qt(s.fromBlock)||s.toBlock&&Qt(s.toBlock))&&(r=yield MC(i,e)),r.getLogs(s)}}return Mg.throwError("unknown method error",We.errors.UNKNOWN_ERROR,{method:t,params:n})})}class lb extends tb{constructor(e,t){Mg.checkNew(new.target,lb),e.length===0&&Mg.throwArgumentError("missing providers","providers",e);const n=e.map((o,a)=>{if(jl.isProvider(o))return Object.freeze({provider:o,weight:1,stallTimeout:750,priority:1});const l=Ei(o);l.priority==null&&(l.priority=1),l.stallTimeout==null&&(l.stallTimeout=750),l.weight==null&&(l.weight=1);const c=l.weight;return(c%1||c>512||c<1)&&Mg.throwArgumentError("invalid weight; must be integer in [1, 512]",`providers[${a}].weight`,c),Object.freeze(l)}),r=n.reduce((o,a)=>o+a.weight,0);t==null?t=r/2:t>r&&Mg.throwArgumentError("quorum will always fail; larger than total weight","quorum",t);let s=ME(n.map(o=>o.provider.network));s==null&&(s=new Promise((o,a)=>{setTimeout(()=>{this.detectNetwork().then(o,a)},0)}));super(s);ke(this,"providerConfigs",Object.freeze(n)),ke(this,"quorum",t),this._highestBlockNumber=-1}detectNetwork(){return sb(this,void 0,void 0,function*(){const e=yield Promise.all(this.providerConfigs.map(t=>t.provider.getNetwork()));return ME(e)})}perform(e,t){return sb(this,void 0,void 0,function*(){if(e==="sendTransaction"){const l=yield Promise.all(this.providerConfigs.map(c=>c.provider.sendTransaction(t.signedTransaction).then(g=>g.hash,g=>g)));for(let c=0;c<l.length;c++){const g=l[c];if(typeof g=="string")return g}throw l[0]}this._highestBlockNumber===-1&&e!=="getBlockNumber"&&(yield this.getBlockNumber());const n=hj(this,e,t),r=tE(this.providerConfigs.map(Ei));r.sort((l,c)=>l.priority-c.priority);const s=this._highestBlockNumber;let o=0,a=!0;for(;;){const l=ob();let c=r.filter(u=>u.runner&&l-u.start<u.stallTimeout).reduce((u,h)=>u+h.weight,0);for(;c<this.quorum&&o<r.length;){const u=r[o++],h=uj++;u.start=ob(),u.staller=_E(u.stallTimeout),u.staller.wait(()=>{u.staller=null}),u.runner=fj(u,s,e,t).then(p=>{u.done=!0,u.result=p,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:h,backend:ab(u,ob()),request:{method:e,params:Ys(t)},provider:this})},p=>{u.done=!0,u.error=p,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:h,backend:ab(u,ob()),request:{method:e,params:Ys(t)},provider:this})}),this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:h,backend:ab(u,null),request:{method:e,params:Ys(t)},provider:this}),c+=u.weight}const g=[];r.forEach(u=>{u.done||!u.runner||(g.push(u.runner),u.staller&&g.push(u.staller.getPromise()))}),g.length&&(yield Promise.race(g));const d=r.filter(u=>u.done&&u.error==null);if(d.length>=this.quorum){const u=n(d);if(u!==void 0)return r.forEach(h=>{h.staller&&h.staller.cancel(),h.cancelled=!0}),u;a||(yield _E(100).getPromise()),a=!1}if(r.filter(u=>!u.done).length===0)break}return r.forEach(l=>{l.staller&&l.staller.cancel(),l.cancelled=!0}),Mg.throwError("failed to meet quorum",We.errors.SERVER_ERROR,{method:e,params:t,results:r.map(l=>ab(l)),provider:this})})}}var VE=null,J1=Vr(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.version="providers/5.0.0-beta.171"});bA(J1);J1.version;var Ij=Vr(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=null;try{if(t=WebSocket,t==null)throw new Error("inject please")}catch{var n=new xA.Logger(J1.version);t=function(){n.throwError("WebSockets not supported in this environment",xA.Logger.errors.UNSUPPORTED_OPERATION,{operation:"new WebSocket()"})}}i.exports=t}),Cj=bA(Ij),NE=window&&window.__awaiter||function(i,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(g){try{c(n.next(g))}catch(d){o(d)}}function l(g){try{c(n.throw(g))}catch(d){o(d)}}function c(g){g.done?s(g.value):r(g.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const cb=new We(ps);let pj=1;class EE extends Rg{constructor(e,t){t==="any"&&cb.throwError("WebSocketProvider does not support 'any' network yet",We.errors.UNSUPPORTED_OPERATION,{operation:"network:any"});super(e,t);this._pollingInterval=-1,ke(this,"_websocket",new Cj(this.connection.url)),ke(this,"_requests",{}),ke(this,"_subs",{}),ke(this,"_subIds",{}),this._wsReady=!1,this._websocket.onopen=()=>{this._wsReady=!0,Object.keys(this._requests).forEach(r=>{this._websocket.send(this._requests[r].payload)})},this._websocket.onmessage=r=>{const s=r.data,o=JSON.parse(s);if(o.id!=null){const a=String(o.id),l=this._requests[a];if(delete this._requests[a],o.result!==void 0)l.callback(null,o.result);else if(o.error){const c=new Error(o.error.message||"unknown error");ke(c,"code",o.error.code||null),ke(c,"response",s),l.callback(c,void 0)}else l.callback(new Error("unknown error"),void 0)}else if(o.method==="eth_subscription"){const a=this._subs[o.params.subscription];a&&a.processFunc(o.params.result)}else console.warn("this should not happen")};const n=setInterval(()=>{this.emit("poll")},1e3);n.unref&&n.unref()}get pollingInterval(){return 0}resetEventsBlock(e){cb.throwError("cannot reset events block on WebSocketProvider",We.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})}set pollingInterval(e){cb.throwError("cannot set polling interval on WebSocketProvider",We.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})}poll(){return NE(this,void 0,void 0,function*(){return null})}set polling(e){!e||cb.throwError("cannot set polling on WebSocketProvider",We.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})}send(e,t){const n=pj++;return new Promise((r,s)=>{function o(l,c){return l?s(l):r(c)}const a=JSON.stringify({method:e,params:t,id:n,jsonrpc:"2.0"});this._requests[String(n)]={callback:o,payload:a},this._wsReady&&this._websocket.send(a)})}static defaultUrl(){return"ws://localhost:8546"}_subscribe(e,t,n){return NE(this,void 0,void 0,function*(){let r=this._subIds[e];r==null&&(r=Promise.all(t).then(o=>this.send("eth_subscribe",o)),this._subIds[e]=r);const s=yield r;this._subs[s]={tag:e,processFunc:n}})}_startEvent(e){switch(e.type){case"block":this._subscribe("block",["newHeads"],t=>{const n=ft.from(t.number).toNumber();this._emitted.block=n,this.emit("block",n)});break;case"pending":this._subscribe("pending",["newPendingTransactions"],t=>{this.emit("pending",t)});break;case"filter":this._subscribe(e.tag,["logs",this._getFilter(e.filter)],t=>{t.removed==null&&(t.removed=!1),this.emit(e.filter,this.formatter.filterLog(t))});break;case"tx":{const t=n=>{const r=n.hash;this.getTransactionReceipt(r).then(s=>{!s||this.emit(r,s)})};t(e),this._subscribe("tx",["newHeads"],n=>{this._events.filter(r=>r.type==="tx").forEach(t)});break}case"debug":case"poll":case"willPoll":case"didPoll":case"error":break;default:console.log("unhandled:",e);break}}_stopEvent(e){let t=e.tag;if(e.type==="tx"){if(this._events.filter(r=>r.type==="tx").length)return;t="tx"}else if(this.listenerCount(e.event))return;const n=this._subIds[t];!n||(delete this._subIds[t],n.then(r=>{!this._subs[r]||(delete this._subs[r],this.send("eth_unsubscribe",[r]))}))}}const gb=new We(ps),HE="84842078b09946638c03157f83405213";class ub extends Kd{static getWebSocketProvider(e,t){const r=new ub(e,t).connection;r.password&&gb.throwError("INFURA WebSocket project secrets unsupported",We.errors.UNSUPPORTED_OPERATION,{operation:"InfuraProvider.getWebSocketProvider()"});const s=r.url.replace(/^http/i,"ws").replace("/v3/","/ws/v3/");return new EE(s,e)}static getApiKey(e){const t={apiKey:HE,projectId:HE,projectSecret:null};return e==null||(typeof e=="string"?t.projectId=e:e.projectSecret!=null?(typeof e.projectId!="string"&&gb.throwArgumentError("projectSecret requires a projectId","projectId",e.projectId),typeof e.projectSecret!="string"&&gb.throwArgumentError("invalid projectSecret","projectSecret","[REDACTED]"),t.projectId=e.projectId,t.projectSecret=e.projectSecret):e.projectId&&(t.projectId=e.projectId),t.apiKey=t.projectId),t}static getUrl(e,t){let n=null;switch(e.name){case"homestead":n="mainnet.infura.io";break;case"ropsten":n="ropsten.infura.io";break;case"rinkeby":n="rinkeby.infura.io";break;case"kovan":n="kovan.infura.io";break;case"goerli":n="goerli.infura.io";break;default:gb.throwError("unsupported network",We.errors.INVALID_ARGUMENT,{argument:"network",value:e})}const r={url:"https://"+n+"/v3/"+t.projectId};return t.projectSecret!=null&&(r.user="",r.password=t.projectSecret),r}}const Q1=new We(ps),mj="ETHERS_JS_SHARED";class FE extends Kd{static getApiKey(e){return e&&typeof e!="string"&&Q1.throwArgumentError("invalid apiKey","apiKey",e),e||mj}static getUrl(e,t){Q1.warn("NodeSmith will be discontinued on 2019-12-20; please migrate to another platform.");let n=null;switch(e.name){case"homestead":n="https://ethereum.api.nodesmith.io/v1/mainnet/jsonrpc";break;case"ropsten":n="https://ethereum.api.nodesmith.io/v1/ropsten/jsonrpc";break;case"rinkeby":n="https://ethereum.api.nodesmith.io/v1/rinkeby/jsonrpc";break;case"goerli":n="https://ethereum.api.nodesmith.io/v1/goerli/jsonrpc";break;case"kovan":n="https://ethereum.api.nodesmith.io/v1/kovan/jsonrpc";break;default:Q1.throwArgumentError("unsupported network","network",arguments[0])}return n+"?apiKey="+t}}const j1=new We(ps);let Aj=1;function LE(i,e){return function(t,n){t=="eth_sign"&&i.isMetaMask&&(t="personal_sign",n=[n[1],n[0]]);const r={method:t,params:n,id:Aj++,jsonrpc:"2.0"};return new Promise((s,o)=>{e(r,function(a,l){if(a)return o(a);if(l.error){const c=new Error(l.error.message);return c.code=l.error.code,c.data=l.error.data,o(c)}s(l.result)})})}}function bj(i){return function(e,t){return t==null&&(t=[]),e=="eth_sign"&&i.isMetaMask&&(e="personal_sign",t=[t[1],t[0]]),i.request({method:e,params:t})}}class db extends Rg{constructor(e,t){j1.checkNew(new.target,db),e==null&&j1.throwArgumentError("missing provider","provider",e);let n=null,r=null,s=null;typeof e=="function"?(n="unknown:",r=e):(n=e.host||e.path||"",!n&&e.isMetaMask&&(n="metamask"),s=e,e.request?(n===""&&(n="eip-1193:"),r=bj(e)):e.sendAsync?r=LE(e,e.sendAsync.bind(e)):e.send?r=LE(e,e.send.bind(e)):j1.throwArgumentError("unsupported provider","provider",e),n||(n="unknown:"));super(n,t);ke(this,"jsonRpcFetchFunc",r),ke(this,"provider",s)}send(e,t){return this.jsonRpcFetchFunc(e,t)}}const yj=new We(ps);function TE(i,e){i==null&&(i="homestead");const t=Y1(i);return(!t||!t._defaultProvider)&&yj.throwError("unsupported getDefaultProvider network",We.errors.NETWORK_ERROR,{operation:"getDefaultProvider",network:i}),t._defaultProvider({FallbackProvider:lb,AlchemyProvider:GE,CloudflareProvider:SE,EtherscanProvider:rb,InfuraProvider:ub,JsonRpcProvider:Rg,NodesmithProvider:FE,Web3Provider:db,IpcProvider:VE},e)}var vj=Object.freeze({Provider:jl,BaseProvider:tb,FallbackProvider:lb,AlchemyProvider:GE,CloudflareProvider:SE,EtherscanProvider:rb,InfuraProvider:ub,JsonRpcProvider:Rg,NodesmithProvider:FE,Web3Provider:db,WebSocketProvider:EE,IpcProvider:VE,JsonRpcSigner:RC,getDefaultProvider:TE,getNetwork:Y1,Formatter:Mt});const xj=new RegExp("^bytes([0-9]+)$"),wj=new RegExp("^(u?int)([0-9]*)$"),Gj=new RegExp("^(.*)\\[([0-9]*)\\]$"),Bj="0000000000000000000000000000000000000000000000000000000000000000";function XE(i,e,t){switch(i){case"address":return t?Gd(e,32):tt(e);case"string":return ji(e);case"bytes":return tt(e);case"bool":return e=e?"0x01":"0x00",t?Gd(e,32):tt(e)}let n=i.match(wj);if(n){let r=parseInt(n[2]||"256");if(r%8!=0||r===0||r>256)throw new Error("invalid number type - "+i);return t&&(r=256),e=ft.from(e).toTwos(r),Gd(e,r/8)}if(n=i.match(xj),n){const r=parseInt(n[1]);if(String(r)!=n[1]||r===0||r>32)throw new Error("invalid number type - "+i);if(tt(e).byteLength!==r)throw new Error("invalid value for "+i);return t?tt((e+Bj).substring(0,66)):e}if(n=i.match(Gj),n&&Array.isArray(e)){const r=n[1];if(parseInt(n[2]||String(e.length))!=e.length)throw new Error("invalid value for "+i);const o=[];return e.forEach(function(a){o.push(XE(r,a,!0))}),li(o)}throw new Error("unknown type - "+i)}function q1(i,e){if(i.length!=e.length)throw new Error("type/value count mismatch");const t=[];return i.forEach(function(n,r){t.push(XE(n,e[r]))}),at(li(t))}function Sj(i,e){return Gi(q1(i,e))}function Zj(i,e){return xg(q1(i,e))}const Rj="units/5.0.0-beta.133",Mj=new We(Rj),zE=["wei","kwei","mwei","gwei","szabo","finney","ether"];function Wj(i){const e=String(i).split(".");(e.length>2||!e[0].match(/^-?[0-9]*$/)||e[1]&&!e[1].match(/^[0-9]*$/)||i==="."||i==="-.")&&Mj.throwArgumentError("invalid value","value",i);let t=e[0],n="";for(t.substring(0,1)==="-"&&(n="-",t=t.substring(1));t.substring(0,1)==="0";)t=t.substring(1);t===""&&(t="0");let r="";e.length===2&&(r="."+(e[1]||"0"));const s=[];for(;t.length;)if(t.length<=3){s.unshift(t);break}else{const o=t.length-3;s.unshift(t.substring(o)),t=t.substring(0,o)}return n+s.join(",")+r}function kE(i,e){if(typeof e=="string"){const t=zE.indexOf(e);t!==-1&&(e=3*t)}return wA(i,e!=null?e:18)}function YE(i,e){if(typeof e=="string"){const t=zE.indexOf(e);t!==-1&&(e=3*t)}return Ko(i,e!=null?e:18)}function _j(i){return kE(i,18)}function Vj(i){return YE(i,18)}var Nj=Object.freeze({AbiCoder:VA,defaultAbiCoder:IN,Fragment:ka,EventFragment:Po,FunctionFragment:Uo,ParamType:Qi,FormatTypes:vn,checkResultErrors:U9,Logger:We,RLP:k7,fetchJson:eb,poll:kd,checkProperties:i1,deepCopy:Ys,defineReadOnly:ke,getStatic:hr,resolveProperties:ci,shallowCopy:Ei,arrayify:tt,concat:li,stripZeros:wd,zeroPad:Gd,isBytes:za,isBytesLike:sC,defaultPath:Td,HDNode:ns,SigningKey:Gg,Interface:hC,LogDescription:CN,TransactionDescription:pN,base64:UQ,hexlify:at,isHexString:Qt,hexStripZeros:q2,hexValue:Bd,hexZeroPad:Ji,hexDataLength:Jl,hexDataSlice:go,nameprep:I1,_toEscapedUtf8String:gJ,toUtf8Bytes:ji,toUtf8CodePoints:d1,toUtf8String:_A,Utf8ErrorFuncs:hN,formatBytes32String:uJ,parseBytes32String:dJ,hashMessage:p1,namehash:NA,isValidName:_J,id:_d,getAddress:Dn,getIcapAddress:U7,getContractAddress:WA,getCreate2Address:O7,isAddress:D7,formatEther:_j,parseEther:Vj,formatUnits:kE,parseUnits:YE,commify:Wj,computeHmac:AC,keccak256:Gi,ripemd160:zN,sha256:xg,sha512:D6,randomBytes:Xd,shuffled:tE,solidityPack:q1,solidityKeccak256:Sj,soliditySha256:Zj,splitSignature:Sd,joinSignature:$2,parseTransaction:JN,serializeTransaction:M1,getJsonWalletAddress:BQ,computeAddress:oc,recoverAddress:R1,computePublicKey:Z1,recoverPublicKey:ON,verifyMessage:KQ,mnemonicToEntropy:JA,entropyToMnemonic:QA,isValidMnemonic:vQ,mnemonicToSeed:eE,SupportedAlgorithm:v1,get UnicodeNormalizationForm(){return Jo},get Utf8ErrorReason(){return es},Indexed:EA});const KE="ethers/5.0.0-beta.192",Ej=new We(KE);var Hj=Object.freeze({Signer:ec,Wallet:lc,VoidSigner:fC,getDefaultProvider:TE,providers:vj,Contract:pC,ContractFactory:PJ,BigNumber:ft,FixedNumber:dr,constants:sJ,get errors(){return rC},logger:Ej,utils:Nj,wordlists:W1,version:KE,Wordlist:Fd});try{const i=window;i._ethers==null&&(i._ethers=Hj)}catch{}var PE={};function Us(i,e,t){return Math.min(Math.max(i,e),t)}function hb(i,e,t,n){return Math.floor((i*t+e*n)/(t+n))}function Cr(i){const e=Os(i);let t=Wg(i);return e===t&&(t=0),Math.random()*(e-t)+t}function pn(i){return typeof i=="number"?i:Cr(i)}function Wg(i){return typeof i=="number"?i:i.min}function Os(i){return typeof i=="number"?i:i.max}function zn(i,e){if(i===e||e===void 0&&typeof i=="number")return i;const t=Wg(i),n=Os(i);return e!==void 0?{min:Math.min(t,e),max:Math.max(n,e)}:zn(t,n)}function _g(i){const e=i.random,{enable:t,minimumValue:n}=typeof e=="boolean"?{enable:e,minimumValue:0}:e;return pn(t?zn(i.value,n):i.value)}function pr(i,e){const t=i.x-e.x,n=i.y-e.y;return{dx:t,dy:n,distance:Math.sqrt(t*t+n*n)}}function ui(i,e){return pr(i,e).distance}function DE(i){if(typeof i=="number")return i*Math.PI/180;switch(i){case"top":return-Math.PI/2;case"top-right":return-Math.PI/4;case"right":return 0;case"bottom-right":return Math.PI/4;case"bottom":return Math.PI/2;case"bottom-left":return 3*Math.PI/4;case"left":return Math.PI;case"top-left":return-3*Math.PI/4;case"none":default:return Math.random()*Math.PI*2}}function UE(i){const e=xn.origin;return e.length=1,e.angle=i,e}function $1(i,e,t,n){return xn.create(i.x*(t-n)/(t+n)+e.x*2*n/(t+n),i.y)}function eB(i,e){switch(e){case"ease-out-quad":return 1-(1-i)**2;case"ease-out-cubic":return 1-(1-i)**3;case"ease-out-quart":return 1-(1-i)**4;case"ease-out-quint":return 1-(1-i)**5;case"ease-out-expo":return i===1?1:1-Math.pow(2,-10*i);case"ease-out-sine":return Math.sin(i*Math.PI/2);case"ease-out-back":{const t=1.70158,n=t+1;return 1+n*Math.pow(i-1,3)+t*Math.pow(i-1,2)}case"ease-out-circ":return Math.sqrt(1-Math.pow(i-1,2));default:return i}}function OE(i,e,t,n,r,s){const o={bounced:!1};return e.min>=n.min&&e.min<=n.max&&e.max>=n.min&&e.max<=n.max&&(i.max>=t.min&&i.max<=(t.max+t.min)/2&&r>0||i.min<=t.max&&i.min>(t.max+t.min)/2&&r<0)&&(o.velocity=r*-s,o.bounced=!0),o}function JE(i,e){if(e instanceof Array){for(const t of e)if(i.matches(t))return!0;return!1}else return i.matches(e)}function cc(){return typeof window=="undefined"||!window||typeof window.document=="undefined"||!window.document}function QE(){return cc()?i=>setTimeout(i):i=>(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout)(i)}function jE(){return cc()?i=>clearTimeout(i):i=>(window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout)(i)}function bn(i,e){return i===e||e instanceof Array&&e.indexOf(i)>-1}async function tB(i){var e,t;try{await document.fonts.load(`${(e=i.weight)!==null&&e!==void 0?e:"400"} 36px '${(t=i.font)!==null&&t!==void 0?t:"Verdana"}'`)}catch{}}function qE(i){return Math.floor(Math.random()*i.length)}function $i(i,e,t=!0){const n=e!==void 0&&t?e%i.length:qE(i);return i[n]}function Ud(i,e,t,n){return $E(Od(i,t!=null?t:0),e,n)}function $E(i,e,t){let n=!0;return(!t||t==="bottom")&&(n=i.top<e.height),n&&(!t||t==="left")&&(n=i.right>0),n&&(!t||t==="right")&&(n=i.left<e.width),n&&(!t||t==="top")&&(n=i.bottom>0),n}function Od(i,e){return{bottom:i.y+e,left:i.x-e,right:i.x+e,top:i.y-e}}function Rn(i,...e){for(const t of e){if(t==null)continue;if(typeof t!="object"){i=t;continue}const n=Array.isArray(t);n&&(typeof i!="object"||!i||!Array.isArray(i))?i=[]:!n&&(typeof i!="object"||!i||Array.isArray(i))&&(i={});for(const r in t){if(r==="__proto__")continue;const o=t[r],a=typeof o=="object",l=i;l[r]=a&&Array.isArray(o)?o.map(c=>Rn(l[r],c)):Rn(l[r],o)}}return i}function fb(i,e){return e instanceof Array?!!e.find(t=>t.enable&&bn(i,t.mode)):bn(i,e.mode)}function Ib(i,e,t){if(e instanceof Array)for(const n of e){const r=n.mode;n.enable&&bn(i,r)&&nB(n,t)}else{const n=e.mode;e.enable&&bn(i,n)&&nB(e,t)}}function nB(i,e){const t=i.selectors;if(t instanceof Array)for(const n of t)e(n,i);else e(t,i)}function iB(i,e){if(!(!e||!i)){if(i instanceof Array)return i.find(t=>JE(e,t.selectors));if(JE(e,i.selectors))return i}}function Cb(i){return{position:i.getPosition(),radius:i.getRadius(),mass:i.getMass(),velocity:i.velocity,factor:xn.create(_g(i.options.bounce.horizontal),_g(i.options.bounce.vertical))}}function rB(i,e){const{x:t,y:n}=i.velocity.sub(e.velocity),[r,s]=[i.position,e.position],{dx:o,dy:a}=pr(s,r);if(t*o+n*a>=0){const l=-Math.atan2(a,o),c=i.mass,g=e.mass,d=i.velocity.rotate(l),u=e.velocity.rotate(l),h=$1(d,u,c,g),p=$1(u,d,c,g),b=h.rotate(-l),y=p.rotate(-l);i.velocity.x=b.x*i.factor.x,i.velocity.y=b.y*i.factor.y,e.velocity.x=y.x*e.factor.x,e.velocity.y=y.y*e.factor.y}}function eH(i,e){const t=i.getPosition(),n=i.getRadius(),r=Od(t,n),s=OE({min:r.left,max:r.right},{min:r.top,max:r.bottom},{min:e.left,max:e.right},{min:e.top,max:e.bottom},i.velocity.x,_g(i.options.bounce.horizontal));s.bounced&&(s.velocity!==void 0&&(i.velocity.x=s.velocity),s.position!==void 0&&(i.position.x=s.position));const o=OE({min:r.top,max:r.bottom},{min:r.left,max:r.right},{min:e.top,max:e.bottom},{min:e.left,max:e.right},i.velocity.y,_g(i.options.bounce.vertical));o.bounced&&(o.velocity!==void 0&&(i.velocity.y=o.velocity),o.position!==void 0&&(i.position.y=o.position))}function sB(i,e,t){let n=t;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?i+(e-i)*6*n:n<1/2?e:n<2/3?i+(e-i)*(2/3-n)*6:i}function tH(i){if(i.startsWith("rgb")){const t=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([\d.]+)\s*)?\)/i.exec(i);return t?{a:t.length>4?parseFloat(t[5]):1,b:parseInt(t[3],10),g:parseInt(t[2],10),r:parseInt(t[1],10)}:void 0}else if(i.startsWith("hsl")){const t=/hsla?\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.]+)\s*)?\)/i.exec(i);return t?rH({a:t.length>4?parseFloat(t[5]):1,h:parseInt(t[1],10),l:parseInt(t[3],10),s:parseInt(t[2],10)}):void 0}else if(i.startsWith("hsv")){const t=/hsva?\(\s*(\d+)°\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.]+)\s*)?\)/i.exec(i);return t?oH({a:t.length>4?parseFloat(t[5]):1,h:parseInt(t[1],10),s:parseInt(t[2],10),v:parseInt(t[3],10)}):void 0}else{const e=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,t=i.replace(e,(s,o,a,l,c)=>o+o+a+a+l+l+(c!==void 0?c+c:"")),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(t);return r?{a:r[4]!==void 0?parseInt(r[4],16)/255:1,b:parseInt(r[3],16),g:parseInt(r[2],16),r:parseInt(r[1],16)}:void 0}}function Nr(i,e,t=!0){var n,r,s;if(i===void 0)return;const o=typeof i=="string"?{value:i}:i;let a;if(typeof o.value=="string")o.value===Wt.randomColorValue?a=cB():a=iH(o.value);else if(o.value instanceof Array){const l=$i(o.value,e,t);a=Nr({value:l})}else{const l=o.value,c=(n=l.rgb)!==null&&n!==void 0?n:o.value;if(c.r!==void 0)a=c;else{const g=(r=l.hsl)!==null&&r!==void 0?r:o.value;if(g.h!==void 0&&g.l!==void 0)a=Jd(g);else{const d=(s=l.hsv)!==null&&s!==void 0?s:o.value;d.h!==void 0&&d.v!==void 0&&(a=lB(d))}}}return a}function Ka(i,e,t=!0){const n=Nr(i,e,t);return n!==void 0?oB(n):void 0}function oB(i){const e=i.r/255,t=i.g/255,n=i.b/255,r=Math.max(e,t,n),s=Math.min(e,t,n),o={h:0,l:(r+s)/2,s:0};return r!=s&&(o.s=o.l<.5?(r-s)/(r+s):(r-s)/(2-r-s),o.h=e===r?(t-n)/(r-s):o.h=t===r?2+(n-e)/(r-s):4+(e-t)/(r-s)),o.l*=100,o.s*=100,o.h*=60,o.h<0&&(o.h+=360),o}function nH(i){var e;return(e=tH(i))===null||e===void 0?void 0:e.a}function iH(i){return tH(i)}function Jd(i){const e={b:0,g:0,r:0},t={h:i.h/360,l:i.l/100,s:i.s/100};if(t.s===0)e.b=t.l,e.g=t.l,e.r=t.l;else{const n=t.l<.5?t.l*(1+t.s):t.l+t.s-t.l*t.s,r=2*t.l-n;e.r=sB(r,n,t.h+1/3),e.g=sB(r,n,t.h),e.b=sB(r,n,t.h-1/3)}return e.r=Math.floor(e.r*255),e.g=Math.floor(e.g*255),e.b=Math.floor(e.b*255),e}function rH(i){const e=Jd(i);return{a:i.a,b:e.b,g:e.g,r:e.r}}function sH(i){const e=i.l/100,t=i.s/100,n=e+t*Math.min(e,1-e),r=n?2*(1-e/n):0;return{h:i.h,s:r*100,v:n*100}}function Fj(i){const e=sH(i);return{a:i.a,h:e.h,s:e.s,v:e.v}}function aB(i){const e=i.v/100,t=i.s/100,n=e*(1-t/2),r=n===0||n===1?0:(e-n)/Math.min(n,1-n);return{h:i.h,l:n*100,s:r*100}}function Lj(i){const e=aB(i);return{a:i.a,h:e.h,l:e.l,s:e.s}}function lB(i){const e={b:0,g:0,r:0},t={h:i.h/60,s:i.s/100,v:i.v/100},n=t.v*t.s,r=n*(1-Math.abs(t.h%2-1));let s;if(t.h>=0&&t.h<=1?s={r:n,g:r,b:0}:t.h>1&&t.h<=2?s={r,g:n,b:0}:t.h>2&&t.h<=3?s={r:0,g:n,b:r}:t.h>3&&t.h<=4?s={r:0,g:r,b:n}:t.h>4&&t.h<=5?s={r,g:0,b:n}:t.h>5&&t.h<=6&&(s={r:n,g:0,b:r}),s){const o=t.v-n;e.r=Math.floor((s.r+o)*255),e.g=Math.floor((s.g+o)*255),e.b=Math.floor((s.b+o)*255)}return e}function oH(i){const e=lB(i);return{a:i.a,b:e.b,g:e.g,r:e.r}}function aH(i){const e={r:i.r/255,g:i.g/255,b:i.b/255},t=Math.max(e.r,e.g,e.b),n=Math.min(e.r,e.g,e.b),r=t,s=t-n;let o=0;r===e.r?o=60*((e.g-e.b)/s):r===e.g?o=60*(2+(e.b-e.r)/s):r===e.b&&(o=60*(4+(e.r-e.g)/s));const a=r?s/r:0;return{h:o,s:a*100,v:r*100}}function Tj(i){const e=aH(i);return{a:i.a,h:e.h,s:e.s,v:e.v}}function cB(i){const e=i!=null?i:0;return{b:Math.floor(Cr(zn(e,256))),g:Math.floor(Cr(zn(e,256))),r:Math.floor(Cr(zn(e,256)))}}function ms(i,e){return`rgba(${i.r}, ${i.g}, ${i.b}, ${e!=null?e:1})`}function Pa(i,e){return`hsla(${i.h}, ${i.s}%, ${i.l}%, ${e!=null?e:1})`}function Xj(i,e){return Pa(aB(i),e)}function pb(i,e,t,n){let r=i,s=e;return r.r===void 0&&(r=Jd(i)),s.r===void 0&&(s=Jd(e)),{b:hb(r.b,s.b,t,n),g:hb(r.g,s.g,t,n),r:hb(r.r,s.r,t,n)}}function mb(i,e,t){var n,r;if(t===Wt.randomColorValue)return cB();if(t==="mid"){const s=(n=i.getFillColor())!==null&&n!==void 0?n:i.getStrokeColor(),o=(r=e==null?void 0:e.getFillColor())!==null&&r!==void 0?r:e==null?void 0:e.getStrokeColor();if(s&&o&&e)return pb(s,o,i.getRadius(),e.getRadius());{const a=s!=null?s:o;if(a)return Jd(a)}}else return t}function gB(i,e,t){const n=typeof i=="string"?i:i.value;return n===Wt.randomColorValue?t?Nr({value:n}):e?Wt.randomColorValue:Wt.midColorValue:Nr({value:n})}function uB(i){return i!==void 0?{h:i.h.value,s:i.s.value,l:i.l.value}:void 0}function dB(i,e,t){const n={h:{enable:!1,value:i.h},s:{enable:!1,value:i.s},l:{enable:!1,value:i.l}};return e&&(hB(n.h,e.h,t),hB(n.s,e.s,t),hB(n.l,e.l,t)),n}function hB(i,e,t){if(i.enable=e.enable,i.enable){if(i.velocity=e.speed/100*t,e.sync)return;i.status=0,i.velocity*=Math.random(),i.value&&(i.value*=Math.random())}else i.velocity=0}function WC(i,e,t){i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.closePath()}function zj(i,e,t,n){i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineTo(n.x,n.y),i.closePath()}function lH(i,e,t){i.save(),i.fillStyle=t!=null?t:"rgba(0,0,0,0)",i.fillRect(0,0,e.width,e.height),i.restore()}function Ab(i,e){i.clearRect(0,0,e.width,e.height)}function cH(i,e,t,n,r,s,o,a,l,c,g,d){let u=!1;if(ui(t,n)<=r)WC(i,t,n),u=!0;else if(o){let h,p;const b={x:n.x-s.width,y:n.y},y=pr(t,b);if(y.distance<=r){const m=t.y-y.dy/y.dx*t.x;h={x:0,y:m},p={x:s.width,y:m}}else{const m={x:n.x,y:n.y-s.height},f=pr(t,m);if(f.distance<=r){const x=-(t.y-f.dy/f.dx*t.x)/(f.dy/f.dx);h={x,y:0},p={x,y:s.height}}else{const G={x:n.x-s.width,y:n.y-s.height},x=pr(t,G);if(x.distance<=r){const B=t.y-x.dy/x.dx*t.x;h={x:-B/(x.dy/x.dx),y:B},p={x:h.x+s.width,y:h.y+s.height}}}}h&&p&&(WC(i,t,h),WC(i,n,p),u=!0)}if(!!u){if(i.lineWidth=e,a&&(i.globalCompositeOperation=l),i.strokeStyle=ms(c,g),d.enable){const h=Nr(d.color);h&&(i.shadowBlur=d.blur,i.shadowColor=ms(h))}i.stroke()}}function gH(i,e,t,n,r,s,o,a){zj(i,e,t,n),r&&(i.globalCompositeOperation=s),i.fillStyle=ms(o,a),i.fill()}function uH(i,e,t,n,r){i.save(),WC(i,n,r),i.lineWidth=e,i.strokeStyle=t,i.stroke(),i.restore()}function dH(i,e,t,n){const r=Math.floor(t.getRadius()/e.getRadius()),s=e.getFillColor(),o=t.getFillColor();if(!s||!o)return;const a=e.getPosition(),l=t.getPosition(),c=pb(s,o,e.getRadius(),t.getRadius()),g=i.createLinearGradient(a.x,a.y,l.x,l.y);return g.addColorStop(0,Pa(s,n)),g.addColorStop(r>1?1:r,ms(c,n)),g.addColorStop(1,Pa(o,n)),g}function hH(i,e,t,n,r,s){i.save(),WC(i,t,n),i.strokeStyle=ms(r,s),i.lineWidth=e,i.stroke(),i.restore()}function fH(i,e,t,n,r,s,o,a,l,c,g,d){var u,h,p,b,y,m;const f=t.getPosition(),G=t.options.tilt,x=t.options.roll;if(e.save(),G.enable||x.enable){const z=x.enable&&t.roll,J=G.enable&&t.tilt,V=z&&(x.mode==="horizontal"||x.mode==="both"),I=z&&(x.mode==="vertical"||x.mode==="both");e.setTransform(V?Math.cos(t.roll.angle):1,J?Math.cos(t.tilt.value)*t.tilt.cosDirection:0,J?Math.sin(t.tilt.value)*t.tilt.sinDirection:0,I?Math.sin(t.roll.angle):1,f.x,f.y)}else e.translate(f.x,f.y);e.beginPath();const B=((h=(u=t.rotate)===null||u===void 0?void 0:u.value)!==null&&h!==void 0?h:0)+(t.options.rotate.path?t.velocity.angle:0);B!==0&&e.rotate(B),o&&(e.globalCompositeOperation=a);const M=t.shadowColor;if(g.enable&&M&&(e.shadowBlur=g.blur,e.shadowColor=ms(M),e.shadowOffsetX=g.offset.x,e.shadowOffsetY=g.offset.y),d){const z=d.angle.value,J=d.type==="radial"?e.createRadialGradient(0,0,0,0,0,l):e.createLinearGradient(Math.cos(z)*-l,Math.sin(z)*-l,Math.cos(z)*l,Math.sin(z)*l);for(const V of d.colors)J.addColorStop(V.stop,Pa({h:V.value.h.value,s:V.value.s.value,l:V.value.l.value},(b=(p=V.opacity)===null||p===void 0?void 0:p.value)!==null&&b!==void 0?b:c));e.fillStyle=J}else r&&(e.fillStyle=r);const E=t.stroke;e.lineWidth=(y=t.strokeWidth)!==null&&y!==void 0?y:0,s&&(e.strokeStyle=s),IH(i,e,t,l,c,n),((m=E==null?void 0:E.width)!==null&&m!==void 0?m:0)>0&&e.stroke(),t.close&&e.closePath(),t.fill&&e.fill(),e.restore(),e.save(),G.enable&&t.tilt?e.setTransform(1,Math.cos(t.tilt.value)*t.tilt.cosDirection,Math.sin(t.tilt.value)*t.tilt.sinDirection,1,f.x,f.y):e.translate(f.x,f.y),B!==0&&e.rotate(B),o&&(e.globalCompositeOperation=a),CH(i,e,t,l,c,n),e.restore()}function IH(i,e,t,n,r,s){if(!t.shape)return;const o=i.drawers.get(t.shape);!o||o.draw(e,t,n,r,s,i.retina.pixelRatio)}function CH(i,e,t,n,r,s){if(!t.shape)return;const o=i.drawers.get(t.shape);!(o==null?void 0:o.afterEffect)||o.afterEffect(e,t,n,r,s,i.retina.pixelRatio)}function pH(i,e,t){!e.draw||(i.save(),e.draw(i,t),i.restore())}function mH(i,e,t,n){e.drawParticle!==void 0&&(i.save(),e.drawParticle(i,t,n),i.restore())}function kj(i,e,t,n,r,s,o,a,l){const c=e.getPosition();if(t&&(i.strokeStyle=Pa(t,r)),s===0)return;i.lineWidth=s;const g=o*Math.PI/180;i.beginPath(),i.ellipse(c.x,c.y,n/2,n*2,g,a,l),i.stroke()}function AH(i,e,t){return{h:i.h,s:i.s,l:i.l+(e==="darken"?-1:1)*t}}class fB{constructor(e,t){this.position={x:e,y:t}}}class is extends fB{constructor(e,t,n){super(e,t);this.radius=n}contains(e){return ui(e,this.position)<=this.radius}intersects(e){const t=e,n=e,r=this.position,s=e.position,o=Math.abs(s.x-r.x),a=Math.abs(s.y-r.y),l=this.radius;if(n.radius!==void 0){const c=l+n.radius,g=Math.sqrt(o*o+a+a);return c>g}else if(t.size!==void 0){const c=t.size.width,g=t.size.height,d=Math.pow(o-c,2)+Math.pow(a-g,2);return o>l+c||a>l+g?!1:o<=c||a<=g?!0:d<=l*l}return!1}}class As extends fB{constructor(e,t,n,r){super(e,t);this.size={height:r,width:n}}contains(e){const t=this.size.width,n=this.size.height,r=this.position;return e.x>=r.x&&e.x<=r.x+t&&e.y>=r.y&&e.y<=r.y+n}intersects(e){const t=e,n=e,r=this.size.width,s=this.size.height,o=this.position,a=e.position;if(n.radius!==void 0)return n.intersects(this);if(t.size!==void 0){const l=t.size,c=l.width,g=l.height;return a.x<o.x+r&&a.x+c>o.x&&a.y<o.y+s&&a.y+g>o.y}return!1}}class IB extends is{constructor(e,t,n,r){super(e,t,n);this.canvasSize=r,this.canvasSize={height:r.height,width:r.width}}contains(e){if(super.contains(e))return!0;const t={x:e.x-this.canvasSize.width,y:e.y};if(super.contains(t))return!0;const n={x:e.x-this.canvasSize.width,y:e.y-this.canvasSize.height};if(super.contains(n))return!0;const r={x:e.x,y:e.y-this.canvasSize.height};return super.contains(r)}intersects(e){if(super.intersects(e))return!0;const t=e,n=e,r={x:e.position.x-this.canvasSize.width,y:e.position.y-this.canvasSize.height};if(n.radius!==void 0){const s=new is(r.x,r.y,n.radius*2);return super.intersects(s)}else if(t.size!==void 0){const s=new As(r.x,r.y,t.size.width*2,t.size.height*2);return super.intersects(s)}return!1}}class Wt{}Wt.generatedAttribute="generated";Wt.randomColorValue="random";Wt.midColorValue="mid";Wt.touchEndEvent="touchend";Wt.mouseDownEvent="mousedown";Wt.mouseUpEvent="mouseup";Wt.mouseMoveEvent="mousemove";Wt.touchStartEvent="touchstart";Wt.touchMoveEvent="touchmove";Wt.mouseLeaveEvent="mouseleave";Wt.mouseOutEvent="mouseout";Wt.touchCancelEvent="touchcancel";Wt.resizeEvent="resize";Wt.visibilityChangeEvent="visibilitychange";Wt.noPolygonDataLoaded="No polygon data loaded.";Wt.noPolygonFound="No polygon found, you need to specify SVG url in config.";function Js(i,e,t,n,r){if(n){let s={passive:!0};typeof r=="boolean"?s.capture=r:r!==void 0&&(s=r),i.addEventListener(e,t,s)}else{const s=r;i.removeEventListener(e,t,s)}}class bH{constructor(e){this.container=e,this.canPush=!0,this.mouseMoveHandler=t=>this.mouseTouchMove(t),this.touchStartHandler=t=>this.mouseTouchMove(t),this.touchMoveHandler=t=>this.mouseTouchMove(t),this.touchEndHandler=()=>this.mouseTouchFinish(),this.mouseLeaveHandler=()=>this.mouseTouchFinish(),this.touchCancelHandler=()=>this.mouseTouchFinish(),this.touchEndClickHandler=t=>this.mouseTouchClick(t),this.mouseUpHandler=t=>this.mouseTouchClick(t),this.mouseDownHandler=()=>this.mouseDown(),this.visibilityChangeHandler=()=>this.handleVisibilityChange(),this.themeChangeHandler=t=>this.handleThemeChange(t),this.oldThemeChangeHandler=t=>this.handleThemeChange(t),this.resizeHandler=()=>this.handleWindowResize()}addListeners(){this.manageListeners(!0)}removeListeners(){this.manageListeners(!1)}manageListeners(e){var t;const n=this.container,r=n.actualOptions,s=r.interactivity.detectsOn;let o=Wt.mouseLeaveEvent;if(s==="window")n.interactivity.element=window,o=Wt.mouseOutEvent;else if(s==="parent"&&n.canvas.element){const g=n.canvas.element;n.interactivity.element=(t=g.parentElement)!==null&&t!==void 0?t:g.parentNode}else n.interactivity.element=n.canvas.element;const a=!cc()&&typeof matchMedia!="undefined"&&matchMedia("(prefers-color-scheme: dark)");a&&(a.addEventListener!==void 0?Js(a,"change",this.themeChangeHandler,e):a.addListener!==void 0&&(e?a.addListener(this.oldThemeChangeHandler):a.removeListener(this.oldThemeChangeHandler)));const l=n.interactivity.element;if(!l)return;const c=l;(r.interactivity.events.onHover.enable||r.interactivity.events.onClick.enable)&&(Js(l,Wt.mouseMoveEvent,this.mouseMoveHandler,e),Js(l,Wt.touchStartEvent,this.touchStartHandler,e),Js(l,Wt.touchMoveEvent,this.touchMoveHandler,e),r.interactivity.events.onClick.enable?(Js(l,Wt.touchEndEvent,this.touchEndClickHandler,e),Js(l,Wt.mouseUpEvent,this.mouseUpHandler,e),Js(l,Wt.mouseDownEvent,this.mouseDownHandler,e)):Js(l,Wt.touchEndEvent,this.touchEndHandler,e),Js(l,o,this.mouseLeaveHandler,e),Js(l,Wt.touchCancelEvent,this.touchCancelHandler,e)),n.canvas.element&&(n.canvas.element.style.pointerEvents=c===n.canvas.element?"initial":"none"),r.interactivity.events.resize&&(typeof ResizeObserver!="undefined"?this.resizeObserver&&!e?(n.canvas.element&&this.resizeObserver.unobserve(n.canvas.element),this.resizeObserver.disconnect(),delete this.resizeObserver):!this.resizeObserver&&e&&n.canvas.element&&(this.resizeObserver=new ResizeObserver(g=>{!g.find(u=>u.target===n.canvas.element)||this.handleWindowResize()}),this.resizeObserver.observe(n.canvas.element)):Js(window,Wt.resizeEvent,this.resizeHandler,e)),document&&Js(document,Wt.visibilityChangeEvent,this.visibilityChangeHandler,e,!1)}handleWindowResize(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),delete this.resizeTimeout),this.resizeTimeout=setTimeout(async()=>{var e;return await((e=this.container.canvas)===null||e===void 0?void 0:e.windowResize())},500)}handleVisibilityChange(){const e=this.container,t=e.actualOptions;this.mouseTouchFinish(),!!t.pauseOnBlur&&((document==null?void 0:document.hidden)?(e.pageHidden=!0,e.pause()):(e.pageHidden=!1,e.getAnimationStatus()?e.play(!0):e.draw(!0)))}mouseDown(){const e=this.container.interactivity;if(e){const t=e.mouse;t.clicking=!0,t.downPosition=t.position}}mouseTouchMove(e){var t,n,r,s,o,a,l;const c=this.container,g=c.actualOptions;if(((t=c.interactivity)===null||t===void 0?void 0:t.element)===void 0)return;c.interactivity.mouse.inside=!0;let d;const u=c.canvas.element;if(e.type.startsWith("mouse")){this.canPush=!0;const p=e;if(c.interactivity.element===window){if(u){const b=u.getBoundingClientRect();d={x:p.clientX-b.left,y:p.clientY-b.top}}}else if(g.interactivity.detectsOn==="parent"){const b=p.target,y=p.currentTarget,m=c.canvas.element;if(b&&y&&m){const f=b.getBoundingClientRect(),G=y.getBoundingClientRect(),x=m.getBoundingClientRect();d={x:p.offsetX+2*f.left-(G.left+x.left),y:p.offsetY+2*f.top-(G.top+x.top)}}else d={x:(n=p.offsetX)!==null&&n!==void 0?n:p.clientX,y:(r=p.offsetY)!==null&&r!==void 0?r:p.clientY}}else p.target===c.canvas.element&&(d={x:(s=p.offsetX)!==null&&s!==void 0?s:p.clientX,y:(o=p.offsetY)!==null&&o!==void 0?o:p.clientY})}else{this.canPush=e.type!=="touchmove";const p=e,b=p.touches[p.touches.length-1],y=u==null?void 0:u.getBoundingClientRect();d={x:b.clientX-((a=y==null?void 0:y.left)!==null&&a!==void 0?a:0),y:b.clientY-((l=y==null?void 0:y.top)!==null&&l!==void 0?l:0)}}const h=c.retina.pixelRatio;d&&(d.x*=h,d.y*=h),c.interactivity.mouse.position=d,c.interactivity.status=Wt.mouseMoveEvent}mouseTouchFinish(){const e=this.container.interactivity;if(e===void 0)return;const t=e.mouse;delete t.position,delete t.clickPosition,delete t.downPosition,e.status=Wt.mouseLeaveEvent,t.inside=!1,t.clicking=!1}mouseTouchClick(e){const t=this.container,n=t.actualOptions,r=t.interactivity.mouse;r.inside=!0;let s=!1;const o=r.position;if(!(o===void 0||!n.interactivity.events.onClick.enable)){for(const[,a]of t.plugins)if(a.clickPositionValid!==void 0&&(s=a.clickPositionValid(o),s))break;s||this.doMouseTouchClick(e),r.clicking=!1}}doMouseTouchClick(e){const t=this.container,n=t.actualOptions;if(this.canPush){const r=t.interactivity.mouse.position;if(r)t.interactivity.mouse.clickPosition={x:r.x,y:r.y};else return;t.interactivity.mouse.clickTime=new Date().getTime();const s=n.interactivity.events.onClick;if(s.mode instanceof Array)for(const o of s.mode)this.handleClickMode(o);else this.handleClickMode(s.mode)}e.type==="touchend"&&setTimeout(()=>this.mouseTouchFinish(),500)}handleThemeChange(e){const n=e.matches?this.container.options.defaultDarkTheme:this.container.options.defaultLightTheme,r=this.container.options.themes.find(s=>s.name===n);r&&r.default.auto&&this.container.loadTheme(n)}handleClickMode(e){const t=this.container,n=t.actualOptions,r=n.interactivity.modes.push.quantity,s=n.interactivity.modes.remove.quantity;switch(e){case"push":{if(r>0){const o=n.interactivity.modes.push,a=$i([void 0,...o.groups]),l=a!==void 0?t.actualOptions.particles.groups[a]:void 0;t.particles.push(r,t.interactivity.mouse,l,a)}break}case"remove":t.particles.removeQuantity(s);break;case"bubble":t.bubble.clicking=!0;break;case"repulse":t.repulse.clicking=!0,t.repulse.count=0;for(const o of t.repulse.particles)o.velocity.setTo(o.initialVelocity);t.repulse.particles=[],t.repulse.finish=!1,setTimeout(()=>{t.destroyed||(t.repulse.clicking=!1)},n.interactivity.modes.repulse.duration*1e3);break;case"attract":t.attract.clicking=!0,t.attract.count=0;for(const o of t.attract.particles)o.velocity.setTo(o.initialVelocity);t.attract.particles=[],t.attract.finish=!1,setTimeout(()=>{t.destroyed||(t.attract.clicking=!1)},n.interactivity.modes.attract.duration*1e3);break;case"pause":t.getAnimationStatus()?t.pause():t.play();break}for(const[,o]of t.plugins)o.handleClickMode&&o.handleClickMode(e)}}class gc{constructor(e){this.container=e,this.type=0}}class yH{constructor(e){this.container=e}async nextFrame(e){var t;try{const n=this.container;if(n.lastFrameTime!==void 0&&e<n.lastFrameTime+1e3/n.fpsLimit){n.draw(!1);return}(t=n.lastFrameTime)!==null&&t!==void 0||(n.lastFrameTime=e);const r=e-n.lastFrameTime,s={value:r,factor:60*r/1e3};if(n.lifeTime+=s.value,n.lastFrameTime=e,r>1e3){n.draw(!1);return}if(await n.particles.draw(s),n.duration>0&&n.lifeTime>n.duration){n.destroy();return}n.getAnimationStatus()&&n.draw(!1)}catch(n){console.error("tsParticles error in animation loop",n)}}}var Yj=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Kj=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},bb;class vH{constructor(e,t){this.container=t,bb.set(this,void 0),Yj(this,bb,e,"f"),this.externalInteractors=[],this.particleInteractors=[],this.init()}init(){const e=Kj(this,bb,"f").plugins.getInteractors(this.container,!0);this.externalInteractors=[],this.particleInteractors=[];for(const t of e)switch(t.type){case 0:this.externalInteractors.push(t);break;case 1:this.particleInteractors.push(t);break}}async externalInteract(e){for(const t of this.externalInteractors)t.isEnabled()&&await t.interact(e)}async particlesInteract(e,t){for(const n of this.externalInteractors)n.reset(e);for(const n of this.particleInteractors)n.isEnabled(e)&&await n.interact(e,t)}}bb=new WeakMap;class yb{constructor(e){this.container=e,this.type=1}}function Pj(i){const e=i.initialPosition,{dx:t,dy:n}=pr(e,i.position),r=Math.abs(t),s=Math.abs(n),o=i.retina.maxDistance.horizontal,a=i.retina.maxDistance.vertical;if(!(!o&&!a)){if((o&&r>=o||a&&s>=a)&&!i.misplaced)i.misplaced=!!o&&r>o||!!a&&s>a,o&&(i.velocity.x=i.velocity.y/2-i.velocity.x),a&&(i.velocity.y=i.velocity.x/2-i.velocity.y);else if((!o||r<o)&&(!a||s<a)&&i.misplaced)i.misplaced=!1;else if(i.misplaced){const l=i.position,c=i.velocity;o&&(l.x<e.x&&c.x<0||l.x>e.x&&c.x>0)&&(c.x*=-Math.random()),a&&(l.y<e.y&&c.y<0||l.y>e.y&&c.y>0)&&(c.y*=-Math.random())}}}class xH{constructor(e){this.container=e}move(e,t){e.destroyed||(this.moveParticle(e,t),this.moveParallax(e))}moveParticle(e,t){var n,r,s,o,a;const l=e.options,c=l.move;if(!c.enable)return;const g=this.container,d=this.getProximitySpeedFactor(e),u=((n=(o=e.retina).moveSpeed)!==null&&n!==void 0?n:o.moveSpeed=pn(c.speed)*g.retina.pixelRatio)*g.retina.reduceFactor,h=(r=(a=e.retina).moveDrift)!==null&&r!==void 0?r:a.moveDrift=pn(e.options.move.drift)*g.retina.pixelRatio,p=Os(l.size.value)*g.retina.pixelRatio,b=c.size?e.getRadius()/p:1,y=2,m=b*d*(t.factor||1)/y,f=u*m;this.applyPath(e,t);const G=c.gravity,x=G.enable&&G.inverse?-1:1;G.enable&&f&&(e.velocity.y+=x*(G.acceleration*t.factor)/(60*f)),h&&f&&(e.velocity.x+=h*t.factor/(60*f));const B=e.moveDecay;B!=1&&e.velocity.multTo(B);const M=e.velocity.mult(f),E=(s=e.retina.maxSpeed)!==null&&s!==void 0?s:g.retina.maxSpeed;G.enable&&G.maxSpeed>0&&(!G.inverse&&M.y>=0&&M.y>=E||G.inverse&&M.y<=0&&M.y<=-E)&&(M.y=x*E,f&&(e.velocity.y=M.y/f));const z=e.options.zIndex,J=(1-e.zIndexFactor)**z.velocityRate;c.spin.enable?this.spin(e,f):(J!=1&&M.multTo(J),e.position.addTo(M),c.vibrate&&(e.position.x+=Math.sin(e.position.x*Math.cos(e.position.y)),e.position.y+=Math.cos(e.position.y*Math.sin(e.position.x)))),Pj(e)}spin(e,t){const n=this.container;if(!e.spin)return;const r={x:e.spin.direction==="clockwise"?Math.cos:Math.sin,y:e.spin.direction==="clockwise"?Math.sin:Math.cos};e.position.x=e.spin.center.x+e.spin.radius*r.x(e.spin.angle),e.position.y=e.spin.center.y+e.spin.radius*r.y(e.spin.angle),e.spin.radius+=e.spin.acceleration;const s=Math.max(n.canvas.size.width,n.canvas.size.height);e.spin.radius>s/2?(e.spin.radius=s/2,e.spin.acceleration*=-1):e.spin.radius<0&&(e.spin.radius=0,e.spin.acceleration*=-1),e.spin.angle+=t/100*(1-e.spin.radius/s)}applyPath(e,t){const r=e.options.move.path;if(!r.enable)return;const o=this.container;if(e.lastPathTime<=e.pathDelay){e.lastPathTime+=t.value;return}const a=o.pathGenerator.generate(e);e.velocity.addTo(a),r.clamp&&(e.velocity.x=Us(e.velocity.x,-1,1),e.velocity.y=Us(e.velocity.y,-1,1)),e.lastPathTime-=e.pathDelay}moveParallax(e){const t=this.container,n=t.actualOptions;if(cc()||!n.interactivity.events.onHover.parallax.enable)return;const r=n.interactivity.events.onHover.parallax.force,s=t.interactivity.mouse.position;if(!s)return;const o={x:t.canvas.size.width/2,y:t.canvas.size.height/2},a=n.interactivity.events.onHover.parallax.smooth,l=e.getRadius()/r,c={x:(s.x-o.x)*l,y:(s.y-o.y)*l};e.offset.x+=(c.x-e.offset.x)/a,e.offset.y+=(c.y-e.offset.y)/a}getProximitySpeedFactor(e){const t=this.container,n=t.actualOptions;if(!bn("slow",n.interactivity.events.onHover.mode))return 1;const s=this.container.interactivity.mouse.position;if(!s)return 1;const o=e.getPosition(),a=ui(s,o),l=t.retina.slowModeRadius;if(a>l)return 1;const c=a/l||0,g=n.interactivity.modes.slow.factor;return c/g}}var Dj=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},CB;class wH{constructor(e){CB.set(this,void 0),Dj(this,CB,e,"f"),this.plugins=[],this.interactorsInitializers=new Map,this.updatersInitializers=new Map,this.interactors=new Map,this.updaters=new Map,this.presets=new Map,this.drawers=new Map,this.pathGenerators=new Map}getPlugin(e){return this.plugins.find(t=>t.id===e)}addPlugin(e){this.getPlugin(e.id)||this.plugins.push(e)}getAvailablePlugins(e){const t=new Map;for(const n of this.plugins)!n.needsPlugin(e.actualOptions)||t.set(n.id,n.getPlugin(e));return t}loadOptions(e,t){for(const n of this.plugins)n.loadOptions(e,t)}getPreset(e){return this.presets.get(e)}addPreset(e,t,n=!1){(n||!this.getPreset(e))&&this.presets.set(e,t)}addShapeDrawer(e,t){this.getShapeDrawer(e)||this.drawers.set(e,t)}getShapeDrawer(e){return this.drawers.get(e)}getSupportedShapes(){return this.drawers.keys()}getPathGenerator(e){return this.pathGenerators.get(e)}addPathGenerator(e,t){this.getPathGenerator(e)||this.pathGenerators.set(e,t)}getInteractors(e,t=!1){let n=this.interactors.get(e);return(!n||t)&&(n=[...this.interactorsInitializers.values()].map(r=>r(e)),this.interactors.set(e,n)),n}addInteractor(e,t){this.interactorsInitializers.set(e,t)}getUpdaters(e,t=!1){let n=this.updaters.get(e);return(!n||t)&&(n=[...this.updatersInitializers.values()].map(r=>r(e)),this.updaters.set(e,n)),n}addParticleUpdater(e,t){this.updatersInitializers.set(e,t)}}CB=new WeakMap;class GH{constructor(e,t){this.position=e,this.particle=t}}class uc{constructor(e,t){this.rectangle=e,this.capacity=t,this.points=[],this.divided=!1}subdivide(){const e=this.rectangle.position.x,t=this.rectangle.position.y,n=this.rectangle.size.width,r=this.rectangle.size.height,s=this.capacity;this.northEast=new uc(new As(e,t,n/2,r/2),s),this.northWest=new uc(new As(e+n/2,t,n/2,r/2),s),this.southEast=new uc(new As(e,t+r/2,n/2,r/2),s),this.southWest=new uc(new As(e+n/2,t+r/2,n/2,r/2),s),this.divided=!0}insert(e){var t,n,r,s,o;return this.rectangle.contains(e.position)?this.points.length<this.capacity?(this.points.push(e),!0):(this.divided||this.subdivide(),(o=((t=this.northEast)===null||t===void 0?void 0:t.insert(e))||((n=this.northWest)===null||n===void 0?void 0:n.insert(e))||((r=this.southEast)===null||r===void 0?void 0:r.insert(e))||((s=this.southWest)===null||s===void 0?void 0:s.insert(e)))!==null&&o!==void 0?o:!1):!1}queryCircle(e,t){return this.query(new is(e.x,e.y,t))}queryCircleWarp(e,t,n){const r=n,s=n;return this.query(new IB(e.x,e.y,t,r.canvas!==void 0?r.canvas.size:s))}queryRectangle(e,t){return this.query(new As(e.x,e.y,t.width,t.height))}query(e,t){var n,r,s,o;const a=t!=null?t:[];if(e.intersects(this.rectangle)){for(const l of this.points)!e.contains(l.position)&&ui(e.position,l.position)>l.particle.getRadius()||a.push(l.particle);this.divided&&((n=this.northEast)===null||n===void 0||n.query(e,a),(r=this.northWest)===null||r===void 0||r.query(e,a),(s=this.southEast)===null||s===void 0||s.query(e,a),(o=this.southWest)===null||o===void 0||o.query(e,a))}else return[];return a}}class xn{constructor(e,t){let n,r;if(t===void 0){if(typeof e=="number")throw new Error("tsParticles - Vector not initialized correctly");const s=e;[n,r]=[s.x,s.y]}else[n,r]=[e,t];this.x=n,this.y=r}static clone(e){return xn.create(e.x,e.y)}static create(e,t){return new xn(e,t)}static get origin(){return xn.create(0,0)}get angle(){return Math.atan2(this.y,this.x)}set angle(e){this.updateFromAngle(e,this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}set length(e){this.updateFromAngle(this.angle,e)}add(e){return xn.create(this.x+e.x,this.y+e.y)}addTo(e){this.x+=e.x,this.y+=e.y}sub(e){return xn.create(this.x-e.x,this.y-e.y)}subFrom(e){this.x-=e.x,this.y-=e.y}mult(e){return xn.create(this.x*e,this.y*e)}multTo(e){this.x*=e,this.y*=e}div(e){return xn.create(this.x/e,this.y/e)}divTo(e){this.x/=e,this.y/=e}distanceTo(e){return this.sub(e).length}getLengthSq(){return this.x**2+this.y**2}distanceToSq(e){return this.sub(e).getLengthSq()}manhattanDistanceTo(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}copy(){return xn.clone(this)}setTo(e){this.x=e.x,this.y=e.y}rotate(e){return xn.create(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))}updateFromAngle(e,t){this.x=Math.cos(e)*t,this.y=Math.sin(e)*t}}class mr extends xn{constructor(e,t,n){super(e,t);this.z=n===void 0?e.z:n}static clone(e){return mr.create(e.x,e.y,e.z)}static create(e,t,n){return new mr(e,t,n)}add(e){return e instanceof mr?mr.create(this.x+e.x,this.y+e.y,this.z+e.z):super.add(e)}addTo(e){super.addTo(e),e instanceof mr&&(this.z+=e.z)}sub(e){return e instanceof mr?mr.create(this.x-e.x,this.y-e.y,this.z-e.z):super.sub(e)}subFrom(e){super.subFrom(e),e instanceof mr&&(this.z-=e.z)}mult(e){return mr.create(this.x*e,this.y*e,this.z*e)}multTo(e){super.multTo(e),this.z*=e}div(e){return mr.create(this.x/e,this.y/e,this.z/e)}divTo(e){super.divTo(e),this.z/=e}copy(){return mr.clone(this)}setTo(e){super.setTo(e),e instanceof mr&&(this.z=e.z)}}class BH{constructor(e){this.container=e,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}init(){this.resize(),this.initStyle(),this.initCover(),this.initTrail(),this.initBackground(),this.paint()}loadCanvas(e){var t;this.generatedCanvas&&((t=this.element)===null||t===void 0||t.remove()),this.generatedCanvas=e.dataset&&Wt.generatedAttribute in e.dataset?e.dataset[Wt.generatedAttribute]==="true":this.generatedCanvas,this.element=e,this.originalStyle=Rn({},this.element.style),this.size.height=e.offsetHeight,this.size.width=e.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()}destroy(){var e;this.generatedCanvas&&((e=this.element)===null||e===void 0||e.remove()),this.draw(t=>{Ab(t,this.size)})}paint(){const e=this.container.actualOptions;this.draw(t=>{e.backgroundMask.enable&&e.backgroundMask.cover&&this.coverColor?(Ab(t,this.size),this.paintBase(ms(this.coverColor,this.coverColor.a))):this.paintBase()})}clear(){const e=this.container.actualOptions,t=e.particles.move.trail;e.backgroundMask.enable?this.paint():t.enable&&t.length>0&&this.trailFillColor?this.paintBase(ms(this.trailFillColor,1/t.length)):this.draw(n=>{Ab(n,this.size)})}async windowResize(){if(!this.element)return;const e=this.container;this.resize();const t=e.updateActualOptions();e.particles.setDensity();for(const[,n]of e.plugins)n.resize!==void 0&&n.resize();t&&await e.refresh()}resize(){if(!this.element)return;const e=this.container,t=e.retina.pixelRatio,n=e.canvas.size,r={width:n.width,height:n.height};n.width=this.element.offsetWidth*t,n.height=this.element.offsetHeight*t,this.element.width=n.width,this.element.height=n.height,this.container.started&&(this.resizeFactor={width:n.width/r.width,height:n.height/r.height})}drawConnectLine(e,t){this.draw(n=>{var r;const s=this.lineStyle(e,t);if(!s)return;const o=e.getPosition(),a=t.getPosition();uH(n,(r=e.retina.linksWidth)!==null&&r!==void 0?r:this.container.retina.linksWidth,s,o,a)})}drawGrabLine(e,t,n,r){const s=this.container;this.draw(o=>{var a;const l=e.getPosition();hH(o,(a=e.retina.linksWidth)!==null&&a!==void 0?a:s.retina.linksWidth,l,r,t,n)})}drawParticle(e,t){var n,r,s,o,a,l;if(e.spawning||e.destroyed)return;const c=e.getFillColor(),g=(n=e.getStrokeColor())!==null&&n!==void 0?n:c;if(!c&&!g)return;let[d,u]=this.getPluginParticleColors(e);const p=e.options.twinkle.particles,b=p.enable&&Math.random()<p.frequency;if(!d||!u){const z=Ka(p.color);d||(d=b&&z!==void 0?z:c||void 0),u||(u=b&&z!==void 0?z:g||void 0)}const y=this.container.actualOptions,m=e.options.zIndex,f=(1-e.zIndexFactor)**m.opacityRate,G=e.getRadius(),x=b?p.opacity:(o=(r=e.bubble.opacity)!==null&&r!==void 0?r:(s=e.opacity)===null||s===void 0?void 0:s.value)!==null&&o!==void 0?o:1,B=(l=(a=e.stroke)===null||a===void 0?void 0:a.opacity)!==null&&l!==void 0?l:x,M=x*f,E=d?Pa(d,M):void 0;!E&&!u||this.draw(z=>{const J=(1-e.zIndexFactor)**m.sizeRate,V=B*f,I=u?Pa(u,V):E;if(G<=0)return;const w=this.container;for(const S of w.particles.updaters)S.beforeDraw&&S.beforeDraw(e);fH(this.container,z,e,t,E,I,y.backgroundMask.enable,y.backgroundMask.composite,G*J,M,e.options.shadow,e.gradient);for(const S of w.particles.updaters)S.afterDraw&&S.afterDraw(e)})}drawPlugin(e,t){this.draw(n=>{pH(n,e,t)})}drawParticlePlugin(e,t,n){this.draw(r=>{mH(r,e,t,n)})}initBackground(){const t=this.container.actualOptions.background,n=this.element,r=n==null?void 0:n.style;if(!!r){if(t.color){const s=Nr(t.color);r.backgroundColor=s?ms(s,t.opacity):""}else r.backgroundColor="";r.backgroundImage=t.image||"",r.backgroundPosition=t.position||"",r.backgroundRepeat=t.repeat||"",r.backgroundSize=t.size||""}}draw(e){if(!!this.context)return e(this.context)}initCover(){const t=this.container.actualOptions.backgroundMask.cover,n=t.color,r=Nr(n);r&&(this.coverColor={r:r.r,g:r.g,b:r.b,a:t.opacity})}initTrail(){const e=this.container.actualOptions,t=e.particles.move.trail,n=Nr(t.fillColor);if(n){const r=e.particles.move.trail;this.trailFillColor={r:n.r,g:n.g,b:n.b,a:1/r.length}}}getPluginParticleColors(e){let t,n;for(const[,r]of this.container.plugins)if(!t&&r.particleFillColor&&(t=Ka(r.particleFillColor(e))),!n&&r.particleStrokeColor&&(n=Ka(r.particleStrokeColor(e))),t&&n)break;return[t,n]}initStyle(){const e=this.element,t=this.container.actualOptions;if(!e)return;const n=this.originalStyle;t.fullScreen.enable?(this.originalStyle=Rn({},e.style),e.style.setProperty("position","fixed","important"),e.style.setProperty("z-index",t.fullScreen.zIndex.toString(10),"important"),e.style.setProperty("top","0","important"),e.style.setProperty("left","0","important"),e.style.setProperty("width","100%","important"),e.style.setProperty("height","100%","important")):n&&(e.style.position=n.position,e.style.zIndex=n.zIndex,e.style.top=n.top,e.style.left=n.left,e.style.width=n.width,e.style.height=n.height);for(const r in t.style){if(!r||!t.style)continue;const s=t.style[r];!s||e.style.setProperty(r,s,"important")}}paintBase(e){this.draw(t=>{lH(t,this.size,e)})}lineStyle(e,t){return this.draw(n=>{const s=this.container.actualOptions.interactivity.modes.connect;return dH(n,e,t,s.links.opacity)})}}class nn{constructor(){this.value="#fff"}static create(e,t){const n=new nn;return n.load(e),t!==void 0&&(typeof t=="string"||t instanceof Array?n.load({value:t}):n.load(t)),n}load(e){(e==null?void 0:e.value)!==void 0&&(this.value=e.value)}}class Uj{constructor(){this.color=new nn,this.color.value="",this.image="",this.position="",this.repeat="",this.size="",this.opacity=1}load(e){e!==void 0&&(e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.image!==void 0&&(this.image=e.image),e.position!==void 0&&(this.position=e.position),e.repeat!==void 0&&(this.repeat=e.repeat),e.size!==void 0&&(this.size=e.size),e.opacity!==void 0&&(this.opacity=e.opacity))}}class Oj{constructor(){this.color=new nn,this.opacity=1}load(e){e!==void 0&&(e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.opacity!==void 0&&(this.opacity=e.opacity))}}class Jj{constructor(){this.composite="destination-out",this.cover=new Oj,this.enable=!1}load(e){if(e!==void 0){if(e.composite!==void 0&&(this.composite=e.composite),e.cover!==void 0){const t=e.cover,n=typeof e.cover=="string"?{color:e.cover}:e.cover;this.cover.load(t.color!==void 0?t:{color:n})}e.enable!==void 0&&(this.enable=e.enable)}}}class Qj{constructor(){this.enable=!0,this.zIndex=0}load(e){!e||(e.enable!==void 0&&(this.enable=e.enable),e.zIndex!==void 0&&(this.zIndex=e.zIndex))}}class jj{constructor(){this.enable=!1,this.mode=[]}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode))}}class pB{constructor(){this.selectors=[],this.enable=!1,this.mode=[],this.type="circle"}get elementId(){return this.ids}set elementId(e){this.ids=e}get el(){return this.elementId}set el(e){this.elementId=e}get ids(){return this.selectors instanceof Array?this.selectors.map(e=>e.replace("#","")):this.selectors.replace("#","")}set ids(e){this.selectors=e instanceof Array?e.map(t=>`#${t}`):`#${e}`}load(e){var t,n;if(e===void 0)return;const r=(n=(t=e.ids)!==null&&t!==void 0?t:e.elementId)!==null&&n!==void 0?n:e.el;r!==void 0&&(this.ids=r),e.selectors!==void 0&&(this.selectors=e.selectors),e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode),e.type!==void 0&&(this.type=e.type)}}class qj{constructor(){this.enable=!1,this.force=2,this.smooth=10}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),e.force!==void 0&&(this.force=e.force),e.smooth!==void 0&&(this.smooth=e.smooth))}}class $j{constructor(){this.enable=!1,this.mode=[],this.parallax=new qj}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode),this.parallax.load(e.parallax))}}class eq{constructor(){this.onClick=new jj,this.onDiv=new pB,this.onHover=new $j,this.resize=!0}get onclick(){return this.onClick}set onclick(e){this.onClick=e}get ondiv(){return this.onDiv}set ondiv(e){this.onDiv=e}get onhover(){return this.onHover}set onhover(e){this.onHover=e}load(e){var t,n,r;if(e===void 0)return;this.onClick.load((t=e.onClick)!==null&&t!==void 0?t:e.onclick);const s=(n=e.onDiv)!==null&&n!==void 0?n:e.ondiv;s!==void 0&&(s instanceof Array?this.onDiv=s.map(o=>{const a=new pB;return a.load(o),a}):(this.onDiv=new pB,this.onDiv.load(s))),this.onHover.load((r=e.onHover)!==null&&r!==void 0?r:e.onhover),e.resize!==void 0&&(this.resize=e.resize)}}class tq{constructor(){this.distance=200,this.duration=.4,this.easing="ease-out-quad",this.factor=1,this.maxSpeed=50,this.speed=1}load(e){!e||(e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.easing!==void 0&&(this.easing=e.easing),e.factor!==void 0&&(this.factor=e.factor),e.maxSpeed!==void 0&&(this.maxSpeed=e.maxSpeed),e.speed!==void 0&&(this.speed=e.speed))}}class nq{constructor(){this.distance=200}load(e){!e||e.distance!==void 0&&(this.distance=e.distance)}}class SH{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(e){e!==void 0&&(e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.mix!==void 0&&(this.mix=e.mix),e.opacity!==void 0&&(this.opacity=e.opacity),e.color!==void 0&&(e.color instanceof Array?this.color=e.color.map(t=>nn.create(void 0,t)):(this.color instanceof Array&&(this.color=new nn),this.color=nn.create(this.color,e.color))),e.size!==void 0&&(this.size=e.size))}}class ZH extends SH{constructor(){super();this.selectors=[]}get ids(){return this.selectors instanceof Array?this.selectors.map(e=>e.replace("#","")):this.selectors.replace("#","")}set ids(e){this.selectors=e instanceof Array?e.map(t=>`#${t}`):`#${e}`}load(e){super.load(e),e!==void 0&&(e.ids!==void 0&&(this.ids=e.ids),e.selectors!==void 0&&(this.selectors=e.selectors))}}class iq extends SH{load(e){super.load(e),e!==void 0&&e.divs!==void 0&&(e.divs instanceof Array?this.divs=e.divs.map(t=>{const n=new ZH;return n.load(t),n}):((this.divs instanceof Array||!this.divs)&&(this.divs=new ZH),this.divs.load(e.divs)))}}class rq{constructor(){this.opacity=.5}load(e){e!==void 0&&e.opacity!==void 0&&(this.opacity=e.opacity)}}class sq{constructor(){this.distance=80,this.links=new rq,this.radius=60}get line_linked(){return this.links}set line_linked(e){this.links=e}get lineLinked(){return this.links}set lineLinked(e){this.links=e}load(e){var t,n;e!==void 0&&(e.distance!==void 0&&(this.distance=e.distance),this.links.load((n=(t=e.links)!==null&&t!==void 0?t:e.lineLinked)!==null&&n!==void 0?n:e.line_linked),e.radius!==void 0&&(this.radius=e.radius))}}class oq{constructor(){this.blink=!1,this.consent=!1,this.opacity=1}load(e){e!==void 0&&(e.blink!==void 0&&(this.blink=e.blink),e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.consent!==void 0&&(this.consent=e.consent),e.opacity!==void 0&&(this.opacity=e.opacity))}}class aq{constructor(){this.distance=100,this.links=new oq}get line_linked(){return this.links}set line_linked(e){this.links=e}get lineLinked(){return this.links}set lineLinked(e){this.links=e}load(e){var t,n;e!==void 0&&(e.distance!==void 0&&(this.distance=e.distance),this.links.load((n=(t=e.links)!==null&&t!==void 0?t:e.lineLinked)!==null&&n!==void 0?n:e.line_linked))}}class lq{constructor(){this.start=new nn,this.stop=new nn,this.start.value="#ffffff",this.stop.value="#000000"}load(e){e!==void 0&&(this.start=nn.create(this.start,e.start),this.stop=nn.create(this.stop,e.stop))}}class cq{constructor(){this.gradient=new lq,this.radius=1e3}load(e){e!==void 0&&(this.gradient.load(e.gradient),e.radius!==void 0&&(this.radius=e.radius))}}class gq{constructor(){this.color=new nn,this.color.value="#000000",this.length=2e3}load(e){e!==void 0&&(this.color=nn.create(this.color,e.color),e.length!==void 0&&(this.length=e.length))}}class uq{constructor(){this.area=new cq,this.shadow=new gq}load(e){e!==void 0&&(this.area.load(e.area),this.shadow.load(e.shadow))}}class dq{constructor(){this.default=!0,this.groups=[],this.quantity=4}get particles_nb(){return this.quantity}set particles_nb(e){this.quantity=e}load(e){var t;if(e===void 0)return;e.default!==void 0&&(this.default=e.default),e.groups!==void 0&&(this.groups=e.groups.map(r=>r)),this.groups.length||(this.default=!0);const n=(t=e.quantity)!==null&&t!==void 0?t:e.particles_nb;n!==void 0&&(this.quantity=n)}}class hq{constructor(){this.quantity=2}get particles_nb(){return this.quantity}set particles_nb(e){this.quantity=e}load(e){var t;if(e===void 0)return;const n=(t=e.quantity)!==null&&t!==void 0?t:e.particles_nb;n!==void 0&&(this.quantity=n)}}class RH{constructor(){this.distance=200,this.duration=.4,this.factor=100,this.speed=1,this.maxSpeed=50,this.easing="ease-out-quad"}load(e){!e||(e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.easing!==void 0&&(this.easing=e.easing),e.factor!==void 0&&(this.factor=e.factor),e.speed!==void 0&&(this.speed=e.speed),e.maxSpeed!==void 0&&(this.maxSpeed=e.maxSpeed))}}class MH extends RH{constructor(){super();this.selectors=[]}get ids(){return this.selectors instanceof Array?this.selectors.map(e=>e.replace("#","")):this.selectors.replace("#","")}set ids(e){e instanceof Array?this.selectors=e.map(()=>`#${e}`):this.selectors=`#${e}`}load(e){super.load(e),e!==void 0&&(e.ids!==void 0&&(this.ids=e.ids),e.selectors!==void 0&&(this.selectors=e.selectors))}}class fq extends RH{load(e){super.load(e),(e==null?void 0:e.divs)!==void 0&&(e.divs instanceof Array?this.divs=e.divs.map(t=>{const n=new MH;return n.load(t),n}):((this.divs instanceof Array||!this.divs)&&(this.divs=new MH),this.divs.load(e.divs)))}}class Iq{constructor(){this.factor=3,this.radius=200}get active(){return!1}set active(e){}load(e){e!==void 0&&(e.factor!==void 0&&(this.factor=e.factor),e.radius!==void 0&&(this.radius=e.radius))}}class Cq{constructor(){this.delay=1,this.pauseOnStop=!1,this.quantity=1}load(e){e!==void 0&&(e.delay!==void 0&&(this.delay=e.delay),e.quantity!==void 0&&(this.quantity=e.quantity),e.particles!==void 0&&(this.particles=Rn({},e.particles)),e.pauseOnStop!==void 0&&(this.pauseOnStop=e.pauseOnStop))}}class pq{constructor(){this.attract=new tq,this.bounce=new nq,this.bubble=new iq,this.connect=new sq,this.grab=new aq,this.light=new uq,this.push=new dq,this.remove=new hq,this.repulse=new fq,this.slow=new Iq,this.trail=new Cq}load(e){e!==void 0&&(this.attract.load(e.attract),this.bubble.load(e.bubble),this.connect.load(e.connect),this.grab.load(e.grab),this.light.load(e.light),this.push.load(e.push),this.remove.load(e.remove),this.repulse.load(e.repulse),this.slow.load(e.slow),this.trail.load(e.trail))}}class mq{constructor(){this.detectsOn="window",this.events=new eq,this.modes=new pq}get detect_on(){return this.detectsOn}set detect_on(e){this.detectsOn=e}load(e){var t,n,r;if(e===void 0)return;const s=(t=e.detectsOn)!==null&&t!==void 0?t:e.detect_on;s!==void 0&&(this.detectsOn=s),this.events.load(e.events),this.modes.load(e.modes),((r=(n=e.modes)===null||n===void 0?void 0:n.slow)===null||r===void 0?void 0:r.active)===!0&&(this.events.onHover.mode instanceof Array?this.events.onHover.mode.indexOf("slow")<0&&this.events.onHover.mode.push("slow"):this.events.onHover.mode!=="slow"&&(this.events.onHover.mode=[this.events.onHover.mode,"slow"]))}}class Aq{load(e){var t,n;!e||(e.position!==void 0&&(this.position={x:(t=e.position.x)!==null&&t!==void 0?t:50,y:(n=e.position.y)!==null&&n!==void 0?n:50}),e.options!==void 0&&(this.options=Rn({},e.options)))}}class bq{constructor(){this.factor=4,this.value=!0}load(e){!e||(e.factor!==void 0&&(this.factor=e.factor),e.value!==void 0&&(this.value=e.value))}}class yq{constructor(){this.disable=!1,this.reduce=new bq}load(e){!e||(e.disable!==void 0&&(this.disable=e.disable),this.reduce.load(e.reduce))}}class mB{constructor(){this.count=0,this.enable=!1,this.offset=0,this.speed=1,this.sync=!0}load(e){e!==void 0&&(e.count!==void 0&&(this.count=e.count),e.enable!==void 0&&(this.enable=e.enable),e.offset!==void 0&&(this.offset=zn(e.offset)),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync))}}class vq{constructor(){this.h=new mB,this.s=new mB,this.l=new mB}load(e){!e||(this.h.load(e.h),this.s.load(e.s),this.l.load(e.l))}}class dc extends nn{constructor(){super();this.animation=new vq}static create(e,t){const n=new dc;return n.load(e),t!==void 0&&(typeof t=="string"||t instanceof Array?n.load({value:t}):n.load(t)),n}load(e){if(super.load(e),!e)return;const t=e.animation;t!==void 0&&(t.enable!==void 0?this.animation.h.load(t):this.animation.load(e.animation))}}class WH{constructor(){this.angle=new xq,this.colors=[],this.type="random"}load(e){!e||(this.angle.load(e.angle),e.colors!==void 0&&(this.colors=e.colors.map(t=>{const n=new Gq;return n.load(t),n})),e.type!==void 0&&(this.type=e.type))}}class xq{constructor(){this.value=0,this.animation=new Bq,this.direction="clockwise"}load(e){!e||(this.animation.load(e.animation),e.value!==void 0&&(this.value=e.value),e.direction!==void 0&&(this.direction=e.direction))}}class wq{constructor(){this.value=0,this.animation=new Sq}load(e){!e||(this.animation.load(e.animation),e.value!==void 0&&(this.value=zn(e.value)))}}class Gq{constructor(){this.stop=0,this.value=new dc}load(e){!e||(e.stop!==void 0&&(this.stop=e.stop),this.value=dc.create(this.value,e.value),e.opacity!==void 0&&(this.opacity=new wq,typeof e.opacity=="number"?this.opacity.value=e.opacity:this.opacity.load(e.opacity)))}}class Bq{constructor(){this.count=0,this.enable=!1,this.speed=0,this.sync=!1}load(e){!e||(e.count!==void 0&&(this.count=e.count),e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync))}}class Sq{constructor(){this.count=0,this.enable=!1,this.speed=0,this.sync=!1,this.startValue="random"}load(e){!e||(e.count!==void 0&&(this.count=e.count),e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync),e.startValue!==void 0&&(this.startValue=e.startValue))}}class Zq{constructor(){this.enable=!1,this.minimumValue=0}load(e){!e||(e.enable!==void 0&&(this.enable=e.enable),e.minimumValue!==void 0&&(this.minimumValue=e.minimumValue))}}class rs{constructor(){this.random=new Zq,this.value=0}load(e){!e||(typeof e.random=="boolean"?this.random.enable=e.random:this.random.load(e.random),e.value!==void 0&&(this.value=zn(e.value,this.random.enable?this.random.minimumValue:void 0)))}}class _H extends rs{constructor(){super();this.random.minimumValue=.1,this.value=1}}class VH{constructor(){this.horizontal=new _H,this.vertical=new _H}load(e){!e||(this.horizontal.load(e.horizontal),this.vertical.load(e.vertical))}}class Rq{constructor(){this.enable=!0,this.retries=0}load(e){!e||(e.enable!==void 0&&(this.enable=e.enable),e.retries!==void 0&&(this.retries=e.retries))}}class Mq{constructor(){this.bounce=new VH,this.enable=!1,this.mode="bounce",this.overlap=new Rq}load(e){e!==void 0&&(this.bounce.load(e.bounce),e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode),this.overlap.load(e.overlap))}}class Wq extends rs{constructor(){super();this.value=3}}class _q extends rs{constructor(){super();this.value={min:4,max:9}}}class Vq{constructor(){this.count=1,this.factor=new Wq,this.rate=new _q,this.sizeOffset=!0}load(e){!e||(e.count!==void 0&&(this.count=e.count),this.factor.load(e.factor),this.rate.load(e.rate),e.particles!==void 0&&(this.particles=Rn({},e.particles)),e.sizeOffset!==void 0&&(this.sizeOffset=e.sizeOffset))}}class Nq{constructor(){this.mode="none",this.split=new Vq}load(e){!e||(e.mode!==void 0&&(this.mode=e.mode),this.split.load(e.split))}}class Eq extends rs{constructor(){super();this.sync=!1}load(e){!e||(super.load(e),e.sync!==void 0&&(this.sync=e.sync))}}class Hq extends rs{constructor(){super();this.random.minimumValue=1e-4,this.sync=!1}load(e){e!==void 0&&(super.load(e),e.sync!==void 0&&(this.sync=e.sync))}}class Fq{constructor(){this.count=0,this.delay=new Eq,this.duration=new Hq}load(e){e!==void 0&&(e.count!==void 0&&(this.count=e.count),this.delay.load(e.delay),this.duration.load(e.duration))}}class Lq{constructor(){this.blur=5,this.color=new nn,this.enable=!1,this.color.value="#00ff00"}load(e){e!==void 0&&(e.blur!==void 0&&(this.blur=e.blur),this.color=nn.create(this.color,e.color),e.enable!==void 0&&(this.enable=e.enable))}}class Tq{constructor(){this.enable=!1,this.frequency=1}load(e){e!==void 0&&(e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.enable!==void 0&&(this.enable=e.enable),e.frequency!==void 0&&(this.frequency=e.frequency),e.opacity!==void 0&&(this.opacity=e.opacity))}}class Xq{constructor(){this.blink=!1,this.color=new nn,this.consent=!1,this.distance=100,this.enable=!1,this.frequency=1,this.opacity=1,this.shadow=new Lq,this.triangles=new Tq,this.width=1,this.warp=!1}load(e){e!==void 0&&(e.id!==void 0&&(this.id=e.id),e.blink!==void 0&&(this.blink=e.blink),this.color=nn.create(this.color,e.color),e.consent!==void 0&&(this.consent=e.consent),e.distance!==void 0&&(this.distance=e.distance),e.enable!==void 0&&(this.enable=e.enable),e.frequency!==void 0&&(this.frequency=e.frequency),e.opacity!==void 0&&(this.opacity=e.opacity),this.shadow.load(e.shadow),this.triangles.load(e.triangles),e.width!==void 0&&(this.width=e.width),e.warp!==void 0&&(this.warp=e.warp))}}class zq{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}get rotateX(){return this.rotate.x}set rotateX(e){this.rotate.x=e}get rotateY(){return this.rotate.y}set rotateY(e){this.rotate.y=e}load(e){var t,n,r,s;if(!e)return;e.distance!==void 0&&(this.distance=e.distance),e.enable!==void 0&&(this.enable=e.enable);const o=(n=(t=e.rotate)===null||t===void 0?void 0:t.x)!==null&&n!==void 0?n:e.rotateX;o!==void 0&&(this.rotate.x=o);const a=(s=(r=e.rotate)===null||r===void 0?void 0:r.y)!==null&&s!==void 0?s:e.rotateY;a!==void 0&&(this.rotate.y=a)}}class kq{constructor(){this.offset=0,this.value=90}load(e){e!==void 0&&(e.offset!==void 0&&(this.offset=e.offset),e.value!==void 0&&(this.value=e.value))}}class Yq{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(e){!e||(e.acceleration!==void 0&&(this.acceleration=e.acceleration),e.enable!==void 0&&(this.enable=e.enable),e.inverse!==void 0&&(this.inverse=e.inverse),e.maxSpeed!==void 0&&(this.maxSpeed=e.maxSpeed))}}class Kq{constructor(){this.default="out"}load(e){var t,n,r,s;!e||(e.default!==void 0&&(this.default=e.default),this.bottom=(t=e.bottom)!==null&&t!==void 0?t:e.default,this.left=(n=e.left)!==null&&n!==void 0?n:e.default,this.right=(r=e.right)!==null&&r!==void 0?r:e.default,this.top=(s=e.top)!==null&&s!==void 0?s:e.default)}}class Pq extends rs{constructor(){super()}}class Dq{constructor(){this.clamp=!0,this.delay=new Pq,this.enable=!1,this.options={}}load(e){e!==void 0&&(e.clamp!==void 0&&(this.clamp=e.clamp),this.delay.load(e.delay),e.enable!==void 0&&(this.enable=e.enable),this.generator=e.generator,e.options&&(this.options=Rn(this.options,e.options)))}}class Uq{constructor(){this.acceleration=0,this.enable=!1}load(e){!e||(e.acceleration!==void 0&&(this.acceleration=zn(e.acceleration)),e.enable!==void 0&&(this.enable=e.enable),this.position=e.position?Rn({},e.position):void 0)}}class Oq{constructor(){this.enable=!1,this.length=10,this.fillColor=new nn,this.fillColor.value="#000000"}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),this.fillColor=nn.create(this.fillColor,e.fillColor),e.length!==void 0&&(this.length=e.length))}}class Jq{constructor(){this.angle=new kq,this.attract=new zq,this.decay=0,this.distance={},this.direction="none",this.drift=0,this.enable=!1,this.gravity=new Yq,this.path=new Dq,this.outModes=new Kq,this.random=!1,this.size=!1,this.speed=2,this.spin=new Uq,this.straight=!1,this.trail=new Oq,this.vibrate=!1,this.warp=!1}get collisions(){return!1}set collisions(e){}get bounce(){return this.collisions}set bounce(e){this.collisions=e}get out_mode(){return this.outMode}set out_mode(e){this.outMode=e}get outMode(){return this.outModes.default}set outMode(e){this.outModes.default=e}get noise(){return this.path}set noise(e){this.path=e}load(e){var t,n,r;if(e===void 0)return;e.angle!==void 0&&(typeof e.angle=="number"?this.angle.value=e.angle:this.angle.load(e.angle)),this.attract.load(e.attract),e.decay!==void 0&&(this.decay=e.decay),e.direction!==void 0&&(this.direction=e.direction),e.distance!==void 0&&(this.distance=typeof e.distance=="number"?{horizontal:e.distance,vertical:e.distance}:Rn({},e.distance)),e.drift!==void 0&&(this.drift=zn(e.drift)),e.enable!==void 0&&(this.enable=e.enable),this.gravity.load(e.gravity);const s=(t=e.outMode)!==null&&t!==void 0?t:e.out_mode;(e.outModes!==void 0||s!==void 0)&&(typeof e.outModes=="string"||e.outModes===void 0&&s!==void 0?this.outModes.load({default:(n=e.outModes)!==null&&n!==void 0?n:s}):this.outModes.load(e.outModes)),this.path.load((r=e.path)!==null&&r!==void 0?r:e.noise),e.random!==void 0&&(this.random=e.random),e.size!==void 0&&(this.size=e.size),e.speed!==void 0&&(this.speed=zn(e.speed)),this.spin.load(e.spin),e.straight!==void 0&&(this.straight=e.straight),this.trail.load(e.trail),e.vibrate!==void 0&&(this.vibrate=e.vibrate),e.warp!==void 0&&(this.warp=e.warp)}}class AB{constructor(){this.count=0,this.enable=!1,this.speed=1,this.sync=!1}load(e){!e||(e.count!==void 0&&(this.count=e.count),e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync))}}class Qq extends AB{constructor(){super();this.destroy="none",this.enable=!1,this.speed=2,this.startValue="random",this.sync=!1}get opacity_min(){return this.minimumValue}set opacity_min(e){this.minimumValue=e}load(e){var t;e!==void 0&&(super.load(e),e.destroy!==void 0&&(this.destroy=e.destroy),e.enable!==void 0&&(this.enable=e.enable),this.minimumValue=(t=e.minimumValue)!==null&&t!==void 0?t:e.opacity_min,e.speed!==void 0&&(this.speed=e.speed),e.startValue!==void 0&&(this.startValue=e.startValue),e.sync!==void 0&&(this.sync=e.sync))}}class jq extends rs{constructor(){super();this.animation=new Qq,this.random.minimumValue=.1,this.value=1}get anim(){return this.animation}set anim(e){this.animation=e}load(e){var t;if(!e)return;super.load(e);const n=(t=e.animation)!==null&&t!==void 0?t:e.anim;n!==void 0&&(this.animation.load(n),this.value=zn(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class qq extends rs{constructor(){super();this.value=45,this.random.enable=!1,this.random.minimumValue=0}load(e){e!==void 0&&super.load(e)}}class $q{constructor(){this.animation=new AB,this.enable=!1,this.opacity=1,this.rotation=new qq,this.width=1}load(e){e!==void 0&&(this.animation.load(e.animation),this.rotation.load(e.rotation),e.enable!==void 0&&(this.enable=e.enable),e.opacity!==void 0&&(this.opacity=e.opacity),e.width!==void 0&&(this.width=e.width),e.radius!==void 0&&(this.radius=e.radius),e.color!==void 0&&(this.color=nn.create(this.color,e.color)))}}class e${constructor(){this.enable=!1,this.area=800,this.factor=1e3}get value_area(){return this.area}set value_area(e){this.area=e}load(e){var t;if(e===void 0)return;e.enable!==void 0&&(this.enable=e.enable);const n=(t=e.area)!==null&&t!==void 0?t:e.value_area;n!==void 0&&(this.area=n),e.factor!==void 0&&(this.factor=e.factor)}}class t${constructor(){this.density=new e$,this.limit=0,this.value=100}get max(){return this.limit}set max(e){this.limit=e}load(e){var t;if(e===void 0)return;this.density.load(e.density);const n=(t=e.limit)!==null&&t!==void 0?t:e.max;n!==void 0&&(this.limit=n),e.value!==void 0&&(this.value=e.value)}}class n$ extends rs{constructor(){super();this.enabled=!1,this.distance=1,this.duration=1,this.factor=1,this.speed=1}load(e){super.load(e),!!e&&(e.enabled!==void 0&&(this.enabled=e.enabled),e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.factor!==void 0&&(this.factor=e.factor),e.speed!==void 0&&(this.speed=e.speed))}}class NH{constructor(){this.enable=!1,this.value=0}load(e){!e||(e.enable!==void 0&&(this.enable=e.enable),e.value!==void 0&&(this.value=e.value))}}class i${constructor(){this.darken=new NH,this.enable=!1,this.enlighten=new NH,this.mode="vertical",this.speed=25}load(e){!e||(e.backColor!==void 0&&(this.backColor=nn.create(this.backColor,e.backColor)),this.darken.load(e.darken),e.enable!==void 0&&(this.enable=e.enable),this.enlighten.load(e.enlighten),e.mode!==void 0&&(this.mode=e.mode),e.speed!==void 0&&(this.speed=zn(e.speed)))}}class r${constructor(){this.enable=!1,this.speed=0,this.sync=!1}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync))}}class s$ extends rs{constructor(){super();this.animation=new r$,this.direction="clockwise",this.path=!1,this.value=0}load(e){!e||(super.load(e),e.direction!==void 0&&(this.direction=e.direction),this.animation.load(e.animation),e.path!==void 0&&(this.path=e.path))}}class o${constructor(){this.blur=0,this.color=new nn,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000000"}load(e){e!==void 0&&(e.blur!==void 0&&(this.blur=e.blur),this.color=nn.create(this.color,e.color),e.enable!==void 0&&(this.enable=e.enable),e.offset!==void 0&&(e.offset.x!==void 0&&(this.offset.x=e.offset.x),e.offset.y!==void 0&&(this.offset.y=e.offset.y)))}}class EH{constructor(){this.options={},this.type="circle"}get image(){var e;return(e=this.options.image)!==null&&e!==void 0?e:this.options.images}set image(e){this.options.image=e,this.options.images=e}get custom(){return this.options}set custom(e){this.options=e}get images(){return this.image}set images(e){this.image=e}get stroke(){return[]}set stroke(e){}get character(){var e;return(e=this.options.character)!==null&&e!==void 0?e:this.options.char}set character(e){this.options.character=e,this.options.char=e}get polygon(){var e;return(e=this.options.polygon)!==null&&e!==void 0?e:this.options.star}set polygon(e){this.options.polygon=e,this.options.star=e}load(e){var t,n,r;if(e===void 0)return;const s=(t=e.options)!==null&&t!==void 0?t:e.custom;if(s!==void 0)for(const o in s){const a=s[o];a!==void 0&&(this.options[o]=Rn((n=this.options[o])!==null&&n!==void 0?n:{},a))}this.loadShape(e.character,"character","char",!0),this.loadShape(e.polygon,"polygon","star",!1),this.loadShape((r=e.image)!==null&&r!==void 0?r:e.images,"image","images",!0),e.type!==void 0&&(this.type=e.type)}loadShape(e,t,n,r){var s,o,a,l;e!==void 0&&(e instanceof Array?(this.options[t]instanceof Array||(this.options[t]=[],(!this.options[n]||r)&&(this.options[n]=[])),this.options[t]=Rn((s=this.options[t])!==null&&s!==void 0?s:[],e),(!this.options[n]||r)&&(this.options[n]=Rn((o=this.options[n])!==null&&o!==void 0?o:[],e))):(this.options[t]instanceof Array&&(this.options[t]={},(!this.options[n]||r)&&(this.options[n]={})),this.options[t]=Rn((a=this.options[t])!==null&&a!==void 0?a:{},e),(!this.options[n]||r)&&(this.options[n]=Rn((l=this.options[n])!==null&&l!==void 0?l:{},e))))}}class a$ extends AB{constructor(){super();this.destroy="none",this.enable=!1,this.speed=5,this.startValue="random",this.sync=!1}get size_min(){return this.minimumValue}set size_min(e){this.minimumValue=e}load(e){var t;e!==void 0&&(super.load(e),e.destroy!==void 0&&(this.destroy=e.destroy),e.enable!==void 0&&(this.enable=e.enable),this.minimumValue=(t=e.minimumValue)!==null&&t!==void 0?t:e.size_min,e.speed!==void 0&&(this.speed=e.speed),e.startValue!==void 0&&(this.startValue=e.startValue),e.sync!==void 0&&(this.sync=e.sync))}}class l$ extends rs{constructor(){super();this.animation=new a$,this.random.minimumValue=1,this.value=3}get anim(){return this.animation}set anim(e){this.animation=e}load(e){var t;if(!e)return;super.load(e);const n=(t=e.animation)!==null&&t!==void 0?t:e.anim;n!==void 0&&(this.animation.load(n),this.value=zn(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class bB{constructor(){this.width=0}load(e){e!==void 0&&(e.color!==void 0&&(this.color=dc.create(this.color,e.color)),e.width!==void 0&&(this.width=e.width),e.opacity!==void 0&&(this.opacity=e.opacity))}}class c${constructor(){this.enable=!1,this.speed=0,this.sync=!1}load(e){e!==void 0&&(e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=e.speed),e.sync!==void 0&&(this.sync=e.sync))}}class g$ extends rs{constructor(){super();this.animation=new c$,this.direction="clockwise",this.enable=!1,this.value=0}load(e){!e||(super.load(e),this.animation.load(e.animation),e.direction!==void 0&&(this.direction=e.direction),e.enable!==void 0&&(this.enable=e.enable))}}class HH{constructor(){this.enable=!1,this.frequency=.05,this.opacity=1}load(e){e!==void 0&&(e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.enable!==void 0&&(this.enable=e.enable),e.frequency!==void 0&&(this.frequency=e.frequency),e.opacity!==void 0&&(this.opacity=e.opacity))}}class u${constructor(){this.lines=new HH,this.particles=new HH}load(e){e!==void 0&&(this.lines.load(e.lines),this.particles.load(e.particles))}}class d${constructor(){this.distance=5,this.enable=!1,this.speed=50}load(e){!e||(e.distance!==void 0&&(this.distance=zn(e.distance)),e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=zn(e.speed)))}}class h$ extends rs{constructor(){super();this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(e){super.load(e),!!e&&(e.opacityRate!==void 0&&(this.opacityRate=e.opacityRate),e.sizeRate!==void 0&&(this.sizeRate=e.sizeRate),e.velocityRate!==void 0&&(this.velocityRate=e.velocityRate))}}class yB{constructor(){this.bounce=new VH,this.collisions=new Mq,this.color=new dc,this.destroy=new Nq,this.gradient=[],this.groups={},this.life=new Fq,this.links=new Xq,this.move=new Jq,this.number=new t$,this.opacity=new jq,this.orbit=new $q,this.reduceDuplicates=!1,this.repulse=new n$,this.roll=new i$,this.rotate=new s$,this.shadow=new o$,this.shape=new EH,this.size=new l$,this.stroke=new bB,this.tilt=new g$,this.twinkle=new u$,this.wobble=new d$,this.zIndex=new h$}get line_linked(){return this.links}set line_linked(e){this.links=e}get lineLinked(){return this.links}set lineLinked(e){this.links=e}load(e){var t,n,r,s,o,a,l,c;if(e===void 0)return;this.bounce.load(e.bounce),this.color.load(dc.create(this.color,e.color)),this.destroy.load(e.destroy),this.life.load(e.life);const g=(n=(t=e.links)!==null&&t!==void 0?t:e.lineLinked)!==null&&n!==void 0?n:e.line_linked;if(g!==void 0&&this.links.load(g),e.groups!==void 0)for(const p in e.groups){const b=e.groups[p];b!==void 0&&(this.groups[p]=Rn((r=this.groups[p])!==null&&r!==void 0?r:{},b))}this.move.load(e.move),this.number.load(e.number),this.opacity.load(e.opacity),this.orbit.load(e.orbit),e.reduceDuplicates!==void 0&&(this.reduceDuplicates=e.reduceDuplicates),this.repulse.load(e.repulse),this.roll.load(e.roll),this.rotate.load(e.rotate),this.shape.load(e.shape),this.size.load(e.size),this.shadow.load(e.shadow),this.tilt.load(e.tilt),this.twinkle.load(e.twinkle),this.wobble.load(e.wobble),this.zIndex.load(e.zIndex);const d=(o=(s=e.move)===null||s===void 0?void 0:s.collisions)!==null&&o!==void 0?o:(a=e.move)===null||a===void 0?void 0:a.bounce;d!==void 0&&(this.collisions.enable=d),this.collisions.load(e.collisions);const u=(l=e.stroke)!==null&&l!==void 0?l:(c=e.shape)===null||c===void 0?void 0:c.stroke;u&&(u instanceof Array?this.stroke=u.map(p=>{const b=new bB;return b.load(p),b}):(this.stroke instanceof Array&&(this.stroke=new bB),this.stroke.load(u)));const h=e.gradient;h&&(h instanceof Array?this.gradient=h.map(p=>{const b=new WH;return b.load(p),b}):(this.gradient instanceof Array&&(this.gradient=new WH),this.gradient.load(h)))}}class f${constructor(){this.maxWidth=1/0,this.options={},this.mode="canvas"}load(e){!e||(e.maxWidth!==void 0&&(this.maxWidth=e.maxWidth),e.mode!==void 0&&(e.mode==="screen"?this.mode="screen":this.mode="canvas"),e.options!==void 0&&(this.options=Rn({},e.options)))}}class I${constructor(){this.auto=!1,this.mode="any",this.value=!1}load(e){!e||(e.auto!==void 0&&(this.auto=e.auto),e.mode!==void 0&&(this.mode=e.mode),e.value!==void 0&&(this.value=e.value))}}class C${constructor(){this.name="",this.default=new I$}load(e){e!==void 0&&(e.name!==void 0&&(this.name=e.name),this.default.load(e.default),e.options!==void 0&&(this.options=Rn({},e.options)))}}var p$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},_C=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},VC,NC,vb;class EC{constructor(e){VC.add(this),NC.set(this,void 0),p$(this,NC,e,"f"),this.autoPlay=!0,this.background=new Uj,this.backgroundMask=new Jj,this.fullScreen=new Qj,this.detectRetina=!0,this.duration=0,this.fpsLimit=120,this.interactivity=new mq,this.manualParticles=[],this.motion=new yq,this.particles=new yB,this.pauseOnBlur=!0,this.pauseOnOutsideViewport=!0,this.responsive=[],this.style={},this.themes=[],this.zLayers=100}get fps_limit(){return this.fpsLimit}set fps_limit(e){this.fpsLimit=e}get retina_detect(){return this.detectRetina}set retina_detect(e){this.detectRetina=e}get backgroundMode(){return this.fullScreen}set backgroundMode(e){this.fullScreen.load(e)}load(e){var t,n,r,s,o;if(e===void 0)return;if(e.preset!==void 0)if(e.preset instanceof Array)for(const g of e.preset)this.importPreset(g);else this.importPreset(e.preset);e.autoPlay!==void 0&&(this.autoPlay=e.autoPlay);const a=(t=e.detectRetina)!==null&&t!==void 0?t:e.retina_detect;a!==void 0&&(this.detectRetina=a),e.duration!==void 0&&(this.duration=e.duration);const l=(n=e.fpsLimit)!==null&&n!==void 0?n:e.fps_limit;l!==void 0&&(this.fpsLimit=l),e.pauseOnBlur!==void 0&&(this.pauseOnBlur=e.pauseOnBlur),e.pauseOnOutsideViewport!==void 0&&(this.pauseOnOutsideViewport=e.pauseOnOutsideViewport),e.zLayers!==void 0&&(this.zLayers=e.zLayers),this.background.load(e.background);const c=(r=e.fullScreen)!==null&&r!==void 0?r:e.backgroundMode;if(typeof c=="boolean"?this.fullScreen.enable=c:this.fullScreen.load(c),this.backgroundMask.load(e.backgroundMask),this.interactivity.load(e.interactivity),e.manualParticles!==void 0&&(this.manualParticles=e.manualParticles.map(g=>{const d=new Aq;return d.load(g),d})),this.motion.load(e.motion),this.particles.load(e.particles),this.style=Rn(this.style,e.style),_C(this,NC,"f").plugins.loadOptions(this,e),e.responsive!==void 0)for(const g of e.responsive){const d=new f$;d.load(g),this.responsive.push(d)}if(this.responsive.sort((g,d)=>g.maxWidth-d.maxWidth),e.themes!==void 0)for(const g of e.themes){const d=new C$;d.load(g),this.themes.push(d)}this.defaultDarkTheme=(s=_C(this,VC,"m",vb).call(this,"dark"))===null||s===void 0?void 0:s.name,this.defaultLightTheme=(o=_C(this,VC,"m",vb).call(this,"light"))===null||o===void 0?void 0:o.name}setTheme(e){if(e){const t=this.themes.find(n=>n.name===e);t&&this.load(t.options)}else{const t=typeof matchMedia!="undefined"&&matchMedia("(prefers-color-scheme: dark)"),n=t&&t.matches,r=_C(this,VC,"m",vb).call(this,n?"dark":"light");r&&this.load(r.options)}}setResponsive(e,t,n){this.load(n);const r=this.responsive.find(s=>s.mode==="screen"&&screen?s.maxWidth*t>screen.availWidth:s.maxWidth*t>e);return this.load(r==null?void 0:r.options),r==null?void 0:r.maxWidth}importPreset(e){this.load(_C(this,NC,"f").plugins.getPreset(e))}}NC=new WeakMap,VC=new WeakSet,vb=function(e){var t;return(t=this.themes.find(n=>n.default.value&&n.default.mode===e))!==null&&t!==void 0?t:this.themes.find(n=>n.default.value&&n.default.mode==="any")};var m$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},A$=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},xb;const FH=i=>{(bn(i.outMode,i.checkModes)||bn(i.outMode,i.checkModes))&&(i.coord>i.maxCoord-i.radius*2?i.setCb(-i.radius):i.coord<i.radius*2&&i.setCb(i.radius))};class LH{constructor(e,t,n,r,s,o){var a,l,c,g,d,u,h,p,b;this.id=t,this.container=n,this.group=o,xb.set(this,void 0),m$(this,xb,e,"f"),this.fill=!0,this.close=!0,this.lastPathTime=0,this.destroyed=!1,this.unbreakable=!1,this.splitCount=0,this.misplaced=!1,this.retina={maxDistance:{}};const y=n.retina.pixelRatio,m=n.actualOptions,f=new yB;f.load(m.particles);const G=f.shape.type,x=f.reduceDuplicates;if(this.shape=G instanceof Array?$i(G,this.id,x):G,s==null?void 0:s.shape){if(s.shape.type){const S=s.shape.type;this.shape=S instanceof Array?$i(S,this.id,x):S}const w=new EH;w.load(s.shape),this.shape&&(this.shapeData=this.loadShapeData(w,x))}else this.shapeData=this.loadShapeData(f.shape,x);s!==void 0&&f.load(s),((a=this.shapeData)===null||a===void 0?void 0:a.particles)!==void 0&&f.load((l=this.shapeData)===null||l===void 0?void 0:l.particles),this.fill=(g=(c=this.shapeData)===null||c===void 0?void 0:c.fill)!==null&&g!==void 0?g:this.fill,this.close=(u=(d=this.shapeData)===null||d===void 0?void 0:d.close)!==null&&u!==void 0?u:this.close,this.options=f,this.pathDelay=_g(this.options.move.path.delay)*1e3;const B=pn(this.options.zIndex.value);n.retina.initParticle(this);const M=this.options.size,E=M.value;this.size={enable:M.animation.enable,value:_g(M)*n.retina.pixelRatio,max:Os(E)*y,min:Wg(E)*y,loops:0,maxLoops:M.animation.count};const z=M.animation;if(z.enable){switch(this.size.status=0,z.startValue){case"min":this.size.value=this.size.min,this.size.status=0;break;case"random":this.size.value=Cr(this.size)*y,this.size.status=Math.random()>=.5?0:1;break;case"max":default:this.size.value=this.size.max,this.size.status=1;break}this.size.velocity=((h=this.retina.sizeAnimationSpeed)!==null&&h!==void 0?h:n.retina.sizeAnimationSpeed)/100*n.retina.reduceFactor,z.sync||(this.size.velocity*=Math.random())}this.direction=DE(this.options.move.direction),this.bubble={inRange:!1},this.initialVelocity=this.calculateVelocity(),this.velocity=this.initialVelocity.copy(),this.moveDecay=1-pn(this.options.move.decay),this.position=this.calcPosition(n,r,Us(B,0,n.zLayers)),this.initialPosition=this.position.copy(),this.offset=xn.origin;const J=n.particles;J.needsSort=J.needsSort||J.lastZIndex<this.position.z,J.lastZIndex=this.position.z,this.zIndexFactor=this.position.z/n.zLayers,this.sides=24;let V=n.drawers.get(this.shape);V||(V=A$(this,xb,"f").plugins.getShapeDrawer(this.shape),V&&n.drawers.set(this.shape,V)),(V==null?void 0:V.loadShape)&&(V==null||V.loadShape(this));const I=V==null?void 0:V.getSidesCount;if(I&&(this.sides=I(this)),this.life=this.loadLife(),this.spawning=this.life.delay>0,this.options.move.spin.enable){const w=(p=this.options.move.spin.position)!==null&&p!==void 0?p:{x:50,y:50},S={x:w.x/100*n.canvas.size.width,y:w.y/100*n.canvas.size.height},R=this.getPosition(),W=ui(R,S);this.spin={center:S,direction:this.velocity.x>=0?"clockwise":"counter-clockwise",angle:this.velocity.angle,radius:W,acceleration:(b=this.retina.spinAcceleration)!==null&&b!==void 0?b:pn(this.options.move.spin.acceleration)}}this.shadowColor=Nr(this.options.shadow.color);for(const w of n.particles.updaters)w.init&&w.init(this);V&&V.particleInit&&V.particleInit(n,this);for(const[,w]of n.plugins)w.particleCreated&&w.particleCreated(this)}isVisible(){return!this.destroyed&&!this.spawning&&this.isInsideCanvas()}isInsideCanvas(){const e=this.getRadius(),t=this.container.canvas.size;return this.position.x>=-e&&this.position.y>=-e&&this.position.y<=t.height+e&&this.position.x<=t.width+e}draw(e){const t=this.container;for(const[,n]of t.plugins)t.canvas.drawParticlePlugin(n,this,e);t.canvas.drawParticle(this,e)}getPosition(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y,z:this.position.z}}getRadius(){var e;return(e=this.bubble.radius)!==null&&e!==void 0?e:this.size.value}getMass(){return this.getRadius()**2*Math.PI/2}getFillColor(){var e,t;const n=(e=this.bubble.color)!==null&&e!==void 0?e:uB(this.color);if(n&&this.roll&&(this.backColor||this.roll.alter)){const r=this.options.roll.mode==="both"?2:1,s=this.options.roll.mode==="horizontal"?Math.PI/2:0;if(Math.floor((((t=this.roll.angle)!==null&&t!==void 0?t:0)+s)/(Math.PI/r))%2){if(this.backColor)return this.backColor;if(this.roll.alter)return AH(n,this.roll.alter.type,this.roll.alter.value)}}return n}getStrokeColor(){var e,t;return(t=(e=this.bubble.color)!==null&&e!==void 0?e:uB(this.strokeColor))!==null&&t!==void 0?t:this.getFillColor()}destroy(e){if(this.destroyed=!0,this.bubble.inRange=!1,this.unbreakable)return;this.destroyed=!0,this.bubble.inRange=!1;for(const[,n]of this.container.plugins)n.particleDestroyed&&n.particleDestroyed(this,e);if(e)return;this.options.destroy.mode==="split"&&this.split()}reset(){this.opacity&&(this.opacity.loops=0),this.size.loops=0}split(){const e=this.options.destroy.split;if(e.count>=0&&this.splitCount++>e.count)return;const t=pn(e.rate.value);for(let n=0;n<t;n++)this.container.particles.addSplitParticle(this)}calcPosition(e,t,n,r=0){var s,o,a,l,c,g;for(const[,m]of e.plugins){const f=m.particlePosition!==void 0?m.particlePosition(t,this):void 0;if(f!==void 0)return mr.create(f.x,f.y,n)}const d=e.canvas.size,u=mr.create((s=t==null?void 0:t.x)!==null&&s!==void 0?s:Math.random()*d.width,(o=t==null?void 0:t.y)!==null&&o!==void 0?o:Math.random()*d.height,n),h=this.getRadius(),p=this.options.move.outModes,b=m=>{FH({outMode:m,checkModes:["bounce","bounce-horizontal"],coord:u.x,maxCoord:e.canvas.size.width,setCb:f=>u.x+=f,radius:h})},y=m=>{FH({outMode:m,checkModes:["bounce","bounce-vertical"],coord:u.y,maxCoord:e.canvas.size.height,setCb:f=>u.y+=f,radius:h})};return b((a=p.left)!==null&&a!==void 0?a:p.default),b((l=p.right)!==null&&l!==void 0?l:p.default),y((c=p.top)!==null&&c!==void 0?c:p.default),y((g=p.bottom)!==null&&g!==void 0?g:p.default),this.checkOverlap(u,r)?this.calcPosition(e,void 0,n,r+1):u}checkOverlap(e,t=0){const n=this.options.collisions,r=this.getRadius();if(!n.enable)return!1;const s=n.overlap;if(s.enable)return!1;const o=s.retries;if(o>=0&&t>o)throw new Error("Particle is overlapping and can't be placed");let a=!1;for(const l of this.container.particles.array)if(ui(e,l.position)<r+l.getRadius()){a=!0;break}return a}calculateVelocity(){const t=UE(this.direction).copy(),n=this.options.move,r=Math.PI/180*n.angle.value,s=Math.PI/180*n.angle.offset,o={left:s-r/2,right:s+r/2};return n.straight||(t.angle+=Cr(zn(o.left,o.right))),n.random&&typeof n.speed=="number"&&(t.length*=Math.random()),t}loadShapeData(e,t){const n=e.options[this.shape];if(n)return Rn({},n instanceof Array?$i(n,this.id,t):n)}loadLife(){const e=this.container,t=this.options,n=t.life,r={delay:e.retina.reduceFactor?pn(n.delay.value)*(n.delay.sync?1:Math.random())/e.retina.reduceFactor*1e3:0,delayTime:0,duration:e.retina.reduceFactor?pn(n.duration.value)*(n.duration.sync?1:Math.random())/e.retina.reduceFactor*1e3:0,time:0,count:t.life.count};return r.duration<=0&&(r.duration=-1),r.count<=0&&(r.count=-1),r}}xb=new WeakMap;var b$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},wb=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Vg;class TH{constructor(e,t){this.container=t,Vg.set(this,void 0),b$(this,Vg,e,"f"),this.nextId=0,this.array=[],this.zArray=[],this.mover=new xH(t),this.limit=0,this.needsSort=!1,this.lastZIndex=0,this.freqs={links:new Map,triangles:new Map},this.interactionManager=new vH(wb(this,Vg,"f"),t);const n=this.container.canvas.size;this.linksColors=new Map,this.quadTree=new uc(new As(-n.width/4,-n.height/4,n.width*3/2,n.height*3/2),4),this.updaters=wb(this,Vg,"f").plugins.getUpdaters(t,!0)}get count(){return this.array.length}init(){var e;const t=this.container,n=t.actualOptions;this.lastZIndex=0,this.needsSort=!1,this.freqs.links=new Map,this.freqs.triangles=new Map;let r=!1;this.updaters=wb(this,Vg,"f").plugins.getUpdaters(t,!0),this.interactionManager.init();for(const[,s]of t.plugins)if(s.particlesInitialization!==void 0&&(r=s.particlesInitialization()),r)break;if(this.addManualParticles(),!r){for(const s in n.particles.groups){const o=n.particles.groups[s];for(let a=this.count,l=0;l<((e=o.number)===null||e===void 0?void 0:e.value)&&a<n.particles.number.value;a++,l++)this.addParticle(void 0,o,s)}for(let s=this.count;s<n.particles.number.value;s++)this.addParticle()}t.pathGenerator.init(t)}async redraw(){this.clear(),this.init(),await this.draw({value:0,factor:0})}removeAt(e,t=1,n,r){if(!(e>=0&&e<=this.count))return;let s=0;for(let o=e;s<t&&o<this.count;o++){const a=this.array[o];if(!a||a.group!==n)continue;a.destroy(r),this.array.splice(o--,1);const l=this.zArray.indexOf(a);this.zArray.splice(l,1),s++}}remove(e,t,n){this.removeAt(this.array.indexOf(e),void 0,t,n)}async update(e){const t=this.container,n=[];t.pathGenerator.update();for(const[,r]of t.plugins)r.update!==void 0&&r.update(e);for(const r of this.array){const s=t.canvas.resizeFactor;s&&(r.position.x*=s.width,r.position.y*=s.height),r.bubble.inRange=!1;for(const[,o]of this.container.plugins){if(r.destroyed)break;o.particleUpdate&&o.particleUpdate(r,e)}if(this.mover.move(r,e),r.destroyed){n.push(r);continue}this.quadTree.insert(new GH(r.getPosition(),r))}for(const r of n)this.remove(r);await this.interactionManager.externalInteract(e);for(const r of t.particles.array){for(const s of this.updaters)s.update(r,e);!r.destroyed&&!r.spawning&&await this.interactionManager.particlesInteract(r,e)}delete t.canvas.resizeFactor}async draw(e){const t=this.container;t.canvas.clear();const n=this.container.canvas.size;this.quadTree=new uc(new As(-n.width/4,-n.height/4,n.width*3/2,n.height*3/2),4),await this.update(e),this.needsSort&&(this.zArray.sort((r,s)=>s.position.z-r.position.z||r.id-s.id),this.lastZIndex=this.zArray[this.zArray.length-1].position.z,this.needsSort=!1);for(const[,r]of t.plugins)t.canvas.drawPlugin(r,e);for(const r of this.zArray)r.draw(e)}clear(){this.array=[],this.zArray=[]}push(e,t,n,r){this.pushing=!0;for(let s=0;s<e;s++)this.addParticle(t==null?void 0:t.position,n,r);this.pushing=!1}addParticle(e,t,n){const r=this.container,s=r.actualOptions,o=s.particles.number.limit*r.density;if(o>0){const a=this.count+1-o;a>0&&this.removeQuantity(a)}return this.pushParticle(e,t,n)}addSplitParticle(e){const t=e.options.destroy.split,n=new yB;n.load(e.options);const r=pn(t.factor.value);n.color.load({value:{hsl:e.getFillColor()}}),typeof n.size.value=="number"?n.size.value/=r:(n.size.value.min/=r,n.size.value.max/=r),n.load(t.particles);const s=t.sizeOffset?zn(-e.size.value,e.size.value):0,o={x:e.position.x+Cr(s),y:e.position.y+Cr(s)};return this.pushParticle(o,n,e.group,a=>a.size.value<.5?!1:(a.velocity.length=Cr(zn(e.velocity.length,a.velocity.length)),a.splitCount=e.splitCount+1,a.unbreakable=!0,setTimeout(()=>{a.unbreakable=!1},500),!0))}removeQuantity(e,t){this.removeAt(0,e,t)}getLinkFrequency(e,t){const n=zn(e.id,t.id),r=`${Wg(n)}_${Os(n)}`;let s=this.freqs.links.get(r);return s===void 0&&(s=Math.random(),this.freqs.links.set(r,s)),s}getTriangleFrequency(e,t,n){let[r,s,o]=[e.id,t.id,n.id];r>s&&([s,r]=[r,s]),s>o&&([o,s]=[s,o]),r>o&&([o,r]=[r,o]);const a=`${r}_${s}_${o}`;let l=this.freqs.triangles.get(a);return l===void 0&&(l=Math.random(),this.freqs.triangles.set(a,l)),l}addManualParticles(){const e=this.container,t=e.actualOptions;for(const n of t.manualParticles){const r=n.position?{x:n.position.x*e.canvas.size.width/100,y:n.position.y*e.canvas.size.height/100}:void 0;this.addParticle(r,n.options)}}setDensity(){const e=this.container.actualOptions;for(const t in e.particles.groups)this.applyDensity(e.particles.groups[t],0,t);this.applyDensity(e.particles,e.manualParticles.length)}applyDensity(e,t,n){var r;if(!((r=e.number.density)===null||r===void 0?void 0:r.enable))return;const s=e.number,o=this.initDensityFactor(s.density),a=s.value,l=s.limit>0?s.limit:a,c=Math.min(a,l)*o+t,g=Math.min(this.count,this.array.filter(d=>d.group===n).length);this.limit=s.limit*o,g<c?this.push(Math.abs(c-g),void 0,e,n):g>c&&this.removeQuantity(g-c,n)}initDensityFactor(e){const t=this.container;if(!t.canvas.element||!e.enable)return 1;const n=t.canvas.element,r=t.retina.pixelRatio;return n.width*n.height/(e.factor*r**2*e.area)}pushParticle(e,t,n,r){try{const s=new LH(wb(this,Vg,"f"),this.nextId,this.container,e,t,n);let o=!0;return r&&(o=r(s)),o?(this.array.push(s),this.zArray.push(s),this.nextId++,s):void 0}catch(s){console.warn(`error adding particle: ${s}`);return}}}Vg=new WeakMap;class XH{constructor(e){this.container=e}init(){const e=this.container,t=e.actualOptions;this.pixelRatio=!t.detectRetina||cc()?1:window.devicePixelRatio;const n=this.container.actualOptions.motion;if(n&&(n.disable||n.reduce.value))if(cc()||typeof matchMedia=="undefined"||!matchMedia)this.reduceFactor=1;else{const a=matchMedia("(prefers-reduced-motion: reduce)");if(a){this.handleMotionChange(a);const l=()=>{this.handleMotionChange(a),e.refresh().catch(()=>{})};a.addEventListener!==void 0?a.addEventListener("change",l):a.addListener!==void 0&&a.addListener(l)}}else this.reduceFactor=1;const r=this.pixelRatio;if(e.canvas.element){const a=e.canvas.element;e.canvas.size.width=a.offsetWidth*r,e.canvas.size.height=a.offsetHeight*r}const s=t.particles;this.attractDistance=s.move.attract.distance*r,this.linksDistance=s.links.distance*r,this.linksWidth=s.links.width*r,this.sizeAnimationSpeed=s.size.animation.speed*r,this.maxSpeed=s.move.gravity.maxSpeed*r,s.orbit.radius!==void 0&&(this.orbitRadius=s.orbit.radius*this.container.retina.pixelRatio);const o=t.interactivity.modes;this.connectModeDistance=o.connect.distance*r,this.connectModeRadius=o.connect.radius*r,this.grabModeDistance=o.grab.distance*r,this.repulseModeDistance=o.repulse.distance*r,this.bounceModeDistance=o.bounce.distance*r,this.attractModeDistance=o.attract.distance*r,this.slowModeRadius=o.slow.radius*r,this.bubbleModeDistance=o.bubble.distance*r,o.bubble.size&&(this.bubbleModeSize=o.bubble.size*r)}initParticle(e){const t=e.options,n=this.pixelRatio,r=t.move.distance,s=e.retina;s.attractDistance=t.move.attract.distance*n,s.linksDistance=t.links.distance*n,s.linksWidth=t.links.width*n,s.moveDrift=pn(t.move.drift)*n,s.moveSpeed=pn(t.move.speed)*n,s.sizeAnimationSpeed=t.size.animation.speed*n,e.spin&&(s.spinAcceleration=pn(t.move.spin.acceleration)*n);const o=s.maxDistance;o.horizontal=r.horizontal!==void 0?r.horizontal*n:void 0,o.vertical=r.vertical!==void 0?r.vertical*n:void 0,s.maxSpeed=t.move.gravity.maxSpeed*n}handleMotionChange(e){const t=this.container.actualOptions;if(e.matches){const n=t.motion;this.reduceFactor=n.disable?0:n.reduce.value?1/n.reduce.factor:1}else this.reduceFactor=1}}var y$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Co=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},ss;class zH{constructor(e,t,n,...r){this.id=t,ss.set(this,void 0),y$(this,ss,e,"f"),this.fpsLimit=120,this.duration=0,this.lifeTime=0,this.firstStart=!0,this.started=!1,this.destroyed=!1,this.paused=!0,this.lastFrameTime=0,this.zLayers=100,this.pageHidden=!1,this._sourceOptions=n,this._initialSourceOptions=n,this.retina=new XH(this),this.canvas=new BH(this),this.particles=new TH(Co(this,ss,"f"),this),this.drawer=new yH(this),this.presets=r,this.pathGenerator={generate:()=>{const s=xn.create(0,0);return s.length=Math.random(),s.angle=Math.random()*Math.PI*2,s},init:()=>{},update:()=>{}},this.interactivity={mouse:{clicking:!1,inside:!1}},this.bubble={},this.repulse={particles:[]},this.attract={particles:[]},this.plugins=new Map,this.drawers=new Map,this.density=1,this._options=new EC(Co(this,ss,"f")),this.actualOptions=new EC(Co(this,ss,"f")),this.eventListeners=new bH(this),typeof IntersectionObserver!="undefined"&&IntersectionObserver&&(this.intersectionObserver=new IntersectionObserver(s=>this.intersectionManager(s)))}get options(){return this._options}get sourceOptions(){return this._sourceOptions}play(e){const t=this.paused||e;if(this.firstStart&&!this.actualOptions.autoPlay){this.firstStart=!1;return}if(this.paused&&(this.paused=!1),t)for(const[,n]of this.plugins)n.play&&n.play();this.draw(t||!1)}pause(){if(this.drawAnimationFrame!==void 0&&(jE()(this.drawAnimationFrame),delete this.drawAnimationFrame),!this.paused){for(const[,e]of this.plugins)e.pause&&e.pause();this.pageHidden||(this.paused=!0)}}draw(e){let t=e;this.drawAnimationFrame=QE()(async n=>{t&&(this.lastFrameTime=void 0,t=!1),await this.drawer.nextFrame(n)})}getAnimationStatus(){return!this.paused&&!this.pageHidden}setNoise(e,t,n){this.setPath(e,t,n)}setPath(e,t,n){var r,s,o;if(!!e)if(typeof e=="function")this.pathGenerator.generate=e,t&&(this.pathGenerator.init=t),n&&(this.pathGenerator.update=n);else{const a=this.pathGenerator;this.pathGenerator=e,(r=this.pathGenerator).generate||(r.generate=a.generate),(s=this.pathGenerator).init||(s.init=a.init),(o=this.pathGenerator).update||(o.update=a.update)}}destroy(){this.stop(),this.canvas.destroy();for(const[,e]of this.drawers)e.destroy&&e.destroy(this);for(const e of this.drawers.keys())this.drawers.delete(e);this.destroyed=!0}exportImg(e){this.exportImage(e)}exportImage(e,t,n){var r;return(r=this.canvas.element)===null||r===void 0?void 0:r.toBlob(e,t!=null?t:"image/png",n)}exportConfiguration(){return JSON.stringify(this.actualOptions,void 0,2)}refresh(){return this.stop(),this.start()}reset(){return this._options=new EC(Co(this,ss,"f")),this.refresh()}stop(){if(!!this.started){this.firstStart=!0,this.started=!1,this.eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.canvas.clear(),this.interactivity.element instanceof HTMLElement&&this.intersectionObserver&&this.intersectionObserver.unobserve(this.interactivity.element);for(const[,e]of this.plugins)e.stop&&e.stop();for(const e of this.plugins.keys())this.plugins.delete(e);this.particles.linksColors=new Map,delete this.particles.grabLineColor,delete this.particles.linksColor,this._sourceOptions=this._options}}async loadTheme(e){this.currentTheme=e,await this.refresh()}async start(){if(!this.started){await this.init(),this.started=!0,this.eventListeners.addListeners(),this.interactivity.element instanceof HTMLElement&&this.intersectionObserver&&this.intersectionObserver.observe(this.interactivity.element);for(const[,e]of this.plugins)e.startAsync!==void 0?await e.startAsync():e.start!==void 0&&e.start();this.play()}}addClickHandler(e){const t=this.interactivity.element;if(!t)return;const n=(d,u,h)=>{if(this.destroyed)return;const p=this.retina.pixelRatio,b={x:u.x*p,y:u.y*p},y=this.particles.quadTree.queryCircle(b,h*p);e(d,y)},r=d=>{if(this.destroyed)return;const u=d,h={x:u.offsetX||u.clientX,y:u.offsetY||u.clientY};n(d,h,1)},s=()=>{this.destroyed||(c=!0,g=!1)},o=()=>{this.destroyed||(g=!0)},a=d=>{var u,h,p;if(!this.destroyed){if(c&&!g){const b=d;let y=b.touches[b.touches.length-1];if(!y&&(y=b.changedTouches[b.changedTouches.length-1],!y))return;const m=(u=this.canvas.element)===null||u===void 0?void 0:u.getBoundingClientRect(),f={x:y.clientX-((h=m==null?void 0:m.left)!==null&&h!==void 0?h:0),y:y.clientY-((p=m==null?void 0:m.top)!==null&&p!==void 0?p:0)};n(d,f,Math.max(y.radiusX,y.radiusY))}c=!1,g=!1}},l=()=>{this.destroyed||(c=!1,g=!1)};let c=!1,g=!1;t.addEventListener("click",r),t.addEventListener("touchstart",s),t.addEventListener("touchmove",o),t.addEventListener("touchend",a),t.addEventListener("touchcancel",l)}updateActualOptions(){this.actualOptions.responsive=[];const e=this.actualOptions.setResponsive(this.canvas.size.width,this.retina.pixelRatio,this._options);return this.actualOptions.setTheme(this.currentTheme),this.responsiveMaxWidth!=e?(this.responsiveMaxWidth=e,!0):!1}async init(){this._options=new EC(Co(this,ss,"f"));for(const r of this.presets)this._options.load(Co(this,ss,"f").plugins.getPreset(r));const e=Co(this,ss,"f").plugins.getSupportedShapes();for(const r of e){const s=Co(this,ss,"f").plugins.getShapeDrawer(r);s&&this.drawers.set(r,s)}this._options.load(this._initialSourceOptions),this._options.load(this._sourceOptions),this.actualOptions=new EC(Co(this,ss,"f")),this.actualOptions.load(this._options),this.retina.init(),this.canvas.init(),this.updateActualOptions(),this.canvas.initBackground(),this.canvas.resize(),this.zLayers=this.actualOptions.zLayers,this.duration=pn(this.actualOptions.duration),this.lifeTime=0,this.fpsLimit=this.actualOptions.fpsLimit>0?this.actualOptions.fpsLimit:120;const t=Co(this,ss,"f").plugins.getAvailablePlugins(this);for(const[r,s]of t)this.plugins.set(r,s);for(const[,r]of this.drawers)r.init&&await r.init(this);for(const[,r]of this.plugins)r.init?r.init(this.actualOptions):r.initAsync!==void 0&&await r.initAsync(this.actualOptions);const n=this.actualOptions.particles.move.path;n.generator&&this.setPath(Co(this,ss,"f").plugins.getPathGenerator(n.generator)),this.particles.init(),this.particles.setDensity();for(const[,r]of this.plugins)r.particlesSetup!==void 0&&r.particlesSetup()}intersectionManager(e){if(!!this.actualOptions.pauseOnOutsideViewport)for(const t of e)t.target===this.interactivity.element&&(t.isIntersecting?this.play():this.pause())}}ss=new WeakMap;var v$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},kH=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},HC;function x$(i){console.error(`Error tsParticles - fetch status: ${i}`),console.error("Error tsParticles - File config not found")}class YH{constructor(e){HC.set(this,void 0),v$(this,HC,e,"f")}dom(){return kH(this,HC,"f").domArray}domItem(e){const t=this.dom(),n=t[e];if(n&&!n.destroyed)return n;t.splice(e,1)}async loadOptions(e){var t,n,r;const s=(t=e.tagId)!==null&&t!==void 0?t:`tsparticles${Math.floor(Math.random()*1e4)}`,{options:o,index:a}=e;let l=(n=e.element)!==null&&n!==void 0?n:document.getElementById(s);l||(l=document.createElement("div"),l.id=s,(r=document.querySelector("body"))===null||r===void 0||r.append(l));const c=o instanceof Array?$i(o,a):o,g=this.dom(),d=g.findIndex(p=>p.id===s);if(d>=0){const p=this.domItem(d);p&&!p.destroyed&&(p.destroy(),g.splice(d,1))}let u;if(l.tagName.toLowerCase()==="canvas")u=l,u.dataset[Wt.generatedAttribute]="false";else{const p=l.getElementsByTagName("canvas");p.length?(u=p[0],u.dataset[Wt.generatedAttribute]="false"):(u=document.createElement("canvas"),u.dataset[Wt.generatedAttribute]="true",u.style.width="100%",u.style.height="100%",l.appendChild(u))}const h=new zH(kH(this,HC,"f"),s,c);return d>=0?g.splice(d,0,h):g.push(h),h.canvas.loadCanvas(u),await h.start(),h}async loadRemoteOptions(e){const{url:t,index:n}=e,r=t instanceof Array?$i(t,n):t;if(!r)return;const s=await fetch(r);if(!s.ok){x$(s.status);return}const o=await s.json();return this.loadOptions({tagId:e.tagId,element:e.element,index:n,options:o})}load(e,t,n){const r={index:n};return typeof e=="string"?r.tagId=e:r.options=e,typeof t=="number"?r.index=t!=null?t:r.index:r.options=t!=null?t:r.options,this.loadOptions(r)}async set(e,t,n,r){const s={index:r};return typeof e=="string"?s.tagId=e:s.element=e,t instanceof HTMLElement?s.element=t:s.options=t,typeof n=="number"?s.index=n:s.options=n!=null?n:s.options,this.loadOptions(s)}async loadJSON(e,t,n){let r,s;return typeof t=="number"||t===void 0?r=e:(s=e,r=t),this.loadRemoteOptions({tagId:s,url:r,index:n})}async setJSON(e,t,n,r){let s,o,a,l;return e instanceof HTMLElement?(l=e,s=t,a=n):(o=e,l=t,s=n,a=r),this.loadRemoteOptions({tagId:o,url:s,index:a,element:l})}setOnClickHandler(e){const t=this.dom();if(t.length===0)throw new Error("Can only set click handlers after calling tsParticles.load() or tsParticles.loadJSON()");for(const n of t)n.addClickHandler(e)}}HC=new WeakMap;var vB=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Da=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},FC,po;class xB{constructor(){FC.set(this,void 0),po.set(this,void 0),vB(this,FC,!1,"f"),this.domArray=[],vB(this,po,new YH(this),"f"),this.plugins=new wH(this)}init(){Da(this,FC,"f")||vB(this,FC,!0,"f")}async loadFromArray(e,t,n){return Da(this,po,"f").load(e,t,n)}async load(e,t){return Da(this,po,"f").load(e,t)}async set(e,t,n){return Da(this,po,"f").set(e,t,n)}async loadJSON(e,t,n){return Da(this,po,"f").loadJSON(e,t,n)}async setJSON(e,t,n,r){return Da(this,po,"f").setJSON(e,t,n,r)}setOnClickHandler(e){Da(this,po,"f").setOnClickHandler(e)}dom(){return Da(this,po,"f").dom()}domItem(e){return Da(this,po,"f").domItem(e)}async refresh(){for(const e of this.dom())await e.refresh()}async addShape(e,t,n,r,s){let o;typeof t=="function"?o={afterEffect:r,destroy:s,draw:t,init:n}:o=t,this.plugins.addShapeDrawer(e,o),await this.refresh()}async addPreset(e,t,n=!1){this.plugins.addPreset(e,t,n),await this.refresh()}async addPlugin(e){this.plugins.addPlugin(e),await this.refresh()}async addPathGenerator(e,t){this.plugins.addPathGenerator(e,t),await this.refresh()}async addInteractor(e,t){this.plugins.addInteractor(e,t),await this.refresh()}async addParticleUpdater(e,t){this.plugins.addParticleUpdater(e,t),await this.refresh()}}FC=new WeakMap,po=new WeakMap;const w$=i=>{const e=(n,r)=>i.load(n,r);e.load=(n,r,s)=>{i.loadJSON(n,r).then(o=>{o&&s(o)}).catch(()=>{s(void 0)})},e.setOnClickHandler=n=>{i.setOnClickHandler(n)};const t=i.dom();return{particlesJS:e,pJSDom:t}};class G${constructor(){this.radius=0,this.mass=0}load(e){!e||(e.mass!==void 0&&(this.mass=e.mass),e.radius!==void 0&&(this.radius=e.radius))}}class B$ extends rs{constructor(){super();this.density=5,this.random.minimumValue=1,this.value=50,this.limit=new G$}load(e){!e||(super.load(e),e.density!==void 0&&(this.density=e.density),typeof e.limit=="number"?this.limit.radius=e.limit:this.limit.load(e.limit))}}class ia{constructor(){this.color=new nn,this.color.value="#000000",this.draggable=!1,this.opacity=1,this.destroy=!0,this.orbits=!1,this.size=new B$}load(e){e!==void 0&&(e.color!==void 0&&(this.color=nn.create(this.color,e.color)),e.draggable!==void 0&&(this.draggable=e.draggable),this.name=e.name,e.opacity!==void 0&&(this.opacity=e.opacity),e.position!==void 0&&(this.position={x:e.position.x,y:e.position.y}),e.size!==void 0&&this.size.load(e.size),e.destroy!==void 0&&(this.destroy=e.destroy),e.orbits!==void 0&&(this.orbits=e.orbits))}}class S${constructor(e,t,n,r){var s,o,a;this.absorbers=e,this.container=t,this.initialPosition=r?xn.create(r.x,r.y):void 0,n instanceof ia?this.options=n:(this.options=new ia,this.options.load(n)),this.dragging=!1,this.name=this.options.name,this.opacity=this.options.opacity,this.size=pn(this.options.size.value)*t.retina.pixelRatio,this.mass=this.size*this.options.size.density*t.retina.reduceFactor;const l=this.options.size.limit;this.limit={radius:l.radius*t.retina.pixelRatio*t.retina.reduceFactor,mass:l.mass},this.color=(s=Nr(this.options.color))!==null&&s!==void 0?s:{b:0,g:0,r:0},this.position=(a=(o=this.initialPosition)===null||o===void 0?void 0:o.copy())!==null&&a!==void 0?a:this.calcPosition()}attract(e){const t=this.container,n=this.options;if(n.draggable){const c=t.interactivity.mouse;c.clicking&&c.downPosition?ui(this.position,c.downPosition)<=this.size&&(this.dragging=!0):this.dragging=!1,this.dragging&&c.position&&(this.position.x=c.position.x,this.position.y=c.position.y)}const r=e.getPosition(),{dx:s,dy:o,distance:a}=pr(this.position,r),l=xn.create(s,o);if(l.length=this.mass/Math.pow(a,2)*t.retina.reduceFactor,a<this.size+e.getRadius()){const c=e.getRadius()*.033*t.retina.pixelRatio;this.size>e.getRadius()&&a<this.size-e.getRadius()||e.absorberOrbit!==void 0&&e.absorberOrbit.length<0?n.destroy?e.destroy():(e.needsNewPosition=!0,this.updateParticlePosition(e,l)):(n.destroy&&(e.size.value-=c),this.updateParticlePosition(e,l)),(this.limit.radius<=0||this.size<this.limit.radius)&&(this.size+=c),(this.limit.mass<=0||this.mass<this.limit.mass)&&(this.mass+=c*this.options.size.density*t.retina.reduceFactor)}else this.updateParticlePosition(e,l)}resize(){const e=this.initialPosition;this.position=e&&Ud(e,this.container.canvas.size)?e:this.calcPosition()}draw(e){e.translate(this.position.x,this.position.y),e.beginPath(),e.arc(0,0,this.size,0,Math.PI*2,!1),e.closePath(),e.fillStyle=ms(this.color,this.opacity),e.fill()}calcPosition(){var e,t;const n=this.container,r=this.options.position;return xn.create(((e=r==null?void 0:r.x)!==null&&e!==void 0?e:Math.random()*100)/100*n.canvas.size.width,((t=r==null?void 0:r.y)!==null&&t!==void 0?t:Math.random()*100)/100*n.canvas.size.height)}updateParticlePosition(e,t){var n;if(e.destroyed)return;const r=this.container,s=r.canvas.size;if(e.needsNewPosition&&(e.position.x=Math.floor(Math.random()*s.width),e.position.y=Math.floor(Math.random()*s.height),e.velocity.setTo(e.initialVelocity),e.absorberOrbit=void 0,e.needsNewPosition=!1),this.options.orbits){if(e.absorberOrbit===void 0&&(e.absorberOrbit=xn.create(0,0),e.absorberOrbit.length=ui(e.getPosition(),this.position),e.absorberOrbit.angle=Math.random()*Math.PI*2),e.absorberOrbit.length<=this.size&&!this.options.destroy){const g=Math.min(s.width,s.height);e.absorberOrbit.length=g*(1+(Math.random()*.2-.1))}e.absorberOrbitDirection===void 0&&(e.absorberOrbitDirection=e.velocity.x>=0?"clockwise":"counter-clockwise");const o=e.absorberOrbit.length,a=e.absorberOrbit.angle,l=e.absorberOrbitDirection;e.velocity.x=0,e.velocity.y=0;const c={x:l==="clockwise"?Math.cos:Math.sin,y:l==="clockwise"?Math.sin:Math.cos};e.position.x=this.position.x+o*c.x(a),e.position.y=this.position.y+o*c.y(a),e.absorberOrbit.length-=t.length,e.absorberOrbit.angle+=((n=e.retina.moveSpeed)!==null&&n!==void 0?n:0)*r.retina.pixelRatio/100*r.retina.reduceFactor}else{const o=xn.origin;o.length=t.length,o.angle=t.angle,e.velocity.addTo(o)}}}class Z${constructor(e){this.container=e,this.array=[],this.absorbers=[],this.interactivityAbsorbers=[];const t=e;t.getAbsorber=n=>n===void 0||typeof n=="number"?this.array[n||0]:this.array.find(r=>r.name===n),t.addAbsorber=(n,r)=>this.addAbsorber(n,r)}init(e){var t,n;if(!e)return;e.absorbers&&(e.absorbers instanceof Array?this.absorbers=e.absorbers.map(s=>{const o=new ia;return o.load(s),o}):(this.absorbers instanceof Array&&(this.absorbers=new ia),this.absorbers.load(e.absorbers)));const r=(n=(t=e.interactivity)===null||t===void 0?void 0:t.modes)===null||n===void 0?void 0:n.absorbers;if(r&&(r instanceof Array?this.interactivityAbsorbers=r.map(s=>{const o=new ia;return o.load(s),o}):(this.interactivityAbsorbers instanceof Array&&(this.interactivityAbsorbers=new ia),this.interactivityAbsorbers.load(r))),this.absorbers instanceof Array)for(const s of this.absorbers)this.addAbsorber(s);else this.addAbsorber(this.absorbers)}particleUpdate(e){for(const t of this.array)if(t.attract(e),e.destroyed)break}draw(e){for(const t of this.array)e.save(),t.draw(e),e.restore()}stop(){this.array=[]}resize(){for(const e of this.array)e.resize()}handleClickMode(e){const t=this.container,n=this.absorbers,r=this.interactivityAbsorbers;if(e==="absorber"){let s;r instanceof Array?r.length>0&&(s=$i(r)):s=r;const o=s!=null?s:n instanceof Array?$i(n):n,a=t.interactivity.mouse.clickPosition;this.addAbsorber(o,a)}}addAbsorber(e,t){const n=new S$(this,this.container,e,t);return this.array.push(n),n}removeAbsorber(e){const t=this.array.indexOf(e);t>=0&&this.array.splice(t,1)}}class R${constructor(){this.id="absorbers"}getPlugin(e){return new Z$(e)}needsPlugin(e){var t,n,r;if(e===void 0)return!1;const s=e.absorbers;let o=!1;return s instanceof Array?s.length&&(o=!0):(s!==void 0||((r=(n=(t=e.interactivity)===null||t===void 0?void 0:t.events)===null||n===void 0?void 0:n.onClick)===null||r===void 0?void 0:r.mode)&&bn("absorber",e.interactivity.events.onClick.mode))&&(o=!0),o}loadOptions(e,t){var n,r;if(!this.needsPlugin(e)&&!this.needsPlugin(t))return;const s=e;if(t==null?void 0:t.absorbers)if((t==null?void 0:t.absorbers)instanceof Array)s.absorbers=t==null?void 0:t.absorbers.map(a=>{const l=new ia;return l.load(a),l});else{let a=s.absorbers;(a==null?void 0:a.load)===void 0&&(s.absorbers=a=new ia),a.load(t==null?void 0:t.absorbers)}const o=(r=(n=t==null?void 0:t.interactivity)===null||n===void 0?void 0:n.modes)===null||r===void 0?void 0:r.absorbers;if(o)if(o instanceof Array)s.interactivity.modes.absorbers=o.map(a=>{const l=new ia;return l.load(a),l});else{let a=s.interactivity.modes.absorbers;(a==null?void 0:a.load)===void 0&&(s.interactivity.modes.absorbers=a=new ia),a.load(o)}}}async function M$(i){const e=new R$;await i.addPlugin(e)}class W${randomPosition(e,t,n){const r=(d,u)=>{const h=Math.random()/4,p=Math.atan(u/d*Math.tan(2*Math.PI*h)),b=Math.random();return b<.25?p:b<.5?Math.PI-p:b<.75?Math.PI+p:-p},s=(d,u,h)=>d*u/Math.sqrt((u*Math.cos(h))**2+(d*Math.sin(h))**2),[o,a]=[t.width/2,t.height/2],l=r(o,a),c=s(o,a,l),g=n?c*Math.sqrt(Math.random()):c;return{x:e.x+g*Math.cos(l),y:e.y+g*Math.sin(l)}}}class _${constructor(){this.wait=!1}load(e){e!==void 0&&(e.count!==void 0&&(this.count=e.count),e.delay!==void 0&&(this.delay=e.delay),e.duration!==void 0&&(this.duration=e.duration),e.wait!==void 0&&(this.wait=e.wait))}}class V${constructor(){this.quantity=1,this.delay=.1}load(e){e!==void 0&&(e.quantity!==void 0&&(this.quantity=zn(e.quantity)),e.delay!==void 0&&(this.delay=zn(e.delay)))}}class KH{constructor(){this.mode="percent",this.height=0,this.width=0}load(e){e!==void 0&&(e.mode!==void 0&&(this.mode=e.mode),e.height!==void 0&&(this.height=e.height),e.width!==void 0&&(this.width=e.width))}}class mo{constructor(){this.autoPlay=!0,this.fill=!0,this.life=new _$,this.rate=new V$,this.shape="square",this.startCount=0}load(e){e!==void 0&&(e.autoPlay!==void 0&&(this.autoPlay=e.autoPlay),e.size!==void 0&&(this.size===void 0&&(this.size=new KH),this.size.load(e.size)),e.direction!==void 0&&(this.direction=e.direction),this.domId=e.domId,e.fill!==void 0&&(this.fill=e.fill),this.life.load(e.life),this.name=e.name,e.particles!==void 0&&(this.particles=Rn({},e.particles)),this.rate.load(e.rate),e.shape!==void 0&&(this.shape=e.shape),e.position!==void 0&&(this.position={x:e.position.x,y:e.position.y}),e.spawnColor!==void 0&&(this.spawnColor===void 0&&(this.spawnColor=new dc),this.spawnColor.load(e.spawnColor)),e.startCount!==void 0&&(this.startCount=e.startCount))}}var LC=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Gb=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Qd,TC,Bb;class N${constructor(e,t,n,r,s){var o,a,l,c,g,d,u,h;this.emitters=t,this.container=n,Qd.set(this,void 0),TC.set(this,void 0),Bb.set(this,void 0),LC(this,Bb,e,"f"),this.currentDuration=0,this.currentEmitDelay=0,this.currentSpawnDelay=0,this.initialPosition=s,r instanceof mo?this.options=r:(this.options=new mo,this.options.load(r)),this.spawnDelay=((o=this.options.life.delay)!==null&&o!==void 0?o:0)*1e3/this.container.retina.reduceFactor,this.position=(a=this.initialPosition)!==null&&a!==void 0?a:this.calcPosition(),this.name=this.options.name,this.shape=(l=Gb(this,Bb,"f").emitterShapeManager)===null||l===void 0?void 0:l.getShape(this.options.shape),this.fill=this.options.fill,LC(this,Qd,!this.options.life.wait,"f"),LC(this,TC,!1,"f");let p=Rn({},this.options.particles);p!=null||(p={}),(c=p.move)!==null&&c!==void 0||(p.move={}),(g=(h=p.move).direction)!==null&&g!==void 0||(h.direction=this.options.direction),this.options.spawnColor&&(this.spawnColor=Ka(this.options.spawnColor)),this.paused=!this.options.autoPlay,this.particlesOptions=p,this.size=(d=this.options.size)!==null&&d!==void 0?d:(()=>{const b=new KH;return b.load({height:0,mode:"percent",width:0}),b})(),this.lifeCount=(u=this.options.life.count)!==null&&u!==void 0?u:-1,this.immortal=this.lifeCount<=0,this.play()}externalPlay(){this.paused=!1,this.play()}externalPause(){this.paused=!0,this.pause()}play(){var e;if(!this.paused&&this.container.retina.reduceFactor&&(this.lifeCount>0||this.immortal||!this.options.life.count)&&(Gb(this,Qd,"f")||this.currentSpawnDelay>=((e=this.spawnDelay)!==null&&e!==void 0?e:0))){if(this.emitDelay===void 0){const t=pn(this.options.rate.delay);this.emitDelay=1e3*t/this.container.retina.reduceFactor}(this.lifeCount>0||this.immortal)&&this.prepareToDie()}}pause(){this.paused||delete this.emitDelay}resize(){const e=this.initialPosition;this.position=e&&Ud(e,this.container.canvas.size)?e:this.calcPosition()}update(e){var t,n,r;this.paused||(Gb(this,Qd,"f")&&(LC(this,Qd,!1,"f"),this.currentSpawnDelay=(t=this.spawnDelay)!==null&&t!==void 0?t:0,this.currentEmitDelay=(n=this.emitDelay)!==null&&n!==void 0?n:0),Gb(this,TC,"f")||(LC(this,TC,!0,"f"),this.emitParticles(this.options.startCount)),this.duration!==void 0&&(this.currentDuration+=e.value,this.currentDuration>=this.duration&&(this.pause(),this.spawnDelay!==void 0&&delete this.spawnDelay,this.immortal||this.lifeCount--,this.lifeCount>0||this.immortal?(this.position=this.calcPosition(),this.spawnDelay=((r=this.options.life.delay)!==null&&r!==void 0?r:0)*1e3/this.container.retina.reduceFactor):this.destroy(),this.currentDuration-=this.duration,delete this.duration)),this.spawnDelay!==void 0&&(this.currentSpawnDelay+=e.value,this.currentSpawnDelay>=this.spawnDelay&&(this.play(),this.currentSpawnDelay-=this.currentSpawnDelay,delete this.spawnDelay)),this.emitDelay!==void 0&&(this.currentEmitDelay+=e.value,this.currentEmitDelay>=this.emitDelay&&(this.emit(),this.currentEmitDelay-=this.emitDelay)))}getPosition(){if(this.options.domId){const e=this.container,t=document.getElementById(this.options.domId);if(t){const n=t.getBoundingClientRect();return{x:(n.x+n.width/2)*e.retina.pixelRatio,y:(n.y+n.height/2)*e.retina.pixelRatio}}}return this.position}getSize(){const e=this.container;if(this.options.domId){const t=document.getElementById(this.options.domId);if(t){const n=t.getBoundingClientRect();return{width:n.width*e.retina.pixelRatio,height:n.height*e.retina.pixelRatio}}}return{width:this.size.mode==="percent"?e.canvas.size.width*this.size.width/100:this.size.width,height:this.size.mode==="percent"?e.canvas.size.height*this.size.height/100:this.size.height}}prepareToDie(){var e;if(this.paused)return;const t=(e=this.options.life)===null||e===void 0?void 0:e.duration;this.container.retina.reduceFactor&&(this.lifeCount>0||this.immortal)&&t!==void 0&&t>0&&(this.duration=t*1e3)}destroy(){this.emitters.removeEmitter(this)}calcPosition(){var e,t;const n=this.container,r=this.options.position;return{x:((e=r==null?void 0:r.x)!==null&&e!==void 0?e:Math.random()*100)/100*n.canvas.size.width,y:((t=r==null?void 0:r.y)!==null&&t!==void 0?t:Math.random()*100)/100*n.canvas.size.height}}emit(){if(this.paused)return;const e=pn(this.options.rate.quantity);this.emitParticles(e)}emitParticles(e){var t,n,r;const s=this.container,o=this.getPosition(),a=this.getSize();for(let l=0;l<e;l++){const c=Rn({},this.particlesOptions);if(this.spawnColor){const d=(t=this.options.spawnColor)===null||t===void 0?void 0:t.animation;d&&(this.spawnColor.h=this.setColorAnimation(d.h,this.spawnColor.h,360),this.spawnColor.s=this.setColorAnimation(d.s,this.spawnColor.s,100),this.spawnColor.l=this.setColorAnimation(d.l,this.spawnColor.l,100)),c.color?c.color.value=this.spawnColor:c.color={value:this.spawnColor}}if(!o)return;const g=(r=(n=this.shape)===null||n===void 0?void 0:n.randomPosition(o,a,this.fill))!==null&&r!==void 0?r:o;s.particles.addParticle(g,c)}}setColorAnimation(e,t,n){var r;const s=this.container;if(!e.enable)return t;const o=Cr(e.offset),a=pn(this.options.rate.delay),l=1e3*a/s.retina.reduceFactor,c=(r=e.speed)!==null&&r!==void 0?r:0;return(t+c*s.fpsLimit/l+o*3.6)%n}}Qd=new WeakMap,TC=new WeakMap,Bb=new WeakMap;var E$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},H$=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Sb;class F${constructor(e,t){this.container=t,Sb.set(this,void 0),E$(this,Sb,e,"f"),this.array=[],this.emitters=[],this.interactivityEmitters=[];const n=t;n.getEmitter=r=>r===void 0||typeof r=="number"?this.array[r||0]:this.array.find(s=>s.name===r),n.addEmitter=(r,s)=>this.addEmitter(r,s),n.removeEmitter=r=>{const s=n.getEmitter(r);s&&this.removeEmitter(s)},n.playEmitter=r=>{const s=n.getEmitter(r);s&&s.externalPlay()},n.pauseEmitter=r=>{const s=n.getEmitter(r);s&&s.externalPause()}}init(e){var t,n;if(!e)return;e.emitters&&(e.emitters instanceof Array?this.emitters=e.emitters.map(s=>{const o=new mo;return o.load(s),o}):(this.emitters instanceof Array&&(this.emitters=new mo),this.emitters.load(e.emitters)));const r=(n=(t=e.interactivity)===null||t===void 0?void 0:t.modes)===null||n===void 0?void 0:n.emitters;if(r&&(r instanceof Array?this.interactivityEmitters=r.map(s=>{const o=new mo;return o.load(s),o}):(this.interactivityEmitters instanceof Array&&(this.interactivityEmitters=new mo),this.interactivityEmitters.load(r))),this.emitters instanceof Array)for(const s of this.emitters)this.addEmitter(s);else this.addEmitter(this.emitters)}play(){for(const e of this.array)e.play()}pause(){for(const e of this.array)e.pause()}stop(){this.array=[]}update(e){for(const t of this.array)t.update(e)}handleClickMode(e){const t=this.container,n=this.emitters,r=this.interactivityEmitters;if(e==="emitter"){let s;r instanceof Array?r.length>0&&(s=$i(r)):s=r;const o=s!=null?s:n instanceof Array?$i(n):n,a=t.interactivity.mouse.clickPosition;this.addEmitter(Rn({},o),a)}}resize(){for(const e of this.array)e.resize()}addEmitter(e,t){const n=new mo;n.load(e);const r=new N$(H$(this,Sb,"f"),this,this.container,n,t);return this.array.push(r),r}removeEmitter(e){const t=this.array.indexOf(e);t>=0&&this.array.splice(t,1)}}Sb=new WeakMap;var L$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},wB;const GB=new Map;class T${constructor(e){wB.set(this,void 0),L$(this,wB,e,"f")}addShape(e,t){this.getShape(e)||GB.set(e,t)}getShape(e){return GB.get(e)}getSupportedShapes(){return GB.keys()}}wB=new WeakMap;function PH(i,e){return i+e*(Math.random()-.5)}class X${randomPosition(e,t,n){if(n)return{x:PH(e.x,t.width),y:PH(e.y,t.height)};{const r=t.width/2,s=t.height/2,o=Math.floor(Math.random()*4),a=(Math.random()-.5)*2;switch(o){case 0:return{x:e.x+a*r,y:e.y-s};case 1:return{x:e.x-r,y:e.y+a*s};case 2:return{x:e.x+a*r,y:e.y+s};case 3:default:return{x:e.x+r,y:e.y+a*s}}}}}var z$=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},k$=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Zb;class Y${constructor(e){Zb.set(this,void 0),z$(this,Zb,e,"f"),this.id="emitters"}getPlugin(e){return new F$(k$(this,Zb,"f"),e)}needsPlugin(e){var t,n,r;if(e===void 0)return!1;const s=e.emitters;return s instanceof Array&&!!s.length||s!==void 0||!!((r=(n=(t=e.interactivity)===null||t===void 0?void 0:t.events)===null||n===void 0?void 0:n.onClick)===null||r===void 0?void 0:r.mode)&&bn("emitter",e.interactivity.events.onClick.mode)}loadOptions(e,t){var n,r;if(!this.needsPlugin(e)&&!this.needsPlugin(t))return;const s=e;if(t==null?void 0:t.emitters)if((t==null?void 0:t.emitters)instanceof Array)s.emitters=t==null?void 0:t.emitters.map(a=>{const l=new mo;return l.load(a),l});else{let a=s.emitters;(a==null?void 0:a.load)===void 0&&(s.emitters=a=new mo),a.load(t==null?void 0:t.emitters)}const o=(r=(n=t==null?void 0:t.interactivity)===null||n===void 0?void 0:n.modes)===null||r===void 0?void 0:r.emitters;if(o)if(o instanceof Array)s.interactivity.modes.emitters=o.map(a=>{const l=new mo;return l.load(a),l});else{let a=s.interactivity.modes.emitters;(a==null?void 0:a.load)===void 0&&(s.interactivity.modes.emitters=a=new mo),a.load(o)}}}Zb=new WeakMap;async function K$(i){i.emitterShapeManager||(i.emitterShapeManager=new T$(i)),i.addEmitterShape||(i.addEmitterShape=(t,n)=>{var r;(r=i.emitterShapeManager)===null||r===void 0||r.addShape(t,n)});const e=new Y$(i);await i.addPlugin(e),i.addEmitterShape("circle",new W$),i.addEmitterShape("square",new X$)}class P$ extends gc{constructor(e){super(e);this.delay=0}async interact(e){var t,n,r,s;if(!this.container.retina.reduceFactor)return;const o=this.container,a=o.actualOptions,l=a.interactivity.modes.trail,c=l.delay*1e3/this.container.retina.reduceFactor;if(this.delay<c&&(this.delay+=e.value),this.delay<c)return;let g=!0;l.pauseOnStop&&(o.interactivity.mouse.position===this.lastPosition||((t=o.interactivity.mouse.position)===null||t===void 0?void 0:t.x)===((n=this.lastPosition)===null||n===void 0?void 0:n.x)&&((r=o.interactivity.mouse.position)===null||r===void 0?void 0:r.y)===((s=this.lastPosition)===null||s===void 0?void 0:s.y))&&(g=!1),o.interactivity.mouse.position?this.lastPosition={x:o.interactivity.mouse.position.x,y:o.interactivity.mouse.position.y}:delete this.lastPosition,g&&o.particles.push(l.quantity,o.interactivity.mouse,l.particles),this.delay-=c}isEnabled(){const e=this.container,t=e.actualOptions,n=e.interactivity.mouse,r=t.interactivity.events;return n.clicking&&n.inside&&!!n.position&&bn("trail",r.onClick.mode)||n.inside&&!!n.position&&bn("trail",r.onHover.mode)}reset(){}}async function D$(i){await i.addInteractor("externalTrail",e=>new P$(e))}class U${constructor(){this.color=new nn,this.width=.5,this.opacity=1}load(e){var t;!e||(this.color=nn.create(this.color,e.color),typeof this.color.value=="string"&&(this.opacity=(t=nH(this.color.value))!==null&&t!==void 0?t:this.opacity),e.opacity!==void 0&&(this.opacity=e.opacity),e.width!==void 0&&(this.width=e.width))}}class O${constructor(){this.enable=!1,this.stroke=new U$}get lineWidth(){return this.stroke.width}set lineWidth(e){this.stroke.width=e}get lineColor(){return this.stroke.color}set lineColor(e){this.stroke.color=nn.create(this.stroke.color,e)}load(e){var t;if(!e)return;e.enable!==void 0&&(this.enable=e.enable);const n=(t=e.stroke)!==null&&t!==void 0?t:{color:e.lineColor,width:e.lineWidth};this.stroke.load(n)}}class J${constructor(){this.arrangement="one-per-point"}load(e){!e||e.arrangement!==void 0&&(this.arrangement=e.arrangement)}}class Q${constructor(){this.path=[],this.size={height:0,width:0}}load(e){!e||(e.path!==void 0&&(this.path=e.path),e.size!==void 0&&(e.size.width!==void 0&&(this.size.width=e.size.width),e.size.height!==void 0&&(this.size.height=e.size.height)))}}class j${constructor(){this.radius=10,this.type="path"}load(e){!e||(e.radius!==void 0&&(this.radius=e.radius),e.type!==void 0&&(this.type=e.type))}}class DH{constructor(){this.draw=new O$,this.enable=!1,this.inline=new J$,this.move=new j$,this.scale=1,this.type="none"}get inlineArrangement(){return this.inline.arrangement}set inlineArrangement(e){this.inline.arrangement=e}load(e){var t;if(!e)return;this.draw.load(e.draw);const n=(t=e.inline)!==null&&t!==void 0?t:{arrangement:e.inlineArrangement};n!==void 0&&this.inline.load(n),this.move.load(e.move),e.scale!==void 0&&(this.scale=e.scale),e.type!==void 0&&(this.type=e.type),e.enable!==void 0?this.enable=e.enable:this.enable=this.type!=="none",e.url!==void 0&&(this.url=e.url),e.data!==void 0&&(typeof e.data=="string"?this.data=e.data:(this.data=new Q$,this.data.load(e.data))),e.position!==void 0&&(this.position=Rn({},e.position))}}function q$(i,e,t){const n=Nr(t.color);if(!!n){i.beginPath(),i.moveTo(e[0].x,e[0].y);for(const r of e)i.lineTo(r.x,r.y);i.closePath(),i.strokeStyle=ms(n),i.lineWidth=t.width,i.stroke()}}function $$(i,e,t,n){i.translate(n.x,n.y);const r=Nr(t.color);!r||(i.strokeStyle=ms(r,t.opacity),i.lineWidth=t.width,i.stroke(e))}function eee(i,e,t){var n;const r=[];for(const s of i){const o=s.element.pathSegList,a=(n=o==null?void 0:o.numberOfItems)!==null&&n!==void 0?n:0,l={x:0,y:0};for(let c=0;c<a;c++){const g=o==null?void 0:o.getItem(c),d=window.SVGPathSeg;switch(g==null?void 0:g.pathSegType){case d.PATHSEG_MOVETO_ABS:case d.PATHSEG_LINETO_ABS:case d.PATHSEG_CURVETO_CUBIC_ABS:case d.PATHSEG_CURVETO_QUADRATIC_ABS:case d.PATHSEG_ARC_ABS:case d.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:case d.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:{const u=g;l.x=u.x,l.y=u.y;break}case d.PATHSEG_LINETO_HORIZONTAL_ABS:l.x=g.x;break;case d.PATHSEG_LINETO_VERTICAL_ABS:l.y=g.y;break;case d.PATHSEG_LINETO_REL:case d.PATHSEG_MOVETO_REL:case d.PATHSEG_CURVETO_CUBIC_REL:case d.PATHSEG_CURVETO_QUADRATIC_REL:case d.PATHSEG_ARC_REL:case d.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:case d.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:{const u=g;l.x+=u.x,l.y+=u.y;break}case d.PATHSEG_LINETO_HORIZONTAL_REL:l.x+=g.x;break;case d.PATHSEG_LINETO_VERTICAL_REL:l.y+=g.y;break;case d.PATHSEG_UNKNOWN:case d.PATHSEG_CLOSEPATH:continue}r.push({x:l.x*e+t.x,y:l.y*e+t.y})}}return r}function tee(i,e,t){const{dx:n,dy:r}=pr(t,i),{dx:s,dy:o}=pr(e,i),a=(n*s+r*o)/(s**2+o**2),l={x:i.x+s*a,y:i.x+o*a,isOnSegment:a>=0&&a<=1};return a<0?(l.x=i.x,l.y=i.y):a>1&&(l.x=e.x,l.y=e.y),l}function nee(i,e,t){const{dx:n,dy:r}=pr(i,e),s=Math.atan2(r,n),o=xn.create(Math.sin(s),-Math.cos(s)),a=2*(t.x*o.x+t.y*o.y);o.multTo(a),t.subFrom(o)}class iee{constructor(e){this.container=e,this.dimension={height:0,width:0},this.path2DSupported=!!window.Path2D,this.options=new DH,this.polygonMaskMoveRadius=this.options.move.radius*e.retina.pixelRatio}async initAsync(e){this.options.load(e==null?void 0:e.polygon);const t=this.options;this.polygonMaskMoveRadius=t.move.radius*this.container.retina.pixelRatio,t.enable&&await this.initRawData()}resize(){const e=this.container,t=this.options;!(t.enable&&t.type!=="none")||(this.redrawTimeout&&clearTimeout(this.redrawTimeout),this.redrawTimeout=window.setTimeout(async()=>{await this.initRawData(!0),await e.particles.redraw()},250))}stop(){delete this.raw,delete this.paths}particlesInitialization(){const e=this.options;return e.enable&&e.type==="inline"&&(e.inline.arrangement==="one-per-point"||e.inline.arrangement==="per-point")?(this.drawPoints(),!0):!1}particlePosition(e){var t,n;if(!!(this.options.enable&&((n=(t=this.raw)===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:0)>0))return Rn({},e||this.randomPoint())}particleBounce(e,t,n){return this.polygonBounce(e,t,n)}clickPositionValid(e){const t=this.options;return t.enable&&t.type!=="none"&&t.type!=="inline"&&this.checkInsidePolygon(e)}draw(e){var t;if(!((t=this.paths)===null||t===void 0?void 0:t.length))return;const n=this.options,r=n.draw;if(!(n.enable&&r.enable))return;const s=this.raw;for(const o of this.paths){const a=o.path2d,l=this.path2DSupported;!e||(l&&a&&this.offset?$$(e,a,r.stroke,this.offset):s&&q$(e,s,r.stroke))}}polygonBounce(e,t,n){const r=this.options;if(!this.raw||!r.enable||n!=="top")return!1;if(r.type==="inside"||r.type==="outside"){let s,o,a;const l=e.getPosition(),c=e.getRadius();for(let g=0,d=this.raw.length-1;g<this.raw.length;d=g++){const u=this.raw[g],h=this.raw[d];s=tee(u,h,l);const p=pr(l,s);if([o,a]=[p.dx,p.dy],p.distance<c)return nee(u,h,e.velocity),!0}if(s&&o!==void 0&&a!==void 0&&!this.checkInsidePolygon(l)){const g={x:1,y:1};return e.position.x>=s.x&&(g.x=-1),e.position.y>=s.y&&(g.y=-1),e.position.x=s.x+c*2*g.x,e.position.y=s.y+c*2*g.y,e.velocity.mult(-1),!0}}else if(r.type==="inline"&&e.initialPosition&&ui(e.initialPosition,e.getPosition())>this.polygonMaskMoveRadius)return e.velocity.x=e.velocity.y/2-e.velocity.x,e.velocity.y=e.velocity.x/2-e.velocity.y,!0;return!1}checkInsidePolygon(e){var t,n;const r=this.container,s=this.options;if(!s.enable||s.type==="none"||s.type==="inline")return!0;if(!this.raw)throw new Error(Wt.noPolygonFound);const o=r.canvas.size,a=(t=e==null?void 0:e.x)!==null&&t!==void 0?t:Math.random()*o.width,l=(n=e==null?void 0:e.y)!==null&&n!==void 0?n:Math.random()*o.height;let c=!1;for(let g=0,d=this.raw.length-1;g<this.raw.length;d=g++){const u=this.raw[g],h=this.raw[d];u.y>l!=h.y>l&&a<(h.x-u.x)*(l-u.y)/(h.y-u.y)+u.x&&(c=!c)}return s.type==="inside"?c:s.type==="outside"?!c:!1}parseSvgPath(e,t){var n,r,s;const o=t!=null?t:!1;if(this.paths!==void 0&&!o)return this.raw;const a=this.container,l=this.options,g=new DOMParser().parseFromString(e,"image/svg+xml"),d=g.getElementsByTagName("svg")[0];let u=d.getElementsByTagName("path");u.length||(u=g.getElementsByTagName("path")),this.paths=[];for(let y=0;y<u.length;y++){const m=u.item(y);m&&this.paths.push({element:m,length:m.getTotalLength()})}const h=a.retina.pixelRatio,p=l.scale/h;this.dimension.width=parseFloat((n=d.getAttribute("width"))!==null&&n!==void 0?n:"0")*p,this.dimension.height=parseFloat((r=d.getAttribute("height"))!==null&&r!==void 0?r:"0")*p;const b=(s=l.position)!==null&&s!==void 0?s:{x:50,y:50};return this.offset={x:a.canvas.size.width*b.x/(100*h)-this.dimension.width/2,y:a.canvas.size.height*b.y/(100*h)-this.dimension.height/2},eee(this.paths,p,this.offset)}async downloadSvgPath(e,t){const n=this.options,r=e||n.url,s=t!=null?t:!1;if(!r||this.paths!==void 0&&!s)return this.raw;const o=await fetch(r);if(!o.ok)throw new Error("tsParticles Error - Error occurred during polygon mask download");return this.parseSvgPath(await o.text(),t)}drawPoints(){if(!!this.raw)for(const e of this.raw)this.container.particles.addParticle({x:e.x,y:e.y})}randomPoint(){const e=this.container,t=this.options;let n;if(t.type==="inline")switch(t.inline.arrangement){case"random-point":n=this.getRandomPoint();break;case"random-length":n=this.getRandomPointByLength();break;case"equidistant":n=this.getEquidistantPointByIndex(e.particles.count);break;case"one-per-point":case"per-point":default:n=this.getPointByIndex(e.particles.count)}else n={x:Math.random()*e.canvas.size.width,y:Math.random()*e.canvas.size.height};return this.checkInsidePolygon(n)?n:this.randomPoint()}getRandomPoint(){if(!this.raw||!this.raw.length)throw new Error(Wt.noPolygonDataLoaded);const e=$i(this.raw);return{x:e.x,y:e.y}}getRandomPointByLength(){var e,t,n;const r=this.options;if(!this.raw||!this.raw.length||!((e=this.paths)===null||e===void 0?void 0:e.length))throw new Error(Wt.noPolygonDataLoaded);const s=$i(this.paths),o=Math.floor(Math.random()*s.length)+1,a=s.element.getPointAtLength(o);return{x:a.x*r.scale+(((t=this.offset)===null||t===void 0?void 0:t.x)||0),y:a.y*r.scale+(((n=this.offset)===null||n===void 0?void 0:n.y)||0)}}getEquidistantPointByIndex(e){var t,n,r,s,o,a,l;const c=this.container.actualOptions,g=this.options;if(!this.raw||!this.raw.length||!((t=this.paths)===null||t===void 0?void 0:t.length))throw new Error(Wt.noPolygonDataLoaded);let d=0,u;const p=this.paths.reduce((b,y)=>b+y.length,0)/c.particles.number.value;for(const b of this.paths){const y=p*e-d;if(y<=b.length){u=b.element.getPointAtLength(y);break}else d+=b.length}return{x:((n=u==null?void 0:u.x)!==null&&n!==void 0?n:0)*g.scale+((s=(r=this.offset)===null||r===void 0?void 0:r.x)!==null&&s!==void 0?s:0),y:((o=u==null?void 0:u.y)!==null&&o!==void 0?o:0)*g.scale+((l=(a=this.offset)===null||a===void 0?void 0:a.y)!==null&&l!==void 0?l:0)}}getPointByIndex(e){if(!this.raw||!this.raw.length)throw new Error(Wt.noPolygonDataLoaded);const t=this.raw[e%this.raw.length];return{x:t.x,y:t.y}}createPath2D(){var e,t;const n=this.options;if(!(!this.path2DSupported||!((e=this.paths)===null||e===void 0?void 0:e.length)))for(const r of this.paths){const s=(t=r.element)===null||t===void 0?void 0:t.getAttribute("d");if(s){const o=new Path2D(s),a=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),l=new Path2D,c=a.scale(n.scale);l.addPath?(l.addPath(o,c),r.path2d=l):delete r.path2d}else delete r.path2d;r.path2d||!this.raw||(r.path2d=new Path2D,r.path2d.moveTo(this.raw[0].x,this.raw[0].y),this.raw.forEach((o,a)=>{var l;a>0&&((l=r.path2d)===null||l===void 0||l.lineTo(o.x,o.y))}),r.path2d.closePath())}}async initRawData(e){const t=this.options;if(t.url)this.raw=await this.downloadSvgPath(t.url,e);else if(t.data){const n=t.data;let r;if(typeof n!="string"){const s=n.path instanceof Array?n.path.map(a=>`<path d="${a}" />`).join(""):`<path d="${n.path}" />`;r=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${n.size.width}" height="${n.size.height}">${s}</svg>`}else r=n;this.raw=this.parseSvgPath(r,e)}this.createPath2D()}}class ree{constructor(){this.id="polygonMask"}getPlugin(e){return new iee(e)}needsPlugin(e){var t,n,r;return(n=(t=e==null?void 0:e.polygon)===null||t===void 0?void 0:t.enable)!==null&&n!==void 0?n:((r=e==null?void 0:e.polygon)===null||r===void 0?void 0:r.type)!==void 0&&e.polygon.type!=="none"}loadOptions(e,t){if(!this.needsPlugin(t))return;const n=e;let r=n.polygon;(r==null?void 0:r.load)===void 0&&(n.polygon=r=new DH),r.load(t==null?void 0:t.polygon)}}async function see(i){!cc()&&!("SVGPathSeg"in window)&&await import("./pathseg.8e50599e.js");const e=new ree;await i.addPlugin(e)}function oee(i,e){const t=i.options.roll;if(!i.roll||!t.enable)return;const n=i.roll.speed*e.factor,r=2*Math.PI;i.roll.angle+=n,i.roll.angle>r&&(i.roll.angle-=r)}class aee{init(e){const t=e.options.roll;if(t.enable)if(e.roll={angle:Math.random()*Math.PI*2,speed:pn(t.speed)/360},t.backColor)e.backColor=Ka(t.backColor);else if(t.darken.enable&&t.enlighten.enable){const n=Math.random()>=.5?"darken":"enlighten";e.roll.alter={type:n,value:n==="darken"?t.darken.value:t.enlighten.value}}else t.darken.enable?e.roll.alter={type:"darken",value:t.darken.value}:t.enlighten.enable&&(e.roll.alter={type:"enlighten",value:t.enlighten.value});else e.roll={angle:0,speed:0}}isEnabled(e){const t=e.options.roll;return!e.destroyed&&!e.spawning&&t.enable}update(e,t){!this.isEnabled(e)||oee(e,t)}}async function lee(i){await i.addParticleUpdater("roll",()=>new aee)}function cee(i,e){var t;const n=i.rotate;if(!n)return;const s=i.options.rotate.animation,o=((t=n.velocity)!==null&&t!==void 0?t:0)*e.factor,a=2*Math.PI;if(!!s.enable)switch(n.status){case 0:n.value+=o,n.value>a&&(n.value-=a);break;case 1:default:n.value-=o,n.value<0&&(n.value+=a);break}}class gee{constructor(e){this.container=e}init(e){const t=e.options.rotate;e.rotate={enable:t.animation.enable,value:pn(t.value)*Math.PI/180};let n=t.direction;switch(n==="random"&&(n=Math.floor(Math.random()*2)>0?"counter-clockwise":"clockwise"),n){case"counter-clockwise":case"counterClockwise":e.rotate.status=1;break;case"clockwise":e.rotate.status=0;break}const r=e.options.rotate.animation;r.enable&&(e.rotate.velocity=r.speed/360*this.container.retina.reduceFactor,r.sync||(e.rotate.velocity*=Math.random()))}isEnabled(e){const t=e.options.rotate,n=t.animation;return!e.destroyed&&!e.spawning&&!t.path&&n.enable}update(e,t){!this.isEnabled(e)||cee(e,t)}}async function uee(i){await i.addParticleUpdater("angle",e=>new gee(e))}class dee{getSidesCount(){return 12}draw(e,t,n){e.arc(0,0,n,0,Math.PI*2,!1)}}async function hee(i){await i.addShape("circle",new dee)}function BB(i,e,t,n,r){var s;const o=e;if(!o||!t.enable)return;const a=Cr(t.offset),l=((s=e.velocity)!==null&&s!==void 0?s:0)*i.factor+a*3.6;!r||o.status===0?(o.value+=l,r&&o.value>n&&(o.status=1,o.value-=o.value%n)):(o.value-=l,o.value<0&&(o.status=0,o.value+=o.value)),o.value>n&&(o.value%=n)}function fee(i,e){var t,n,r;const s=i.options.color.animation;((t=i.color)===null||t===void 0?void 0:t.h)!==void 0&&BB(e,i.color.h,s.h,360,!1),((n=i.color)===null||n===void 0?void 0:n.s)!==void 0&&BB(e,i.color.s,s.s,100,!0),((r=i.color)===null||r===void 0?void 0:r.l)!==void 0&&BB(e,i.color.l,s.l,100,!0)}class Iee{constructor(e){this.container=e}init(e){const t=Ka(e.options.color,e.id,e.options.reduceDuplicates);t&&(e.color=dB(t,e.options.color.animation,this.container.retina.reduceFactor))}isEnabled(e){var t,n,r;const s=e.options.color.animation;return!e.destroyed&&!e.spawning&&(((t=e.color)===null||t===void 0?void 0:t.h.value)!==void 0&&s.h.enable||((n=e.color)===null||n===void 0?void 0:n.s.value)!==void 0&&s.s.enable||((r=e.color)===null||r===void 0?void 0:r.l.value)!==void 0&&s.l.enable)}update(e,t){fee(e,t)}}async function Cee(i){await i.addParticleUpdater("color",e=>new Iee(e))}class pee extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.actualOptions,n=e.interactivity.mouse,r=t.interactivity.events;if((!n.position||!r.onHover.enable)&&(!n.clickPosition||!r.onClick.enable))return!1;const s=r.onHover.mode,o=r.onClick.mode;return bn("attract",s)||bn("attract",o)}reset(){}async interact(){const e=this.container,t=e.actualOptions,n=e.interactivity.status===Wt.mouseMoveEvent,r=t.interactivity.events,s=r.onHover.enable,o=r.onHover.mode,a=r.onClick.enable,l=r.onClick.mode;n&&s&&bn("attract",o)?this.hoverAttract():a&&bn("attract",l)&&this.clickAttract()}hoverAttract(){const e=this.container,t=e.interactivity.mouse.position;if(!t)return;const n=e.retina.attractModeDistance;this.processAttract(t,n,new is(t.x,t.y,n))}processAttract(e,t,n){const r=this.container,s=r.actualOptions.interactivity.modes.attract,o=r.particles.quadTree.query(n);for(const a of o){const{dx:l,dy:c,distance:g}=pr(a.position,e),d=s.speed*s.factor,u=Us(eB(1-g/t,s.easing)*d,0,s.maxSpeed),h=xn.create(g===0?d:l/g*u,g===0?d:c/g*u);a.position.subFrom(h)}}clickAttract(){const e=this.container;if(e.attract.finish||(e.attract.count||(e.attract.count=0),e.attract.count++,e.attract.count===e.particles.count&&(e.attract.finish=!0)),e.attract.clicking){const t=e.interactivity.mouse.clickPosition;if(!t)return;const n=e.retina.attractModeDistance;this.processAttract(t,n,new is(t.x,t.y,n))}else e.attract.clicking===!1&&(e.attract.particles=[])}}async function mee(i){await i.addInteractor("externalAttract",e=>new pee(e))}class Aee extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.actualOptions,n=e.interactivity.mouse,r=t.interactivity.events,s=r.onDiv;return n.position&&r.onHover.enable&&bn("bounce",r.onHover.mode)||fb("bounce",s)}async interact(){const e=this.container,t=e.actualOptions,n=t.interactivity.events,r=e.interactivity.status===Wt.mouseMoveEvent,s=n.onHover.enable,o=n.onHover.mode,a=n.onDiv;r&&s&&bn("bounce",o)?this.processMouseBounce():Ib("bounce",a,(l,c)=>this.singleSelectorBounce(l,c))}reset(){}processMouseBounce(){const e=this.container,t=e.retina.pixelRatio,n=10*t,r=e.interactivity.mouse.position,s=e.retina.bounceModeDistance;r&&this.processBounce(r,s,new is(r.x,r.y,s+n))}singleSelectorBounce(e,t){const n=this.container,r=document.querySelectorAll(e);!r.length||r.forEach(s=>{const o=s,a=n.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth/2)*a,y:(o.offsetTop+o.offsetHeight/2)*a},c=o.offsetWidth/2*a,g=10*a,d=t.type==="circle"?new is(l.x,l.y,c+g):new As(o.offsetLeft*a-g,o.offsetTop*a-g,o.offsetWidth*a+g*2,o.offsetHeight*a+g*2);this.processBounce(l,c,d)})}processBounce(e,t,n){const r=this.container.particles.quadTree.query(n);for(const s of r)n instanceof is?rB(Cb(s),{position:e,radius:t,mass:t**2*Math.PI/2,velocity:xn.origin,factor:xn.origin}):n instanceof As&&eH(s,Od(e,t))}}async function bee(i){await i.addInteractor("externalBounce",e=>new Aee(e))}function UH(i,e,t,n){if(e>=t){const r=i+(e-t)*n;return Us(r,i,e)}else if(e<t){const r=i-(t-e)*n;return Us(r,e,i)}}class yee extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.actualOptions,n=e.interactivity.mouse,r=t.interactivity.events,s=r.onDiv,o=fb("bubble",s);if(!(o||r.onHover.enable&&n.position||r.onClick.enable&&n.clickPosition))return!1;const a=r.onHover.mode,l=r.onClick.mode;return bn("bubble",a)||bn("bubble",l)||o}reset(e,t){!(!e.bubble.inRange||t)||(delete e.bubble.div,delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}async interact(){const e=this.container.actualOptions,t=e.interactivity.events,n=t.onHover,r=t.onClick,s=n.enable,o=n.mode,a=r.enable,l=r.mode,c=t.onDiv;s&&bn("bubble",o)?this.hoverBubble():a&&bn("bubble",l)?this.clickBubble():Ib("bubble",c,(g,d)=>this.singleSelectorHover(g,d))}singleSelectorHover(e,t){const n=this.container,r=document.querySelectorAll(e);!r.length||r.forEach(s=>{const o=s,a=n.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth/2)*a,y:(o.offsetTop+o.offsetHeight/2)*a},c=o.offsetWidth/2*a,g=t.type==="circle"?new is(l.x,l.y,c):new As(o.offsetLeft*a,o.offsetTop*a,o.offsetWidth*a,o.offsetHeight*a),d=n.particles.quadTree.query(g);for(const u of d){if(!g.contains(u.getPosition()))continue;u.bubble.inRange=!0;const h=n.actualOptions.interactivity.modes.bubble.divs,p=iB(h,o);(!u.bubble.div||u.bubble.div!==o)&&(this.reset(u,!0),u.bubble.div=o),this.hoverBubbleSize(u,1,p),this.hoverBubbleOpacity(u,1,p),this.hoverBubbleColor(u,1,p)}})}process(e,t,n,r){const s=this.container,o=r.bubbleObj.optValue;if(o===void 0)return;const a=s.actualOptions,l=a.interactivity.modes.bubble.duration,c=s.retina.bubbleModeDistance,g=r.particlesObj.optValue,d=r.bubbleObj.value,u=r.particlesObj.value||0,h=r.type;if(o!==g)if(s.bubble.durationEnd)d&&(h==="size"&&delete e.bubble.radius,h==="opacity"&&delete e.bubble.opacity);else if(t<=c){if((d!=null?d:u)!==o){const b=u-n*(u-o)/l;h==="size"&&(e.bubble.radius=b),h==="opacity"&&(e.bubble.opacity=b)}}else h==="size"&&delete e.bubble.radius,h==="opacity"&&delete e.bubble.opacity}clickBubble(){var e,t;const n=this.container,r=n.actualOptions,s=n.interactivity.mouse.clickPosition;if(!s)return;const o=n.retina.bubbleModeDistance,a=n.particles.quadTree.queryCircle(s,o);for(const l of a){if(!n.bubble.clicking)continue;l.bubble.inRange=!n.bubble.durationEnd;const c=l.getPosition(),g=ui(c,s),d=(new Date().getTime()-(n.interactivity.mouse.clickTime||0))/1e3;d>r.interactivity.modes.bubble.duration&&(n.bubble.durationEnd=!0),d>r.interactivity.modes.bubble.duration*2&&(n.bubble.clicking=!1,n.bubble.durationEnd=!1);const u={bubbleObj:{optValue:n.retina.bubbleModeSize,value:l.bubble.radius},particlesObj:{optValue:Os(l.options.size.value)*n.retina.pixelRatio,value:l.size.value},type:"size"};this.process(l,g,d,u);const h={bubbleObj:{optValue:r.interactivity.modes.bubble.opacity,value:l.bubble.opacity},particlesObj:{optValue:Os(l.options.opacity.value),value:(t=(e=l.opacity)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:1},type:"opacity"};this.process(l,g,d,h),n.bubble.durationEnd?delete l.bubble.color:g<=n.retina.bubbleModeDistance?this.hoverBubbleColor(l,g):delete l.bubble.color}}hoverBubble(){const e=this.container,t=e.interactivity.mouse.position;if(t===void 0)return;const n=e.retina.bubbleModeDistance,r=e.particles.quadTree.queryCircle(t,n);for(const s of r){s.bubble.inRange=!0;const o=s.getPosition(),a=ui(o,t),l=1-a/n;a<=n?l>=0&&e.interactivity.status===Wt.mouseMoveEvent&&(this.hoverBubbleSize(s,l),this.hoverBubbleOpacity(s,l),this.hoverBubbleColor(s,l)):this.reset(s),e.interactivity.status===Wt.mouseLeaveEvent&&this.reset(s)}}hoverBubbleSize(e,t,n){const r=this.container,s=(n==null?void 0:n.size)?n.size*r.retina.pixelRatio:r.retina.bubbleModeSize;if(s===void 0)return;const o=Os(e.options.size.value)*r.retina.pixelRatio,a=e.size.value,l=UH(a,s,o,t);l!==void 0&&(e.bubble.radius=l)}hoverBubbleOpacity(e,t,n){var r,s,o;const a=this.container,l=a.actualOptions,c=(r=n==null?void 0:n.opacity)!==null&&r!==void 0?r:l.interactivity.modes.bubble.opacity;if(!c)return;const g=e.options.opacity.value,d=(o=(s=e.opacity)===null||s===void 0?void 0:s.value)!==null&&o!==void 0?o:1,u=UH(d,c,Os(g),t);u!==void 0&&(e.bubble.opacity=u)}hoverBubbleColor(e,t,n){const r=this.container.actualOptions,s=n!=null?n:r.interactivity.modes.bubble;if(!e.bubble.finalColor){const o=s.color;if(!o)return;const a=o instanceof Array?$i(o):o;e.bubble.finalColor=Ka(a)}if(!!e.bubble.finalColor)if(s.mix){e.bubble.color=void 0;const o=e.getFillColor();e.bubble.color=o?oB(pb(o,e.bubble.finalColor,1-t,t)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}}async function vee(i){await i.addInteractor("externalBubble",e=>new yee(e))}class xee extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.interactivity.mouse,n=e.actualOptions.interactivity.events;return n.onHover.enable&&t.position?bn("connect",n.onHover.mode):!1}reset(){}async interact(){const e=this.container;if(e.actualOptions.interactivity.events.onHover.enable&&e.interactivity.status==="mousemove"){const n=e.interactivity.mouse.position;if(!n)return;const r=Math.abs(e.retina.connectModeRadius),s=e.particles.quadTree.queryCircle(n,r);let o=0;for(const a of s){const l=a.getPosition();for(const c of s.slice(o+1)){const g=c.getPosition(),d=Math.abs(e.retina.connectModeDistance),u=Math.abs(l.x-g.x),h=Math.abs(l.y-g.y);u<d&&h<d&&e.canvas.drawConnectLine(a,c)}++o}}}}async function wee(i){await i.addInteractor("externalConnect",e=>new xee(e))}class Gee extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.interactivity.mouse,n=e.actualOptions.interactivity.events;return n.onHover.enable&&!!t.position&&bn("grab",n.onHover.mode)}reset(){}async interact(){var e;const t=this.container,n=t.actualOptions,r=n.interactivity;if(r.events.onHover.enable&&t.interactivity.status===Wt.mouseMoveEvent){const s=t.interactivity.mouse.position;if(!s)return;const o=t.retina.grabModeDistance,a=t.particles.quadTree.queryCircle(s,o);for(const l of a){const c=l.getPosition(),g=ui(c,s);if(g<=o){const d=r.modes.grab.links,u=d.opacity,h=u-g*u/o;if(h<=0)continue;const p=(e=d.color)!==null&&e!==void 0?e:l.options.links.color;if(!t.particles.grabLineColor){const y=n.interactivity.modes.grab.links;t.particles.grabLineColor=gB(p,y.blink,y.consent)}const b=mb(l,void 0,t.particles.grabLineColor);if(!b)return;t.canvas.drawGrabLine(l,b,h,s)}}}}}async function Bee(i){await i.addInteractor("externalGrab",e=>new Gee(e))}class See extends gc{constructor(e){super(e)}isEnabled(){const e=this.container,t=e.actualOptions,n=e.interactivity.mouse,r=t.interactivity.events,s=r.onDiv,o=fb("repulse",s);if(!(o||r.onHover.enable&&n.position||r.onClick.enable&&n.clickPosition))return!1;const a=r.onHover.mode,l=r.onClick.mode;return bn("repulse",a)||bn("repulse",l)||o}reset(){}async interact(){const e=this.container,t=e.actualOptions,n=e.interactivity.status===Wt.mouseMoveEvent,r=t.interactivity.events,s=r.onHover.enable,o=r.onHover.mode,a=r.onClick.enable,l=r.onClick.mode,c=r.onDiv;n&&s&&bn("repulse",o)?this.hoverRepulse():a&&bn("repulse",l)?this.clickRepulse():Ib("repulse",c,(g,d)=>this.singleSelectorRepulse(g,d))}singleSelectorRepulse(e,t){const n=this.container,r=document.querySelectorAll(e);!r.length||r.forEach(s=>{const o=s,a=n.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth/2)*a,y:(o.offsetTop+o.offsetHeight/2)*a},c=o.offsetWidth/2*a,g=t.type==="circle"?new is(l.x,l.y,c):new As(o.offsetLeft*a,o.offsetTop*a,o.offsetWidth*a,o.offsetHeight*a),d=n.actualOptions.interactivity.modes.repulse.divs,u=iB(d,o);this.processRepulse(l,c,g,u)})}hoverRepulse(){const e=this.container,t=e.interactivity.mouse.position;if(!t)return;const n=e.retina.repulseModeDistance;this.processRepulse(t,n,new is(t.x,t.y,n))}processRepulse(e,t,n,r){var s;const o=this.container,a=o.particles.quadTree.query(n),l=o.actualOptions.interactivity.modes.repulse;for(const c of a){const{dx:g,dy:d,distance:u}=pr(c.position,e),h=((s=r==null?void 0:r.speed)!==null&&s!==void 0?s:l.speed)*l.factor,p=Us(eB(1-u/t,l.easing)*h,0,l.maxSpeed),b=xn.create(u===0?h:g/u*p,u===0?h:d/u*p);c.position.addTo(b)}}clickRepulse(){const e=this.container;if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){const t=e.retina.repulseModeDistance,n=Math.pow(t/6,3),r=e.interactivity.mouse.clickPosition;if(r===void 0)return;const s=new is(r.x,r.y,n),o=e.particles.quadTree.query(s);for(const a of o){const{dx:l,dy:c,distance:g}=pr(r,a.position),d=g**2,u=e.actualOptions.interactivity.modes.repulse.speed,h=-n*u/d;if(d<=n){e.repulse.particles.push(a);const p=xn.create(l,c);p.length=h,a.velocity.setTo(p)}}}else if(e.repulse.clicking===!1){for(const t of e.repulse.particles)t.velocity.setTo(t.initialVelocity);e.repulse.particles=[]}}}async function Zee(i){await i.addInteractor("externalRepulse",e=>new See(e))}const Ree=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function Mee(i,e,t){const{svgData:n}=i;if(!n)return"";const r=Pa(e,t);if(n.includes("fill"))return n.replace(Ree,()=>r);const s=n.indexOf(">");return`${n.substring(0,s)} fill="${r}"${n.substring(s)}`}async function SB(i){return new Promise(e=>{i.loading=!0;const t=new Image;t.addEventListener("load",()=>{i.element=t,i.loading=!1,e()}),t.addEventListener("error",()=>{i.error=!0,i.loading=!1,console.error(`Error tsParticles - loading image: ${i.source}`),e()}),t.src=i.source})}async function Wee(i){if(i.type!=="svg"){await SB(i);return}i.loading=!0;const e=await fetch(i.source);i.loading=!1,e.ok||(console.error("Error tsParticles - Image not found"),i.error=!0),i.error||(i.svgData=await e.text())}function _ee(i,e,t,n){var r,s,o;const a=Mee(i,t,(s=(r=n.opacity)===null||r===void 0?void 0:r.value)!==null&&s!==void 0?s:1),l=new Blob([a],{type:"image/svg+xml"}),c=URL||window.URL||window.webkitURL||window,g=c.createObjectURL(l),d=new Image,u={data:Object.assign(Object.assign({},i),{svgData:a}),ratio:e.width/e.height,replaceColor:(o=e.replaceColor)!==null&&o!==void 0?o:e.replace_color,source:e.src};return d.addEventListener("load",()=>{const h=n.image;h&&(h.loaded=!0,i.element=d),c.revokeObjectURL(g)}),d.addEventListener("error",()=>{c.revokeObjectURL(g);const h=Object.assign(Object.assign({},i),{error:!1,loading:!0});SB(h).then(()=>{const p=n.image;p&&(i.element=h.element,p.loaded=!0)})}),d.src=g,u}var OH=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},JH=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},jd;class Vee{constructor(){jd.set(this,void 0),OH(this,jd,[],"f")}getSidesCount(){return 12}getImages(e){const t=JH(this,jd,"f").find(n=>n.id===e.id);return t||(JH(this,jd,"f").push({id:e.id,images:[]}),this.getImages(e))}addImage(e,t){const n=this.getImages(e);n==null||n.images.push(t)}destroy(){OH(this,jd,[],"f")}async loadImageShape(e,t){const n=t.src;if(!n)throw new Error("Error tsParticles - No image.src");try{const r={source:n,type:n.substr(n.length-3),error:!1,loading:!0};this.addImage(e,r),await(t.replaceColor?Wee:SB)(r)}catch{throw new Error(`tsParticles error - ${t.src} not found`)}}draw(e,t,n,r){var s,o;const a=t.image,l=(s=a==null?void 0:a.data)===null||s===void 0?void 0:s.element;if(!l)return;const c=(o=a==null?void 0:a.ratio)!==null&&o!==void 0?o:1,g={x:-n,y:-n};(!(a==null?void 0:a.data.svgData)||!(a==null?void 0:a.replaceColor))&&(e.globalAlpha=r),e.drawImage(l,g.x,g.y,n*2,n*2/c),(!(a==null?void 0:a.data.svgData)||!(a==null?void 0:a.replaceColor))&&(e.globalAlpha=1)}loadShape(e){var t,n,r;if(e.shape!=="image"&&e.shape!=="images")return;const s=this.getImages(e.container).images,o=e.shapeData,a=s.find(h=>h.source===o.src);let l;if(!a){this.loadImageShape(e.container,o).then(()=>{this.loadShape(e)});return}if(a.error)return;const c=e.getFillColor();a.svgData&&o.replaceColor&&c?l=_ee(a,o,c,e):l={data:a,loaded:!0,ratio:o.width/o.height,replaceColor:(t=o.replaceColor)!==null&&t!==void 0?t:o.replace_color,source:o.src},l.ratio||(l.ratio=1);const g=(n=o.fill)!==null&&n!==void 0?n:e.fill,d=(r=o.close)!==null&&r!==void 0?r:e.close,u={image:l,fill:g,close:d};e.image=u.image,e.fill=u.fill,e.close=u.close}}jd=new WeakMap;async function Nee(i){const e=new Vee;await i.addShape("image",e),await i.addShape("images",e)}class Eee{constructor(e){this.container=e}init(){}isEnabled(e){return!e.destroyed}update(e,t){if(!this.isEnabled(e))return;const n=e.life;let r=!1;if(e.spawning)if(n.delayTime+=t.value,n.delayTime>=e.life.delay)r=!0,e.spawning=!1,n.delayTime=0,n.time=0;else return;if(n.duration===-1||e.spawning||(r?n.time=0:n.time+=t.value,n.time<n.duration))return;if(n.time=0,e.life.count>0&&e.life.count--,e.life.count===0){e.destroy();return}const s=this.container.canvas.size,o=zn(0,s.width),a=zn(0,s.width);e.position.x=Cr(o),e.position.y=Cr(a),e.spawning=!0,n.delayTime=0,n.time=0,e.reset();const l=e.options.life;n.delay=pn(l.delay.value)*1e3,n.duration=pn(l.duration.value)*1e3}}async function Hee(i){await i.addParticleUpdater("life",e=>new Eee(e))}class Fee{getSidesCount(){return 1}draw(e,t,n){e.moveTo(-n/2,0),e.lineTo(n/2,0)}}async function Lee(i){await i.addShape("line",new Fee)}function Tee(i,e,t,n){switch(i.options.opacity.animation.destroy){case"max":e>=n&&i.destroy();break;case"min":e<=t&&i.destroy();break}}function Xee(i,e){var t,n,r,s,o;if(!i.opacity)return;const a=i.opacity.min,l=i.opacity.max;if(!(i.destroyed||!i.opacity.enable||((t=i.opacity.maxLoops)!==null&&t!==void 0?t:0)>0&&((n=i.opacity.loops)!==null&&n!==void 0?n:0)>((r=i.opacity.maxLoops)!==null&&r!==void 0?r:0))){switch(i.opacity.status){case 0:i.opacity.value>=l?(i.opacity.status=1,i.opacity.loops||(i.opacity.loops=0),i.opacity.loops++):i.opacity.value+=((s=i.opacity.velocity)!==null&&s!==void 0?s:0)*e.factor;break;case 1:i.opacity.value<=a?(i.opacity.status=0,i.opacity.loops||(i.opacity.loops=0),i.opacity.loops++):i.opacity.value-=((o=i.opacity.velocity)!==null&&o!==void 0?o:0)*e.factor;break}Tee(i,i.opacity.value,a,l),i.destroyed||(i.opacity.value=Us(i.opacity.value,a,l))}}class zee{constructor(e){this.container=e}init(e){const t=e.options.opacity;e.opacity={enable:t.animation.enable,max:Os(t.value),min:Wg(t.value),value:pn(t.value),loops:0,maxLoops:t.animation.count};const n=t.animation;if(n.enable){e.opacity.status=0;const r=t.value;switch(e.opacity.min=Wg(r),e.opacity.max=Os(r),n.startValue){case"min":e.opacity.value=e.opacity.min,e.opacity.status=0;break;case"random":e.opacity.value=Cr(e.opacity),e.opacity.status=Math.random()>=.5?0:1;break;case"max":default:e.opacity.value=e.opacity.max,e.opacity.status=1;break}e.opacity.velocity=n.speed/100*this.container.retina.reduceFactor,n.sync||(e.opacity.velocity*=Math.random())}}isEnabled(e){var t,n,r,s;return!e.destroyed&&!e.spawning&&!!e.opacity&&e.opacity.enable&&(((t=e.opacity.maxLoops)!==null&&t!==void 0?t:0)<=0||((n=e.opacity.maxLoops)!==null&&n!==void 0?n:0)>0&&((r=e.opacity.loops)!==null&&r!==void 0?r:0)<((s=e.opacity.maxLoops)!==null&&s!==void 0?s:0))}update(e,t){!this.isEnabled(e)||Xee(e,t)}}async function kee(i){await i.addParticleUpdater("opacity",e=>new zee(e))}function Yee(i){if(!(i.outMode==="bounce"||i.outMode==="bounce-horizontal"||i.outMode==="bounceHorizontal"||i.outMode==="split"))return;const e=i.particle.velocity.x;let t=!1;if(i.direction==="right"&&i.bounds.right>=i.canvasSize.width&&e>0||i.direction==="left"&&i.bounds.left<=0&&e<0){const r=pn(i.particle.options.bounce.horizontal.value);i.particle.velocity.x*=-r,t=!0}if(!t)return;const n=i.offset.x+i.size;i.bounds.right>=i.canvasSize.width?i.particle.position.x=i.canvasSize.width-n:i.bounds.left<=0&&(i.particle.position.x=n),i.outMode==="split"&&i.particle.destroy()}function Kee(i){if(i.outMode==="bounce"||i.outMode==="bounce-vertical"||i.outMode==="bounceVertical"||i.outMode==="split"){const e=i.particle.velocity.y;let t=!1;if(i.direction==="bottom"&&i.bounds.bottom>=i.canvasSize.height&&e>0||i.direction==="top"&&i.bounds.top<=0&&e<0){const r=pn(i.particle.options.bounce.vertical.value);i.particle.velocity.y*=-r,t=!0}if(!t)return;const n=i.offset.y+i.size;i.bounds.bottom>=i.canvasSize.height?i.particle.position.y=i.canvasSize.height-n:i.bounds.top<=0&&(i.particle.position.y=n),i.outMode==="split"&&i.particle.destroy()}}class Pee{constructor(e){this.container=e}init(){}isEnabled(e){return!e.destroyed&&!e.spawning}update(e,t){var n,r,s,o;const a=e.options.move.outModes;this.updateOutMode(e,t,(n=a.bottom)!==null&&n!==void 0?n:a.default,"bottom"),this.updateOutMode(e,t,(r=a.left)!==null&&r!==void 0?r:a.default,"left"),this.updateOutMode(e,t,(s=a.right)!==null&&s!==void 0?s:a.default,"right"),this.updateOutMode(e,t,(o=a.top)!==null&&o!==void 0?o:a.default,"top")}updateOutMode(e,t,n,r){switch(n){case"bounce":case"bounce-vertical":case"bounce-horizontal":case"bounceVertical":case"bounceHorizontal":case"split":this.bounce(e,t,r,n);break;case"destroy":this.destroy(e,r);break;case"out":this.out(e,r);break;case"none":default:this.none(e,r);break}}destroy(e,t){const n=this.container;Ud(e.position,n.canvas.size,e.getRadius(),t)||n.particles.remove(e,void 0,!0)}out(e,t){const n=this.container;if(Ud(e.position,n.canvas.size,e.getRadius(),t))return;const r=e.options.move.warp,s=n.canvas.size,o={bottom:s.height+e.getRadius()+e.offset.y,left:-e.getRadius()-e.offset.x,right:s.width+e.getRadius()+e.offset.x,top:-e.getRadius()-e.offset.y},a=e.getRadius(),l=Od(e.position,a);t==="right"&&l.left>s.width+e.offset.x?(e.position.x=o.left,e.initialPosition.x=e.position.x,r||(e.position.y=Math.random()*s.height,e.initialPosition.y=e.position.y)):t==="left"&&l.right<-e.offset.x&&(e.position.x=o.right,e.initialPosition.x=e.position.x,r||(e.position.y=Math.random()*s.height,e.initialPosition.y=e.position.y)),t==="bottom"&&l.top>s.height+e.offset.y?(r||(e.position.x=Math.random()*s.width,e.initialPosition.x=e.position.x),e.position.y=o.top,e.initialPosition.y=e.position.y):t==="top"&&l.bottom<-e.offset.y&&(r||(e.position.x=Math.random()*s.width,e.initialPosition.x=e.position.x),e.position.y=o.bottom,e.initialPosition.y=e.position.y)}bounce(e,t,n,r){const s=this.container;let o=!1;for(const[,u]of s.plugins)if(u.particleBounce!==void 0&&(o=u.particleBounce(e,t,n)),o)break;if(o)return;const a=e.getPosition(),l=e.offset,c=e.getRadius(),g=Od(a,c),d=s.canvas.size;Yee({particle:e,outMode:r,direction:n,bounds:g,canvasSize:d,offset:l,size:c}),Kee({particle:e,outMode:r,direction:n,bounds:g,canvasSize:d,offset:l,size:c})}none(e,t){if(e.options.move.distance.horizontal&&(t==="left"||t==="right")||e.options.move.distance.vertical&&(t==="top"||t==="bottom"))return;const n=e.options.move.gravity,r=this.container,s=r.canvas.size,o=e.getRadius();if(n.enable){const a=e.position;(!n.inverse&&a.y>s.height+o&&t==="bottom"||n.inverse&&a.y<-o&&t==="top")&&r.particles.remove(e)}else{if(e.velocity.y>0&&e.position.y<=s.height+o||e.velocity.y<0&&e.position.y>=-o||e.velocity.x>0&&e.position.x<=s.width+o||e.velocity.x<0&&e.position.x>=-o)return;Ud(e.position,r.canvas.size,o,t)||r.particles.remove(e)}}}async function Dee(i){await i.addParticleUpdater("outModes",e=>new Pee(e))}class Uee extends yb{constructor(e){super(e)}async interact(e){var t;const n=this.container,r=(t=e.retina.attractDistance)!==null&&t!==void 0?t:n.retina.attractDistance,s=e.getPosition(),o=n.particles.quadTree.queryCircle(s,r);for(const a of o){if(e===a||!a.options.move.attract.enable||a.destroyed||a.spawning)continue;const l=a.getPosition(),{dx:c,dy:g}=pr(s,l),d=e.options.move.attract.rotate,u=c/(d.x*1e3),h=g/(d.y*1e3),p=a.size.value/e.size.value,b=1/p;e.velocity.x-=u*p,e.velocity.y-=h*p,a.velocity.x+=u*b,a.velocity.y+=h*b}}isEnabled(e){return e.options.move.attract.enable}reset(){}}async function Oee(i){await i.addInteractor("particlesAttract",e=>new Uee(e))}function QH(i,e){rB(Cb(i),Cb(e))}function Jee(i,e){!i.unbreakable&&!e.unbreakable&&QH(i,e),i.getRadius()===void 0&&e.getRadius()!==void 0?i.destroy():i.getRadius()!==void 0&&e.getRadius()===void 0?e.destroy():i.getRadius()!==void 0&&e.getRadius()!==void 0&&(i.getRadius()>=e.getRadius()?e.destroy():i.destroy())}class Qee extends yb{constructor(e){super(e)}isEnabled(e){return e.options.collisions.enable}reset(){}async interact(e){const t=this.container,n=e.getPosition(),r=e.getRadius(),s=t.particles.quadTree.queryCircle(n,r*2);for(const o of s){if(e===o||!o.options.collisions.enable||e.options.collisions.mode!==o.options.collisions.mode||o.destroyed||o.spawning)continue;const a=o.getPosition();if(Math.round(n.z)!==Math.round(a.z))continue;const l=ui(n,a),c=o.getRadius(),g=r+c;l<=g&&this.resolveCollision(e,o)}}resolveCollision(e,t){switch(e.options.collisions.mode){case"absorb":{this.absorb(e,t);break}case"bounce":{QH(e,t);break}case"destroy":{Jee(e,t);break}}}absorb(e,t){const n=this.container,r=n.fpsLimit/1e3;if(e.getRadius()===void 0&&t.getRadius()!==void 0)e.destroy();else if(e.getRadius()!==void 0&&t.getRadius()===void 0)t.destroy();else if(e.getRadius()!==void 0&&t.getRadius()!==void 0)if(e.getRadius()>=t.getRadius()){const s=Us(e.getRadius()/t.getRadius(),0,t.getRadius())*r;e.size.value+=s,t.size.value-=s,t.getRadius()<=n.retina.pixelRatio&&(t.size.value=0,t.destroy())}else{const s=Us(t.getRadius()/e.getRadius(),0,e.getRadius())*r;e.size.value-=s,t.size.value+=s,e.getRadius()<=n.retina.pixelRatio&&(e.size.value=0,e.destroy())}}}async function jee(i){await i.addInteractor("particlesCollisions",e=>new Qee(e))}function qee(i,e,t,n,r){let s=ui(i,e);if(!r||s<=t)return s;const o={x:e.x-n.width,y:e.y};if(s=ui(i,o),s<=t)return s;const a={x:e.x-n.width,y:e.y-n.height};if(s=ui(i,a),s<=t)return s;const l={x:e.x,y:e.y-n.height};return s=ui(i,l),s}class $ee extends yb{constructor(e){super(e)}isEnabled(e){return e.options.links.enable}reset(){}async interact(e){var t;e.links=[];const n=e.getPosition(),r=this.container,s=r.canvas.size;if(n.x<0||n.y<0||n.x>s.width||n.y>s.height)return;const o=e.options.links,a=o.opacity,l=(t=e.retina.linksDistance)!==null&&t!==void 0?t:r.retina.linksDistance,c=o.warp,g=c?new IB(n.x,n.y,l,s):new is(n.x,n.y,l),d=r.particles.quadTree.query(g);for(const u of d){const h=u.options.links;if(e===u||!h.enable||o.id!==h.id||u.spawning||u.destroyed||e.links.map(m=>m.destination).indexOf(u)!==-1||u.links.map(m=>m.destination).indexOf(e)!==-1)continue;const p=u.getPosition();if(p.x<0||p.y<0||p.x>s.width||p.y>s.height)continue;const b=qee(n,p,l,s,c&&h.warp);if(b>l)return;const y=(1-b/l)*a;this.setColor(e),e.links.push({destination:u,opacity:y})}}setColor(e){const t=this.container,n=e.options.links;let r=n.id===void 0?t.particles.linksColor:t.particles.linksColors.get(n.id);if(!r){const s=n.color;r=gB(s,n.blink,n.consent),n.id===void 0?t.particles.linksColor=r:t.particles.linksColors.set(n.id,r)}}}async function ete(i){await i.addInteractor("particlesLinks",e=>new $ee(e))}class tte{constructor(e){this.container=e}particleCreated(e){const t=e;t.links=[]}particleDestroyed(e){const t=e;t.links=[]}drawParticle(e,t){const n=t,r=this.container,s=r.particles,o=t.options;if(n.links.length>0){e.save();const a=n.links.filter(l=>r.particles.getLinkFrequency(n,l.destination)<=o.links.frequency);for(const l of a){const c=l.destination;if(o.links.triangles.enable){const g=a.map(u=>u.destination),d=c.links.filter(u=>r.particles.getLinkFrequency(c,u.destination)<=c.options.links.frequency&&g.indexOf(u.destination)>=0);if(d.length)for(const u of d){const h=u.destination;s.getTriangleFrequency(n,c,h)>o.links.triangles.frequency||this.drawLinkTriangle(n,l,u)}}l.opacity>0&&r.retina.linksWidth>0&&this.drawLinkLine(n,l)}e.restore()}}drawLinkTriangle(e,t,n){var r;const s=this.container,o=s.actualOptions,a=t.destination,l=n.destination,c=e.options.links.triangles,g=(r=c.opacity)!==null&&r!==void 0?r:(t.opacity+n.opacity)/2;if(g<=0)return;const d=e.getPosition(),u=a.getPosition(),h=l.getPosition();s.canvas.draw(p=>{if(ui(d,u)>s.retina.linksDistance||ui(h,u)>s.retina.linksDistance||ui(h,d)>s.retina.linksDistance)return;let b=Nr(c.color);if(!b){const y=e.options.links,m=y.id!==void 0?s.particles.linksColors.get(y.id):s.particles.linksColor;b=mb(e,a,m)}!b||gH(p,d,u,h,o.backgroundMask.enable,o.backgroundMask.composite,b,g)})}drawLinkLine(e,t){const n=this.container,r=n.actualOptions,s=t.destination;let o=t.opacity;const a=e.getPosition(),l=s.getPosition();n.canvas.draw(c=>{var g,d;let u;const h=e.options.twinkle.lines;if(h.enable){const y=h.frequency,m=Nr(h.color);Math.random()<y&&m!==void 0&&(u=m,o=h.opacity)}if(!u){const y=e.options.links,m=y.id!==void 0?n.particles.linksColors.get(y.id):n.particles.linksColor;u=mb(e,s,m)}if(!u)return;const p=(g=e.retina.linksWidth)!==null&&g!==void 0?g:n.retina.linksWidth,b=(d=e.retina.linksDistance)!==null&&d!==void 0?d:n.retina.linksDistance;cH(c,p,a,l,b,n.canvas.size,e.options.links.warp,r.backgroundMask.enable,r.backgroundMask.composite,u,o,e.options.links.shadow)})}}class nte{constructor(){this.id="links"}getPlugin(e){return new tte(e)}needsPlugin(){return!0}loadOptions(){}}async function ite(i){const e=new nte;await i.addPlugin(e)}async function rte(i){await ete(i),await ite(i)}class jH{getSidesCount(e){var t,n;const r=e.shapeData;return(n=(t=r==null?void 0:r.sides)!==null&&t!==void 0?t:r==null?void 0:r.nb_sides)!==null&&n!==void 0?n:5}draw(e,t,n){const r=this.getCenter(t,n),s=this.getSidesData(t,n),o=s.count.numerator*s.count.denominator,a=s.count.numerator/s.count.denominator,l=180*(a-2)/a,c=Math.PI-Math.PI*l/180;if(!!e){e.beginPath(),e.translate(r.x,r.y),e.moveTo(0,0);for(let g=0;g<o;g++)e.lineTo(s.length,0),e.translate(s.length,0),e.rotate(c)}}}class ste extends jH{getSidesData(e,t){var n,r;const s=e.shapeData,o=(r=(n=s==null?void 0:s.sides)!==null&&n!==void 0?n:s==null?void 0:s.nb_sides)!==null&&r!==void 0?r:5;return{count:{denominator:1,numerator:o},length:t*2.66/(o/3)}}getCenter(e,t){const n=this.getSidesCount(e);return{x:-t/(n/3.5),y:-t/(2.66/3.5)}}}class ote extends jH{getSidesCount(){return 3}getSidesData(e,t){return{count:{denominator:2,numerator:3},length:t*2}}getCenter(e,t){return{x:-t,y:t/1.66}}}async function ate(i){await i.addShape("polygon",new ste)}async function lte(i){await i.addShape("triangle",new ote)}async function cte(i){await ate(i),await lte(i)}function gte(i,e,t,n){switch(i.options.size.animation.destroy){case"max":e>=n&&i.destroy();break;case"min":e<=t&&i.destroy();break}}function ute(i,e){var t,n,r,s;const o=((t=i.size.velocity)!==null&&t!==void 0?t:0)*e.factor,a=i.size.min,l=i.size.max;if(!(i.destroyed||!i.size.enable||((n=i.size.maxLoops)!==null&&n!==void 0?n:0)>0&&((r=i.size.loops)!==null&&r!==void 0?r:0)>((s=i.size.maxLoops)!==null&&s!==void 0?s:0))){switch(i.size.status){case 0:i.size.value>=l?(i.size.status=1,i.size.loops||(i.size.loops=0),i.size.loops++):i.size.value+=o;break;case 1:i.size.value<=a?(i.size.status=0,i.size.loops||(i.size.loops=0),i.size.loops++):i.size.value-=o}gte(i,i.size.value,a,l),i.destroyed||(i.size.value=Us(i.size.value,a,l))}}class dte{init(){}isEnabled(e){var t,n,r,s;return!e.destroyed&&!e.spawning&&e.size.enable&&(((t=e.size.maxLoops)!==null&&t!==void 0?t:0)<=0||((n=e.size.maxLoops)!==null&&n!==void 0?n:0)>0&&((r=e.size.loops)!==null&&r!==void 0?r:0)<((s=e.size.maxLoops)!==null&&s!==void 0?s:0))}update(e,t){!this.isEnabled(e)||ute(e,t)}}async function hte(i){await i.addParticleUpdater("size",()=>new dte)}const Rb=Math.sqrt(2);class fte{getSidesCount(){return 4}draw(e,t,n){e.rect(-n/Rb,-n/Rb,n*2/Rb,n*2/Rb)}}async function Ite(i){const e=new fte;await i.addShape("edge",e),await i.addShape("square",e)}class Cte{getSidesCount(e){var t,n;const r=e.shapeData;return(n=(t=r==null?void 0:r.sides)!==null&&t!==void 0?t:r==null?void 0:r.nb_sides)!==null&&n!==void 0?n:5}draw(e,t,n){var r;const s=t.shapeData,o=this.getSidesCount(t),a=(r=s==null?void 0:s.inset)!==null&&r!==void 0?r:2;e.moveTo(0,0-n);for(let l=0;l<o;l++)e.rotate(Math.PI/o),e.lineTo(0,0-n*a),e.rotate(Math.PI/o),e.lineTo(0,0-n)}}async function pte(i){await i.addShape("star",new Cte)}function ZB(i,e,t,n,r){var s;const o=e;if(!o||!o.enable)return;const a=Cr(t.offset),l=((s=e.velocity)!==null&&s!==void 0?s:0)*i.factor+a*3.6;!r||o.status===0?(o.value+=l,r&&o.value>n&&(o.status=1,o.value-=o.value%n)):(o.value-=l,o.value<0&&(o.status=0,o.value+=o.value)),o.value>n&&(o.value%=n)}function mte(i,e){var t,n,r,s,o,a,l,c,g,d;if(!((t=i.stroke)===null||t===void 0?void 0:t.color))return;const u=i.stroke.color.animation,h=(r=(n=i.strokeColor)===null||n===void 0?void 0:n.h)!==null&&r!==void 0?r:(s=i.color)===null||s===void 0?void 0:s.h;h&&ZB(e,h,u.h,360,!1);const p=(a=(o=i.strokeColor)===null||o===void 0?void 0:o.s)!==null&&a!==void 0?a:(l=i.color)===null||l===void 0?void 0:l.s;p&&ZB(e,p,u.s,100,!0);const b=(g=(c=i.strokeColor)===null||c===void 0?void 0:c.l)!==null&&g!==void 0?g:(d=i.color)===null||d===void 0?void 0:d.l;b&&ZB(e,b,u.l,100,!0)}class Ate{constructor(e){this.container=e}init(e){var t,n;const r=this.container;e.stroke=e.options.stroke instanceof Array?$i(e.options.stroke,e.id,e.options.reduceDuplicates):e.options.stroke,e.strokeWidth=e.stroke.width*r.retina.pixelRatio;const s=(t=Ka(e.stroke.color))!==null&&t!==void 0?t:e.getFillColor();s&&(e.strokeColor=dB(s,(n=e.stroke.color)===null||n===void 0?void 0:n.animation,r.retina.reduceFactor))}isEnabled(e){var t,n,r,s;const o=(t=e.stroke)===null||t===void 0?void 0:t.color;return!e.destroyed&&!e.spawning&&!!o&&(((n=e.strokeColor)===null||n===void 0?void 0:n.h.value)!==void 0&&o.animation.h.enable||((r=e.strokeColor)===null||r===void 0?void 0:r.s.value)!==void 0&&o.animation.s.enable||((s=e.strokeColor)===null||s===void 0?void 0:s.l.value)!==void 0&&o.animation.l.enable)}update(e,t){!this.isEnabled(e)||mte(e,t)}}async function bte(i){await i.addParticleUpdater("strokeColor",e=>new Ate(e))}const RB=["text","character","char"];class yte{getSidesCount(){return 12}async init(e){const t=e.actualOptions;if(RB.find(n=>bn(n,t.particles.shape.type))){const n=RB.map(r=>t.particles.shape.options[r]).find(r=>!!r);if(n instanceof Array){const r=[];for(const s of n)r.push(tB(s));await Promise.allSettled(r)}else n!==void 0&&await tB(n)}}draw(e,t,n,r){var s,o,a;const l=t.shapeData;if(l===void 0)return;const c=l.value;if(c===void 0)return;const g=t;g.text===void 0&&(g.text=c instanceof Array?$i(c,t.randomIndexData):c);const d=g.text,u=(s=l.style)!==null&&s!==void 0?s:"",h=(o=l.weight)!==null&&o!==void 0?o:"400",p=Math.round(n)*2,b=(a=l.font)!==null&&a!==void 0?a:"Verdana",y=t.fill,m=d.length*n/2;e.font=`${u} ${h} ${p}px "${b}"`;const f={x:-m,y:n/2};e.globalAlpha=r,y?e.fillText(d,f.x,f.y):e.strokeText(d,f.x,f.y),e.globalAlpha=1}}async function vte(i){const e=new yte;for(const t of RB)await i.addShape(t,e)}async function xte(i){await mee(i),await bee(i),await vee(i),await wee(i),await Bee(i),await Zee(i),await Oee(i),await jee(i),await rte(i),await hee(i),await Nee(i),await Lee(i),await cte(i),await Ite(i),await pte(i),await vte(i),await Hee(i),await kee(i),await hte(i),await uee(i),await Cee(i),await bte(i),await Dee(i)}function wte(i,e){var t;if(!i.tilt)return;const r=i.options.tilt.animation,s=((t=i.tilt.velocity)!==null&&t!==void 0?t:0)*e.factor,o=2*Math.PI;if(!!r.enable)switch(i.tilt.status){case 0:i.tilt.value+=s,i.tilt.value>o&&(i.tilt.value-=o);break;case 1:default:i.tilt.value-=s,i.tilt.value<0&&(i.tilt.value+=o);break}}class Gte{constructor(e){this.container=e}init(e){const t=e.options.tilt;e.tilt={enable:t.enable,value:pn(t.value)*Math.PI/180,sinDirection:Math.random()>=.5?1:-1,cosDirection:Math.random()>=.5?1:-1};let n=t.direction;switch(n==="random"&&(n=Math.floor(Math.random()*2)>0?"counter-clockwise":"clockwise"),n){case"counter-clockwise":case"counterClockwise":e.tilt.status=1;break;case"clockwise":e.tilt.status=0;break}const r=e.options.tilt.animation;r.enable&&(e.tilt.velocity=r.speed/360*this.container.retina.reduceFactor,r.sync||(e.tilt.velocity*=Math.random()))}isEnabled(e){const n=e.options.tilt.animation;return!e.destroyed&&!e.spawning&&n.enable}update(e,t){!this.isEnabled(e)||wte(e,t)}}async function Bte(i){await i.addParticleUpdater("tilt",e=>new Gte(e))}function Ste(i,e){var t;if(!i.options.wobble.enable||!i.wobble)return;const r=i.wobble.speed*e.factor,s=((t=i.retina.wobbleDistance)!==null&&t!==void 0?t:0)*e.factor/(1e3/60),o=2*Math.PI;i.wobble.angle+=r,i.wobble.angle>o&&(i.wobble.angle-=o),i.position.x+=s*Math.cos(i.wobble.angle),i.position.y+=s*Math.abs(Math.sin(i.wobble.angle))}class Zte{constructor(e){this.container=e}init(e){const t=e.options.wobble;t.enable?e.wobble={angle:Math.random()*Math.PI*2,speed:pn(t.speed)/360}:e.wobble={angle:0,speed:0},e.retina.wobbleDistance=pn(t.distance)*this.container.retina.pixelRatio}isEnabled(e){return!e.destroyed&&!e.spawning&&e.options.wobble.enable}update(e,t){!this.isEnabled(e)||Ste(e,t)}}async function Rte(i){await i.addParticleUpdater("wobble",e=>new Zte(e))}async function Mte(i){await xte(i),await D$(i),await lee(i),await Bte(i),await Rte(i),await M$(i),await K$(i),await see(i)}const Mb=new xB;Mb.init();const{particlesJS:Wte,pJSDom:_te}=w$(Mb);Mte(Mb);var Vte=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Engine:xB,Main:xB,particlesJS:Wte,pJSDom:_te,tsParticles:Mb,Canvas:BH,Container:zH,Loader:YH,Particle:LH,Particles:TH,Retina:XH,Circle:is,CircleWarp:IB,Constants:Wt,EventListeners:bH,ExternalInteractorBase:gc,FrameManager:yH,InteractionManager:vH,ParticlesInteractorBase:yb,ParticlesMover:xH,Plugins:wH,Point:GH,QuadTree:uc,Range:fB,Rectangle:As,Vector:xn,Vector3d:mr,paintBase:lH,clear:Ab,drawLinkLine:cH,drawLinkTriangle:gH,drawConnectLine:uH,gradient:dH,drawGrabLine:hH,drawParticle:fH,drawShape:IH,drawShapeAfterEffect:CH,drawPlugin:pH,drawParticlePlugin:mH,drawEllipse:kj,alterHsl:AH,colorToRgb:Nr,colorToHsl:Ka,rgbToHsl:oB,stringToAlpha:nH,stringToRgb:iH,hslToRgb:Jd,hslaToRgba:rH,hslToHsv:sH,hslaToHsva:Fj,hsvToHsl:aB,hsvaToHsla:Lj,hsvToRgb:lB,hsvaToRgba:oH,rgbToHsv:aH,rgbaToHsva:Tj,getRandomRgbColor:cB,getStyleFromRgb:ms,getStyleFromHsl:Pa,getStyleFromHsv:Xj,colorMix:pb,getLinkColor:mb,getLinkRandomColor:gB,getHslFromAnimation:uB,getHslAnimationFromHsl:dB,clamp:Us,mix:hb,randomInRange:Cr,getRangeValue:pn,getRangeMin:Wg,getRangeMax:Os,setRangeValue:zn,getValue:_g,getDistances:pr,getDistance:ui,getParticleDirectionAngle:DE,getParticleBaseVelocity:UE,collisionVelocity:$1,calcEasing:eB,isSsr:cc,animate:QE,cancelAnimation:jE,isInArray:bn,loadFont:tB,arrayRandomIndex:qE,itemFromArray:$i,isPointInside:Ud,areBoundsInside:$E,calculateBounds:Od,deepExtend:Rn,isDivModeEnabled:fb,divModeExecute:Ib,singleDivModeExecute:nB,divMode:iB,circleBounceDataFromParticle:Cb,circleBounce:rB,rectBounce:eH}),Nte=cP(Vte),Ete=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!=0;)if(!i(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!=0;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!=0;){var o=s[r];if(!(o==="_owner"&&e.$$typeof)&&!i(e[o],t[o]))return!1}return!0}return e!==e&&t!==t};(function(i){(()=>{var e={757:(a,l,c)=>{a.exports=c(666)},312:(a,l,c)=>{function g(V,I){for(var w=0;w<I.length;w++){var S=I[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(V,S.key,S)}}function d(V){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)})(V)}function u(V,I){for(;!Object.prototype.hasOwnProperty.call(V,I)&&(V=d(V))!==null;);return V}function h(){return(h=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(V,I,w){var S=u(V,I);if(S){var R=Object.getOwnPropertyDescriptor(S,I);return R.get?R.get.call(arguments.length<3?V:w):R.value}}).apply(this,arguments)}function p(V,I){return(p=Object.setPrototypeOf||function(w,S){return w.__proto__=S,w})(V,I)}function b(V){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(V)}function y(V,I){if(I&&(b(I)==="object"||typeof I=="function"))return I;if(I!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}(V)}c.d(l,{Z:()=>J});var m=c(757),f=c.n(m);const G=ue.exports;var x=c.n(G);const B=Nte,M=Ete;var E=c.n(M),z=function(V,I,w,S){return new(w||(w=Promise))(function(R,W){function H(Z){try{_(S.next(Z))}catch(T){W(T)}}function k(Z){try{_(S.throw(Z))}catch(T){W(T)}}function _(Z){var T;Z.done?R(Z.value):(T=Z.value,T instanceof w?T:new w(function(F){F(T)})).then(H,k)}_((S=S.apply(V,I||[])).next())})},J=function(V){(function(k,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(k,"prototype",{value:Object.create(_&&_.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),writable:!1}),_&&p(k,_)})(H,V);var I,w,S,R,W=(S=H,R=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var k,_=d(S);if(R){var Z=d(this).constructor;k=Reflect.construct(_,arguments,Z)}else k=_.apply(this,arguments);return y(this,k)});function H(k){var _;return function(Z,T){if(!(Z instanceof T))throw new TypeError("Cannot call a class as a function")}(this,H),(_=W.call(this,k)).state={library:void 0},_}return I=H,(w=[{key:"destroy",value:function(){this.state.library&&(this.state.library.destroy(),this.setState({library:void 0}))}},{key:"shouldComponentUpdate",value:function(k){return!E()(k,this.props)}},{key:"componentDidUpdate",value:function(){this.refresh()}},{key:"forceUpdate",value:function(){var k=this;this.refresh().then(function(){h(d(H.prototype),"forceUpdate",k).call(k)})}},{key:"componentDidMount",value:function(){z(this,void 0,void 0,f().mark(function k(){return f().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!this.props.init){_.next=3;break}return _.next=3,this.props.init(B.tsParticles);case 3:return _.next=5,this.loadParticles();case 5:case"end":return _.stop()}},k,this)}))}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"render",value:function(){var k=this.props,_=k.width,Z=k.height,T=k.className,F=k.canvasClassName,K=k.id;return x().createElement("div",{className:T,id:K},x().createElement("canvas",{className:F,style:Object.assign(Object.assign({},this.props.style),{width:_,height:Z})}))}},{key:"refresh",value:function(){return z(this,void 0,void 0,f().mark(function k(){return f().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.destroy(),_.next=3,this.loadParticles();case 3:case"end":return _.stop()}},k,this)}))}},{key:"loadParticles",value:function(){var k;return z(this,void 0,void 0,f().mark(function _(){var Z,T,F=this;return f().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(Z=function(j){return z(F,void 0,void 0,f().mark(function O(){return f().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(this.props.container&&(this.props.container.current=j),this.setState({library:j}),!this.props.loaded){Y.next=5;break}return Y.next=5,this.props.loaded(j);case 5:case"end":return Y.stop()}},O,this)}))},!this.props.url){K.next=7;break}return K.next=4,B.tsParticles.loadJSON(this.props.id,this.props.url);case 4:K.t0=K.sent,K.next=10;break;case 7:return K.next=9,B.tsParticles.load(this.props.id,(k=this.props.params)!==null&&k!==void 0?k:this.props.options);case 9:K.t0=K.sent;case 10:return T=K.t0,K.next=13,Z(T);case 13:case"end":return K.stop()}},_,this)}))}}])&&g(I.prototype,w),Object.defineProperty(I,"prototype",{writable:!1}),H}(G.Component);J.defaultProps={width:"100%",height:"100%",options:{},style:{},url:void 0,id:"tsparticles"}},666:a=>{var l=function(c){var g,d=Object.prototype,u=d.hasOwnProperty,h=typeof Symbol=="function"?Symbol:{},p=h.iterator||"@@iterator",b=h.asyncIterator||"@@asyncIterator",y=h.toStringTag||"@@toStringTag";function m(O,Y,ee){return Object.defineProperty(O,Y,{value:ee,enumerable:!0,configurable:!0,writable:!0}),O[Y]}try{m({},"")}catch{m=function(Y,ee,ye){return Y[ee]=ye}}function f(O,Y,ee,ye){var Ce=Y&&Y.prototype instanceof J?Y:J,he=Object.create(Ce.prototype),Ne=new F(ye||[]);return he._invoke=function(He,ne,de){var Ie=x;return function(Be,Re){if(Ie===M)throw new Error("Generator is already running");if(Ie===E){if(Be==="throw")throw Re;return j()}for(de.method=Be,de.arg=Re;;){var Xe=de.delegate;if(Xe){var Le=_(Xe,de);if(Le){if(Le===z)continue;return Le}}if(de.method==="next")de.sent=de._sent=de.arg;else if(de.method==="throw"){if(Ie===x)throw Ie=E,de.arg;de.dispatchException(de.arg)}else de.method==="return"&&de.abrupt("return",de.arg);Ie=M;var Qe=G(He,ne,de);if(Qe.type==="normal"){if(Ie=de.done?E:B,Qe.arg===z)continue;return{value:Qe.arg,done:de.done}}Qe.type==="throw"&&(Ie=E,de.method="throw",de.arg=Qe.arg)}}}(O,ee,Ne),he}function G(O,Y,ee){try{return{type:"normal",arg:O.call(Y,ee)}}catch(ye){return{type:"throw",arg:ye}}}c.wrap=f;var x="suspendedStart",B="suspendedYield",M="executing",E="completed",z={};function J(){}function V(){}function I(){}var w={};w[p]=function(){return this};var S=Object.getPrototypeOf,R=S&&S(S(K([])));R&&R!==d&&u.call(R,p)&&(w=R);var W=I.prototype=J.prototype=Object.create(w);function H(O){["next","throw","return"].forEach(function(Y){m(O,Y,function(ee){return this._invoke(Y,ee)})})}function k(O,Y){function ee(Ce,he,Ne,He){var ne=G(O[Ce],O,he);if(ne.type!=="throw"){var de=ne.arg,Ie=de.value;return Ie&&typeof Ie=="object"&&u.call(Ie,"__await")?Y.resolve(Ie.__await).then(function(Be){ee("next",Be,Ne,He)},function(Be){ee("throw",Be,Ne,He)}):Y.resolve(Ie).then(function(Be){de.value=Be,Ne(de)},function(Be){return ee("throw",Be,Ne,He)})}He(ne.arg)}var ye;this._invoke=function(Ce,he){function Ne(){return new Y(function(He,ne){ee(Ce,he,He,ne)})}return ye=ye?ye.then(Ne,Ne):Ne()}}function _(O,Y){var ee=O.iterator[Y.method];if(ee===g){if(Y.delegate=null,Y.method==="throw"){if(O.iterator.return&&(Y.method="return",Y.arg=g,_(O,Y),Y.method==="throw"))return z;Y.method="throw",Y.arg=new TypeError("The iterator does not provide a 'throw' method")}return z}var ye=G(ee,O.iterator,Y.arg);if(ye.type==="throw")return Y.method="throw",Y.arg=ye.arg,Y.delegate=null,z;var Ce=ye.arg;return Ce?Ce.done?(Y[O.resultName]=Ce.value,Y.next=O.nextLoc,Y.method!=="return"&&(Y.method="next",Y.arg=g),Y.delegate=null,z):Ce:(Y.method="throw",Y.arg=new TypeError("iterator result is not an object"),Y.delegate=null,z)}function Z(O){var Y={tryLoc:O[0]};1 in O&&(Y.catchLoc=O[1]),2 in O&&(Y.finallyLoc=O[2],Y.afterLoc=O[3]),this.tryEntries.push(Y)}function T(O){var Y=O.completion||{};Y.type="normal",delete Y.arg,O.completion=Y}function F(O){this.tryEntries=[{tryLoc:"root"}],O.forEach(Z,this),this.reset(!0)}function K(O){if(O){var Y=O[p];if(Y)return Y.call(O);if(typeof O.next=="function")return O;if(!isNaN(O.length)){var ee=-1,ye=function Ce(){for(;++ee<O.length;)if(u.call(O,ee))return Ce.value=O[ee],Ce.done=!1,Ce;return Ce.value=g,Ce.done=!0,Ce};return ye.next=ye}}return{next:j}}function j(){return{value:g,done:!0}}return V.prototype=W.constructor=I,I.constructor=V,V.displayName=m(I,y,"GeneratorFunction"),c.isGeneratorFunction=function(O){var Y=typeof O=="function"&&O.constructor;return!!Y&&(Y===V||(Y.displayName||Y.name)==="GeneratorFunction")},c.mark=function(O){return Object.setPrototypeOf?Object.setPrototypeOf(O,I):(O.__proto__=I,m(O,y,"GeneratorFunction")),O.prototype=Object.create(W),O},c.awrap=function(O){return{__await:O}},H(k.prototype),k.prototype[b]=function(){return this},c.AsyncIterator=k,c.async=function(O,Y,ee,ye,Ce){Ce===void 0&&(Ce=Promise);var he=new k(f(O,Y,ee,ye),Ce);return c.isGeneratorFunction(Y)?he:he.next().then(function(Ne){return Ne.done?Ne.value:he.next()})},H(W),m(W,y,"Generator"),W[p]=function(){return this},W.toString=function(){return"[object Generator]"},c.keys=function(O){var Y=[];for(var ee in O)Y.push(ee);return Y.reverse(),function ye(){for(;Y.length;){var Ce=Y.pop();if(Ce in O)return ye.value=Ce,ye.done=!1,ye}return ye.done=!0,ye}},c.values=K,F.prototype={constructor:F,reset:function(O){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(T),!O)for(var Y in this)Y.charAt(0)==="t"&&u.call(this,Y)&&!isNaN(+Y.slice(1))&&(this[Y]=g)},stop:function(){this.done=!0;var O=this.tryEntries[0].completion;if(O.type==="throw")throw O.arg;return this.rval},dispatchException:function(O){if(this.done)throw O;var Y=this;function ee(ne,de){return he.type="throw",he.arg=O,Y.next=ne,de&&(Y.method="next",Y.arg=g),!!de}for(var ye=this.tryEntries.length-1;ye>=0;--ye){var Ce=this.tryEntries[ye],he=Ce.completion;if(Ce.tryLoc==="root")return ee("end");if(Ce.tryLoc<=this.prev){var Ne=u.call(Ce,"catchLoc"),He=u.call(Ce,"finallyLoc");if(Ne&&He){if(this.prev<Ce.catchLoc)return ee(Ce.catchLoc,!0);if(this.prev<Ce.finallyLoc)return ee(Ce.finallyLoc)}else if(Ne){if(this.prev<Ce.catchLoc)return ee(Ce.catchLoc,!0)}else{if(!He)throw new Error("try statement without catch or finally");if(this.prev<Ce.finallyLoc)return ee(Ce.finallyLoc)}}}},abrupt:function(O,Y){for(var ee=this.tryEntries.length-1;ee>=0;--ee){var ye=this.tryEntries[ee];if(ye.tryLoc<=this.prev&&u.call(ye,"finallyLoc")&&this.prev<ye.finallyLoc){var Ce=ye;break}}Ce&&(O==="break"||O==="continue")&&Ce.tryLoc<=Y&&Y<=Ce.finallyLoc&&(Ce=null);var he=Ce?Ce.completion:{};return he.type=O,he.arg=Y,Ce?(this.method="next",this.next=Ce.finallyLoc,z):this.complete(he)},complete:function(O,Y){if(O.type==="throw")throw O.arg;return O.type==="break"||O.type==="continue"?this.next=O.arg:O.type==="return"?(this.rval=this.arg=O.arg,this.method="return",this.next="end"):O.type==="normal"&&Y&&(this.next=Y),z},finish:function(O){for(var Y=this.tryEntries.length-1;Y>=0;--Y){var ee=this.tryEntries[Y];if(ee.finallyLoc===O)return this.complete(ee.completion,ee.afterLoc),T(ee),z}},catch:function(O){for(var Y=this.tryEntries.length-1;Y>=0;--Y){var ee=this.tryEntries[Y];if(ee.tryLoc===O){var ye=ee.completion;if(ye.type==="throw"){var Ce=ye.arg;T(ee)}return Ce}}throw new Error("illegal catch attempt")},delegateYield:function(O,Y,ee){return this.delegate={iterator:K(O),resultName:Y,nextLoc:ee},this.method==="next"&&(this.arg=g),z}},c}(a.exports);try{regeneratorRuntime=l}catch{Function("r","regeneratorRuntime = r")(l)}},868:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},300:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},264:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},329:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},469:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},961:function(a,l,c){var g=this&&this.__createBinding||(Object.create?function(u,h,p,b){b===void 0&&(b=p),Object.defineProperty(u,b,{enumerable:!0,get:function(){return h[p]}})}:function(u,h,p,b){b===void 0&&(b=p),u[b]=h[p]}),d=this&&this.__exportStar||function(u,h){for(var p in u)p==="default"||Object.prototype.hasOwnProperty.call(h,p)||g(h,u,p)};Object.defineProperty(l,"__esModule",{value:!0}),d(c(300),l),d(c(329),l),d(c(264),l),d(c(469),l)},974:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},252:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},130:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},330:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},208:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},349:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},581:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},164:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},667:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},855:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},702:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},515:function(a,l,c){var g=this&&this.__createBinding||(Object.create?function(u,h,p,b){b===void 0&&(b=p),Object.defineProperty(u,b,{enumerable:!0,get:function(){return h[p]}})}:function(u,h,p,b){b===void 0&&(b=p),u[b]=h[p]}),d=this&&this.__exportStar||function(u,h){for(var p in u)p==="default"||Object.prototype.hasOwnProperty.call(h,p)||g(h,u,p)};Object.defineProperty(l,"__esModule",{value:!0}),d(c(252),l),d(c(330),l),d(c(208),l),d(c(349),l),d(c(130),l),d(c(581),l),d(c(667),l),d(c(855),l),d(c(702),l),d(c(164),l)},47:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},64:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},712:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},77:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},589:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},457:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},796:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},247:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},676:(a,l)=>{Object.defineProperty(l,"__esModule",{value:!0})},799:function(a,l,c){var g=this&&this.__createBinding||(Object.create?function(u,h,p,b){b===void 0&&(b=p),Object.defineProperty(u,b,{enumerable:!0,get:function(){return h[p]}})}:function(u,h,p,b){b===void 0&&(b=p),u[b]=h[p]}),d=this&&this.__exportStar||function(u,h){for(var p in u)p==="default"||Object.prototype.hasOwnProperty.call(h,p)||g(h,u,p)};Object.defineProperty(l,"__esModule",{value:!0}),d(c(47),l),d(c(64),l),d(c(589),l),d(c(457),l),d(c(247),l),d(c(676),l),d(c(712),l),d(c(77),l),d(c(796),l)},717:function(a,l,c){var g=this&&this.__createBinding||(Object.create?function(u,h,p,b){b===void 0&&(b=p),Object.defineProperty(u,b,{enumerable:!0,get:function(){return h[p]}})}:function(u,h,p,b){b===void 0&&(b=p),u[b]=h[p]}),d=this&&this.__exportStar||function(u,h){for(var p in u)p==="default"||Object.prototype.hasOwnProperty.call(h,p)||g(h,u,p)};Object.defineProperty(l,"__esModule",{value:!0}),d(c(961),l),d(c(515),l),d(c(868),l),d(c(799),l),d(c(974),l)}},t={};function n(a){var l=t[a];if(l!==void 0)return l.exports;var c=t[a]={exports:{}};return e[a].call(c.exports,c,c.exports,n),c.exports}n.n=a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return n.d(l,{a:l}),l},n.d=(a,l)=>{for(var c in l)n.o(l,c)&&!n.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:l[c]})},n.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l),n.r=a=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{default:()=>g,Particles:()=>a.Z});var a=n(312),l=n(717),c={};for(const d in l)["default","Particles"].indexOf(d)<0&&(c[d]=()=>l[d]);n.d(r,c);const g=a.Z})();var s=i;for(var o in r)s[o]=r[o];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})()})(PE);const Wb=PE;for(let i in Wb)Wb.default[i]=Wb[i];var W0e=Wb.default;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const _b="138",Ng={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Eg={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},qH=0,MB=1,$H=2,Hte=3,Fte=0,WB=1,_B=2,qd=3,Hg=0,di=1,Fg=2,VB=1,Lte=2,Ua=0,Lg=1,NB=2,EB=3,HB=4,eF=5,Tg=100,tF=101,nF=102,FB=103,LB=104,iF=200,rF=201,sF=202,oF=203,TB=204,XB=205,aF=206,lF=207,cF=208,gF=209,uF=210,dF=0,hF=1,fF=2,Vb=3,IF=4,CF=5,pF=6,mF=7,XC=0,AF=1,bF=2,ra=0,yF=1,vF=2,xF=3,zB=4,wF=5,Nb=300,hc=301,fc=302,zC=303,kC=304,$d=306,YC=307,KC=1e3,Er=1001,PC=1002,bi=1003,Eb=1004,Tte=1004,Hb=1005,Xte=1005,jn=1006,kB=1007,zte=1007,Xg=1008,kte=1008,Ic=1009,GF=1010,BF=1011,eh=1012,SF=1013,DC=1014,Oa=1015,zg=1016,ZF=1017,RF=1018,kg=1020,MF=1021,WF=1022,Ar=1023,_F=1024,VF=1025,Cc=1026,Yg=1027,NF=1028,EF=1029,HF=1030,FF=1031,LF=1033,Fb=33776,Lb=33777,Tb=33778,Xb=33779,YB=35840,KB=35841,PB=35842,DB=35843,TF=36196,UB=37492,OB=37496,JB=37808,QB=37809,jB=37810,qB=37811,$B=37812,eS=37813,tS=37814,nS=37815,iS=37816,rS=37817,sS=37818,oS=37819,aS=37820,lS=37821,cS=36492,XF=2200,zF=2201,kF=2202,UC=2300,OC=2301,zb=2302,Kg=2400,Pg=2401,JC=2402,kb=2500,gS=2501,YF=0,Yte=1,Kte=2,Ao=3e3,Mn=3001,KF=3200,PF=3201,Dg=0,DF=1,Pte=0,Yb=7680,Dte=7681,Ute=7682,Ote=7683,Jte=34055,Qte=34056,jte=5386,qte=512,$te=513,ene=514,tne=515,nne=516,ine=517,rne=518,UF=519,th=35044,nh=35048,sne=35040,one=35045,ane=35049,lne=35041,cne=35046,gne=35050,une=35042,dne="100",uS="300 es",Kb=1035;class Ja{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const er=[];for(let i=0;i<256;i++)er[i]=(i<16?"0":"")+i.toString(16);let Pb=1234567;const Ug=Math.PI/180,QC=180/Math.PI;function bs(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(er[i&255]+er[i>>8&255]+er[i>>16&255]+er[i>>24&255]+"-"+er[e&255]+er[e>>8&255]+"-"+er[e>>16&15|64]+er[e>>24&255]+"-"+er[t&63|128]+er[t>>8&255]+"-"+er[t>>16&255]+er[t>>24&255]+er[n&255]+er[n>>8&255]+er[n>>16&255]+er[n>>24&255]).toUpperCase()}function tr(i,e,t){return Math.max(e,Math.min(t,i))}function dS(i,e){return(i%e+e)%e}function hne(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function fne(i,e,t){return i!==e?(t-i)/(e-i):0}function jC(i,e,t){return(1-t)*i+t*e}function Ine(i,e,t,n){return jC(i,e,1-Math.exp(-t*n))}function Cne(i,e=1){return e-Math.abs(dS(i,e*2)-e)}function pne(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function mne(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function Ane(i,e){return i+Math.floor(Math.random()*(e-i+1))}function bne(i,e){return i+Math.random()*(e-i)}function yne(i){return i*(.5-Math.random())}function vne(i){return i!==void 0&&(Pb=i%2147483647),Pb=Pb*16807%2147483647,(Pb-1)/2147483646}function xne(i){return i*Ug}function wne(i){return i*QC}function hS(i){return(i&i-1)==0&&i!==0}function OF(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Db(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Gne(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+n)/2),g=o((e+n)/2),d=s((e-n)/2),u=o((e-n)/2),h=s((n-e)/2),p=o((n-e)/2);switch(r){case"XYX":i.set(a*g,l*d,l*u,a*c);break;case"YZY":i.set(l*u,a*g,l*d,a*c);break;case"ZXZ":i.set(l*d,l*u,a*g,a*c);break;case"XZX":i.set(a*g,l*p,l*h,a*c);break;case"YXY":i.set(l*h,a*g,l*p,a*c);break;case"ZYZ":i.set(l*p,l*h,a*g,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}var JF=Object.freeze({__proto__:null,DEG2RAD:Ug,RAD2DEG:QC,generateUUID:bs,clamp:tr,euclideanModulo:dS,mapLinear:hne,inverseLerp:fne,lerp:jC,damp:Ine,pingpong:Cne,smoothstep:pne,smootherstep:mne,randInt:Ane,randFloat:bne,randFloatSpread:yne,seededRandom:vne,degToRad:xne,radToDeg:wne,isPowerOfTwo:hS,ceilPowerOfTwo:OF,floorPowerOfTwo:Db,setQuaternionFromProperEuler:Gne});class Ke{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Ke.prototype.isVector2=!0;class Si{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,s,o,a,l,c){const g=this.elements;return g[0]=e,g[1]=r,g[2]=a,g[3]=t,g[4]=s,g[5]=l,g[6]=n,g[7]=o,g[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],g=n[4],d=n[7],u=n[2],h=n[5],p=n[8],b=r[0],y=r[3],m=r[6],f=r[1],G=r[4],x=r[7],B=r[2],M=r[5],E=r[8];return s[0]=o*b+a*f+l*B,s[3]=o*y+a*G+l*M,s[6]=o*m+a*x+l*E,s[1]=c*b+g*f+d*B,s[4]=c*y+g*G+d*M,s[7]=c*m+g*x+d*E,s[2]=u*b+h*f+p*B,s[5]=u*y+h*G+p*M,s[8]=u*m+h*x+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8];return t*o*g-t*a*c-n*s*g+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],d=g*o-a*c,u=a*l-g*s,h=c*s-o*l,p=t*d+n*u+r*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/p;return e[0]=d*b,e[1]=(r*c-g*n)*b,e[2]=(a*n-r*o)*b,e[3]=u*b,e[4]=(g*t-r*l)*b,e[5]=(r*s-a*t)*b,e[6]=h*b,e[7]=(n*l-c*t)*b,e[8]=(o*t-n*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,s=r[0],o=r[3],a=r[6],l=r[1],c=r[4],g=r[7];return r[0]=t*s+n*l,r[3]=t*o+n*c,r[6]=t*a+n*g,r[1]=-n*s+t*l,r[4]=-n*o+t*c,r[7]=-n*a+t*g,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}Si.prototype.isMatrix3=!0;function QF(i){for(let e=i.length-1;e>=0;--e)if(i[e]>65535)return!0;return!1}const Bne={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ih(i,e){return new Bne[i](e)}function qC(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}const jF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bo={h:0,s:0,l:0},Ub={h:0,s:0,l:0};function fS(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function rh(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function IS(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class lt{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=dS(e,1),t=tr(t,0,1),n=tr(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,s=2*n-r;this.r=fS(s,r,e+1/3),this.g=fS(s,r,e),this.b=fS(s,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const s=n[1],o=n[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const a=parseFloat(r[1])/360,l=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=jF[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=rh(e.r),this.g=rh(e.g),this.b=rh(e.b),this}copyLinearToSRGB(e){return this.r=IS(e.r),this.g=IS(e.g),this.b=IS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,s=Math.max(t,n,r),o=Math.min(t,n,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const g=s-o;switch(l=c<=.5?g/(s+o):g/(2-s-o),s){case t:a=(n-r)/g+(n<r?6:0);break;case n:a=(r-t)/g+2;break;case r:a=(t-n)/g+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(bo),bo.h+=e,bo.s+=t,bo.l+=n,this.setHSL(bo.h,bo.s,bo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(bo),e.getHSL(Ub);const n=jC(bo.h,Ub.h,t),r=jC(bo.s,Ub.s,t),s=jC(bo.l,Ub.l,t);return this.setHSL(n,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}lt.NAMES=jF;lt.prototype.isColor=!0;lt.prototype.r=1;lt.prototype.g=1;lt.prototype.b=1;let sh;class pc{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{sh===void 0&&(sh=qC("canvas")),sh.width=e.width,sh.height=e.height;const n=sh.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=sh}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=qC("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=rh(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(rh(t[n]/255)*255):t[n]=rh(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class oh{constructor(e=null){this.uuid=bs(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(CS(r[o].image)):s.push(CS(r[o]))}else s=CS(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function CS(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?pc.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}oh.prototype.isSource=!0;let Sne=0;class hi extends Ja{constructor(e=hi.DEFAULT_IMAGE,t=hi.DEFAULT_MAPPING,n=Er,r=Er,s=jn,o=Xg,a=Ar,l=Ic,c=1,g=Ao){super();Object.defineProperty(this,"id",{value:Sne++}),this.uuid=bs(),this.name="",this.source=new oh(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ke(0,0),this.repeat=new Ke(1,1),this.center=new Ke(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Si,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Nb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case KC:e.x=e.x-Math.floor(e.x);break;case Er:e.x=e.x<0?0:1;break;case PC:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case KC:e.y=e.y-Math.floor(e.y);break;case Er:e.y=e.y<0?0:1;break;case PC:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}hi.DEFAULT_IMAGE=null;hi.DEFAULT_MAPPING=Nb;hi.prototype.isTexture=!0;class mn{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const o=.01,a=.1,l=e.elements,c=l[0],g=l[4],d=l[8],u=l[1],h=l[5],p=l[9],b=l[2],y=l[6],m=l[10];if(Math.abs(g-u)<o&&Math.abs(d-b)<o&&Math.abs(p-y)<o){if(Math.abs(g+u)<a&&Math.abs(d+b)<a&&Math.abs(p+y)<a&&Math.abs(c+h+m-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const G=(c+1)/2,x=(h+1)/2,B=(m+1)/2,M=(g+u)/4,E=(d+b)/4,z=(p+y)/4;return G>x&&G>B?G<o?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(G),r=M/n,s=E/n):x>B?x<o?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),n=M/r,s=z/r):B<o?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(B),n=E/s,r=z/s),this.set(n,r,s,t),this}let f=Math.sqrt((y-p)*(y-p)+(d-b)*(d-b)+(u-g)*(u-g));return Math.abs(f)<.001&&(f=1),this.x=(y-p)/f,this.y=(d-b)/f,this.z=(u-g)/f,this.w=Math.acos((c+h+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}mn.prototype.isVector4=!0;class Hr extends Ja{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new mn(0,0,e,t),this.scissorTest=!1,this.viewport=new mn(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new hi(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:jn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Hr.prototype.isWebGLRenderTarget=!0;class ah extends hi{constructor(e=null,t=1,n=1,r=1){super(null);this.image={data:e,width:t,height:n,depth:r},this.magFilter=bi,this.minFilter=bi,this.wrapR=Er,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}ah.prototype.isDataArrayTexture=!0;class qF extends Hr{constructor(e,t,n){super(e,t);this.depth=n,this.texture=new ah(null,e,t,n),this.texture.isRenderTargetTexture=!0}}qF.prototype.isWebGLArrayRenderTarget=!0;class $C extends hi{constructor(e=null,t=1,n=1,r=1){super(null);this.image={data:e,width:t,height:n,depth:r},this.magFilter=bi,this.minFilter=bi,this.wrapR=Er,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}$C.prototype.isData3DTexture=!0;class $F extends Hr{constructor(e,t,n){super(e,t);this.depth=n,this.texture=new $C(null,e,t,n),this.texture.isRenderTargetTexture=!0}}$F.prototype.isWebGL3DRenderTarget=!0;class eL extends Hr{constructor(e,t,n,r={}){super(e,t,r);const s=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}eL.prototype.isWebGLMultipleRenderTargets=!0;class Zi{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],g=n[r+2],d=n[r+3];const u=s[o+0],h=s[o+1],p=s[o+2],b=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=g,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=h,e[t+2]=p,e[t+3]=b;return}if(d!==b||l!==u||c!==h||g!==p){let y=1-a;const m=l*u+c*h+g*p+d*b,f=m>=0?1:-1,G=1-m*m;if(G>Number.EPSILON){const B=Math.sqrt(G),M=Math.atan2(B,m*f);y=Math.sin(y*M)/B,a=Math.sin(a*M)/B}const x=a*f;if(l=l*y+u*x,c=c*y+h*x,g=g*y+p*x,d=d*y+b*x,y===1-a){const B=1/Math.sqrt(l*l+c*c+g*g+d*d);l*=B,c*=B,g*=B,d*=B}}e[t]=l,e[t+1]=c,e[t+2]=g,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],g=n[r+3],d=s[o],u=s[o+1],h=s[o+2],p=s[o+3];return e[t]=a*p+g*d+l*h-c*u,e[t+1]=l*p+g*u+c*d-a*h,e[t+2]=c*p+g*h+a*u-l*d,e[t+3]=g*p-a*d-l*u-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),g=a(r/2),d=a(s/2),u=l(n/2),h=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=u*g*d+c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d-u*h*p;break;case"YXZ":this._x=u*g*d+c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d+u*h*p;break;case"ZXY":this._x=u*g*d-c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d-u*h*p;break;case"ZYX":this._x=u*g*d-c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d+u*h*p;break;case"YZX":this._x=u*g*d+c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d-u*h*p;break;case"XZY":this._x=u*g*d-c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d+u*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],g=t[6],d=t[10],u=n+a+d;if(u>0){const h=.5/Math.sqrt(u+1);this._w=.25/h,this._x=(g-l)*h,this._y=(s-c)*h,this._z=(o-r)*h}else if(n>a&&n>d){const h=2*Math.sqrt(1+n-a-d);this._w=(g-l)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+c)/h}else if(a>d){const h=2*Math.sqrt(1+a-n-d);this._w=(s-c)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(l+g)/h}else{const h=2*Math.sqrt(1+d-n-a);this._w=(o-r)/h,this._x=(s+c)/h,this._y=(l+g)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(tr(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,g=t._w;return this._x=n*g+o*a+r*c-s*l,this._y=r*g+o*l+s*a-n*c,this._z=s*g+o*c+n*l-r*a,this._w=o*g-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*o+t*this._w,this._x=h*n+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),g=Math.atan2(c,a),d=Math.sin((1-t)*g)/c,u=Math.sin(t*g)/c;return this._w=o*d+this._w*u,this._x=n*d+this._x*u,this._y=r*d+this._y*u,this._z=s*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Zi.prototype.isQuaternion=!0;class te{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(tL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(tL.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*n,g=l*n+a*t-s*r,d=l*r+s*n-o*t,u=-s*t-o*n-a*r;return this.x=c*l+u*-s+g*-a-d*-o,this.y=g*l+u*-o+d*-s-c*-a,this.z=d*l+u*-a+c*-o-g*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return pS.copy(this).projectOnVector(e),this.sub(pS)}reflect(e){return this.sub(pS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(tr(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}te.prototype.isVector3=!0;const pS=new te,tL=new Zi;class ys{constructor(e=new te(1/0,1/0,1/0),t=new te(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const g=e[l],d=e[l+1],u=e[l+2];g<t&&(t=g),d<n&&(n=d),u<r&&(r=u),g>s&&(s=g),d>o&&(o=d),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const g=e.getX(l),d=e.getY(l),u=e.getZ(l);g<t&&(t=g),d<n&&(n=d),u<r&&(r=u),g>s&&(s=g),d>o&&(o=d),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Og.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const s=n.attributes.position;for(let o=0,a=s.count;o<a;o++)Og.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Og)}else n.boundingBox===null&&n.computeBoundingBox(),mS.copy(n.boundingBox),mS.applyMatrix4(e.matrixWorld),this.union(mS);const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Og),Og.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ep),Ob.subVectors(this.max,ep),lh.subVectors(e.a,ep),ch.subVectors(e.b,ep),gh.subVectors(e.c,ep),mc.subVectors(ch,lh),Ac.subVectors(gh,ch),Jg.subVectors(lh,gh);let t=[0,-mc.z,mc.y,0,-Ac.z,Ac.y,0,-Jg.z,Jg.y,mc.z,0,-mc.x,Ac.z,0,-Ac.x,Jg.z,0,-Jg.x,-mc.y,mc.x,0,-Ac.y,Ac.x,0,-Jg.y,Jg.x,0];return!AS(t,lh,ch,gh,Ob)||(t=[1,0,0,0,1,0,0,0,1],!AS(t,lh,ch,gh,Ob))?!1:(Jb.crossVectors(mc,Ac),t=[Jb.x,Jb.y,Jb.z],AS(t,lh,ch,gh,Ob))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Og.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Og).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Qa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ys.prototype.isBox3=!0;const Qa=[new te,new te,new te,new te,new te,new te,new te,new te],Og=new te,mS=new ys,lh=new te,ch=new te,gh=new te,mc=new te,Ac=new te,Jg=new te,ep=new te,Ob=new te,Jb=new te,Qg=new te;function AS(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){Qg.fromArray(i,s);const a=r.x*Math.abs(Qg.x)+r.y*Math.abs(Qg.y)+r.z*Math.abs(Qg.z),l=e.dot(Qg),c=t.dot(Qg),g=n.dot(Qg);if(Math.max(-Math.max(l,c,g),Math.min(l,c,g))>a)return!1}return!0}const Zne=new ys,nL=new te,Qb=new te,bS=new te;class bc{constructor(e=new te,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Zne.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){bS.subVectors(e,this.center);const t=bS.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.add(bS.multiplyScalar(r/n)),this.radius+=r}return this}union(e){return this.center.equals(e.center)===!0?Qb.set(0,0,1).multiplyScalar(e.radius):Qb.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(nL.copy(e.center).add(Qb)),this.expandByPoint(nL.copy(e.center).sub(Qb)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ja=new te,yS=new te,jb=new te,yc=new te,vS=new te,qb=new te,xS=new te;class vc{constructor(e=new te,t=new te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ja)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ja.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ja.copy(this.direction).multiplyScalar(t).add(this.origin),ja.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){yS.copy(e).add(t).multiplyScalar(.5),jb.copy(t).sub(e).normalize(),yc.copy(this.origin).sub(yS);const s=e.distanceTo(t)*.5,o=-this.direction.dot(jb),a=yc.dot(this.direction),l=-yc.dot(jb),c=yc.lengthSq(),g=Math.abs(1-o*o);let d,u,h,p;if(g>0)if(d=o*l-a,u=o*a-l,p=s*g,d>=0)if(u>=-p)if(u<=p){const b=1/g;d*=b,u*=b,h=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;else u=-s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;else u<=-p?(d=Math.max(0,-(-o*s+a)),u=d>0?-s:Math.min(Math.max(-s,-l),s),h=-d*d+u*(u+2*l)+c):u<=p?(d=0,u=Math.min(Math.max(-s,-l),s),h=u*(u+2*l)+c):(d=Math.max(0,-(o*s+a)),u=d>0?s:Math.min(Math.max(-s,-l),s),h=-d*d+u*(u+2*l)+c);else u=o>0?-s:s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(jb).multiplyScalar(u).add(yS),h}intersectSphere(e,t){ja.subVectors(e.center,this.origin);const n=ja.dot(this.direction),r=ja.dot(ja)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,g=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(n=(e.min.x-u.x)*c,r=(e.max.x-u.x)*c):(n=(e.max.x-u.x)*c,r=(e.min.x-u.x)*c),g>=0?(s=(e.min.y-u.y)*g,o=(e.max.y-u.y)*g):(s=(e.max.y-u.y)*g,o=(e.min.y-u.y)*g),n>o||s>r||((s>n||n!==n)&&(n=s),(o<r||r!==r)&&(r=o),d>=0?(a=(e.min.z-u.z)*d,l=(e.max.z-u.z)*d):(a=(e.max.z-u.z)*d,l=(e.min.z-u.z)*d),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,ja)!==null}intersectTriangle(e,t,n,r,s){vS.subVectors(t,e),qb.subVectors(n,e),xS.crossVectors(vS,qb);let o=this.direction.dot(xS),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;yc.subVectors(this.origin,e);const l=a*this.direction.dot(qb.crossVectors(yc,qb));if(l<0)return null;const c=a*this.direction.dot(vS.cross(yc));if(c<0||l+c>o)return null;const g=-a*yc.dot(xS);return g<0?null:this.at(g/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class bt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,s,o,a,l,c,g,d,u,h,p,b,y){const m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=g,m[10]=d,m[14]=u,m[3]=h,m[7]=p,m[11]=b,m[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new bt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/uh.setFromMatrixColumn(e,0).length(),s=1/uh.setFromMatrixColumn(e,1).length(),o=1/uh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),g=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const u=o*g,h=o*d,p=a*g,b=a*d;t[0]=l*g,t[4]=-l*d,t[8]=c,t[1]=h+p*c,t[5]=u-b*c,t[9]=-a*l,t[2]=b-u*c,t[6]=p+h*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*g,h=l*d,p=c*g,b=c*d;t[0]=u+b*a,t[4]=p*a-h,t[8]=o*c,t[1]=o*d,t[5]=o*g,t[9]=-a,t[2]=h*a-p,t[6]=b+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*g,h=l*d,p=c*g,b=c*d;t[0]=u-b*a,t[4]=-o*d,t[8]=p+h*a,t[1]=h+p*a,t[5]=o*g,t[9]=b-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*g,h=o*d,p=a*g,b=a*d;t[0]=l*g,t[4]=p*c-h,t[8]=u*c+b,t[1]=l*d,t[5]=b*c+u,t[9]=h*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,h=o*c,p=a*l,b=a*c;t[0]=l*g,t[4]=b-u*d,t[8]=p*d+h,t[1]=d,t[5]=o*g,t[9]=-a*g,t[2]=-c*g,t[6]=h*d+p,t[10]=u-b*d}else if(e.order==="XZY"){const u=o*l,h=o*c,p=a*l,b=a*c;t[0]=l*g,t[4]=-d,t[8]=c*g,t[1]=u*d+b,t[5]=o*g,t[9]=h*d-p,t[2]=p*d-h,t[6]=a*g,t[10]=b*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Rne,e,Mne)}lookAt(e,t,n){const r=this.elements;return vs.subVectors(e,t),vs.lengthSq()===0&&(vs.z=1),vs.normalize(),xc.crossVectors(n,vs),xc.lengthSq()===0&&(Math.abs(n.z)===1?vs.x+=1e-4:vs.z+=1e-4,vs.normalize(),xc.crossVectors(n,vs)),xc.normalize(),$b.crossVectors(vs,xc),r[0]=xc.x,r[4]=$b.x,r[8]=vs.x,r[1]=xc.y,r[5]=$b.y,r[9]=vs.y,r[2]=xc.z,r[6]=$b.z,r[10]=vs.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],g=n[1],d=n[5],u=n[9],h=n[13],p=n[2],b=n[6],y=n[10],m=n[14],f=n[3],G=n[7],x=n[11],B=n[15],M=r[0],E=r[4],z=r[8],J=r[12],V=r[1],I=r[5],w=r[9],S=r[13],R=r[2],W=r[6],H=r[10],k=r[14],_=r[3],Z=r[7],T=r[11],F=r[15];return s[0]=o*M+a*V+l*R+c*_,s[4]=o*E+a*I+l*W+c*Z,s[8]=o*z+a*w+l*H+c*T,s[12]=o*J+a*S+l*k+c*F,s[1]=g*M+d*V+u*R+h*_,s[5]=g*E+d*I+u*W+h*Z,s[9]=g*z+d*w+u*H+h*T,s[13]=g*J+d*S+u*k+h*F,s[2]=p*M+b*V+y*R+m*_,s[6]=p*E+b*I+y*W+m*Z,s[10]=p*z+b*w+y*H+m*T,s[14]=p*J+b*S+y*k+m*F,s[3]=f*M+G*V+x*R+B*_,s[7]=f*E+G*I+x*W+B*Z,s[11]=f*z+G*w+x*H+B*T,s[15]=f*J+G*S+x*k+B*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],g=e[2],d=e[6],u=e[10],h=e[14],p=e[3],b=e[7],y=e[11],m=e[15];return p*(+s*l*d-r*c*d-s*a*u+n*c*u+r*a*h-n*l*h)+b*(+t*l*h-t*c*u+s*o*u-r*o*h+r*c*g-s*l*g)+y*(+t*c*d-t*a*h-s*o*d+n*o*h+s*a*g-n*c*g)+m*(-r*a*g-t*l*d+t*a*u+r*o*d-n*o*u+n*l*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],d=e[9],u=e[10],h=e[11],p=e[12],b=e[13],y=e[14],m=e[15],f=d*y*c-b*u*c+b*l*h-a*y*h-d*l*m+a*u*m,G=p*u*c-g*y*c-p*l*h+o*y*h+g*l*m-o*u*m,x=g*b*c-p*d*c+p*a*h-o*b*h-g*a*m+o*d*m,B=p*d*l-g*b*l-p*a*u+o*b*u+g*a*y-o*d*y,M=t*f+n*G+r*x+s*B;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/M;return e[0]=f*E,e[1]=(b*u*s-d*y*s-b*r*h+n*y*h+d*r*m-n*u*m)*E,e[2]=(a*y*s-b*l*s+b*r*c-n*y*c-a*r*m+n*l*m)*E,e[3]=(d*l*s-a*u*s-d*r*c+n*u*c+a*r*h-n*l*h)*E,e[4]=G*E,e[5]=(g*y*s-p*u*s+p*r*h-t*y*h-g*r*m+t*u*m)*E,e[6]=(p*l*s-o*y*s-p*r*c+t*y*c+o*r*m-t*l*m)*E,e[7]=(o*u*s-g*l*s+g*r*c-t*u*c-o*r*h+t*l*h)*E,e[8]=x*E,e[9]=(p*d*s-g*b*s-p*n*h+t*b*h+g*n*m-t*d*m)*E,e[10]=(o*b*s-p*a*s+p*n*c-t*b*c-o*n*m+t*a*m)*E,e[11]=(g*a*s-o*d*s-g*n*c+t*d*c+o*n*h-t*a*h)*E,e[12]=B*E,e[13]=(g*b*r-p*d*r+p*n*u-t*b*u-g*n*y+t*d*y)*E,e[14]=(p*a*r-o*b*r-p*n*l+t*b*l+o*n*y-t*a*y)*E,e[15]=(o*d*r-g*a*r+g*n*l-t*d*l-o*n*u+t*a*u)*E,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,g=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,g*a+n,g*l-r*o,0,c*l-r*a,g*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,g=o+o,d=a+a,u=s*c,h=s*g,p=s*d,b=o*g,y=o*d,m=a*d,f=l*c,G=l*g,x=l*d,B=n.x,M=n.y,E=n.z;return r[0]=(1-(b+m))*B,r[1]=(h+x)*B,r[2]=(p-G)*B,r[3]=0,r[4]=(h-x)*M,r[5]=(1-(u+m))*M,r[6]=(y+f)*M,r[7]=0,r[8]=(p+G)*E,r[9]=(y-f)*E,r[10]=(1-(u+b))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=uh.set(r[0],r[1],r[2]).length();const o=uh.set(r[4],r[5],r[6]).length(),a=uh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],yo.copy(this);const c=1/s,g=1/o,d=1/a;return yo.elements[0]*=c,yo.elements[1]*=c,yo.elements[2]*=c,yo.elements[4]*=g,yo.elements[5]*=g,yo.elements[6]*=g,yo.elements[8]*=d,yo.elements[9]*=d,yo.elements[10]*=d,t.setFromRotationMatrix(yo),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,l=2*s/(t-e),c=2*s/(n-r),g=(t+e)/(t-e),d=(n+r)/(n-r),u=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=l,a[4]=0,a[8]=g,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,s,o){const a=this.elements,l=1/(t-e),c=1/(n-r),g=1/(o-s),d=(t+e)*l,u=(n+r)*c,h=(o+s)*g;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*g,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}bt.prototype.isMatrix4=!0;const uh=new te,yo=new bt,Rne=new te(0,0,0),Mne=new te(1,1,1),xc=new te,$b=new te,vs=new te,iL=new bt,rL=new Zi;class wc{constructor(e=0,t=0,n=0,r=wc.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],g=r[9],d=r[2],u=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(tr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-g,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-tr(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(tr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-tr(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(tr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-g,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-tr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-g,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return iL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(iL,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rL.setFromEuler(this),this.setFromQuaternion(rL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}wc.prototype.isEuler=!0;wc.DefaultOrder="XYZ";wc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class jg{constructor(){this.mask=1|0}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let Wne=0;const sL=new te,dh=new Zi,qa=new bt,ey=new te,tp=new te,_ne=new te,Vne=new Zi,oL=new te(1,0,0),aL=new te(0,1,0),lL=new te(0,0,1),Nne={type:"added"},cL={type:"removed"};class Ut extends Ja{constructor(){super();Object.defineProperty(this,"id",{value:Wne++}),this.uuid=bs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ut.DefaultUp.clone();const e=new te,t=new wc,n=new Zi,r=new te(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new bt},normalMatrix:{value:new Si}}),this.matrix=new bt,this.matrixWorld=new bt,this.matrixAutoUpdate=Ut.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new jg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return dh.setFromAxisAngle(e,t),this.quaternion.multiply(dh),this}rotateOnWorldAxis(e,t){return dh.setFromAxisAngle(e,t),this.quaternion.premultiply(dh),this}rotateX(e){return this.rotateOnAxis(oL,e)}rotateY(e){return this.rotateOnAxis(aL,e)}rotateZ(e){return this.rotateOnAxis(lL,e)}translateOnAxis(e,t){return sL.copy(e).applyQuaternion(this.quaternion),this.position.add(sL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(oL,e)}translateY(e){return this.translateOnAxis(aL,e)}translateZ(e){return this.translateOnAxis(lL,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qa.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ey.copy(e):ey.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),tp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qa.lookAt(tp,ey,this.up):qa.lookAt(ey,tp,this.up),this.quaternion.setFromRotationMatrix(qa),r&&(qa.extractRotation(r.matrixWorld),dh.setFromRotationMatrix(qa),this.quaternion.premultiply(dh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Nne)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(cL)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(cL)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qa.multiply(e.parent.matrixWorld)),e.applyMatrix4(qa),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tp,e,_ne),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tp,Vne,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,g=l.length;c<g;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),g=o(e.images),d=o(e.shapes),u=o(e.skeletons),h=o(e.animations),p=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),g.length>0&&(n.images=g),d.length>0&&(n.shapes=d),u.length>0&&(n.skeletons=u),h.length>0&&(n.animations=h),p.length>0&&(n.nodes=p)}return n.object=r,n;function o(a){const l=[];for(const c in a){const g=a[c];delete g.metadata,l.push(g)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Ut.DefaultUp=new te(0,1,0);Ut.DefaultMatrixAutoUpdate=!0;Ut.prototype.isObject3D=!0;const vo=new te,$a=new te,wS=new te,el=new te,hh=new te,fh=new te,gL=new te,GS=new te,BS=new te,SS=new te;class fi{constructor(e=new te,t=new te,n=new te){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),vo.subVectors(e,t),r.cross(vo);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){vo.subVectors(r,t),$a.subVectors(n,t),wS.subVectors(e,t);const o=vo.dot(vo),a=vo.dot($a),l=vo.dot(wS),c=$a.dot($a),g=$a.dot(wS),d=o*c-a*a;if(d===0)return s.set(-2,-1,-1);const u=1/d,h=(c*l-a*g)*u,p=(o*g-a*l)*u;return s.set(1-h-p,p,h)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,el),el.x>=0&&el.y>=0&&el.x+el.y<=1}static getUV(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,el),l.set(0,0),l.addScaledVector(s,el.x),l.addScaledVector(o,el.y),l.addScaledVector(a,el.z),l}static isFrontFacing(e,t,n,r){return vo.subVectors(n,t),$a.subVectors(e,t),vo.cross($a).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vo.subVectors(this.c,this.b),$a.subVectors(this.a,this.b),vo.cross($a).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return fi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return fi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return fi.getUV(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return fi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return fi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;hh.subVectors(r,n),fh.subVectors(s,n),GS.subVectors(e,n);const l=hh.dot(GS),c=fh.dot(GS);if(l<=0&&c<=0)return t.copy(n);BS.subVectors(e,r);const g=hh.dot(BS),d=fh.dot(BS);if(g>=0&&d<=g)return t.copy(r);const u=l*d-g*c;if(u<=0&&l>=0&&g<=0)return o=l/(l-g),t.copy(n).addScaledVector(hh,o);SS.subVectors(e,s);const h=hh.dot(SS),p=fh.dot(SS);if(p>=0&&h<=p)return t.copy(s);const b=h*c-l*p;if(b<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(fh,a);const y=g*p-h*d;if(y<=0&&d-g>=0&&h-p>=0)return gL.subVectors(s,r),a=(d-g)/(d-g+(h-p)),t.copy(r).addScaledVector(gL,a);const m=1/(y+b+u);return o=b*m,a=u*m,t.copy(n).addScaledVector(hh,o).addScaledVector(fh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ene=0;class Ii extends Ja{constructor(){super();Object.defineProperty(this,"id",{value:Ene++}),this.uuid=bs(),this.name="",this.type="Material",this.fog=!0,this.blending=Lg,this.side=Hg,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=TB,this.blendDst=XB,this.blendEquation=Tg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Vb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=UF,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yb,this.stencilZFail=Yb,this.stencilZPass=Yb,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===VB;continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Lg&&(n.blending=this.blending),this.side!==Hg&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Ii.prototype.isMaterial=!0;Ii.fromType=function(){return null};class tl extends Ii{constructor(e){super();this.type="MeshBasicMaterial",this.color=new lt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=XC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}tl.prototype.isMeshBasicMaterial=!0;const Hn=new te,ty=new Ke;class rn{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=th,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new lt),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Ke),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new te),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new mn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ty.fromBufferAttribute(this,t),ty.applyMatrix3(e),this.setXY(t,ty.x,ty.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Hn.fromBufferAttribute(this,t),Hn.applyMatrix3(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Hn.x=this.getX(t),Hn.y=this.getY(t),Hn.z=this.getZ(t),Hn.applyMatrix4(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Hn.x=this.getX(t),Hn.y=this.getY(t),Hn.z=this.getZ(t),Hn.applyNormalMatrix(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Hn.x=this.getX(t),Hn.y=this.getY(t),Hn.z=this.getZ(t),Hn.transformDirection(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==th&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}rn.prototype.isBufferAttribute=!0;class uL extends rn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class dL extends rn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class hL extends rn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class fL extends rn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class ny extends rn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class IL extends rn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class iy extends rn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class CL extends rn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}CL.prototype.isFloat16BufferAttribute=!0;class At extends rn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class pL extends rn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Hne=0;const Qs=new bt,ZS=new Ut,Ih=new te,xs=new ys,np=new ys,Li=new te;class Nt extends Ja{constructor(){super();Object.defineProperty(this,"id",{value:Hne++}),this.uuid=bs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(QF(e)?iy:ny)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Si().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Qs.makeRotationFromQuaternion(e),this.applyMatrix4(Qs),this}rotateX(e){return Qs.makeRotationX(e),this.applyMatrix4(Qs),this}rotateY(e){return Qs.makeRotationY(e),this.applyMatrix4(Qs),this}rotateZ(e){return Qs.makeRotationZ(e),this.applyMatrix4(Qs),this}translate(e,t,n){return Qs.makeTranslation(e,t,n),this.applyMatrix4(Qs),this}scale(e,t,n){return Qs.makeScale(e,t,n),this.applyMatrix4(Qs),this}lookAt(e){return ZS.lookAt(e),ZS.updateMatrix(),this.applyMatrix4(ZS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ih).negate(),this.translate(Ih.x,Ih.y,Ih.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new At(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ys);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];xs.setFromBufferAttribute(s),this.morphTargetsRelative?(Li.addVectors(this.boundingBox.min,xs.min),this.boundingBox.expandByPoint(Li),Li.addVectors(this.boundingBox.max,xs.max),this.boundingBox.expandByPoint(Li)):(this.boundingBox.expandByPoint(xs.min),this.boundingBox.expandByPoint(xs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new bc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new te,1/0);return}if(e){const n=this.boundingSphere.center;if(xs.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];np.setFromBufferAttribute(a),this.morphTargetsRelative?(Li.addVectors(xs.min,np.min),xs.expandByPoint(Li),Li.addVectors(xs.max,np.max),xs.expandByPoint(Li)):(xs.expandByPoint(np.min),xs.expandByPoint(np.max))}xs.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Li.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Li));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,g=a.count;c<g;c++)Li.fromBufferAttribute(a,c),l&&(Ih.fromBufferAttribute(e,c),Li.add(Ih)),r=Math.max(r,n.distanceToSquared(Li))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new rn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],g=[];for(let V=0;V<a;V++)c[V]=new te,g[V]=new te;const d=new te,u=new te,h=new te,p=new Ke,b=new Ke,y=new Ke,m=new te,f=new te;function G(V,I,w){d.fromArray(r,V*3),u.fromArray(r,I*3),h.fromArray(r,w*3),p.fromArray(o,V*2),b.fromArray(o,I*2),y.fromArray(o,w*2),u.sub(d),h.sub(d),b.sub(p),y.sub(p);const S=1/(b.x*y.y-y.x*b.y);!isFinite(S)||(m.copy(u).multiplyScalar(y.y).addScaledVector(h,-b.y).multiplyScalar(S),f.copy(h).multiplyScalar(b.x).addScaledVector(u,-y.x).multiplyScalar(S),c[V].add(m),c[I].add(m),c[w].add(m),g[V].add(f),g[I].add(f),g[w].add(f))}let x=this.groups;x.length===0&&(x=[{start:0,count:n.length}]);for(let V=0,I=x.length;V<I;++V){const w=x[V],S=w.start,R=w.count;for(let W=S,H=S+R;W<H;W+=3)G(n[W+0],n[W+1],n[W+2])}const B=new te,M=new te,E=new te,z=new te;function J(V){E.fromArray(s,V*3),z.copy(E);const I=c[V];B.copy(I),B.sub(E.multiplyScalar(E.dot(I))).normalize(),M.crossVectors(z,I);const S=M.dot(g[V])<0?-1:1;l[V*4]=B.x,l[V*4+1]=B.y,l[V*4+2]=B.z,l[V*4+3]=S}for(let V=0,I=x.length;V<I;++V){const w=x[V],S=w.start,R=w.count;for(let W=S,H=S+R;W<H;W+=3)J(n[W+0]),J(n[W+1]),J(n[W+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new rn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let u=0,h=n.count;u<h;u++)n.setXYZ(u,0,0,0);const r=new te,s=new te,o=new te,a=new te,l=new te,c=new te,g=new te,d=new te;if(e)for(let u=0,h=e.count;u<h;u+=3){const p=e.getX(u+0),b=e.getX(u+1),y=e.getX(u+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,b),o.fromBufferAttribute(t,y),g.subVectors(o,s),d.subVectors(r,s),g.cross(d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,b),c.fromBufferAttribute(n,y),a.add(g),l.add(g),c.add(g),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(b,l.x,l.y,l.z),n.setXYZ(y,c.x,c.y,c.z)}else for(let u=0,h=t.count;u<h;u+=3)r.fromBufferAttribute(t,u+0),s.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),g.subVectors(o,s),d.subVectors(r,s),g.cross(d),n.setXYZ(u+0,g.x,g.y,g.z),n.setXYZ(u+1,g.x,g.y,g.z),n.setXYZ(u+2,g.x,g.y,g.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(e.attributes[r]===void 0)continue;const o=n[r].array,a=e.attributes[r],l=a.array,c=a.itemSize*t,g=Math.min(l.length,o.length-c);for(let d=0,u=c;d<g;d++,u++)o[u]=l[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Li.fromBufferAttribute(e,t),Li.normalize(),e.setXYZ(t,Li.x,Li.y,Li.z)}toNonIndexed(){function e(a,l){const c=a.array,g=a.itemSize,d=a.normalized,u=new c.constructor(l.length*g);let h=0,p=0;for(let b=0,y=l.length;b<y;b++){a.isInterleavedBufferAttribute?h=l[b]*a.data.stride+a.offset:h=l[b]*g;for(let m=0;m<g;m++)u[p++]=c[h++]}return new rn(u,g,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Nt,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let g=0,d=c.length;g<d;g++){const u=c[g],h=e(u,n);l.push(h)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],g=[];for(let d=0,u=c.length;d<u;d++){const h=c[d];g.push(h.toJSON(e.data))}g.length>0&&(r[l]=g,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const g=r[c];this.setAttribute(c,g.clone(t))}const s=e.morphAttributes;for(const c in s){const g=[],d=s[c];for(let u=0,h=d.length;u<h;u++)g.push(d[u].clone(t));this.morphAttributes[c]=g}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,g=o.length;c<g;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Nt.prototype.isBufferGeometry=!0;const mL=new bt,Ch=new vc,RS=new bc,Gc=new te,Bc=new te,Sc=new te,MS=new te,WS=new te,_S=new te,ry=new te,sy=new te,oy=new te,ay=new Ke,ly=new Ke,cy=new Ke,VS=new te,gy=new te;class yi extends Ut{constructor(e=new Nt,t=new tl){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),RS.copy(n.boundingSphere),RS.applyMatrix4(s),e.ray.intersectsSphere(RS)===!1)||(mL.copy(s).invert(),Ch.copy(e.ray).applyMatrix4(mL),n.boundingBox!==null&&Ch.intersectsBox(n.boundingBox)===!1))return;let o;if(n.isBufferGeometry){const a=n.index,l=n.attributes.position,c=n.morphAttributes.position,g=n.morphTargetsRelative,d=n.attributes.uv,u=n.attributes.uv2,h=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(r))for(let b=0,y=h.length;b<y;b++){const m=h[b],f=r[m.materialIndex],G=Math.max(m.start,p.start),x=Math.min(a.count,Math.min(m.start+m.count,p.start+p.count));for(let B=G,M=x;B<M;B+=3){const E=a.getX(B),z=a.getX(B+1),J=a.getX(B+2);o=uy(this,f,e,Ch,l,c,g,d,u,E,z,J),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let m=b,f=y;m<f;m+=3){const G=a.getX(m),x=a.getX(m+1),B=a.getX(m+2);o=uy(this,r,e,Ch,l,c,g,d,u,G,x,B),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(r))for(let b=0,y=h.length;b<y;b++){const m=h[b],f=r[m.materialIndex],G=Math.max(m.start,p.start),x=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let B=G,M=x;B<M;B+=3){const E=B,z=B+1,J=B+2;o=uy(this,f,e,Ch,l,c,g,d,u,E,z,J),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(let m=b,f=y;m<f;m+=3){const G=m,x=m+1,B=m+2;o=uy(this,r,e,Ch,l,c,g,d,u,G,x,B),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}yi.prototype.isMesh=!0;function Fne(i,e,t,n,r,s,o,a){let l;if(e.side===di?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side!==Fg,a),l===null)return null;gy.copy(a),gy.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(gy);return c<t.near||c>t.far?null:{distance:c,point:gy.clone(),object:i}}function uy(i,e,t,n,r,s,o,a,l,c,g,d){Gc.fromBufferAttribute(r,c),Bc.fromBufferAttribute(r,g),Sc.fromBufferAttribute(r,d);const u=i.morphTargetInfluences;if(s&&u){ry.set(0,0,0),sy.set(0,0,0),oy.set(0,0,0);for(let p=0,b=s.length;p<b;p++){const y=u[p],m=s[p];y!==0&&(MS.fromBufferAttribute(m,c),WS.fromBufferAttribute(m,g),_S.fromBufferAttribute(m,d),o?(ry.addScaledVector(MS,y),sy.addScaledVector(WS,y),oy.addScaledVector(_S,y)):(ry.addScaledVector(MS.sub(Gc),y),sy.addScaledVector(WS.sub(Bc),y),oy.addScaledVector(_S.sub(Sc),y)))}Gc.add(ry),Bc.add(sy),Sc.add(oy)}i.isSkinnedMesh&&(i.boneTransform(c,Gc),i.boneTransform(g,Bc),i.boneTransform(d,Sc));const h=Fne(i,e,t,n,Gc,Bc,Sc,VS);if(h){a&&(ay.fromBufferAttribute(a,c),ly.fromBufferAttribute(a,g),cy.fromBufferAttribute(a,d),h.uv=fi.getUV(VS,Gc,Bc,Sc,ay,ly,cy,new Ke)),l&&(ay.fromBufferAttribute(l,c),ly.fromBufferAttribute(l,g),cy.fromBufferAttribute(l,d),h.uv2=fi.getUV(VS,Gc,Bc,Sc,ay,ly,cy,new Ke));const p={a:c,b:g,c:d,normal:new te,materialIndex:0};fi.getNormal(Gc,Bc,Sc,p.normal),h.face=p}return h}class nl extends Nt{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],g=[],d=[];let u=0,h=0;p("z","y","x",-1,-1,n,t,e,o,s,0),p("z","y","x",1,-1,n,t,-e,o,s,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,s,4),p("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new At(c,3)),this.setAttribute("normal",new At(g,3)),this.setAttribute("uv",new At(d,2));function p(b,y,m,f,G,x,B,M,E,z,J){const V=x/E,I=B/z,w=x/2,S=B/2,R=M/2,W=E+1,H=z+1;let k=0,_=0;const Z=new te;for(let T=0;T<H;T++){const F=T*I-S;for(let K=0;K<W;K++){const j=K*V-w;Z[b]=j*f,Z[y]=F*G,Z[m]=R,c.push(Z.x,Z.y,Z.z),Z[b]=0,Z[y]=0,Z[m]=M>0?1:-1,g.push(Z.x,Z.y,Z.z),d.push(K/E),d.push(1-T/z),k+=1}}for(let T=0;T<z;T++)for(let F=0;F<E;F++){const K=u+F+W*T,j=u+F+W*(T+1),O=u+(F+1)+W*(T+1),Y=u+(F+1)+W*T;l.push(K,j,Y),l.push(j,O,Y),_+=6}a.addGroup(h,_,J),h+=_,u+=k}}static fromJSON(e){return new nl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ph(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function br(i){const e={};for(let t=0;t<i.length;t++){const n=ph(i[t]);for(const r in n)e[r]=n[r]}return e}const AL={clone:ph,merge:br};var Lne=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Tne=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class js extends Ii{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Lne,this.fragmentShader=Tne,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ph(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}js.prototype.isShaderMaterial=!0;class qg extends Ut{constructor(){super();this.type="Camera",this.matrixWorldInverse=new bt,this.projectionMatrix=new bt,this.projectionMatrixInverse=new bt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}qg.prototype.isCamera=!0;class Ri extends qg{constructor(e=50,t=1,n=.1,r=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=QC*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ug*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return QC*2*Math.atan(Math.tan(Ug*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ug*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ri.prototype.isPerspectiveCamera=!0;const mh=90,Ah=1;class dy extends Ut{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const r=new Ri(mh,Ah,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new te(1,0,0)),this.add(r);const s=new Ri(mh,Ah,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new te(-1,0,0)),this.add(s);const o=new Ri(mh,Ah,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new te(0,1,0)),this.add(o);const a=new Ri(mh,Ah,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new te(0,-1,0)),this.add(a);const l=new Ri(mh,Ah,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new te(0,0,1)),this.add(l);const c=new Ri(mh,Ah,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new te(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[r,s,o,a,l,c]=this.children,g=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,s),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=g,n.texture.needsPMREMUpdate=!0}}class bh extends hi{constructor(e,t,n,r,s,o,a,l,c,g){e=e!==void 0?e:[],t=t!==void 0?t:hc;super(e,t,n,r,s,o,a,l,c,g);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}bh.prototype.isCubeTexture=!0;class hy extends Hr{constructor(e,t={}){super(e,e,t);const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new bh(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:jn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ar,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new nl(5,5,5),s=new js({name:"CubemapFromEquirect",uniforms:ph(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:di,blending:Ua});s.uniforms.tEquirect.value=t;const o=new yi(r,s),a=t.minFilter;return t.minFilter===Xg&&(t.minFilter=jn),new dy(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}hy.prototype.isWebGLCubeRenderTarget=!0;const NS=new te,Xne=new te,zne=new Si;class sa{constructor(e=new te(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=NS.subVectors(n,t).cross(Xne.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(NS),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(n).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||zne.getNormalMatrix(e),r=this.coplanarPoint(NS).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}sa.prototype.isPlane=!0;const yh=new bc,fy=new te;class ip{constructor(e=new sa,t=new sa,n=new sa,r=new sa,s=new sa,o=new sa){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7],u=n[8],h=n[9],p=n[10],b=n[11],y=n[12],m=n[13],f=n[14],G=n[15];return t[0].setComponents(a-r,d-l,b-u,G-y).normalize(),t[1].setComponents(a+r,d+l,b+u,G+y).normalize(),t[2].setComponents(a+s,d+c,b+h,G+m).normalize(),t[3].setComponents(a-s,d-c,b-h,G-m).normalize(),t[4].setComponents(a-o,d-g,b-p,G-f).normalize(),t[5].setComponents(a+o,d+g,b+p,G+f).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),yh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(yh)}intersectsSprite(e){return yh.center.set(0,0,0),yh.radius=.7071067811865476,yh.applyMatrix4(e.matrixWorld),this.intersectsSphere(yh)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(fy.x=r.normal.x>0?e.max.x:e.min.x,fy.y=r.normal.y>0?e.max.y:e.min.y,fy.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(fy)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function bL(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function kne(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,g){const d=c.array,u=c.usage,h=i.createBuffer();i.bindBuffer(g,h),i.bufferData(g,d,u),c.onUploadCallback();let p;if(d instanceof Float32Array)p=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(d instanceof Int16Array)p=5122;else if(d instanceof Uint32Array)p=5125;else if(d instanceof Int32Array)p=5124;else if(d instanceof Int8Array)p=5120;else if(d instanceof Uint8Array)p=5121;else if(d instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:h,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function s(c,g,d){const u=g.array,h=g.updateRange;i.bindBuffer(d,c),h.count===-1?i.bufferSubData(d,0,u):(t?i.bufferSubData(d,h.offset*u.BYTES_PER_ELEMENT,u,h.offset,h.count):i.bufferSubData(d,h.offset*u.BYTES_PER_ELEMENT,u.subarray(h.offset,h.offset+h.count)),h.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const g=n.get(c);g&&(i.deleteBuffer(g.buffer),n.delete(c))}function l(c,g){if(c.isGLBufferAttribute){const u=n.get(c);(!u||u.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=n.get(c);d===void 0?n.set(c,r(c,g)):d.version<c.version&&(s(d.buffer,c,g),d.version=c.version)}return{get:o,remove:a,update:l}}class $g extends Nt{constructor(e=1,t=1,n=1,r=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,g=l+1,d=e/a,u=t/l,h=[],p=[],b=[],y=[];for(let m=0;m<g;m++){const f=m*u-o;for(let G=0;G<c;G++){const x=G*d-s;p.push(x,-f,0),b.push(0,0,1),y.push(G/a),y.push(1-m/l)}}for(let m=0;m<l;m++)for(let f=0;f<a;f++){const G=f+c*m,x=f+c*(m+1),B=f+1+c*(m+1),M=f+1+c*m;h.push(G,x,M),h.push(x,B,M)}this.setIndex(h),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(b,3)),this.setAttribute("uv",new At(y,2))}static fromJSON(e){return new $g(e.width,e.height,e.widthSegments,e.heightSegments)}}var Yne=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Kne=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Pne=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Dne=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Une=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,One=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Jne="vec3 transformed = vec3( position );",Qne=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,jne=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,qne=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,$ne=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,eie=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,tie=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,nie=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,iie=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,rie=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,sie=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,oie=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,aie=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,lie=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,cie=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,gie=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,uie=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,die=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,hie=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,fie="gl_FragColor = linearToOutputTexel( gl_FragColor );",Iie=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Cie=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,pie=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,mie=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Aie=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,bie=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,yie=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,vie=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,xie=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,wie=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Gie=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Bie=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Sie=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Zie=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Rie=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Mie=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Wie=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_ie=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Vie=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Nie=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Eie=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Hie=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Fie=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Lie=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Tie=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Xie=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,zie=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,kie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Yie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Kie=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Pie=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Die=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Uie=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Oie=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Jie=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Qie=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]
		#endif
	}
#endif`,jie=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,qie=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			float texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,$ie=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,ere=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,tre=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,nre=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ire=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,rre=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,sre=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,ore=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,are=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,lre=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,cre=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,gre=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,ure=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,dre=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,hre=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,fre=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ire=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Cre=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,pre=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,mre=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Are=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,bre=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,yre=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,vre=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,xre=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,wre=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Gre=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Bre=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Sre=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Zre=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Rre=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,Mre=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Wre=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,_re=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Vre=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Nre=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Ere=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Hre=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Fre=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Lre=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Tre=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Xre=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,zre=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,kre=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Yre=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Kre=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Pre=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Dre=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Ure=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Ore=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Jre=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Qre=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,jre=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qre=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$re=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ese=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,tse=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nse=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,ise=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,rse=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sse=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ose=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,ase=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lse=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cse=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gse=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,use=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dse=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hse=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,fse=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ise=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Dt={alphamap_fragment:Yne,alphamap_pars_fragment:Kne,alphatest_fragment:Pne,alphatest_pars_fragment:Dne,aomap_fragment:Une,aomap_pars_fragment:One,begin_vertex:Jne,beginnormal_vertex:Qne,bsdfs:jne,bumpmap_pars_fragment:qne,clipping_planes_fragment:$ne,clipping_planes_pars_fragment:eie,clipping_planes_pars_vertex:tie,clipping_planes_vertex:nie,color_fragment:iie,color_pars_fragment:rie,color_pars_vertex:sie,color_vertex:oie,common:aie,cube_uv_reflection_fragment:lie,defaultnormal_vertex:cie,displacementmap_pars_vertex:gie,displacementmap_vertex:uie,emissivemap_fragment:die,emissivemap_pars_fragment:hie,encodings_fragment:fie,encodings_pars_fragment:Iie,envmap_fragment:Cie,envmap_common_pars_fragment:pie,envmap_pars_fragment:mie,envmap_pars_vertex:Aie,envmap_physical_pars_fragment:Mie,envmap_vertex:bie,fog_vertex:yie,fog_pars_vertex:vie,fog_fragment:xie,fog_pars_fragment:wie,gradientmap_pars_fragment:Gie,lightmap_fragment:Bie,lightmap_pars_fragment:Sie,lights_lambert_vertex:Zie,lights_pars_begin:Rie,lights_toon_fragment:Wie,lights_toon_pars_fragment:_ie,lights_phong_fragment:Vie,lights_phong_pars_fragment:Nie,lights_physical_fragment:Eie,lights_physical_pars_fragment:Hie,lights_fragment_begin:Fie,lights_fragment_maps:Lie,lights_fragment_end:Tie,logdepthbuf_fragment:Xie,logdepthbuf_pars_fragment:zie,logdepthbuf_pars_vertex:kie,logdepthbuf_vertex:Yie,map_fragment:Kie,map_pars_fragment:Pie,map_particle_fragment:Die,map_particle_pars_fragment:Uie,metalnessmap_fragment:Oie,metalnessmap_pars_fragment:Jie,morphcolor_vertex:Qie,morphnormal_vertex:jie,morphtarget_pars_vertex:qie,morphtarget_vertex:$ie,normal_fragment_begin:ere,normal_fragment_maps:tre,normal_pars_fragment:nre,normal_pars_vertex:ire,normal_vertex:rre,normalmap_pars_fragment:sre,clearcoat_normal_fragment_begin:ore,clearcoat_normal_fragment_maps:are,clearcoat_pars_fragment:lre,output_fragment:cre,packing:gre,premultiplied_alpha_fragment:ure,project_vertex:dre,dithering_fragment:hre,dithering_pars_fragment:fre,roughnessmap_fragment:Ire,roughnessmap_pars_fragment:Cre,shadowmap_pars_fragment:pre,shadowmap_pars_vertex:mre,shadowmap_vertex:Are,shadowmask_pars_fragment:bre,skinbase_vertex:yre,skinning_pars_vertex:vre,skinning_vertex:xre,skinnormal_vertex:wre,specularmap_fragment:Gre,specularmap_pars_fragment:Bre,tonemapping_fragment:Sre,tonemapping_pars_fragment:Zre,transmission_fragment:Rre,transmission_pars_fragment:Mre,uv_pars_fragment:Wre,uv_pars_vertex:_re,uv_vertex:Vre,uv2_pars_fragment:Nre,uv2_pars_vertex:Ere,uv2_vertex:Hre,worldpos_vertex:Fre,background_vert:Lre,background_frag:Tre,cube_vert:Xre,cube_frag:zre,depth_vert:kre,depth_frag:Yre,distanceRGBA_vert:Kre,distanceRGBA_frag:Pre,equirect_vert:Dre,equirect_frag:Ure,linedashed_vert:Ore,linedashed_frag:Jre,meshbasic_vert:Qre,meshbasic_frag:jre,meshlambert_vert:qre,meshlambert_frag:$re,meshmatcap_vert:ese,meshmatcap_frag:tse,meshnormal_vert:nse,meshnormal_frag:ise,meshphong_vert:rse,meshphong_frag:sse,meshphysical_vert:ose,meshphysical_frag:ase,meshtoon_vert:lse,meshtoon_frag:cse,points_vert:gse,points_frag:use,shadow_vert:dse,shadow_frag:hse,sprite_vert:fse,sprite_frag:Ise},rt={common:{diffuse:{value:new lt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Si},uv2Transform:{value:new Si},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new lt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new lt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}},sprite:{diffuse:{value:new lt(16777215)},opacity:{value:1},center:{value:new Ke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}}},xo={basic:{uniforms:br([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.fog]),vertexShader:Dt.meshbasic_vert,fragmentShader:Dt.meshbasic_frag},lambert:{uniforms:br([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.fog,rt.lights,{emissive:{value:new lt(0)}}]),vertexShader:Dt.meshlambert_vert,fragmentShader:Dt.meshlambert_frag},phong:{uniforms:br([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.fog,rt.lights,{emissive:{value:new lt(0)},specular:{value:new lt(1118481)},shininess:{value:30}}]),vertexShader:Dt.meshphong_vert,fragmentShader:Dt.meshphong_frag},standard:{uniforms:br([rt.common,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.roughnessmap,rt.metalnessmap,rt.fog,rt.lights,{emissive:{value:new lt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag},toon:{uniforms:br([rt.common,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.gradientmap,rt.fog,rt.lights,{emissive:{value:new lt(0)}}]),vertexShader:Dt.meshtoon_vert,fragmentShader:Dt.meshtoon_frag},matcap:{uniforms:br([rt.common,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.fog,{matcap:{value:null}}]),vertexShader:Dt.meshmatcap_vert,fragmentShader:Dt.meshmatcap_frag},points:{uniforms:br([rt.points,rt.fog]),vertexShader:Dt.points_vert,fragmentShader:Dt.points_frag},dashed:{uniforms:br([rt.common,rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dt.linedashed_vert,fragmentShader:Dt.linedashed_frag},depth:{uniforms:br([rt.common,rt.displacementmap]),vertexShader:Dt.depth_vert,fragmentShader:Dt.depth_frag},normal:{uniforms:br([rt.common,rt.bumpmap,rt.normalmap,rt.displacementmap,{opacity:{value:1}}]),vertexShader:Dt.meshnormal_vert,fragmentShader:Dt.meshnormal_frag},sprite:{uniforms:br([rt.sprite,rt.fog]),vertexShader:Dt.sprite_vert,fragmentShader:Dt.sprite_frag},background:{uniforms:{uvTransform:{value:new Si},t2D:{value:null}},vertexShader:Dt.background_vert,fragmentShader:Dt.background_frag},cube:{uniforms:br([rt.envmap,{opacity:{value:1}}]),vertexShader:Dt.cube_vert,fragmentShader:Dt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dt.equirect_vert,fragmentShader:Dt.equirect_frag},distanceRGBA:{uniforms:br([rt.common,rt.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dt.distanceRGBA_vert,fragmentShader:Dt.distanceRGBA_frag},shadow:{uniforms:br([rt.lights,rt.fog,{color:{value:new lt(0)},opacity:{value:1}}]),vertexShader:Dt.shadow_vert,fragmentShader:Dt.shadow_frag}};xo.physical={uniforms:br([xo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ke(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new lt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ke},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new lt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new lt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag};function Cse(i,e,t,n,r,s){const o=new lt(0);let a=r===!0?0:1,l,c,g=null,d=0,u=null;function h(b,y){let m=!1,f=y.isScene===!0?y.background:null;f&&f.isTexture&&(f=e.get(f));const G=i.xr,x=G.getSession&&G.getSession();x&&x.environmentBlendMode==="additive"&&(f=null),f===null?p(o,a):f&&f.isColor&&(p(f,1),m=!0),(i.autoClear||m)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),f&&(f.isCubeTexture||f.mapping===$d)?(c===void 0&&(c=new yi(new nl(1,1,1),new js({name:"BackgroundCubeMaterial",uniforms:ph(xo.cube.uniforms),vertexShader:xo.cube.vertexShader,fragmentShader:xo.cube.fragmentShader,side:di,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(B,M,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=f,c.material.uniforms.flipEnvMap.value=f.isCubeTexture&&f.isRenderTargetTexture===!1?-1:1,(g!==f||d!==f.version||u!==i.toneMapping)&&(c.material.needsUpdate=!0,g=f,d=f.version,u=i.toneMapping),b.unshift(c,c.geometry,c.material,0,0,null)):f&&f.isTexture&&(l===void 0&&(l=new yi(new $g(2,2),new js({name:"BackgroundMaterial",uniforms:ph(xo.background.uniforms),vertexShader:xo.background.vertexShader,fragmentShader:xo.background.fragmentShader,side:Hg,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=f,f.matrixAutoUpdate===!0&&f.updateMatrix(),l.material.uniforms.uvTransform.value.copy(f.matrix),(g!==f||d!==f.version||u!==i.toneMapping)&&(l.material.needsUpdate=!0,g=f,d=f.version,u=i.toneMapping),b.unshift(l,l.geometry,l.material,0,0,null))}function p(b,y){t.buffers.color.setClear(b.r,b.g,b.b,y,s)}return{getClearColor:function(){return o},setClearColor:function(b,y=1){o.set(b),a=y,p(o,a)},getClearAlpha:function(){return a},setClearAlpha:function(b){a=b,p(o,a)},render:h}}function pse(i,e,t,n){const r=i.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=b(null);let c=l;function g(S,R,W,H,k){let _=!1;if(o){const Z=p(H,W,R);c!==Z&&(c=Z,u(c.object)),_=y(H,k),_&&m(H,k)}else{const Z=R.wireframe===!0;(c.geometry!==H.id||c.program!==W.id||c.wireframe!==Z)&&(c.geometry=H.id,c.program=W.id,c.wireframe=Z,_=!0)}S.isInstancedMesh===!0&&(_=!0),k!==null&&t.update(k,34963),_&&(E(S,R,W,H),k!==null&&i.bindBuffer(34963,t.get(k).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function u(S){return n.isWebGL2?i.bindVertexArray(S):s.bindVertexArrayOES(S)}function h(S){return n.isWebGL2?i.deleteVertexArray(S):s.deleteVertexArrayOES(S)}function p(S,R,W){const H=W.wireframe===!0;let k=a[S.id];k===void 0&&(k={},a[S.id]=k);let _=k[R.id];_===void 0&&(_={},k[R.id]=_);let Z=_[H];return Z===void 0&&(Z=b(d()),_[H]=Z),Z}function b(S){const R=[],W=[],H=[];for(let k=0;k<r;k++)R[k]=0,W[k]=0,H[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:W,attributeDivisors:H,object:S,attributes:{},index:null}}function y(S,R){const W=c.attributes,H=S.attributes;let k=0;for(const _ in H){const Z=W[_],T=H[_];if(Z===void 0||Z.attribute!==T||Z.data!==T.data)return!0;k++}return c.attributesNum!==k||c.index!==R}function m(S,R){const W={},H=S.attributes;let k=0;for(const _ in H){const Z=H[_],T={};T.attribute=Z,Z.data&&(T.data=Z.data),W[_]=T,k++}c.attributes=W,c.attributesNum=k,c.index=R}function f(){const S=c.newAttributes;for(let R=0,W=S.length;R<W;R++)S[R]=0}function G(S){x(S,0)}function x(S,R){const W=c.newAttributes,H=c.enabledAttributes,k=c.attributeDivisors;W[S]=1,H[S]===0&&(i.enableVertexAttribArray(S),H[S]=1),k[S]!==R&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](S,R),k[S]=R)}function B(){const S=c.newAttributes,R=c.enabledAttributes;for(let W=0,H=R.length;W<H;W++)R[W]!==S[W]&&(i.disableVertexAttribArray(W),R[W]=0)}function M(S,R,W,H,k,_){n.isWebGL2===!0&&(W===5124||W===5125)?i.vertexAttribIPointer(S,R,W,k,_):i.vertexAttribPointer(S,R,W,H,k,_)}function E(S,R,W,H){if(n.isWebGL2===!1&&(S.isInstancedMesh||H.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;f();const k=H.attributes,_=W.getAttributes(),Z=R.defaultAttributeValues;for(const T in _){const F=_[T];if(F.location>=0){let K=k[T];if(K===void 0&&(T==="instanceMatrix"&&S.instanceMatrix&&(K=S.instanceMatrix),T==="instanceColor"&&S.instanceColor&&(K=S.instanceColor)),K!==void 0){const j=K.normalized,O=K.itemSize,Y=t.get(K);if(Y===void 0)continue;const ee=Y.buffer,ye=Y.type,Ce=Y.bytesPerElement;if(K.isInterleavedBufferAttribute){const he=K.data,Ne=he.stride,He=K.offset;if(he.isInstancedInterleavedBuffer){for(let ne=0;ne<F.locationSize;ne++)x(F.location+ne,he.meshPerAttribute);S.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let ne=0;ne<F.locationSize;ne++)G(F.location+ne);i.bindBuffer(34962,ee);for(let ne=0;ne<F.locationSize;ne++)M(F.location+ne,O/F.locationSize,ye,j,Ne*Ce,(He+O/F.locationSize*ne)*Ce)}else{if(K.isInstancedBufferAttribute){for(let he=0;he<F.locationSize;he++)x(F.location+he,K.meshPerAttribute);S.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let he=0;he<F.locationSize;he++)G(F.location+he);i.bindBuffer(34962,ee);for(let he=0;he<F.locationSize;he++)M(F.location+he,O/F.locationSize,ye,j,O*Ce,O/F.locationSize*he*Ce)}}else if(Z!==void 0){const j=Z[T];if(j!==void 0)switch(j.length){case 2:i.vertexAttrib2fv(F.location,j);break;case 3:i.vertexAttrib3fv(F.location,j);break;case 4:i.vertexAttrib4fv(F.location,j);break;default:i.vertexAttrib1fv(F.location,j)}}}}B()}function z(){I();for(const S in a){const R=a[S];for(const W in R){const H=R[W];for(const k in H)h(H[k].object),delete H[k];delete R[W]}delete a[S]}}function J(S){if(a[S.id]===void 0)return;const R=a[S.id];for(const W in R){const H=R[W];for(const k in H)h(H[k].object),delete H[k];delete R[W]}delete a[S.id]}function V(S){for(const R in a){const W=a[R];if(W[S.id]===void 0)continue;const H=W[S.id];for(const k in H)h(H[k].object),delete H[k];delete W[S.id]}}function I(){w(),c!==l&&(c=l,u(c.object))}function w(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:g,reset:I,resetDefaultState:w,dispose:z,releaseStatesOfGeometry:J,releaseStatesOfProgram:V,initAttributes:f,enableAttribute:G,disableUnusedAttributes:B}}function mse(i,e,t,n){const r=n.isWebGL2;let s;function o(c){s=c}function a(c,g){i.drawArrays(s,c,g),t.update(g,s,1)}function l(c,g,d){if(d===0)return;let u,h;if(r)u=i,h="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[h](s,c,g,d),t.update(g,s,d)}this.setMode=o,this.render=a,this.renderInstances=l}function Ase(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const E=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(E){if(E==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";E="mediump"}return E==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,d=i.getParameter(34930),u=i.getParameter(35660),h=i.getParameter(3379),p=i.getParameter(34076),b=i.getParameter(34921),y=i.getParameter(36347),m=i.getParameter(36348),f=i.getParameter(36349),G=u>0,x=o||e.has("OES_texture_float"),B=G&&x,M=o?i.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:g,maxTextures:d,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:b,maxVertexUniforms:y,maxVaryings:m,maxFragmentUniforms:f,vertexTextures:G,floatFragmentTextures:x,floatVertexTextures:B,maxSamples:M}}function bse(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new sa,a=new Si,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,u,h){const p=d.length!==0||u||n!==0||r;return r=u,t=g(d,h,0),n=d.length,p},this.beginShadows=function(){s=!0,g(null)},this.endShadows=function(){s=!1,c()},this.setState=function(d,u,h){const p=d.clippingPlanes,b=d.clipIntersection,y=d.clipShadows,m=i.get(d);if(!r||p===null||p.length===0||s&&!y)s?g(null):c();else{const f=s?0:n,G=f*4;let x=m.clippingState||null;l.value=x,x=g(p,u,G,h);for(let B=0;B!==G;++B)x[B]=t[B];m.clippingState=x,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=f}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function g(d,u,h,p){const b=d!==null?d.length:0;let y=null;if(b!==0){if(y=l.value,p!==!0||y===null){const m=h+b*4,f=u.matrixWorldInverse;a.getNormalMatrix(f),(y===null||y.length<m)&&(y=new Float32Array(m));for(let G=0,x=h;G!==b;++G,x+=4)o.copy(d[G]).applyMatrix4(f,a),o.normal.toArray(y,x),y[x+3]=o.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,y}}function yse(i){let e=new WeakMap;function t(o,a){return a===zC?o.mapping=hc:a===kC&&(o.mapping=fc),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===zC||a===kC)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new hy(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class vh extends qg{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=g*this.view.offsetY,l=a-g*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}vh.prototype.isOrthographicCamera=!0;const xh=4,yL=[.125,.215,.35,.446,.526,.582],eu=20,ES=new vh,vL=new lt;let HS=null;const tu=(1+Math.sqrt(5))/2,wh=1/tu,xL=[new te(1,1,1),new te(-1,1,1),new te(1,1,-1),new te(-1,1,-1),new te(0,tu,wh),new te(0,tu,-wh),new te(wh,0,tu),new te(-wh,0,tu),new te(tu,wh,0),new te(-tu,wh,0)];class FS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){HS=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=BL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=GL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(HS),e.scissorTest=!1,Iy(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===hc||e.mapping===fc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),HS=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,16*7),t=4*this._cubeSize-32,n={magFilter:jn,minFilter:jn,generateMipmaps:!1,type:zg,format:Ar,encoding:Ao,depthBuffer:!1},r=wL(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=wL(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=vse(s)),this._blurMaterial=xse(s,e,t)}return r}_compileMaterial(e){const t=new yi(this._lodPlanes[0],e);this._renderer.compile(t,ES)}_sceneToCubeUV(e,t,n,r){const s=90,o=1,a=new Ri(s,o,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],g=this._renderer,d=g.autoClear,u=g.toneMapping;g.getClearColor(vL),g.toneMapping=ra,g.autoClear=!1;const h=new tl({name:"PMREM.Background",side:di,depthWrite:!1,depthTest:!1}),p=new yi(new nl,h);let b=!1;const y=e.background;y?y.isColor&&(h.color.copy(y),e.background=null,b=!0):(h.color.copy(vL),b=!0);for(let m=0;m<6;m++){const f=m%3;f===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):f===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const G=this._cubeSize;Iy(r,f*G,m>2?G:0,G,G),g.setRenderTarget(r),b&&g.render(p,a),g.render(e,a)}p.geometry.dispose(),p.material.dispose(),g.toneMapping=u,g.autoClear=d,e.background=y}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===hc||e.mapping===fc;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=BL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=GL());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new yi(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Iy(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,ES)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=xL[(r-1)%xL.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,d=new yi(this._lodPlanes[r],c),u=c.uniforms,h=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*h):2*Math.PI/(2*eu-1),b=s/p,y=isFinite(s)?1+Math.floor(g*b):eu;y>eu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${eu}`);const m=[];let f=0;for(let E=0;E<eu;++E){const z=E/b,J=Math.exp(-z*z/2);m.push(J),E===0?f+=J:E<y&&(f+=2*J)}for(let E=0;E<m.length;E++)m[E]=m[E]/f;u.envMap.value=e.texture,u.samples.value=y,u.weights.value=m,u.latitudinal.value=o==="latitudinal",a&&(u.poleAxis.value=a);const{_lodMax:G}=this;u.dTheta.value=p,u.mipInt.value=G-n;const x=this._sizeLods[r],B=3*x*(r>G-xh?r-G+xh:0),M=4*(this._cubeSize-x);Iy(t,B,M,3*x,2*x),l.setRenderTarget(t),l.render(d,ES)}}function vse(i){const e=[],t=[],n=[];let r=i;const s=i-xh+1+yL.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-xh?l=yL[o-i+xh-1]:o===0&&(l=0),n.push(l);const c=1/(a-1),g=-c/2,d=1+c/2,u=[g,g,d,g,d,d,g,g,d,d,g,d],h=6,p=6,b=3,y=2,m=1,f=new Float32Array(b*p*h),G=new Float32Array(y*p*h),x=new Float32Array(m*p*h);for(let M=0;M<h;M++){const E=M%3*2/3-1,z=M>2?0:-1,J=[E,z,0,E+2/3,z,0,E+2/3,z+1,0,E,z,0,E+2/3,z+1,0,E,z+1,0];f.set(J,b*p*M),G.set(u,y*p*M);const V=[M,M,M,M,M,M];x.set(V,m*p*M)}const B=new Nt;B.setAttribute("position",new rn(f,b)),B.setAttribute("uv",new rn(G,y)),B.setAttribute("faceIndex",new rn(x,m)),e.push(B),r>xh&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function wL(i,e,t){const n=new Hr(i,e,t);return n.texture.mapping=$d,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Iy(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function xse(i,e,t){const n=new Float32Array(eu),r=new te(0,1,0);return new js({name:"SphericalGaussianBlur",defines:{n:eu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:LS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ua,depthTest:!1,depthWrite:!1})}function GL(){return new js({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:LS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ua,depthTest:!1,depthWrite:!1})}function BL(){return new js({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:LS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ua,depthTest:!1,depthWrite:!1})}function LS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function wse(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===zC||l===kC,g=l===hc||l===fc;if(c||g)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new FS(i)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||g&&d&&r(d)){t===null&&(t=new FS(i));const u=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,u),a.addEventListener("dispose",s),u.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let g=0;g<c;g++)a[g]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function Gse(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Bse(i,e,t,n){const r={},s=new WeakMap;function o(d){const u=d.target;u.index!==null&&e.remove(u.index);for(const p in u.attributes)e.remove(u.attributes[p]);u.removeEventListener("dispose",o),delete r[u.id];const h=s.get(u);h&&(e.remove(h),s.delete(u)),n.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function a(d,u){return r[u.id]===!0||(u.addEventListener("dispose",o),r[u.id]=!0,t.memory.geometries++),u}function l(d){const u=d.attributes;for(const p in u)e.update(u[p],34962);const h=d.morphAttributes;for(const p in h){const b=h[p];for(let y=0,m=b.length;y<m;y++)e.update(b[y],34962)}}function c(d){const u=[],h=d.index,p=d.attributes.position;let b=0;if(h!==null){const f=h.array;b=h.version;for(let G=0,x=f.length;G<x;G+=3){const B=f[G+0],M=f[G+1],E=f[G+2];u.push(B,M,M,E,E,B)}}else{const f=p.array;b=p.version;for(let G=0,x=f.length/3-1;G<x;G+=3){const B=G+0,M=G+1,E=G+2;u.push(B,M,M,E,E,B)}}const y=new(QF(u)?iy:ny)(u,1);y.version=b;const m=s.get(d);m&&e.remove(m),s.set(d,y)}function g(d){const u=s.get(d);if(u){const h=d.index;h!==null&&u.version<h.version&&c(d)}else c(d);return s.get(d)}return{get:a,update:l,getWireframeAttribute:g}}function Sse(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}let a,l;function c(u){a=u.type,l=u.bytesPerElement}function g(u,h){i.drawElements(s,h,a,u*l),t.update(h,s,1)}function d(u,h,p){if(p===0)return;let b,y;if(r)b=i,y="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[y](s,h,a,u*l,p),t.update(h,s,p)}this.setMode=o,this.setIndex=c,this.render=g,this.renderInstances=d}function Zse(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function Rse(i,e){return i[0]-e[0]}function Mse(i,e){return Math.abs(e[1])-Math.abs(i[1])}function TS(i,e){let t=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),i.divideScalar(t)}function Wse(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new mn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,g,d,u){const h=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=g.morphAttributes.position||g.morphAttributes.normal||g.morphAttributes.color,b=p!==void 0?p.length:0;let y=s.get(g);if(y===void 0||y.count!==b){let W=function(){S.dispose(),s.delete(g),g.removeEventListener("dispose",W)};y!==void 0&&y.texture.dispose();const G=g.morphAttributes.position!==void 0,x=g.morphAttributes.normal!==void 0,B=g.morphAttributes.color!==void 0,M=g.morphAttributes.position||[],E=g.morphAttributes.normal||[],z=g.morphAttributes.color||[];let J=0;G===!0&&(J=1),x===!0&&(J=2),B===!0&&(J=3);let V=g.attributes.position.count*J,I=1;V>e.maxTextureSize&&(I=Math.ceil(V/e.maxTextureSize),V=e.maxTextureSize);const w=new Float32Array(V*I*4*b),S=new ah(w,V,I,b);S.format=Ar,S.type=Oa,S.needsUpdate=!0;const R=J*4;for(let H=0;H<b;H++){const k=M[H],_=E[H],Z=z[H],T=V*I*4*H;for(let F=0;F<k.count;F++){const K=F*R;G===!0&&(o.fromBufferAttribute(k,F),k.normalized===!0&&TS(o,k),w[T+K+0]=o.x,w[T+K+1]=o.y,w[T+K+2]=o.z,w[T+K+3]=0),x===!0&&(o.fromBufferAttribute(_,F),_.normalized===!0&&TS(o,_),w[T+K+4]=o.x,w[T+K+5]=o.y,w[T+K+6]=o.z,w[T+K+7]=0),B===!0&&(o.fromBufferAttribute(Z,F),Z.normalized===!0&&TS(o,_),w[T+K+8]=o.x,w[T+K+9]=o.y,w[T+K+10]=o.z,w[T+K+11]=Z.itemSize===4?o.w:1)}}y={count:b,texture:S,size:new Ke(V,I)},s.set(g,y),g.addEventListener("dispose",W)}let m=0;for(let G=0;G<h.length;G++)m+=h[G];const f=g.morphTargetsRelative?1:1-m;u.getUniforms().setValue(i,"morphTargetBaseInfluence",f),u.getUniforms().setValue(i,"morphTargetInfluences",h),u.getUniforms().setValue(i,"morphTargetsTexture",y.texture,t),u.getUniforms().setValue(i,"morphTargetsTextureSize",y.size)}else{const p=h===void 0?0:h.length;let b=n[g.id];if(b===void 0||b.length!==p){b=[];for(let x=0;x<p;x++)b[x]=[x,0];n[g.id]=b}for(let x=0;x<p;x++){const B=b[x];B[0]=x,B[1]=h[x]}b.sort(Mse);for(let x=0;x<8;x++)x<p&&b[x][1]?(a[x][0]=b[x][0],a[x][1]=b[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(Rse);const y=g.morphAttributes.position,m=g.morphAttributes.normal;let f=0;for(let x=0;x<8;x++){const B=a[x],M=B[0],E=B[1];M!==Number.MAX_SAFE_INTEGER&&E?(y&&g.getAttribute("morphTarget"+x)!==y[M]&&g.setAttribute("morphTarget"+x,y[M]),m&&g.getAttribute("morphNormal"+x)!==m[M]&&g.setAttribute("morphNormal"+x,m[M]),r[x]=E,f+=E):(y&&g.hasAttribute("morphTarget"+x)===!0&&g.deleteAttribute("morphTarget"+x),m&&g.hasAttribute("morphNormal"+x)===!0&&g.deleteAttribute("morphNormal"+x),r[x]=0)}const G=g.morphTargetsRelative?1:1-f;u.getUniforms().setValue(i,"morphTargetBaseInfluence",G),u.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function _se(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,g=l.geometry,d=e.get(l,g);return r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const SL=new hi,ZL=new ah,RL=new $C,ML=new bh,WL=[],_L=[],VL=new Float32Array(16),NL=new Float32Array(9),EL=new Float32Array(4);function Gh(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=WL[r];if(s===void 0&&(s=new Float32Array(r),WL[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function Fr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function yr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Cy(i,e){let t=_L[e];t===void 0&&(t=new Int32Array(e),_L[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function Vse(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Nse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Fr(t,e))return;i.uniform2fv(this.addr,e),yr(t,e)}}function Ese(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Fr(t,e))return;i.uniform3fv(this.addr,e),yr(t,e)}}function Hse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Fr(t,e))return;i.uniform4fv(this.addr,e),yr(t,e)}}function Fse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Fr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),yr(t,e)}else{if(Fr(t,n))return;EL.set(n),i.uniformMatrix2fv(this.addr,!1,EL),yr(t,n)}}function Lse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Fr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),yr(t,e)}else{if(Fr(t,n))return;NL.set(n),i.uniformMatrix3fv(this.addr,!1,NL),yr(t,n)}}function Tse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Fr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),yr(t,e)}else{if(Fr(t,n))return;VL.set(n),i.uniformMatrix4fv(this.addr,!1,VL),yr(t,n)}}function Xse(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function zse(i,e){const t=this.cache;Fr(t,e)||(i.uniform2iv(this.addr,e),yr(t,e))}function kse(i,e){const t=this.cache;Fr(t,e)||(i.uniform3iv(this.addr,e),yr(t,e))}function Yse(i,e){const t=this.cache;Fr(t,e)||(i.uniform4iv(this.addr,e),yr(t,e))}function Kse(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function Pse(i,e){const t=this.cache;Fr(t,e)||(i.uniform2uiv(this.addr,e),yr(t,e))}function Dse(i,e){const t=this.cache;Fr(t,e)||(i.uniform3uiv(this.addr,e),yr(t,e))}function Use(i,e){const t=this.cache;Fr(t,e)||(i.uniform4uiv(this.addr,e),yr(t,e))}function Ose(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2D(e||SL,r)}function Jse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||RL,r)}function Qse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||ML,r)}function jse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||ZL,r)}function qse(i){switch(i){case 5126:return Vse;case 35664:return Nse;case 35665:return Ese;case 35666:return Hse;case 35674:return Fse;case 35675:return Lse;case 35676:return Tse;case 5124:case 35670:return Xse;case 35667:case 35671:return zse;case 35668:case 35672:return kse;case 35669:case 35673:return Yse;case 5125:return Kse;case 36294:return Pse;case 36295:return Dse;case 36296:return Use;case 35678:case 36198:case 36298:case 36306:case 35682:return Ose;case 35679:case 36299:case 36307:return Jse;case 35680:case 36300:case 36308:case 36293:return Qse;case 36289:case 36303:case 36311:case 36292:return jse}}function $se(i,e){i.uniform1fv(this.addr,e)}function eoe(i,e){const t=Gh(e,this.size,2);i.uniform2fv(this.addr,t)}function toe(i,e){const t=Gh(e,this.size,3);i.uniform3fv(this.addr,t)}function noe(i,e){const t=Gh(e,this.size,4);i.uniform4fv(this.addr,t)}function ioe(i,e){const t=Gh(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function roe(i,e){const t=Gh(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function soe(i,e){const t=Gh(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function ooe(i,e){i.uniform1iv(this.addr,e)}function aoe(i,e){i.uniform2iv(this.addr,e)}function loe(i,e){i.uniform3iv(this.addr,e)}function coe(i,e){i.uniform4iv(this.addr,e)}function goe(i,e){i.uniform1uiv(this.addr,e)}function uoe(i,e){i.uniform2uiv(this.addr,e)}function doe(i,e){i.uniform3uiv(this.addr,e)}function hoe(i,e){i.uniform4uiv(this.addr,e)}function foe(i,e,t){const n=e.length,r=Cy(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTexture2D(e[s]||SL,r[s])}function Ioe(i,e,t){const n=e.length,r=Cy(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTexture3D(e[s]||RL,r[s])}function Coe(i,e,t){const n=e.length,r=Cy(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTextureCube(e[s]||ML,r[s])}function poe(i,e,t){const n=e.length,r=Cy(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTexture2DArray(e[s]||ZL,r[s])}function moe(i){switch(i){case 5126:return $se;case 35664:return eoe;case 35665:return toe;case 35666:return noe;case 35674:return ioe;case 35675:return roe;case 35676:return soe;case 5124:case 35670:return ooe;case 35667:case 35671:return aoe;case 35668:case 35672:return loe;case 35669:case 35673:return coe;case 5125:return goe;case 36294:return uoe;case 36295:return doe;case 36296:return hoe;case 35678:case 36198:case 36298:case 36306:case 35682:return foe;case 35679:case 36299:case 36307:return Ioe;case 35680:case 36300:case 36308:case 36293:return Coe;case 36289:case 36303:case 36311:case 36292:return poe}}function Aoe(i,e,t){this.id=i,this.addr=t,this.cache=[],this.setValue=qse(e.type)}function HL(i,e,t){this.id=i,this.addr=t,this.cache=[],this.size=e.size,this.setValue=moe(e.type)}HL.prototype.updateCache=function(i){const e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),yr(e,i)};function FL(i){this.id=i,this.seq=[],this.map={}}FL.prototype.setValue=function(i,e,t){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const o=n[r];o.setValue(i,e[o.id],t)}};const XS=/(\w+)(\])?(\[|\.)?/g;function LL(i,e){i.seq.push(e),i.map[e.id]=e}function boe(i,e,t){const n=i.name,r=n.length;for(XS.lastIndex=0;;){const s=XS.exec(n),o=XS.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){LL(t,c===void 0?new Aoe(a,i,e):new HL(a,i,e));break}else{let d=t.map[a];d===void 0&&(d=new FL(a),LL(t,d)),t=d}}}function Zc(i,e){this.seq=[],this.map={};const t=i.getProgramParameter(e,35718);for(let n=0;n<t;++n){const r=i.getActiveUniform(e,n),s=i.getUniformLocation(e,r.name);boe(r,s,this)}}Zc.prototype.setValue=function(i,e,t,n){const r=this.map[e];r!==void 0&&r.setValue(i,t,n)};Zc.prototype.setOptional=function(i,e,t){const n=e[t];n!==void 0&&this.setValue(i,t,n)};Zc.upload=function(i,e,t,n){for(let r=0,s=e.length;r!==s;++r){const o=e[r],a=t[o.id];a.needsUpdate!==!1&&o.setValue(i,a.value,n)}};Zc.seqWithValue=function(i,e){const t=[];for(let n=0,r=i.length;n!==r;++n){const s=i[n];s.id in e&&t.push(s)}return t};function TL(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let yoe=0;function voe(i){const e=i.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function xoe(i){switch(i){case Ao:return["Linear","( value )"];case Mn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function XL(i,e,t){const n=i.getShaderParameter(e,35713),r=i.getShaderInfoLog(e).trim();return n&&r===""?"":t.toUpperCase()+`

`+r+`

`+voe(i.getShaderSource(e))}function woe(i,e){const t=xoe(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Goe(i,e){let t;switch(e){case yF:t="Linear";break;case vF:t="Reinhard";break;case xF:t="OptimizedCineon";break;case zB:t="ACESFilmic";break;case wF:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Boe(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rp).join(`
`)}function Soe(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Zoe(i,e){const t={},n=i.getProgramParameter(e,35721);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===35674&&(a=2),s.type===35675&&(a=3),s.type===35676&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function rp(i){return i!==""}function zL(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kL(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Roe=/^[ \t]*#include +<([\w\d./]+)>/gm;function zS(i){return i.replace(Roe,Moe)}function Moe(i,e){const t=Dt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return zS(t)}const Woe=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,_oe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function YL(i){return i.replace(_oe,KL).replace(Woe,Voe)}function Voe(i,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),KL(i,e,t,n)}function KL(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function PL(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Noe(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===WB?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===_B?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===qd&&(e="SHADOWMAP_TYPE_VSM"),e}function Eoe(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case hc:case fc:e="ENVMAP_TYPE_CUBE";break;case $d:case YC:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Hoe(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case fc:case YC:e="ENVMAP_MODE_REFRACTION";break}return e}function Foe(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case XC:e="ENVMAP_BLENDING_MULTIPLY";break;case AF:e="ENVMAP_BLENDING_MIX";break;case bF:e="ENVMAP_BLENDING_ADD";break}return e}function Loe(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e/32+1)+3,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function Toe(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=Noe(t),c=Eoe(t),g=Hoe(t),d=Foe(t),u=Loe(t),h=t.isWebGL2?"":Boe(t),p=Soe(s),b=r.createProgram();let y,m,f=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=[p].filter(rp).join(`
`),y.length>0&&(y+=`
`),m=[h,p].filter(rp).join(`
`),m.length>0&&(m+=`
`)):(y=[PL(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rp).join(`
`),m=[h,PL(t),"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+g:"",t.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ra?"#define TONE_MAPPING":"",t.toneMapping!==ra?Dt.tonemapping_pars_fragment:"",t.toneMapping!==ra?Goe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Dt.encodings_pars_fragment,woe("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rp).join(`
`)),o=zS(o),o=zL(o,t),o=kL(o,t),a=zS(a),a=zL(a,t),a=kL(a,t),o=YL(o),a=YL(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(f=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,m=["#define varying in",t.glslVersion===uS?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===uS?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const G=f+y+o,x=f+m+a,B=TL(r,35633,G),M=TL(r,35632,x);if(r.attachShader(b,B),r.attachShader(b,M),t.index0AttributeName!==void 0?r.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(b,0,"position"),r.linkProgram(b),i.debug.checkShaderErrors){const J=r.getProgramInfoLog(b).trim(),V=r.getShaderInfoLog(B).trim(),I=r.getShaderInfoLog(M).trim();let w=!0,S=!0;if(r.getProgramParameter(b,35714)===!1){w=!1;const R=XL(r,B,"vertex"),W=XL(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(b,35715)+`

Program Info Log: `+J+`
`+R+`
`+W)}else J!==""?console.warn("THREE.WebGLProgram: Program Info Log:",J):(V===""||I==="")&&(S=!1);S&&(this.diagnostics={runnable:w,programLog:J,vertexShader:{log:V,prefix:y},fragmentShader:{log:I,prefix:m}})}r.deleteShader(B),r.deleteShader(M);let E;this.getUniforms=function(){return E===void 0&&(E=new Zc(r,b)),E};let z;return this.getAttributes=function(){return z===void 0&&(z=Zoe(r,b)),z},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(b),this.program=void 0},this.name=t.shaderName,this.id=yoe++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=B,this.fragmentShader=M,this}let Xoe=0;class zoe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(t.has(e)===!1){const n=new koe;t.set(e,n)}return t.get(e)}}class koe{constructor(){this.id=Xoe++,this.usedTimes=0}}function Yoe(i,e,t,n,r,s,o){const a=new jg,l=new zoe,c=[],g=r.isWebGL2,d=r.logarithmicDepthBuffer,u=r.floatVertexTextures,h=r.maxVertexUniforms,p=r.vertexTextures;let b=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(I){const S=I.skeleton.bones;if(u)return 1024;{const W=Math.floor((h-20)/4),H=Math.min(W,S.length);return H<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+H+"."),0):H}}function f(I,w,S,R,W){const H=R.fog,k=W.geometry,_=I.isMeshStandardMaterial?R.environment:null,Z=(I.isMeshStandardMaterial?t:e).get(I.envMap||_),T=!!Z&&(Z.mapping===$d||Z.mapping===YC)?Z.image.height:null,F=y[I.type],K=W.isSkinnedMesh?m(W):0;I.precision!==null&&(b=r.getMaxPrecision(I.precision),b!==I.precision&&console.warn("THREE.WebGLProgram.getParameters:",I.precision,"not supported, using",b,"instead."));const j=k.morphAttributes.position||k.morphAttributes.normal||k.morphAttributes.color,O=j!==void 0?j.length:0;let Y=0;k.morphAttributes.position!==void 0&&(Y=1),k.morphAttributes.normal!==void 0&&(Y=2),k.morphAttributes.color!==void 0&&(Y=3);let ee,ye,Ce,he;if(F){const Ie=xo[F];ee=Ie.vertexShader,ye=Ie.fragmentShader}else ee=I.vertexShader,ye=I.fragmentShader,l.update(I),Ce=l.getVertexShaderID(I),he=l.getFragmentShaderID(I);const Ne=i.getRenderTarget(),He=I.alphaTest>0,ne=I.clearcoat>0;return{isWebGL2:g,shaderID:F,shaderName:I.type,vertexShader:ee,fragmentShader:ye,defines:I.defines,customVertexShaderID:Ce,customFragmentShaderID:he,isRawShaderMaterial:I.isRawShaderMaterial===!0,glslVersion:I.glslVersion,precision:b,instancing:W.isInstancedMesh===!0,instancingColor:W.isInstancedMesh===!0&&W.instanceColor!==null,supportsVertexTextures:p,outputEncoding:Ne===null?i.outputEncoding:Ne.isXRRenderTarget===!0?Ne.texture.encoding:Ao,map:!!I.map,matcap:!!I.matcap,envMap:!!Z,envMapMode:Z&&Z.mapping,envMapCubeUVHeight:T,lightMap:!!I.lightMap,aoMap:!!I.aoMap,emissiveMap:!!I.emissiveMap,bumpMap:!!I.bumpMap,normalMap:!!I.normalMap,objectSpaceNormalMap:I.normalMapType===DF,tangentSpaceNormalMap:I.normalMapType===Dg,decodeVideoTexture:!!I.map&&I.map.isVideoTexture===!0&&I.map.encoding===Mn,clearcoat:ne,clearcoatMap:ne&&!!I.clearcoatMap,clearcoatRoughnessMap:ne&&!!I.clearcoatRoughnessMap,clearcoatNormalMap:ne&&!!I.clearcoatNormalMap,displacementMap:!!I.displacementMap,roughnessMap:!!I.roughnessMap,metalnessMap:!!I.metalnessMap,specularMap:!!I.specularMap,specularIntensityMap:!!I.specularIntensityMap,specularColorMap:!!I.specularColorMap,opaque:I.transparent===!1&&I.blending===Lg,alphaMap:!!I.alphaMap,alphaTest:He,gradientMap:!!I.gradientMap,sheen:I.sheen>0,sheenColorMap:!!I.sheenColorMap,sheenRoughnessMap:!!I.sheenRoughnessMap,transmission:I.transmission>0,transmissionMap:!!I.transmissionMap,thicknessMap:!!I.thicknessMap,combine:I.combine,vertexTangents:!!I.normalMap&&!!k.attributes.tangent,vertexColors:I.vertexColors,vertexAlphas:I.vertexColors===!0&&!!k.attributes.color&&k.attributes.color.itemSize===4,vertexUvs:!!I.map||!!I.bumpMap||!!I.normalMap||!!I.specularMap||!!I.alphaMap||!!I.emissiveMap||!!I.roughnessMap||!!I.metalnessMap||!!I.clearcoatMap||!!I.clearcoatRoughnessMap||!!I.clearcoatNormalMap||!!I.displacementMap||!!I.transmissionMap||!!I.thicknessMap||!!I.specularIntensityMap||!!I.specularColorMap||!!I.sheenColorMap||!!I.sheenRoughnessMap,uvsVertexOnly:!(!!I.map||!!I.bumpMap||!!I.normalMap||!!I.specularMap||!!I.alphaMap||!!I.emissiveMap||!!I.roughnessMap||!!I.metalnessMap||!!I.clearcoatNormalMap||I.transmission>0||!!I.transmissionMap||!!I.thicknessMap||!!I.specularIntensityMap||!!I.specularColorMap||I.sheen>0||!!I.sheenColorMap||!!I.sheenRoughnessMap)&&!!I.displacementMap,fog:!!H,useFog:I.fog,fogExp2:H&&H.isFogExp2,flatShading:!!I.flatShading,sizeAttenuation:I.sizeAttenuation,logarithmicDepthBuffer:d,skinning:W.isSkinnedMesh===!0&&K>0,maxBones:K,useVertexTexture:u,morphTargets:k.morphAttributes.position!==void 0,morphNormals:k.morphAttributes.normal!==void 0,morphColors:k.morphAttributes.color!==void 0,morphTargetsCount:O,morphTextureStride:Y,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:I.dithering,shadowMapEnabled:i.shadowMap.enabled&&S.length>0,shadowMapType:i.shadowMap.type,toneMapping:I.toneMapped?i.toneMapping:ra,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:I.premultipliedAlpha,doubleSided:I.side===Fg,flipSided:I.side===di,depthPacking:I.depthPacking!==void 0?I.depthPacking:!1,index0AttributeName:I.index0AttributeName,extensionDerivatives:I.extensions&&I.extensions.derivatives,extensionFragDepth:I.extensions&&I.extensions.fragDepth,extensionDrawBuffers:I.extensions&&I.extensions.drawBuffers,extensionShaderTextureLOD:I.extensions&&I.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||n.has("EXT_shader_texture_lod"),customProgramCacheKey:I.customProgramCacheKey()}}function G(I){const w=[];if(I.shaderID?w.push(I.shaderID):(w.push(I.customVertexShaderID),w.push(I.customFragmentShaderID)),I.defines!==void 0)for(const S in I.defines)w.push(S),w.push(I.defines[S]);return I.isRawShaderMaterial===!1&&(x(w,I),B(w,I),w.push(i.outputEncoding)),w.push(I.customProgramCacheKey),w.join()}function x(I,w){I.push(w.precision),I.push(w.outputEncoding),I.push(w.envMapMode),I.push(w.envMapCubeUVHeight),I.push(w.combine),I.push(w.vertexUvs),I.push(w.fogExp2),I.push(w.sizeAttenuation),I.push(w.maxBones),I.push(w.morphTargetsCount),I.push(w.morphAttributeCount),I.push(w.numDirLights),I.push(w.numPointLights),I.push(w.numSpotLights),I.push(w.numHemiLights),I.push(w.numRectAreaLights),I.push(w.numDirLightShadows),I.push(w.numPointLightShadows),I.push(w.numSpotLightShadows),I.push(w.shadowMapType),I.push(w.toneMapping),I.push(w.numClippingPlanes),I.push(w.numClipIntersection)}function B(I,w){a.disableAll(),w.isWebGL2&&a.enable(0),w.supportsVertexTextures&&a.enable(1),w.instancing&&a.enable(2),w.instancingColor&&a.enable(3),w.map&&a.enable(4),w.matcap&&a.enable(5),w.envMap&&a.enable(6),w.lightMap&&a.enable(7),w.aoMap&&a.enable(8),w.emissiveMap&&a.enable(9),w.bumpMap&&a.enable(10),w.normalMap&&a.enable(11),w.objectSpaceNormalMap&&a.enable(12),w.tangentSpaceNormalMap&&a.enable(13),w.clearcoat&&a.enable(14),w.clearcoatMap&&a.enable(15),w.clearcoatRoughnessMap&&a.enable(16),w.clearcoatNormalMap&&a.enable(17),w.displacementMap&&a.enable(18),w.specularMap&&a.enable(19),w.roughnessMap&&a.enable(20),w.metalnessMap&&a.enable(21),w.gradientMap&&a.enable(22),w.alphaMap&&a.enable(23),w.alphaTest&&a.enable(24),w.vertexColors&&a.enable(25),w.vertexAlphas&&a.enable(26),w.vertexUvs&&a.enable(27),w.vertexTangents&&a.enable(28),w.uvsVertexOnly&&a.enable(29),w.fog&&a.enable(30),I.push(a.mask),a.disableAll(),w.useFog&&a.enable(0),w.flatShading&&a.enable(1),w.logarithmicDepthBuffer&&a.enable(2),w.skinning&&a.enable(3),w.useVertexTexture&&a.enable(4),w.morphTargets&&a.enable(5),w.morphNormals&&a.enable(6),w.morphColors&&a.enable(7),w.premultipliedAlpha&&a.enable(8),w.shadowMapEnabled&&a.enable(9),w.physicallyCorrectLights&&a.enable(10),w.doubleSided&&a.enable(11),w.flipSided&&a.enable(12),w.depthPacking&&a.enable(13),w.dithering&&a.enable(14),w.specularIntensityMap&&a.enable(15),w.specularColorMap&&a.enable(16),w.transmission&&a.enable(17),w.transmissionMap&&a.enable(18),w.thicknessMap&&a.enable(19),w.sheen&&a.enable(20),w.sheenColorMap&&a.enable(21),w.sheenRoughnessMap&&a.enable(22),w.decodeVideoTexture&&a.enable(23),w.opaque&&a.enable(24),I.push(a.mask)}function M(I){const w=y[I.type];let S;if(w){const R=xo[w];S=AL.clone(R.uniforms)}else S=I.uniforms;return S}function E(I,w){let S;for(let R=0,W=c.length;R<W;R++){const H=c[R];if(H.cacheKey===w){S=H,++S.usedTimes;break}}return S===void 0&&(S=new Toe(i,w,I,s),c.push(S)),S}function z(I){if(--I.usedTimes==0){const w=c.indexOf(I);c[w]=c[c.length-1],c.pop(),I.destroy()}}function J(I){l.remove(I)}function V(){l.dispose()}return{getParameters:f,getProgramCacheKey:G,getUniforms:M,acquireProgram:E,releaseProgram:z,releaseShaderCache:J,programs:c,dispose:V}}function Koe(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function Poe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function DL(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function UL(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(d,u,h,p,b,y){let m=i[e];return m===void 0?(m={id:d.id,object:d,geometry:u,material:h,groupOrder:p,renderOrder:d.renderOrder,z:b,group:y},i[e]=m):(m.id=d.id,m.object=d,m.geometry=u,m.material=h,m.groupOrder=p,m.renderOrder=d.renderOrder,m.z=b,m.group=y),e++,m}function a(d,u,h,p,b,y){const m=o(d,u,h,p,b,y);h.transmission>0?n.push(m):h.transparent===!0?r.push(m):t.push(m)}function l(d,u,h,p,b,y){const m=o(d,u,h,p,b,y);h.transmission>0?n.unshift(m):h.transparent===!0?r.unshift(m):t.unshift(m)}function c(d,u){t.length>1&&t.sort(d||Poe),n.length>1&&n.sort(u||DL),r.length>1&&r.sort(u||DL)}function g(){for(let d=e,u=i.length;d<u;d++){const h=i[d];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:g,sort:c}}function Doe(){let i=new WeakMap;function e(n,r){let s;return i.has(n)===!1?(s=new UL,i.set(n,[s])):r>=i.get(n).length?(s=new UL,i.get(n).push(s)):s=i.get(n)[r],s}function t(){i=new WeakMap}return{get:e,dispose:t}}function Uoe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new te,color:new lt};break;case"SpotLight":t={position:new te,direction:new te,color:new lt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new te,color:new lt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new te,skyColor:new lt,groundColor:new lt};break;case"RectAreaLight":t={color:new lt,position:new te,halfWidth:new te,halfHeight:new te};break}return i[e.id]=t,t}}}function Ooe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ke};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ke};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ke,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let Joe=0;function Qoe(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function joe(i,e){const t=new Uoe,n=Ooe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)r.probe.push(new te);const s=new te,o=new bt,a=new bt;function l(g,d){let u=0,h=0,p=0;for(let J=0;J<9;J++)r.probe[J].set(0,0,0);let b=0,y=0,m=0,f=0,G=0,x=0,B=0,M=0;g.sort(Qoe);const E=d!==!0?Math.PI:1;for(let J=0,V=g.length;J<V;J++){const I=g[J],w=I.color,S=I.intensity,R=I.distance,W=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)u+=w.r*S*E,h+=w.g*S*E,p+=w.b*S*E;else if(I.isLightProbe)for(let H=0;H<9;H++)r.probe[H].addScaledVector(I.sh.coefficients[H],S);else if(I.isDirectionalLight){const H=t.get(I);if(H.color.copy(I.color).multiplyScalar(I.intensity*E),I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,r.directionalShadow[b]=_,r.directionalShadowMap[b]=W,r.directionalShadowMatrix[b]=I.shadow.matrix,x++}r.directional[b]=H,b++}else if(I.isSpotLight){const H=t.get(I);if(H.position.setFromMatrixPosition(I.matrixWorld),H.color.copy(w).multiplyScalar(S*E),H.distance=R,H.coneCos=Math.cos(I.angle),H.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),H.decay=I.decay,I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,r.spotShadow[m]=_,r.spotShadowMap[m]=W,r.spotShadowMatrix[m]=I.shadow.matrix,M++}r.spot[m]=H,m++}else if(I.isRectAreaLight){const H=t.get(I);H.color.copy(w).multiplyScalar(S),H.halfWidth.set(I.width*.5,0,0),H.halfHeight.set(0,I.height*.5,0),r.rectArea[f]=H,f++}else if(I.isPointLight){const H=t.get(I);if(H.color.copy(I.color).multiplyScalar(I.intensity*E),H.distance=I.distance,H.decay=I.decay,I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,_.shadowCameraNear=k.camera.near,_.shadowCameraFar=k.camera.far,r.pointShadow[y]=_,r.pointShadowMap[y]=W,r.pointShadowMatrix[y]=I.shadow.matrix,B++}r.point[y]=H,y++}else if(I.isHemisphereLight){const H=t.get(I);H.skyColor.copy(I.color).multiplyScalar(S*E),H.groundColor.copy(I.groundColor).multiplyScalar(S*E),r.hemi[G]=H,G++}}f>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=rt.LTC_FLOAT_1,r.rectAreaLTC2=rt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=rt.LTC_HALF_1,r.rectAreaLTC2=rt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=p;const z=r.hash;(z.directionalLength!==b||z.pointLength!==y||z.spotLength!==m||z.rectAreaLength!==f||z.hemiLength!==G||z.numDirectionalShadows!==x||z.numPointShadows!==B||z.numSpotShadows!==M)&&(r.directional.length=b,r.spot.length=m,r.rectArea.length=f,r.point.length=y,r.hemi.length=G,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=B,r.pointShadowMap.length=B,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=B,r.spotShadowMatrix.length=M,z.directionalLength=b,z.pointLength=y,z.spotLength=m,z.rectAreaLength=f,z.hemiLength=G,z.numDirectionalShadows=x,z.numPointShadows=B,z.numSpotShadows=M,r.version=Joe++)}function c(g,d){let u=0,h=0,p=0,b=0,y=0;const m=d.matrixWorldInverse;for(let f=0,G=g.length;f<G;f++){const x=g[f];if(x.isDirectionalLight){const B=r.directional[u];B.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(m),u++}else if(x.isSpotLight){const B=r.spot[p];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),B.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(m),p++}else if(x.isRectAreaLight){const B=r.rectArea[b];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),a.identity(),o.copy(x.matrixWorld),o.premultiply(m),a.extractRotation(o),B.halfWidth.set(x.width*.5,0,0),B.halfHeight.set(0,x.height*.5,0),B.halfWidth.applyMatrix4(a),B.halfHeight.applyMatrix4(a),b++}else if(x.isPointLight){const B=r.point[h];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),h++}else if(x.isHemisphereLight){const B=r.hemi[y];B.direction.setFromMatrixPosition(x.matrixWorld),B.direction.transformDirection(m),B.direction.normalize(),y++}}}return{setup:l,setupView:c,state:r}}function OL(i,e){const t=new joe(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(d){n.push(d)}function a(d){r.push(d)}function l(d){t.setup(n,d)}function c(d){t.setupView(n,d)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function qoe(i,e){let t=new WeakMap;function n(s,o=0){let a;return t.has(s)===!1?(a=new OL(i,e),t.set(s,[a])):o>=t.get(s).length?(a=new OL(i,e),t.get(s).push(a)):a=t.get(s)[o],a}function r(){t=new WeakMap}return{get:n,dispose:r}}class py extends Ii{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=KF,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}py.prototype.isMeshDepthMaterial=!0;class my extends Ii{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new te,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}my.prototype.isMeshDistanceMaterial=!0;const $oe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,eae=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function JL(i,e,t){let n=new ip;const r=new Ke,s=new Ke,o=new mn,a=new py({depthPacking:PF}),l=new my,c={},g=t.maxTextureSize,d={0:di,1:Hg,2:Fg},u=new js({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ke},radius:{value:4}},vertexShader:$oe,fragmentShader:eae}),h=u.clone();h.defines.HORIZONTAL_PASS=1;const p=new Nt;p.setAttribute("position",new rn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new yi(p,u),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=WB,this.render=function(x,B,M){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||x.length===0)return;const E=i.getRenderTarget(),z=i.getActiveCubeFace(),J=i.getActiveMipmapLevel(),V=i.state;V.setBlending(Ua),V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);for(let I=0,w=x.length;I<w;I++){const S=x[I],R=S.shadow;if(R===void 0){console.warn("THREE.WebGLShadowMap:",S,"has no shadow.");continue}if(R.autoUpdate===!1&&R.needsUpdate===!1)continue;r.copy(R.mapSize);const W=R.getFrameExtents();if(r.multiply(W),s.copy(R.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(s.x=Math.floor(g/W.x),r.x=s.x*W.x,R.mapSize.x=s.x),r.y>g&&(s.y=Math.floor(g/W.y),r.y=s.y*W.y,R.mapSize.y=s.y)),R.map===null&&!R.isPointLightShadow&&this.type===qd){const k={minFilter:jn,magFilter:jn,format:Ar};R.map=new Hr(r.x,r.y,k),R.map.texture.name=S.name+".shadowMap",R.mapPass=new Hr(r.x,r.y,k),R.camera.updateProjectionMatrix()}if(R.map===null){const k={minFilter:bi,magFilter:bi,format:Ar};R.map=new Hr(r.x,r.y,k),R.map.texture.name=S.name+".shadowMap",R.camera.updateProjectionMatrix()}i.setRenderTarget(R.map),i.clear();const H=R.getViewportCount();for(let k=0;k<H;k++){const _=R.getViewport(k);o.set(s.x*_.x,s.y*_.y,s.x*_.z,s.y*_.w),V.viewport(o),R.updateMatrices(S,k),n=R.getFrustum(),G(B,M,R.camera,S,this.type)}!R.isPointLightShadow&&this.type===qd&&m(R,M),R.needsUpdate=!1}y.needsUpdate=!1,i.setRenderTarget(E,z,J)};function m(x,B){const M=e.update(b);u.defines.VSM_SAMPLES!==x.blurSamples&&(u.defines.VSM_SAMPLES=x.blurSamples,h.defines.VSM_SAMPLES=x.blurSamples,u.needsUpdate=!0,h.needsUpdate=!0),u.uniforms.shadow_pass.value=x.map.texture,u.uniforms.resolution.value=x.mapSize,u.uniforms.radius.value=x.radius,i.setRenderTarget(x.mapPass),i.clear(),i.renderBufferDirect(B,null,M,u,b,null),h.uniforms.shadow_pass.value=x.mapPass.texture,h.uniforms.resolution.value=x.mapSize,h.uniforms.radius.value=x.radius,i.setRenderTarget(x.map),i.clear(),i.renderBufferDirect(B,null,M,h,b,null)}function f(x,B,M,E,z,J){let V=null;const I=M.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(I!==void 0?V=I:V=M.isPointLight===!0?l:a,i.localClippingEnabled&&B.clipShadows===!0&&B.clippingPlanes.length!==0||B.displacementMap&&B.displacementScale!==0||B.alphaMap&&B.alphaTest>0){const w=V.uuid,S=B.uuid;let R=c[w];R===void 0&&(R={},c[w]=R);let W=R[S];W===void 0&&(W=V.clone(),R[S]=W),V=W}return V.visible=B.visible,V.wireframe=B.wireframe,J===qd?V.side=B.shadowSide!==null?B.shadowSide:B.side:V.side=B.shadowSide!==null?B.shadowSide:d[B.side],V.alphaMap=B.alphaMap,V.alphaTest=B.alphaTest,V.clipShadows=B.clipShadows,V.clippingPlanes=B.clippingPlanes,V.clipIntersection=B.clipIntersection,V.displacementMap=B.displacementMap,V.displacementScale=B.displacementScale,V.displacementBias=B.displacementBias,V.wireframeLinewidth=B.wireframeLinewidth,V.linewidth=B.linewidth,M.isPointLight===!0&&V.isMeshDistanceMaterial===!0&&(V.referencePosition.setFromMatrixPosition(M.matrixWorld),V.nearDistance=E,V.farDistance=z),V}function G(x,B,M,E,z){if(x.visible===!1)return;if(x.layers.test(B.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&z===qd)&&(!x.frustumCulled||n.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,x.matrixWorld);const I=e.update(x),w=x.material;if(Array.isArray(w)){const S=I.groups;for(let R=0,W=S.length;R<W;R++){const H=S[R],k=w[H.materialIndex];if(k&&k.visible){const _=f(x,k,E,M.near,M.far,z);i.renderBufferDirect(M,null,I,_,x,H)}}}else if(w.visible){const S=f(x,w,E,M.near,M.far,z);i.renderBufferDirect(M,null,I,S,x,null)}}const V=x.children;for(let I=0,w=V.length;I<w;I++)G(V[I],B,M,E,z)}}function tae(i,e,t){const n=t.isWebGL2;function r(){let U=!1;const Fe=new mn;let Ze=null;const Ye=new mn(0,0,0,0);return{setMask:function(me){Ze!==me&&!U&&(i.colorMask(me,me,me,me),Ze=me)},setLocked:function(me){U=me},setClear:function(me,Ge,Pe,ht,wt){wt===!0&&(me*=ht,Ge*=ht,Pe*=ht),Fe.set(me,Ge,Pe,ht),Ye.equals(Fe)===!1&&(i.clearColor(me,Ge,Pe,ht),Ye.copy(Fe))},reset:function(){U=!1,Ze=null,Ye.set(-1,0,0,0)}}}function s(){let U=!1,Fe=null,Ze=null,Ye=null;return{setTest:function(me){me?Y(2929):ee(2929)},setMask:function(me){Fe!==me&&!U&&(i.depthMask(me),Fe=me)},setFunc:function(me){if(Ze!==me){if(me)switch(me){case dF:i.depthFunc(512);break;case hF:i.depthFunc(519);break;case fF:i.depthFunc(513);break;case Vb:i.depthFunc(515);break;case IF:i.depthFunc(514);break;case CF:i.depthFunc(518);break;case pF:i.depthFunc(516);break;case mF:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);Ze=me}},setLocked:function(me){U=me},setClear:function(me){Ye!==me&&(i.clearDepth(me),Ye=me)},reset:function(){U=!1,Fe=null,Ze=null,Ye=null}}}function o(){let U=!1,Fe=null,Ze=null,Ye=null,me=null,Ge=null,Pe=null,ht=null,wt=null;return{setTest:function(nt){U||(nt?Y(2960):ee(2960))},setMask:function(nt){Fe!==nt&&!U&&(i.stencilMask(nt),Fe=nt)},setFunc:function(nt,un,Et){(Ze!==nt||Ye!==un||me!==Et)&&(i.stencilFunc(nt,un,Et),Ze=nt,Ye=un,me=Et)},setOp:function(nt,un,Et){(Ge!==nt||Pe!==un||ht!==Et)&&(i.stencilOp(nt,un,Et),Ge=nt,Pe=un,ht=Et)},setLocked:function(nt){U=nt},setClear:function(nt){wt!==nt&&(i.clearStencil(nt),wt=nt)},reset:function(){U=!1,Fe=null,Ze=null,Ye=null,me=null,Ge=null,Pe=null,ht=null,wt=null}}}const a=new r,l=new s,c=new o;let g={},d={},u=new WeakMap,h=[],p=null,b=!1,y=null,m=null,f=null,G=null,x=null,B=null,M=null,E=!1,z=null,J=null,V=null,I=null,w=null;const S=i.getParameter(35661);let R=!1,W=0;const H=i.getParameter(7938);H.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(H)[1]),R=W>=1):H.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),R=W>=2);let k=null,_={};const Z=i.getParameter(3088),T=i.getParameter(2978),F=new mn().fromArray(Z),K=new mn().fromArray(T);function j(U,Fe,Ze){const Ye=new Uint8Array(4),me=i.createTexture();i.bindTexture(U,me),i.texParameteri(U,10241,9728),i.texParameteri(U,10240,9728);for(let Ge=0;Ge<Ze;Ge++)i.texImage2D(Fe+Ge,0,6408,1,1,0,6408,5121,Ye);return me}const O={};O[3553]=j(3553,3553,1),O[34067]=j(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Y(2929),l.setFunc(Vb),Ie(!1),Be(MB),Y(2884),ne(Ua);function Y(U){g[U]!==!0&&(i.enable(U),g[U]=!0)}function ee(U){g[U]!==!1&&(i.disable(U),g[U]=!1)}function ye(U,Fe){return d[U]!==Fe?(i.bindFramebuffer(U,Fe),d[U]=Fe,n&&(U===36009&&(d[36160]=Fe),U===36160&&(d[36009]=Fe)),!0):!1}function Ce(U,Fe){let Ze=h,Ye=!1;if(U)if(Ze=u.get(Fe),Ze===void 0&&(Ze=[],u.set(Fe,Ze)),U.isWebGLMultipleRenderTargets){const me=U.texture;if(Ze.length!==me.length||Ze[0]!==36064){for(let Ge=0,Pe=me.length;Ge<Pe;Ge++)Ze[Ge]=36064+Ge;Ze.length=me.length,Ye=!0}}else Ze[0]!==36064&&(Ze[0]=36064,Ye=!0);else Ze[0]!==1029&&(Ze[0]=1029,Ye=!0);Ye&&(t.isWebGL2?i.drawBuffers(Ze):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ze))}function he(U){return p!==U?(i.useProgram(U),p=U,!0):!1}const Ne={[Tg]:32774,[tF]:32778,[nF]:32779};if(n)Ne[FB]=32775,Ne[LB]=32776;else{const U=e.get("EXT_blend_minmax");U!==null&&(Ne[FB]=U.MIN_EXT,Ne[LB]=U.MAX_EXT)}const He={[iF]:0,[rF]:1,[sF]:768,[TB]:770,[uF]:776,[cF]:774,[aF]:772,[oF]:769,[XB]:771,[gF]:775,[lF]:773};function ne(U,Fe,Ze,Ye,me,Ge,Pe,ht){if(U===Ua){b===!0&&(ee(3042),b=!1);return}if(b===!1&&(Y(3042),b=!0),U!==eF){if(U!==y||ht!==E){if((m!==Tg||x!==Tg)&&(i.blendEquation(32774),m=Tg,x=Tg),ht)switch(U){case Lg:i.blendFuncSeparate(1,771,1,771);break;case NB:i.blendFunc(1,1);break;case EB:i.blendFuncSeparate(0,769,0,1);break;case HB:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}else switch(U){case Lg:i.blendFuncSeparate(770,771,1,771);break;case NB:i.blendFunc(770,1);break;case EB:i.blendFuncSeparate(0,769,0,1);break;case HB:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}f=null,G=null,B=null,M=null,y=U,E=ht}return}me=me||Fe,Ge=Ge||Ze,Pe=Pe||Ye,(Fe!==m||me!==x)&&(i.blendEquationSeparate(Ne[Fe],Ne[me]),m=Fe,x=me),(Ze!==f||Ye!==G||Ge!==B||Pe!==M)&&(i.blendFuncSeparate(He[Ze],He[Ye],He[Ge],He[Pe]),f=Ze,G=Ye,B=Ge,M=Pe),y=U,E=null}function de(U,Fe){U.side===Fg?ee(2884):Y(2884);let Ze=U.side===di;Fe&&(Ze=!Ze),Ie(Ze),U.blending===Lg&&U.transparent===!1?ne(Ua):ne(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.premultipliedAlpha),l.setFunc(U.depthFunc),l.setTest(U.depthTest),l.setMask(U.depthWrite),a.setMask(U.colorWrite);const Ye=U.stencilWrite;c.setTest(Ye),Ye&&(c.setMask(U.stencilWriteMask),c.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),c.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),Xe(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),U.alphaToCoverage===!0?Y(32926):ee(32926)}function Ie(U){z!==U&&(U?i.frontFace(2304):i.frontFace(2305),z=U)}function Be(U){U!==qH?(Y(2884),U!==J&&(U===MB?i.cullFace(1029):U===$H?i.cullFace(1028):i.cullFace(1032))):ee(2884),J=U}function Re(U){U!==V&&(R&&i.lineWidth(U),V=U)}function Xe(U,Fe,Ze){U?(Y(32823),(I!==Fe||w!==Ze)&&(i.polygonOffset(Fe,Ze),I=Fe,w=Ze)):ee(32823)}function Le(U){U?Y(3089):ee(3089)}function Qe(U){U===void 0&&(U=33984+S-1),k!==U&&(i.activeTexture(U),k=U)}function et(U,Fe){k===null&&Qe();let Ze=_[k];Ze===void 0&&(Ze={type:void 0,texture:void 0},_[k]=Ze),(Ze.type!==U||Ze.texture!==Fe)&&(i.bindTexture(U,Fe||O[U]),Ze.type=U,Ze.texture=Fe)}function q(){const U=_[k];U!==void 0&&U.type!==void 0&&(i.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)}function X(){try{i.compressedTexImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function D(){try{i.texSubImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ge(){try{i.texSubImage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Se(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Me(){try{i.texStorage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function pe(){try{i.texStorage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function we(){try{i.texImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function re(){try{i.texImage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function be(U){F.equals(U)===!1&&(i.scissor(U.x,U.y,U.z,U.w),F.copy(U))}function _e(U){K.equals(U)===!1&&(i.viewport(U.x,U.y,U.z,U.w),K.copy(U))}function Ee(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),g={},k=null,_={},d={},u=new WeakMap,h=[],p=null,b=!1,y=null,m=null,f=null,G=null,x=null,B=null,M=null,E=!1,z=null,J=null,V=null,I=null,w=null,F.set(0,0,i.canvas.width,i.canvas.height),K.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:Y,disable:ee,bindFramebuffer:ye,drawBuffers:Ce,useProgram:he,setBlending:ne,setMaterial:de,setFlipSided:Ie,setCullFace:Be,setLineWidth:Re,setPolygonOffset:Xe,setScissorTest:Le,activeTexture:Qe,bindTexture:et,unbindTexture:q,compressedTexImage2D:X,texImage2D:we,texImage3D:re,texStorage2D:Me,texStorage3D:pe,texSubImage2D:D,texSubImage3D:ge,compressedTexSubImage2D:Se,scissor:be,viewport:_e,reset:Ee}}function nae(i,e,t,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,g=r.maxTextureSize,d=r.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=new WeakMap;let p;const b=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(q,X){return y?new OffscreenCanvas(q,X):qC("canvas")}function f(q,X,D,ge){let Se=1;if((q.width>ge||q.height>ge)&&(Se=ge/Math.max(q.width,q.height)),Se<1||X===!0)if(typeof HTMLImageElement!="undefined"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&q instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&q instanceof ImageBitmap){const Me=X?Db:Math.floor,pe=Me(Se*q.width),we=Me(Se*q.height);p===void 0&&(p=m(pe,we));const re=D?m(pe,we):p;return re.width=pe,re.height=we,re.getContext("2d").drawImage(q,0,0,pe,we),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+q.width+"x"+q.height+") to ("+pe+"x"+we+")."),re}else return"data"in q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+q.width+"x"+q.height+")."),q;return q}function G(q){return hS(q.width)&&hS(q.height)}function x(q){return a?!1:q.wrapS!==Er||q.wrapT!==Er||q.minFilter!==bi&&q.minFilter!==jn}function B(q,X){return q.generateMipmaps&&X&&q.minFilter!==bi&&q.minFilter!==jn}function M(q){i.generateMipmap(q)}function E(q,X,D,ge,Se=!1){if(a===!1)return X;if(q!==null){if(i[q]!==void 0)return i[q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}let Me=X;return X===6403&&(D===5126&&(Me=33326),D===5131&&(Me=33325),D===5121&&(Me=33321)),X===33319&&(D===5126&&(Me=33328),D===5131&&(Me=33327),D===5121&&(Me=33323)),X===6408&&(D===5126&&(Me=34836),D===5131&&(Me=34842),D===5121&&(Me=ge===Mn&&Se===!1?35907:32856),D===32819&&(Me=32854),D===32820&&(Me=32855)),(Me===33325||Me===33326||Me===33327||Me===33328||Me===34842||Me===34836)&&e.get("EXT_color_buffer_float"),Me}function z(q,X,D){return B(q,D)===!0||q.isFramebufferTexture&&q.minFilter!==bi&&q.minFilter!==jn?Math.log2(Math.max(X.width,X.height))+1:q.mipmaps!==void 0&&q.mipmaps.length>0?q.mipmaps.length:q.isCompressedTexture&&Array.isArray(q.image)?X.mipmaps.length:1}function J(q){return q===bi||q===Eb||q===Hb?9728:9729}function V(q){const X=q.target;X.removeEventListener("dispose",V),w(X),X.isVideoTexture&&h.delete(X)}function I(q){const X=q.target;X.removeEventListener("dispose",I),R(X)}function w(q){const X=n.get(q);if(X.__webglInit===void 0)return;const D=q.source,ge=b.get(D);if(ge){const Se=ge[X.__cacheKey];Se.usedTimes--,Se.usedTimes===0&&S(q),Object.keys(ge).length===0&&b.delete(D)}n.remove(q)}function S(q){const X=n.get(q);i.deleteTexture(X.__webglTexture);const D=q.source,ge=b.get(D);delete ge[X.__cacheKey],o.memory.textures--}function R(q){const X=q.texture,D=n.get(q),ge=n.get(X);if(ge.__webglTexture!==void 0&&(i.deleteTexture(ge.__webglTexture),o.memory.textures--),q.depthTexture&&q.depthTexture.dispose(),q.isWebGLCubeRenderTarget)for(let Se=0;Se<6;Se++)i.deleteFramebuffer(D.__webglFramebuffer[Se]),D.__webglDepthbuffer&&i.deleteRenderbuffer(D.__webglDepthbuffer[Se]);else i.deleteFramebuffer(D.__webglFramebuffer),D.__webglDepthbuffer&&i.deleteRenderbuffer(D.__webglDepthbuffer),D.__webglMultisampledFramebuffer&&i.deleteFramebuffer(D.__webglMultisampledFramebuffer),D.__webglColorRenderbuffer&&i.deleteRenderbuffer(D.__webglColorRenderbuffer),D.__webglDepthRenderbuffer&&i.deleteRenderbuffer(D.__webglDepthRenderbuffer);if(q.isWebGLMultipleRenderTargets)for(let Se=0,Me=X.length;Se<Me;Se++){const pe=n.get(X[Se]);pe.__webglTexture&&(i.deleteTexture(pe.__webglTexture),o.memory.textures--),n.remove(X[Se])}n.remove(X),n.remove(q)}let W=0;function H(){W=0}function k(){const q=W;return q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+l),W+=1,q}function _(q){const X=[];return X.push(q.wrapS),X.push(q.wrapT),X.push(q.magFilter),X.push(q.minFilter),X.push(q.anisotropy),X.push(q.internalFormat),X.push(q.format),X.push(q.type),X.push(q.generateMipmaps),X.push(q.premultiplyAlpha),X.push(q.flipY),X.push(q.unpackAlignment),X.push(q.encoding),X.join()}function Z(q,X){const D=n.get(q);if(q.isVideoTexture&&Qe(q),q.isRenderTargetTexture===!1&&q.version>0&&D.__version!==q.version){const ge=q.image;if(ge===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ge.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ye(D,q,X);return}}t.activeTexture(33984+X),t.bindTexture(3553,D.__webglTexture)}function T(q,X){const D=n.get(q);if(q.version>0&&D.__version!==q.version){ye(D,q,X);return}t.activeTexture(33984+X),t.bindTexture(35866,D.__webglTexture)}function F(q,X){const D=n.get(q);if(q.version>0&&D.__version!==q.version){ye(D,q,X);return}t.activeTexture(33984+X),t.bindTexture(32879,D.__webglTexture)}function K(q,X){const D=n.get(q);if(q.version>0&&D.__version!==q.version){Ce(D,q,X);return}t.activeTexture(33984+X),t.bindTexture(34067,D.__webglTexture)}const j={[KC]:10497,[Er]:33071,[PC]:33648},O={[bi]:9728,[Eb]:9984,[Hb]:9986,[jn]:9729,[kB]:9985,[Xg]:9987};function Y(q,X,D){if(D?(i.texParameteri(q,10242,j[X.wrapS]),i.texParameteri(q,10243,j[X.wrapT]),(q===32879||q===35866)&&i.texParameteri(q,32882,j[X.wrapR]),i.texParameteri(q,10240,O[X.magFilter]),i.texParameteri(q,10241,O[X.minFilter])):(i.texParameteri(q,10242,33071),i.texParameteri(q,10243,33071),(q===32879||q===35866)&&i.texParameteri(q,32882,33071),(X.wrapS!==Er||X.wrapT!==Er)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(q,10240,J(X.magFilter)),i.texParameteri(q,10241,J(X.minFilter)),X.minFilter!==bi&&X.minFilter!==jn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ge=e.get("EXT_texture_filter_anisotropic");if(X.type===Oa&&e.has("OES_texture_float_linear")===!1||a===!1&&X.type===zg&&e.has("OES_texture_half_float_linear")===!1)return;(X.anisotropy>1||n.get(X).__currentAnisotropy)&&(i.texParameterf(q,ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X.anisotropy,r.getMaxAnisotropy())),n.get(X).__currentAnisotropy=X.anisotropy)}}function ee(q,X){let D=!1;q.__webglInit===void 0&&(q.__webglInit=!0,X.addEventListener("dispose",V));const ge=X.source;let Se=b.get(ge);Se===void 0&&(Se={},b.set(ge,Se));const Me=_(X);if(Me!==q.__cacheKey){Se[Me]===void 0&&(Se[Me]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,D=!0),Se[Me].usedTimes++;const pe=Se[q.__cacheKey];pe!==void 0&&(Se[q.__cacheKey].usedTimes--,pe.usedTimes===0&&S(X)),q.__cacheKey=Me,q.__webglTexture=Se[Me].texture}return D}function ye(q,X,D){let ge=3553;X.isDataArrayTexture&&(ge=35866),X.isData3DTexture&&(ge=32879);const Se=ee(q,X),Me=X.source;if(t.activeTexture(33984+D),t.bindTexture(ge,q.__webglTexture),Me.version!==Me.__currentVersion||Se===!0){i.pixelStorei(37440,X.flipY),i.pixelStorei(37441,X.premultiplyAlpha),i.pixelStorei(3317,X.unpackAlignment),i.pixelStorei(37443,0);const pe=x(X)&&G(X.image)===!1;let we=f(X.image,pe,!1,g);we=et(X,we);const re=G(we)||a,be=s.convert(X.format,X.encoding);let _e=s.convert(X.type),Ee=E(X.internalFormat,be,_e,X.encoding,X.isVideoTexture);Y(ge,X,re);let U;const Fe=X.mipmaps,Ze=a&&X.isVideoTexture!==!0,Ye=q.__version===void 0,me=z(X,we,re);if(X.isDepthTexture)Ee=6402,a?X.type===Oa?Ee=36012:X.type===DC?Ee=33190:X.type===kg?Ee=35056:Ee=33189:X.type===Oa&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),X.format===Cc&&Ee===6402&&X.type!==eh&&X.type!==DC&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),X.type=eh,_e=s.convert(X.type)),X.format===Yg&&Ee===6402&&(Ee=34041,X.type!==kg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),X.type=kg,_e=s.convert(X.type))),Ze&&Ye?t.texStorage2D(3553,1,Ee,we.width,we.height):t.texImage2D(3553,0,Ee,we.width,we.height,0,be,_e,null);else if(X.isDataTexture)if(Fe.length>0&&re){Ze&&Ye&&t.texStorage2D(3553,me,Ee,Fe[0].width,Fe[0].height);for(let Ge=0,Pe=Fe.length;Ge<Pe;Ge++)U=Fe[Ge],Ze?t.texSubImage2D(3553,Ge,0,0,U.width,U.height,be,_e,U.data):t.texImage2D(3553,Ge,Ee,U.width,U.height,0,be,_e,U.data);X.generateMipmaps=!1}else Ze?(Ye&&t.texStorage2D(3553,me,Ee,we.width,we.height),t.texSubImage2D(3553,0,0,0,we.width,we.height,be,_e,we.data)):t.texImage2D(3553,0,Ee,we.width,we.height,0,be,_e,we.data);else if(X.isCompressedTexture){Ze&&Ye&&t.texStorage2D(3553,me,Ee,Fe[0].width,Fe[0].height);for(let Ge=0,Pe=Fe.length;Ge<Pe;Ge++)U=Fe[Ge],X.format!==Ar?be!==null?Ze?t.compressedTexSubImage2D(3553,Ge,0,0,U.width,U.height,be,U.data):t.compressedTexImage2D(3553,Ge,Ee,U.width,U.height,0,U.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ze?t.texSubImage2D(3553,Ge,0,0,U.width,U.height,be,_e,U.data):t.texImage2D(3553,Ge,Ee,U.width,U.height,0,be,_e,U.data)}else if(X.isDataArrayTexture)Ze?(Ye&&t.texStorage3D(35866,me,Ee,we.width,we.height,we.depth),t.texSubImage3D(35866,0,0,0,0,we.width,we.height,we.depth,be,_e,we.data)):t.texImage3D(35866,0,Ee,we.width,we.height,we.depth,0,be,_e,we.data);else if(X.isData3DTexture)Ze?(Ye&&t.texStorage3D(32879,me,Ee,we.width,we.height,we.depth),t.texSubImage3D(32879,0,0,0,0,we.width,we.height,we.depth,be,_e,we.data)):t.texImage3D(32879,0,Ee,we.width,we.height,we.depth,0,be,_e,we.data);else if(X.isFramebufferTexture)Ze&&Ye?t.texStorage2D(3553,me,Ee,we.width,we.height):t.texImage2D(3553,0,Ee,we.width,we.height,0,be,_e,null);else if(Fe.length>0&&re){Ze&&Ye&&t.texStorage2D(3553,me,Ee,Fe[0].width,Fe[0].height);for(let Ge=0,Pe=Fe.length;Ge<Pe;Ge++)U=Fe[Ge],Ze?t.texSubImage2D(3553,Ge,0,0,be,_e,U):t.texImage2D(3553,Ge,Ee,be,_e,U);X.generateMipmaps=!1}else Ze?(Ye&&t.texStorage2D(3553,me,Ee,we.width,we.height),t.texSubImage2D(3553,0,0,0,be,_e,we)):t.texImage2D(3553,0,Ee,be,_e,we);B(X,re)&&M(ge),Me.__currentVersion=Me.version,X.onUpdate&&X.onUpdate(X)}q.__version=X.version}function Ce(q,X,D){if(X.image.length!==6)return;const ge=ee(q,X),Se=X.source;if(t.activeTexture(33984+D),t.bindTexture(34067,q.__webglTexture),Se.version!==Se.__currentVersion||ge===!0){i.pixelStorei(37440,X.flipY),i.pixelStorei(37441,X.premultiplyAlpha),i.pixelStorei(3317,X.unpackAlignment),i.pixelStorei(37443,0);const Me=X.isCompressedTexture||X.image[0].isCompressedTexture,pe=X.image[0]&&X.image[0].isDataTexture,we=[];for(let Ge=0;Ge<6;Ge++)!Me&&!pe?we[Ge]=f(X.image[Ge],!1,!0,c):we[Ge]=pe?X.image[Ge].image:X.image[Ge],we[Ge]=et(X,we[Ge]);const re=we[0],be=G(re)||a,_e=s.convert(X.format,X.encoding),Ee=s.convert(X.type),U=E(X.internalFormat,_e,Ee,X.encoding),Fe=a&&X.isVideoTexture!==!0,Ze=q.__version===void 0;let Ye=z(X,re,be);Y(34067,X,be);let me;if(Me){Fe&&Ze&&t.texStorage2D(34067,Ye,U,re.width,re.height);for(let Ge=0;Ge<6;Ge++){me=we[Ge].mipmaps;for(let Pe=0;Pe<me.length;Pe++){const ht=me[Pe];X.format!==Ar?_e!==null?Fe?t.compressedTexSubImage2D(34069+Ge,Pe,0,0,ht.width,ht.height,_e,ht.data):t.compressedTexImage2D(34069+Ge,Pe,U,ht.width,ht.height,0,ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Fe?t.texSubImage2D(34069+Ge,Pe,0,0,ht.width,ht.height,_e,Ee,ht.data):t.texImage2D(34069+Ge,Pe,U,ht.width,ht.height,0,_e,Ee,ht.data)}}}else{me=X.mipmaps,Fe&&Ze&&(me.length>0&&Ye++,t.texStorage2D(34067,Ye,U,we[0].width,we[0].height));for(let Ge=0;Ge<6;Ge++)if(pe){Fe?t.texSubImage2D(34069+Ge,0,0,0,we[Ge].width,we[Ge].height,_e,Ee,we[Ge].data):t.texImage2D(34069+Ge,0,U,we[Ge].width,we[Ge].height,0,_e,Ee,we[Ge].data);for(let Pe=0;Pe<me.length;Pe++){const wt=me[Pe].image[Ge].image;Fe?t.texSubImage2D(34069+Ge,Pe+1,0,0,wt.width,wt.height,_e,Ee,wt.data):t.texImage2D(34069+Ge,Pe+1,U,wt.width,wt.height,0,_e,Ee,wt.data)}}else{Fe?t.texSubImage2D(34069+Ge,0,0,0,_e,Ee,we[Ge]):t.texImage2D(34069+Ge,0,U,_e,Ee,we[Ge]);for(let Pe=0;Pe<me.length;Pe++){const ht=me[Pe];Fe?t.texSubImage2D(34069+Ge,Pe+1,0,0,_e,Ee,ht.image[Ge]):t.texImage2D(34069+Ge,Pe+1,U,_e,Ee,ht.image[Ge])}}}B(X,be)&&M(34067),Se.__currentVersion=Se.version,X.onUpdate&&X.onUpdate(X)}q.__version=X.version}function he(q,X,D,ge,Se){const Me=s.convert(D.format,D.encoding),pe=s.convert(D.type),we=E(D.internalFormat,Me,pe,D.encoding);n.get(X).__hasExternalTextures||(Se===32879||Se===35866?t.texImage3D(Se,0,we,X.width,X.height,X.depth,0,Me,pe,null):t.texImage2D(Se,0,we,X.width,X.height,0,Me,pe,null)),t.bindFramebuffer(36160,q),Le(X)?u.framebufferTexture2DMultisampleEXT(36160,ge,Se,n.get(D).__webglTexture,0,Xe(X)):i.framebufferTexture2D(36160,ge,Se,n.get(D).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ne(q,X,D){if(i.bindRenderbuffer(36161,q),X.depthBuffer&&!X.stencilBuffer){let ge=33189;if(D||Le(X)){const Se=X.depthTexture;Se&&Se.isDepthTexture&&(Se.type===Oa?ge=36012:Se.type===DC&&(ge=33190));const Me=Xe(X);Le(X)?u.renderbufferStorageMultisampleEXT(36161,Me,ge,X.width,X.height):i.renderbufferStorageMultisample(36161,Me,ge,X.width,X.height)}else i.renderbufferStorage(36161,ge,X.width,X.height);i.framebufferRenderbuffer(36160,36096,36161,q)}else if(X.depthBuffer&&X.stencilBuffer){const ge=Xe(X);D&&Le(X)===!1?i.renderbufferStorageMultisample(36161,ge,35056,X.width,X.height):Le(X)?u.renderbufferStorageMultisampleEXT(36161,ge,35056,X.width,X.height):i.renderbufferStorage(36161,34041,X.width,X.height),i.framebufferRenderbuffer(36160,33306,36161,q)}else{const ge=X.isWebGLMultipleRenderTargets===!0?X.texture[0]:X.texture,Se=s.convert(ge.format,ge.encoding),Me=s.convert(ge.type),pe=E(ge.internalFormat,Se,Me,ge.encoding),we=Xe(X);D&&Le(X)===!1?i.renderbufferStorageMultisample(36161,we,pe,X.width,X.height):Le(X)?u.renderbufferStorageMultisampleEXT(36161,we,pe,X.width,X.height):i.renderbufferStorage(36161,pe,X.width,X.height)}i.bindRenderbuffer(36161,null)}function He(q,X){if(X&&X.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,q),!(X.depthTexture&&X.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(X.depthTexture).__webglTexture||X.depthTexture.image.width!==X.width||X.depthTexture.image.height!==X.height)&&(X.depthTexture.image.width=X.width,X.depthTexture.image.height=X.height,X.depthTexture.needsUpdate=!0),Z(X.depthTexture,0);const ge=n.get(X.depthTexture).__webglTexture,Se=Xe(X);if(X.depthTexture.format===Cc)Le(X)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,ge,0,Se):i.framebufferTexture2D(36160,36096,3553,ge,0);else if(X.depthTexture.format===Yg)Le(X)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,ge,0,Se):i.framebufferTexture2D(36160,33306,3553,ge,0);else throw new Error("Unknown depthTexture format")}function ne(q){const X=n.get(q),D=q.isWebGLCubeRenderTarget===!0;if(q.depthTexture&&!X.__autoAllocateDepthBuffer){if(D)throw new Error("target.depthTexture not supported in Cube render targets");He(X.__webglFramebuffer,q)}else if(D){X.__webglDepthbuffer=[];for(let ge=0;ge<6;ge++)t.bindFramebuffer(36160,X.__webglFramebuffer[ge]),X.__webglDepthbuffer[ge]=i.createRenderbuffer(),Ne(X.__webglDepthbuffer[ge],q,!1)}else t.bindFramebuffer(36160,X.__webglFramebuffer),X.__webglDepthbuffer=i.createRenderbuffer(),Ne(X.__webglDepthbuffer,q,!1);t.bindFramebuffer(36160,null)}function de(q,X,D){const ge=n.get(q);X!==void 0&&he(ge.__webglFramebuffer,q,q.texture,36064,3553),D!==void 0&&ne(q)}function Ie(q){const X=q.texture,D=n.get(q),ge=n.get(X);q.addEventListener("dispose",I),q.isWebGLMultipleRenderTargets!==!0&&(ge.__webglTexture===void 0&&(ge.__webglTexture=i.createTexture()),ge.__version=X.version,o.memory.textures++);const Se=q.isWebGLCubeRenderTarget===!0,Me=q.isWebGLMultipleRenderTargets===!0,pe=G(q)||a;if(Se){D.__webglFramebuffer=[];for(let we=0;we<6;we++)D.__webglFramebuffer[we]=i.createFramebuffer()}else if(D.__webglFramebuffer=i.createFramebuffer(),Me)if(r.drawBuffers){const we=q.texture;for(let re=0,be=we.length;re<be;re++){const _e=n.get(we[re]);_e.__webglTexture===void 0&&(_e.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&q.samples>0&&Le(q)===!1){D.__webglMultisampledFramebuffer=i.createFramebuffer(),D.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,D.__webglColorRenderbuffer);const we=s.convert(X.format,X.encoding),re=s.convert(X.type),be=E(X.internalFormat,we,re,X.encoding),_e=Xe(q);i.renderbufferStorageMultisample(36161,_e,be,q.width,q.height),t.bindFramebuffer(36160,D.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,D.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),q.depthBuffer&&(D.__webglDepthRenderbuffer=i.createRenderbuffer(),Ne(D.__webglDepthRenderbuffer,q,!0)),t.bindFramebuffer(36160,null)}if(Se){t.bindTexture(34067,ge.__webglTexture),Y(34067,X,pe);for(let we=0;we<6;we++)he(D.__webglFramebuffer[we],q,X,36064,34069+we);B(X,pe)&&M(34067),t.unbindTexture()}else if(Me){const we=q.texture;for(let re=0,be=we.length;re<be;re++){const _e=we[re],Ee=n.get(_e);t.bindTexture(3553,Ee.__webglTexture),Y(3553,_e,pe),he(D.__webglFramebuffer,q,_e,36064+re,3553),B(_e,pe)&&M(3553)}t.unbindTexture()}else{let we=3553;(q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(a?we=q.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(we,ge.__webglTexture),Y(we,X,pe),he(D.__webglFramebuffer,q,X,36064,we),B(X,pe)&&M(we),t.unbindTexture()}q.depthBuffer&&ne(q)}function Be(q){const X=G(q)||a,D=q.isWebGLMultipleRenderTargets===!0?q.texture:[q.texture];for(let ge=0,Se=D.length;ge<Se;ge++){const Me=D[ge];if(B(Me,X)){const pe=q.isWebGLCubeRenderTarget?34067:3553,we=n.get(Me).__webglTexture;t.bindTexture(pe,we),M(pe),t.unbindTexture()}}}function Re(q){if(a&&q.samples>0&&Le(q)===!1){const X=q.width,D=q.height;let ge=16384;const Se=[36064],Me=q.stencilBuffer?33306:36096;q.depthBuffer&&Se.push(Me);const pe=n.get(q),we=pe.__ignoreDepthValues!==void 0?pe.__ignoreDepthValues:!1;we===!1&&(q.depthBuffer&&(ge|=256),q.stencilBuffer&&(ge|=1024)),t.bindFramebuffer(36008,pe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,pe.__webglFramebuffer),we===!0&&(i.invalidateFramebuffer(36008,[Me]),i.invalidateFramebuffer(36009,[Me])),i.blitFramebuffer(0,0,X,D,0,0,X,D,ge,9728),i.invalidateFramebuffer(36008,Se),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,pe.__webglMultisampledFramebuffer)}}function Xe(q){return Math.min(d,q.samples)}function Le(q){const X=n.get(q);return a&&q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&X.__useRenderToTexture!==!1}function Qe(q){const X=o.render.frame;h.get(q)!==X&&(h.set(q,X),q.update())}function et(q,X){const D=q.encoding,ge=q.format,Se=q.type;return q.isCompressedTexture===!0||q.isVideoTexture===!0||q.format===Kb||D!==Ao&&(D===Mn?a===!1?e.has("EXT_sRGB")===!0&&ge===Ar?(q.format=Kb,q.minFilter=jn,q.generateMipmaps=!1):X=pc.sRGBToLinear(X):(ge!==Ar||Se!==Ic)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",D)),X}this.allocateTextureUnit=k,this.resetTextureUnits=H,this.setTexture2D=Z,this.setTexture2DArray=T,this.setTexture3D=F,this.setTextureCube=K,this.rebindTextures=de,this.setupRenderTarget=Ie,this.updateRenderTargetMipmap=Be,this.updateMultisampleRenderTarget=Re,this.setupDepthRenderbuffer=ne,this.setupFrameBufferTexture=he,this.useMultisampledRTT=Le}function QL(i,e,t){const n=t.isWebGL2;function r(s,o=null){let a;if(s===Ic)return 5121;if(s===ZF)return 32819;if(s===RF)return 32820;if(s===GF)return 5120;if(s===BF)return 5122;if(s===eh)return 5123;if(s===SF)return 5124;if(s===DC)return 5125;if(s===Oa)return 5126;if(s===zg)return n?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===MF)return 6406;if(s===Ar)return 6408;if(s===_F)return 6409;if(s===VF)return 6410;if(s===Cc)return 6402;if(s===Yg)return 34041;if(s===NF)return 6403;if(s===WF)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===Kb)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===EF)return 36244;if(s===HF)return 33319;if(s===FF)return 33320;if(s===LF)return 36249;if(s===Fb||s===Lb||s===Tb||s===Xb)if(o===Mn)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===Fb)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Lb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Tb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===Xb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===Fb)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Lb)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Tb)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Xb)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===YB||s===KB||s===PB||s===DB)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===YB)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===KB)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===PB)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===DB)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===TF)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===UB||s===OB)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===UB)return o===Mn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===OB)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===JB||s===QB||s===jB||s===qB||s===$B||s===eS||s===tS||s===nS||s===iS||s===rS||s===sS||s===oS||s===aS||s===lS)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===JB)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===QB)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===jB)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===qB)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===$B)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===eS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===tS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===nS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===iS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===rS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===sS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===oS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===aS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===lS)return o===Mn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===cS)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===cS)return o===Mn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===kg)return n?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}class kS extends Ri{constructor(e=[]){super();this.cameras=e}}kS.prototype.isArrayCamera=!0;class nu extends Ut{constructor(){super();this.type="Group"}}nu.prototype.isGroup=!0;const iae={type:"move"};class YS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new nu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new nu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new nu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(r=t.getPose(e.targetRaySpace,n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(iae))),c&&e.hand){o=!0;for(const b of e.hand.values()){const y=t.getJointPose(b,n);if(c.joints[b.jointName]===void 0){const f=new nu;f.matrixAutoUpdate=!1,f.visible=!1,c.joints[b.jointName]=f,c.add(f)}const m=c.joints[b.jointName];y!==null&&(m.matrix.fromArray(y.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=y.radius),m.visible=y!==null}const g=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],u=g.position.distanceTo(d.position),h=.02,p=.005;c.inputState.pinching&&u>h+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&u<=h-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}}class KS extends hi{constructor(e,t,n,r,s,o,a,l,c,g){if(g=g!==void 0?g:Cc,g!==Cc&&g!==Yg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&g===Cc&&(n=eh),n===void 0&&g===Yg&&(n=kg);super(null,r,s,o,a,l,g,n,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:bi,this.minFilter=l!==void 0?l:bi,this.flipY=!1,this.generateMipmaps=!1}}KS.prototype.isDepthTexture=!0;class rae extends Ja{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=null,c=null,g=null,d=null,u=null;const h=t.getContextAttributes();let p=null,b=null;const y=[],m=new Map,f=new Ri;f.layers.enable(1),f.viewport=new mn;const G=new Ri;G.layers.enable(2),G.viewport=new mn;const x=[f,G],B=new kS;B.layers.enable(1),B.layers.enable(2);let M=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(_){let Z=y[_];return Z===void 0&&(Z=new YS,y[_]=Z),Z.getTargetRaySpace()},this.getControllerGrip=function(_){let Z=y[_];return Z===void 0&&(Z=new YS,y[_]=Z),Z.getGripSpace()},this.getHand=function(_){let Z=y[_];return Z===void 0&&(Z=new YS,y[_]=Z),Z.getHandSpace()};function z(_){const Z=m.get(_.inputSource);Z&&Z.dispatchEvent({type:_.type,data:_.inputSource})}function J(){m.forEach(function(_,Z){_.disconnect(Z)}),m.clear(),M=null,E=null,e.setRenderTarget(p),d=null,g=null,c=null,r=null,b=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(_){s=_,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(_){a=_,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return g!==null?g:d},this.getBinding=function(){return c},this.getFrame=function(){return u},this.getSession=function(){return r},this.setSession=async function(_){if(r=_,r!==null){if(p=e.getRenderTarget(),r.addEventListener("select",z),r.addEventListener("selectstart",z),r.addEventListener("selectend",z),r.addEventListener("squeeze",z),r.addEventListener("squeezestart",z),r.addEventListener("squeezeend",z),r.addEventListener("end",J),r.addEventListener("inputsourceschange",V),h.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Z={antialias:r.renderState.layers===void 0?h.antialias:!0,alpha:h.alpha,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,t,Z),r.updateRenderState({baseLayer:d}),b=new Hr(d.framebufferWidth,d.framebufferHeight,{format:Ar,type:Ic,encoding:e.outputEncoding})}else{let Z=null,T=null,F=null;h.depth&&(F=h.stencil?35056:33190,Z=h.stencil?Yg:Cc,T=h.stencil?kg:eh);const K={colorFormat:e.outputEncoding===Mn?35907:32856,depthFormat:F,scaleFactor:s};c=new XRWebGLBinding(r,t),g=c.createProjectionLayer(K),r.updateRenderState({layers:[g]}),b=new Hr(g.textureWidth,g.textureHeight,{format:Ar,type:Ic,depthTexture:new KS(g.textureWidth,g.textureHeight,T,void 0,void 0,void 0,void 0,void 0,void 0,Z),stencilBuffer:h.stencil,encoding:e.outputEncoding,samples:h.antialias?4:0});const j=e.properties.get(b);j.__ignoreDepthValues=g.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(1),o=await r.requestReferenceSpace(a),k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function V(_){const Z=r.inputSources;for(let T=0;T<y.length;T++)m.set(Z[T],y[T]);for(let T=0;T<_.removed.length;T++){const F=_.removed[T],K=m.get(F);K&&(K.dispatchEvent({type:"disconnected",data:F}),m.delete(F))}for(let T=0;T<_.added.length;T++){const F=_.added[T],K=m.get(F);K&&K.dispatchEvent({type:"connected",data:F})}}const I=new te,w=new te;function S(_,Z,T){I.setFromMatrixPosition(Z.matrixWorld),w.setFromMatrixPosition(T.matrixWorld);const F=I.distanceTo(w),K=Z.projectionMatrix.elements,j=T.projectionMatrix.elements,O=K[14]/(K[10]-1),Y=K[14]/(K[10]+1),ee=(K[9]+1)/K[5],ye=(K[9]-1)/K[5],Ce=(K[8]-1)/K[0],he=(j[8]+1)/j[0],Ne=O*Ce,He=O*he,ne=F/(-Ce+he),de=ne*-Ce;Z.matrixWorld.decompose(_.position,_.quaternion,_.scale),_.translateX(de),_.translateZ(ne),_.matrixWorld.compose(_.position,_.quaternion,_.scale),_.matrixWorldInverse.copy(_.matrixWorld).invert();const Ie=O+ne,Be=Y+ne,Re=Ne-de,Xe=He+(F-de),Le=ee*Y/Be*Ie,Qe=ye*Y/Be*Ie;_.projectionMatrix.makePerspective(Re,Xe,Le,Qe,Ie,Be)}function R(_,Z){Z===null?_.matrixWorld.copy(_.matrix):_.matrixWorld.multiplyMatrices(Z.matrixWorld,_.matrix),_.matrixWorldInverse.copy(_.matrixWorld).invert()}this.updateCamera=function(_){if(r===null)return;B.near=G.near=f.near=_.near,B.far=G.far=f.far=_.far,(M!==B.near||E!==B.far)&&(r.updateRenderState({depthNear:B.near,depthFar:B.far}),M=B.near,E=B.far);const Z=_.parent,T=B.cameras;R(B,Z);for(let K=0;K<T.length;K++)R(T[K],Z);B.matrixWorld.decompose(B.position,B.quaternion,B.scale),_.position.copy(B.position),_.quaternion.copy(B.quaternion),_.scale.copy(B.scale),_.matrix.copy(B.matrix),_.matrixWorld.copy(B.matrixWorld);const F=_.children;for(let K=0,j=F.length;K<j;K++)F[K].updateMatrixWorld(!0);T.length===2?S(B,f,G):B.projectionMatrix.copy(f.projectionMatrix)},this.getCamera=function(){return B},this.getFoveation=function(){if(g!==null)return g.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(_){g!==null&&(g.fixedFoveation=_),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=_)};let W=null;function H(_,Z){if(l=Z.getViewerPose(o),u=Z,l!==null){const F=l.views;d!==null&&(e.setRenderTargetFramebuffer(b,d.framebuffer),e.setRenderTarget(b));let K=!1;F.length!==B.cameras.length&&(B.cameras.length=0,K=!0);for(let j=0;j<F.length;j++){const O=F[j];let Y=null;if(d!==null)Y=d.getViewport(O);else{const ye=c.getViewSubImage(g,O);Y=ye.viewport,j===0&&(e.setRenderTargetTextures(b,ye.colorTexture,g.ignoreDepthValues?void 0:ye.depthStencilTexture),e.setRenderTarget(b))}const ee=x[j];ee.matrix.fromArray(O.transform.matrix),ee.projectionMatrix.fromArray(O.projectionMatrix),ee.viewport.set(Y.x,Y.y,Y.width,Y.height),j===0&&B.matrix.copy(ee.matrix),K===!0&&B.cameras.push(ee)}}const T=r.inputSources;for(let F=0;F<y.length;F++){const K=y[F],j=T[F];K.update(j,Z,o)}W&&W(_,Z),u=null}const k=new bL;k.setAnimationLoop(H),this.setAnimationLoop=function(_){W=_},this.dispose=function(){}}}function sae(i){function e(m,f){m.fogColor.value.copy(f.color),f.isFog?(m.fogNear.value=f.near,m.fogFar.value=f.far):f.isFogExp2&&(m.fogDensity.value=f.density)}function t(m,f,G,x,B){f.isMeshBasicMaterial?n(m,f):f.isMeshLambertMaterial?(n(m,f),l(m,f)):f.isMeshToonMaterial?(n(m,f),g(m,f)):f.isMeshPhongMaterial?(n(m,f),c(m,f)):f.isMeshStandardMaterial?(n(m,f),f.isMeshPhysicalMaterial?u(m,f,B):d(m,f)):f.isMeshMatcapMaterial?(n(m,f),h(m,f)):f.isMeshDepthMaterial?(n(m,f),p(m,f)):f.isMeshDistanceMaterial?(n(m,f),b(m,f)):f.isMeshNormalMaterial?(n(m,f),y(m,f)):f.isLineBasicMaterial?(r(m,f),f.isLineDashedMaterial&&s(m,f)):f.isPointsMaterial?o(m,f,G,x):f.isSpriteMaterial?a(m,f):f.isShadowMaterial?(m.color.value.copy(f.color),m.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function n(m,f){m.opacity.value=f.opacity,f.color&&m.diffuse.value.copy(f.color),f.emissive&&m.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.specularMap&&(m.specularMap.value=f.specularMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);const G=i.get(f).envMap;G&&(m.envMap.value=G,m.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=f.reflectivity,m.ior.value=f.ior,m.refractionRatio.value=f.refractionRatio),f.lightMap&&(m.lightMap.value=f.lightMap,m.lightMapIntensity.value=f.lightMapIntensity),f.aoMap&&(m.aoMap.value=f.aoMap,m.aoMapIntensity.value=f.aoMapIntensity);let x;f.map?x=f.map:f.specularMap?x=f.specularMap:f.displacementMap?x=f.displacementMap:f.normalMap?x=f.normalMap:f.bumpMap?x=f.bumpMap:f.roughnessMap?x=f.roughnessMap:f.metalnessMap?x=f.metalnessMap:f.alphaMap?x=f.alphaMap:f.emissiveMap?x=f.emissiveMap:f.clearcoatMap?x=f.clearcoatMap:f.clearcoatNormalMap?x=f.clearcoatNormalMap:f.clearcoatRoughnessMap?x=f.clearcoatRoughnessMap:f.specularIntensityMap?x=f.specularIntensityMap:f.specularColorMap?x=f.specularColorMap:f.transmissionMap?x=f.transmissionMap:f.thicknessMap?x=f.thicknessMap:f.sheenColorMap?x=f.sheenColorMap:f.sheenRoughnessMap&&(x=f.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix));let B;f.aoMap?B=f.aoMap:f.lightMap&&(B=f.lightMap),B!==void 0&&(B.isWebGLRenderTarget&&(B=B.texture),B.matrixAutoUpdate===!0&&B.updateMatrix(),m.uv2Transform.value.copy(B.matrix))}function r(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity}function s(m,f){m.dashSize.value=f.dashSize,m.totalSize.value=f.dashSize+f.gapSize,m.scale.value=f.scale}function o(m,f,G,x){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.size.value=f.size*G,m.scale.value=x*.5,f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);let B;f.map?B=f.map:f.alphaMap&&(B=f.alphaMap),B!==void 0&&(B.matrixAutoUpdate===!0&&B.updateMatrix(),m.uvTransform.value.copy(B.matrix))}function a(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.rotation.value=f.rotation,f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);let G;f.map?G=f.map:f.alphaMap&&(G=f.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),m.uvTransform.value.copy(G.matrix))}function l(m,f){f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap)}function c(m,f){m.specular.value.copy(f.specular),m.shininess.value=Math.max(f.shininess,1e-4),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===di&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===di&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function g(m,f){f.gradientMap&&(m.gradientMap.value=f.gradientMap),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===di&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===di&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function d(m,f){m.roughness.value=f.roughness,m.metalness.value=f.metalness,f.roughnessMap&&(m.roughnessMap.value=f.roughnessMap),f.metalnessMap&&(m.metalnessMap.value=f.metalnessMap),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===di&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===di&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),i.get(f).envMap&&(m.envMapIntensity.value=f.envMapIntensity)}function u(m,f,G){d(m,f),m.ior.value=f.ior,f.sheen>0&&(m.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),m.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(m.sheenColorMap.value=f.sheenColorMap),f.sheenRoughnessMap&&(m.sheenRoughnessMap.value=f.sheenRoughnessMap)),f.clearcoat>0&&(m.clearcoat.value=f.clearcoat,m.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(m.clearcoatMap.value=f.clearcoatMap),f.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap),f.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),m.clearcoatNormalMap.value=f.clearcoatNormalMap,f.side===di&&m.clearcoatNormalScale.value.negate())),f.transmission>0&&(m.transmission.value=f.transmission,m.transmissionSamplerMap.value=G.texture,m.transmissionSamplerSize.value.set(G.width,G.height),f.transmissionMap&&(m.transmissionMap.value=f.transmissionMap),m.thickness.value=f.thickness,f.thicknessMap&&(m.thicknessMap.value=f.thicknessMap),m.attenuationDistance.value=f.attenuationDistance,m.attenuationColor.value.copy(f.attenuationColor)),m.specularIntensity.value=f.specularIntensity,m.specularColor.value.copy(f.specularColor),f.specularIntensityMap&&(m.specularIntensityMap.value=f.specularIntensityMap),f.specularColorMap&&(m.specularColorMap.value=f.specularColorMap)}function h(m,f){f.matcap&&(m.matcap.value=f.matcap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===di&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===di&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function p(m,f){f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function b(m,f){f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),m.referencePosition.value.copy(f.referencePosition),m.nearDistance.value=f.nearDistance,m.farDistance.value=f.farDistance}function y(m,f){f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===di&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===di&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function oae(){const i=qC("canvas");return i.style.display="block",i}function An(i={}){const e=i.canvas!==void 0?i.canvas:oae(),t=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,r=i.stencil!==void 0?i.stencil:!0,s=i.antialias!==void 0?i.antialias:!1,o=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,a=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,l=i.powerPreference!==void 0?i.powerPreference:"default",c=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let g;i.context!==void 0?g=t.getContextAttributes().alpha:g=i.alpha!==void 0?i.alpha:!1;let d=null,u=null;const h=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ao,this.physicallyCorrectLights=!1,this.toneMapping=ra,this.toneMappingExposure=1;const b=this;let y=!1,m=0,f=0,G=null,x=-1,B=null;const M=new mn,E=new mn;let z=null,J=e.width,V=e.height,I=1,w=null,S=null;const R=new mn(0,0,J,V),W=new mn(0,0,J,V);let H=!1;const k=new ip;let _=!1,Z=!1,T=null;const F=new bt,K=new Ke,j=new te,O={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return G===null?I:1}let ee=t;function ye(P,$){for(let le=0;le<P.length;le++){const ae=P[le],xe=e.getContext(ae,$);if(xe!==null)return xe}return null}try{const P={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${_b}`),e.addEventListener("webglcontextlost",U,!1),e.addEventListener("webglcontextrestored",Fe,!1),ee===null){const $=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&$.shift(),ee=ye($,P),ee===null)throw ye($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ee.getShaderPrecisionFormat===void 0&&(ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(P){throw console.error("THREE.WebGLRenderer: "+P.message),P}let Ce,he,Ne,He,ne,de,Ie,Be,Re,Xe,Le,Qe,et,q,X,D,ge,Se,Me,pe,we,re,be;function _e(){Ce=new Gse(ee),he=new Ase(ee,Ce,i),Ce.init(he),re=new QL(ee,Ce,he),Ne=new tae(ee,Ce,he),He=new Zse(ee),ne=new Koe,de=new nae(ee,Ce,Ne,ne,he,re,He),Ie=new yse(b),Be=new wse(b),Re=new kne(ee,he),be=new pse(ee,Ce,Re,he),Xe=new Bse(ee,Re,He,be),Le=new _se(ee,Xe,Re,He),Me=new Wse(ee,he,de),D=new bse(ne),Qe=new Yoe(b,Ie,Be,Ce,he,be,D),et=new sae(ne),q=new Doe,X=new qoe(Ce,he),Se=new Cse(b,Ie,Ne,Le,g,o),ge=new JL(b,Le,he),pe=new mse(ee,Ce,He,he),we=new Sse(ee,Ce,He,he),He.programs=Qe.programs,b.capabilities=he,b.extensions=Ce,b.properties=ne,b.renderLists=q,b.shadowMap=ge,b.state=Ne,b.info=He}_e();const Ee=new rae(b,ee);this.xr=Ee,this.getContext=function(){return ee},this.getContextAttributes=function(){return ee.getContextAttributes()},this.forceContextLoss=function(){const P=Ce.get("WEBGL_lose_context");P&&P.loseContext()},this.forceContextRestore=function(){const P=Ce.get("WEBGL_lose_context");P&&P.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(P){P!==void 0&&(I=P,this.setSize(J,V,!1))},this.getSize=function(P){return P.set(J,V)},this.setSize=function(P,$,le){if(Ee.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}J=P,V=$,e.width=Math.floor(P*I),e.height=Math.floor($*I),le!==!1&&(e.style.width=P+"px",e.style.height=$+"px"),this.setViewport(0,0,P,$)},this.getDrawingBufferSize=function(P){return P.set(J*I,V*I).floor()},this.setDrawingBufferSize=function(P,$,le){J=P,V=$,I=le,e.width=Math.floor(P*le),e.height=Math.floor($*le),this.setViewport(0,0,P,$)},this.getCurrentViewport=function(P){return P.copy(M)},this.getViewport=function(P){return P.copy(R)},this.setViewport=function(P,$,le,ae){P.isVector4?R.set(P.x,P.y,P.z,P.w):R.set(P,$,le,ae),Ne.viewport(M.copy(R).multiplyScalar(I).floor())},this.getScissor=function(P){return P.copy(W)},this.setScissor=function(P,$,le,ae){P.isVector4?W.set(P.x,P.y,P.z,P.w):W.set(P,$,le,ae),Ne.scissor(E.copy(W).multiplyScalar(I).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(P){Ne.setScissorTest(H=P)},this.setOpaqueSort=function(P){w=P},this.setTransparentSort=function(P){S=P},this.getClearColor=function(P){return P.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor.apply(Se,arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha.apply(Se,arguments)},this.clear=function(P=!0,$=!0,le=!0){let ae=0;P&&(ae|=16384),$&&(ae|=256),le&&(ae|=1024),ee.clear(ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",U,!1),e.removeEventListener("webglcontextrestored",Fe,!1),q.dispose(),X.dispose(),ne.dispose(),Ie.dispose(),Be.dispose(),Le.dispose(),be.dispose(),Qe.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",ht),Ee.removeEventListener("sessionend",wt),T&&(T.dispose(),T=null),nt.stop()};function U(P){P.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function Fe(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const P=He.autoReset,$=ge.enabled,le=ge.autoUpdate,ae=ge.needsUpdate,xe=ge.type;_e(),He.autoReset=P,ge.enabled=$,ge.autoUpdate=le,ge.needsUpdate=ae,ge.type=xe}function Ze(P){const $=P.target;$.removeEventListener("dispose",Ze),Ye($)}function Ye(P){me(P),ne.remove(P)}function me(P){const $=ne.get(P).programs;$!==void 0&&($.forEach(function(le){Qe.releaseProgram(le)}),P.isShaderMaterial&&Qe.releaseShaderCache(P))}this.renderBufferDirect=function(P,$,le,ae,xe,Je){$===null&&($=O);const De=xe.isMesh&&xe.matrixWorld.determinant()<0,Ue=ln(P,$,le,ae,xe);Ne.setMaterial(ae,De);let st=le.index;const ut=le.attributes.position;if(st===null){if(ut===void 0||ut.count===0)return}else if(st.count===0)return;let ct=1;ae.wireframe===!0&&(st=Xe.getWireframeAttribute(le),ct=2),be.setup(xe,ae,Ue,le,st);let mt,Pt=pe;st!==null&&(mt=Re.get(st),Pt=we,Pt.setIndex(mt));const ei=st!==null?st.count:ut.count,Ht=le.drawRange.start*ct,Ln=le.drawRange.count*ct,kt=Je!==null?Je.start*ct:0,St=Je!==null?Je.count*ct:1/0,Yt=Math.max(Ht,kt),yt=Math.min(ei,Ht+Ln,kt+St)-1,sn=Math.max(0,yt-Yt+1);if(sn!==0){if(xe.isMesh)ae.wireframe===!0?(Ne.setLineWidth(ae.wireframeLinewidth*Y()),Pt.setMode(1)):Pt.setMode(4);else if(xe.isLine){let Ft=ae.linewidth;Ft===void 0&&(Ft=1),Ne.setLineWidth(Ft*Y()),xe.isLineSegments?Pt.setMode(1):xe.isLineLoop?Pt.setMode(2):Pt.setMode(3)}else xe.isPoints?Pt.setMode(0):xe.isSprite&&Pt.setMode(4);if(xe.isInstancedMesh)Pt.renderInstances(Yt,sn,xe.count);else if(le.isInstancedBufferGeometry){const Ft=Math.min(le.instanceCount,le._maxInstanceCount);Pt.renderInstances(Yt,sn,Ft)}else Pt.render(Yt,sn)}},this.compile=function(P,$){u=X.get(P),u.init(),p.push(u),P.traverseVisible(function(le){le.isLight&&le.layers.test($.layers)&&(u.pushLight(le),le.castShadow&&u.pushShadow(le))}),u.setupLights(b.physicallyCorrectLights),P.traverse(function(le){const ae=le.material;if(ae)if(Array.isArray(ae))for(let xe=0;xe<ae.length;xe++){const Je=ae[xe];qt(Je,P,le)}else qt(ae,P,le)}),p.pop(),u=null};let Ge=null;function Pe(P){Ge&&Ge(P)}function ht(){nt.stop()}function wt(){nt.start()}const nt=new bL;nt.setAnimationLoop(Pe),typeof window!="undefined"&&nt.setContext(window),this.setAnimationLoop=function(P){Ge=P,Ee.setAnimationLoop(P),P===null?nt.stop():nt.start()},Ee.addEventListener("sessionstart",ht),Ee.addEventListener("sessionend",wt),this.render=function(P,$){if($!==void 0&&$.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;P.autoUpdate===!0&&P.updateMatrixWorld(),$.parent===null&&$.updateMatrixWorld(),Ee.enabled===!0&&Ee.isPresenting===!0&&(Ee.cameraAutoUpdate===!0&&Ee.updateCamera($),$=Ee.getCamera()),P.isScene===!0&&P.onBeforeRender(b,P,$,G),u=X.get(P,p.length),u.init(),p.push(u),F.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),k.setFromProjectionMatrix(F),Z=this.localClippingEnabled,_=D.init(this.clippingPlanes,Z,$),d=q.get(P,h.length),d.init(),h.push(d),un(P,$,0,b.sortObjects),d.finish(),b.sortObjects===!0&&d.sort(w,S),_===!0&&D.beginShadows();const le=u.state.shadowsArray;if(ge.render(le,P,$),_===!0&&D.endShadows(),this.info.autoReset===!0&&this.info.reset(),Se.render(d,P),u.setupLights(b.physicallyCorrectLights),$.isArrayCamera){const ae=$.cameras;for(let xe=0,Je=ae.length;xe<Je;xe++){const De=ae[xe];Et(d,P,De,De.viewport)}}else Et(d,P,$);G!==null&&(de.updateMultisampleRenderTarget(G),de.updateRenderTargetMipmap(G)),P.isScene===!0&&P.onAfterRender(b,P,$),be.resetDefaultState(),x=-1,B=null,p.pop(),p.length>0?u=p[p.length-1]:u=null,h.pop(),h.length>0?d=h[h.length-1]:d=null};function un(P,$,le,ae){if(P.visible===!1)return;if(P.layers.test($.layers)){if(P.isGroup)le=P.renderOrder;else if(P.isLOD)P.autoUpdate===!0&&P.update($);else if(P.isLight)u.pushLight(P),P.castShadow&&u.pushShadow(P);else if(P.isSprite){if(!P.frustumCulled||k.intersectsSprite(P)){ae&&j.setFromMatrixPosition(P.matrixWorld).applyMatrix4(F);const De=Le.update(P),Ue=P.material;Ue.visible&&d.push(P,De,Ue,le,j.z,null)}}else if((P.isMesh||P.isLine||P.isPoints)&&(P.isSkinnedMesh&&P.skeleton.frame!==He.render.frame&&(P.skeleton.update(),P.skeleton.frame=He.render.frame),!P.frustumCulled||k.intersectsObject(P))){ae&&j.setFromMatrixPosition(P.matrixWorld).applyMatrix4(F);const De=Le.update(P),Ue=P.material;if(Array.isArray(Ue)){const st=De.groups;for(let ut=0,ct=st.length;ut<ct;ut++){const mt=st[ut],Pt=Ue[mt.materialIndex];Pt&&Pt.visible&&d.push(P,De,Pt,le,j.z,mt)}}else Ue.visible&&d.push(P,De,Ue,le,j.z,null)}}const Je=P.children;for(let De=0,Ue=Je.length;De<Ue;De++)un(Je[De],$,le,ae)}function Et(P,$,le,ae){const xe=P.opaque,Je=P.transmissive,De=P.transparent;u.setupLightsView(le),Je.length>0&&Jt(xe,$,le),ae&&Ne.viewport(M.copy(ae)),xe.length>0&&sr(xe,$,le),Je.length>0&&sr(Je,$,le),De.length>0&&sr(De,$,le),Ne.buffers.depth.setTest(!0),Ne.buffers.depth.setMask(!0),Ne.buffers.color.setMask(!0),Ne.setPolygonOffset(!1)}function Jt(P,$,le){const ae=he.isWebGL2;T===null&&(T=new Hr(1,1,{generateMipmaps:!0,type:re.convert(zg)!==null?zg:Ic,minFilter:Xg,samples:ae&&s===!0?4:0})),b.getDrawingBufferSize(K),ae?T.setSize(K.x,K.y):T.setSize(Db(K.x),Db(K.y));const xe=b.getRenderTarget();b.setRenderTarget(T),b.clear();const Je=b.toneMapping;b.toneMapping=ra,sr(P,$,le),b.toneMapping=Je,de.updateMultisampleRenderTarget(T),de.updateRenderTargetMipmap(T),b.setRenderTarget(xe)}function sr(P,$,le){const ae=$.isScene===!0?$.overrideMaterial:null;for(let xe=0,Je=P.length;xe<Je;xe++){const De=P[xe],Ue=De.object,st=De.geometry,ut=ae===null?De.material:ae,ct=De.group;Ue.layers.test(le.layers)&&en(Ue,$,le,st,ut,ct)}}function en(P,$,le,ae,xe,Je){P.onBeforeRender(b,$,le,ae,xe,Je),P.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,P.matrixWorld),P.normalMatrix.getNormalMatrix(P.modelViewMatrix),xe.onBeforeRender(b,$,le,ae,P,Je),xe.transparent===!0&&xe.side===Fg?(xe.side=di,xe.needsUpdate=!0,b.renderBufferDirect(le,$,ae,xe,P,Je),xe.side=Hg,xe.needsUpdate=!0,b.renderBufferDirect(le,$,ae,xe,P,Je),xe.side=Fg):b.renderBufferDirect(le,$,ae,xe,P,Je),P.onAfterRender(b,$,le,ae,xe,Je)}function qt(P,$,le){$.isScene!==!0&&($=O);const ae=ne.get(P),xe=u.state.lights,Je=u.state.shadowsArray,De=xe.state.version,Ue=Qe.getParameters(P,xe.state,Je,$,le),st=Qe.getProgramCacheKey(Ue);let ut=ae.programs;ae.environment=P.isMeshStandardMaterial?$.environment:null,ae.fog=$.fog,ae.envMap=(P.isMeshStandardMaterial?Be:Ie).get(P.envMap||ae.environment),ut===void 0&&(P.addEventListener("dispose",Ze),ut=new Map,ae.programs=ut);let ct=ut.get(st);if(ct!==void 0){if(ae.currentProgram===ct&&ae.lightsStateVersion===De)return Yr(P,Ue),ct}else Ue.uniforms=Qe.getUniforms(P),P.onBuild(le,Ue,b),P.onBeforeCompile(Ue,b),ct=Qe.acquireProgram(Ue,st),ut.set(st,ct),ae.uniforms=Ue.uniforms;const mt=ae.uniforms;(!P.isShaderMaterial&&!P.isRawShaderMaterial||P.clipping===!0)&&(mt.clippingPlanes=D.uniform),Yr(P,Ue),ae.needsLights=ie(P),ae.lightsStateVersion=De,ae.needsLights&&(mt.ambientLightColor.value=xe.state.ambient,mt.lightProbe.value=xe.state.probe,mt.directionalLights.value=xe.state.directional,mt.directionalLightShadows.value=xe.state.directionalShadow,mt.spotLights.value=xe.state.spot,mt.spotLightShadows.value=xe.state.spotShadow,mt.rectAreaLights.value=xe.state.rectArea,mt.ltc_1.value=xe.state.rectAreaLTC1,mt.ltc_2.value=xe.state.rectAreaLTC2,mt.pointLights.value=xe.state.point,mt.pointLightShadows.value=xe.state.pointShadow,mt.hemisphereLights.value=xe.state.hemi,mt.directionalShadowMap.value=xe.state.directionalShadowMap,mt.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,mt.spotShadowMap.value=xe.state.spotShadowMap,mt.spotShadowMatrix.value=xe.state.spotShadowMatrix,mt.pointShadowMap.value=xe.state.pointShadowMap,mt.pointShadowMatrix.value=xe.state.pointShadowMatrix);const Pt=ct.getUniforms(),ei=Zc.seqWithValue(Pt.seq,mt);return ae.currentProgram=ct,ae.uniformsList=ei,ct}function Yr(P,$){const le=ne.get(P);le.outputEncoding=$.outputEncoding,le.instancing=$.instancing,le.skinning=$.skinning,le.morphTargets=$.morphTargets,le.morphNormals=$.morphNormals,le.morphColors=$.morphColors,le.morphTargetsCount=$.morphTargetsCount,le.numClippingPlanes=$.numClippingPlanes,le.numIntersection=$.numClipIntersection,le.vertexAlphas=$.vertexAlphas,le.vertexTangents=$.vertexTangents,le.toneMapping=$.toneMapping}function ln(P,$,le,ae,xe){$.isScene!==!0&&($=O),de.resetTextureUnits();const Je=$.fog,De=ae.isMeshStandardMaterial?$.environment:null,Ue=G===null?b.outputEncoding:G.isXRRenderTarget===!0?G.texture.encoding:Ao,st=(ae.isMeshStandardMaterial?Be:Ie).get(ae.envMap||De),ut=ae.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,ct=!!ae.normalMap&&!!le.attributes.tangent,mt=!!le.morphAttributes.position,Pt=!!le.morphAttributes.normal,ei=!!le.morphAttributes.color,Ht=ae.toneMapped?b.toneMapping:ra,Ln=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,kt=Ln!==void 0?Ln.length:0,St=ne.get(ae),Yt=u.state.lights;if(_===!0&&(Z===!0||P!==B)){const Kr=P===B&&ae.id===x;D.setState(ae,P,Kr)}let yt=!1;ae.version===St.__version?(St.needsLights&&St.lightsStateVersion!==Yt.state.version||St.outputEncoding!==Ue||xe.isInstancedMesh&&St.instancing===!1||!xe.isInstancedMesh&&St.instancing===!0||xe.isSkinnedMesh&&St.skinning===!1||!xe.isSkinnedMesh&&St.skinning===!0||St.envMap!==st||ae.fog&&St.fog!==Je||St.numClippingPlanes!==void 0&&(St.numClippingPlanes!==D.numPlanes||St.numIntersection!==D.numIntersection)||St.vertexAlphas!==ut||St.vertexTangents!==ct||St.morphTargets!==mt||St.morphNormals!==Pt||St.morphColors!==ei||St.toneMapping!==Ht||he.isWebGL2===!0&&St.morphTargetsCount!==kt)&&(yt=!0):(yt=!0,St.__version=ae.version);let sn=St.currentProgram;yt===!0&&(sn=qt(ae,$,xe));let Ft=!1,In=!1,Bn=!1;const Sn=sn.getUniforms(),Yn=St.uniforms;if(Ne.useProgram(sn.program)&&(Ft=!0,In=!0,Bn=!0),ae.id!==x&&(x=ae.id,In=!0),Ft||B!==P){if(Sn.setValue(ee,"projectionMatrix",P.projectionMatrix),he.logarithmicDepthBuffer&&Sn.setValue(ee,"logDepthBufFC",2/(Math.log(P.far+1)/Math.LN2)),B!==P&&(B=P,In=!0,Bn=!0),ae.isShaderMaterial||ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshStandardMaterial||ae.envMap){const Kr=Sn.map.cameraPosition;Kr!==void 0&&Kr.setValue(ee,j.setFromMatrixPosition(P.matrixWorld))}(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial)&&Sn.setValue(ee,"isOrthographic",P.isOrthographicCamera===!0),(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial||ae.isShadowMaterial||xe.isSkinnedMesh)&&Sn.setValue(ee,"viewMatrix",P.matrixWorldInverse)}if(xe.isSkinnedMesh){Sn.setOptional(ee,xe,"bindMatrix"),Sn.setOptional(ee,xe,"bindMatrixInverse");const Kr=xe.skeleton;Kr&&(he.floatVertexTextures?(Kr.boneTexture===null&&Kr.computeBoneTexture(),Sn.setValue(ee,"boneTexture",Kr.boneTexture,de),Sn.setValue(ee,"boneTextureSize",Kr.boneTextureSize)):Sn.setOptional(ee,Kr,"boneMatrices"))}const Rs=le.morphAttributes;return(Rs.position!==void 0||Rs.normal!==void 0||Rs.color!==void 0&&he.isWebGL2===!0)&&Me.update(xe,le,ae,sn),(In||St.receiveShadow!==xe.receiveShadow)&&(St.receiveShadow=xe.receiveShadow,Sn.setValue(ee,"receiveShadow",xe.receiveShadow)),In&&(Sn.setValue(ee,"toneMappingExposure",b.toneMappingExposure),St.needsLights&&cn(Yn,Bn),Je&&ae.fog&&et.refreshFogUniforms(Yn,Je),et.refreshMaterialUniforms(Yn,ae,I,V,T),Zc.upload(ee,St.uniformsList,Yn,de)),ae.isShaderMaterial&&ae.uniformsNeedUpdate===!0&&(Zc.upload(ee,St.uniformsList,Yn,de),ae.uniformsNeedUpdate=!1),ae.isSpriteMaterial&&Sn.setValue(ee,"center",xe.center),Sn.setValue(ee,"modelViewMatrix",xe.modelViewMatrix),Sn.setValue(ee,"normalMatrix",xe.normalMatrix),Sn.setValue(ee,"modelMatrix",xe.matrixWorld),sn}function cn(P,$){P.ambientLightColor.needsUpdate=$,P.lightProbe.needsUpdate=$,P.directionalLights.needsUpdate=$,P.directionalLightShadows.needsUpdate=$,P.pointLights.needsUpdate=$,P.pointLightShadows.needsUpdate=$,P.spotLights.needsUpdate=$,P.spotLightShadows.needsUpdate=$,P.rectAreaLights.needsUpdate=$,P.hemisphereLights.needsUpdate=$}function ie(P){return P.isMeshLambertMaterial||P.isMeshToonMaterial||P.isMeshPhongMaterial||P.isMeshStandardMaterial||P.isShadowMaterial||P.isShaderMaterial&&P.lights===!0}this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return f},this.getRenderTarget=function(){return G},this.setRenderTargetTextures=function(P,$,le){ne.get(P.texture).__webglTexture=$,ne.get(P.depthTexture).__webglTexture=le;const ae=ne.get(P);ae.__hasExternalTextures=!0,ae.__hasExternalTextures&&(ae.__autoAllocateDepthBuffer=le===void 0,ae.__autoAllocateDepthBuffer||Ce.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ae.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(P,$){const le=ne.get(P);le.__webglFramebuffer=$,le.__useDefaultFramebuffer=$===void 0},this.setRenderTarget=function(P,$=0,le=0){G=P,m=$,f=le;let ae=!0;if(P){const st=ne.get(P);st.__useDefaultFramebuffer!==void 0?(Ne.bindFramebuffer(36160,null),ae=!1):st.__webglFramebuffer===void 0?de.setupRenderTarget(P):st.__hasExternalTextures&&de.rebindTextures(P,ne.get(P.texture).__webglTexture,ne.get(P.depthTexture).__webglTexture)}let xe=null,Je=!1,De=!1;if(P){const st=P.texture;(st.isData3DTexture||st.isDataArrayTexture)&&(De=!0);const ut=ne.get(P).__webglFramebuffer;P.isWebGLCubeRenderTarget?(xe=ut[$],Je=!0):he.isWebGL2&&P.samples>0&&de.useMultisampledRTT(P)===!1?xe=ne.get(P).__webglMultisampledFramebuffer:xe=ut,M.copy(P.viewport),E.copy(P.scissor),z=P.scissorTest}else M.copy(R).multiplyScalar(I).floor(),E.copy(W).multiplyScalar(I).floor(),z=H;if(Ne.bindFramebuffer(36160,xe)&&he.drawBuffers&&ae&&Ne.drawBuffers(P,xe),Ne.viewport(M),Ne.scissor(E),Ne.setScissorTest(z),Je){const st=ne.get(P.texture);ee.framebufferTexture2D(36160,36064,34069+$,st.__webglTexture,le)}else if(De){const st=ne.get(P.texture),ut=$||0;ee.framebufferTextureLayer(36160,36064,st.__webglTexture,le||0,ut)}x=-1},this.readRenderTargetPixels=function(P,$,le,ae,xe,Je,De){if(!(P&&P.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ue=ne.get(P).__webglFramebuffer;if(P.isWebGLCubeRenderTarget&&De!==void 0&&(Ue=Ue[De]),Ue){Ne.bindFramebuffer(36160,Ue);try{const st=P.texture,ut=st.format,ct=st.type;if(ut!==Ar&&re.convert(ut)!==ee.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const mt=ct===zg&&(Ce.has("EXT_color_buffer_half_float")||he.isWebGL2&&Ce.has("EXT_color_buffer_float"));if(ct!==Ic&&re.convert(ct)!==ee.getParameter(35738)&&!(ct===Oa&&(he.isWebGL2||Ce.has("OES_texture_float")||Ce.has("WEBGL_color_buffer_float")))&&!mt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ee.checkFramebufferStatus(36160)===36053?$>=0&&$<=P.width-ae&&le>=0&&le<=P.height-xe&&ee.readPixels($,le,ae,xe,re.convert(ut),re.convert(ct),Je):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const st=G!==null?ne.get(G).__webglFramebuffer:null;Ne.bindFramebuffer(36160,st)}}},this.copyFramebufferToTexture=function(P,$,le=0){if($.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const ae=Math.pow(2,-le),xe=Math.floor($.image.width*ae),Je=Math.floor($.image.height*ae);de.setTexture2D($,0),ee.copyTexSubImage2D(3553,le,0,0,P.x,P.y,xe,Je),Ne.unbindTexture()},this.copyTextureToTexture=function(P,$,le,ae=0){const xe=$.image.width,Je=$.image.height,De=re.convert(le.format),Ue=re.convert(le.type);de.setTexture2D(le,0),ee.pixelStorei(37440,le.flipY),ee.pixelStorei(37441,le.premultiplyAlpha),ee.pixelStorei(3317,le.unpackAlignment),$.isDataTexture?ee.texSubImage2D(3553,ae,P.x,P.y,xe,Je,De,Ue,$.image.data):$.isCompressedTexture?ee.compressedTexSubImage2D(3553,ae,P.x,P.y,$.mipmaps[0].width,$.mipmaps[0].height,De,$.mipmaps[0].data):ee.texSubImage2D(3553,ae,P.x,P.y,De,Ue,$.image),ae===0&&le.generateMipmaps&&ee.generateMipmap(3553),Ne.unbindTexture()},this.copyTextureToTexture3D=function(P,$,le,ae,xe=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Je=P.max.x-P.min.x+1,De=P.max.y-P.min.y+1,Ue=P.max.z-P.min.z+1,st=re.convert(ae.format),ut=re.convert(ae.type);let ct;if(ae.isData3DTexture)de.setTexture3D(ae,0),ct=32879;else if(ae.isDataArrayTexture)de.setTexture2DArray(ae,0),ct=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ee.pixelStorei(37440,ae.flipY),ee.pixelStorei(37441,ae.premultiplyAlpha),ee.pixelStorei(3317,ae.unpackAlignment);const mt=ee.getParameter(3314),Pt=ee.getParameter(32878),ei=ee.getParameter(3316),Ht=ee.getParameter(3315),Ln=ee.getParameter(32877),kt=le.isCompressedTexture?le.mipmaps[0]:le.image;ee.pixelStorei(3314,kt.width),ee.pixelStorei(32878,kt.height),ee.pixelStorei(3316,P.min.x),ee.pixelStorei(3315,P.min.y),ee.pixelStorei(32877,P.min.z),le.isDataTexture||le.isData3DTexture?ee.texSubImage3D(ct,xe,$.x,$.y,$.z,Je,De,Ue,st,ut,kt.data):le.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ee.compressedTexSubImage3D(ct,xe,$.x,$.y,$.z,Je,De,Ue,st,kt.data)):ee.texSubImage3D(ct,xe,$.x,$.y,$.z,Je,De,Ue,st,ut,kt),ee.pixelStorei(3314,mt),ee.pixelStorei(32878,Pt),ee.pixelStorei(3316,ei),ee.pixelStorei(3315,Ht),ee.pixelStorei(32877,Ln),xe===0&&ae.generateMipmaps&&ee.generateMipmap(ct),Ne.unbindTexture()},this.initTexture=function(P){de.setTexture2D(P,0),Ne.unbindTexture()},this.resetState=function(){m=0,f=0,G=null,Ne.reset(),be.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}An.prototype.isWebGLRenderer=!0;class jL extends An{}jL.prototype.isWebGL1Renderer=!0;class sp{constructor(e,t=25e-5){this.name="",this.color=new lt(e),this.density=t}clone(){return new sp(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}sp.prototype.isFogExp2=!0;class op{constructor(e,t=1,n=1e3){this.name="",this.color=new lt(e),this.near=t,this.far=n}clone(){return new op(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}op.prototype.isFog=!0;class ap extends Ut{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}ap.prototype.isScene=!0;class iu{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=th,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=bs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}iu.prototype.isInterleavedBuffer=!0;const Ci=new te;class Rc{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Ci.x=this.getX(t),Ci.y=this.getY(t),Ci.z=this.getZ(t),Ci.applyMatrix4(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ci.x=this.getX(t),Ci.y=this.getY(t),Ci.z=this.getZ(t),Ci.applyNormalMatrix(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ci.x=this.getX(t),Ci.y=this.getY(t),Ci.z=this.getZ(t),Ci.transformDirection(e),this.setXYZ(t,Ci.x,Ci.y,Ci.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new rn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Rc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Rc.prototype.isInterleavedBufferAttribute=!0;class Ay extends Ii{constructor(e){super();this.type="SpriteMaterial",this.color=new lt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}Ay.prototype.isSpriteMaterial=!0;let Bh;const lp=new te,Sh=new te,Zh=new te,Rh=new Ke,cp=new Ke,qL=new bt,by=new te,gp=new te,yy=new te,$L=new Ke,PS=new Ke,eT=new Ke;class vy extends Ut{constructor(e){super();if(this.type="Sprite",Bh===void 0){Bh=new Nt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new iu(t,5);Bh.setIndex([0,1,2,0,2,3]),Bh.setAttribute("position",new Rc(n,3,0,!1)),Bh.setAttribute("uv",new Rc(n,2,3,!1))}this.geometry=Bh,this.material=e!==void 0?e:new Ay,this.center=new Ke(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sh.setFromMatrixScale(this.matrixWorld),qL.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Zh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Sh.multiplyScalar(-Zh.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;xy(by.set(-.5,-.5,0),Zh,o,Sh,r,s),xy(gp.set(.5,-.5,0),Zh,o,Sh,r,s),xy(yy.set(.5,.5,0),Zh,o,Sh,r,s),$L.set(0,0),PS.set(1,0),eT.set(1,1);let a=e.ray.intersectTriangle(by,gp,yy,!1,lp);if(a===null&&(xy(gp.set(-.5,.5,0),Zh,o,Sh,r,s),PS.set(0,1),a=e.ray.intersectTriangle(by,yy,gp,!1,lp),a===null))return;const l=e.ray.origin.distanceTo(lp);l<e.near||l>e.far||t.push({distance:l,point:lp.clone(),uv:fi.getUV(lp,by,gp,yy,$L,PS,eT,new Ke),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}vy.prototype.isSprite=!0;function xy(i,e,t,n,r,s){Rh.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(cp.x=s*Rh.x-r*Rh.y,cp.y=r*Rh.x+s*Rh.y):cp.copy(Rh),i.copy(e),i.x+=cp.x,i.y+=cp.y,i.applyMatrix4(qL)}const wy=new te,tT=new te;class nT extends Ut{constructor(){super();this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){wy.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(wy);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){wy.setFromMatrixPosition(e.matrixWorld),tT.setFromMatrixPosition(this.matrixWorld);const n=wy.distanceTo(tT)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}const iT=new te,rT=new mn,sT=new mn,aae=new te,oT=new bt;class Gy extends yi{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new bt,this.bindMatrixInverse=new bt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new mn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;rT.fromBufferAttribute(r.attributes.skinIndex,e),sT.fromBufferAttribute(r.attributes.skinWeight,e),iT.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=sT.getComponent(s);if(o!==0){const a=rT.getComponent(s);oT.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(aae.copy(iT).applyMatrix4(oT),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}Gy.prototype.isSkinnedMesh=!0;class By extends Ut{constructor(){super();this.type="Bone"}}By.prototype.isBone=!0;class ru extends hi{constructor(e=null,t=1,n=1,r,s,o,a,l,c=bi,g=bi,d,u){super(null,o,a,l,c,g,r,s,d,u);this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}ru.prototype.isDataTexture=!0;const aT=new bt,lae=new bt;class Sy{constructor(e=[],t=[]){this.uuid=bs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new bt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new bt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:lae;aT.multiplyMatrices(a,t[s]),aT.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new Sy(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=OF(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ru(t,e,e,Ar,Oa);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new By),this.bones.push(o),this.boneInverses.push(new bt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class su extends rn{constructor(e,t,n,r=1){typeof n=="number"&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}su.prototype.isInstancedBufferAttribute=!0;const lT=new bt,cT=new bt,Zy=[],up=new yi;class DS extends yi{constructor(e,t,n){super(e,t);this.instanceMatrix=new su(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(up.geometry=this.geometry,up.material=this.material,up.material!==void 0)for(let s=0;s<r;s++){this.getMatrixAt(s,lT),cT.multiplyMatrices(n,lT),up.matrixWorld=cT,up.raycast(e,Zy);for(let o=0,a=Zy.length;o<a;o++){const l=Zy[o];l.instanceId=s,l.object=this,t.push(l)}Zy.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new su(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}DS.prototype.isInstancedMesh=!0;class Ti extends Ii{constructor(e){super();this.type="LineBasicMaterial",this.color=new lt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ti.prototype.isLineBasicMaterial=!0;const gT=new te,uT=new te,dT=new bt,US=new vc,Ry=new bc;class il extends Ut{constructor(e=new Nt,t=new Ti){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)gT.fromBufferAttribute(t,r-1),uT.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=gT.distanceTo(uT);e.setAttribute("lineDistance",new At(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ry.copy(n.boundingSphere),Ry.applyMatrix4(r),Ry.radius+=s,e.ray.intersectsSphere(Ry)===!1)return;dT.copy(r).invert(),US.copy(e.ray).applyMatrix4(dT);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new te,g=new te,d=new te,u=new te,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const p=n.index,y=n.attributes.position;if(p!==null){const m=Math.max(0,o.start),f=Math.min(p.count,o.start+o.count);for(let G=m,x=f-1;G<x;G+=h){const B=p.getX(G),M=p.getX(G+1);if(c.fromBufferAttribute(y,B),g.fromBufferAttribute(y,M),US.distanceSqToSegment(c,g,u,d)>l)continue;u.applyMatrix4(this.matrixWorld);const z=e.ray.origin.distanceTo(u);z<e.near||z>e.far||t.push({distance:z,point:d.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,o.start),f=Math.min(y.count,o.start+o.count);for(let G=m,x=f-1;G<x;G+=h){if(c.fromBufferAttribute(y,G),g.fromBufferAttribute(y,G+1),US.distanceSqToSegment(c,g,u,d)>l)continue;u.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(u);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}il.prototype.isLine=!0;const hT=new te,fT=new te;class os extends il{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)hT.fromBufferAttribute(t,r),fT.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+hT.distanceTo(fT);e.setAttribute("lineDistance",new At(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}os.prototype.isLineSegments=!0;class OS extends il{constructor(e,t){super(e,t);this.type="LineLoop"}}OS.prototype.isLineLoop=!0;class ou extends Ii{constructor(e){super();this.type="PointsMaterial",this.color=new lt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ou.prototype.isPointsMaterial=!0;const IT=new bt,JS=new vc,My=new bc,Wy=new te;class dp extends Ut{constructor(e=new Nt,t=new ou){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),My.copy(n.boundingSphere),My.applyMatrix4(r),My.radius+=s,e.ray.intersectsSphere(My)===!1)return;IT.copy(r).invert(),JS.copy(e.ray).applyMatrix4(IT);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(n.isBufferGeometry){const c=n.index,d=n.attributes.position;if(c!==null){const u=Math.max(0,o.start),h=Math.min(c.count,o.start+o.count);for(let p=u,b=h;p<b;p++){const y=c.getX(p);Wy.fromBufferAttribute(d,y),CT(Wy,y,l,r,e,t,this)}}else{const u=Math.max(0,o.start),h=Math.min(d.count,o.start+o.count);for(let p=u,b=h;p<b;p++)Wy.fromBufferAttribute(d,p),CT(Wy,p,l,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}dp.prototype.isPoints=!0;function CT(i,e,t,n,r,s,o){const a=JS.distanceSqToPoint(i);if(a<t){const l=new te;JS.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class pT extends hi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c);this.minFilter=o!==void 0?o:jn,this.magFilter=s!==void 0?s:jn,this.generateMipmaps=!1;const g=this;function d(){g.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}pT.prototype.isVideoTexture=!0;class mT extends hi{constructor(e,t,n){super({width:e,height:t});this.format=n,this.magFilter=bi,this.minFilter=bi,this.generateMipmaps=!1,this.needsUpdate=!0}}mT.prototype.isFramebufferTexture=!0;class QS extends hi{constructor(e,t,n,r,s,o,a,l,c,g,d,u){super(null,o,a,l,c,g,r,s,d,u);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}QS.prototype.isCompressedTexture=!0;class AT extends hi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c);this.needsUpdate=!0}}AT.prototype.isCanvasTexture=!0;class Mh extends Nt{constructor(e=1,t=8,n=0,r=Math.PI*2){super();this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new te,g=new Ke;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,u=3;d<=t;d++,u+=3){const h=n+d/t*r;c.x=e*Math.cos(h),c.y=e*Math.sin(h),o.push(c.x,c.y,c.z),a.push(0,0,1),g.x=(o[u]/e+1)/2,g.y=(o[u+1]/e+1)/2,l.push(g.x,g.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new At(o,3)),this.setAttribute("normal",new At(a,3)),this.setAttribute("uv",new At(l,2))}static fromJSON(e){return new Mh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Mc extends Nt{constructor(e=1,t=1,n=1,r=8,s=1,o=!1,a=0,l=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const g=[],d=[],u=[],h=[];let p=0;const b=[],y=n/2;let m=0;f(),o===!1&&(e>0&&G(!0),t>0&&G(!1)),this.setIndex(g),this.setAttribute("position",new At(d,3)),this.setAttribute("normal",new At(u,3)),this.setAttribute("uv",new At(h,2));function f(){const x=new te,B=new te;let M=0;const E=(t-e)/n;for(let z=0;z<=s;z++){const J=[],V=z/s,I=V*(t-e)+e;for(let w=0;w<=r;w++){const S=w/r,R=S*l+a,W=Math.sin(R),H=Math.cos(R);B.x=I*W,B.y=-V*n+y,B.z=I*H,d.push(B.x,B.y,B.z),x.set(W,E,H).normalize(),u.push(x.x,x.y,x.z),h.push(S,1-V),J.push(p++)}b.push(J)}for(let z=0;z<r;z++)for(let J=0;J<s;J++){const V=b[J][z],I=b[J+1][z],w=b[J+1][z+1],S=b[J][z+1];g.push(V,I,S),g.push(I,w,S),M+=6}c.addGroup(m,M,0),m+=M}function G(x){const B=p,M=new Ke,E=new te;let z=0;const J=x===!0?e:t,V=x===!0?1:-1;for(let w=1;w<=r;w++)d.push(0,y*V,0),u.push(0,V,0),h.push(.5,.5),p++;const I=p;for(let w=0;w<=r;w++){const R=w/r*l+a,W=Math.cos(R),H=Math.sin(R);E.x=J*H,E.y=y*V,E.z=J*W,d.push(E.x,E.y,E.z),u.push(0,V,0),M.x=W*.5+.5,M.y=H*.5*V+.5,h.push(M.x,M.y),p++}for(let w=0;w<r;w++){const S=B+w,R=I+w;x===!0?g.push(R,R+1,S):g.push(R+1,R,S),z+=3}c.addGroup(m,z,x===!0?1:2),m+=z}}static fromJSON(e){return new Mc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wh extends Mc{constructor(e=1,t=1,n=8,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Wh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oa extends Nt{constructor(e=[],t=[],n=1,r=0){super();this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),g(),this.setAttribute("position",new At(s,3)),this.setAttribute("normal",new At(s.slice(),3)),this.setAttribute("uv",new At(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(f){const G=new te,x=new te,B=new te;for(let M=0;M<t.length;M+=3)h(t[M+0],G),h(t[M+1],x),h(t[M+2],B),l(G,x,B,f)}function l(f,G,x,B){const M=B+1,E=[];for(let z=0;z<=M;z++){E[z]=[];const J=f.clone().lerp(x,z/M),V=G.clone().lerp(x,z/M),I=M-z;for(let w=0;w<=I;w++)w===0&&z===M?E[z][w]=J:E[z][w]=J.clone().lerp(V,w/I)}for(let z=0;z<M;z++)for(let J=0;J<2*(M-z)-1;J++){const V=Math.floor(J/2);J%2==0?(u(E[z][V+1]),u(E[z+1][V]),u(E[z][V])):(u(E[z][V+1]),u(E[z+1][V+1]),u(E[z+1][V]))}}function c(f){const G=new te;for(let x=0;x<s.length;x+=3)G.x=s[x+0],G.y=s[x+1],G.z=s[x+2],G.normalize().multiplyScalar(f),s[x+0]=G.x,s[x+1]=G.y,s[x+2]=G.z}function g(){const f=new te;for(let G=0;G<s.length;G+=3){f.x=s[G+0],f.y=s[G+1],f.z=s[G+2];const x=y(f)/2/Math.PI+.5,B=m(f)/Math.PI+.5;o.push(x,1-B)}p(),d()}function d(){for(let f=0;f<o.length;f+=6){const G=o[f+0],x=o[f+2],B=o[f+4],M=Math.max(G,x,B),E=Math.min(G,x,B);M>.9&&E<.1&&(G<.2&&(o[f+0]+=1),x<.2&&(o[f+2]+=1),B<.2&&(o[f+4]+=1))}}function u(f){s.push(f.x,f.y,f.z)}function h(f,G){const x=f*3;G.x=e[x+0],G.y=e[x+1],G.z=e[x+2]}function p(){const f=new te,G=new te,x=new te,B=new te,M=new Ke,E=new Ke,z=new Ke;for(let J=0,V=0;J<s.length;J+=9,V+=6){f.set(s[J+0],s[J+1],s[J+2]),G.set(s[J+3],s[J+4],s[J+5]),x.set(s[J+6],s[J+7],s[J+8]),M.set(o[V+0],o[V+1]),E.set(o[V+2],o[V+3]),z.set(o[V+4],o[V+5]),B.copy(f).add(G).add(x).divideScalar(3);const I=y(B);b(M,V+0,f,I),b(E,V+2,G,I),b(z,V+4,x,I)}}function b(f,G,x,B){B<0&&f.x===1&&(o[G]=f.x-1),x.x===0&&x.z===0&&(o[G]=B/2/Math.PI+.5)}function y(f){return Math.atan2(f.z,-f.x)}function m(f){return Math.atan2(-f.y,Math.sqrt(f.x*f.x+f.z*f.z))}}static fromJSON(e){return new oa(e.vertices,e.indices,e.radius,e.details)}}class _h extends oa{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t);this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _h(e.radius,e.detail)}}const _y=new te,Vy=new te,jS=new te,Ny=new fi;class qS extends Nt{constructor(e=null,t=1){super();if(this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Ug*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],g=["a","b","c"],d=new Array(3),u={},h=[];for(let p=0;p<l;p+=3){o?(c[0]=o.getX(p),c[1]=o.getX(p+1),c[2]=o.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:b,b:y,c:m}=Ny;if(b.fromBufferAttribute(a,c[0]),y.fromBufferAttribute(a,c[1]),m.fromBufferAttribute(a,c[2]),Ny.getNormal(jS),d[0]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,d[1]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,d[2]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let f=0;f<3;f++){const G=(f+1)%3,x=d[f],B=d[G],M=Ny[g[f]],E=Ny[g[G]],z=`${x}_${B}`,J=`${B}_${x}`;J in u&&u[J]?(jS.dot(u[J].normal)<=s&&(h.push(M.x,M.y,M.z),h.push(E.x,E.y,E.z)),u[J]=null):z in u||(u[z]={index0:c[f],index1:c[G],normal:jS.clone()})}}for(const p in u)if(u[p]){const{index0:b,index1:y}=u[p];_y.fromBufferAttribute(a,b),Vy.fromBufferAttribute(a,y),h.push(_y.x,_y.y,_y.z),h.push(Vy.x,Vy.y,Vy.z)}this.setAttribute("position",new At(h,3))}}}class ws{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const g=n[r],u=n[r+1]-g,h=(o-g)/u;return(r+h)/(s-1)}getTangent(e,t){const n=1e-4;let r=e-n,s=e+n;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new Ke:new te);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new te,r=[],s=[],o=[],a=new te,l=new bt;for(let h=0;h<=e;h++){const p=h/e;r[h]=this.getTangentAt(p,new te)}s[0]=new te,o[0]=new te;let c=Number.MAX_VALUE;const g=Math.abs(r[0].x),d=Math.abs(r[0].y),u=Math.abs(r[0].z);g<=c&&(c=g,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),u<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let h=1;h<=e;h++){if(s[h]=s[h-1].clone(),o[h]=o[h-1].clone(),a.crossVectors(r[h-1],r[h]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(tr(r[h-1].dot(r[h]),-1,1));s[h].applyMatrix4(l.makeRotationAxis(a,p))}o[h].crossVectors(r[h],s[h])}if(t===!0){let h=Math.acos(tr(s[0].dot(s[e]),-1,1));h/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(h=-h);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(r[p],h*p)),o[p].crossVectors(r[p],s[p])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class hp extends ws{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new Ke,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const g=Math.cos(this.aRotation),d=Math.sin(this.aRotation),u=l-this.aX,h=c-this.aY;l=u*g-h*d+this.aX,c=u*d+h*g+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}hp.prototype.isEllipseCurve=!0;class $S extends hp{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o);this.type="ArcCurve"}}$S.prototype.isArcCurve=!0;function eZ(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,g,d){let u=(o-s)/c-(a-s)/(c+g)+(a-o)/g,h=(a-o)/g-(l-o)/(g+d)+(l-a)/d;u*=g,h*=g,r(o,a,u,h)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const Ey=new te,tZ=new eZ,nZ=new eZ,iZ=new eZ;class rZ extends ws{constructor(e=[],t=!1,n="centripetal",r=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new te){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,g;this.closed||a>0?c=r[(a-1)%s]:(Ey.subVectors(r[0],r[1]).add(r[0]),c=Ey);const d=r[a%s],u=r[(a+1)%s];if(this.closed||a+2<s?g=r[(a+2)%s]:(Ey.subVectors(r[s-1],r[s-2]).add(r[s-1]),g=Ey),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(d),h),b=Math.pow(d.distanceToSquared(u),h),y=Math.pow(u.distanceToSquared(g),h);b<1e-4&&(b=1),p<1e-4&&(p=b),y<1e-4&&(y=b),tZ.initNonuniformCatmullRom(c.x,d.x,u.x,g.x,p,b,y),nZ.initNonuniformCatmullRom(c.y,d.y,u.y,g.y,p,b,y),iZ.initNonuniformCatmullRom(c.z,d.z,u.z,g.z,p,b,y)}else this.curveType==="catmullrom"&&(tZ.initCatmullRom(c.x,d.x,u.x,g.x,this.tension),nZ.initCatmullRom(c.y,d.y,u.y,g.y,this.tension),iZ.initCatmullRom(c.z,d.z,u.z,g.z,this.tension));return n.set(tZ.calc(l),nZ.calc(l),iZ.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new te().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}rZ.prototype.isCatmullRomCurve3=!0;function bT(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function cae(i,e){const t=1-i;return t*t*e}function gae(i,e){return 2*(1-i)*i*e}function uae(i,e){return i*i*e}function fp(i,e,t,n){return cae(i,e)+gae(i,t)+uae(i,n)}function dae(i,e){const t=1-i;return t*t*t*e}function hae(i,e){const t=1-i;return 3*t*t*i*e}function fae(i,e){return 3*(1-i)*i*i*e}function Iae(i,e){return i*i*i*e}function Ip(i,e,t,n,r){return dae(i,e)+hae(i,t)+fae(i,n)+Iae(i,r)}class Hy extends ws{constructor(e=new Ke,t=new Ke,n=new Ke,r=new Ke){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ke){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Ip(e,r.x,s.x,o.x,a.x),Ip(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Hy.prototype.isCubicBezierCurve=!0;class sZ extends ws{constructor(e=new te,t=new te,n=new te,r=new te){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new te){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Ip(e,r.x,s.x,o.x,a.x),Ip(e,r.y,s.y,o.y,a.y),Ip(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sZ.prototype.isCubicBezierCurve3=!0;class Cp extends ws{constructor(e=new Ke,t=new Ke){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ke){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Ke;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Cp.prototype.isLineCurve=!0;class yT extends ws{constructor(e=new te,t=new te){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new te){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Fy extends ws{constructor(e=new Ke,t=new Ke,n=new Ke){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ke){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(fp(e,r.x,s.x,o.x),fp(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Fy.prototype.isQuadraticBezierCurve=!0;class Ly extends ws{constructor(e=new te,t=new te,n=new te){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new te){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(fp(e,r.x,s.x,o.x),fp(e,r.y,s.y,o.y),fp(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ly.prototype.isQuadraticBezierCurve3=!0;class Ty extends ws{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new Ke){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],g=r[o>r.length-2?r.length-1:o+1],d=r[o>r.length-3?r.length-1:o+2];return n.set(bT(a,l.x,c.x,g.x,d.x),bT(a,l.y,c.y,g.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Ke().fromArray(r))}return this}}Ty.prototype.isSplineCurve=!0;var oZ=Object.freeze({__proto__:null,ArcCurve:$S,CatmullRomCurve3:rZ,CubicBezierCurve:Hy,CubicBezierCurve3:sZ,EllipseCurve:hp,LineCurve:Cp,LineCurve3:yT,QuadraticBezierCurve:Fy,QuadraticBezierCurve3:Ly,SplineCurve:Ty});class vT extends ws{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Cp(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const g=l[c];n&&n.equals(g)||(t.push(g),n=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new oZ[r.type]().fromJSON(r))}return this}}class pp extends vT{constructor(e){super();this.type="Path",this.currentPoint=new Ke,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Cp(this.currentPoint.clone(),new Ke(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new Fy(this.currentPoint.clone(),new Ke(e,t),new Ke(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new Hy(this.currentPoint.clone(),new Ke(e,t),new Ke(n,r),new Ke(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ty(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+c,t+g,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new hp(e,t,n,r,s,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const g=c.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class aa extends pp{constructor(e){super(e);this.uuid=bs(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new pp().fromJSON(r))}return this}}const Cae={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=xT(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,g,d,u,h;if(n&&(s=yae(i,e,s,t)),i.length>80*t){a=c=i[0],l=g=i[1];for(let p=t;p<r;p+=t)d=i[p],u=i[p+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>g&&(g=u);h=Math.max(c-a,g-l),h=h!==0?1/h:0}return mp(s,o,t,a,l,h),o}};function xT(i,e,t,n,r){let s,o;if(r===_ae(i,e,t,n)>0)for(s=e;s<t;s+=n)o=BT(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=BT(s,i[s],i[s+1],o);return o&&Xy(o,o.next)&&(bp(o),o=o.next),o}function Wc(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(Xy(t,t.next)||qn(t.prev,t,t.next)===0)){if(bp(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function mp(i,e,t,n,r,s,o){if(!i)return;!o&&s&&Bae(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?mae(i,n,r,s):pae(i)){e.push(l.i/t),e.push(i.i/t),e.push(c.i/t),bp(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=Aae(Wc(i),e,t),mp(i,e,t,n,r,s,2)):o===2&&bae(i,e,t,n,r,s):mp(Wc(i),e,t,n,r,s,1);break}}}function pae(i){const e=i.prev,t=i,n=i.next;if(qn(e,t,n)>=0)return!1;let r=i.next.next;for(;r!==i.prev;){if(Vh(e.x,e.y,t.x,t.y,n.x,n.y,r.x,r.y)&&qn(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function mae(i,e,t,n){const r=i.prev,s=i,o=i.next;if(qn(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,g=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,d=aZ(a,l,e,t,n),u=aZ(c,g,e,t,n);let h=i.prevZ,p=i.nextZ;for(;h&&h.z>=d&&p&&p.z<=u;){if(h!==i.prev&&h!==i.next&&Vh(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&qn(h.prev,h,h.next)>=0||(h=h.prevZ,p!==i.prev&&p!==i.next&&Vh(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&qn(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;h&&h.z>=d;){if(h!==i.prev&&h!==i.next&&Vh(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&qn(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==i.prev&&p!==i.next&&Vh(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&qn(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Aae(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!Xy(r,s)&&wT(r,n,n.next,s)&&Ap(r,s)&&Ap(s,r)&&(e.push(r.i/t),e.push(n.i/t),e.push(s.i/t),bp(n),bp(n.next),n=i=s),n=n.next}while(n!==i);return Wc(n)}function bae(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Rae(o,a)){let l=GT(o,a);o=Wc(o,o.next),l=Wc(l,l.next),mp(o,e,t,n,r,s),mp(l,e,t,n,r,s);return}a=a.next}o=o.next}while(o!==i)}function yae(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=xT(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Zae(c));for(r.sort(vae),s=0;s<r.length;s++)xae(r[s],t),t=Wc(t,t.next);return t}function vae(i,e){return i.x-e.x}function xae(i,e){if(e=wae(i,e),e){const t=GT(e,i);Wc(e,e.next),Wc(t,t.next)}}function wae(i,e){let t=e;const n=i.x,r=i.y;let s=-1/0,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const u=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=n&&u>s){if(s=u,u===n){if(r===t.y)return t;if(r===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===s)return o;const a=o,l=o.x,c=o.y;let g=1/0,d;t=o;do n>=t.x&&t.x>=l&&n!==t.x&&Vh(r<c?n:s,r,l,c,r<c?s:n,r,t.x,t.y)&&(d=Math.abs(r-t.y)/(n-t.x),Ap(t,i)&&(d<g||d===g&&(t.x>o.x||t.x===o.x&&Gae(o,t)))&&(o=t,g=d)),t=t.next;while(t!==a);return o}function Gae(i,e){return qn(i.prev,i,e.prev)<0&&qn(e.next,i,i.next)<0}function Bae(i,e,t,n){let r=i;do r.z===null&&(r.z=aZ(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,Sae(r)}function Sae(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function aZ(i,e,t,n,r){return i=32767*(i-t)*r,e=32767*(e-n)*r,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function Zae(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Vh(i,e,t,n,r,s,o,a){return(r-o)*(e-a)-(i-o)*(s-a)>=0&&(i-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(r-o)*(n-a)>=0}function Rae(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!Mae(i,e)&&(Ap(i,e)&&Ap(e,i)&&Wae(i,e)&&(qn(i.prev,i,e.prev)||qn(i,e.prev,e))||Xy(i,e)&&qn(i.prev,i,i.next)>0&&qn(e.prev,e,e.next)>0)}function qn(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Xy(i,e){return i.x===e.x&&i.y===e.y}function wT(i,e,t,n){const r=ky(qn(i,e,t)),s=ky(qn(i,e,n)),o=ky(qn(t,n,i)),a=ky(qn(t,n,e));return!!(r!==s&&o!==a||r===0&&zy(i,t,e)||s===0&&zy(i,n,e)||o===0&&zy(t,i,n)||a===0&&zy(t,e,n))}function zy(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function ky(i){return i>0?1:i<0?-1:0}function Mae(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&wT(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Ap(i,e){return qn(i.prev,i,i.next)<0?qn(i,e,i.next)>=0&&qn(i,i.prev,e)>=0:qn(i,e,i.prev)<0||qn(i,i.next,e)<0}function Wae(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function GT(i,e){const t=new lZ(i.i,i.x,i.y),n=new lZ(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function BT(i,e,t,n){const r=new lZ(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function bp(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function lZ(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _ae(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class la{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return la.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];ST(e),ZT(n,e);let o=e.length;t.forEach(ST);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,ZT(n,t[l]);const a=Cae.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function ST(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function ZT(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class ca extends Nt{constructor(e=new aa([new Ke(.5,.5),new Ke(-.5,.5),new Ke(-.5,-.5),new Ke(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new At(r,3)),this.setAttribute("uv",new At(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1;let d=t.depth!==void 0?t.depth:1,u=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:h-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,f=t.UVGenerator!==void 0?t.UVGenerator:Vae;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let G,x=!1,B,M,E,z;m&&(G=m.getSpacedPoints(g),x=!0,u=!1,B=m.computeFrenetFrames(g,!1),M=new te,E=new te,z=new te),u||(y=0,h=0,p=0,b=0);const J=a.extractPoints(c);let V=J.shape;const I=J.holes;if(!la.isClockWise(V)){V=V.reverse();for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];la.isClockWise(Ie)&&(I[ne]=Ie.reverse())}}const S=la.triangulateShape(V,I),R=V;for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];V=V.concat(Ie)}function W(ne,de,Ie){return de||console.error("THREE.ExtrudeGeometry: vec does not exist"),de.clone().multiplyScalar(Ie).add(ne)}const H=V.length,k=S.length;function _(ne,de,Ie){let Be,Re,Xe;const Le=ne.x-de.x,Qe=ne.y-de.y,et=Ie.x-ne.x,q=Ie.y-ne.y,X=Le*Le+Qe*Qe,D=Le*q-Qe*et;if(Math.abs(D)>Number.EPSILON){const ge=Math.sqrt(X),Se=Math.sqrt(et*et+q*q),Me=de.x-Qe/ge,pe=de.y+Le/ge,we=Ie.x-q/Se,re=Ie.y+et/Se,be=((we-Me)*q-(re-pe)*et)/(Le*q-Qe*et);Be=Me+Le*be-ne.x,Re=pe+Qe*be-ne.y;const _e=Be*Be+Re*Re;if(_e<=2)return new Ke(Be,Re);Xe=Math.sqrt(_e/2)}else{let ge=!1;Le>Number.EPSILON?et>Number.EPSILON&&(ge=!0):Le<-Number.EPSILON?et<-Number.EPSILON&&(ge=!0):Math.sign(Qe)===Math.sign(q)&&(ge=!0),ge?(Be=-Qe,Re=Le,Xe=Math.sqrt(X)):(Be=Le,Re=Qe,Xe=Math.sqrt(X/2))}return new Ke(Be/Xe,Re/Xe)}const Z=[];for(let ne=0,de=R.length,Ie=de-1,Be=ne+1;ne<de;ne++,Ie++,Be++)Ie===de&&(Ie=0),Be===de&&(Be=0),Z[ne]=_(R[ne],R[Ie],R[Be]);const T=[];let F,K=Z.concat();for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];F=[];for(let Be=0,Re=Ie.length,Xe=Re-1,Le=Be+1;Be<Re;Be++,Xe++,Le++)Xe===Re&&(Xe=0),Le===Re&&(Le=0),F[Be]=_(Ie[Be],Ie[Xe],Ie[Le]);T.push(F),K=K.concat(F)}for(let ne=0;ne<y;ne++){const de=ne/y,Ie=h*Math.cos(de*Math.PI/2),Be=p*Math.sin(de*Math.PI/2)+b;for(let Re=0,Xe=R.length;Re<Xe;Re++){const Le=W(R[Re],Z[Re],Be);ye(Le.x,Le.y,-Ie)}for(let Re=0,Xe=I.length;Re<Xe;Re++){const Le=I[Re];F=T[Re];for(let Qe=0,et=Le.length;Qe<et;Qe++){const q=W(Le[Qe],F[Qe],Be);ye(q.x,q.y,-Ie)}}}const j=p+b;for(let ne=0;ne<H;ne++){const de=u?W(V[ne],K[ne],j):V[ne];x?(E.copy(B.normals[0]).multiplyScalar(de.x),M.copy(B.binormals[0]).multiplyScalar(de.y),z.copy(G[0]).add(E).add(M),ye(z.x,z.y,z.z)):ye(de.x,de.y,0)}for(let ne=1;ne<=g;ne++)for(let de=0;de<H;de++){const Ie=u?W(V[de],K[de],j):V[de];x?(E.copy(B.normals[ne]).multiplyScalar(Ie.x),M.copy(B.binormals[ne]).multiplyScalar(Ie.y),z.copy(G[ne]).add(E).add(M),ye(z.x,z.y,z.z)):ye(Ie.x,Ie.y,d/g*ne)}for(let ne=y-1;ne>=0;ne--){const de=ne/y,Ie=h*Math.cos(de*Math.PI/2),Be=p*Math.sin(de*Math.PI/2)+b;for(let Re=0,Xe=R.length;Re<Xe;Re++){const Le=W(R[Re],Z[Re],Be);ye(Le.x,Le.y,d+Ie)}for(let Re=0,Xe=I.length;Re<Xe;Re++){const Le=I[Re];F=T[Re];for(let Qe=0,et=Le.length;Qe<et;Qe++){const q=W(Le[Qe],F[Qe],Be);x?ye(q.x,q.y+G[g-1].y,G[g-1].x+Ie):ye(q.x,q.y,d+Ie)}}}O(),Y();function O(){const ne=r.length/3;if(u){let de=0,Ie=H*de;for(let Be=0;Be<k;Be++){const Re=S[Be];Ce(Re[2]+Ie,Re[1]+Ie,Re[0]+Ie)}de=g+y*2,Ie=H*de;for(let Be=0;Be<k;Be++){const Re=S[Be];Ce(Re[0]+Ie,Re[1]+Ie,Re[2]+Ie)}}else{for(let de=0;de<k;de++){const Ie=S[de];Ce(Ie[2],Ie[1],Ie[0])}for(let de=0;de<k;de++){const Ie=S[de];Ce(Ie[0]+H*g,Ie[1]+H*g,Ie[2]+H*g)}}n.addGroup(ne,r.length/3-ne,0)}function Y(){const ne=r.length/3;let de=0;ee(R,de),de+=R.length;for(let Ie=0,Be=I.length;Ie<Be;Ie++){const Re=I[Ie];ee(Re,de),de+=Re.length}n.addGroup(ne,r.length/3-ne,1)}function ee(ne,de){let Ie=ne.length;for(;--Ie>=0;){const Be=Ie;let Re=Ie-1;Re<0&&(Re=ne.length-1);for(let Xe=0,Le=g+y*2;Xe<Le;Xe++){const Qe=H*Xe,et=H*(Xe+1),q=de+Be+Qe,X=de+Re+Qe,D=de+Re+et,ge=de+Be+et;he(q,X,D,ge)}}}function ye(ne,de,Ie){l.push(ne),l.push(de),l.push(Ie)}function Ce(ne,de,Ie){Ne(ne),Ne(de),Ne(Ie);const Be=r.length/3,Re=f.generateTopUV(n,r,Be-3,Be-2,Be-1);He(Re[0]),He(Re[1]),He(Re[2])}function he(ne,de,Ie,Be){Ne(ne),Ne(de),Ne(Be),Ne(de),Ne(Ie),Ne(Be);const Re=r.length/3,Xe=f.generateSideWallUV(n,r,Re-6,Re-3,Re-2,Re-1);He(Xe[0]),He(Xe[1]),He(Xe[3]),He(Xe[1]),He(Xe[2]),He(Xe[3])}function Ne(ne){r.push(l[ne*3+0]),r.push(l[ne*3+1]),r.push(l[ne*3+2])}function He(ne){s.push(ne.x),s.push(ne.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return Nae(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new oZ[r.type]().fromJSON(r)),new ca(n,e.options)}}const Vae={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],g=e[r*3+1];return[new Ke(s,o),new Ke(a,l),new Ke(c,g)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],g=e[n*3+1],d=e[n*3+2],u=e[r*3],h=e[r*3+1],p=e[r*3+2],b=e[s*3],y=e[s*3+1],m=e[s*3+2];return Math.abs(a-g)<Math.abs(o-c)?[new Ke(o,1-l),new Ke(c,1-d),new Ke(u,1-p),new Ke(b,1-m)]:[new Ke(a,1-l),new Ke(g,1-d),new Ke(h,1-p),new Ke(y,1-m)]}};function Nae(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Nh extends oa{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t);this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Nh(e.radius,e.detail)}}class Eh extends Nt{constructor(e=[new Ke(0,.5),new Ke(.5,0),new Ke(0,-.5)],t=12,n=0,r=Math.PI*2){super();this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=tr(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],g=1/t,d=new te,u=new Ke,h=new te,p=new te,b=new te;let y=0,m=0;for(let f=0;f<=e.length-1;f++)switch(f){case 0:y=e[f+1].x-e[f].x,m=e[f+1].y-e[f].y,h.x=m*1,h.y=-y,h.z=m*0,b.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(b.x,b.y,b.z);break;default:y=e[f+1].x-e[f].x,m=e[f+1].y-e[f].y,h.x=m*1,h.y=-y,h.z=m*0,p.copy(h),h.x+=b.x,h.y+=b.y,h.z+=b.z,h.normalize(),l.push(h.x,h.y,h.z),b.copy(p)}for(let f=0;f<=t;f++){const G=n+f*g*r,x=Math.sin(G),B=Math.cos(G);for(let M=0;M<=e.length-1;M++){d.x=e[M].x*x,d.y=e[M].y,d.z=e[M].x*B,o.push(d.x,d.y,d.z),u.x=f/t,u.y=M/(e.length-1),a.push(u.x,u.y);const E=l[3*M+0]*x,z=l[3*M+1],J=l[3*M+0]*B;c.push(E,z,J)}}for(let f=0;f<t;f++)for(let G=0;G<e.length-1;G++){const x=G+f*e.length,B=x,M=x+e.length,E=x+e.length+1,z=x+1;s.push(B,M,z),s.push(E,z,M)}this.setIndex(s),this.setAttribute("position",new At(o,3)),this.setAttribute("uv",new At(a,2)),this.setAttribute("normal",new At(c,3))}static fromJSON(e){return new Eh(e.points,e.segments,e.phiStart,e.phiLength)}}class au extends oa{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t);this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new au(e.radius,e.detail)}}class Hh extends Nt{constructor(e=.5,t=1,n=8,r=1,s=0,o=Math.PI*2){super();this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],c=[],g=[];let d=e;const u=(t-e)/r,h=new te,p=new Ke;for(let b=0;b<=r;b++){for(let y=0;y<=n;y++){const m=s+y/n*o;h.x=d*Math.cos(m),h.y=d*Math.sin(m),l.push(h.x,h.y,h.z),c.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,g.push(p.x,p.y)}d+=u}for(let b=0;b<r;b++){const y=b*(n+1);for(let m=0;m<n;m++){const f=m+y,G=f,x=f+n+1,B=f+n+2,M=f+1;a.push(G,x,M),a.push(x,B,M)}}this.setIndex(a),this.setAttribute("position",new At(l,3)),this.setAttribute("normal",new At(c,3)),this.setAttribute("uv",new At(g,2))}static fromJSON(e){return new Hh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class lu extends Nt{constructor(e=new aa([new Ke(0,.5),new Ke(-.5,-.5),new Ke(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let g=0;g<e.length;g++)c(e[g]),this.addGroup(a,l,g),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new At(r,3)),this.setAttribute("normal",new At(s,3)),this.setAttribute("uv",new At(o,2));function c(g){const d=r.length/3,u=g.extractPoints(t);let h=u.shape;const p=u.holes;la.isClockWise(h)===!1&&(h=h.reverse());for(let y=0,m=p.length;y<m;y++){const f=p[y];la.isClockWise(f)===!0&&(p[y]=f.reverse())}const b=la.triangulateShape(h,p);for(let y=0,m=p.length;y<m;y++){const f=p[y];h=h.concat(f)}for(let y=0,m=h.length;y<m;y++){const f=h[y];r.push(f.x,f.y,0),s.push(0,0,1),o.push(f.x,f.y)}for(let y=0,m=b.length;y<m;y++){const f=b[y],G=f[0]+d,x=f[1]+d,B=f[2]+d;n.push(G,x,B),l+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return Eae(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new lu(n,e.curveSegments)}}function Eae(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class cu extends Nt{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const g=[],d=new te,u=new te,h=[],p=[],b=[],y=[];for(let m=0;m<=n;m++){const f=[],G=m/n;let x=0;m==0&&o==0?x=.5/t:m==n&&l==Math.PI&&(x=-.5/t);for(let B=0;B<=t;B++){const M=B/t;d.x=-e*Math.cos(r+M*s)*Math.sin(o+G*a),d.y=e*Math.cos(o+G*a),d.z=e*Math.sin(r+M*s)*Math.sin(o+G*a),p.push(d.x,d.y,d.z),u.copy(d).normalize(),b.push(u.x,u.y,u.z),y.push(M+x,1-G),f.push(c++)}g.push(f)}for(let m=0;m<n;m++)for(let f=0;f<t;f++){const G=g[m][f+1],x=g[m][f],B=g[m+1][f],M=g[m+1][f+1];(m!==0||o>0)&&h.push(G,x,M),(m!==n-1||l<Math.PI)&&h.push(x,B,M)}this.setIndex(h),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(b,3)),this.setAttribute("uv",new At(y,2))}static fromJSON(e){return new cu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Fh extends oa{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t);this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fh(e.radius,e.detail)}}class Lh extends Nt{constructor(e=1,t=.4,n=8,r=6,s=Math.PI*2){super();this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],g=new te,d=new te,u=new te;for(let h=0;h<=n;h++)for(let p=0;p<=r;p++){const b=p/r*s,y=h/n*Math.PI*2;d.x=(e+t*Math.cos(y))*Math.cos(b),d.y=(e+t*Math.cos(y))*Math.sin(b),d.z=t*Math.sin(y),a.push(d.x,d.y,d.z),g.x=e*Math.cos(b),g.y=e*Math.sin(b),u.subVectors(d,g).normalize(),l.push(u.x,u.y,u.z),c.push(p/r),c.push(h/n)}for(let h=1;h<=n;h++)for(let p=1;p<=r;p++){const b=(r+1)*h+p-1,y=(r+1)*(h-1)+p-1,m=(r+1)*(h-1)+p,f=(r+1)*h+p;o.push(b,y,f),o.push(y,m,f)}this.setIndex(o),this.setAttribute("position",new At(a,3)),this.setAttribute("normal",new At(l,3)),this.setAttribute("uv",new At(c,2))}static fromJSON(e){return new Lh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Th extends Nt{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super();this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],c=[],g=[],d=new te,u=new te,h=new te,p=new te,b=new te,y=new te,m=new te;for(let G=0;G<=n;++G){const x=G/n*s*Math.PI*2;f(x,s,o,e,h),f(x+.01,s,o,e,p),y.subVectors(p,h),m.addVectors(p,h),b.crossVectors(y,m),m.crossVectors(b,y),b.normalize(),m.normalize();for(let B=0;B<=r;++B){const M=B/r*Math.PI*2,E=-t*Math.cos(M),z=t*Math.sin(M);d.x=h.x+(E*m.x+z*b.x),d.y=h.y+(E*m.y+z*b.y),d.z=h.z+(E*m.z+z*b.z),l.push(d.x,d.y,d.z),u.subVectors(d,h).normalize(),c.push(u.x,u.y,u.z),g.push(G/n),g.push(B/r)}}for(let G=1;G<=n;G++)for(let x=1;x<=r;x++){const B=(r+1)*(G-1)+(x-1),M=(r+1)*G+(x-1),E=(r+1)*G+x,z=(r+1)*(G-1)+x;a.push(B,M,z),a.push(M,E,z)}this.setIndex(a),this.setAttribute("position",new At(l,3)),this.setAttribute("normal",new At(c,3)),this.setAttribute("uv",new At(g,2));function f(G,x,B,M,E){const z=Math.cos(G),J=Math.sin(G),V=B/x*G,I=Math.cos(V);E.x=M*(2+I)*.5*z,E.y=M*(2+I)*J*.5,E.z=M*Math.sin(V)*.5}}static fromJSON(e){return new Th(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Xh extends Nt{constructor(e=new Ly(new te(-1,-1,0),new te(-1,1,0),new te(1,1,0)),t=64,n=1,r=8,s=!1){super();this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new te,l=new te,c=new Ke;let g=new te;const d=[],u=[],h=[],p=[];b(),this.setIndex(p),this.setAttribute("position",new At(d,3)),this.setAttribute("normal",new At(u,3)),this.setAttribute("uv",new At(h,2));function b(){for(let G=0;G<t;G++)y(G);y(s===!1?t:0),f(),m()}function y(G){g=e.getPointAt(G/t,g);const x=o.normals[G],B=o.binormals[G];for(let M=0;M<=r;M++){const E=M/r*Math.PI*2,z=Math.sin(E),J=-Math.cos(E);l.x=J*x.x+z*B.x,l.y=J*x.y+z*B.y,l.z=J*x.z+z*B.z,l.normalize(),u.push(l.x,l.y,l.z),a.x=g.x+n*l.x,a.y=g.y+n*l.y,a.z=g.z+n*l.z,d.push(a.x,a.y,a.z)}}function m(){for(let G=1;G<=t;G++)for(let x=1;x<=r;x++){const B=(r+1)*(G-1)+(x-1),M=(r+1)*G+(x-1),E=(r+1)*G+x,z=(r+1)*(G-1)+x;p.push(B,M,z),p.push(M,E,z)}}function f(){for(let G=0;G<=t;G++)for(let x=0;x<=r;x++)c.x=G/t,c.y=x/r,h.push(c.x,c.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Xh(new oZ[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class cZ extends Nt{constructor(e=null){super();if(this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new te,s=new te;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,g=l.length;c<g;++c){const d=l[c],u=d.start,h=d.count;for(let p=u,b=u+h;p<b;p+=3)for(let y=0;y<3;y++){const m=a.getX(p+y),f=a.getX(p+(y+1)%3);r.fromBufferAttribute(o,m),s.fromBufferAttribute(o,f),RT(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const g=3*a+c,d=3*a+(c+1)%3;r.fromBufferAttribute(o,g),s.fromBufferAttribute(o,d),RT(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new At(t,3))}}}function RT(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(r)===!0?!1:(t.add(n),t.add(r),!0)}var MT=Object.freeze({__proto__:null,BoxGeometry:nl,BoxBufferGeometry:nl,CircleGeometry:Mh,CircleBufferGeometry:Mh,ConeGeometry:Wh,ConeBufferGeometry:Wh,CylinderGeometry:Mc,CylinderBufferGeometry:Mc,DodecahedronGeometry:_h,DodecahedronBufferGeometry:_h,EdgesGeometry:qS,ExtrudeGeometry:ca,ExtrudeBufferGeometry:ca,IcosahedronGeometry:Nh,IcosahedronBufferGeometry:Nh,LatheGeometry:Eh,LatheBufferGeometry:Eh,OctahedronGeometry:au,OctahedronBufferGeometry:au,PlaneGeometry:$g,PlaneBufferGeometry:$g,PolyhedronGeometry:oa,PolyhedronBufferGeometry:oa,RingGeometry:Hh,RingBufferGeometry:Hh,ShapeGeometry:lu,ShapeBufferGeometry:lu,SphereGeometry:cu,SphereBufferGeometry:cu,TetrahedronGeometry:Fh,TetrahedronBufferGeometry:Fh,TorusGeometry:Lh,TorusBufferGeometry:Lh,TorusKnotGeometry:Th,TorusKnotBufferGeometry:Th,TubeGeometry:Xh,TubeBufferGeometry:Xh,WireframeGeometry:cZ});class gZ extends Ii{constructor(e){super();this.type="ShadowMaterial",this.color=new lt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}gZ.prototype.isShadowMaterial=!0;class uZ extends js{constructor(e){super(e);this.type="RawShaderMaterial"}}uZ.prototype.isRawShaderMaterial=!0;class Yy extends Ii{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new lt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dg,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Yy.prototype.isMeshStandardMaterial=!0;class dZ extends Yy{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ke(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return tr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new lt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new lt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new lt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}dZ.prototype.isMeshPhysicalMaterial=!0;class hZ extends Ii{constructor(e){super();this.type="MeshPhongMaterial",this.color=new lt(16777215),this.specular=new lt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dg,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=XC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}hZ.prototype.isMeshPhongMaterial=!0;class fZ extends Ii{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new lt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dg,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}fZ.prototype.isMeshToonMaterial=!0;class IZ extends Ii{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dg,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}IZ.prototype.isMeshNormalMaterial=!0;class CZ extends Ii{constructor(e){super();this.type="MeshLambertMaterial",this.color=new lt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=XC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}CZ.prototype.isMeshLambertMaterial=!0;class pZ extends Ii{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new lt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dg,this.normalScale=new Ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}pZ.prototype.isMeshMatcapMaterial=!0;class mZ extends Ti{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}mZ.prototype.isLineDashedMaterial=!0;const Hae={ShadowMaterial:gZ,SpriteMaterial:Ay,RawShaderMaterial:uZ,ShaderMaterial:js,PointsMaterial:ou,MeshPhysicalMaterial:dZ,MeshStandardMaterial:Yy,MeshPhongMaterial:hZ,MeshToonMaterial:fZ,MeshNormalMaterial:IZ,MeshLambertMaterial:CZ,MeshDepthMaterial:py,MeshDistanceMaterial:my,MeshBasicMaterial:tl,MeshMatcapMaterial:pZ,LineDashedMaterial:mZ,LineBasicMaterial:Ti,Material:Ii};Ii.fromType=function(i){return new Hae[i]};const kn={arraySlice:function(i,e,t){return kn.isTypedArray(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)},convertArray:function(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n},sortedArray:function(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r},flattenJSON:function(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)},subclip:function(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],g=c.getValueSize(),d=[],u=[];for(let h=0;h<c.times.length;++h){const p=c.times[h]*r;if(!(p<t||p>=n)){d.push(c.times[h]);for(let b=0;b<g;++b)u.push(c.values[h*g+b])}}d.length!==0&&(c.times=kn.convertArray(d,c.times.constructor),c.values=kn.convertArray(u,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===l});if(c===void 0)continue;let g=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=d/3);let u=0;const h=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);const p=a.times.length-1;let b;if(s<=a.times[0]){const m=g,f=d-g;b=kn.arraySlice(a.values,m,f)}else if(s>=a.times[p]){const m=p*d+g,f=m+d-g;b=kn.arraySlice(a.values,m,f)}else{const m=a.createInterpolant(),f=g,G=d-g;m.evaluate(s),b=kn.arraySlice(m.resultBuffer,f,G)}l==="quaternion"&&new Zi().fromArray(b).normalize().conjugate().toArray(b);const y=c.times.length;for(let m=0;m<y;++m){const f=m*h+u;if(l==="quaternion")Zi.multiplyQuaternionsFlat(c.values,f,b,0,c.values,f);else{const G=h-u*2;for(let x=0;x<G;++x)c.values[f+x]-=b[x]}}}return i.blendMode=gS,i}};class rl{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,s)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,s,e)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}rl.prototype.beforeStart_=rl.prototype.copySampleValue_;rl.prototype.afterEnd_=rl.prototype.copySampleValue_;class WT extends rl{constructor(e,t,n,r){super(e,t,n,r);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kg,endingEnd:Kg}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Pg:s=e,a=2*t-n;break;case JC:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Pg:o=e,l=2*n-t;break;case JC:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,g=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*g,this._offsetNext=o*g}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),b=p*p,y=b*p,m=-u*y+2*u*b-u*p,f=(1+u)*y+(-1.5-2*u)*b+(-.5+u)*p+1,G=(-1-h)*y+(1.5+h)*b+.5*p,x=h*y-h*b;for(let B=0;B!==a;++B)s[B]=m*o[g+B]+f*o[c+B]+G*o[l+B]+x*o[d+B];return s}}class AZ extends rl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=(n-t)/(r-t),d=1-g;for(let u=0;u!==a;++u)s[u]=o[c+u]*d+o[l+u]*g;return s}}class _T extends rl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class wo{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=kn.convertArray(t,this.TimeBufferType),this.values=kn.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:kn.convertArray(e.times,Array),values:kn.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new _T(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new AZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new WT(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case UC:t=this.InterpolantFactoryMethodDiscrete;break;case OC:t=this.InterpolantFactoryMethodLinear;break;case zb:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return UC;case this.InterpolantFactoryMethodLinear:return OC;case this.InterpolantFactoryMethodSmooth:return zb}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=kn.arraySlice(n,s,o),this.values=kn.arraySlice(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&kn.isTypedArray(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=kn.arraySlice(this.times),t=kn.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===zb,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],g=e[a+1];if(c!==g&&(a!==1||c!==e[0]))if(r)l=!0;else{const d=a*n,u=d-n,h=d+n;for(let p=0;p!==n;++p){const b=t[d+p];if(b!==t[u+p]||b!==t[h+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*n,u=o*n;for(let h=0;h!==n;++h)t[u+h]=t[d+h]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=kn.arraySlice(e,0,o),this.values=kn.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=kn.arraySlice(this.times,0),t=kn.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}wo.prototype.TimeBufferType=Float32Array;wo.prototype.ValueBufferType=Float32Array;wo.prototype.DefaultInterpolation=OC;class gu extends wo{}gu.prototype.ValueTypeName="bool";gu.prototype.ValueBufferType=Array;gu.prototype.DefaultInterpolation=UC;gu.prototype.InterpolantFactoryMethodLinear=void 0;gu.prototype.InterpolantFactoryMethodSmooth=void 0;class bZ extends wo{}bZ.prototype.ValueTypeName="color";class yp extends wo{}yp.prototype.ValueTypeName="number";class VT extends rl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let g=c+a;c!==g;c+=4)Zi.slerpFlat(s,0,o,c-a,o,c,l);return s}}class zh extends wo{InterpolantFactoryMethodLinear(e){return new VT(this.times,this.values,this.getValueSize(),e)}}zh.prototype.ValueTypeName="quaternion";zh.prototype.DefaultInterpolation=OC;zh.prototype.InterpolantFactoryMethodSmooth=void 0;class uu extends wo{}uu.prototype.ValueTypeName="string";uu.prototype.ValueBufferType=Array;uu.prototype.DefaultInterpolation=UC;uu.prototype.InterpolantFactoryMethodLinear=void 0;uu.prototype.InterpolantFactoryMethodSmooth=void 0;class vp extends wo{}vp.prototype.ValueTypeName="vector";class xp{constructor(e,t=-1,n,r=kb){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=bs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(Lae(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(wo.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const g=kn.getKeyframeOrder(l);l=kn.sortedArray(l,1,g),c=kn.sortedArray(c,1,g),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new yp(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],g=c.name.match(s);if(g&&g.length>1){const d=g[1];let u=r[d];u||(r[d]=u=[]),u.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(d,u,h,p,b){if(h.length!==0){const y=[],m=[];kn.flattenJSON(h,y,m,p),y.length!==0&&b.push(new d(u,y,m))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const u=c[d].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const h={};let p;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(let b=0;b<u[p].morphTargets.length;b++)h[u[p].morphTargets[b]]=-1;for(const b in h){const y=[],m=[];for(let f=0;f!==u[p].morphTargets.length;++f){const G=u[p];y.push(G.time),m.push(G.morphTarget===b?1:0)}r.push(new yp(".morphTargetInfluence["+b+"]",y,m))}l=h.length*o}else{const h=".bones["+t[d].name+"]";n(vp,h+".position",u,"pos",r),n(zh,h+".quaternion",u,"rot",r),n(vp,h+".scale",u,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Fae(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yp;case"vector":case"vector2":case"vector3":case"vector4":return vp;case"color":return bZ;case"quaternion":return zh;case"bool":case"boolean":return gu;case"string":return uu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function Lae(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Fae(i.type);if(i.times===void 0){const t=[],n=[];kn.flattenJSON(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const du={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class yZ{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(g){a++,s===!1&&r.onStart!==void 0&&r.onStart(g,o,a),s=!0},this.itemEnd=function(g){o++,r.onProgress!==void 0&&r.onProgress(g,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return l?l(g):g},this.setURLModifier=function(g){return l=g,this},this.addHandler=function(g,d){return c.push(g,d),this},this.removeHandler=function(g){const d=c.indexOf(g);return d!==-1&&c.splice(d,2),this},this.getHandler=function(g){for(let d=0,u=c.length;d<u;d+=2){const h=c[d],p=c[d+1];if(h.global&&(h.lastIndex=0),h.test(g))return p}return null}}}const NT=new yZ;class Lr{constructor(e){this.manager=e!==void 0?e:NT,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const sl={};class ga extends Lr{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=du.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(sl[e]!==void 0){sl[e].push({onLoad:t,onProgress:n,onError:r});return}sl[e]=[],sl[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body===void 0||c.body.getReader===void 0)return c;const g=sl[e],d=c.body.getReader(),u=c.headers.get("Content-Length"),h=u?parseInt(u):0,p=h!==0;let b=0;const y=new ReadableStream({start(m){f();function f(){d.read().then(({done:G,value:x})=>{if(G)m.close();else{b+=x.byteLength;const B=new ProgressEvent("progress",{lengthComputable:p,loaded:b,total:h});for(let M=0,E=g.length;M<E;M++){const z=g[M];z.onProgress&&z.onProgress(B)}m.enqueue(x),f()}})}}});return new Response(y)}else throw Error(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(g=>new DOMParser().parseFromString(g,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),u=d&&d[1]?d[1].toLowerCase():void 0,h=new TextDecoder(u);return c.arrayBuffer().then(p=>h.decode(p))}}}).then(c=>{du.add(e,c);const g=sl[e];delete sl[e];for(let d=0,u=g.length;d<u;d++){const h=g[d];h.onLoad&&h.onLoad(c)}}).catch(c=>{const g=sl[e];if(g===void 0)throw this.manager.itemError(e),c;delete sl[e];for(let d=0,u=g.length;d<u;d++){const h=g[d];h.onError&&h.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Tae extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new ga(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=xp.parse(e[n]);t.push(r)}return t}}class Xae extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=[],a=new QS,l=new ga(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function g(d){l.load(e[d],function(u){const h=s.parse(u,!0);o[d]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},c+=1,c===6&&(h.mipmapCount===1&&(a.minFilter=jn),a.image=o,a.format=h.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let d=0,u=e.length;d<u;++d)g(d);else l.load(e,function(d){const u=s.parse(d,!0);if(u.isCubemap){const h=u.mipmaps.length/u.mipmapCount;for(let p=0;p<h;p++){o[p]={mipmaps:[]};for(let b=0;b<u.mipmapCount;b++)o[p].mipmaps.push(u.mipmaps[p*u.mipmapCount+b]),o[p].format=u.format,o[p].width=u.width,o[p].height=u.height}a.image=o}else a.image.width=u.width,a.image.height=u.height,a.mipmaps=u.mipmaps;u.mipmapCount===1&&(a.minFilter=jn),a.format=u.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}class wp extends Lr{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=du.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=qC("img");function l(){g(),du.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){g(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function g(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class ET extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=new bh,o=new wp(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(g){s.images[c]=g,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class HT extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new ru,a=new ga(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){const c=s.parse(l);!c||(c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Er,o.wrapT=c.wrapT!==void 0?c.wrapT:Er,o.magFilter=c.magFilter!==void 0?c.magFilter:jn,o.minFilter=c.minFilter!==void 0?c.minFilter:jn,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=Xg),c.mipmapCount===1&&(o.minFilter=jn),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c))},n,r),o}}class FT extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=new hi,o=new wp(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class Go extends Ut{constructor(e,t=1){super();this.type="Light",this.color=new lt(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Go.prototype.isLight=!0;class vZ extends Go{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.groundColor=new lt(t)}copy(e){return Go.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}vZ.prototype.isHemisphereLight=!0;const LT=new bt,TT=new te,XT=new te;class xZ{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ke(512,512),this.map=null,this.mapPass=null,this.matrix=new bt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ip,this._frameExtents=new Ke(1,1),this._viewportCount=1,this._viewports=[new mn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;TT.setFromMatrixPosition(e.matrixWorld),t.position.copy(TT),XT.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(XT),t.updateMatrixWorld(),LT.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(LT),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class zT extends xZ{constructor(){super(new Ri(50,1,.5,500));this.focus=1}updateMatrices(e){const t=this.camera,n=QC*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}zT.prototype.isSpotLightShadow=!0;class wZ extends Go{constructor(e,t,n=0,r=Math.PI/3,s=0,o=1){super(e,t);this.type="SpotLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.target=new Ut,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.shadow=new zT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}wZ.prototype.isSpotLight=!0;const kT=new bt,Gp=new te,GZ=new te;class YT extends xZ{constructor(){super(new Ri(90,1,.5,500));this._frameExtents=new Ke(4,2),this._viewportCount=6,this._viewports=[new mn(2,1,1,1),new mn(0,1,1,1),new mn(3,1,1,1),new mn(1,1,1,1),new mn(3,0,1,1),new mn(1,0,1,1)],this._cubeDirections=[new te(1,0,0),new te(-1,0,0),new te(0,0,1),new te(0,0,-1),new te(0,1,0),new te(0,-1,0)],this._cubeUps=[new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,0,1),new te(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Gp.setFromMatrixPosition(e.matrixWorld),n.position.copy(Gp),GZ.copy(n.position),GZ.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(GZ),n.updateMatrixWorld(),r.makeTranslation(-Gp.x,-Gp.y,-Gp.z),kT.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kT)}}YT.prototype.isPointLightShadow=!0;class BZ extends Go{constructor(e,t,n=0,r=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new YT}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}BZ.prototype.isPointLight=!0;class KT extends xZ{constructor(){super(new vh(-5,5,5,-5,.5,500))}}KT.prototype.isDirectionalLightShadow=!0;class SZ extends Go{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.target=new Ut,this.shadow=new KT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SZ.prototype.isDirectionalLight=!0;class ZZ extends Go{constructor(e,t){super(e,t);this.type="AmbientLight"}}ZZ.prototype.isAmbientLight=!0;class RZ extends Go{constructor(e,t,n=10,r=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}RZ.prototype.isRectAreaLight=!0;class MZ{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new te)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}MZ.prototype.isSphericalHarmonics3=!0;class Bp extends Go{constructor(e=new MZ,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Bp.prototype.isLightProbe=!0;class PT extends Lr{constructor(e){super(e);this.textures={}}load(e,t,n,r){const s=this,o=new ga(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=Ii.fromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new lt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==1&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new lt().setHex(o.value);break;case"v2":r.uniforms[s].value=new Ke().fromArray(o.value);break;case"v3":r.uniforms[s].value=new te().fromArray(o.value);break;case"v4":r.uniforms[s].value=new mn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new Si().fromArray(o.value);break;case"m4":r.uniforms[s].value=new bt().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.shading!==void 0&&(r.flatShading=e.shading===1),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Ke().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Ke().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}}class Ky{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class WZ extends Nt{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}WZ.prototype.isInstancedBufferGeometry=!0;class DT extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new ga(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(h,p){if(t[p]!==void 0)return t[p];const y=h.interleavedBuffers[p],m=s(h,y.buffer),f=ih(y.type,m),G=new iu(f,y.stride);return G.uuid=y.uuid,t[p]=G,G}function s(h,p){if(n[p]!==void 0)return n[p];const y=h.arrayBuffers[p],m=new Uint32Array(y).buffer;return n[p]=m,m}const o=e.isInstancedBufferGeometry?new WZ:new Nt,a=e.data.index;if(a!==void 0){const h=ih(a.type,a.array);o.setIndex(new rn(h,1))}const l=e.data.attributes;for(const h in l){const p=l[h];let b;if(p.isInterleavedBufferAttribute){const y=r(e.data,p.data);b=new Rc(y,p.itemSize,p.offset,p.normalized)}else{const y=ih(p.type,p.array),m=p.isInstancedBufferAttribute?su:rn;b=new m(y,p.itemSize,p.normalized)}p.name!==void 0&&(b.name=p.name),p.usage!==void 0&&b.setUsage(p.usage),p.updateRange!==void 0&&(b.updateRange.offset=p.updateRange.offset,b.updateRange.count=p.updateRange.count),o.setAttribute(h,b)}const c=e.data.morphAttributes;if(c)for(const h in c){const p=c[h],b=[];for(let y=0,m=p.length;y<m;y++){const f=p[y];let G;if(f.isInterleavedBufferAttribute){const x=r(e.data,f.data);G=new Rc(x,f.itemSize,f.offset,f.normalized)}else{const x=ih(f.type,f.array);G=new rn(x,f.itemSize,f.normalized)}f.name!==void 0&&(G.name=f.name),b.push(G)}o.morphAttributes[h]=b}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let h=0,p=d.length;h!==p;++h){const b=d[h];o.addGroup(b.start,b.count,b.materialIndex)}const u=e.data.boundingSphere;if(u!==void 0){const h=new te;u.center!==void 0&&h.fromArray(u.center),o.boundingSphere=new bc(h,u.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class zae extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=this.path===""?Ky.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new ga(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){r!==void 0&&r(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const g=c.metadata;if(g===void 0||g.type===void 0||g.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,r)}async loadAsync(e,t){const n=this,r=this.path===""?Ky.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new ga(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,n),g=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,g),t!==void 0){let d=!1;for(const u in o)if(o[u]instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new aa().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new Sy().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const r=new DT;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:l.type in MT?a=MT[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),a.isBufferGeometry===!0&&l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(e!==void 0){const s=new PT;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];if(l.type==="MultiMaterial"){const c=[];for(let g=0;g<l.materials.length;g++){const d=l.materials[g];n[d.uuid]===void 0&&(n[d.uuid]=s.parse(d)),c.push(n[d.uuid])}r[l.uuid]=c}else n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=xp.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,g=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(g)}else return l.data?{data:ih(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new yZ(t);s=new wp(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,g=e.length;c<g;c++){const d=e[c],u=d.url;if(Array.isArray(u)){const h=[];for(let p=0,b=u.length;p<b;p++){const y=u[p],m=a(y);m!==null&&(m instanceof HTMLImageElement?h.push(m):h.push(new ru(m.data,m.width,m.height)))}r[d.uuid]=new oh(h)}else{const h=a(d.url);r[d.uuid]=new oh(h)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:ih(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new wp(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const g=[];for(let d=0,u=c.length;d<u;d++){const h=c[d],p=await s(h);p!==null&&(p instanceof HTMLImageElement?g.push(p):g.push(new ru(p.data,p.width,p.height)))}n[l.uuid]=new oh(g)}else{const g=await s(l.url);n[l.uuid]=new oh(g)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let g;Array.isArray(c)?(g=new bh,c.length===6&&(g.needsUpdate=!0)):(c&&c.data?g=new ru:g=new hi,c&&(g.needsUpdate=!0)),g.source=l,g.uuid=a.uuid,a.name!==void 0&&(g.name=a.name),a.mapping!==void 0&&(g.mapping=n(a.mapping,kae)),a.offset!==void 0&&g.offset.fromArray(a.offset),a.repeat!==void 0&&g.repeat.fromArray(a.repeat),a.center!==void 0&&g.center.fromArray(a.center),a.rotation!==void 0&&(g.rotation=a.rotation),a.wrap!==void 0&&(g.wrapS=n(a.wrap[0],UT),g.wrapT=n(a.wrap[1],UT)),a.format!==void 0&&(g.format=a.format),a.type!==void 0&&(g.type=a.type),a.encoding!==void 0&&(g.encoding=a.encoding),a.minFilter!==void 0&&(g.minFilter=n(a.minFilter,OT)),a.magFilter!==void 0&&(g.magFilter=n(a.magFilter,OT)),a.anisotropy!==void 0&&(g.anisotropy=a.anisotropy),a.flipY!==void 0&&(g.flipY=a.flipY),a.premultiplyAlpha!==void 0&&(g.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(g.unpackAlignment=a.unpackAlignment),a.userData!==void 0&&(g.userData=a.userData),r[a.uuid]=g}return r}parseObject(e,t,n,r,s){let o;function a(u){return t[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",u),t[u]}function l(u){if(u!==void 0){if(Array.isArray(u)){const h=[];for(let p=0,b=u.length;p<b;p++){const y=u[p];n[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),h.push(n[y])}return h}return n[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",u),n[u]}}function c(u){return r[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",u),r[u]}let g,d;switch(e.type){case"Scene":o=new ap,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new lt(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new op(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new sp(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new Ri(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new vh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new ZZ(e.color,e.intensity);break;case"DirectionalLight":o=new SZ(e.color,e.intensity);break;case"PointLight":o=new BZ(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new RZ(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new wZ(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new vZ(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Bp().fromJSON(e);break;case"SkinnedMesh":g=a(e.geometry),d=l(e.material),o=new Gy(g,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":g=a(e.geometry),d=l(e.material),o=new yi(g,d);break;case"InstancedMesh":g=a(e.geometry),d=l(e.material);const u=e.count,h=e.instanceMatrix,p=e.instanceColor;o=new DS(g,d,u),o.instanceMatrix=new su(new Float32Array(h.array),16),p!==void 0&&(o.instanceColor=new su(new Float32Array(p.array),p.itemSize));break;case"LOD":o=new nT;break;case"Line":o=new il(a(e.geometry),l(e.material));break;case"LineLoop":o=new OS(a(e.geometry),l(e.material));break;case"LineSegments":o=new os(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new dp(a(e.geometry),l(e.material));break;case"Sprite":o=new vy(l(e.material));break;case"Group":o=new nu;break;case"Bone":o=new By;break;default:o=new Ut}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const u=e.children;for(let h=0;h<u.length;h++)o.add(this.parseObject(u[h],t,n,r,s))}if(e.animations!==void 0){const u=e.animations;for(let h=0;h<u.length;h++){const p=u[h];o.animations.push(s[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const u=e.levels;for(let h=0;h<u.length;h++){const p=u[h],b=o.getObjectByProperty("uuid",p.object);b!==void 0&&o.addLevel(b,p.distance)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=t[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const kae={UVMapping:Nb,CubeReflectionMapping:hc,CubeRefractionMapping:fc,EquirectangularReflectionMapping:zC,EquirectangularRefractionMapping:kC,CubeUVReflectionMapping:$d,CubeUVRefractionMapping:YC},UT={RepeatWrapping:KC,ClampToEdgeWrapping:Er,MirroredRepeatWrapping:PC},OT={NearestFilter:bi,NearestMipmapNearestFilter:Eb,NearestMipmapLinearFilter:Hb,LinearFilter:jn,LinearMipmapNearestFilter:kB,LinearMipmapLinearFilter:Xg};class JT extends Lr{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=du.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){du.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}JT.prototype.isImageBitmapLoader=!0;let Py;const _Z={getContext:function(){return Py===void 0&&(Py=new(window.AudioContext||window.webkitAudioContext)),Py},setContext:function(i){Py=i}};class QT extends Lr{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new ga(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const l=a.slice(0);_Z.getContext().decodeAudioData(l,function(g){t(g)})}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}}class jT extends Bp{constructor(e,t,n=1){super(void 0,n);const r=new lt().set(e),s=new lt().set(t),o=new te(r.r,r.g,r.b),a=new te(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}jT.prototype.isHemisphereLightProbe=!0;class qT extends Bp{constructor(e,t=1){super(void 0,t);const n=new lt().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}qT.prototype.isAmbientLightProbe=!0;const $T=new bt,eX=new bt,hu=new bt;class Yae{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ri,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ri,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,hu.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Ug*t.fov*.5)/t.zoom;let a,l;eX.elements[12]=-r,$T.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,hu.elements[0]=2*t.near/(l-a),hu.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(hu),a=-o*t.aspect-s,l=o*t.aspect-s,hu.elements[0]=2*t.near/(l-a),hu.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(hu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(eX),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply($T)}}class VZ{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=tX(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=tX();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function tX(){return(typeof performance=="undefined"?Date:performance).now()}const fu=new te,nX=new Zi,Kae=new te,Iu=new te;class Pae extends Ut{constructor(){super();this.type="AudioListener",this.context=_Z.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new VZ}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(fu,nX,Kae),Iu.set(0,0,-1).applyQuaternion(nX),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(fu.x,r),t.positionY.linearRampToValueAtTime(fu.y,r),t.positionZ.linearRampToValueAtTime(fu.z,r),t.forwardX.linearRampToValueAtTime(Iu.x,r),t.forwardY.linearRampToValueAtTime(Iu.y,r),t.forwardZ.linearRampToValueAtTime(Iu.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(fu.x,fu.y,fu.z),t.setOrientation(Iu.x,Iu.y,Iu.z,n.x,n.y,n.z)}}class NZ extends Ut{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Cu=new te,iX=new Zi,Dae=new te,pu=new te;class Uae extends NZ{constructor(e){super(e);this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Cu,iX,Dae),pu.set(0,0,1).applyQuaternion(iX);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Cu.x,n),t.positionY.linearRampToValueAtTime(Cu.y,n),t.positionZ.linearRampToValueAtTime(Cu.z,n),t.orientationX.linearRampToValueAtTime(pu.x,n),t.orientationY.linearRampToValueAtTime(pu.y,n),t.orientationZ.linearRampToValueAtTime(pu.z,n)}else t.setPosition(Cu.x,Cu.y,Cu.z),t.setOrientation(pu.x,pu.y,pu.z)}}class rX{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class sX{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){Zi.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;Zi.multiplyQuaternionsFlat(e,o,e,t,e,n),Zi.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const EZ="\\[\\]\\.:\\/",Oae=new RegExp("["+EZ+"]","g"),HZ="[^"+EZ+"]",Jae="[^"+EZ.replace("\\.","")+"]",Qae=/((?:WC+[\/:])*)/.source.replace("WC",HZ),jae=/(WCOD+)?/.source.replace("WCOD",Jae),qae=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",HZ),$ae=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",HZ),ele=new RegExp("^"+Qae+jae+qae+$ae+"$"),tle=["material","materials","bones"];class nle{constructor(e,t,n){const r=n||an.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class an{constructor(e,t,n){this.path=t,this.parsedPath=n||an.parseTrackName(t),this.node=an.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new an.Composite(e,t,n):new an(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Oae,"")}static parseTrackName(e){const t=ele.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);tle.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=an.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===c){c=g;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}an.Composite=nle;an.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};an.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};an.prototype.GetterByBindingType=[an.prototype._getValue_direct,an.prototype._getValue_array,an.prototype._getValue_arrayElement,an.prototype._getValue_toArray];an.prototype.SetterByBindingTypeAndVersioning=[[an.prototype._setValue_direct,an.prototype._setValue_direct_setNeedsUpdate,an.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[an.prototype._setValue_array,an.prototype._setValue_array_setNeedsUpdate,an.prototype._setValue_array_setMatrixWorldNeedsUpdate],[an.prototype._setValue_arrayElement,an.prototype._setValue_arrayElement_setNeedsUpdate,an.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[an.prototype._setValue_fromArray,an.prototype._setValue_fromArray_setNeedsUpdate,an.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class oX{constructor(){this.uuid=bs(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let g=0,d=arguments.length;g!==d;++g){const u=arguments[g],h=u.uuid;let p=t[h];if(p===void 0){p=l++,t[h]=p,e.push(u);for(let b=0,y=o;b!==y;++b)s[b].push(new an(u,n[b],r[b]))}else if(p<c){a=e[p];const b=--c,y=e[b];t[y.uuid]=p,e[p]=y,t[h]=b,e[b]=u;for(let m=0,f=o;m!==f;++m){const G=s[m],x=G[b];let B=G[p];G[p]=x,B===void 0&&(B=new an(u,n[m],r[m])),G[b]=B}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,g=t[c];if(g!==void 0&&g>=s){const d=s++,u=e[d];t[u.uuid]=g,e[g]=u,t[c]=d,e[d]=l;for(let h=0,p=r;h!==p;++h){const b=n[h],y=b[d],m=b[g];b[g]=y,b[d]=m}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],g=c.uuid,d=t[g];if(d!==void 0)if(delete t[g],d<s){const u=--s,h=e[u],p=--o,b=e[p];t[h.uuid]=d,e[d]=h,t[b.uuid]=u,e[u]=b,e.pop();for(let y=0,m=r;y!==m;++y){const f=n[y],G=f[u],x=f[p];f[d]=G,f[u]=x,f.pop()}}else{const u=--o,h=e[u];u>0&&(t[h.uuid]=d),e[d]=h,e.pop();for(let p=0,b=r;p!==b;++p){const y=n[p];y[d]=y[u],y.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,g=this.nCachedObjects_,d=new Array(c);r=s.length,n[e]=r,o.push(e),a.push(t),s.push(d);for(let u=g,h=l.length;u!==h;++u){const p=l[u];d[u]=new an(p,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}oX.prototype.isAnimationObjectGroup=!0;class ile{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Kg,endingEnd:Kg};for(let c=0;c!==o;++c){const g=s[c].createInterpolant(null);a[c]=g,g.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zF,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case gS:for(let g=0,d=l.length;g!==d;++g)l[g].evaluate(o),c[g].accumulateAdditive(a);break;case kb:default:for(let g=0,d=l.length;g!==d;++g)l[g].evaluate(o),c[g].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===kF;if(e===0)return s===-1?r:o&&(s&1)==1?t-r:r;if(n===XF){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)==1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Pg,r.endingEnd=Pg):(e?r.endingStart=this.zeroSlopeAtStart?Pg:Kg:r.endingStart=JC,t?r.endingEnd=this.zeroSlopeAtEnd?Pg:Kg:r.endingEnd=JC)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}class aX extends Ja{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let g=c[l];g===void 0&&(g={},c[l]=g);for(let d=0;d!==s;++d){const u=r[d],h=u.name;let p=g[h];if(p!==void 0)++p.referenceCount,o[d]=p;else{if(p=o[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,h));continue}const b=t&&t._propertyBindings[d].binding.parsedPath;p=new sX(an.create(n,h,b),u.ValueTypeName,u.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,h),o[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++==0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount==0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],g=e._byClipCacheIndex;c._byClipCacheIndex=g,l[g]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,u=(e._localRoot||this._root).uuid;delete d[u],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount==0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new AZ(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?xp.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=kb),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===n)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const g=new ile(this,o,t,n);return this._bindAction(g,c),this._addInactiveAction(g,a,s),g}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?xp.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const g=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=g,t[g]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}aX.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Dy{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Dy(this.value.clone===void 0?this.value:this.value.clone())}}class lX extends iu{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}lX.prototype.isInstancedInterleavedBuffer=!0;class cX{constructor(e,t,n,r,s){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}cX.prototype.isGLBufferAttribute=!0;class gX{constructor(e,t,n=0,r=1/0){this.ray=new vc(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new jg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return FZ(e,this,n,t),n.sort(uX),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)FZ(e[r],this,n,t);return n.sort(uX),n}}function uX(i,e){return i.distance-e.distance}function FZ(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)FZ(r[s],e,t,!0)}}class LZ{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(tr(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class rle{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const dX=new Ke;class kh{constructor(e=new Ke(1/0,1/0),t=new Ke(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=dX.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dX.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}kh.prototype.isBox2=!0;const hX=new te,Uy=new te;class fX{constructor(e=new te,t=new te){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){hX.subVectors(e,this.start),Uy.subVectors(this.end,this.start);const n=Uy.dot(Uy);let s=Uy.dot(hX)/n;return t&&(s=tr(s,0,1)),s}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const IX=new te;class sle extends Ut{constructor(e,t){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Nt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,g=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(g),Math.sin(g),1)}n.setAttribute("position",new At(r,3));const s=new Ti({fog:!1,toneMapped:!1});this.cone=new os(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),IX.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(IX),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _c=new te,Oy=new bt,TZ=new bt;class CX extends os{constructor(e){const t=pX(e),n=new Nt,r=[],s=[],o=new lt(0,0,1),a=new lt(0,1,0);for(let c=0;c<t.length;c++){const g=t[c];g.parent&&g.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new At(r,3)),n.setAttribute("color",new At(s,3));const l=new Ti({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");TZ.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(Oy.multiplyMatrices(TZ,a.matrixWorld),_c.setFromMatrixPosition(Oy),r.setXYZ(o,_c.x,_c.y,_c.z),Oy.multiplyMatrices(TZ,a.parent.matrixWorld),_c.setFromMatrixPosition(Oy),r.setXYZ(o+1,_c.x,_c.y,_c.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function pX(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,pX(i.children[t]));return e}class ole extends yi{constructor(e,t,n){const r=new cu(t,4,2),s=new tl({wireframe:!0,fog:!1,toneMapped:!1});super(r,s);this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ale=new te,mX=new lt,AX=new lt;class lle extends Ut{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new au(t);r.rotateY(Math.PI*.5),this.material=new tl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new rn(o,3)),this.add(new yi(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");mX.copy(this.light.color),AX.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?mX:AX;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}e.lookAt(ale.setFromMatrixPosition(this.light.matrixWorld).negate())}}class bX extends os{constructor(e=10,t=10,n=4473924,r=8947848){n=new lt(n),r=new lt(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let u=0,h=0,p=-a;u<=t;u++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const b=u===s?n:r;b.toArray(c,h),h+=3,b.toArray(c,h),h+=3,b.toArray(c,h),h+=3,b.toArray(c,h),h+=3}const g=new Nt;g.setAttribute("position",new At(l,3)),g.setAttribute("color",new At(c,3));const d=new Ti({vertexColors:!0,toneMapped:!1});super(g,d);this.type="GridHelper"}}class cle extends os{constructor(e=10,t=16,n=8,r=64,s=4473924,o=8947848){s=new lt(s),o=new lt(o);const a=[],l=[];for(let d=0;d<=t;d++){const u=d/t*(Math.PI*2),h=Math.sin(u)*e,p=Math.cos(u)*e;a.push(0,0,0),a.push(h,0,p);const b=d&1?s:o;l.push(b.r,b.g,b.b),l.push(b.r,b.g,b.b)}for(let d=0;d<=n;d++){const u=d&1?s:o,h=e-e/n*d;for(let p=0;p<r;p++){let b=p/r*(Math.PI*2),y=Math.sin(b)*h,m=Math.cos(b)*h;a.push(y,0,m),l.push(u.r,u.g,u.b),b=(p+1)/r*(Math.PI*2),y=Math.sin(b)*h,m=Math.cos(b)*h,a.push(y,0,m),l.push(u.r,u.g,u.b)}}const c=new Nt;c.setAttribute("position",new At(a,3)),c.setAttribute("color",new At(l,3));const g=new Ti({vertexColors:!0,toneMapped:!1});super(c,g);this.type="PolarGridHelper"}}const yX=new te,Jy=new te,vX=new te;class gle extends Ut{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let r=new Nt;r.setAttribute("position",new At([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Ti({fog:!1,toneMapped:!1});this.lightPlane=new il(r,s),this.add(this.lightPlane),r=new Nt,r.setAttribute("position",new At([0,0,0,0,0,1],3)),this.targetLine=new il(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){yX.setFromMatrixPosition(this.light.matrixWorld),Jy.setFromMatrixPosition(this.light.target.matrixWorld),vX.subVectors(Jy,yX),this.lightPlane.lookAt(Jy),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Jy),this.targetLine.scale.z=vX.length()}}const Qy=new te,si=new qg;class ule extends os{constructor(e){const t=new Nt,n=new Ti({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={},a=new lt(16755200),l=new lt(16711680),c=new lt(43775),g=new lt(16777215),d=new lt(3355443);u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",l),u("p","n2",l),u("p","n3",l),u("p","n4",l),u("u1","u2",c),u("u2","u3",c),u("u3","u1",c),u("c","t",g),u("p","c",d),u("cn1","cn2",d),u("cn3","cn4",d),u("cf1","cf2",d),u("cf3","cf4",d);function u(p,b,y){h(p,y),h(b,y)}function h(p,b){r.push(0,0,0),s.push(b.r,b.g,b.b),o[p]===void 0&&(o[p]=[]),o[p].push(r.length/3-1)}t.setAttribute("position",new At(r,3)),t.setAttribute("color",new At(s,3));super(t,n);this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;si.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pi("c",t,e,si,0,0,-1),pi("t",t,e,si,0,0,1),pi("n1",t,e,si,-n,-r,-1),pi("n2",t,e,si,n,-r,-1),pi("n3",t,e,si,-n,r,-1),pi("n4",t,e,si,n,r,-1),pi("f1",t,e,si,-n,-r,1),pi("f2",t,e,si,n,-r,1),pi("f3",t,e,si,-n,r,1),pi("f4",t,e,si,n,r,1),pi("u1",t,e,si,n*.7,r*1.1,-1),pi("u2",t,e,si,-n*.7,r*1.1,-1),pi("u3",t,e,si,0,r*2,-1),pi("cf1",t,e,si,-n,0,1),pi("cf2",t,e,si,n,0,1),pi("cf3",t,e,si,0,-r,1),pi("cf4",t,e,si,0,r,1),pi("cn1",t,e,si,-n,0,-1),pi("cn2",t,e,si,n,0,-1),pi("cn3",t,e,si,0,-r,-1),pi("cn4",t,e,si,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function pi(i,e,t,n,r,s,o){Qy.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,g=a.length;c<g;c++)l.setXYZ(a[c],Qy.x,Qy.y,Qy.z)}}const jy=new ys;class xX extends os{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Nt;s.setIndex(new rn(n,1)),s.setAttribute("position",new rn(r,3));super(s,new Ti({color:t,toneMapped:!1}));this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&jy.setFromObject(this.object),jy.isEmpty())return;const t=jy.min,n=jy.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return os.prototype.copy.call(this,e),this.object=e.object,this}}class dle extends os{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Nt;s.setIndex(new rn(n,1)),s.setAttribute("position",new At(r,3));super(s,new Ti({color:t,toneMapped:!1}));this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class hle extends il{constructor(e,t=1,n=16776960){const r=n,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new Nt;o.setAttribute("position",new At(s,3)),o.computeBoundingSphere();super(o,new Ti({color:r,toneMapped:!1}));this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new Nt;l.setAttribute("position",new At(a,3)),l.computeBoundingSphere(),this.add(new yi(l,new tl({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?di:Hg,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const wX=new te;let qy,XZ;class fle extends Ut{constructor(e=new te(0,0,1),t=new te(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super();this.type="ArrowHelper",qy===void 0&&(qy=new Nt,qy.setAttribute("position",new At([0,0,0,0,1,0],3)),XZ=new Mc(0,.5,1,5,1),XZ.translate(0,-.5,0)),this.position.copy(t),this.line=new il(qy,new Ti({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new yi(XZ,new tl({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{wX.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(wX,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class GX extends os{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Nt;r.setAttribute("position",new At(t,3)),r.setAttribute("color",new At(n,3));const s=new Ti({vertexColors:!0,toneMapped:!1});super(r,s);this.type="AxesHelper"}setColors(e,t,n){const r=new lt,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ile{constructor(){this.type="ShapePath",this.color=new lt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new pp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,s,o){return this.currentPath.bezierCurveTo(e,t,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(f){const G=[];for(let x=0,B=f.length;x<B;x++){const M=f[x],E=new aa;E.curves=M.curves,G.push(E)}return G}function r(f,G){const x=G.length;let B=!1;for(let M=x-1,E=0;E<x;M=E++){let z=G[M],J=G[E],V=J.x-z.x,I=J.y-z.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(z=G[E],V=-V,J=G[M],I=-I),f.y<z.y||f.y>J.y)continue;if(f.y===z.y){if(f.x===z.x)return!0}else{const w=I*(f.x-z.x)-V*(f.y-z.y);if(w===0)return!0;if(w<0)continue;B=!B}}else{if(f.y!==z.y)continue;if(J.x<=f.x&&f.x<=z.x||z.x<=f.x&&f.x<=J.x)return!0}}return B}const s=la.isClockWise,o=this.subPaths;if(o.length===0)return[];if(t===!0)return n(o);let a,l,c;const g=[];if(o.length===1)return l=o[0],c=new aa,c.curves=l.curves,g.push(c),g;let d=!s(o[0].getPoints());d=e?!d:d;const u=[],h=[];let p=[],b=0,y;h[b]=void 0,p[b]=[];for(let f=0,G=o.length;f<G;f++)l=o[f],y=l.getPoints(),a=s(y),a=e?!a:a,a?(!d&&h[b]&&b++,h[b]={s:new aa,p:y},h[b].s.curves=l.curves,d&&b++,p[b]=[]):p[b].push({h:l,p:y[0]});if(!h[0])return n(o);if(h.length>1){let f=!1,G=0;for(let x=0,B=h.length;x<B;x++)u[x]=[];for(let x=0,B=h.length;x<B;x++){const M=p[x];for(let E=0;E<M.length;E++){const z=M[E];let J=!0;for(let V=0;V<h.length;V++)r(z.p,h[V].p)&&(x!==V&&G++,J?(J=!1,u[V].push(z)):f=!0);J&&u[x].push(z)}}G>0&&f===!1&&(p=u)}let m;for(let f=0,G=h.length;f<G;f++){c=h[f].s,g.push(c),m=p[f];for(let x=0,B=m.length;x<B;x++)c.holes.push(m[x].h)}return g}}const BX=new Float32Array(1),Cle=new Int32Array(BX.buffer);class ple{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),BX[0]=e;const t=Cle[0];let n=t>>16&32768,r=t>>12&2047;const s=t>>23&255;return s<103?n:s>142?(n|=31744,n|=(s==255?0:1)&&t&8388607,n):s<113?(r|=2048,n|=(r>>114-s)+(r>>113-s&1),n):(n|=s-112<<10|r>>1,n+=r&1,n)}}const mle=0,Ale=1,ble=0,yle=1,vle=2;function xle(i){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),i}function wle(i=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),i.isMultiMaterial=!0,i.materials=i,i.clone=function(){return i.slice()},i}function Gle(i,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new dp(i,e)}function Ble(i){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new vy(i)}function Sle(i,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new dp(i,e)}function Zle(i){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ou(i)}function Rle(i){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ou(i)}function Mle(i){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ou(i)}function Wle(i,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new te(i,e,t)}function _le(i,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new rn(i,e).setUsage(nh)}function Vle(i,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new uL(i,e)}function Nle(i,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new dL(i,e)}function Ele(i,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new hL(i,e)}function Hle(i,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new fL(i,e)}function Fle(i,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ny(i,e)}function Lle(i,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new IL(i,e)}function Tle(i,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new iy(i,e)}function Xle(i,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new At(i,e)}function zle(i,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new pL(i,e)}ws.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(ws.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i};pp.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};function kle(i){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new GX(i)}function Yle(i,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new xX(i,e)}function Kle(i,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new os(new qS(i.geometry),new Ti({color:e!==void 0?e:16777215}))}bX.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};CX.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function Ple(i,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new os(new cZ(i.geometry),new Ti({color:e!==void 0?e:16777215}))}Lr.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ky.extractUrlBase(i)};Lr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function Dle(i){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ga(i)}function Ule(i){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new HT(i)}kh.prototype.center=function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)};kh.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};kh.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};kh.prototype.size=function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)};ys.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};ys.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ys.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};ys.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};ys.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};wc.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};bc.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ip.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};fX.prototype.center=function(i){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(i)};Si.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};Si.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Si.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Si.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Si.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Si.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};bt.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};bt.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};bt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new te().setFromMatrixColumn(this,3)};bt.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};bt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};bt.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};bt.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};bt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};bt.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};bt.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};bt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};bt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};bt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};bt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};bt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};bt.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};bt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};bt.prototype.makeFrustum=function(i,e,t,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,n,t,r,s)};bt.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};sa.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};Zi.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};Zi.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};vc.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};vc.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};vc.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};fi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};fi.prototype.barycoordFromPoint=function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)};fi.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};fi.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};fi.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};fi.barycoordFromPoint=function(i,e,t,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),fi.getBarycoord(i,e,t,n,r)};fi.normal=function(i,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),fi.getNormal(i,e,t,n)};aa.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};aa.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ca(this,i)};aa.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new lu(this,i)};Ke.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};Ke.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};Ke.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};te.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};te.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};te.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};te.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};te.prototype.getColumnFromMatrix=function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)};te.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};te.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};te.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};te.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};mn.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};mn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ut.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};Ut.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Ut.prototype.translate=function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)};Ut.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Ut.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Ut.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});yi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(yi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),YF},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Gy.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Ri.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)};Object.defineProperties(Go.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(rn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===nh},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(nh)}}});rn.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?nh:th),this};rn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},rn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Nt.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};Nt.prototype.addAttribute=function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new rn(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)};Nt.prototype.addDrawCall=function(i,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)};Nt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Nt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Nt.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};Nt.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Nt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});iu.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?nh:th),this};iu.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ca.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};ca.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};ca.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};ap.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Dy.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(Ii.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new lt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===VB}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(js.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});An.prototype.clearTarget=function(i,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,t,n)};An.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};An.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};An.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};An.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};An.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};An.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};An.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};An.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};An.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};An.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};An.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};An.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};An.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};An.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};An.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};An.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};An.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};An.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};An.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};An.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};An.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};An.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};An.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};An.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(An.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Mn:Ao}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(JL.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function Ole(i,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new hy(i,t)}Object.defineProperties(Hr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});NZ.prototype.load=function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new QT().load(i,function(n){e.setBuffer(n)}),this};rX.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};dy.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)};dy.prototype.clear=function(i,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,t,n)};pc.crossOrigin=void 0;pc.loadTexture=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new FT;r.setCrossOrigin(this.crossOrigin);const s=r.load(i,t,void 0,n);return e&&(s.mapping=e),s};pc.loadTextureCube=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new ET;r.setCrossOrigin(this.crossOrigin);const s=r.load(i,t,void 0,n);return e&&(s.mapping=e),s};pc.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};pc.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function Jle(){console.error("THREE.CanvasRenderer has been removed")}function Qle(){console.error("THREE.JSONLoader has been removed.")}const jle={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function qle(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function $le(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Nt}function ece(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Nt}function tce(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function nce(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function ice(){console.error("THREE.ImmediateRenderObject has been removed.")}function rce(i,e,t){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const n=new Hr(i,e,t);return n.samples=4,n}function sce(i,e,t,n){return console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),new ah(i,e,t,n)}function oce(i,e,t,n){return console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),new $C(i,e,t,n)}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_b}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_b);var ace=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ACESFilmicToneMapping:zB,AddEquation:Tg,AddOperation:bF,AdditiveAnimationBlendMode:gS,AdditiveBlending:NB,AlphaFormat:MF,AlwaysDepth:hF,AlwaysStencilFunc:UF,AmbientLight:ZZ,AmbientLightProbe:qT,AnimationClip:xp,AnimationLoader:Tae,AnimationMixer:aX,AnimationObjectGroup:oX,AnimationUtils:kn,ArcCurve:$S,ArrayCamera:kS,ArrowHelper:fle,Audio:NZ,AudioAnalyser:rX,AudioContext:_Z,AudioListener:Pae,AudioLoader:QT,AxesHelper:GX,AxisHelper:kle,BackSide:di,BasicDepthPacking:KF,BasicShadowMap:Fte,BinaryTextureLoader:Ule,Bone:By,BooleanKeyframeTrack:gu,BoundingBoxHelper:Yle,Box2:kh,Box3:ys,Box3Helper:dle,BoxBufferGeometry:nl,BoxGeometry:nl,BoxHelper:xX,BufferAttribute:rn,BufferGeometry:Nt,BufferGeometryLoader:DT,ByteType:GF,Cache:du,Camera:qg,CameraHelper:ule,CanvasRenderer:Jle,CanvasTexture:AT,CatmullRomCurve3:rZ,CineonToneMapping:xF,CircleBufferGeometry:Mh,CircleGeometry:Mh,ClampToEdgeWrapping:Er,Clock:VZ,Color:lt,ColorKeyframeTrack:bZ,CompressedTexture:QS,CompressedTextureLoader:Xae,ConeBufferGeometry:Wh,ConeGeometry:Wh,CubeCamera:dy,CubeReflectionMapping:hc,CubeRefractionMapping:fc,CubeTexture:bh,CubeTextureLoader:ET,CubeUVReflectionMapping:$d,CubeUVRefractionMapping:YC,CubicBezierCurve:Hy,CubicBezierCurve3:sZ,CubicInterpolant:WT,CullFaceBack:MB,CullFaceFront:$H,CullFaceFrontBack:Hte,CullFaceNone:qH,Curve:ws,CurvePath:vT,CustomBlending:eF,CustomToneMapping:wF,CylinderBufferGeometry:Mc,CylinderGeometry:Mc,Cylindrical:rle,Data3DTexture:$C,DataArrayTexture:ah,DataTexture:ru,DataTexture2DArray:sce,DataTexture3D:oce,DataTextureLoader:HT,DataUtils:ple,DecrementStencilOp:Ote,DecrementWrapStencilOp:Qte,DefaultLoadingManager:NT,DepthFormat:Cc,DepthStencilFormat:Yg,DepthTexture:KS,DirectionalLight:SZ,DirectionalLightHelper:gle,DiscreteInterpolant:_T,DodecahedronBufferGeometry:_h,DodecahedronGeometry:_h,DoubleSide:Fg,DstAlphaFactor:aF,DstColorFactor:cF,DynamicBufferAttribute:_le,DynamicCopyUsage:gne,DynamicDrawUsage:nh,DynamicReadUsage:ane,EdgesGeometry:qS,EdgesHelper:Kle,EllipseCurve:hp,EqualDepth:IF,EqualStencilFunc:ene,EquirectangularReflectionMapping:zC,EquirectangularRefractionMapping:kC,Euler:wc,EventDispatcher:Ja,ExtrudeBufferGeometry:ca,ExtrudeGeometry:ca,FaceColors:yle,FileLoader:ga,FlatShading:VB,Float16BufferAttribute:CL,Float32Attribute:Xle,Float32BufferAttribute:At,Float64Attribute:zle,Float64BufferAttribute:pL,FloatType:Oa,Fog:op,FogExp2:sp,Font:nce,FontLoader:tce,FramebufferTexture:mT,FrontSide:Hg,Frustum:ip,GLBufferAttribute:cX,GLSL1:dne,GLSL3:uS,GreaterDepth:pF,GreaterEqualDepth:CF,GreaterEqualStencilFunc:rne,GreaterStencilFunc:nne,GridHelper:bX,Group:nu,HalfFloatType:zg,HemisphereLight:vZ,HemisphereLightHelper:lle,HemisphereLightProbe:jT,IcosahedronBufferGeometry:Nh,IcosahedronGeometry:Nh,ImageBitmapLoader:JT,ImageLoader:wp,ImageUtils:pc,ImmediateRenderObject:ice,IncrementStencilOp:Ute,IncrementWrapStencilOp:Jte,InstancedBufferAttribute:su,InstancedBufferGeometry:WZ,InstancedInterleavedBuffer:lX,InstancedMesh:DS,Int16Attribute:Hle,Int16BufferAttribute:fL,Int32Attribute:Lle,Int32BufferAttribute:IL,Int8Attribute:Vle,Int8BufferAttribute:uL,IntType:SF,InterleavedBuffer:iu,InterleavedBufferAttribute:Rc,Interpolant:rl,InterpolateDiscrete:UC,InterpolateLinear:OC,InterpolateSmooth:zb,InvertStencilOp:jte,JSONLoader:Qle,KeepStencilOp:Yb,KeyframeTrack:wo,LOD:nT,LatheBufferGeometry:Eh,LatheGeometry:Eh,Layers:jg,LensFlare:qle,LessDepth:fF,LessEqualDepth:Vb,LessEqualStencilFunc:tne,LessStencilFunc:$te,Light:Go,LightProbe:Bp,Line:il,Line3:fX,LineBasicMaterial:Ti,LineCurve:Cp,LineCurve3:yT,LineDashedMaterial:mZ,LineLoop:OS,LinePieces:Ale,LineSegments:os,LineStrip:mle,LinearEncoding:Ao,LinearFilter:jn,LinearInterpolant:AZ,LinearMipMapLinearFilter:kte,LinearMipMapNearestFilter:zte,LinearMipmapLinearFilter:Xg,LinearMipmapNearestFilter:kB,LinearToneMapping:yF,Loader:Lr,LoaderUtils:Ky,LoadingManager:yZ,LoopOnce:XF,LoopPingPong:kF,LoopRepeat:zF,LuminanceAlphaFormat:VF,LuminanceFormat:_F,MOUSE:Ng,Material:Ii,MaterialLoader:PT,Math:JF,MathUtils:JF,Matrix3:Si,Matrix4:bt,MaxEquation:LB,Mesh:yi,MeshBasicMaterial:tl,MeshDepthMaterial:py,MeshDistanceMaterial:my,MeshFaceMaterial:xle,MeshLambertMaterial:CZ,MeshMatcapMaterial:pZ,MeshNormalMaterial:IZ,MeshPhongMaterial:hZ,MeshPhysicalMaterial:dZ,MeshStandardMaterial:Yy,MeshToonMaterial:fZ,MinEquation:FB,MirroredRepeatWrapping:PC,MixOperation:AF,MultiMaterial:wle,MultiplyBlending:HB,MultiplyOperation:XC,NearestFilter:bi,NearestMipMapLinearFilter:Xte,NearestMipMapNearestFilter:Tte,NearestMipmapLinearFilter:Hb,NearestMipmapNearestFilter:Eb,NeverDepth:dF,NeverStencilFunc:qte,NoBlending:Ua,NoColors:ble,NoToneMapping:ra,NormalAnimationBlendMode:kb,NormalBlending:Lg,NotEqualDepth:mF,NotEqualStencilFunc:ine,NumberKeyframeTrack:yp,Object3D:Ut,ObjectLoader:zae,ObjectSpaceNormalMap:DF,OctahedronBufferGeometry:au,OctahedronGeometry:au,OneFactor:rF,OneMinusDstAlphaFactor:lF,OneMinusDstColorFactor:gF,OneMinusSrcAlphaFactor:XB,OneMinusSrcColorFactor:oF,OrthographicCamera:vh,PCFShadowMap:WB,PCFSoftShadowMap:_B,PMREMGenerator:FS,ParametricGeometry:$le,Particle:Ble,ParticleBasicMaterial:Rle,ParticleSystem:Sle,ParticleSystemMaterial:Mle,Path:pp,PerspectiveCamera:Ri,Plane:sa,PlaneBufferGeometry:$g,PlaneGeometry:$g,PlaneHelper:hle,PointCloud:Gle,PointCloudMaterial:Zle,PointLight:BZ,PointLightHelper:ole,Points:dp,PointsMaterial:ou,PolarGridHelper:cle,PolyhedronBufferGeometry:oa,PolyhedronGeometry:oa,PositionalAudio:Uae,PropertyBinding:an,PropertyMixer:sX,QuadraticBezierCurve:Fy,QuadraticBezierCurve3:Ly,Quaternion:Zi,QuaternionKeyframeTrack:zh,QuaternionLinearInterpolant:VT,REVISION:_b,RGBADepthPacking:PF,RGBAFormat:Ar,RGBAIntegerFormat:LF,RGBA_ASTC_10x10_Format:oS,RGBA_ASTC_10x5_Format:iS,RGBA_ASTC_10x6_Format:rS,RGBA_ASTC_10x8_Format:sS,RGBA_ASTC_12x10_Format:aS,RGBA_ASTC_12x12_Format:lS,RGBA_ASTC_4x4_Format:JB,RGBA_ASTC_5x4_Format:QB,RGBA_ASTC_5x5_Format:jB,RGBA_ASTC_6x5_Format:qB,RGBA_ASTC_6x6_Format:$B,RGBA_ASTC_8x5_Format:eS,RGBA_ASTC_8x6_Format:tS,RGBA_ASTC_8x8_Format:nS,RGBA_BPTC_Format:cS,RGBA_ETC2_EAC_Format:OB,RGBA_PVRTC_2BPPV1_Format:DB,RGBA_PVRTC_4BPPV1_Format:PB,RGBA_S3TC_DXT1_Format:Lb,RGBA_S3TC_DXT3_Format:Tb,RGBA_S3TC_DXT5_Format:Xb,RGBFormat:WF,RGB_ETC1_Format:TF,RGB_ETC2_Format:UB,RGB_PVRTC_2BPPV1_Format:KB,RGB_PVRTC_4BPPV1_Format:YB,RGB_S3TC_DXT1_Format:Fb,RGFormat:HF,RGIntegerFormat:FF,RawShaderMaterial:uZ,Ray:vc,Raycaster:gX,RectAreaLight:RZ,RedFormat:NF,RedIntegerFormat:EF,ReinhardToneMapping:vF,RepeatWrapping:KC,ReplaceStencilOp:Dte,ReverseSubtractEquation:nF,RingBufferGeometry:Hh,RingGeometry:Hh,Scene:ap,SceneUtils:jle,ShaderChunk:Dt,ShaderLib:xo,ShaderMaterial:js,ShadowMaterial:gZ,Shape:aa,ShapeBufferGeometry:lu,ShapeGeometry:lu,ShapePath:Ile,ShapeUtils:la,ShortType:BF,Skeleton:Sy,SkeletonHelper:CX,SkinnedMesh:Gy,SmoothShading:Lte,Sphere:bc,SphereBufferGeometry:cu,SphereGeometry:cu,Spherical:LZ,SphericalHarmonics3:MZ,SplineCurve:Ty,SpotLight:wZ,SpotLightHelper:sle,Sprite:vy,SpriteMaterial:Ay,SrcAlphaFactor:TB,SrcAlphaSaturateFactor:uF,SrcColorFactor:sF,StaticCopyUsage:cne,StaticDrawUsage:th,StaticReadUsage:one,StereoCamera:Yae,StreamCopyUsage:une,StreamDrawUsage:sne,StreamReadUsage:lne,StringKeyframeTrack:uu,SubtractEquation:tF,SubtractiveBlending:EB,TOUCH:Eg,TangentSpaceNormalMap:Dg,TetrahedronBufferGeometry:Fh,TetrahedronGeometry:Fh,TextGeometry:ece,Texture:hi,TextureLoader:FT,TorusBufferGeometry:Lh,TorusGeometry:Lh,TorusKnotBufferGeometry:Th,TorusKnotGeometry:Th,Triangle:fi,TriangleFanDrawMode:Kte,TriangleStripDrawMode:Yte,TrianglesDrawMode:YF,TubeBufferGeometry:Xh,TubeGeometry:Xh,UVMapping:Nb,Uint16Attribute:Fle,Uint16BufferAttribute:ny,Uint32Attribute:Tle,Uint32BufferAttribute:iy,Uint8Attribute:Nle,Uint8BufferAttribute:dL,Uint8ClampedAttribute:Ele,Uint8ClampedBufferAttribute:hL,Uniform:Dy,UniformsLib:rt,UniformsUtils:AL,UnsignedByteType:Ic,UnsignedInt248Type:kg,UnsignedIntType:DC,UnsignedShort4444Type:ZF,UnsignedShort5551Type:RF,UnsignedShortType:eh,VSMShadowMap:qd,Vector2:Ke,Vector3:te,Vector4:mn,VectorKeyframeTrack:vp,Vertex:Wle,VertexColors:vle,VideoTexture:pT,WebGL1Renderer:jL,WebGL3DRenderTarget:$F,WebGLArrayRenderTarget:qF,WebGLCubeRenderTarget:hy,WebGLMultipleRenderTargets:eL,WebGLMultisampleRenderTarget:rce,WebGLRenderTarget:Hr,WebGLRenderTargetCube:Ole,WebGLRenderer:An,WebGLUtils:QL,WireframeGeometry:cZ,WireframeHelper:Ple,WrapAroundEnding:JC,XHRLoader:Dle,ZeroCurvatureEnding:Kg,ZeroFactor:iF,ZeroSlopeEnding:Pg,ZeroStencilOp:Pte,_SRGBAFormat:Kb,sRGBEncoding:Mn});function lce(i){let e;const t=new Set,n=(c,g)=>{const d=typeof c=="function"?c(e):c;if(d!==e){const u=e;e=g?d:Object.assign({},e,d),t.forEach(h=>h(e,u))}},r=()=>e,s=(c,g=r,d=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let u=g(e);function h(){const p=g(e);if(!d(u,p)){const b=u;c(u=p,b)}}return t.add(h),()=>t.delete(h)},l={setState:n,getState:r,subscribe:(c,g,d)=>g||d?s(c,g,d):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const cce=typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),SX=cce?ue.exports.useEffect:ue.exports.useLayoutEffect;function gce(i){const e=typeof i=="function"?lce(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=ue.exports.useReducer(y=>y+1,0),o=e.getState(),a=ue.exports.useRef(o),l=ue.exports.useRef(n),c=ue.exports.useRef(r),g=ue.exports.useRef(!1),d=ue.exports.useRef();d.current===void 0&&(d.current=n(o));let u,h=!1;(a.current!==o||l.current!==n||c.current!==r||g.current)&&(u=n(o),h=!r(d.current,u)),SX(()=>{h&&(d.current=u),a.current=o,l.current=n,c.current=r,g.current=!1});const p=ue.exports.useRef(o);SX(()=>{const y=()=>{try{const f=e.getState(),G=l.current(f);c.current(d.current,G)||(a.current=f,d.current=G,s())}catch{g.current=!0,s()}},m=e.subscribe(y);return e.getState()!==p.current&&y(),m},[]);const b=h?u:d.current;return ue.exports.useDebugValue(b),b};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}var ZX={exports:{}},RX={exports:{}};/** @license React v0.26.2
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){i.exports=function(t){var n={},r=nw,s=ue.exports,o=Ku.exports;function a(C){for(var A="https://reactjs.org/docs/error-decoder.html?invariant="+C,v=1;v<arguments.length;v++)A+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+C+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=60103,g=60106,d=60107,u=60108,h=60114,p=60109,b=60110,y=60112,m=60113,f=60120,G=60115,x=60116,B=60121,M=60129,E=60130,z=60131;if(typeof Symbol=="function"&&Symbol.for){var J=Symbol.for;c=J("react.element"),g=J("react.portal"),d=J("react.fragment"),u=J("react.strict_mode"),h=J("react.profiler"),p=J("react.provider"),b=J("react.context"),y=J("react.forward_ref"),m=J("react.suspense"),f=J("react.suspense_list"),G=J("react.memo"),x=J("react.lazy"),B=J("react.block"),J("react.scope"),M=J("react.debug_trace_mode"),E=J("react.offscreen"),z=J("react.legacy_hidden")}var V=typeof Symbol=="function"&&Symbol.iterator;function I(C){return C===null||typeof C!="object"?null:(C=V&&C[V]||C["@@iterator"],typeof C=="function"?C:null)}function w(C){if(C==null)return null;if(typeof C=="function")return C.displayName||C.name||null;if(typeof C=="string")return C;switch(C){case d:return"Fragment";case g:return"Portal";case h:return"Profiler";case u:return"StrictMode";case m:return"Suspense";case f:return"SuspenseList"}if(typeof C=="object")switch(C.$$typeof){case b:return(C.displayName||"Context")+".Consumer";case p:return(C._context.displayName||"Context")+".Provider";case y:var A=C.render;return A=A.displayName||A.name||"",C.displayName||(A!==""?"ForwardRef("+A+")":"ForwardRef");case G:return w(C.type);case B:return w(C._render);case x:A=C._payload,C=C._init;try{return w(C(A))}catch{}}return null}function S(C){var A=C,v=C;if(C.alternate)for(;A.return;)A=A.return;else{C=A;do A=C,(A.flags&1026)!=0&&(v=A.return),C=A.return;while(C)}return A.tag===3?v:null}function R(C){if(S(C)!==C)throw Error(a(188))}function W(C){var A=C.alternate;if(!A){if(A=S(C),A===null)throw Error(a(188));return A!==C?null:C}for(var v=C,N=A;;){var L=v.return;if(L===null)break;var Q=L.alternate;if(Q===null){if(N=L.return,N!==null){v=N;continue}break}if(L.child===Q.child){for(Q=L.child;Q;){if(Q===v)return R(L),C;if(Q===N)return R(L),A;Q=Q.sibling}throw Error(a(188))}if(v.return!==N.return)v=L,N=Q;else{for(var ce=!1,Ae=L.child;Ae;){if(Ae===v){ce=!0,v=L,N=Q;break}if(Ae===N){ce=!0,N=L,v=Q;break}Ae=Ae.sibling}if(!ce){for(Ae=Q.child;Ae;){if(Ae===v){ce=!0,v=Q,N=L;break}if(Ae===N){ce=!0,N=Q,v=L;break}Ae=Ae.sibling}if(!ce)throw Error(a(189))}}if(v.alternate!==N)throw Error(a(190))}if(v.tag!==3)throw Error(a(188));return v.stateNode.current===v?C:A}function H(C){if(C=W(C),!C)return null;for(var A=C;;){if(A.tag===5||A.tag===6)return A;if(A.child)A.child.return=A,A=A.child;else{if(A===C)break;for(;!A.sibling;){if(!A.return||A.return===C)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}}return null}function k(C){if(C=W(C),!C)return null;for(var A=C;;){if(A.tag===5||A.tag===6)return A;if(A.child&&A.tag!==4)A.child.return=A,A=A.child;else{if(A===C)break;for(;!A.sibling;){if(!A.return||A.return===C)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}}return null}function _(C,A){for(var v=C.alternate;A!==null;){if(A===C||A===v)return!0;A=A.return}return!1}var Z=t.getPublicInstance,T=t.getRootHostContext,F=t.getChildHostContext,K=t.prepareForCommit,j=t.resetAfterCommit,O=t.createInstance,Y=t.appendInitialChild,ee=t.finalizeInitialChildren,ye=t.prepareUpdate,Ce=t.shouldSetTextContent,he=t.createTextInstance,Ne=t.scheduleTimeout,He=t.cancelTimeout,ne=t.noTimeout,de=t.isPrimaryRenderer,Ie=t.supportsMutation,Be=t.supportsPersistence,Re=t.supportsHydration,Xe=t.getInstanceFromNode,Le=t.makeOpaqueHydratingObject,Qe=t.makeClientId,et=t.beforeActiveInstanceBlur,q=t.afterActiveInstanceBlur,X=t.preparePortalMount,D=t.supportsTestSelectors,ge=t.findFiberRoot,Se=t.getBoundingRect,Me=t.getTextContent,pe=t.isHiddenSubtree,we=t.matchAccessibilityRole,re=t.setFocusIfFocusable,be=t.setupIntersectionObserver,_e=t.appendChild,Ee=t.appendChildToContainer,U=t.commitTextUpdate,Fe=t.commitMount,Ze=t.commitUpdate,Ye=t.insertBefore,me=t.insertInContainerBefore,Ge=t.removeChild,Pe=t.removeChildFromContainer,ht=t.resetTextContent,wt=t.hideInstance,nt=t.hideTextInstance,un=t.unhideInstance,Et=t.unhideTextInstance,Jt=t.clearContainer,sr=t.cloneInstance,en=t.createContainerChildSet,qt=t.appendChildToContainerChildSet,Yr=t.finalizeContainerChildren,ln=t.replaceContainerChildren,cn=t.cloneHiddenInstance,ie=t.cloneHiddenTextInstance,P=t.canHydrateInstance,$=t.canHydrateTextInstance,le=t.isSuspenseInstancePending,ae=t.isSuspenseInstanceFallback,xe=t.getNextHydratableSibling,Je=t.getFirstHydratableChild,De=t.hydrateInstance,Ue=t.hydrateTextInstance,st=t.getNextHydratableInstanceAfterSuspenseInstance,ut=t.commitHydratedContainer,ct=t.commitHydratedSuspenseInstance,mt;function Pt(C){if(mt===void 0)try{throw Error()}catch(v){var A=v.stack.trim().match(/\n( *(at )?)/);mt=A&&A[1]||""}return`
`+mt+C}var ei=!1;function Ht(C,A){if(!C||ei)return"";ei=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(A)if(A=function(){throw Error()},Object.defineProperty(A.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(A,[])}catch(Te){var N=Te}Reflect.construct(C,[],A)}else{try{A.call()}catch(Te){N=Te}C.call(A.prototype)}else{try{throw Error()}catch(Te){N=Te}C()}}catch(Te){if(Te&&N&&typeof Te.stack=="string"){for(var L=Te.stack.split(`
`),Q=N.stack.split(`
`),ce=L.length-1,Ae=Q.length-1;1<=ce&&0<=Ae&&L[ce]!==Q[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(L[ce]!==Q[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||L[ce]!==Q[Ae])return`
`+L[ce].replace(" at new "," at ");while(1<=ce&&0<=Ae);break}}}finally{ei=!1,Error.prepareStackTrace=v}return(C=C?C.displayName||C.name:"")?Pt(C):""}var Ln=[],kt=-1;function St(C){return{current:C}}function Yt(C){0>kt||(C.current=Ln[kt],Ln[kt]=null,kt--)}function yt(C,A){kt++,Ln[kt]=C.current,C.current=A}var sn={},Ft=St(sn),In=St(!1),Bn=sn;function Sn(C,A){var v=C.type.contextTypes;if(!v)return sn;var N=C.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===A)return N.__reactInternalMemoizedMaskedChildContext;var L={},Q;for(Q in v)L[Q]=A[Q];return N&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=A,C.__reactInternalMemoizedMaskedChildContext=L),L}function Yn(C){return C=C.childContextTypes,C!=null}function Rs(){Yt(In),Yt(Ft)}function Kr(C,A,v){if(Ft.current!==sn)throw Error(a(168));yt(Ft,A),yt(In,v)}function ZR(C,A,v){var N=C.stateNode;if(C=A.childContextTypes,typeof N.getChildContext!="function")return v;N=N.getChildContext();for(var L in N)if(!(L in C))throw Error(a(108,w(A)||"Unknown",L));return r({},v,N)}function d0(C){return C=(C=C.stateNode)&&C.__reactInternalMemoizedMergedChildContext||sn,Bn=Ft.current,yt(Ft,C),yt(In,In.current),!0}function RR(C,A,v){var N=C.stateNode;if(!N)throw Error(a(169));v?(C=ZR(C,A,Bn),N.__reactInternalMemoizedMergedChildContext=C,Yt(In),Yt(Ft),yt(Ft,C)):Yt(In),yt(In,v)}var nx=null,qc=null,pK=o.unstable_now;pK();var h0=0,Vn=8;function $c(C){if((1&C)!=0)return Vn=15,1;if((2&C)!=0)return Vn=14,2;if((4&C)!=0)return Vn=13,4;var A=24&C;return A!==0?(Vn=12,A):(C&32)!=0?(Vn=11,32):(A=192&C,A!==0?(Vn=10,A):(C&256)!=0?(Vn=9,256):(A=3584&C,A!==0?(Vn=8,A):(C&4096)!=0?(Vn=7,4096):(A=4186112&C,A!==0?(Vn=6,A):(A=62914560&C,A!==0?(Vn=5,A):C&67108864?(Vn=4,67108864):(C&134217728)!=0?(Vn=3,134217728):(A=805306368&C,A!==0?(Vn=2,A):(1073741824&C)!=0?(Vn=1,1073741824):(Vn=8,C))))))}function mK(C){switch(C){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function AK(C){switch(C){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,C))}}function Mf(C,A){var v=C.pendingLanes;if(v===0)return Vn=0;var N=0,L=0,Q=C.expiredLanes,ce=C.suspendedLanes,Ae=C.pingedLanes;if(Q!==0)N=Q,L=Vn=15;else if(Q=v&134217727,Q!==0){var Te=Q&~ce;Te!==0?(N=$c(Te),L=Vn):(Ae&=Q,Ae!==0&&(N=$c(Ae),L=Vn))}else Q=v&~ce,Q!==0?(N=$c(Q),L=Vn):Ae!==0&&(N=$c(Ae),L=Vn);if(N===0)return 0;if(N=31-Cl(N),N=v&((0>N?0:1<<N)<<1)-1,A!==0&&A!==N&&(A&ce)==0){if($c(A),L<=Vn)return A;Vn=L}if(A=C.entangledLanes,A!==0)for(C=C.entanglements,A&=N;0<A;)v=31-Cl(A),L=1<<v,N|=C[v],A&=~L;return N}function MR(C){return C=C.pendingLanes&-1073741825,C!==0?C:C&1073741824?1073741824:0}function f0(C,A){switch(C){case 15:return 1;case 14:return 2;case 12:return C=Mu(24&~A),C===0?f0(10,A):C;case 10:return C=Mu(192&~A),C===0?f0(8,A):C;case 8:return C=Mu(3584&~A),C===0&&(C=Mu(4186112&~A),C===0&&(C=512)),C;case 2:return A=Mu(805306368&~A),A===0&&(A=268435456),A}throw Error(a(358,C))}function Mu(C){return C&-C}function ix(C){for(var A=[],v=0;31>v;v++)A.push(C);return A}function I0(C,A,v){C.pendingLanes|=A;var N=A-1;C.suspendedLanes&=N,C.pingedLanes&=N,C=C.eventTimes,A=31-Cl(A),C[A]=v}var Cl=Math.clz32?Math.clz32:vK,bK=Math.log,yK=Math.LN2;function vK(C){return C===0?32:31-(bK(C)/yK|0)|0}var xK=o.unstable_runWithPriority,rx=o.unstable_scheduleCallback,sx=o.unstable_cancelCallback,wK=o.unstable_shouldYield,WR=o.unstable_requestPaint,ox=o.unstable_now,GK=o.unstable_getCurrentPriorityLevel,C0=o.unstable_ImmediatePriority,_R=o.unstable_UserBlockingPriority,VR=o.unstable_NormalPriority,NR=o.unstable_LowPriority,ER=o.unstable_IdlePriority,ax={},BK=WR!==void 0?WR:function(){},ba=null,p0=null,lx=!1,HR=ox(),Yi=1e4>HR?ox:function(){return ox()-HR};function Wu(){switch(GK()){case C0:return 99;case _R:return 98;case VR:return 97;case NR:return 96;case ER:return 95;default:throw Error(a(332))}}function FR(C){switch(C){case 99:return C0;case 98:return _R;case 97:return VR;case 96:return NR;case 95:return ER;default:throw Error(a(332))}}function ya(C,A){return C=FR(C),xK(C,A)}function Wf(C,A,v){return C=FR(C),rx(C,A,v)}function Ms(){if(p0!==null){var C=p0;p0=null,sx(C)}LR()}function LR(){if(!lx&&ba!==null){lx=!0;var C=0;try{var A=ba;ya(99,function(){for(;C<A.length;C++){var v=A[C];do v=v(!0);while(v!==null)}}),ba=null}catch(v){throw ba!==null&&(ba=ba.slice(C+1)),rx(C0,Ms),v}finally{lx=!1}}}var SK=l.ReactCurrentBatchConfig;function ZK(C,A){return C===A&&(C!==0||1/C==1/A)||C!==C&&A!==A}var Ws=typeof Object.is=="function"?Object.is:ZK,RK=Object.prototype.hasOwnProperty;function m0(C,A){if(Ws(C,A))return!0;if(typeof C!="object"||C===null||typeof A!="object"||A===null)return!1;var v=Object.keys(C),N=Object.keys(A);if(v.length!==N.length)return!1;for(N=0;N<v.length;N++)if(!RK.call(A,v[N])||!Ws(C[v[N]],A[v[N]]))return!1;return!0}function MK(C){switch(C.tag){case 5:return Pt(C.type);case 16:return Pt("Lazy");case 13:return Pt("Suspense");case 19:return Pt("SuspenseList");case 0:case 2:case 15:return C=Ht(C.type,!1),C;case 11:return C=Ht(C.type.render,!1),C;case 22:return C=Ht(C.type._render,!1),C;case 1:return C=Ht(C.type,!0),C;default:return""}}function io(C,A){if(C&&C.defaultProps){A=r({},A),C=C.defaultProps;for(var v in C)A[v]===void 0&&(A[v]=C[v]);return A}return A}var A0=St(null),b0=null,_u=null,y0=null;function cx(){y0=_u=b0=null}function TR(C,A){C=C.type._context,de?(yt(A0,C._currentValue),C._currentValue=A):(yt(A0,C._currentValue2),C._currentValue2=A)}function gx(C){var A=A0.current;Yt(A0),C=C.type._context,de?C._currentValue=A:C._currentValue2=A}function XR(C,A){for(;C!==null;){var v=C.alternate;if((C.childLanes&A)===A){if(v===null||(v.childLanes&A)===A)break;v.childLanes|=A}else C.childLanes|=A,v!==null&&(v.childLanes|=A);C=C.return}}function Vu(C,A){b0=C,y0=_u=null,C=C.dependencies,C!==null&&C.firstContext!==null&&((C.lanes&A)!=0&&(ro=!0),C.firstContext=null)}function _s(C,A){if(y0!==C&&A!==!1&&A!==0)if((typeof A!="number"||A===1073741823)&&(y0=C,A=1073741823),A={context:C,observedBits:A,next:null},_u===null){if(b0===null)throw Error(a(308));_u=A,b0.dependencies={lanes:0,firstContext:A,responders:null}}else _u=_u.next=A;return de?C._currentValue:C._currentValue2}var pl=!1;function ux(C){C.updateQueue={baseState:C.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function zR(C,A){C=C.updateQueue,A.updateQueue===C&&(A.updateQueue={baseState:C.baseState,firstBaseUpdate:C.firstBaseUpdate,lastBaseUpdate:C.lastBaseUpdate,shared:C.shared,effects:C.effects})}function ml(C,A){return{eventTime:C,lane:A,tag:0,payload:null,callback:null,next:null}}function Al(C,A){if(C=C.updateQueue,C!==null){C=C.shared;var v=C.pending;v===null?A.next=A:(A.next=v.next,v.next=A),C.pending=A}}function kR(C,A){var v=C.updateQueue,N=C.alternate;if(N!==null&&(N=N.updateQueue,v===N)){var L=null,Q=null;if(v=v.firstBaseUpdate,v!==null){do{var ce={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};Q===null?L=Q=ce:Q=Q.next=ce,v=v.next}while(v!==null);Q===null?L=Q=A:Q=Q.next=A}else L=Q=A;v={baseState:N.baseState,firstBaseUpdate:L,lastBaseUpdate:Q,shared:N.shared,effects:N.effects},C.updateQueue=v;return}C=v.lastBaseUpdate,C===null?v.firstBaseUpdate=A:C.next=A,v.lastBaseUpdate=A}function _f(C,A,v,N){var L=C.updateQueue;pl=!1;var Q=L.firstBaseUpdate,ce=L.lastBaseUpdate,Ae=L.shared.pending;if(Ae!==null){L.shared.pending=null;var Te=Ae,it=Te.next;Te.next=null,ce===null?Q=it:ce.next=it,ce=Te;var Zt=C.alternate;if(Zt!==null){Zt=Zt.updateQueue;var Lt=Zt.lastBaseUpdate;Lt!==ce&&(Lt===null?Zt.firstBaseUpdate=it:Lt.next=it,Zt.lastBaseUpdate=Te)}}if(Q!==null){Lt=L.baseState,ce=0,Zt=it=Te=null;do{Ae=Q.lane;var dt=Q.eventTime;if((N&Ae)===Ae){Zt!==null&&(Zt=Zt.next={eventTime:dt,lane:0,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null});e:{var Zn=C,Kn=Q;switch(Ae=A,dt=v,Kn.tag){case 1:if(Zn=Kn.payload,typeof Zn=="function"){Lt=Zn.call(dt,Lt,Ae);break e}Lt=Zn;break e;case 3:Zn.flags=Zn.flags&-4097|64;case 0:if(Zn=Kn.payload,Ae=typeof Zn=="function"?Zn.call(dt,Lt,Ae):Zn,Ae==null)break e;Lt=r({},Lt,Ae);break e;case 2:pl=!0}}Q.callback!==null&&(C.flags|=32,Ae=L.effects,Ae===null?L.effects=[Q]:Ae.push(Q))}else dt={eventTime:dt,lane:Ae,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Zt===null?(it=Zt=dt,Te=Lt):Zt=Zt.next=dt,ce|=Ae;if(Q=Q.next,Q===null){if(Ae=L.shared.pending,Ae===null)break;Q=Ae.next,Ae.next=null,L.lastBaseUpdate=Ae,L.shared.pending=null}}while(1);Zt===null&&(Te=Lt),L.baseState=Te,L.firstBaseUpdate=it,L.lastBaseUpdate=Zt,Df|=ce,C.lanes=ce,C.memoizedState=Lt}}function YR(C,A,v){if(C=A.effects,A.effects=null,C!==null)for(A=0;A<C.length;A++){var N=C[A],L=N.callback;if(L!==null){if(N.callback=null,N=v,typeof L!="function")throw Error(a(191,L));L.call(N)}}}var KR=new s.Component().refs;function v0(C,A,v,N){A=C.memoizedState,v=v(N,A),v=v==null?A:r({},A,v),C.memoizedState=v,C.lanes===0&&(C.updateQueue.baseState=v)}var x0={isMounted:function(C){return(C=C._reactInternals)?S(C)===C:!1},enqueueSetState:function(C,A,v){C=C._reactInternals;var N=Ur(),L=vl(C),Q=ml(N,L);Q.payload=A,v!=null&&(Q.callback=v),Al(C,Q),Ba(C,L,N)},enqueueReplaceState:function(C,A,v){C=C._reactInternals;var N=Ur(),L=vl(C),Q=ml(N,L);Q.tag=1,Q.payload=A,v!=null&&(Q.callback=v),Al(C,Q),Ba(C,L,N)},enqueueForceUpdate:function(C,A){C=C._reactInternals;var v=Ur(),N=vl(C),L=ml(v,N);L.tag=2,A!=null&&(L.callback=A),Al(C,L),Ba(C,N,v)}};function PR(C,A,v,N,L,Q,ce){return C=C.stateNode,typeof C.shouldComponentUpdate=="function"?C.shouldComponentUpdate(N,Q,ce):A.prototype&&A.prototype.isPureReactComponent?!m0(v,N)||!m0(L,Q):!0}function DR(C,A,v){var N=!1,L=sn,Q=A.contextType;return typeof Q=="object"&&Q!==null?Q=_s(Q):(L=Yn(A)?Bn:Ft.current,N=A.contextTypes,Q=(N=N!=null)?Sn(C,L):sn),A=new A(v,Q),C.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=x0,C.stateNode=A,A._reactInternals=C,N&&(C=C.stateNode,C.__reactInternalMemoizedUnmaskedChildContext=L,C.__reactInternalMemoizedMaskedChildContext=Q),A}function UR(C,A,v,N){C=A.state,typeof A.componentWillReceiveProps=="function"&&A.componentWillReceiveProps(v,N),typeof A.UNSAFE_componentWillReceiveProps=="function"&&A.UNSAFE_componentWillReceiveProps(v,N),A.state!==C&&x0.enqueueReplaceState(A,A.state,null)}function dx(C,A,v,N){var L=C.stateNode;L.props=v,L.state=C.memoizedState,L.refs=KR,ux(C);var Q=A.contextType;typeof Q=="object"&&Q!==null?L.context=_s(Q):(Q=Yn(A)?Bn:Ft.current,L.context=Sn(C,Q)),_f(C,v,L,N),L.state=C.memoizedState,Q=A.getDerivedStateFromProps,typeof Q=="function"&&(v0(C,A,Q,v),L.state=C.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(A=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),A!==L.state&&x0.enqueueReplaceState(L,L.state,null),_f(C,v,L,N),L.state=C.memoizedState),typeof L.componentDidMount=="function"&&(C.flags|=4)}var w0=Array.isArray;function Vf(C,A,v){if(C=v.ref,C!==null&&typeof C!="function"&&typeof C!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(a(309));var N=v.stateNode}if(!N)throw Error(a(147,C));var L=""+C;return A!==null&&A.ref!==null&&typeof A.ref=="function"&&A.ref._stringRef===L?A.ref:(A=function(Q){var ce=N.refs;ce===KR&&(ce=N.refs={}),Q===null?delete ce[L]:ce[L]=Q},A._stringRef=L,A)}if(typeof C!="string")throw Error(a(284));if(!v._owner)throw Error(a(290,C))}return C}function G0(C,A){if(C.type!=="textarea")throw Error(a(31,Object.prototype.toString.call(A)==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":A))}function OR(C){function A(Ve,ve){if(C){var ze=Ve.lastEffect;ze!==null?(ze.nextEffect=ve,Ve.lastEffect=ve):Ve.firstEffect=Ve.lastEffect=ve,ve.nextEffect=null,ve.flags=8}}function v(Ve,ve){if(!C)return null;for(;ve!==null;)A(Ve,ve),ve=ve.sibling;return null}function N(Ve,ve){for(Ve=new Map;ve!==null;)ve.key!==null?Ve.set(ve.key,ve):Ve.set(ve.index,ve),ve=ve.sibling;return Ve}function L(Ve,ve){return Ve=wl(Ve,ve),Ve.index=0,Ve.sibling=null,Ve}function Q(Ve,ve,ze){return Ve.index=ze,C?(ze=Ve.alternate,ze!==null?(ze=ze.index,ze<ve?(Ve.flags=2,ve):ze):(Ve.flags=2,ve)):ve}function ce(Ve){return C&&Ve.alternate===null&&(Ve.flags=2),Ve}function Ae(Ve,ve,ze,gt){return ve===null||ve.tag!==6?(ve=ew(ze,Ve.mode,gt),ve.return=Ve,ve):(ve=L(ve,ze),ve.return=Ve,ve)}function Te(Ve,ve,ze,gt){return ve!==null&&ve.elementType===ze.type?(gt=L(ve,ze.props),gt.ref=Vf(Ve,ve,ze),gt.return=Ve,gt):(gt=$0(ze.type,ze.key,ze.props,null,Ve.mode,gt),gt.ref=Vf(Ve,ve,ze),gt.return=Ve,gt)}function it(Ve,ve,ze,gt){return ve===null||ve.tag!==4||ve.stateNode.containerInfo!==ze.containerInfo||ve.stateNode.implementation!==ze.implementation?(ve=tw(ze,Ve.mode,gt),ve.return=Ve,ve):(ve=L(ve,ze.children||[]),ve.return=Ve,ve)}function Zt(Ve,ve,ze,gt,Rt){return ve===null||ve.tag!==7?(ve=zu(ze,Ve.mode,gt,Rt),ve.return=Ve,ve):(ve=L(ve,ze),ve.return=Ve,ve)}function Lt(Ve,ve,ze){if(typeof ve=="string"||typeof ve=="number")return ve=ew(""+ve,Ve.mode,ze),ve.return=Ve,ve;if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case c:return ze=$0(ve.type,ve.key,ve.props,null,Ve.mode,ze),ze.ref=Vf(Ve,null,ve),ze.return=Ve,ze;case g:return ve=tw(ve,Ve.mode,ze),ve.return=Ve,ve}if(w0(ve)||I(ve))return ve=zu(ve,Ve.mode,ze,null),ve.return=Ve,ve;G0(Ve,ve)}return null}function dt(Ve,ve,ze,gt){var Rt=ve!==null?ve.key:null;if(typeof ze=="string"||typeof ze=="number")return Rt!==null?null:Ae(Ve,ve,""+ze,gt);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case c:return ze.key===Rt?ze.type===d?Zt(Ve,ve,ze.props.children,gt,Rt):Te(Ve,ve,ze,gt):null;case g:return ze.key===Rt?it(Ve,ve,ze,gt):null}if(w0(ze)||I(ze))return Rt!==null?null:Zt(Ve,ve,ze,gt,null);G0(Ve,ze)}return null}function Zn(Ve,ve,ze,gt,Rt){if(typeof gt=="string"||typeof gt=="number")return Ve=Ve.get(ze)||null,Ae(ve,Ve,""+gt,Rt);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case c:return Ve=Ve.get(gt.key===null?ze:gt.key)||null,gt.type===d?Zt(ve,Ve,gt.props.children,Rt,gt.key):Te(ve,Ve,gt,Rt);case g:return Ve=Ve.get(gt.key===null?ze:gt.key)||null,it(ve,Ve,gt,Rt)}if(w0(gt)||I(gt))return Ve=Ve.get(ze)||null,Zt(ve,Ve,gt,Rt,null);G0(ve,gt)}return null}function Kn(Ve,ve,ze,gt){for(var Rt=null,Nn=null,Xt=ve,Cn=ve=0,Ai=null;Xt!==null&&Cn<ze.length;Cn++){Xt.index>Cn?(Ai=Xt,Xt=null):Ai=Xt.sibling;var tn=dt(Ve,Xt,ze[Cn],gt);if(tn===null){Xt===null&&(Xt=Ai);break}C&&Xt&&tn.alternate===null&&A(Ve,Xt),ve=Q(tn,ve,Cn),Nn===null?Rt=tn:Nn.sibling=tn,Nn=tn,Xt=Ai}if(Cn===ze.length)return v(Ve,Xt),Rt;if(Xt===null){for(;Cn<ze.length;Cn++)Xt=Lt(Ve,ze[Cn],gt),Xt!==null&&(ve=Q(Xt,ve,Cn),Nn===null?Rt=Xt:Nn.sibling=Xt,Nn=Xt);return Rt}for(Xt=N(Ve,Xt);Cn<ze.length;Cn++)Ai=Zn(Xt,Ve,Cn,ze[Cn],gt),Ai!==null&&(C&&Ai.alternate!==null&&Xt.delete(Ai.key===null?Cn:Ai.key),ve=Q(Ai,ve,Cn),Nn===null?Rt=Ai:Nn.sibling=Ai,Nn=Ai);return C&&Xt.forEach(function(Gl){return A(Ve,Gl)}),Rt}function Hs(Ve,ve,ze,gt){var Rt=I(ze);if(typeof Rt!="function")throw Error(a(150));if(ze=Rt.call(ze),ze==null)throw Error(a(151));for(var Nn=Rt=null,Xt=ve,Cn=ve=0,Ai=null,tn=ze.next();Xt!==null&&!tn.done;Cn++,tn=ze.next()){Xt.index>Cn?(Ai=Xt,Xt=null):Ai=Xt.sibling;var Gl=dt(Ve,Xt,tn.value,gt);if(Gl===null){Xt===null&&(Xt=Ai);break}C&&Xt&&Gl.alternate===null&&A(Ve,Xt),ve=Q(Gl,ve,Cn),Nn===null?Rt=Gl:Nn.sibling=Gl,Nn=Gl,Xt=Ai}if(tn.done)return v(Ve,Xt),Rt;if(Xt===null){for(;!tn.done;Cn++,tn=ze.next())tn=Lt(Ve,tn.value,gt),tn!==null&&(ve=Q(tn,ve,Cn),Nn===null?Rt=tn:Nn.sibling=tn,Nn=tn);return Rt}for(Xt=N(Ve,Xt);!tn.done;Cn++,tn=ze.next())tn=Zn(Xt,Ve,Cn,tn.value,gt),tn!==null&&(C&&tn.alternate!==null&&Xt.delete(tn.key===null?Cn:tn.key),ve=Q(tn,ve,Cn),Nn===null?Rt=tn:Nn.sibling=tn,Nn=tn);return C&&Xt.forEach(function(sP){return A(Ve,sP)}),Rt}return function(Ve,ve,ze,gt){var Rt=typeof ze=="object"&&ze!==null&&ze.type===d&&ze.key===null;Rt&&(ze=ze.props.children);var Nn=typeof ze=="object"&&ze!==null;if(Nn)switch(ze.$$typeof){case c:e:{for(Nn=ze.key,Rt=ve;Rt!==null;){if(Rt.key===Nn){switch(Rt.tag){case 7:if(ze.type===d){v(Ve,Rt.sibling),ve=L(Rt,ze.props.children),ve.return=Ve,Ve=ve;break e}break;default:if(Rt.elementType===ze.type){v(Ve,Rt.sibling),ve=L(Rt,ze.props),ve.ref=Vf(Ve,Rt,ze),ve.return=Ve,Ve=ve;break e}}v(Ve,Rt);break}else A(Ve,Rt);Rt=Rt.sibling}ze.type===d?(ve=zu(ze.props.children,Ve.mode,gt,ze.key),ve.return=Ve,Ve=ve):(gt=$0(ze.type,ze.key,ze.props,null,Ve.mode,gt),gt.ref=Vf(Ve,ve,ze),gt.return=Ve,Ve=gt)}return ce(Ve);case g:e:{for(Rt=ze.key;ve!==null;){if(ve.key===Rt)if(ve.tag===4&&ve.stateNode.containerInfo===ze.containerInfo&&ve.stateNode.implementation===ze.implementation){v(Ve,ve.sibling),ve=L(ve,ze.children||[]),ve.return=Ve,Ve=ve;break e}else{v(Ve,ve);break}else A(Ve,ve);ve=ve.sibling}ve=tw(ze,Ve.mode,gt),ve.return=Ve,Ve=ve}return ce(Ve)}if(typeof ze=="string"||typeof ze=="number")return ze=""+ze,ve!==null&&ve.tag===6?(v(Ve,ve.sibling),ve=L(ve,ze),ve.return=Ve,Ve=ve):(v(Ve,ve),ve=ew(ze,Ve.mode,gt),ve.return=Ve,Ve=ve),ce(Ve);if(w0(ze))return Kn(Ve,ve,ze,gt);if(I(ze))return Hs(Ve,ve,ze,gt);if(Nn&&G0(Ve,ze),typeof ze=="undefined"&&!Rt)switch(Ve.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,w(Ve.type)||"Component"))}return v(Ve,ve)}}var B0=OR(!0),JR=OR(!1),Nf={},Vs=St(Nf),Ef=St(Nf),Nu=St(Nf);function _o(C){if(C===Nf)throw Error(a(174));return C}function hx(C,A){yt(Nu,A),yt(Ef,C),yt(Vs,Nf),C=T(A),Yt(Vs),yt(Vs,C)}function Eu(){Yt(Vs),Yt(Ef),Yt(Nu)}function QR(C){var A=_o(Nu.current),v=_o(Vs.current);A=F(v,C.type,A),v!==A&&(yt(Ef,C),yt(Vs,A))}function fx(C){Ef.current===C&&(Yt(Vs),Yt(Ef))}var ti=St(0);function S0(C){for(var A=C;A!==null;){if(A.tag===13){var v=A.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||le(v)||ae(v)))return A}else if(A.tag===19&&A.memoizedProps.revealOrder!==void 0){if((A.flags&64)!=0)return A}else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===C)break;for(;A.sibling===null;){if(A.return===null||A.return===C)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}return null}var va=null,eg=null,Vo=!1;function jR(C,A){var v=Es(5,null,null,0);v.elementType="DELETED",v.type="DELETED",v.stateNode=A,v.return=C,v.flags=8,C.lastEffect!==null?(C.lastEffect.nextEffect=v,C.lastEffect=v):C.firstEffect=C.lastEffect=v}function qR(C,A){switch(C.tag){case 5:return A=P(A,C.type,C.pendingProps),A!==null?(C.stateNode=A,!0):!1;case 6:return A=$(A,C.pendingProps),A!==null?(C.stateNode=A,!0):!1;case 13:return!1;default:return!1}}function Ix(C){if(Vo){var A=eg;if(A){var v=A;if(!qR(C,A)){if(A=xe(v),!A||!qR(C,A)){C.flags=C.flags&-1025|2,Vo=!1,va=C;return}jR(va,v)}va=C,eg=Je(A)}else C.flags=C.flags&-1025|2,Vo=!1,va=C}}function $R(C){for(C=C.return;C!==null&&C.tag!==5&&C.tag!==3&&C.tag!==13;)C=C.return;va=C}function Z0(C){if(!Re||C!==va)return!1;if(!Vo)return $R(C),Vo=!0,!1;var A=C.type;if(C.tag!==5||A!=="head"&&A!=="body"&&!Ce(A,C.memoizedProps))for(A=eg;A;)jR(C,A),A=xe(A);if($R(C),C.tag===13){if(!Re)throw Error(a(316));if(C=C.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(a(317));eg=st(C)}else eg=va?xe(C.stateNode):null;return!0}function Cx(){Re&&(eg=va=null,Vo=!1)}var Hu=[];function px(){for(var C=0;C<Hu.length;C++){var A=Hu[C];de?A._workInProgressVersionPrimary=null:A._workInProgressVersionSecondary=null}Hu.length=0}var Hf=l.ReactCurrentDispatcher,Ns=l.ReactCurrentBatchConfig,Ff=0,oi=null,or=null,Ki=null,R0=!1,Lf=!1;function Pr(){throw Error(a(321))}function mx(C,A){if(A===null)return!1;for(var v=0;v<A.length&&v<C.length;v++)if(!Ws(C[v],A[v]))return!1;return!0}function Ax(C,A,v,N,L,Q){if(Ff=Q,oi=A,A.memoizedState=null,A.updateQueue=null,A.lanes=0,Hf.current=C===null||C.memoizedState===null?_K:VK,C=v(N,L),Lf){Q=0;do{if(Lf=!1,!(25>Q))throw Error(a(301));Q+=1,Ki=or=null,A.updateQueue=null,Hf.current=NK,C=v(N,L)}while(Lf)}if(Hf.current=V0,A=or!==null&&or.next!==null,Ff=0,Ki=or=oi=null,R0=!1,A)throw Error(a(300));return C}function tg(){var C={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ki===null?oi.memoizedState=Ki=C:Ki=Ki.next=C,Ki}function ng(){if(or===null){var C=oi.alternate;C=C!==null?C.memoizedState:null}else C=or.next;var A=Ki===null?oi.memoizedState:Ki.next;if(A!==null)Ki=A,or=C;else{if(C===null)throw Error(a(310));or=C,C={memoizedState:or.memoizedState,baseState:or.baseState,baseQueue:or.baseQueue,queue:or.queue,next:null},Ki===null?oi.memoizedState=Ki=C:Ki=Ki.next=C}return Ki}function No(C,A){return typeof A=="function"?A(C):A}function Tf(C){var A=ng(),v=A.queue;if(v===null)throw Error(a(311));v.lastRenderedReducer=C;var N=or,L=N.baseQueue,Q=v.pending;if(Q!==null){if(L!==null){var ce=L.next;L.next=Q.next,Q.next=ce}N.baseQueue=L=Q,v.pending=null}if(L!==null){L=L.next,N=N.baseState;var Ae=ce=Q=null,Te=L;do{var it=Te.lane;if((Ff&it)===it)Ae!==null&&(Ae=Ae.next={lane:0,action:Te.action,eagerReducer:Te.eagerReducer,eagerState:Te.eagerState,next:null}),N=Te.eagerReducer===C?Te.eagerState:C(N,Te.action);else{var Zt={lane:it,action:Te.action,eagerReducer:Te.eagerReducer,eagerState:Te.eagerState,next:null};Ae===null?(ce=Ae=Zt,Q=N):Ae=Ae.next=Zt,oi.lanes|=it,Df|=it}Te=Te.next}while(Te!==null&&Te!==L);Ae===null?Q=N:Ae.next=ce,Ws(N,A.memoizedState)||(ro=!0),A.memoizedState=N,A.baseState=Q,A.baseQueue=Ae,v.lastRenderedState=N}return[A.memoizedState,v.dispatch]}function Xf(C){var A=ng(),v=A.queue;if(v===null)throw Error(a(311));v.lastRenderedReducer=C;var N=v.dispatch,L=v.pending,Q=A.memoizedState;if(L!==null){v.pending=null;var ce=L=L.next;do Q=C(Q,ce.action),ce=ce.next;while(ce!==L);Ws(Q,A.memoizedState)||(ro=!0),A.memoizedState=Q,A.baseQueue===null&&(A.baseState=Q),v.lastRenderedState=Q}return[Q,N]}function eM(C,A,v){var N=A._getVersion;N=N(A._source);var L=de?A._workInProgressVersionPrimary:A._workInProgressVersionSecondary;if(L!==null?C=L===N:(C=C.mutableReadLanes,(C=(Ff&C)===C)&&(de?A._workInProgressVersionPrimary=N:A._workInProgressVersionSecondary=N,Hu.push(A))),C)return v(A._source);throw Hu.push(A),Error(a(350))}function tM(C,A,v,N){var L=Rr;if(L===null)throw Error(a(349));var Q=A._getVersion,ce=Q(A._source),Ae=Hf.current,Te=Ae.useState(function(){return eM(L,A,v)}),it=Te[1],Zt=Te[0];Te=Ki;var Lt=C.memoizedState,dt=Lt.refs,Zn=dt.getSnapshot,Kn=Lt.source;Lt=Lt.subscribe;var Hs=oi;return C.memoizedState={refs:dt,source:A,subscribe:N},Ae.useEffect(function(){dt.getSnapshot=v,dt.setSnapshot=it;var Ve=Q(A._source);if(!Ws(ce,Ve)){Ve=v(A._source),Ws(Zt,Ve)||(it(Ve),Ve=vl(Hs),L.mutableReadLanes|=Ve&L.pendingLanes),Ve=L.mutableReadLanes,L.entangledLanes|=Ve;for(var ve=L.entanglements,ze=Ve;0<ze;){var gt=31-Cl(ze),Rt=1<<gt;ve[gt]|=Ve,ze&=~Rt}}},[v,A,N]),Ae.useEffect(function(){return N(A._source,function(){var Ve=dt.getSnapshot,ve=dt.setSnapshot;try{ve(Ve(A._source));var ze=vl(Hs);L.mutableReadLanes|=ze&L.pendingLanes}catch(gt){ve(function(){throw gt})}})},[A,N]),Ws(Zn,v)&&Ws(Kn,A)&&Ws(Lt,N)||(C={pending:null,dispatch:null,lastRenderedReducer:No,lastRenderedState:Zt},C.dispatch=it=xx.bind(null,oi,C),Te.queue=C,Te.baseQueue=null,Zt=eM(L,A,v),Te.memoizedState=Te.baseState=Zt),Zt}function nM(C,A,v){var N=ng();return tM(N,C,A,v)}function zf(C){var A=tg();return typeof C=="function"&&(C=C()),A.memoizedState=A.baseState=C,C=A.queue={pending:null,dispatch:null,lastRenderedReducer:No,lastRenderedState:C},C=C.dispatch=xx.bind(null,oi,C),[A.memoizedState,C]}function M0(C,A,v,N){return C={tag:C,create:A,destroy:v,deps:N,next:null},A=oi.updateQueue,A===null?(A={lastEffect:null},oi.updateQueue=A,A.lastEffect=C.next=C):(v=A.lastEffect,v===null?A.lastEffect=C.next=C:(N=v.next,v.next=C,C.next=N,A.lastEffect=C)),C}function iM(C){var A=tg();return C={current:C},A.memoizedState=C}function W0(){return ng().memoizedState}function bx(C,A,v,N){var L=tg();oi.flags|=C,L.memoizedState=M0(1|A,v,void 0,N===void 0?null:N)}function yx(C,A,v,N){var L=ng();N=N===void 0?null:N;var Q=void 0;if(or!==null){var ce=or.memoizedState;if(Q=ce.destroy,N!==null&&mx(N,ce.deps)){M0(A,v,Q,N);return}}oi.flags|=C,L.memoizedState=M0(1|A,v,Q,N)}function rM(C,A){return bx(516,4,C,A)}function _0(C,A){return yx(516,4,C,A)}function sM(C,A){return yx(4,2,C,A)}function oM(C,A){if(typeof A=="function")return C=C(),A(C),function(){A(null)};if(A!=null)return C=C(),A.current=C,function(){A.current=null}}function aM(C,A,v){return v=v!=null?v.concat([C]):null,yx(4,2,oM.bind(null,A,C),v)}function vx(){}function lM(C,A){var v=ng();A=A===void 0?null:A;var N=v.memoizedState;return N!==null&&A!==null&&mx(A,N[1])?N[0]:(v.memoizedState=[C,A],C)}function cM(C,A){var v=ng();A=A===void 0?null:A;var N=v.memoizedState;return N!==null&&A!==null&&mx(A,N[1])?N[0]:(C=C(),v.memoizedState=[C,A],C)}function WK(C,A){var v=Wu();ya(98>v?98:v,function(){C(!0)}),ya(97<v?97:v,function(){var N=Ns.transition;Ns.transition=1;try{C(!1),A()}finally{Ns.transition=N}})}function xx(C,A,v){var N=Ur(),L=vl(C),Q={lane:L,action:v,eagerReducer:null,eagerState:null,next:null},ce=A.pending;if(ce===null?Q.next=Q:(Q.next=ce.next,ce.next=Q),A.pending=Q,ce=C.alternate,C===oi||ce!==null&&ce===oi)Lf=R0=!0;else{if(C.lanes===0&&(ce===null||ce.lanes===0)&&(ce=A.lastRenderedReducer,ce!==null))try{var Ae=A.lastRenderedState,Te=ce(Ae,v);if(Q.eagerReducer=ce,Q.eagerState=Te,Ws(Te,Ae))return}catch{}finally{}Ba(C,L,N)}}var V0={readContext:_s,useCallback:Pr,useContext:Pr,useEffect:Pr,useImperativeHandle:Pr,useLayoutEffect:Pr,useMemo:Pr,useReducer:Pr,useRef:Pr,useState:Pr,useDebugValue:Pr,useDeferredValue:Pr,useTransition:Pr,useMutableSource:Pr,useOpaqueIdentifier:Pr,unstable_isNewReconciler:!1},_K={readContext:_s,useCallback:function(C,A){return tg().memoizedState=[C,A===void 0?null:A],C},useContext:_s,useEffect:rM,useImperativeHandle:function(C,A,v){return v=v!=null?v.concat([C]):null,bx(4,2,oM.bind(null,A,C),v)},useLayoutEffect:function(C,A){return bx(4,2,C,A)},useMemo:function(C,A){var v=tg();return A=A===void 0?null:A,C=C(),v.memoizedState=[C,A],C},useReducer:function(C,A,v){var N=tg();return A=v!==void 0?v(A):A,N.memoizedState=N.baseState=A,C=N.queue={pending:null,dispatch:null,lastRenderedReducer:C,lastRenderedState:A},C=C.dispatch=xx.bind(null,oi,C),[N.memoizedState,C]},useRef:iM,useState:zf,useDebugValue:vx,useDeferredValue:function(C){var A=zf(C),v=A[0],N=A[1];return rM(function(){var L=Ns.transition;Ns.transition=1;try{N(C)}finally{Ns.transition=L}},[C]),v},useTransition:function(){var C=zf(!1),A=C[0];return C=WK.bind(null,C[1]),iM(C),[C,A]},useMutableSource:function(C,A,v){var N=tg();return N.memoizedState={refs:{getSnapshot:A,setSnapshot:null},source:C,subscribe:v},tM(N,C,A,v)},useOpaqueIdentifier:function(){if(Vo){var C=!1,A=Le(function(){throw C||(C=!0,v(Qe())),Error(a(355))}),v=zf(A)[1];return(oi.mode&2)==0&&(oi.flags|=516,M0(5,function(){v(Qe())},void 0,null)),A}return A=Qe(),zf(A),A},unstable_isNewReconciler:!1},VK={readContext:_s,useCallback:lM,useContext:_s,useEffect:_0,useImperativeHandle:aM,useLayoutEffect:sM,useMemo:cM,useReducer:Tf,useRef:W0,useState:function(){return Tf(No)},useDebugValue:vx,useDeferredValue:function(C){var A=Tf(No),v=A[0],N=A[1];return _0(function(){var L=Ns.transition;Ns.transition=1;try{N(C)}finally{Ns.transition=L}},[C]),v},useTransition:function(){var C=Tf(No)[0];return[W0().current,C]},useMutableSource:nM,useOpaqueIdentifier:function(){return Tf(No)[0]},unstable_isNewReconciler:!1},NK={readContext:_s,useCallback:lM,useContext:_s,useEffect:_0,useImperativeHandle:aM,useLayoutEffect:sM,useMemo:cM,useReducer:Xf,useRef:W0,useState:function(){return Xf(No)},useDebugValue:vx,useDeferredValue:function(C){var A=Xf(No),v=A[0],N=A[1];return _0(function(){var L=Ns.transition;Ns.transition=1;try{N(C)}finally{Ns.transition=L}},[C]),v},useTransition:function(){var C=Xf(No)[0];return[W0().current,C]},useMutableSource:nM,useOpaqueIdentifier:function(){return Xf(No)[0]},unstable_isNewReconciler:!1},EK=l.ReactCurrentOwner,ro=!1;function Dr(C,A,v,N){A.child=C===null?JR(A,null,v,N):B0(A,C.child,v,N)}function gM(C,A,v,N,L){v=v.render;var Q=A.ref;return Vu(A,L),N=Ax(C,A,v,N,Q,L),C!==null&&!ro?(A.updateQueue=C.updateQueue,A.flags&=-517,C.lanes&=~L,xa(C,A,L)):(A.flags|=1,Dr(C,A,N,L),A.child)}function uM(C,A,v,N,L,Q){if(C===null){var ce=v.type;return typeof ce=="function"&&!qx(ce)&&ce.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(A.tag=15,A.type=ce,dM(C,A,ce,N,L,Q)):(C=$0(v.type,null,N,A,A.mode,Q),C.ref=A.ref,C.return=A,A.child=C)}return ce=C.child,(L&Q)==0&&(L=ce.memoizedProps,v=v.compare,v=v!==null?v:m0,v(L,N)&&C.ref===A.ref)?xa(C,A,Q):(A.flags|=1,C=wl(ce,N),C.ref=A.ref,C.return=A,A.child=C)}function dM(C,A,v,N,L,Q){if(C!==null&&m0(C.memoizedProps,N)&&C.ref===A.ref)if(ro=!1,(Q&L)!=0)(C.flags&16384)!=0&&(ro=!0);else return A.lanes=C.lanes,xa(C,A,Q);return Gx(C,A,v,N,Q)}function wx(C,A,v){var N=A.pendingProps,L=N.children,Q=C!==null?C.memoizedState:null;if(N.mode==="hidden"||N.mode==="unstable-defer-without-hiding")if((A.mode&4)==0)A.memoizedState={baseLanes:0},Q0(A,v);else if((v&1073741824)!=0)A.memoizedState={baseLanes:0},Q0(A,Q!==null?Q.baseLanes:v);else return C=Q!==null?Q.baseLanes|v:v,A.lanes=A.childLanes=1073741824,A.memoizedState={baseLanes:C},Q0(A,C),null;else Q!==null?(N=Q.baseLanes|v,A.memoizedState=null):N=v,Q0(A,N);return Dr(C,A,L,v),A.child}function hM(C,A){var v=A.ref;(C===null&&v!==null||C!==null&&C.ref!==v)&&(A.flags|=128)}function Gx(C,A,v,N,L){var Q=Yn(v)?Bn:Ft.current;return Q=Sn(A,Q),Vu(A,L),v=Ax(C,A,v,N,Q,L),C!==null&&!ro?(A.updateQueue=C.updateQueue,A.flags&=-517,C.lanes&=~L,xa(C,A,L)):(A.flags|=1,Dr(C,A,v,L),A.child)}function fM(C,A,v,N,L){if(Yn(v)){var Q=!0;d0(A)}else Q=!1;if(Vu(A,L),A.stateNode===null)C!==null&&(C.alternate=null,A.alternate=null,A.flags|=2),DR(A,v,N),dx(A,v,N,L),N=!0;else if(C===null){var ce=A.stateNode,Ae=A.memoizedProps;ce.props=Ae;var Te=ce.context,it=v.contextType;typeof it=="object"&&it!==null?it=_s(it):(it=Yn(v)?Bn:Ft.current,it=Sn(A,it));var Zt=v.getDerivedStateFromProps,Lt=typeof Zt=="function"||typeof ce.getSnapshotBeforeUpdate=="function";Lt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==N||Te!==it)&&UR(A,ce,N,it),pl=!1;var dt=A.memoizedState;ce.state=dt,_f(A,N,ce,L),Te=A.memoizedState,Ae!==N||dt!==Te||In.current||pl?(typeof Zt=="function"&&(v0(A,v,Zt,N),Te=A.memoizedState),(Ae=pl||PR(A,v,Ae,N,dt,Te,it))?(Lt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(A.flags|=4)):(typeof ce.componentDidMount=="function"&&(A.flags|=4),A.memoizedProps=N,A.memoizedState=Te),ce.props=N,ce.state=Te,ce.context=it,N=Ae):(typeof ce.componentDidMount=="function"&&(A.flags|=4),N=!1)}else{ce=A.stateNode,zR(C,A),Ae=A.memoizedProps,it=A.type===A.elementType?Ae:io(A.type,Ae),ce.props=it,Lt=A.pendingProps,dt=ce.context,Te=v.contextType,typeof Te=="object"&&Te!==null?Te=_s(Te):(Te=Yn(v)?Bn:Ft.current,Te=Sn(A,Te));var Zn=v.getDerivedStateFromProps;(Zt=typeof Zn=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==Lt||dt!==Te)&&UR(A,ce,N,Te),pl=!1,dt=A.memoizedState,ce.state=dt,_f(A,N,ce,L);var Kn=A.memoizedState;Ae!==Lt||dt!==Kn||In.current||pl?(typeof Zn=="function"&&(v0(A,v,Zn,N),Kn=A.memoizedState),(it=pl||PR(A,v,it,N,dt,Kn,Te))?(Zt||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(N,Kn,Te),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(N,Kn,Te)),typeof ce.componentDidUpdate=="function"&&(A.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(A.flags|=256)):(typeof ce.componentDidUpdate!="function"||Ae===C.memoizedProps&&dt===C.memoizedState||(A.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===C.memoizedProps&&dt===C.memoizedState||(A.flags|=256),A.memoizedProps=N,A.memoizedState=Kn),ce.props=N,ce.state=Kn,ce.context=Te,N=it):(typeof ce.componentDidUpdate!="function"||Ae===C.memoizedProps&&dt===C.memoizedState||(A.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===C.memoizedProps&&dt===C.memoizedState||(A.flags|=256),N=!1)}return Bx(C,A,v,N,Q,L)}function Bx(C,A,v,N,L,Q){hM(C,A);var ce=(A.flags&64)!=0;if(!N&&!ce)return L&&RR(A,v,!1),xa(C,A,Q);N=A.stateNode,EK.current=A;var Ae=ce&&typeof v.getDerivedStateFromError!="function"?null:N.render();return A.flags|=1,C!==null&&ce?(A.child=B0(A,C.child,null,Q),A.child=B0(A,null,Ae,Q)):Dr(C,A,Ae,Q),A.memoizedState=N.state,L&&RR(A,v,!0),A.child}function IM(C){var A=C.stateNode;A.pendingContext?Kr(C,A.pendingContext,A.pendingContext!==A.context):A.context&&Kr(C,A.context,!1),hx(C,A.containerInfo)}var N0={dehydrated:null,retryLane:0};function CM(C,A,v){var N=A.pendingProps,L=ti.current,Q=!1,ce;return(ce=(A.flags&64)!=0)||(ce=C!==null&&C.memoizedState===null?!1:(L&2)!=0),ce?(Q=!0,A.flags&=-65):C!==null&&C.memoizedState===null||N.fallback===void 0||N.unstable_avoidThisFallback===!0||(L|=1),yt(ti,L&1),C===null?(N.fallback!==void 0&&Ix(A),C=N.children,L=N.fallback,Q?(C=pM(A,C,L,v),A.child.memoizedState={baseLanes:v},A.memoizedState=N0,C):typeof N.unstable_expectedLoadTime=="number"?(C=pM(A,C,L,v),A.child.memoizedState={baseLanes:v},A.memoizedState=N0,A.lanes=33554432,C):(v=$x({mode:"visible",children:C},A.mode,v,null),v.return=A,A.child=v)):C.memoizedState!==null?Q?(N=AM(C,A,N.children,N.fallback,v),Q=A.child,L=C.child.memoizedState,Q.memoizedState=L===null?{baseLanes:v}:{baseLanes:L.baseLanes|v},Q.childLanes=C.childLanes&~v,A.memoizedState=N0,N):(v=mM(C,A,N.children,v),A.memoizedState=null,v):Q?(N=AM(C,A,N.children,N.fallback,v),Q=A.child,L=C.child.memoizedState,Q.memoizedState=L===null?{baseLanes:v}:{baseLanes:L.baseLanes|v},Q.childLanes=C.childLanes&~v,A.memoizedState=N0,N):(v=mM(C,A,N.children,v),A.memoizedState=null,v)}function pM(C,A,v,N){var L=C.mode,Q=C.child;return A={mode:"hidden",children:A},(L&2)==0&&Q!==null?(Q.childLanes=0,Q.pendingProps=A):Q=$x(A,L,0,null),v=zu(v,L,N,null),Q.return=C,v.return=C,Q.sibling=v,C.child=Q,v}function mM(C,A,v,N){var L=C.child;return C=L.sibling,v=wl(L,{mode:"visible",children:v}),(A.mode&2)==0&&(v.lanes=N),v.return=A,v.sibling=null,C!==null&&(C.nextEffect=null,C.flags=8,A.firstEffect=A.lastEffect=C),A.child=v}function AM(C,A,v,N,L){var Q=A.mode,ce=C.child;C=ce.sibling;var Ae={mode:"hidden",children:v};return(Q&2)==0&&A.child!==ce?(v=A.child,v.childLanes=0,v.pendingProps=Ae,ce=v.lastEffect,ce!==null?(A.firstEffect=v.firstEffect,A.lastEffect=ce,ce.nextEffect=null):A.firstEffect=A.lastEffect=null):v=wl(ce,Ae),C!==null?N=wl(C,N):(N=zu(N,Q,L,null),N.flags|=2),N.return=A,v.return=A,v.sibling=N,A.child=v,N}function bM(C,A){C.lanes|=A;var v=C.alternate;v!==null&&(v.lanes|=A),XR(C.return,A)}function Sx(C,A,v,N,L,Q){var ce=C.memoizedState;ce===null?C.memoizedState={isBackwards:A,rendering:null,renderingStartTime:0,last:N,tail:v,tailMode:L,lastEffect:Q}:(ce.isBackwards=A,ce.rendering=null,ce.renderingStartTime=0,ce.last=N,ce.tail=v,ce.tailMode=L,ce.lastEffect=Q)}function yM(C,A,v){var N=A.pendingProps,L=N.revealOrder,Q=N.tail;if(Dr(C,A,N.children,v),N=ti.current,(N&2)!=0)N=N&1|2,A.flags|=64;else{if(C!==null&&(C.flags&64)!=0)e:for(C=A.child;C!==null;){if(C.tag===13)C.memoizedState!==null&&bM(C,v);else if(C.tag===19)bM(C,v);else if(C.child!==null){C.child.return=C,C=C.child;continue}if(C===A)break e;for(;C.sibling===null;){if(C.return===null||C.return===A)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}N&=1}if(yt(ti,N),(A.mode&2)==0)A.memoizedState=null;else switch(L){case"forwards":for(v=A.child,L=null;v!==null;)C=v.alternate,C!==null&&S0(C)===null&&(L=v),v=v.sibling;v=L,v===null?(L=A.child,A.child=null):(L=v.sibling,v.sibling=null),Sx(A,!1,L,v,Q,A.lastEffect);break;case"backwards":for(v=null,L=A.child,A.child=null;L!==null;){if(C=L.alternate,C!==null&&S0(C)===null){A.child=L;break}C=L.sibling,L.sibling=v,v=L,L=C}Sx(A,!0,v,null,Q,A.lastEffect);break;case"together":Sx(A,!1,null,null,void 0,A.lastEffect);break;default:A.memoizedState=null}return A.child}function xa(C,A,v){if(C!==null&&(A.dependencies=C.dependencies),Df|=A.lanes,(v&A.childLanes)!=0){if(C!==null&&A.child!==C.child)throw Error(a(153));if(A.child!==null){for(C=A.child,v=wl(C,C.pendingProps),A.child=v,v.return=A;C.sibling!==null;)C=C.sibling,v=v.sibling=wl(C,C.pendingProps),v.return=A;v.sibling=null}return A.child}return null}function Eo(C){C.flags|=4}var kf,Yf,E0,H0;if(Ie)kf=function(C,A){for(var v=A.child;v!==null;){if(v.tag===5||v.tag===6)Y(C,v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===A)break;for(;v.sibling===null;){if(v.return===null||v.return===A)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},Yf=function(){},E0=function(C,A,v,N,L){if(C=C.memoizedProps,C!==N){var Q=A.stateNode,ce=_o(Vs.current);v=ye(Q,v,C,N,L,ce),(A.updateQueue=v)&&Eo(A)}},H0=function(C,A,v,N){v!==N&&Eo(A)};else if(Be){kf=function(C,A,v,N){for(var L=A.child;L!==null;){if(L.tag===5){var Q=L.stateNode;v&&N&&(Q=cn(Q,L.type,L.memoizedProps,L)),Y(C,Q)}else if(L.tag===6)Q=L.stateNode,v&&N&&(Q=ie(Q,L.memoizedProps,L)),Y(C,Q);else if(L.tag!==4){if(L.tag===13&&(L.flags&4)!=0&&(Q=L.memoizedState!==null)){var ce=L.child;if(ce!==null&&(ce.child!==null&&(ce.child.return=ce,kf(C,ce,!0,Q)),Q=ce.sibling,Q!==null)){Q.return=L,L=Q;continue}}if(L.child!==null){L.child.return=L,L=L.child;continue}}if(L===A)break;for(;L.sibling===null;){if(L.return===null||L.return===A)return;L=L.return}L.sibling.return=L.return,L=L.sibling}};var vM=function(C,A,v,N){for(var L=A.child;L!==null;){if(L.tag===5){var Q=L.stateNode;v&&N&&(Q=cn(Q,L.type,L.memoizedProps,L)),qt(C,Q)}else if(L.tag===6)Q=L.stateNode,v&&N&&(Q=ie(Q,L.memoizedProps,L)),qt(C,Q);else if(L.tag!==4){if(L.tag===13&&(L.flags&4)!=0&&(Q=L.memoizedState!==null)){var ce=L.child;if(ce!==null&&(ce.child!==null&&(ce.child.return=ce,vM(C,ce,!0,Q)),Q=ce.sibling,Q!==null)){Q.return=L,L=Q;continue}}if(L.child!==null){L.child.return=L,L=L.child;continue}}if(L===A)break;for(;L.sibling===null;){if(L.return===null||L.return===A)return;L=L.return}L.sibling.return=L.return,L=L.sibling}};Yf=function(C){var A=C.stateNode;if(C.firstEffect!==null){var v=A.containerInfo,N=en(v);vM(N,C,!1,!1),A.pendingChildren=N,Eo(C),Yr(v,N)}},E0=function(C,A,v,N,L){var Q=C.stateNode,ce=C.memoizedProps;if((C=A.firstEffect===null)&&ce===N)A.stateNode=Q;else{var Ae=A.stateNode,Te=_o(Vs.current),it=null;ce!==N&&(it=ye(Ae,v,ce,N,L,Te)),C&&it===null?A.stateNode=Q:(Q=sr(Q,it,v,ce,N,A,C,Ae),ee(Q,v,N,L,Te)&&Eo(A),A.stateNode=Q,C?Eo(A):kf(Q,A,!1,!1))}},H0=function(C,A,v,N){v!==N?(C=_o(Nu.current),v=_o(Vs.current),A.stateNode=he(N,C,v,A),Eo(A)):A.stateNode=C.stateNode}}else Yf=function(){},E0=function(){},H0=function(){};function Kf(C,A){if(!Vo)switch(C.tailMode){case"hidden":A=C.tail;for(var v=null;A!==null;)A.alternate!==null&&(v=A),A=A.sibling;v===null?C.tail=null:v.sibling=null;break;case"collapsed":v=C.tail;for(var N=null;v!==null;)v.alternate!==null&&(N=v),v=v.sibling;N===null?A||C.tail===null?C.tail=null:C.tail.sibling=null:N.sibling=null}}function HK(C,A,v){var N=A.pendingProps;switch(A.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Yn(A.type)&&Rs(),null;case 3:return Eu(),Yt(In),Yt(Ft),px(),N=A.stateNode,N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(C===null||C.child===null)&&(Z0(A)?Eo(A):N.hydrate||(A.flags|=256)),Yf(A),null;case 5:fx(A);var L=_o(Nu.current);if(v=A.type,C!==null&&A.stateNode!=null)E0(C,A,v,N,L),C.ref!==A.ref&&(A.flags|=128);else{if(!N){if(A.stateNode===null)throw Error(a(166));return null}if(C=_o(Vs.current),Z0(A)){if(!Re)throw Error(a(175));C=De(A.stateNode,A.type,A.memoizedProps,L,C,A),A.updateQueue=C,C!==null&&Eo(A)}else{var Q=O(v,N,L,C,A);kf(Q,A,!1,!1),A.stateNode=Q,ee(Q,v,N,L,C)&&Eo(A)}A.ref!==null&&(A.flags|=128)}return null;case 6:if(C&&A.stateNode!=null)H0(C,A,C.memoizedProps,N);else{if(typeof N!="string"&&A.stateNode===null)throw Error(a(166));if(C=_o(Nu.current),L=_o(Vs.current),Z0(A)){if(!Re)throw Error(a(176));Ue(A.stateNode,A.memoizedProps,A)&&Eo(A)}else A.stateNode=he(N,C,L,A)}return null;case 13:return Yt(ti),N=A.memoizedState,(A.flags&64)!=0?(A.lanes=v,A):(N=N!==null,L=!1,C===null?A.memoizedProps.fallback!==void 0&&Z0(A):L=C.memoizedState!==null,N&&!L&&(A.mode&2)!=0&&(C===null&&A.memoizedProps.unstable_avoidThisFallback!==!0||(ti.current&1)!=0?Pi===0&&(Pi=3):((Pi===0||Pi===3)&&(Pi=4),Rr===null||(Df&134217727)==0&&(Lu&134217727)==0||Tu(Rr,ar))),Be&&N&&(A.flags|=4),Ie&&(N||L)&&(A.flags|=4),null);case 4:return Eu(),Yf(A),C===null&&X(A.stateNode.containerInfo),null;case 10:return gx(A),null;case 17:return Yn(A.type)&&Rs(),null;case 19:if(Yt(ti),N=A.memoizedState,N===null)return null;if(L=(A.flags&64)!=0,Q=N.rendering,Q===null)if(L)Kf(N,!1);else{if(Pi!==0||C!==null&&(C.flags&64)!=0)for(C=A.child;C!==null;){if(Q=S0(C),Q!==null){for(A.flags|=64,Kf(N,!1),C=Q.updateQueue,C!==null&&(A.updateQueue=C,A.flags|=4),N.lastEffect===null&&(A.firstEffect=null),A.lastEffect=N.lastEffect,C=v,N=A.child;N!==null;)L=N,v=C,L.flags&=2,L.nextEffect=null,L.firstEffect=null,L.lastEffect=null,Q=L.alternate,Q===null?(L.childLanes=0,L.lanes=v,L.child=null,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=Q.childLanes,L.lanes=Q.lanes,L.child=Q.child,L.memoizedProps=Q.memoizedProps,L.memoizedState=Q.memoizedState,L.updateQueue=Q.updateQueue,L.type=Q.type,v=Q.dependencies,L.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),N=N.sibling;return yt(ti,ti.current&1|2),A.child}C=C.sibling}N.tail!==null&&Yi()>Yx&&(A.flags|=64,L=!0,Kf(N,!1),A.lanes=33554432)}else{if(!L)if(C=S0(Q),C!==null){if(A.flags|=64,L=!0,C=C.updateQueue,C!==null&&(A.updateQueue=C,A.flags|=4),Kf(N,!0),N.tail===null&&N.tailMode==="hidden"&&!Q.alternate&&!Vo)return A=A.lastEffect=N.lastEffect,A!==null&&(A.nextEffect=null),null}else 2*Yi()-N.renderingStartTime>Yx&&v!==1073741824&&(A.flags|=64,L=!0,Kf(N,!1),A.lanes=33554432);N.isBackwards?(Q.sibling=A.child,A.child=Q):(C=N.last,C!==null?C.sibling=Q:A.child=Q,N.last=Q)}return N.tail!==null?(C=N.tail,N.rendering=C,N.tail=C.sibling,N.lastEffect=A.lastEffect,N.renderingStartTime=Yi(),C.sibling=null,A=ti.current,yt(ti,L?A&1|2:A&1),C):null;case 23:case 24:return Jx(),C!==null&&C.memoizedState!==null!=(A.memoizedState!==null)&&N.mode!=="unstable-defer-without-hiding"&&(A.flags|=4),null}throw Error(a(156,A.tag))}function FK(C){switch(C.tag){case 1:Yn(C.type)&&Rs();var A=C.flags;return A&4096?(C.flags=A&-4097|64,C):null;case 3:if(Eu(),Yt(In),Yt(Ft),px(),A=C.flags,(A&64)!=0)throw Error(a(285));return C.flags=A&-4097|64,C;case 5:return fx(C),null;case 13:return Yt(ti),A=C.flags,A&4096?(C.flags=A&-4097|64,C):null;case 19:return Yt(ti),null;case 4:return Eu(),null;case 10:return gx(C),null;case 23:case 24:return Jx(),null;default:return null}}function Zx(C,A){try{var v="",N=A;do v+=MK(N),N=N.return;while(N);var L=v}catch(Q){L=`
Error generating stack: `+Q.message+`
`+Q.stack}return{value:C,source:A,stack:L}}function Rx(C,A){try{console.error(A.value)}catch(v){setTimeout(function(){throw v})}}var LK=typeof WeakMap=="function"?WeakMap:Map;function xM(C,A,v){v=ml(-1,v),v.tag=3,v.payload={element:null};var N=A.value;return v.callback=function(){D0||(D0=!0,Kx=N),Rx(C,A)},v}function wM(C,A,v){v=ml(-1,v),v.tag=3;var N=C.type.getDerivedStateFromError;if(typeof N=="function"){var L=A.value;v.payload=function(){return Rx(C,A),N(L)}}var Q=C.stateNode;return Q!==null&&typeof Q.componentDidCatch=="function"&&(v.callback=function(){typeof N!="function"&&(Ho===null?Ho=new Set([this]):Ho.add(this),Rx(C,A));var ce=A.stack;this.componentDidCatch(A.value,{componentStack:ce!==null?ce:""})}),v}var TK=typeof WeakSet=="function"?WeakSet:Set;function GM(C){var A=C.ref;if(A!==null)if(typeof A=="function")try{A(null)}catch(v){xl(C,v)}else A.current=null}function XK(C,A){switch(A.tag){case 0:case 11:case 15:case 22:return;case 1:if(A.flags&256&&C!==null){var v=C.memoizedProps,N=C.memoizedState;C=A.stateNode,A=C.getSnapshotBeforeUpdate(A.elementType===A.type?v:io(A.type,v),N),C.__reactInternalSnapshotBeforeUpdate=A}return;case 3:Ie&&A.flags&256&&Jt(A.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(a(163))}function BM(C,A){if(A=A.updateQueue,A=A!==null?A.lastEffect:null,A!==null){var v=A=A.next;do{if((v.tag&C)===C){var N=v.destroy;v.destroy=void 0,N!==void 0&&N()}v=v.next}while(v!==A)}}function zK(C,A,v){switch(v.tag){case 0:case 11:case 15:case 22:if(A=v.updateQueue,A=A!==null?A.lastEffect:null,A!==null){C=A=A.next;do{if((C.tag&3)==3){var N=C.create;C.destroy=N()}C=C.next}while(C!==A)}if(A=v.updateQueue,A=A!==null?A.lastEffect:null,A!==null){C=A=A.next;do{var L=C;N=L.next,L=L.tag,(L&4)!=0&&(L&1)!=0&&(YM(v,C),QK(v,C)),C=N}while(C!==A)}return;case 1:C=v.stateNode,v.flags&4&&(A===null?C.componentDidMount():(N=v.elementType===v.type?A.memoizedProps:io(v.type,A.memoizedProps),C.componentDidUpdate(N,A.memoizedState,C.__reactInternalSnapshotBeforeUpdate))),A=v.updateQueue,A!==null&&YR(v,A,C);return;case 3:if(A=v.updateQueue,A!==null){if(C=null,v.child!==null)switch(v.child.tag){case 5:C=Z(v.child.stateNode);break;case 1:C=v.child.stateNode}YR(v,A,C)}return;case 5:C=v.stateNode,A===null&&v.flags&4&&Fe(C,v.type,v.memoizedProps,v);return;case 6:return;case 4:return;case 12:return;case 13:Re&&v.memoizedState===null&&(v=v.alternate,v!==null&&(v=v.memoizedState,v!==null&&(v=v.dehydrated,v!==null&&ct(v))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(a(163))}function SM(C,A){if(Ie)for(var v=C;;){if(v.tag===5){var N=v.stateNode;A?wt(N):un(v.stateNode,v.memoizedProps)}else if(v.tag===6)N=v.stateNode,A?nt(N):Et(N,v.memoizedProps);else if((v.tag!==23&&v.tag!==24||v.memoizedState===null||v===C)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===C)break;for(;v.sibling===null;){if(v.return===null||v.return===C)return;v=v.return}v.sibling.return=v.return,v=v.sibling}}function ZM(C,A){if(qc&&typeof qc.onCommitFiberUnmount=="function")try{qc.onCommitFiberUnmount(nx,A)}catch{}switch(A.tag){case 0:case 11:case 14:case 15:case 22:if(C=A.updateQueue,C!==null&&(C=C.lastEffect,C!==null)){var v=C=C.next;do{var N=v,L=N.destroy;if(N=N.tag,L!==void 0)if((N&4)!=0)YM(A,v);else{N=A;try{L()}catch(Q){xl(N,Q)}}v=v.next}while(v!==C)}break;case 1:if(GM(A),C=A.stateNode,typeof C.componentWillUnmount=="function")try{C.props=A.memoizedProps,C.state=A.memoizedState,C.componentWillUnmount()}catch(Q){xl(A,Q)}break;case 5:GM(A);break;case 4:Ie?VM(C,A):Be&&Be&&(A=A.stateNode.containerInfo,C=en(A),ln(A,C))}}function RM(C,A){for(var v=A;;)if(ZM(C,v),v.child===null||Ie&&v.tag===4){if(v===A)break;for(;v.sibling===null;){if(v.return===null||v.return===A)return;v=v.return}v.sibling.return=v.return,v=v.sibling}else v.child.return=v,v=v.child}function MM(C){C.alternate=null,C.child=null,C.dependencies=null,C.firstEffect=null,C.lastEffect=null,C.memoizedProps=null,C.memoizedState=null,C.pendingProps=null,C.return=null,C.updateQueue=null}function WM(C){return C.tag===5||C.tag===3||C.tag===4}function _M(C){if(Ie){e:{for(var A=C.return;A!==null;){if(WM(A))break e;A=A.return}throw Error(a(160))}var v=A;switch(A=v.stateNode,v.tag){case 5:var N=!1;break;case 3:A=A.containerInfo,N=!0;break;case 4:A=A.containerInfo,N=!0;break;default:throw Error(a(161))}v.flags&16&&(ht(A),v.flags&=-17);e:t:for(v=C;;){for(;v.sibling===null;){if(v.return===null||WM(v.return)){v=null;break e}v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue t;v.child.return=v,v=v.child}if(!(v.flags&2)){v=v.stateNode;break e}}N?Mx(C,v,A):Wx(C,v,A)}}function Mx(C,A,v){var N=C.tag,L=N===5||N===6;if(L)C=L?C.stateNode:C.stateNode.instance,A?me(v,C,A):Ee(v,C);else if(N!==4&&(C=C.child,C!==null))for(Mx(C,A,v),C=C.sibling;C!==null;)Mx(C,A,v),C=C.sibling}function Wx(C,A,v){var N=C.tag,L=N===5||N===6;if(L)C=L?C.stateNode:C.stateNode.instance,A?Ye(v,C,A):_e(v,C);else if(N!==4&&(C=C.child,C!==null))for(Wx(C,A,v),C=C.sibling;C!==null;)Wx(C,A,v),C=C.sibling}function VM(C,A){for(var v=A,N=!1,L,Q;;){if(!N){N=v.return;e:for(;;){if(N===null)throw Error(a(160));switch(L=N.stateNode,N.tag){case 5:Q=!1;break e;case 3:L=L.containerInfo,Q=!0;break e;case 4:L=L.containerInfo,Q=!0;break e}N=N.return}N=!0}if(v.tag===5||v.tag===6)RM(C,v),Q?Pe(L,v.stateNode):Ge(L,v.stateNode);else if(v.tag===4){if(v.child!==null){L=v.stateNode.containerInfo,Q=!0,v.child.return=v,v=v.child;continue}}else if(ZM(C,v),v.child!==null){v.child.return=v,v=v.child;continue}if(v===A)break;for(;v.sibling===null;){if(v.return===null||v.return===A)return;v=v.return,v.tag===4&&(N=!1)}v.sibling.return=v.return,v=v.sibling}}function _x(C,A){if(Ie){switch(A.tag){case 0:case 11:case 14:case 15:case 22:BM(3,A);return;case 1:return;case 5:var v=A.stateNode;if(v!=null){var N=A.memoizedProps;C=C!==null?C.memoizedProps:N;var L=A.type,Q=A.updateQueue;A.updateQueue=null,Q!==null&&Ze(v,Q,L,C,N,A)}return;case 6:if(A.stateNode===null)throw Error(a(162));v=A.memoizedProps,U(A.stateNode,C!==null?C.memoizedProps:v,v);return;case 3:Re&&(A=A.stateNode,A.hydrate&&(A.hydrate=!1,ut(A.containerInfo)));return;case 12:return;case 13:NM(A),F0(A);return;case 19:F0(A);return;case 17:return;case 23:case 24:SM(A,A.memoizedState!==null);return}throw Error(a(163))}switch(A.tag){case 0:case 11:case 14:case 15:case 22:BM(3,A);return;case 12:return;case 13:NM(A),F0(A);return;case 19:F0(A);return;case 3:Re&&(v=A.stateNode,v.hydrate&&(v.hydrate=!1,ut(v.containerInfo)));break;case 23:case 24:return}e:if(Be){switch(A.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:A=A.stateNode,ln(A.containerInfo,A.pendingChildren);break e}throw Error(a(163))}}function NM(C){C.memoizedState!==null&&(kx=Yi(),Ie&&SM(C.child,!0))}function F0(C){var A=C.updateQueue;if(A!==null){C.updateQueue=null;var v=C.stateNode;v===null&&(v=C.stateNode=new TK),A.forEach(function(N){var L=$K.bind(null,C,N);v.has(N)||(v.add(N),N.then(L,L))})}}function kK(C,A){return C!==null&&(C=C.memoizedState,C===null||C.dehydrated!==null)?(A=A.memoizedState,A!==null&&A.dehydrated===null):!1}var L0=0,T0=1,X0=2,z0=3,k0=4;if(typeof Symbol=="function"&&Symbol.for){var Pf=Symbol.for;L0=Pf("selector.component"),T0=Pf("selector.has_pseudo_class"),X0=Pf("selector.role"),z0=Pf("selector.test_id"),k0=Pf("selector.text")}function Vx(C){var A=Xe(C);if(A!=null){if(typeof A.memoizedProps["data-testname"]!="string")throw Error(a(364));return A}if(C=ge(C),C===null)throw Error(a(362));return C.stateNode.current}function Nx(C,A){switch(A.$$typeof){case L0:if(C.type===A.value)return!0;break;case T0:e:{A=A.value,C=[C,0];for(var v=0;v<C.length;){var N=C[v++],L=C[v++],Q=A[L];if(N.tag!==5||!pe(N)){for(;Q!=null&&Nx(N,Q);)L++,Q=A[L];if(L===A.length){A=!0;break e}else for(N=N.child;N!==null;)C.push(N,L),N=N.sibling}}A=!1}return A;case X0:if(C.tag===5&&we(C.stateNode,A.value))return!0;break;case k0:if((C.tag===5||C.tag===6)&&(C=Me(C),C!==null&&0<=C.indexOf(A.value)))return!0;break;case z0:if(C.tag===5&&(C=C.memoizedProps["data-testname"],typeof C=="string"&&C.toLowerCase()===A.value.toLowerCase()))return!0;break;default:throw Error(a(365,A))}return!1}function Ex(C){switch(C.$$typeof){case L0:return"<"+(w(C.value)||"Unknown")+">";case T0:return":has("+(Ex(C)||"")+")";case X0:return'[role="'+C.value+'"]';case k0:return'"'+C.value+'"';case z0:return'[data-testname="'+C.value+'"]';default:throw Error(a(365,C))}}function EM(C,A){var v=[];C=[C,0];for(var N=0;N<C.length;){var L=C[N++],Q=C[N++],ce=A[Q];if(L.tag!==5||!pe(L)){for(;ce!=null&&Nx(L,ce);)Q++,ce=A[Q];if(Q===A.length)v.push(L);else for(L=L.child;L!==null;)C.push(L,Q),L=L.sibling}}return v}function Hx(C,A){if(!D)throw Error(a(363));C=Vx(C),C=EM(C,A),A=[],C=Array.from(C);for(var v=0;v<C.length;){var N=C[v++];if(N.tag===5)pe(N)||A.push(N.stateNode);else for(N=N.child;N!==null;)C.push(N),N=N.sibling}return A}var Y0=null;function YK(C){if(Y0===null)try{var A=("require"+Math.random()).slice(0,7);Y0=(i&&i[A]).call(i,"timers").setImmediate}catch{Y0=function(N){var L=new MessageChannel;L.port1.onmessage=N,L.port2.postMessage(void 0)}}return Y0(C)}var KK=Math.ceil,K0=l.ReactCurrentDispatcher,Fx=l.ReactCurrentOwner,Lx=l.IsSomeRendererActing,_t=0,Rr=null,xi=null,ar=0,ig=0,Tx=St(0),Pi=0,P0=null,Fu=0,Df=0,Lu=0,Xx=0,zx=null,kx=0,Yx=1/0;function bl(){Yx=Yi()+500}var It=null,D0=!1,Kx=null,Ho=null,yl=!1,Uf=null,Of=90,Px=[],Dx=[],wa=null,Jf=0,Ux=null,U0=-1,Ga=0,O0=0,Qf=null,jf=!1;function Ur(){return(_t&48)!=0?Yi():U0!==-1?U0:U0=Yi()}function vl(C){if(C=C.mode,(C&2)==0)return 1;if((C&4)==0)return Wu()===99?1:2;if(Ga===0&&(Ga=Fu),SK.transition!==0){O0!==0&&(O0=zx!==null?zx.pendingLanes:0),C=Ga;var A=4186112&~O0;return A&=-A,A===0&&(C=4186112&~C,A=C&-C,A===0&&(A=8192)),A}return C=Wu(),(_t&4)!=0&&C===98?C=f0(12,Ga):(C=mK(C),C=f0(C,Ga)),C}function Ba(C,A,v){if(50<Jf)throw Jf=0,Ux=null,Error(a(185));if(C=J0(C,A),C===null)return null;I0(C,A,v),C===Rr&&(Lu|=A,Pi===4&&Tu(C,ar));var N=Wu();A===1?(_t&8)!=0&&(_t&48)==0?Ox(C):(hs(C,v),_t===0&&(bl(),Ms())):((_t&4)==0||N!==98&&N!==99||(wa===null?wa=new Set([C]):wa.add(C)),hs(C,v)),zx=C}function J0(C,A){C.lanes|=A;var v=C.alternate;for(v!==null&&(v.lanes|=A),v=C,C=C.return;C!==null;)C.childLanes|=A,v=C.alternate,v!==null&&(v.childLanes|=A),v=C,C=C.return;return v.tag===3?v.stateNode:null}function hs(C,A){for(var v=C.callbackNode,N=C.suspendedLanes,L=C.pingedLanes,Q=C.expirationTimes,ce=C.pendingLanes;0<ce;){var Ae=31-Cl(ce),Te=1<<Ae,it=Q[Ae];if(it===-1){if((Te&N)==0||(Te&L)!=0){it=A,$c(Te);var Zt=Vn;Q[Ae]=10<=Zt?it+250:6<=Zt?it+5e3:-1}}else it<=A&&(C.expiredLanes|=Te);ce&=~Te}if(N=Mf(C,C===Rr?ar:0),A=Vn,N===0)v!==null&&(v!==ax&&sx(v),C.callbackNode=null,C.callbackPriority=0);else{if(v!==null){if(C.callbackPriority===A)return;v!==ax&&sx(v)}A===15?(v=Ox.bind(null,C),ba===null?(ba=[v],p0=rx(C0,LR)):ba.push(v),v=ax):A===14?v=Wf(99,Ox.bind(null,C)):(v=AK(A),v=Wf(v,HM.bind(null,C))),C.callbackPriority=A,C.callbackNode=v}}function HM(C){if(U0=-1,O0=Ga=0,(_t&48)!=0)throw Error(a(327));var A=C.callbackNode;if(Sa()&&C.callbackNode!==A)return null;var v=Mf(C,C===Rr?ar:0);if(v===0)return null;var N=v,L=_t;_t|=16;var Q=XM();(Rr!==C||ar!==N)&&(bl(),Xu(C,N));do try{UK();break}catch(Ae){TM(C,Ae)}while(1);if(cx(),K0.current=Q,_t=L,xi!==null?N=0:(Rr=null,ar=0,N=Pi),(Fu&Lu)!=0)Xu(C,0);else if(N!==0){if(N===2&&(_t|=64,C.hydrate&&(C.hydrate=!1,Jt(C.containerInfo)),v=MR(C),v!==0&&(N=qf(C,v))),N===1)throw A=P0,Xu(C,0),Tu(C,v),hs(C,Yi()),A;switch(C.finishedWork=C.current.alternate,C.finishedLanes=v,N){case 0:case 1:throw Error(a(345));case 2:rg(C);break;case 3:if(Tu(C,v),(v&62914560)===v&&(N=kx+500-Yi(),10<N)){if(Mf(C,0)!==0)break;if(L=C.suspendedLanes,(L&v)!==v){Ur(),C.pingedLanes|=C.suspendedLanes&L;break}C.timeoutHandle=Ne(rg.bind(null,C),N);break}rg(C);break;case 4:if(Tu(C,v),(v&4186112)===v)break;for(N=C.eventTimes,L=-1;0<v;){var ce=31-Cl(v);Q=1<<ce,ce=N[ce],ce>L&&(L=ce),v&=~Q}if(v=L,v=Yi()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*KK(v/1960))-v,10<v){C.timeoutHandle=Ne(rg.bind(null,C),v);break}rg(C);break;case 5:rg(C);break;default:throw Error(a(329))}}return hs(C,Yi()),C.callbackNode===A?HM.bind(null,C):null}function Tu(C,A){for(A&=~Xx,A&=~Lu,C.suspendedLanes|=A,C.pingedLanes&=~A,C=C.expirationTimes;0<A;){var v=31-Cl(A),N=1<<v;C[v]=-1,A&=~N}}function Ox(C){if((_t&48)!=0)throw Error(a(327));if(Sa(),C===Rr&&(C.expiredLanes&ar)!=0){var A=ar,v=qf(C,A);(Fu&Lu)!=0&&(A=Mf(C,A),v=qf(C,A))}else A=Mf(C,0),v=qf(C,A);if(C.tag!==0&&v===2&&(_t|=64,C.hydrate&&(C.hydrate=!1,Jt(C.containerInfo)),A=MR(C),A!==0&&(v=qf(C,A))),v===1)throw v=P0,Xu(C,0),Tu(C,A),hs(C,Yi()),v;return C.finishedWork=C.current.alternate,C.finishedLanes=A,rg(C),hs(C,Yi()),null}function PK(){if(wa!==null){var C=wa;wa=null,C.forEach(function(A){A.expiredLanes|=24&A.pendingLanes,hs(A,Yi())})}Ms()}function FM(C,A){var v=_t;_t|=1;try{return C(A)}finally{_t=v,_t===0&&(bl(),Ms())}}function LM(C,A){var v=_t;if((v&48)!=0)return C(A);_t|=1;try{if(C)return ya(99,C.bind(null,A))}finally{_t=v,Ms()}}function Q0(C,A){yt(Tx,ig),ig|=A,Fu|=A}function Jx(){ig=Tx.current,Yt(Tx)}function Xu(C,A){C.finishedWork=null,C.finishedLanes=0;var v=C.timeoutHandle;if(v!==ne&&(C.timeoutHandle=ne,He(v)),xi!==null)for(v=xi.return;v!==null;){var N=v;switch(N.tag){case 1:N=N.type.childContextTypes,N!=null&&Rs();break;case 3:Eu(),Yt(In),Yt(Ft),px();break;case 5:fx(N);break;case 4:Eu();break;case 13:Yt(ti);break;case 19:Yt(ti);break;case 10:gx(N);break;case 23:case 24:Jx()}v=v.return}Rr=C,xi=wl(C.current,null),ar=ig=Fu=A,Pi=0,P0=null,Xx=Lu=Df=0}function TM(C,A){do{var v=xi;try{if(cx(),Hf.current=V0,R0){for(var N=oi.memoizedState;N!==null;){var L=N.queue;L!==null&&(L.pending=null),N=N.next}R0=!1}if(Ff=0,Ki=or=oi=null,Lf=!1,Fx.current=null,v===null||v.return===null){Pi=1,P0=A,xi=null;break}e:{var Q=C,ce=v.return,Ae=v,Te=A;if(A=ar,Ae.flags|=2048,Ae.firstEffect=Ae.lastEffect=null,Te!==null&&typeof Te=="object"&&typeof Te.then=="function"){var it=Te;if((Ae.mode&2)==0){var Zt=Ae.alternate;Zt?(Ae.updateQueue=Zt.updateQueue,Ae.memoizedState=Zt.memoizedState,Ae.lanes=Zt.lanes):(Ae.updateQueue=null,Ae.memoizedState=null)}var Lt=(ti.current&1)!=0,dt=ce;do{var Zn;if(Zn=dt.tag===13){var Kn=dt.memoizedState;if(Kn!==null)Zn=Kn.dehydrated!==null;else{var Hs=dt.memoizedProps;Zn=Hs.fallback===void 0?!1:Hs.unstable_avoidThisFallback!==!0?!0:!Lt}}if(Zn){var Ve=dt.updateQueue;if(Ve===null){var ve=new Set;ve.add(it),dt.updateQueue=ve}else Ve.add(it);if((dt.mode&2)==0){if(dt.flags|=64,Ae.flags|=16384,Ae.flags&=-2981,Ae.tag===1)if(Ae.alternate===null)Ae.tag=17;else{var ze=ml(-1,1);ze.tag=2,Al(Ae,ze)}Ae.lanes|=1;break e}Te=void 0,Ae=A;var gt=Q.pingCache;if(gt===null?(gt=Q.pingCache=new LK,Te=new Set,gt.set(it,Te)):(Te=gt.get(it),Te===void 0&&(Te=new Set,gt.set(it,Te))),!Te.has(Ae)){Te.add(Ae);var Rt=qK.bind(null,Q,it,Ae);it.then(Rt,Rt)}dt.flags|=4096,dt.lanes=A;break e}dt=dt.return}while(dt!==null);Te=Error((w(Ae.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Pi!==5&&(Pi=2),Te=Zx(Te,Ae),dt=ce;do{switch(dt.tag){case 3:Q=Te,dt.flags|=4096,A&=-A,dt.lanes|=A;var Nn=xM(dt,Q,A);kR(dt,Nn);break e;case 1:Q=Te;var Xt=dt.type,Cn=dt.stateNode;if((dt.flags&64)==0&&(typeof Xt.getDerivedStateFromError=="function"||Cn!==null&&typeof Cn.componentDidCatch=="function"&&(Ho===null||!Ho.has(Cn)))){dt.flags|=4096,A&=-A,dt.lanes|=A;var Ai=wM(dt,Q,A);kR(dt,Ai);break e}}dt=dt.return}while(dt!==null)}kM(v)}catch(tn){A=tn,xi===v&&v!==null&&(xi=v=v.return);continue}break}while(1)}function XM(){var C=K0.current;return K0.current=V0,C===null?V0:C}function qf(C,A){var v=_t;_t|=16;var N=XM();Rr===C&&ar===A||Xu(C,A);do try{DK();break}catch(L){TM(C,L)}while(1);if(cx(),_t=v,K0.current=N,xi!==null)throw Error(a(261));return Rr=null,ar=0,Pi}function DK(){for(;xi!==null;)zM(xi)}function UK(){for(;xi!==null&&!wK();)zM(xi)}function zM(C){var A=PM(C.alternate,C,ig);C.memoizedProps=C.pendingProps,A===null?kM(C):xi=A,Fx.current=null}function kM(C){var A=C;do{var v=A.alternate;if(C=A.return,(A.flags&2048)==0){if(v=HK(v,A,ig),v!==null){xi=v;return}if(v=A,v.tag!==24&&v.tag!==23||v.memoizedState===null||(ig&1073741824)!=0||(v.mode&4)==0){for(var N=0,L=v.child;L!==null;)N|=L.lanes|L.childLanes,L=L.sibling;v.childLanes=N}C!==null&&(C.flags&2048)==0&&(C.firstEffect===null&&(C.firstEffect=A.firstEffect),A.lastEffect!==null&&(C.lastEffect!==null&&(C.lastEffect.nextEffect=A.firstEffect),C.lastEffect=A.lastEffect),1<A.flags&&(C.lastEffect!==null?C.lastEffect.nextEffect=A:C.firstEffect=A,C.lastEffect=A))}else{if(v=FK(A),v!==null){v.flags&=2047,xi=v;return}C!==null&&(C.firstEffect=C.lastEffect=null,C.flags|=2048)}if(A=A.sibling,A!==null){xi=A;return}xi=A=C}while(A!==null);Pi===0&&(Pi=5)}function rg(C){var A=Wu();return ya(99,OK.bind(null,C,A)),null}function OK(C,A){do Sa();while(Uf!==null);if((_t&48)!=0)throw Error(a(327));var v=C.finishedWork;if(v===null)return null;if(C.finishedWork=null,C.finishedLanes=0,v===C.current)throw Error(a(177));C.callbackNode=null;var N=v.lanes|v.childLanes,L=N,Q=C.pendingLanes&~L;C.pendingLanes=L,C.suspendedLanes=0,C.pingedLanes=0,C.expiredLanes&=L,C.mutableReadLanes&=L,C.entangledLanes&=L,L=C.entanglements;for(var ce=C.eventTimes,Ae=C.expirationTimes;0<Q;){var Te=31-Cl(Q),it=1<<Te;L[Te]=0,ce[Te]=-1,Ae[Te]=-1,Q&=~it}if(wa!==null&&(N&24)==0&&wa.has(C)&&wa.delete(C),C===Rr&&(xi=Rr=null,ar=0),1<v.flags?v.lastEffect!==null?(v.lastEffect.nextEffect=v,N=v.firstEffect):N=v:N=v.firstEffect,N!==null){L=_t,_t|=32,Fx.current=null,Qf=K(C.containerInfo),jf=!1,It=N;do try{JK()}catch(ve){if(It===null)throw Error(a(330));xl(It,ve),It=It.nextEffect}while(It!==null);Qf=null,It=N;do try{for(ce=C;It!==null;){var Zt=It.flags;if(Zt&16&&Ie&&ht(It.stateNode),Zt&128){var Lt=It.alternate;if(Lt!==null){var dt=Lt.ref;dt!==null&&(typeof dt=="function"?dt(null):dt.current=null)}}switch(Zt&1038){case 2:_M(It),It.flags&=-3;break;case 6:_M(It),It.flags&=-3,_x(It.alternate,It);break;case 1024:It.flags&=-1025;break;case 1028:It.flags&=-1025,_x(It.alternate,It);break;case 4:_x(It.alternate,It);break;case 8:Ae=ce,Q=It,Ie?VM(Ae,Q):RM(Ae,Q);var Zn=Q.alternate;MM(Q),Zn!==null&&MM(Zn)}It=It.nextEffect}}catch(ve){if(It===null)throw Error(a(330));xl(It,ve),It=It.nextEffect}while(It!==null);jf&&q(),j(C.containerInfo),C.current=v,It=N;do try{for(Zt=C;It!==null;){var Kn=It.flags;if(Kn&36&&zK(Zt,It.alternate,It),Kn&128){Lt=void 0;var Hs=It.ref;if(Hs!==null){var Ve=It.stateNode;switch(It.tag){case 5:Lt=Z(Ve);break;default:Lt=Ve}typeof Hs=="function"?Hs(Lt):Hs.current=Lt}}It=It.nextEffect}}catch(ve){if(It===null)throw Error(a(330));xl(It,ve),It=It.nextEffect}while(It!==null);It=null,BK(),_t=L}else C.current=v;if(yl)yl=!1,Uf=C,Of=A;else for(It=N;It!==null;)A=It.nextEffect,It.nextEffect=null,It.flags&8&&(Kn=It,Kn.sibling=null,Kn.stateNode=null),It=A;if(N=C.pendingLanes,N===0&&(Ho=null),N===1?C===Ux?Jf++:(Jf=0,Ux=C):Jf=0,v=v.stateNode,qc&&typeof qc.onCommitFiberRoot=="function")try{qc.onCommitFiberRoot(nx,v,void 0,(v.current.flags&64)==64)}catch{}if(hs(C,Yi()),D0)throw D0=!1,C=Kx,Kx=null,C;return(_t&8)!=0||Ms(),null}function JK(){for(;It!==null;){var C=It.alternate;jf||Qf===null||((It.flags&8)!=0?_(It,Qf)&&(jf=!0,et()):It.tag===13&&kK(C,It)&&_(It,Qf)&&(jf=!0,et()));var A=It.flags;(A&256)!=0&&XK(C,It),(A&512)==0||yl||(yl=!0,Wf(97,function(){return Sa(),null})),It=It.nextEffect}}function Sa(){if(Of!==90){var C=97<Of?97:Of;return Of=90,ya(C,jK)}return!1}function QK(C,A){Px.push(A,C),yl||(yl=!0,Wf(97,function(){return Sa(),null}))}function YM(C,A){Dx.push(A,C),yl||(yl=!0,Wf(97,function(){return Sa(),null}))}function jK(){if(Uf===null)return!1;var C=Uf;if(Uf=null,(_t&48)!=0)throw Error(a(331));var A=_t;_t|=32;var v=Dx;Dx=[];for(var N=0;N<v.length;N+=2){var L=v[N],Q=v[N+1],ce=L.destroy;if(L.destroy=void 0,typeof ce=="function")try{ce()}catch(Te){if(Q===null)throw Error(a(330));xl(Q,Te)}}for(v=Px,Px=[],N=0;N<v.length;N+=2){L=v[N],Q=v[N+1];try{var Ae=L.create;L.destroy=Ae()}catch(Te){if(Q===null)throw Error(a(330));xl(Q,Te)}}for(Ae=C.current.firstEffect;Ae!==null;)C=Ae.nextEffect,Ae.nextEffect=null,Ae.flags&8&&(Ae.sibling=null,Ae.stateNode=null),Ae=C;return _t=A,Ms(),!0}function KM(C,A,v){A=Zx(v,A),A=xM(C,A,1),Al(C,A),A=Ur(),C=J0(C,1),C!==null&&(I0(C,1,A),hs(C,A))}function xl(C,A){if(C.tag===3)KM(C,C,A);else for(var v=C.return;v!==null;){if(v.tag===3){KM(v,C,A);break}else if(v.tag===1){var N=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(Ho===null||!Ho.has(N))){C=Zx(A,C);var L=wM(v,C,1);if(Al(v,L),L=Ur(),v=J0(v,1),v!==null)I0(v,1,L),hs(v,L);else if(typeof N.componentDidCatch=="function"&&(Ho===null||!Ho.has(N)))try{N.componentDidCatch(A,C)}catch{}break}}v=v.return}}function qK(C,A,v){var N=C.pingCache;N!==null&&N.delete(A),A=Ur(),C.pingedLanes|=C.suspendedLanes&v,Rr===C&&(ar&v)===v&&(Pi===4||Pi===3&&(ar&62914560)===ar&&500>Yi()-kx?Xu(C,0):Xx|=v),hs(C,A)}function $K(C,A){var v=C.stateNode;v!==null&&v.delete(A),A=0,A===0&&(A=C.mode,(A&2)==0?A=1:(A&4)==0?A=Wu()===99?1:2:(Ga===0&&(Ga=Fu),A=Mu(62914560&~Ga),A===0&&(A=4194304))),v=Ur(),C=J0(C,A),C!==null&&(I0(C,A,v),hs(C,v))}var PM;PM=function(C,A,v){var N=A.lanes;if(C!==null)if(C.memoizedProps!==A.pendingProps||In.current)ro=!0;else if((v&N)!=0)ro=(C.flags&16384)!=0;else{switch(ro=!1,A.tag){case 3:IM(A),Cx();break;case 5:QR(A);break;case 1:Yn(A.type)&&d0(A);break;case 4:hx(A,A.stateNode.containerInfo);break;case 10:TR(A,A.memoizedProps.value);break;case 13:if(A.memoizedState!==null)return(v&A.child.childLanes)!=0?CM(C,A,v):(yt(ti,ti.current&1),A=xa(C,A,v),A!==null?A.sibling:null);yt(ti,ti.current&1);break;case 19:if(N=(v&A.childLanes)!=0,(C.flags&64)!=0){if(N)return yM(C,A,v);A.flags|=64}var L=A.memoizedState;if(L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),yt(ti,ti.current),N)break;return null;case 23:case 24:return A.lanes=0,wx(C,A,v)}return xa(C,A,v)}else ro=!1;switch(A.lanes=0,A.tag){case 2:if(N=A.type,C!==null&&(C.alternate=null,A.alternate=null,A.flags|=2),C=A.pendingProps,L=Sn(A,Ft.current),Vu(A,v),L=Ax(null,A,N,C,L,v),A.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0){if(A.tag=1,A.memoizedState=null,A.updateQueue=null,Yn(N)){var Q=!0;d0(A)}else Q=!1;A.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,ux(A);var ce=N.getDerivedStateFromProps;typeof ce=="function"&&v0(A,N,ce,C),L.updater=x0,A.stateNode=L,L._reactInternals=A,dx(A,N,C,v),A=Bx(null,A,N,!0,Q,v)}else A.tag=0,Dr(null,A,L,v),A=A.child;return A;case 16:L=A.elementType;e:{switch(C!==null&&(C.alternate=null,A.alternate=null,A.flags|=2),C=A.pendingProps,Q=L._init,L=Q(L._payload),A.type=L,Q=A.tag=tP(L),C=io(L,C),Q){case 0:A=Gx(null,A,L,C,v);break e;case 1:A=fM(null,A,L,C,v);break e;case 11:A=gM(null,A,L,C,v);break e;case 14:A=uM(null,A,L,io(L.type,C),N,v);break e}throw Error(a(306,L,""))}return A;case 0:return N=A.type,L=A.pendingProps,L=A.elementType===N?L:io(N,L),Gx(C,A,N,L,v);case 1:return N=A.type,L=A.pendingProps,L=A.elementType===N?L:io(N,L),fM(C,A,N,L,v);case 3:if(IM(A),N=A.updateQueue,C===null||N===null)throw Error(a(282));if(N=A.pendingProps,L=A.memoizedState,L=L!==null?L.element:null,zR(C,A),_f(A,N,null,v),N=A.memoizedState.element,N===L)Cx(),A=xa(C,A,v);else{if(L=A.stateNode,(Q=L.hydrate)&&(Re?(eg=Je(A.stateNode.containerInfo),va=A,Q=Vo=!0):Q=!1),Q){if(Re&&(C=L.mutableSourceEagerHydrationData,C!=null))for(L=0;L<C.length;L+=2)Q=C[L],ce=C[L+1],de?Q._workInProgressVersionPrimary=ce:Q._workInProgressVersionSecondary=ce,Hu.push(Q);for(v=JR(A,null,N,v),A.child=v;v;)v.flags=v.flags&-3|1024,v=v.sibling}else Dr(C,A,N,v),Cx();A=A.child}return A;case 5:return QR(A),C===null&&Ix(A),N=A.type,L=A.pendingProps,Q=C!==null?C.memoizedProps:null,ce=L.children,Ce(N,L)?ce=null:Q!==null&&Ce(N,Q)&&(A.flags|=16),hM(C,A),Dr(C,A,ce,v),A.child;case 6:return C===null&&Ix(A),null;case 13:return CM(C,A,v);case 4:return hx(A,A.stateNode.containerInfo),N=A.pendingProps,C===null?A.child=B0(A,null,N,v):Dr(C,A,N,v),A.child;case 11:return N=A.type,L=A.pendingProps,L=A.elementType===N?L:io(N,L),gM(C,A,N,L,v);case 7:return Dr(C,A,A.pendingProps,v),A.child;case 8:return Dr(C,A,A.pendingProps.children,v),A.child;case 12:return Dr(C,A,A.pendingProps.children,v),A.child;case 10:e:{if(N=A.type._context,L=A.pendingProps,ce=A.memoizedProps,Q=L.value,TR(A,Q),ce!==null){var Ae=ce.value;if(Q=Ws(Ae,Q)?0:(typeof N._calculateChangedBits=="function"?N._calculateChangedBits(Ae,Q):1073741823)|0,Q===0){if(ce.children===L.children&&!In.current){A=xa(C,A,v);break e}}else for(Ae=A.child,Ae!==null&&(Ae.return=A);Ae!==null;){var Te=Ae.dependencies;if(Te!==null){ce=Ae.child;for(var it=Te.firstContext;it!==null;){if(it.context===N&&(it.observedBits&Q)!=0){Ae.tag===1&&(it=ml(-1,v&-v),it.tag=2,Al(Ae,it)),Ae.lanes|=v,it=Ae.alternate,it!==null&&(it.lanes|=v),XR(Ae.return,v),Te.lanes|=v;break}it=it.next}}else ce=Ae.tag===10&&Ae.type===A.type?null:Ae.child;if(ce!==null)ce.return=Ae;else for(ce=Ae;ce!==null;){if(ce===A){ce=null;break}if(Ae=ce.sibling,Ae!==null){Ae.return=ce.return,ce=Ae;break}ce=ce.return}Ae=ce}}Dr(C,A,L.children,v),A=A.child}return A;case 9:return L=A.type,Q=A.pendingProps,N=Q.children,Vu(A,v),L=_s(L,Q.unstable_observedBits),N=N(L),A.flags|=1,Dr(C,A,N,v),A.child;case 14:return L=A.type,Q=io(L,A.pendingProps),Q=io(L.type,Q),uM(C,A,L,Q,N,v);case 15:return dM(C,A,A.type,A.pendingProps,N,v);case 17:return N=A.type,L=A.pendingProps,L=A.elementType===N?L:io(N,L),C!==null&&(C.alternate=null,A.alternate=null,A.flags|=2),A.tag=1,Yn(N)?(C=!0,d0(A)):C=!1,Vu(A,v),DR(A,N,L),dx(A,N,L,v),Bx(null,A,N,!0,C,v);case 19:return yM(C,A,v);case 23:return wx(C,A,v);case 24:return wx(C,A,v)}throw Error(a(156,A.tag))};var j0={current:!1},Qx=o.unstable_flushAllWithoutAsserting,DM=typeof Qx=="function";function jx(){if(Qx!==void 0)return Qx();for(var C=!1;Sa();)C=!0;return C}function UM(C){try{jx(),YK(function(){jx()?UM(C):C()})}catch(A){C(A)}}var q0=0,OM=!1;function eP(C,A,v,N){this.tag=C,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=A,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Es(C,A,v,N){return new eP(C,A,v,N)}function qx(C){return C=C.prototype,!(!C||!C.isReactComponent)}function tP(C){if(typeof C=="function")return qx(C)?1:0;if(C!=null){if(C=C.$$typeof,C===y)return 11;if(C===G)return 14}return 2}function wl(C,A){var v=C.alternate;return v===null?(v=Es(C.tag,A,C.key,C.mode),v.elementType=C.elementType,v.type=C.type,v.stateNode=C.stateNode,v.alternate=C,C.alternate=v):(v.pendingProps=A,v.type=C.type,v.flags=0,v.nextEffect=null,v.firstEffect=null,v.lastEffect=null),v.childLanes=C.childLanes,v.lanes=C.lanes,v.child=C.child,v.memoizedProps=C.memoizedProps,v.memoizedState=C.memoizedState,v.updateQueue=C.updateQueue,A=C.dependencies,v.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext},v.sibling=C.sibling,v.index=C.index,v.ref=C.ref,v}function $0(C,A,v,N,L,Q){var ce=2;if(N=C,typeof C=="function")qx(C)&&(ce=1);else if(typeof C=="string")ce=5;else e:switch(C){case d:return zu(v.children,L,Q,A);case M:ce=8,L|=16;break;case u:ce=8,L|=1;break;case h:return C=Es(12,v,A,L|8),C.elementType=h,C.type=h,C.lanes=Q,C;case m:return C=Es(13,v,A,L),C.type=m,C.elementType=m,C.lanes=Q,C;case f:return C=Es(19,v,A,L),C.elementType=f,C.lanes=Q,C;case E:return $x(v,L,Q,A);case z:return C=Es(24,v,A,L),C.elementType=z,C.lanes=Q,C;default:if(typeof C=="object"&&C!==null)switch(C.$$typeof){case p:ce=10;break e;case b:ce=9;break e;case y:ce=11;break e;case G:ce=14;break e;case x:ce=16,N=null;break e;case B:ce=22;break e}throw Error(a(130,C==null?C:typeof C,""))}return A=Es(ce,v,A,L),A.elementType=C,A.type=N,A.lanes=Q,A}function zu(C,A,v,N){return C=Es(7,C,N,A),C.lanes=v,C}function $x(C,A,v,N){return C=Es(23,C,N,A),C.elementType=E,C.lanes=v,C}function ew(C,A,v){return C=Es(6,C,null,A),C.lanes=v,C}function tw(C,A,v){return A=Es(4,C.children!==null?C.children:[],C.key,A),A.lanes=v,A.stateNode={containerInfo:C.containerInfo,pendingChildren:null,implementation:C.implementation},A}function nP(C,A,v){this.tag=A,this.containerInfo=C,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ne,this.pendingContext=this.context=null,this.hydrate=v,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=ix(0),this.expirationTimes=ix(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ix(0),Re&&(this.mutableSourceEagerHydrationData=null)}function JM(C){var A=C._reactInternals;if(A===void 0)throw typeof C.render=="function"?Error(a(188)):Error(a(268,Object.keys(C)));return C=H(A),C===null?null:C.stateNode}function QM(C,A){if(C=C.memoizedState,C!==null&&C.dehydrated!==null){var v=C.retryLane;C.retryLane=v!==0&&v<A?v:A}}function em(C,A){QM(C,A),(C=C.alternate)&&QM(C,A)}function iP(C){return C=H(C),C===null?null:C.stateNode}function rP(){return null}return n.IsThisRendererActing=j0,n.act=function(C){function A(){q0--,Lx.current=v,j0.current=N}OM===!1&&(OM=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),q0++;var v=Lx.current,N=j0.current;Lx.current=!0,j0.current=!0;try{var L=FM(C)}catch(Q){throw A(),Q}if(L!==null&&typeof L=="object"&&typeof L.then=="function")return{then:function(Q,ce){L.then(function(){1<q0||DM===!0&&v===!0?(A(),Q()):UM(function(Ae){A(),Ae?ce(Ae):Q()})},function(Ae){A(),ce(Ae)})}};try{q0!==1||DM!==!1&&v!==!1||jx(),A()}catch(Q){throw A(),Q}return{then:function(Q){Q()}}},n.attemptContinuousHydration=function(C){if(C.tag===13){var A=Ur();Ba(C,67108864,A),em(C,67108864)}},n.attemptHydrationAtCurrentPriority=function(C){if(C.tag===13){var A=Ur(),v=vl(C);Ba(C,v,A),em(C,v)}},n.attemptSynchronousHydration=function(C){switch(C.tag){case 3:var A=C.stateNode;if(A.hydrate){var v=$c(A.pendingLanes);A.expiredLanes|=v&A.pendingLanes,hs(A,Yi()),(_t&48)==0&&(bl(),Ms())}break;case 13:var N=Ur();LM(function(){return Ba(C,1,N)}),em(C,4)}},n.attemptUserBlockingHydration=function(C){if(C.tag===13){var A=Ur();Ba(C,4,A),em(C,4)}},n.batchedEventUpdates=function(C,A){var v=_t;_t|=2;try{return C(A)}finally{_t=v,_t===0&&(bl(),Ms())}},n.batchedUpdates=FM,n.createComponentSelector=function(C){return{$$typeof:L0,value:C}},n.createContainer=function(C,A,v){return C=new nP(C,A,v),A=Es(3,null,null,A===2?7:A===1?3:0),C.current=A,A.stateNode=C,ux(A),C},n.createHasPsuedoClassSelector=function(C){return{$$typeof:T0,value:C}},n.createPortal=function(C,A,v){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:N==null?null:""+N,children:C,containerInfo:A,implementation:v}},n.createRoleSelector=function(C){return{$$typeof:X0,value:C}},n.createTestNameSelector=function(C){return{$$typeof:z0,value:C}},n.createTextSelector=function(C){return{$$typeof:k0,value:C}},n.deferredUpdates=function(C){return ya(97,C)},n.discreteUpdates=function(C,A,v,N,L){var Q=_t;_t|=4;try{return ya(98,C.bind(null,A,v,N,L))}finally{_t=Q,_t===0&&(bl(),Ms())}},n.findAllNodes=Hx,n.findBoundingRects=function(C,A){if(!D)throw Error(a(363));A=Hx(C,A),C=[];for(var v=0;v<A.length;v++)C.push(Se(A[v]));for(A=C.length-1;0<A;A--){v=C[A];for(var N=v.x,L=N+v.width,Q=v.y,ce=Q+v.height,Ae=A-1;0<=Ae;Ae--)if(A!==Ae){var Te=C[Ae],it=Te.x,Zt=it+Te.width,Lt=Te.y,dt=Lt+Te.height;if(N>=it&&Q>=Lt&&L<=Zt&&ce<=dt){C.splice(A,1);break}else if(N!==it||v.width!==Te.width||dt<Q||Lt>ce){if(!(Q!==Lt||v.height!==Te.height||Zt<N||it>L)){it>N&&(Te.width+=it-N,Te.x=N),Zt<L&&(Te.width=L-it),C.splice(A,1);break}}else{Lt>Q&&(Te.height+=Lt-Q,Te.y=Q),dt<ce&&(Te.height=ce-Lt),C.splice(A,1);break}}}return C},n.findHostInstance=JM,n.findHostInstanceWithNoPortals=function(C){return C=k(C),C===null?null:C.tag===20?C.stateNode.instance:C.stateNode},n.findHostInstanceWithWarning=function(C){return JM(C)},n.flushControlled=function(C){var A=_t;_t|=1;try{ya(99,C)}finally{_t=A,_t===0&&(bl(),Ms())}},n.flushDiscreteUpdates=function(){(_t&49)==0&&(PK(),Sa())},n.flushPassiveEffects=Sa,n.flushSync=LM,n.focusWithin=function(C,A){if(!D)throw Error(a(363));for(C=Vx(C),A=EM(C,A),A=Array.from(A),C=0;C<A.length;){var v=A[C++];if(!pe(v)){if(v.tag===5&&re(v.stateNode))return!0;for(v=v.child;v!==null;)A.push(v),v=v.sibling}}return!1},n.getCurrentUpdateLanePriority=function(){return h0},n.getFindAllNodesFailureDescription=function(C,A){if(!D)throw Error(a(363));var v=0,N=[];C=[Vx(C),0];for(var L=0;L<C.length;){var Q=C[L++],ce=C[L++],Ae=A[ce];if((Q.tag!==5||!pe(Q))&&(Nx(Q,Ae)&&(N.push(Ex(Ae)),ce++,ce>v&&(v=ce)),ce<A.length))for(Q=Q.child;Q!==null;)C.push(Q,ce),Q=Q.sibling}if(v<A.length){for(C=[];v<A.length;v++)C.push(Ex(A[v]));return`findAllNodes was able to match part of the selector:
  `+(N.join(" > ")+`

No matching component was found for:
  `)+C.join(" > ")}return null},n.getPublicRootInstance=function(C){if(C=C.current,!C.child)return null;switch(C.child.tag){case 5:return Z(C.child.stateNode);default:return C.child.stateNode}},n.injectIntoDevTools=function(C){if(C={bundleType:C.bundleType,version:C.version,rendererPackageName:C.rendererPackageName,rendererConfig:C.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:l.ReactCurrentDispatcher,findHostInstanceByFiber:iP,findFiberByHostInstance:C.findFiberByHostInstance||rP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined")C=!1;else{var A=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!A.isDisabled&&A.supportsFiber)try{nx=A.inject(C),qc=A}catch{}C=!0}return C},n.observeVisibleRects=function(C,A,v,N){if(!D)throw Error(a(363));C=Hx(C,A);var L=be(C,v,N).disconnect;return{disconnect:function(){L()}}},n.registerMutableSourceForHydration=function(C,A){var v=A._getVersion;v=v(A._source),C.mutableSourceEagerHydrationData==null?C.mutableSourceEagerHydrationData=[A,v]:C.mutableSourceEagerHydrationData.push(A,v)},n.runWithPriority=function(C,A){var v=h0;try{return h0=C,A()}finally{h0=v}},n.shouldSuspend=function(){return!1},n.unbatchedUpdates=function(C,A){var v=_t;_t&=-2,_t|=8;try{return C(A)}finally{_t=v,_t===0&&(bl(),Ms())}},n.updateContainer=function(C,A,v,N){var L=A.current,Q=Ur(),ce=vl(L);e:if(v){v=v._reactInternals;t:{if(S(v)!==v||v.tag!==1)throw Error(a(170));var Ae=v;do{switch(Ae.tag){case 3:Ae=Ae.stateNode.context;break t;case 1:if(Yn(Ae.type)){Ae=Ae.stateNode.__reactInternalMemoizedMergedChildContext;break t}}Ae=Ae.return}while(Ae!==null);throw Error(a(171))}if(v.tag===1){var Te=v.type;if(Yn(Te)){v=ZR(v,Te,Ae);break e}}v=Ae}else v=sn;return A.context===null?A.context=v:A.pendingContext=v,A=ml(Q,ce),A.payload={element:C},N=N===void 0?null:N,N!==null&&(A.callback=N),Al(L,A),Ba(L,ce,Q),ce},n}})(RX);ZX.exports=RX.exports;var uce=ZX.exports,zZ=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!=0;)if(!i(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!=0;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!=0;){var o=s[r];if(!i(e[o],t[o]))return!1}return!0}return e!==e&&t!==t};const $y=[];function MX(i,e,t,n=0,r=!1){for(const o of e)if(zZ(t,o.args)){if(r)return;if(o.error)throw o.error;if(o.response)return o.response;throw o.promise}const s={args:t,promise:i(...t).then(o=>s.response=o!=null?o:!0).catch(o=>s.error=o!=null?o:"unknown error").then(()=>{n>0&&setTimeout(()=>{const o=e.indexOf(s);o!==-1&&e.splice(o,1)},n)})};if(e.push(s),!r)throw s.promise}function dce(i,...e){if(e===void 0||e.length===0)i.splice(0,i.length);else{const t=i.find(n=>zZ(e,n.args));if(t){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}}function ol(i,...e){return MX(i,$y,e,ol.lifespan)}ol.lifespan=0;ol.clear=(...i)=>dce($y,...i);ol.preload=(i,...e)=>void MX(i,$y,e,ol.lifespan,!0);ol.peek=(...i)=>{var e;return(e=$y.find(t=>zZ(i,t.args)))==null?void 0:e.response};function hce(i){return function(e){i.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}function kZ(i,e,t){var n,r,s,o,a;e==null&&(e=100);function l(){var g=Date.now()-o;g<e&&g>=0?n=setTimeout(l,e-g):(n=null,t||(a=i.apply(s,r),s=r=null))}var c=function(){s=this,r=arguments,o=Date.now();var g=t&&!n;return n||(n=setTimeout(l,e)),g&&(a=i.apply(s,r),s=r=null),a};return c.clear=function(){n&&(clearTimeout(n),n=null)},c.flush=function(){n&&(a=i.apply(s,r),s=r=null,clearTimeout(n),n=null)},c}kZ.debounce=kZ;var WX=kZ;function fce(i){let{debounce:e,scroll:t,polyfill:n,offsetSize:r}=i===void 0?{debounce:0,scroll:!1,offsetSize:!1}:i;const s=n||(typeof window=="undefined"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,a]=ue.exports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=ue.exports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o}),c=e?typeof e=="number"?e:e.scroll:null,g=e?typeof e=="number"?e:e.resize:null,d=ue.exports.useRef(!1);ue.exports.useEffect(()=>(d.current=!0,()=>void(d.current=!1)));const[u,h,p]=ue.exports.useMemo(()=>{const f=()=>{if(!l.current.element)return;const{left:G,top:x,width:B,height:M,bottom:E,right:z,x:J,y:V}=l.current.element.getBoundingClientRect(),I={left:G,top:x,width:B,height:M,bottom:E,right:z,x:J,y:V};l.current.element instanceof HTMLElement&&r&&(I.height=l.current.element.offsetHeight,I.width=l.current.element.offsetWidth),Object.freeze(I),d.current&&!mce(l.current.lastBounds,I)&&a(l.current.lastBounds=I)};return[f,g?WX(f,g):f,c?WX(f,c):f]},[a,r,c,g]);function b(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(f=>f.removeEventListener("scroll",p,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function y(){!l.current.element||(l.current.resizeObserver=new s(p),l.current.resizeObserver.observe(l.current.element),t&&l.current.scrollContainers&&l.current.scrollContainers.forEach(f=>f.addEventListener("scroll",p,{capture:!0,passive:!0})))}const m=f=>{!f||f===l.current.element||(b(),l.current.element=f,l.current.scrollContainers=_X(f),y())};return Cce(p,Boolean(t)),Ice(h),ue.exports.useEffect(()=>{b(),y()},[t,p,h]),ue.exports.useEffect(()=>b,[]),[m,o,u]}function Ice(i){ue.exports.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function Cce(i,e){ue.exports.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function _X(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,..._X(i.parentElement)]}const pce=["x","y","top","bottom","left","right","width","height"],mce=(i,e)=>pce.every(t=>i[t]===e[t]),Wn={obj:i=>i===Object(i)&&!Wn.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e){if(typeof i!=typeof e||!!i!=!!e)return!1;if(Wn.str(i)||Wn.num(i)||Wn.obj(i))return i===e;if(Wn.arr(i)&&i==e)return!0;let t;for(t in i)if(!(t in e))return!1;for(t in e)if(i[t]!==e[t])return!1;return Wn.und(t)?i===e:!0}};function YZ(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function VX(i,e,t,n){const r=t.get(e);r&&(t.delete(e),t.size===0&&(i.delete(n),r.target.releasePointerCapture(n)))}function Ace(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,r)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((n,r)=>{VX(t.capturedMap,e,n,r)})}function bce(i){const e=new te;function t(d){var u,h,p,b;const y=i.getState(),{raycaster:m,mouse:f,camera:G,size:x}=y,B=m.computeOffsets==null?void 0:m.computeOffsets(d,y),M=(u=B==null?void 0:B.offsetX)!=null?u:d.offsetX,E=(h=B==null?void 0:B.offsetY)!=null?h:d.offsetY,z=(p=B==null?void 0:B.width)!=null?p:x.width,J=(b=B==null?void 0:B.height)!=null?b:x.height;f.set(M/z*2-1,-(E/J)*2+1),m.setFromCamera(f,G)}function n(d){const{internal:u}=i.getState(),h=d.offsetX-u.initialClick[0],p=d.offsetY-u.initialClick[1];return Math.round(Math.sqrt(h*h+p*p))}function r(d){return d.filter(u=>["Move","Over","Enter","Out","Leave"].some(h=>{var p;return(p=u.__r3f)==null?void 0:p.handlers["onPointer"+h]}))}function s(d){const u=i.getState(),{raycaster:h,internal:p}=u;if(!h.enabled)return[];const b=new Set,y=[],m=d?d(p.interaction):p.interaction;let f=h.intersectObjects(m,!0).filter(x=>{const B=YZ(x);return b.has(B)?!1:(b.add(B),!0)});h.filter&&(f=h.filter(f,u));for(const x of f){let B=x.object;for(;B;){var G;(G=B.__r3f)!=null&&G.eventCount&&y.push(pt(Oe({},x),{eventObject:B})),B=B.parent}}return y}function o(d,u){const{internal:h}=i.getState();if("pointerId"in u&&h.capturedMap.has(u.pointerId))for(let p of h.capturedMap.get(u.pointerId).values())d.push(p.intersection);return d}function a(d,u,h,p){const{raycaster:b,mouse:y,camera:m,internal:f}=i.getState();if(d.length){const G=e.set(y.x,y.y,0).unproject(m),x={stopped:!1};for(const B of d){const M=I=>{var w,S;return(w=(S=f.capturedMap.get(I))==null?void 0:S.has(B.eventObject))!=null?w:!1},E=I=>{const w={intersection:B,target:u.target};f.capturedMap.has(I)?f.capturedMap.get(I).set(B.eventObject,w):f.capturedMap.set(I,new Map([[B.eventObject,w]])),u.target.setPointerCapture(I)},z=I=>{const w=f.capturedMap.get(I);w&&VX(f.capturedMap,B.eventObject,w,I)};let J={};for(let I in u){let w=u[I];typeof w!="function"&&(J[I]=w)}let V=pt(Oe(Oe({},B),J),{spaceX:y.x,spaceY:y.y,intersections:d,stopped:x.stopped,delta:h,unprojectedPoint:G,ray:b.ray,camera:m,stopPropagation:()=>{const I="pointerId"in u&&f.capturedMap.get(u.pointerId);if((!I||I.has(B.eventObject))&&(V.stopped=x.stopped=!0,f.hovered.size&&Array.from(f.hovered.values()).find(w=>w.eventObject===B.eventObject))){const w=d.slice(0,d.indexOf(B));l([...w,B])}},target:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:z},currentTarget:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:z},sourceEvent:u,nativeEvent:u});if(p(V),x.stopped===!0)break}}return d}function l(d){const{internal:u}=i.getState();Array.from(u.hovered.values()).forEach(h=>{if(!d.length||!d.find(p=>p.object===h.object&&p.index===h.index&&p.instanceId===h.instanceId)){const b=h.eventObject.__r3f,y=b==null?void 0:b.handlers;if(u.hovered.delete(YZ(h)),b!=null&&b.eventCount){const m=pt(Oe({},h),{intersections:d||[]});y.onPointerOut==null||y.onPointerOut(m),y.onPointerLeave==null||y.onPointerLeave(m)}}})}const c=d=>{switch(d){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return u=>{const{internal:h}=i.getState();"pointerId"in u&&!h.capturedMap.has(u.pointerId)&&(h.capturedMap.delete(u.pointerId),l([]))}}return u=>{const{onPointerMissed:h,internal:p}=i.getState();t(u),p.lastEvent.current=u;const b=d==="onPointerMove",y=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",f=o(s(b?r:void 0),u),G=y?n(u):0;d==="onPointerDown"&&(p.initialClick=[u.offsetX,u.offsetY],p.initialHits=f.map(x=>x.eventObject)),y&&!f.length&&G<=2&&(g(u,p.interaction),h&&h(u)),b&&l(f),a(f,u,G,x=>{const B=x.eventObject,M=B.__r3f,E=M==null?void 0:M.handlers;if(!!(M!=null&&M.eventCount))if(b){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const z=YZ(x),J=p.hovered.get(z);J?J.stopped&&x.stopPropagation():(p.hovered.set(z,x),E.onPointerOver==null||E.onPointerOver(x),E.onPointerEnter==null||E.onPointerEnter(x))}E.onPointerMove==null||E.onPointerMove(x)}else{const z=E[d];z?(!y||p.initialHits.includes(B))&&(g(u,p.interaction.filter(J=>!p.initialHits.includes(J))),z(x)):y&&p.initialHits.includes(B)&&g(u,p.interaction.filter(J=>!p.initialHits.includes(J)))}})}};function g(d,u){u.forEach(h=>{var p;return(p=h.__r3f)==null||p.handlers.onPointerMissed==null?void 0:p.handlers.onPointerMissed(d)})}return{handlePointer:c}}const yce=i=>i&&!!i.memoized&&!!i.changes,ev=i=>i&&!!i.getState,KZ=(i,e)=>{var t,n;return{root:ev(i)?i:(t=(n=i.__r3f)==null?void 0:n.root)!=null?t:e.__r3f.root,container:ev(i)?i.getState().scene:i}},NX="__default",vce={};let PZ={},V0e=i=>void(PZ=Oe(Oe({},PZ),i));function xce(i,e){return!!(Wn.arr(i)&&Wn.equ(i,e)||i===e)}function Yh(i,e){const t=i;return(e!=null&&e.primitive||!t.__r3f)&&(t.__r3f=Oe({root:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},e)),i}function wce(i){function e(u,M,z={},B=!1){var E=M,{children:h,key:p,ref:b}=E,y=Gt(E,["children","key","ref"]);var J=z,{children:m,key:f,ref:G}=J,x=Gt(J,["children","key","ref"]);var V;const I=(V=u==null?void 0:u.__r3f)!=null?V:{},w=Object.entries(y),S=[];if(B){const W=Object.keys(x);for(let H=0;H<W.length;H++)y.hasOwnProperty(W[H])||w.unshift([W[H],NX+"remove"])}w.forEach(([W,H])=>{var k;if((k=u.__r3f)!=null&&k.primitive&&W==="object"||xce(H,x[W]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(W))return S.push([W,H,!0,[]]);let _=[];W.includes("-")&&(_=W.split("-")),S.push([W,H,!1,_])});const R=Oe({},y);return I.memoizedProps&&I.memoizedProps.args&&(R.args=I.memoizedProps.args),I.memoizedProps&&I.memoizedProps.attach&&(R.attach=I.memoizedProps.attach),{accumulative:B,memoized:R,changes:S}}function t(u,h){var p,b,y;const m=(p=u==null?void 0:u.__r3f)!=null?p:{},f=m.root,G=(b=f==null||f.getState==null?void 0:f.getState())!=null?b:{},{memoized:x,changes:B}=yce(h)?h:e(u,h),M=m.eventCount;if(u.__r3f&&(u.__r3f.memoizedProps=x),B.forEach(([E,z,J,V])=>{var I;let w=u,S=w[E];if(V.length&&(S=V.reduce((W,H)=>W[H],u),!(S&&S.set))){const[W,...H]=V.reverse();w=H.reverse().reduce((k,_)=>k[_],u),E=W}if(z===NX+"remove")if(S&&S.constructor)z=new S.constructor(x.args);else if(w.constructor){const W=new w.constructor(w.__r3f.memoizedProps.args);z=W[S],W.dispose&&W.dispose()}else z=0;const R=(G==null||(I=G.gl)==null?void 0:I.outputEncoding)===Ao;if(J)z?m.handlers[E]=z:delete m.handlers[E],m.eventCount=Object.keys(m.handlers).length;else if(S&&S.set&&(S.copy||S instanceof jg)){if(Array.isArray(z))S.fromArray?S.fromArray(z):S.set(...z);else if(S.copy&&z&&z.constructor&&S.constructor.name===z.constructor.name)S.copy(z);else if(z!==void 0){const W=S instanceof lt;!W&&S.setScalar?S.setScalar(z):S instanceof jg&&z instanceof jg?S.mask=z.mask:S.set(z),!R&&W&&S.convertSRGBToLinear()}}else w[E]=z,!R&&w[E]instanceof hi&&(w[E].encoding=Mn);n(u)}),m.parent&&G.internal&&u.raycast&&M!==m.eventCount){const E=G.internal.interaction.indexOf(u);E>-1&&G.internal.interaction.splice(E,1),m.eventCount&&G.internal.interaction.push(u)}return B.length&&(y=u.__r3f)!=null&&y.parent&&r(u),u}function n(u){var h,p;const b=(h=u.__r3f)==null||(p=h.root)==null||p.getState==null?void 0:p.getState();b&&b.internal.frames===0&&b.invalidate()}function r(u){u.onUpdate==null||u.onUpdate(u)}function s(u,f,b,y,m){var G=f,{args:h=[]}=G,p=Gt(G,["args"]);let x=`${u[0].toUpperCase()}${u.slice(1)}`,B;if(!ev(b)&&m){const M=E=>E.return?M(E.return):E.stateNode&&E.stateNode.containerInfo;b=M(m)}if(!b||!ev(b))throw`No valid root for ${x}!`;if(u==="primitive"){if(p.object===void 0)throw"Primitives without 'object' are invalid!";const M=p.object;B=Yh(M,{root:b,primitive:!0})}else{const M=PZ[x]||ace[x];if(!M)throw`${x} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;if(!Array.isArray(h))throw"The args prop must be an array!";B=Yh(new M(...h),{root:b,memoizedProps:{args:h.length===0?null:h}})}return"attachFns"in p||(x.endsWith("Geometry")?p=Oe({attach:"geometry"},p):x.endsWith("Material")&&(p=Oe({attach:"material"},p))),t(B,p),B}function o(u,h){let p=!1;if(h){if(h.attachArray)Wn.arr(u[h.attachArray])||(u[h.attachArray]=[]),u[h.attachArray].push(h);else if(h.attachObject)Wn.obj(u[h.attachObject[0]])||(u[h.attachObject[0]]={}),u[h.attachObject[0]][h.attachObject[1]]=h;else if(h.attach&&!Wn.fun(h.attach))u[h.attach]=h;else if(Wn.arr(h.attachFns)){const[b]=h.attachFns;Wn.str(b)&&Wn.fun(u[b])?u[b](h):Wn.fun(b)&&b(h,u)}else h.isObject3D&&u.isObject3D&&(u.add(h),p=!0);p||u.__r3f.objects.push(h),h.__r3f||Yh(h,{}),h.__r3f.parent=u,r(h),n(h)}}function a(u,h,p){let b=!1;if(h){if(h.attachArray){const y=u[h.attachArray];Wn.arr(y)||(u[h.attachArray]=[]),y.splice(y.indexOf(p),0,h)}else{if(h.attachObject||h.attach&&!Wn.fun(h.attach))return o(u,h);if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"});const y=u.children.filter(f=>f!==h),m=y.indexOf(p);u.children=[...y.slice(0,m),h,...y.slice(m)],b=!0}}b||u.__r3f.objects.push(h),h.__r3f||Yh(h,{}),h.__r3f.parent=u,r(h),n(h)}}function l(u,h,p=!1){u&&[...u].forEach(b=>c(h,b,p))}function c(u,h,p){if(h){var b,y;if(h.__r3f&&(h.__r3f.parent=null),(b=u.__r3f)!=null&&b.objects&&(u.__r3f.objects=u.__r3f.objects.filter(B=>B!==h)),h.attachArray)u[h.attachArray]=u[h.attachArray].filter(B=>B!==h);else if(h.attachObject)delete u[h.attachObject[0]][h.attachObject[1]];else if(h.attach&&!Wn.fun(h.attach)&&u[h.attach]===h)u[h.attach]=null;else if(Wn.arr(h.attachFns)){const[,B]=h.attachFns;Wn.str(B)&&Wn.fun(u[B])?u[B](h):Wn.fun(B)&&B(h,u)}else if(h.isObject3D&&u.isObject3D){var m;u.remove(h),(m=h.__r3f)!=null&&m.root&&Ace(h.__r3f.root,h)}const G=(y=h.__r3f)==null?void 0:y.primitive,x=p===void 0?h.dispose!==null&&!G:p;if(!G){var f;l((f=h.__r3f)==null?void 0:f.objects,h,x),l(h.children,h,x)}h.__r3f&&(delete h.__r3f.root,delete h.__r3f.objects,delete h.__r3f.handlers,delete h.__r3f.memoizedProps,G||delete h.__r3f),x&&h.dispose&&h.type!=="Scene"&&Ku.exports.unstable_runWithPriority(Ku.exports.unstable_IdlePriority,()=>{try{h.dispose()}catch{}}),n(u)}}function g(u,h,p,b){var y;const m=(y=u.__r3f)==null?void 0:y.parent;if(!m)return;const f=s(h,p,u.__r3f.root);h!=="primitive"&&u.children&&(u.children.forEach(G=>o(f,G)),u.children=[]),u.__r3f.objects.forEach(G=>o(f,G)),u.__r3f.objects=[],c(m,u),o(m,f),f.raycast&&f.__r3f.eventCount&&f.__r3f.root.getState().internal.interaction.push(f),[b,b.alternate].forEach(G=>{G!==null&&(G.stateNode=f,G.ref&&(typeof G.ref=="function"?G.ref(f):G.ref.current=f))})}return{reconciler:uce({now:Ku.exports.unstable_now,createInstance:s,removeChild:c,appendChild:o,appendInitialChild:o,insertBefore:a,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:Wn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Wn.fun(clearTimeout)?clearTimeout:void 0,setTimeout:Wn.fun(setTimeout)?setTimeout:void 0,clearTimeout:Wn.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(u,h)=>{const{container:p,root:b}=KZ(u,h);p.__r3f.root=b,o(p,h)},removeChildFromContainer:(u,h)=>c(KZ(u,h).container,h),insertInContainerBefore:(u,h,p)=>a(KZ(u,h).container,h,p),prepareUpdate(u,h,p,b){if(u.__r3f.primitive&&b.object&&b.object!==u)return[!0];{const y=b,{args:f=[],children:G}=y,x=Gt(y,["args","children"]),m=p,{args:B=[],children:M}=m,E=Gt(m,["args","children"]);if(!Array.isArray(f))throw"The args prop must be an array!";if(f.some((J,V)=>J!==B[V]))return[!0];const z=e(u,x,E,!0);if(z.changes.length)return[!1,z];if(u.attach&&typeof u.attach!="function"){const V=u.__r3f.parent;V&&V[u.attach]!==u&&o(V,u)}return null}},commitUpdate(u,[h,p],b,y,m,f){h?g(u,b,m,f):t(u,p)},hideInstance(u){u.isObject3D&&(u.visible=!1,n(u))},unhideInstance(u,h){(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0,n(u))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance(u){return u},getRootHostContext(u){return vce},getChildHostContext(u){return u},createTextInstance(){},finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},commitMount(u){var h;const p=(h=u==null?void 0:u.__r3f)!=null?h:{};u.raycast&&p.handlers&&p.eventCount&&u.__r3f.root.getState().internal.interaction.push(u)},shouldDeprioritizeSubtree(){return!1},prepareForCommit(){return null},preparePortalMount(u){Yh(u)},resetAfterCommit(){},shouldSetTextContent(){return!1},clearContainer(){return!1}}),applyProps:t}}const Gce=i=>!!(i!=null&&i.render),EX=i=>i&&i.isOrthographicCamera;function DZ(i){return Array.isArray(i)?Math.min(Math.max(i[0],window.devicePixelRatio),i[1]):i}const HX=ue.exports.createContext(null),Bce=(i,e,t,n)=>{const{gl:r,size:s,shadows:o=!1,linear:a=!1,flat:l=!1,vr:c=!1,orthographic:g=!1,frameloop:d="always",dpr:u=1,performance:h,clock:p=new VZ,raycaster:b,camera:y,onPointerMissed:m}=n;o&&(r.shadowMap.enabled=!0,typeof o=="object"?Object.assign(r.shadowMap,o):r.shadowMap.type=_B),a&&(r.outputEncoding=Ao),l&&(r.toneMapping=ra),d==="never"&&(p.stop(),p.elapsedTime=0);const f=gce((M,E)=>{const z=new gX,T=b||{},{params:J}=T,V=Gt(T,["params"]);i(z,pt(Oe({enabled:!0},V),{params:Oe(Oe({},z.params),J)}));const I=y instanceof qg,w=I?y:g?new vh(0,0,0,0,.1,1e3):new Ri(75,0,.1,1e3);I||(w.position.z=5,y&&i(w,y),y!=null&&y.rotation||w.lookAt(0,0,0));const S=DZ(u),R=new te,W=new te,H=new te;function k(F=E().camera,K=W,j=E().size){const{width:O,height:Y}=j,ee=O/Y;K instanceof te?H.copy(K):H.set(...K);const ye=F.getWorldPosition(R).distanceTo(H);if(EX(F))return{width:O/F.zoom,height:Y/F.zoom,factor:1,distance:ye,aspect:ee};{const Ce=F.fov*Math.PI/180,he=2*Math.tan(Ce/2)*ye,Ne=he*(O/Y);return{width:Ne,height:he,factor:O/Ne,distance:ye,aspect:ee}}}let _;const Z=F=>M(K=>({performance:pt(Oe({},K.performance),{current:F})}));return{gl:r,set:M,get:E,invalidate:()=>e(E()),advance:(F,K)=>t(F,K,E()),linear:a,flat:l,scene:Yh(new ap),camera:w,controls:null,raycaster:z,clock:p,mouse:new Ke,vr:c,frameloop:d,onPointerMissed:m,performance:pt(Oe({current:1,min:.5,max:1,debounce:200},h),{regress:()=>{const F=E();_&&clearTimeout(_),F.performance.current!==F.performance.min&&Z(F.performance.min),_=setTimeout(()=>Z(E().performance.max),F.performance.debounce)}}),size:{width:0,height:0},viewport:{initialDpr:S,dpr:S,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:k},setSize:(F,K)=>{const j={width:F,height:K};M(O=>({size:j,viewport:Oe(Oe({},O.viewport),k(w,W,j))}))},setDpr:F=>M(K=>({viewport:pt(Oe({},K.viewport),{dpr:DZ(F)})})),setFrameloop:(F="always")=>M(()=>({frameloop:F})),events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:n,lastEvent:ue.exports.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(F,K=0)=>(M(({internal:j})=>({internal:pt(Oe({},j),{priority:j.priority+(K>0?1:0),subscribers:[...j.subscribers,{ref:F,priority:K}].sort((O,Y)=>O.priority-Y.priority)})})),()=>{M(({internal:j})=>({internal:pt(Oe({},j),{priority:j.priority-(K>0?1:0),subscribers:j.subscribers.filter(O=>O.ref!==F)})}))})}}}),G=f.getState();let x=G.size,B=G.viewport.dpr;return f.subscribe(()=>{const{camera:M,size:E,viewport:z,internal:J}=f.getState();(E!==x||z.dpr!==B)&&(!M.manual&&!(J.lastProps.camera instanceof qg)&&(EX(M)?(M.left=E.width/-2,M.right=E.width/2,M.top=E.height/2,M.bottom=E.height/-2):M.aspect=E.width/E.height,M.updateProjectionMatrix(),M.updateMatrixWorld()),r.setPixelRatio(z.dpr),r.setSize(E.width,E.height),x=E,B=z.dpr)}),s&&G.setSize(s.width,s.height),f.subscribe(M=>e(M)),f};let Vc,FX=[],LX=[],Sce=[];function Sp(i,e){for(Vc=0;Vc<i.length;Vc++)i[Vc](e)}function UZ(i,e){let t=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(t=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),Vc=0;Vc<e.internal.subscribers.length;Vc++)e.internal.subscribers[Vc].ref.current(e,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Zce(i){let e=!1,t;function n(o){if(e=!0,t=0,Sp(FX,o),i.forEach(a=>{const l=a.store.getState();l.internal.active&&(l.frameloop==="always"||l.internal.frames>0)&&(t+=UZ(o,l))}),Sp(LX,o),t>0)return requestAnimationFrame(n);Sp(Sce,o),e=!1}function r(o){if(!o)return i.forEach(a=>r(a.store.getState()));o.vr||!o.internal.active||o.frameloop==="never"||(o.internal.frames=Math.min(60,o.internal.frames+1),e||(e=!0,requestAnimationFrame(n)))}function s(o,a=!0,l){a&&Sp(FX,o),l?UZ(o,l):i.forEach(c=>UZ(o,c.store.getState())),a&&Sp(LX,o)}return{loop:n,invalidate:r,advance:s}}function Rce(i){const{handlePointer:e}=bce(i),t={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(t).reduce((n,r)=>pt(Oe({},n),{[r]:e(r)}),{}),connect:n=>{var r;const{set:s,events:o}=i.getState();o.disconnect==null||o.disconnect(),s(a=>({events:pt(Oe({},a.events),{connected:n})})),Object.entries((r=o==null?void 0:o.handlers)!=null?r:[]).forEach(([a,l])=>{const[c,g]=t[a];n.addEventListener(c,l,{passive:g})})},disconnect:()=>{const{set:n,events:r}=i.getState();if(r.connected){var s;Object.entries((s=r.handlers)!=null?s:[]).forEach(([o,a])=>{if(r&&r.connected instanceof HTMLElement){const[l]=t[o];r.connected.removeEventListener(l,a)}}),n(o=>({events:pt(Oe({},o.events),{connected:!1})}))}}}}const OZ=typeof window!="undefined"?ue.exports.useLayoutEffect:ue.exports.useEffect;function Mce({set:i}){return OZ(()=>(i(new Promise(()=>null)),()=>i(!1)),[]),null}class TX extends ue.exports.Component{constructor(...e){super(...e);this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}TX.getDerivedStateFromError=()=>({error:!0});const N0e=ue.exports.forwardRef(function(d,g){var u=d,{children:e,fallback:t,tabIndex:n,resize:r,id:s,style:o,className:a,events:l}=u,c=Gt(u,["children","fallback","tabIndex","resize","id","style","className","events"]);const[h,{width:p,height:b}]=fce(Oe({scroll:!0,debounce:{scroll:50,resize:0}},r)),y=ue.exports.useRef(null),[m,f]=ue.exports.useState(!1),[G,x]=ue.exports.useState(!1);if(m)throw m;if(G)throw G;return OZ(()=>{p>0&&b>0&&Hce(ue.exports.createElement(TX,{set:x},ue.exports.createElement(ue.exports.Suspense,{fallback:ue.exports.createElement(Mce,{set:f})},e)),y.current,pt(Oe({},c),{size:{width:p,height:b},events:l||Rce}))},[p,b,e]),OZ(()=>{const B=y.current;return()=>DX(B)},[]),ue.exports.createElement("div",{ref:h,id:s,className:a,tabIndex:n,style:Oe({position:"relative",width:"100%",height:"100%",overflow:"hidden"},o)},ue.exports.createElement("canvas",{ref:hce([y,g]),style:{display:"block"}},t))});function XX(){const i=ue.exports.useContext(HX);if(!i)throw"R3F hooks can only be used within the Canvas component!";return i}function Wce(i=t=>t,e){return XX()(i,e)}function _ce(i,e=0){const t=XX().getState().internal.subscribe,n=ue.exports.useRef(i);return ue.exports.useLayoutEffect(()=>void(n.current=i),[i]),ue.exports.useLayoutEffect(()=>t(n,e),[e,t]),null}function Vce(i){const e={nodes:{},materials:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function zX(i,e){return function(t,...n){const r=new t;return i&&i(r),Promise.all(n.map(s=>new Promise((o,a)=>r.load(s,l=>{l.scene&&Object.assign(l,Vce(l.scene)),o(l)},e,l=>a(`Could not load ${s}: ${l.message}`)))))}}function kX(i,e,t,n){const r=Array.isArray(e)?e:[e],s=ol(zX(t,n),i,...r);return Array.isArray(e)?s:s[0]}kX.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return ol.preload(zX(t),i,...n)};kX.clear=function(i,e){const t=Array.isArray(e)?e:[e];return ol.clear(i,...t)};const Zp=new Map,YX=["legacy","blocking","concurrent"],{invalidate:Nce,advance:KX}=Zce(Zp),{reconciler:Rp,applyProps:PX}=wce(),Ece=(i,e)=>{const t=typeof i=="function"?i(e):i;if(Gce(t))return t;const n=new An(Oe({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0},i));return n.outputEncoding=Mn,n.toneMapping=zB,i&&PX(n,i),n};function Hce(i,e,l={}){var c=l,{gl:t,size:n,mode:r=YX[1],events:s,onCreated:o}=c,a=Gt(c,["gl","size","mode","events","onCreated"]);var g;if(!n){var d,u,h,p;n={width:(d=(u=e.parentElement)==null?void 0:u.clientWidth)!=null?d:0,height:(h=(p=e.parentElement)==null?void 0:p.clientHeight)!=null?h:0}}let b=Zp.get(e),y=b==null?void 0:b.fiber,m=b==null?void 0:b.store,f=(g=m)==null?void 0:g.getState();if(y&&f&&(a.dpr!==void 0&&!Wn.equ(f.viewport.dpr,DZ(a.dpr))&&f.setDpr(a.dpr),(f.size.width!==n.width||f.size.height!==n.height)&&f.setSize(n.width,n.height),f.frameloop!==a.frameloop&&f.setFrameloop(a.frameloop),a.linear!==f.internal.lastProps.linear&&(DX(e),y=void 0)),!y){const G=Ece(t,e);a.vr&&(G.xr.enabled=!0,G.setAnimationLoop(B=>KX(B,!0))),m=Bce(PX,Nce,KX,Oe({gl:G,size:n},a));const x=m.getState();y=Rp.createContainer(m,YX.indexOf(r),!1,null),Zp.set(e,{fiber:y,store:m}),s&&x.set({events:s(m)})}if(m&&y)return Rp.updateContainer(ue.exports.createElement(Fce,{store:m,element:i,onCreated:o,target:e}),y,null,()=>{}),m;throw"Error creating root!"}function Fce({store:i,element:e,onCreated:t,target:n}){return ue.exports.useEffect(()=>{const r=i.getState();r.set(s=>({internal:pt(Oe({},s.internal),{active:!0})})),r.events.connect==null||r.events.connect(n),t&&t(r)},[]),ue.exports.createElement(HX.Provider,{value:i},e)}function DX(i,e){const t=Zp.get(i),n=t==null?void 0:t.fiber;if(n){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),Rp.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{var s,o,a;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),Lce(r),Zp.delete(i),e&&e(i)},500)})}}function Lce(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const n in i){var e,t;(e=(t=n).dispose)==null||e.call(t),delete i[n]}}Rp.act;Rp.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"});/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const JZ="137",Tce=0,UX=1,Xce=2,OX=1,zce=2,Mp=3,Wp=0,Mi=1,Kh=2,JX=1,Nc=0,_p=1,QX=2,jX=3,qX=4,kce=5,Ph=100,Yce=101,Kce=102,$X=103,ez=104,Pce=200,Dce=201,Uce=202,Oce=203,tz=204,nz=205,Jce=206,Qce=207,jce=208,qce=209,$ce=210,ege=0,tge=1,nge=2,QZ=3,ige=4,rge=5,sge=6,oge=7,tv=0,age=1,lge=2,Ec=0,cge=1,gge=2,uge=3,dge=4,hge=5,iz=300,Vp=301,Np=302,jZ=303,qZ=304,nv=306,$Z=307,e3=1e3,Gs=1001,t3=1002,Wi=1003,rz=1004,sz=1005,vr=1006,fge=1007,iv=1008,Hc=1009,Ige=1010,Cge=1011,Ep=1012,pge=1013,rv=1014,mu=1015,Dh=1016,mge=1017,Age=1018,Uh=1020,bge=1021,yge=1022,Tr=1023,vge=1024,xge=1025,Au=1026,Oh=1027,wge=1028,Gge=1029,Bge=1030,Sge=1031,Zge=1033,n3=33776,i3=33777,r3=33778,s3=33779,oz=35840,az=35841,lz=35842,cz=35843,Rge=36196,gz=37492,uz=37496,dz=37808,hz=37809,fz=37810,Iz=37811,Cz=37812,pz=37813,mz=37814,Az=37815,bz=37816,yz=37817,vz=37818,xz=37819,wz=37820,Gz=37821,Bz=36492,Mge=2200,Wge=2201,_ge=2202,sv=2300,ov=2301,o3=2302,Jh=2400,Qh=2401,av=2402,a3=2500,Sz=2501,Vge=0,Fc=3e3,On=3001,Nge=3200,Ege=3201,jh=0,Hge=1,l3=7680,Fge=519,Hp=35044,Fp=35048,Zz="300 es",c3=1035;class bu{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const nr=[];for(let i=0;i<256;i++)nr[i]=(i<16?"0":"")+i.toString(16);const g3=Math.PI/180,u3=180/Math.PI;function ua(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(nr[i&255]+nr[i>>8&255]+nr[i>>16&255]+nr[i>>24&255]+"-"+nr[e&255]+nr[e>>8&255]+"-"+nr[e>>16&15|64]+nr[e>>24&255]+"-"+nr[t&63|128]+nr[t>>8&255]+"-"+nr[t>>16&255]+nr[t>>24&255]+nr[n&255]+nr[n>>8&255]+nr[n>>16&255]+nr[n>>24&255]).toUpperCase()}function Bs(i,e,t){return Math.max(e,Math.min(t,i))}function Lge(i,e){return(i%e+e)%e}function d3(i,e,t){return(1-t)*i+t*e}function Rz(i){return(i&i-1)==0&&i!==0}function Tge(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}class je{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}je.prototype.isVector2=!0;class ir{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,s,o,a,l,c){const g=this.elements;return g[0]=e,g[1]=r,g[2]=a,g[3]=t,g[4]=s,g[5]=l,g[6]=n,g[7]=o,g[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],g=n[4],d=n[7],u=n[2],h=n[5],p=n[8],b=r[0],y=r[3],m=r[6],f=r[1],G=r[4],x=r[7],B=r[2],M=r[5],E=r[8];return s[0]=o*b+a*f+l*B,s[3]=o*y+a*G+l*M,s[6]=o*m+a*x+l*E,s[1]=c*b+g*f+d*B,s[4]=c*y+g*G+d*M,s[7]=c*m+g*x+d*E,s[2]=u*b+h*f+p*B,s[5]=u*y+h*G+p*M,s[8]=u*m+h*x+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8];return t*o*g-t*a*c-n*s*g+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],d=g*o-a*c,u=a*l-g*s,h=c*s-o*l,p=t*d+n*u+r*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/p;return e[0]=d*b,e[1]=(r*c-g*n)*b,e[2]=(a*n-r*o)*b,e[3]=u*b,e[4]=(g*t-r*l)*b,e[5]=(r*s-a*t)*b,e[6]=h*b,e[7]=(n*l-c*t)*b,e[8]=(o*t-n*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,s=r[0],o=r[3],a=r[6],l=r[1],c=r[4],g=r[7];return r[0]=t*s+n*l,r[3]=t*o+n*c,r[6]=t*a+n*g,r[1]=-n*s+t*l,r[4]=-n*o+t*c,r[7]=-n*a+t*g,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}ir.prototype.isMatrix3=!0;function Mz(i){for(let e=i.length-1;e>=0;--e)if(i[e]>65535)return!0;return!1}function Lp(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}const Wz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bo={h:0,s:0,l:0},lv={h:0,s:0,l:0};function h3(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function qh(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function f3(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class Bt{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Lge(e,1),t=Bs(t,0,1),n=Bs(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,s=2*n-r;this.r=h3(s,r,e+1/3),this.g=h3(s,r,e),this.b=h3(s,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const s=n[1],o=n[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const a=parseFloat(r[1])/360,l=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Wz[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qh(e.r),this.g=qh(e.g),this.b=qh(e.b),this}copyLinearToSRGB(e){return this.r=f3(e.r),this.g=f3(e.g),this.b=f3(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,s=Math.max(t,n,r),o=Math.min(t,n,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const g=s-o;switch(l=c<=.5?g/(s+o):g/(2-s-o),s){case t:a=(n-r)/g+(n<r?6:0);break;case n:a=(r-t)/g+2;break;case r:a=(t-n)/g+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(Bo),Bo.h+=e,Bo.s+=t,Bo.l+=n,this.setHSL(Bo.h,Bo.s,Bo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Bo),e.getHSL(lv);const n=d3(Bo.h,lv.h,t),r=d3(Bo.s,lv.s,t),s=d3(Bo.l,lv.l,t);return this.setHSL(n,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Bt.NAMES=Wz;Bt.prototype.isColor=!0;Bt.prototype.r=1;Bt.prototype.g=1;Bt.prototype.b=1;let $h;class yu{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{$h===void 0&&($h=Lp("canvas")),$h.width=e.width,$h.height=e.height;const n=$h.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=$h}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=Lp("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=qh(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(qh(t[n]/255)*255):t[n]=qh(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Xge=0;class Xi extends bu{constructor(e=Xi.DEFAULT_IMAGE,t=Xi.DEFAULT_MAPPING,n=Gs,r=Gs,s=vr,o=iv,a=Tr,l=Hc,c=1,g=Fc){super();Object.defineProperty(this,"id",{value:Xge++}),this.uuid=ua(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ir,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const r=this.image;if(r.uuid===void 0&&(r.uuid=ua()),!t&&e.images[r.uuid]===void 0){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(I3(r[o].image)):s.push(I3(r[o]))}else s=I3(r);e.images[r.uuid]={uuid:r.uuid,url:s}}n.image=r.uuid}return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==iz)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case e3:e.x=e.x-Math.floor(e.x);break;case Gs:e.x=e.x<0?0:1;break;case t3:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case e3:e.y=e.y-Math.floor(e.y);break;case Gs:e.y=e.y<0?0:1;break;case t3:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}Xi.DEFAULT_IMAGE=void 0;Xi.DEFAULT_MAPPING=iz;Xi.prototype.isTexture=!0;function I3(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?yu.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class _n{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const o=.01,a=.1,l=e.elements,c=l[0],g=l[4],d=l[8],u=l[1],h=l[5],p=l[9],b=l[2],y=l[6],m=l[10];if(Math.abs(g-u)<o&&Math.abs(d-b)<o&&Math.abs(p-y)<o){if(Math.abs(g+u)<a&&Math.abs(d+b)<a&&Math.abs(p+y)<a&&Math.abs(c+h+m-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const G=(c+1)/2,x=(h+1)/2,B=(m+1)/2,M=(g+u)/4,E=(d+b)/4,z=(p+y)/4;return G>x&&G>B?G<o?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(G),r=M/n,s=E/n):x>B?x<o?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),n=M/r,s=z/r):B<o?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(B),n=E/s,r=z/s),this.set(n,r,s,t),this}let f=Math.sqrt((y-p)*(y-p)+(d-b)*(d-b)+(u-g)*(u-g));return Math.abs(f)<.001&&(f=1),this.x=(y-p)/f,this.y=(d-b)/f,this.z=(u-g)/f,this.w=Math.acos((c+h+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}_n.prototype.isVector4=!0;class qs extends bu{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new _n(0,0,e,t),this.scissorTest=!1,this.viewport=new _n(0,0,e,t),this.texture=new Xi(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:vr,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}qs.prototype.isWebGLRenderTarget=!0;class zge extends qs{constructor(e,t,n){super(e,t);const r=this.texture;this.texture=[];for(let s=0;s<n;s++)this.texture[s]=r.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}zge.prototype.isWebGLMultipleRenderTargets=!0;class C3 extends qs{constructor(e,t,n={}){super(e,t,n);this.samples=4,this.ignoreDepthForMultisampleCopy=n.ignoreDepth!==void 0?n.ignoreDepth:!0,this.useRenderToTexture=n.useRenderToTexture!==void 0?n.useRenderToTexture:!1,this.useRenderbuffer=this.useRenderToTexture===!1}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}C3.prototype.isWebGLMultisampleRenderTarget=!0;class rr{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],g=n[r+2],d=n[r+3];const u=s[o+0],h=s[o+1],p=s[o+2],b=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=g,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=h,e[t+2]=p,e[t+3]=b;return}if(d!==b||l!==u||c!==h||g!==p){let y=1-a;const m=l*u+c*h+g*p+d*b,f=m>=0?1:-1,G=1-m*m;if(G>Number.EPSILON){const B=Math.sqrt(G),M=Math.atan2(B,m*f);y=Math.sin(y*M)/B,a=Math.sin(a*M)/B}const x=a*f;if(l=l*y+u*x,c=c*y+h*x,g=g*y+p*x,d=d*y+b*x,y===1-a){const B=1/Math.sqrt(l*l+c*c+g*g+d*d);l*=B,c*=B,g*=B,d*=B}}e[t]=l,e[t+1]=c,e[t+2]=g,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],g=n[r+3],d=s[o],u=s[o+1],h=s[o+2],p=s[o+3];return e[t]=a*p+g*d+l*h-c*u,e[t+1]=l*p+g*u+c*d-a*h,e[t+2]=c*p+g*h+a*u-l*d,e[t+3]=g*p-a*d-l*u-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),g=a(r/2),d=a(s/2),u=l(n/2),h=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=u*g*d+c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d-u*h*p;break;case"YXZ":this._x=u*g*d+c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d+u*h*p;break;case"ZXY":this._x=u*g*d-c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d-u*h*p;break;case"ZYX":this._x=u*g*d-c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d+u*h*p;break;case"YZX":this._x=u*g*d+c*h*p,this._y=c*h*d+u*g*p,this._z=c*g*p-u*h*d,this._w=c*g*d-u*h*p;break;case"XZY":this._x=u*g*d-c*h*p,this._y=c*h*d-u*g*p,this._z=c*g*p+u*h*d,this._w=c*g*d+u*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],g=t[6],d=t[10],u=n+a+d;if(u>0){const h=.5/Math.sqrt(u+1);this._w=.25/h,this._x=(g-l)*h,this._y=(s-c)*h,this._z=(o-r)*h}else if(n>a&&n>d){const h=2*Math.sqrt(1+n-a-d);this._w=(g-l)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+c)/h}else if(a>d){const h=2*Math.sqrt(1+a-n-d);this._w=(s-c)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(l+g)/h}else{const h=2*Math.sqrt(1+d-n-a);this._w=(o-r)/h,this._x=(s+c)/h,this._y=(l+g)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,g=t._w;return this._x=n*g+o*a+r*c-s*l,this._y=r*g+o*l+s*a-n*c,this._z=s*g+o*c+n*l-r*a,this._w=o*g-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*o+t*this._w,this._x=h*n+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),g=Math.atan2(c,a),d=Math.sin((1-t)*g)/c,u=Math.sin(t*g)/c;return this._w=o*d+this._w*u,this._x=n*d+this._x*u,this._y=r*d+this._y*u,this._z=s*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}rr.prototype.isQuaternion=!0;class fe{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_z.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_z.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*n,g=l*n+a*t-s*r,d=l*r+s*n-o*t,u=-s*t-o*n-a*r;return this.x=c*l+u*-s+g*-a-d*-o,this.y=g*l+u*-o+d*-s-c*-a,this.z=d*l+u*-a+c*-o-g*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return p3.copy(this).projectOnVector(e),this.sub(p3)}reflect(e){return this.sub(p3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Bs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}fe.prototype.isVector3=!0;const p3=new fe,_z=new rr;class So{constructor(e=new fe(1/0,1/0,1/0),t=new fe(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const g=e[l],d=e[l+1],u=e[l+2];g<t&&(t=g),d<n&&(n=d),u<r&&(r=u),g>s&&(s=g),d>o&&(o=d),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const g=e.getX(l),d=e.getY(l),u=e.getZ(l);g<t&&(t=g),d<n&&(n=d),u<r&&(r=u),g>s&&(s=g),d>o&&(o=d),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=vu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const s=n.attributes.position;for(let o=0,a=s.count;o<a;o++)vu.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(vu)}else n.boundingBox===null&&n.computeBoundingBox(),m3.copy(n.boundingBox),m3.applyMatrix4(e.matrixWorld),this.union(m3);const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,vu),vu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Tp),cv.subVectors(this.max,Tp),ef.subVectors(e.a,Tp),tf.subVectors(e.b,Tp),nf.subVectors(e.c,Tp),Lc.subVectors(tf,ef),Tc.subVectors(nf,tf),xu.subVectors(ef,nf);let t=[0,-Lc.z,Lc.y,0,-Tc.z,Tc.y,0,-xu.z,xu.y,Lc.z,0,-Lc.x,Tc.z,0,-Tc.x,xu.z,0,-xu.x,-Lc.y,Lc.x,0,-Tc.y,Tc.x,0,-xu.y,xu.x,0];return!A3(t,ef,tf,nf,cv)||(t=[1,0,0,0,1,0,0,0,1],!A3(t,ef,tf,nf,cv))?!1:(gv.crossVectors(Lc,Tc),t=[gv.x,gv.y,gv.z],A3(t,ef,tf,nf,cv))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return vu.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(vu).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(al[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),al[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),al[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),al[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),al[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),al[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),al[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),al[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(al),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}So.prototype.isBox3=!0;const al=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe],vu=new fe,m3=new So,ef=new fe,tf=new fe,nf=new fe,Lc=new fe,Tc=new fe,xu=new fe,Tp=new fe,cv=new fe,gv=new fe,wu=new fe;function A3(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){wu.fromArray(i,s);const a=r.x*Math.abs(wu.x)+r.y*Math.abs(wu.y)+r.z*Math.abs(wu.z),l=e.dot(wu),c=t.dot(wu),g=n.dot(wu);if(Math.max(-Math.max(l,c,g),Math.min(l,c,g))>a)return!1}return!0}const kge=new So,Vz=new fe,uv=new fe,b3=new fe;class rf{constructor(e=new fe,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):kge.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){b3.subVectors(e,this.center);const t=b3.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.add(b3.multiplyScalar(r/n)),this.radius+=r}return this}union(e){return this.center.equals(e.center)===!0?uv.set(0,0,1).multiplyScalar(e.radius):uv.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Vz.copy(e.center).add(uv)),this.expandByPoint(Vz.copy(e.center).sub(uv)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ll=new fe,y3=new fe,dv=new fe,Xc=new fe,v3=new fe,hv=new fe,x3=new fe;class sf{constructor(e=new fe,t=new fe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ll)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ll.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ll.copy(this.direction).multiplyScalar(t).add(this.origin),ll.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){y3.copy(e).add(t).multiplyScalar(.5),dv.copy(t).sub(e).normalize(),Xc.copy(this.origin).sub(y3);const s=e.distanceTo(t)*.5,o=-this.direction.dot(dv),a=Xc.dot(this.direction),l=-Xc.dot(dv),c=Xc.lengthSq(),g=Math.abs(1-o*o);let d,u,h,p;if(g>0)if(d=o*l-a,u=o*a-l,p=s*g,d>=0)if(u>=-p)if(u<=p){const b=1/g;d*=b,u*=b,h=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;else u=-s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;else u<=-p?(d=Math.max(0,-(-o*s+a)),u=d>0?-s:Math.min(Math.max(-s,-l),s),h=-d*d+u*(u+2*l)+c):u<=p?(d=0,u=Math.min(Math.max(-s,-l),s),h=u*(u+2*l)+c):(d=Math.max(0,-(o*s+a)),u=d>0?s:Math.min(Math.max(-s,-l),s),h=-d*d+u*(u+2*l)+c);else u=o>0?-s:s,d=Math.max(0,-(o*u+a)),h=-d*d+u*(u+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(dv).multiplyScalar(u).add(y3),h}intersectSphere(e,t){ll.subVectors(e.center,this.origin);const n=ll.dot(this.direction),r=ll.dot(ll)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,g=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(n=(e.min.x-u.x)*c,r=(e.max.x-u.x)*c):(n=(e.max.x-u.x)*c,r=(e.min.x-u.x)*c),g>=0?(s=(e.min.y-u.y)*g,o=(e.max.y-u.y)*g):(s=(e.max.y-u.y)*g,o=(e.min.y-u.y)*g),n>o||s>r||((s>n||n!==n)&&(n=s),(o<r||r!==r)&&(r=o),d>=0?(a=(e.min.z-u.z)*d,l=(e.max.z-u.z)*d):(a=(e.max.z-u.z)*d,l=(e.min.z-u.z)*d),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,ll)!==null}intersectTriangle(e,t,n,r,s){v3.subVectors(t,e),hv.subVectors(n,e),x3.crossVectors(v3,hv);let o=this.direction.dot(x3),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Xc.subVectors(this.origin,e);const l=a*this.direction.dot(hv.crossVectors(Xc,hv));if(l<0)return null;const c=a*this.direction.dot(v3.cross(Xc));if(c<0||l+c>o)return null;const g=-a*Xc.dot(x3);return g<0?null:this.at(g/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Vt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,s,o,a,l,c,g,d,u,h,p,b,y){const m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=g,m[10]=d,m[14]=u,m[3]=h,m[7]=p,m[11]=b,m[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Vt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/of.setFromMatrixColumn(e,0).length(),s=1/of.setFromMatrixColumn(e,1).length(),o=1/of.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),g=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const u=o*g,h=o*d,p=a*g,b=a*d;t[0]=l*g,t[4]=-l*d,t[8]=c,t[1]=h+p*c,t[5]=u-b*c,t[9]=-a*l,t[2]=b-u*c,t[6]=p+h*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*g,h=l*d,p=c*g,b=c*d;t[0]=u+b*a,t[4]=p*a-h,t[8]=o*c,t[1]=o*d,t[5]=o*g,t[9]=-a,t[2]=h*a-p,t[6]=b+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*g,h=l*d,p=c*g,b=c*d;t[0]=u-b*a,t[4]=-o*d,t[8]=p+h*a,t[1]=h+p*a,t[5]=o*g,t[9]=b-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*g,h=o*d,p=a*g,b=a*d;t[0]=l*g,t[4]=p*c-h,t[8]=u*c+b,t[1]=l*d,t[5]=b*c+u,t[9]=h*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,h=o*c,p=a*l,b=a*c;t[0]=l*g,t[4]=b-u*d,t[8]=p*d+h,t[1]=d,t[5]=o*g,t[9]=-a*g,t[2]=-c*g,t[6]=h*d+p,t[10]=u-b*d}else if(e.order==="XZY"){const u=o*l,h=o*c,p=a*l,b=a*c;t[0]=l*g,t[4]=-d,t[8]=c*g,t[1]=u*d+b,t[5]=o*g,t[9]=h*d-p,t[2]=p*d-h,t[6]=a*g,t[10]=b*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Yge,e,Kge)}lookAt(e,t,n){const r=this.elements;return Ss.subVectors(e,t),Ss.lengthSq()===0&&(Ss.z=1),Ss.normalize(),zc.crossVectors(n,Ss),zc.lengthSq()===0&&(Math.abs(n.z)===1?Ss.x+=1e-4:Ss.z+=1e-4,Ss.normalize(),zc.crossVectors(n,Ss)),zc.normalize(),fv.crossVectors(Ss,zc),r[0]=zc.x,r[4]=fv.x,r[8]=Ss.x,r[1]=zc.y,r[5]=fv.y,r[9]=Ss.y,r[2]=zc.z,r[6]=fv.z,r[10]=Ss.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],g=n[1],d=n[5],u=n[9],h=n[13],p=n[2],b=n[6],y=n[10],m=n[14],f=n[3],G=n[7],x=n[11],B=n[15],M=r[0],E=r[4],z=r[8],J=r[12],V=r[1],I=r[5],w=r[9],S=r[13],R=r[2],W=r[6],H=r[10],k=r[14],_=r[3],Z=r[7],T=r[11],F=r[15];return s[0]=o*M+a*V+l*R+c*_,s[4]=o*E+a*I+l*W+c*Z,s[8]=o*z+a*w+l*H+c*T,s[12]=o*J+a*S+l*k+c*F,s[1]=g*M+d*V+u*R+h*_,s[5]=g*E+d*I+u*W+h*Z,s[9]=g*z+d*w+u*H+h*T,s[13]=g*J+d*S+u*k+h*F,s[2]=p*M+b*V+y*R+m*_,s[6]=p*E+b*I+y*W+m*Z,s[10]=p*z+b*w+y*H+m*T,s[14]=p*J+b*S+y*k+m*F,s[3]=f*M+G*V+x*R+B*_,s[7]=f*E+G*I+x*W+B*Z,s[11]=f*z+G*w+x*H+B*T,s[15]=f*J+G*S+x*k+B*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],g=e[2],d=e[6],u=e[10],h=e[14],p=e[3],b=e[7],y=e[11],m=e[15];return p*(+s*l*d-r*c*d-s*a*u+n*c*u+r*a*h-n*l*h)+b*(+t*l*h-t*c*u+s*o*u-r*o*h+r*c*g-s*l*g)+y*(+t*c*d-t*a*h-s*o*d+n*o*h+s*a*g-n*c*g)+m*(-r*a*g-t*l*d+t*a*u+r*o*d-n*o*u+n*l*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],g=e[8],d=e[9],u=e[10],h=e[11],p=e[12],b=e[13],y=e[14],m=e[15],f=d*y*c-b*u*c+b*l*h-a*y*h-d*l*m+a*u*m,G=p*u*c-g*y*c-p*l*h+o*y*h+g*l*m-o*u*m,x=g*b*c-p*d*c+p*a*h-o*b*h-g*a*m+o*d*m,B=p*d*l-g*b*l-p*a*u+o*b*u+g*a*y-o*d*y,M=t*f+n*G+r*x+s*B;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/M;return e[0]=f*E,e[1]=(b*u*s-d*y*s-b*r*h+n*y*h+d*r*m-n*u*m)*E,e[2]=(a*y*s-b*l*s+b*r*c-n*y*c-a*r*m+n*l*m)*E,e[3]=(d*l*s-a*u*s-d*r*c+n*u*c+a*r*h-n*l*h)*E,e[4]=G*E,e[5]=(g*y*s-p*u*s+p*r*h-t*y*h-g*r*m+t*u*m)*E,e[6]=(p*l*s-o*y*s-p*r*c+t*y*c+o*r*m-t*l*m)*E,e[7]=(o*u*s-g*l*s+g*r*c-t*u*c-o*r*h+t*l*h)*E,e[8]=x*E,e[9]=(p*d*s-g*b*s-p*n*h+t*b*h+g*n*m-t*d*m)*E,e[10]=(o*b*s-p*a*s+p*n*c-t*b*c-o*n*m+t*a*m)*E,e[11]=(g*a*s-o*d*s-g*n*c+t*d*c+o*n*h-t*a*h)*E,e[12]=B*E,e[13]=(g*b*r-p*d*r+p*n*u-t*b*u-g*n*y+t*d*y)*E,e[14]=(p*a*r-o*b*r-p*n*l+t*b*l+o*n*y-t*a*y)*E,e[15]=(o*d*r-g*a*r+g*n*l-t*d*l-o*n*u+t*a*u)*E,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,g=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,g*a+n,g*l-r*o,0,c*l-r*a,g*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,g=o+o,d=a+a,u=s*c,h=s*g,p=s*d,b=o*g,y=o*d,m=a*d,f=l*c,G=l*g,x=l*d,B=n.x,M=n.y,E=n.z;return r[0]=(1-(b+m))*B,r[1]=(h+x)*B,r[2]=(p-G)*B,r[3]=0,r[4]=(h-x)*M,r[5]=(1-(u+m))*M,r[6]=(y+f)*M,r[7]=0,r[8]=(p+G)*E,r[9]=(y-f)*E,r[10]=(1-(u+b))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=of.set(r[0],r[1],r[2]).length();const o=of.set(r[4],r[5],r[6]).length(),a=of.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Zo.copy(this);const c=1/s,g=1/o,d=1/a;return Zo.elements[0]*=c,Zo.elements[1]*=c,Zo.elements[2]*=c,Zo.elements[4]*=g,Zo.elements[5]*=g,Zo.elements[6]*=g,Zo.elements[8]*=d,Zo.elements[9]*=d,Zo.elements[10]*=d,t.setFromRotationMatrix(Zo),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,l=2*s/(t-e),c=2*s/(n-r),g=(t+e)/(t-e),d=(n+r)/(n-r),u=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=l,a[4]=0,a[8]=g,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,s,o){const a=this.elements,l=1/(t-e),c=1/(n-r),g=1/(o-s),d=(t+e)*l,u=(n+r)*c,h=(o+s)*g;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*g,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Vt.prototype.isMatrix4=!0;const of=new fe,Zo=new Vt,Yge=new fe(0,0,0),Kge=new fe(1,1,1),zc=new fe,fv=new fe,Ss=new fe,Nz=new Vt,Ez=new rr;class Gu{constructor(e=0,t=0,n=0,r=Gu.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],g=r[9],d=r[2],u=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(Bs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-g,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Bs(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Bs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Bs(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Bs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-g,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Bs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-g,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Nz.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Nz,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ez.setFromEuler(this),this.setFromQuaternion(Ez,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new fe(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Gu.prototype.isEuler=!0;Gu.DefaultOrder="XYZ";Gu.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Hz{constructor(){this.mask=1|0}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let Pge=0;const Fz=new fe,af=new rr,cl=new Vt,Iv=new fe,Xp=new fe,Dge=new fe,Uge=new rr,Lz=new fe(1,0,0),Tz=new fe(0,1,0),Xz=new fe(0,0,1),Oge={type:"added"},zz={type:"removed"};class fn extends bu{constructor(){super();Object.defineProperty(this,"id",{value:Pge++}),this.uuid=ua(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=fn.DefaultUp.clone();const e=new fe,t=new Gu,n=new rr,r=new fe(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Vt},normalMatrix:{value:new ir}}),this.matrix=new Vt,this.matrixWorld=new Vt,this.matrixAutoUpdate=fn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Hz,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return af.setFromAxisAngle(e,t),this.quaternion.multiply(af),this}rotateOnWorldAxis(e,t){return af.setFromAxisAngle(e,t),this.quaternion.premultiply(af),this}rotateX(e){return this.rotateOnAxis(Lz,e)}rotateY(e){return this.rotateOnAxis(Tz,e)}rotateZ(e){return this.rotateOnAxis(Xz,e)}translateOnAxis(e,t){return Fz.copy(e).applyQuaternion(this.quaternion),this.position.add(Fz.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Lz,e)}translateY(e){return this.translateOnAxis(Tz,e)}translateZ(e){return this.translateOnAxis(Xz,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(cl.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Iv.copy(e):Iv.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Xp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cl.lookAt(Xp,Iv,this.up):cl.lookAt(Iv,Xp,this.up),this.quaternion.setFromRotationMatrix(cl),r&&(cl.extractRotation(r.matrixWorld),af.setFromRotationMatrix(cl),this.quaternion.premultiply(af.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Oge)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zz)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(zz)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),cl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),cl.multiply(e.parent.matrixWorld)),e.applyMatrix4(cl),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Xp,e,Dge),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Xp,Uge,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,g=l.length;c<g;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),g=o(e.images),d=o(e.shapes),u=o(e.skeletons),h=o(e.animations);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),g.length>0&&(n.images=g),d.length>0&&(n.shapes=d),u.length>0&&(n.skeletons=u),h.length>0&&(n.animations=h)}return n.object=r,n;function o(a){const l=[];for(const c in a){const g=a[c];delete g.metadata,l.push(g)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}fn.DefaultUp=new fe(0,1,0);fn.DefaultMatrixAutoUpdate=!0;fn.prototype.isObject3D=!0;const Ro=new fe,gl=new fe,w3=new fe,ul=new fe,lf=new fe,cf=new fe,kz=new fe,G3=new fe,B3=new fe,S3=new fe;class vi{constructor(e=new fe,t=new fe,n=new fe){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ro.subVectors(e,t),r.cross(Ro);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){Ro.subVectors(r,t),gl.subVectors(n,t),w3.subVectors(e,t);const o=Ro.dot(Ro),a=Ro.dot(gl),l=Ro.dot(w3),c=gl.dot(gl),g=gl.dot(w3),d=o*c-a*a;if(d===0)return s.set(-2,-1,-1);const u=1/d,h=(c*l-a*g)*u,p=(o*g-a*l)*u;return s.set(1-h-p,p,h)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,ul),ul.x>=0&&ul.y>=0&&ul.x+ul.y<=1}static getUV(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,ul),l.set(0,0),l.addScaledVector(s,ul.x),l.addScaledVector(o,ul.y),l.addScaledVector(a,ul.z),l}static isFrontFacing(e,t,n,r){return Ro.subVectors(n,t),gl.subVectors(e,t),Ro.cross(gl).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ro.subVectors(this.c,this.b),gl.subVectors(this.a,this.b),Ro.cross(gl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return vi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return vi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return vi.getUV(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return vi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return vi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;lf.subVectors(r,n),cf.subVectors(s,n),G3.subVectors(e,n);const l=lf.dot(G3),c=cf.dot(G3);if(l<=0&&c<=0)return t.copy(n);B3.subVectors(e,r);const g=lf.dot(B3),d=cf.dot(B3);if(g>=0&&d<=g)return t.copy(r);const u=l*d-g*c;if(u<=0&&l>=0&&g<=0)return o=l/(l-g),t.copy(n).addScaledVector(lf,o);S3.subVectors(e,s);const h=lf.dot(S3),p=cf.dot(S3);if(p>=0&&h<=p)return t.copy(s);const b=h*c-l*p;if(b<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(cf,a);const y=g*p-h*d;if(y<=0&&d-g>=0&&h-p>=0)return kz.subVectors(s,r),a=(d-g)/(d-g+(h-p)),t.copy(r).addScaledVector(kz,a);const m=1/(y+b+u);return o=b*m,a=u*m,t.copy(n).addScaledVector(lf,o).addScaledVector(cf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Jge=0;class xr extends bu{constructor(){super();Object.defineProperty(this,"id",{value:Jge++}),this.uuid=ua(),this.name="",this.type="Material",this.fog=!0,this.blending=_p,this.side=Wp,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=tz,this.blendDst=nz,this.blendEquation=Ph,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=QZ,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Fge,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=l3,this.stencilZFail=l3,this.stencilZPass=l3,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===JX;continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_p&&(n.blending=this.blending),this.side!==Wp&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}xr.prototype.isMaterial=!0;class Z3 extends xr{constructor(e){super();this.type="MeshBasicMaterial",this.color=new Bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Z3.prototype.isMeshBasicMaterial=!0;const Fn=new fe,Cv=new je;class _i{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Hp,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new Bt),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new je),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new fe),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new _n),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Cv.fromBufferAttribute(this,t),Cv.applyMatrix3(e),this.setXY(t,Cv.x,Cv.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Fn.fromBufferAttribute(this,t),Fn.applyMatrix3(e),this.setXYZ(t,Fn.x,Fn.y,Fn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Fn.x=this.getX(t),Fn.y=this.getY(t),Fn.z=this.getZ(t),Fn.applyMatrix4(e),this.setXYZ(t,Fn.x,Fn.y,Fn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Fn.x=this.getX(t),Fn.y=this.getY(t),Fn.z=this.getZ(t),Fn.applyNormalMatrix(e),this.setXYZ(t,Fn.x,Fn.y,Fn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Fn.x=this.getX(t),Fn.y=this.getY(t),Fn.z=this.getZ(t),Fn.transformDirection(e),this.setXYZ(t,Fn.x,Fn.y,Fn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Hp&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}_i.prototype.isBufferAttribute=!0;class Yz extends _i{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Kz extends _i{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Qge extends _i{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Qge.prototype.isFloat16BufferAttribute=!0;class zi extends _i{constructor(e,t,n){super(new Float32Array(e),t,n)}}let jge=0;const $s=new Vt,R3=new fn,gf=new fe,Zs=new So,zp=new So,ki=new fe;class Jn extends bu{constructor(){super();Object.defineProperty(this,"id",{value:jge++}),this.uuid=ua(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Mz(e)?Kz:Yz)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new ir().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $s.makeRotationFromQuaternion(e),this.applyMatrix4($s),this}rotateX(e){return $s.makeRotationX(e),this.applyMatrix4($s),this}rotateY(e){return $s.makeRotationY(e),this.applyMatrix4($s),this}rotateZ(e){return $s.makeRotationZ(e),this.applyMatrix4($s),this}translate(e,t,n){return $s.makeTranslation(e,t,n),this.applyMatrix4($s),this}scale(e,t,n){return $s.makeScale(e,t,n),this.applyMatrix4($s),this}lookAt(e){return R3.lookAt(e),R3.updateMatrix(),this.applyMatrix4(R3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gf).negate(),this.translate(gf.x,gf.y,gf.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new zi(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new So);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new fe(-1/0,-1/0,-1/0),new fe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Zs.setFromBufferAttribute(s),this.morphTargetsRelative?(ki.addVectors(this.boundingBox.min,Zs.min),this.boundingBox.expandByPoint(ki),ki.addVectors(this.boundingBox.max,Zs.max),this.boundingBox.expandByPoint(ki)):(this.boundingBox.expandByPoint(Zs.min),this.boundingBox.expandByPoint(Zs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new rf);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new fe,1/0);return}if(e){const n=this.boundingSphere.center;if(Zs.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];zp.setFromBufferAttribute(a),this.morphTargetsRelative?(ki.addVectors(Zs.min,zp.min),Zs.expandByPoint(ki),ki.addVectors(Zs.max,zp.max),Zs.expandByPoint(ki)):(Zs.expandByPoint(zp.min),Zs.expandByPoint(zp.max))}Zs.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)ki.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(ki));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,g=a.count;c<g;c++)ki.fromBufferAttribute(a,c),l&&(gf.fromBufferAttribute(e,c),ki.add(gf)),r=Math.max(r,n.distanceToSquared(ki))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;t.tangent===void 0&&this.setAttribute("tangent",new _i(new Float32Array(4*a),4));const l=t.tangent.array,c=[],g=[];for(let V=0;V<a;V++)c[V]=new fe,g[V]=new fe;const d=new fe,u=new fe,h=new fe,p=new je,b=new je,y=new je,m=new fe,f=new fe;function G(V,I,w){d.fromArray(r,V*3),u.fromArray(r,I*3),h.fromArray(r,w*3),p.fromArray(o,V*2),b.fromArray(o,I*2),y.fromArray(o,w*2),u.sub(d),h.sub(d),b.sub(p),y.sub(p);const S=1/(b.x*y.y-y.x*b.y);!isFinite(S)||(m.copy(u).multiplyScalar(y.y).addScaledVector(h,-b.y).multiplyScalar(S),f.copy(h).multiplyScalar(b.x).addScaledVector(u,-y.x).multiplyScalar(S),c[V].add(m),c[I].add(m),c[w].add(m),g[V].add(f),g[I].add(f),g[w].add(f))}let x=this.groups;x.length===0&&(x=[{start:0,count:n.length}]);for(let V=0,I=x.length;V<I;++V){const w=x[V],S=w.start,R=w.count;for(let W=S,H=S+R;W<H;W+=3)G(n[W+0],n[W+1],n[W+2])}const B=new fe,M=new fe,E=new fe,z=new fe;function J(V){E.fromArray(s,V*3),z.copy(E);const I=c[V];B.copy(I),B.sub(E.multiplyScalar(E.dot(I))).normalize(),M.crossVectors(z,I);const S=M.dot(g[V])<0?-1:1;l[V*4]=B.x,l[V*4+1]=B.y,l[V*4+2]=B.z,l[V*4+3]=S}for(let V=0,I=x.length;V<I;++V){const w=x[V],S=w.start,R=w.count;for(let W=S,H=S+R;W<H;W+=3)J(n[W+0]),J(n[W+1]),J(n[W+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new _i(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let u=0,h=n.count;u<h;u++)n.setXYZ(u,0,0,0);const r=new fe,s=new fe,o=new fe,a=new fe,l=new fe,c=new fe,g=new fe,d=new fe;if(e)for(let u=0,h=e.count;u<h;u+=3){const p=e.getX(u+0),b=e.getX(u+1),y=e.getX(u+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,b),o.fromBufferAttribute(t,y),g.subVectors(o,s),d.subVectors(r,s),g.cross(d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,b),c.fromBufferAttribute(n,y),a.add(g),l.add(g),c.add(g),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(b,l.x,l.y,l.z),n.setXYZ(y,c.x,c.y,c.z)}else for(let u=0,h=t.count;u<h;u+=3)r.fromBufferAttribute(t,u+0),s.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),g.subVectors(o,s),d.subVectors(r,s),g.cross(d),n.setXYZ(u+0,g.x,g.y,g.z),n.setXYZ(u+1,g.x,g.y,g.z),n.setXYZ(u+2,g.x,g.y,g.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(e.attributes[r]===void 0)continue;const o=n[r].array,a=e.attributes[r],l=a.array,c=a.itemSize*t,g=Math.min(l.length,o.length-c);for(let d=0,u=c;d<g;d++,u++)o[u]=l[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ki.fromBufferAttribute(e,t),ki.normalize(),e.setXYZ(t,ki.x,ki.y,ki.z)}toNonIndexed(){function e(a,l){const c=a.array,g=a.itemSize,d=a.normalized,u=new c.constructor(l.length*g);let h=0,p=0;for(let b=0,y=l.length;b<y;b++){a.isInterleavedBufferAttribute?h=l[b]*a.data.stride+a.offset:h=l[b]*g;for(let m=0;m<g;m++)u[p++]=c[h++]}return new _i(u,g,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Jn,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let g=0,d=c.length;g<d;g++){const u=c[g],h=e(u,n);l.push(h)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],g=[];for(let d=0,u=c.length;d<u;d++){const h=c[d];g.push(h.toJSON(e.data))}g.length>0&&(r[l]=g,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const g=r[c];this.setAttribute(c,g.clone(t))}const s=e.morphAttributes;for(const c in s){const g=[],d=s[c];for(let u=0,h=d.length;u<h;u++)g.push(d[u].clone(t));this.morphAttributes[c]=g}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,g=o.length;c<g;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Jn.prototype.isBufferGeometry=!0;const Pz=new Vt,uf=new sf,M3=new rf,kc=new fe,Yc=new fe,Kc=new fe,W3=new fe,_3=new fe,V3=new fe,pv=new fe,mv=new fe,Av=new fe,bv=new je,yv=new je,vv=new je,N3=new fe,xv=new fe;class as extends fn{constructor(e=new Jn,t=new Z3){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),M3.copy(n.boundingSphere),M3.applyMatrix4(s),e.ray.intersectsSphere(M3)===!1)||(Pz.copy(s).invert(),uf.copy(e.ray).applyMatrix4(Pz),n.boundingBox!==null&&uf.intersectsBox(n.boundingBox)===!1))return;let o;if(n.isBufferGeometry){const a=n.index,l=n.attributes.position,c=n.morphAttributes.position,g=n.morphTargetsRelative,d=n.attributes.uv,u=n.attributes.uv2,h=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(r))for(let b=0,y=h.length;b<y;b++){const m=h[b],f=r[m.materialIndex],G=Math.max(m.start,p.start),x=Math.min(a.count,Math.min(m.start+m.count,p.start+p.count));for(let B=G,M=x;B<M;B+=3){const E=a.getX(B),z=a.getX(B+1),J=a.getX(B+2);o=wv(this,f,e,uf,l,c,g,d,u,E,z,J),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let m=b,f=y;m<f;m+=3){const G=a.getX(m),x=a.getX(m+1),B=a.getX(m+2);o=wv(this,r,e,uf,l,c,g,d,u,G,x,B),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(r))for(let b=0,y=h.length;b<y;b++){const m=h[b],f=r[m.materialIndex],G=Math.max(m.start,p.start),x=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let B=G,M=x;B<M;B+=3){const E=B,z=B+1,J=B+2;o=wv(this,f,e,uf,l,c,g,d,u,E,z,J),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(let m=b,f=y;m<f;m+=3){const G=m,x=m+1,B=m+2;o=wv(this,r,e,uf,l,c,g,d,u,G,x,B),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}as.prototype.isMesh=!0;function qge(i,e,t,n,r,s,o,a){let l;if(e.side===Mi?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side!==Kh,a),l===null)return null;xv.copy(a),xv.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(xv);return c<t.near||c>t.far?null:{distance:c,point:xv.clone(),object:i}}function wv(i,e,t,n,r,s,o,a,l,c,g,d){kc.fromBufferAttribute(r,c),Yc.fromBufferAttribute(r,g),Kc.fromBufferAttribute(r,d);const u=i.morphTargetInfluences;if(s&&u){pv.set(0,0,0),mv.set(0,0,0),Av.set(0,0,0);for(let p=0,b=s.length;p<b;p++){const y=u[p],m=s[p];y!==0&&(W3.fromBufferAttribute(m,c),_3.fromBufferAttribute(m,g),V3.fromBufferAttribute(m,d),o?(pv.addScaledVector(W3,y),mv.addScaledVector(_3,y),Av.addScaledVector(V3,y)):(pv.addScaledVector(W3.sub(kc),y),mv.addScaledVector(_3.sub(Yc),y),Av.addScaledVector(V3.sub(Kc),y)))}kc.add(pv),Yc.add(mv),Kc.add(Av)}i.isSkinnedMesh&&(i.boneTransform(c,kc),i.boneTransform(g,Yc),i.boneTransform(d,Kc));const h=qge(i,e,t,n,kc,Yc,Kc,N3);if(h){a&&(bv.fromBufferAttribute(a,c),yv.fromBufferAttribute(a,g),vv.fromBufferAttribute(a,d),h.uv=vi.getUV(N3,kc,Yc,Kc,bv,yv,vv,new je)),l&&(bv.fromBufferAttribute(l,c),yv.fromBufferAttribute(l,g),vv.fromBufferAttribute(l,d),h.uv2=vi.getUV(N3,kc,Yc,Kc,bv,yv,vv,new je));const p={a:c,b:g,c:d,normal:new fe,materialIndex:0};vi.getNormal(kc,Yc,Kc,p.normal),h.face=p}return h}class kp extends Jn{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],g=[],d=[];let u=0,h=0;p("z","y","x",-1,-1,n,t,e,o,s,0),p("z","y","x",1,-1,n,t,-e,o,s,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,s,4),p("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new zi(c,3)),this.setAttribute("normal",new zi(g,3)),this.setAttribute("uv",new zi(d,2));function p(b,y,m,f,G,x,B,M,E,z,J){const V=x/E,I=B/z,w=x/2,S=B/2,R=M/2,W=E+1,H=z+1;let k=0,_=0;const Z=new fe;for(let T=0;T<H;T++){const F=T*I-S;for(let K=0;K<W;K++){const j=K*V-w;Z[b]=j*f,Z[y]=F*G,Z[m]=R,c.push(Z.x,Z.y,Z.z),Z[b]=0,Z[y]=0,Z[m]=M>0?1:-1,g.push(Z.x,Z.y,Z.z),d.push(K/E),d.push(1-T/z),k+=1}}for(let T=0;T<z;T++)for(let F=0;F<E;F++){const K=u+F+W*T,j=u+F+W*(T+1),O=u+(F+1)+W*(T+1),Y=u+(F+1)+W*T;l.push(K,j,Y),l.push(j,O,Y),_+=6}a.addGroup(h,_,J),h+=_,u+=k}}static fromJSON(e){return new kp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function df(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function wr(i){const e={};for(let t=0;t<i.length;t++){const n=df(i[t]);for(const r in n)e[r]=n[r]}return e}const $ge={clone:df,merge:wr};var eue=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,tue=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bu extends xr{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=eue,this.fragmentShader=tue,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=df(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Bu.prototype.isShaderMaterial=!0;class E3 extends fn{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Vt,this.projectionMatrix=new Vt,this.projectionMatrixInverse=new Vt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}E3.prototype.isCamera=!0;class ls extends E3{constructor(e=50,t=1,n=.1,r=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=u3*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(g3*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return u3*2*Math.atan(Math.tan(g3*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(g3*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ls.prototype.isPerspectiveCamera=!0;const hf=90,ff=1;class H3 extends fn{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const r=new ls(hf,ff,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new fe(1,0,0)),this.add(r);const s=new ls(hf,ff,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new fe(-1,0,0)),this.add(s);const o=new ls(hf,ff,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new fe(0,1,0)),this.add(o);const a=new ls(hf,ff,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new fe(0,-1,0)),this.add(a);const l=new ls(hf,ff,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new fe(0,0,1)),this.add(l);const c=new ls(hf,ff,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new fe(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[r,s,o,a,l,c]=this.children,g=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,s),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=g,n.texture.needsPMREMUpdate=!0}}class Gv extends Xi{constructor(e,t,n,r,s,o,a,l,c,g){e=e!==void 0?e:[],t=t!==void 0?t:Vp;super(e,t,n,r,s,o,a,l,c,g);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Gv.prototype.isCubeTexture=!0;class Dz extends qs{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n);super(e,e,t);t=t||{},this.texture=new Gv(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:vr}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Tr,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new kp(5,5,5),s=new Bu({name:"CubemapFromEquirect",uniforms:df(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Mi,blending:Nc});s.uniforms.tEquirect.value=t;const o=new as(r,s),a=t.minFilter;return t.minFilter===iv&&(t.minFilter=vr),new H3(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}Dz.prototype.isWebGLCubeRenderTarget=!0;const F3=new fe,nue=new fe,iue=new ir;class dl{constructor(e=new fe(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=F3.subVectors(n,t).cross(nue.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(F3),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(n).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||iue.getNormalMatrix(e),r=this.coplanarPoint(F3).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}dl.prototype.isPlane=!0;const If=new rf,Bv=new fe;class Sv{constructor(e=new dl,t=new dl,n=new dl,r=new dl,s=new dl,o=new dl){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7],u=n[8],h=n[9],p=n[10],b=n[11],y=n[12],m=n[13],f=n[14],G=n[15];return t[0].setComponents(a-r,d-l,b-u,G-y).normalize(),t[1].setComponents(a+r,d+l,b+u,G+y).normalize(),t[2].setComponents(a+s,d+c,b+h,G+m).normalize(),t[3].setComponents(a-s,d-c,b-h,G-m).normalize(),t[4].setComponents(a-o,d-g,b-p,G-f).normalize(),t[5].setComponents(a+o,d+g,b+p,G+f).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),If.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(If)}intersectsSprite(e){return If.center.set(0,0,0),If.radius=.7071067811865476,If.applyMatrix4(e.matrixWorld),this.intersectsSphere(If)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Bv.x=r.normal.x>0?e.max.x:e.min.x,Bv.y=r.normal.y>0?e.max.y:e.min.y,Bv.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Bv)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Uz(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function rue(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,g){const d=c.array,u=c.usage,h=i.createBuffer();i.bindBuffer(g,h),i.bufferData(g,d,u),c.onUploadCallback();let p=5126;return d instanceof Float32Array?p=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:d instanceof Int16Array?p=5122:d instanceof Uint32Array?p=5125:d instanceof Int32Array?p=5124:d instanceof Int8Array?p=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(p=5121),{buffer:h,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function s(c,g,d){const u=g.array,h=g.updateRange;i.bindBuffer(d,c),h.count===-1?i.bufferSubData(d,0,u):(t?i.bufferSubData(d,h.offset*u.BYTES_PER_ELEMENT,u,h.offset,h.count):i.bufferSubData(d,h.offset*u.BYTES_PER_ELEMENT,u.subarray(h.offset,h.offset+h.count)),h.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const g=n.get(c);g&&(i.deleteBuffer(g.buffer),n.delete(c))}function l(c,g){if(c.isGLBufferAttribute){const u=n.get(c);(!u||u.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=n.get(c);d===void 0?n.set(c,r(c,g)):d.version<c.version&&(s(d.buffer,c,g),d.version=c.version)}return{get:o,remove:a,update:l}}class L3 extends Jn{constructor(e=1,t=1,n=1,r=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,g=l+1,d=e/a,u=t/l,h=[],p=[],b=[],y=[];for(let m=0;m<g;m++){const f=m*u-o;for(let G=0;G<c;G++){const x=G*d-s;p.push(x,-f,0),b.push(0,0,1),y.push(G/a),y.push(1-m/l)}}for(let m=0;m<l;m++)for(let f=0;f<a;f++){const G=f+c*m,x=f+c*(m+1),B=f+1+c*(m+1),M=f+1+c*m;h.push(G,x,M),h.push(x,B,M)}this.setIndex(h),this.setAttribute("position",new zi(p,3)),this.setAttribute("normal",new zi(b,3)),this.setAttribute("uv",new zi(y,2))}static fromJSON(e){return new L3(e.width,e.height,e.widthSegments,e.heightSegments)}}var sue=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,oue=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aue=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,lue=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,cue=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,gue=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,uue="vec3 transformed = vec3( position );",due=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,hue=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,fue=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Iue=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Cue=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,pue=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,mue=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Aue=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,bue=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yue=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,vue=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,xue=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,wue=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		return texture2D( envMap, uv ).rgb;
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Gue=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Bue=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Sue=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Zue=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Rue=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Mue="gl_FragColor = linearToOutputTexel( gl_FragColor );",Wue=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,_ue=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Vue=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Nue=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Eue=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Hue=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Fue=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lue=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Tue=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Xue=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,zue=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,kue=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Yue=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Kue=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Pue=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Due=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Uue=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Oue=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Jue=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Que=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,jue=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,que=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,$ue=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ede=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,tde=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,nde=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ide=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,rde=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,sde=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ode=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ade=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,lde=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,cde=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gde=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,ude=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,dde=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,hde=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,fde=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Ide=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Cde=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ade=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,bde=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,yde=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,vde=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,xde=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,wde=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Gde=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Bde=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Sde=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Zde=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Rde=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Mde=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Wde=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,_de=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Vde=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Nde=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Ede=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Hde=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Fde=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Lde=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Tde=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Xde=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,zde=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,kde=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Yde=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Kde=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,Pde=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Dde=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Ude=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Ode=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Jde=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Qde=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,jde=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,qde=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const $de=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,ehe=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,the=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,nhe=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ihe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,rhe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,she=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ohe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ahe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,lhe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,che=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ghe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,uhe=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,dhe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hhe=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fhe=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ihe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Che=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,phe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,mhe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ahe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bhe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yhe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,vhe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xhe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,whe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ghe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Bhe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,She=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Zhe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Rhe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Mhe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ot={alphamap_fragment:sue,alphamap_pars_fragment:oue,alphatest_fragment:aue,alphatest_pars_fragment:lue,aomap_fragment:cue,aomap_pars_fragment:gue,begin_vertex:uue,beginnormal_vertex:due,bsdfs:hue,bumpmap_pars_fragment:fue,clipping_planes_fragment:Iue,clipping_planes_pars_fragment:Cue,clipping_planes_pars_vertex:pue,clipping_planes_vertex:mue,color_fragment:Aue,color_pars_fragment:bue,color_pars_vertex:yue,color_vertex:vue,common:xue,cube_uv_reflection_fragment:wue,defaultnormal_vertex:Gue,displacementmap_pars_vertex:Bue,displacementmap_vertex:Sue,emissivemap_fragment:Zue,emissivemap_pars_fragment:Rue,encodings_fragment:Mue,encodings_pars_fragment:Wue,envmap_fragment:_ue,envmap_common_pars_fragment:Vue,envmap_pars_fragment:Nue,envmap_pars_vertex:Eue,envmap_physical_pars_fragment:Due,envmap_vertex:Hue,fog_vertex:Fue,fog_pars_vertex:Lue,fog_fragment:Tue,fog_pars_fragment:Xue,gradientmap_pars_fragment:zue,lightmap_fragment:kue,lightmap_pars_fragment:Yue,lights_lambert_vertex:Kue,lights_pars_begin:Pue,lights_toon_fragment:Uue,lights_toon_pars_fragment:Oue,lights_phong_fragment:Jue,lights_phong_pars_fragment:Que,lights_physical_fragment:jue,lights_physical_pars_fragment:que,lights_fragment_begin:$ue,lights_fragment_maps:ede,lights_fragment_end:tde,logdepthbuf_fragment:nde,logdepthbuf_pars_fragment:ide,logdepthbuf_pars_vertex:rde,logdepthbuf_vertex:sde,map_fragment:ode,map_pars_fragment:ade,map_particle_fragment:lde,map_particle_pars_fragment:cde,metalnessmap_fragment:gde,metalnessmap_pars_fragment:ude,morphnormal_vertex:dde,morphtarget_pars_vertex:hde,morphtarget_vertex:fde,normal_fragment_begin:Ide,normal_fragment_maps:Cde,normal_pars_fragment:pde,normal_pars_vertex:mde,normal_vertex:Ade,normalmap_pars_fragment:bde,clearcoat_normal_fragment_begin:yde,clearcoat_normal_fragment_maps:vde,clearcoat_pars_fragment:xde,output_fragment:wde,packing:Gde,premultiplied_alpha_fragment:Bde,project_vertex:Sde,dithering_fragment:Zde,dithering_pars_fragment:Rde,roughnessmap_fragment:Mde,roughnessmap_pars_fragment:Wde,shadowmap_pars_fragment:_de,shadowmap_pars_vertex:Vde,shadowmap_vertex:Nde,shadowmask_pars_fragment:Ede,skinbase_vertex:Hde,skinning_pars_vertex:Fde,skinning_vertex:Lde,skinnormal_vertex:Tde,specularmap_fragment:Xde,specularmap_pars_fragment:zde,tonemapping_fragment:kde,tonemapping_pars_fragment:Yde,transmission_fragment:Kde,transmission_pars_fragment:Pde,uv_pars_fragment:Dde,uv_pars_vertex:Ude,uv_vertex:Ode,uv2_pars_fragment:Jde,uv2_pars_vertex:Qde,uv2_vertex:jde,worldpos_vertex:qde,background_vert:$de,background_frag:ehe,cube_vert:the,cube_frag:nhe,depth_vert:ihe,depth_frag:rhe,distanceRGBA_vert:she,distanceRGBA_frag:ohe,equirect_vert:ahe,equirect_frag:lhe,linedashed_vert:che,linedashed_frag:ghe,meshbasic_vert:uhe,meshbasic_frag:dhe,meshlambert_vert:hhe,meshlambert_frag:fhe,meshmatcap_vert:Ihe,meshmatcap_frag:Che,meshnormal_vert:phe,meshnormal_frag:mhe,meshphong_vert:Ahe,meshphong_frag:bhe,meshphysical_vert:yhe,meshphysical_frag:vhe,meshtoon_vert:xhe,meshtoon_frag:whe,points_vert:Ghe,points_frag:Bhe,shadow_vert:She,shadow_frag:Zhe,sprite_vert:Rhe,sprite_frag:Mhe},ot={common:{diffuse:{value:new Bt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ir},uv2Transform:{value:new ir},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new je(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ir}},sprite:{diffuse:{value:new Bt(16777215)},opacity:{value:1},center:{value:new je(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ir}}},da={basic:{uniforms:wr([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.fog]),vertexShader:Ot.meshbasic_vert,fragmentShader:Ot.meshbasic_frag},lambert:{uniforms:wr([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.fog,ot.lights,{emissive:{value:new Bt(0)}}]),vertexShader:Ot.meshlambert_vert,fragmentShader:Ot.meshlambert_frag},phong:{uniforms:wr([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.fog,ot.lights,{emissive:{value:new Bt(0)},specular:{value:new Bt(1118481)},shininess:{value:30}}]),vertexShader:Ot.meshphong_vert,fragmentShader:Ot.meshphong_frag},standard:{uniforms:wr([ot.common,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.roughnessmap,ot.metalnessmap,ot.fog,ot.lights,{emissive:{value:new Bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ot.meshphysical_vert,fragmentShader:Ot.meshphysical_frag},toon:{uniforms:wr([ot.common,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.gradientmap,ot.fog,ot.lights,{emissive:{value:new Bt(0)}}]),vertexShader:Ot.meshtoon_vert,fragmentShader:Ot.meshtoon_frag},matcap:{uniforms:wr([ot.common,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.fog,{matcap:{value:null}}]),vertexShader:Ot.meshmatcap_vert,fragmentShader:Ot.meshmatcap_frag},points:{uniforms:wr([ot.points,ot.fog]),vertexShader:Ot.points_vert,fragmentShader:Ot.points_frag},dashed:{uniforms:wr([ot.common,ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ot.linedashed_vert,fragmentShader:Ot.linedashed_frag},depth:{uniforms:wr([ot.common,ot.displacementmap]),vertexShader:Ot.depth_vert,fragmentShader:Ot.depth_frag},normal:{uniforms:wr([ot.common,ot.bumpmap,ot.normalmap,ot.displacementmap,{opacity:{value:1}}]),vertexShader:Ot.meshnormal_vert,fragmentShader:Ot.meshnormal_frag},sprite:{uniforms:wr([ot.sprite,ot.fog]),vertexShader:Ot.sprite_vert,fragmentShader:Ot.sprite_frag},background:{uniforms:{uvTransform:{value:new ir},t2D:{value:null}},vertexShader:Ot.background_vert,fragmentShader:Ot.background_frag},cube:{uniforms:wr([ot.envmap,{opacity:{value:1}}]),vertexShader:Ot.cube_vert,fragmentShader:Ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ot.equirect_vert,fragmentShader:Ot.equirect_frag},distanceRGBA:{uniforms:wr([ot.common,ot.displacementmap,{referencePosition:{value:new fe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ot.distanceRGBA_vert,fragmentShader:Ot.distanceRGBA_frag},shadow:{uniforms:wr([ot.lights,ot.fog,{color:{value:new Bt(0)},opacity:{value:1}}]),vertexShader:Ot.shadow_vert,fragmentShader:Ot.shadow_frag}};da.physical={uniforms:wr([da.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new je(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Bt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Bt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Bt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ot.meshphysical_vert,fragmentShader:Ot.meshphysical_frag};function Whe(i,e,t,n,r,s){const o=new Bt(0);let a=r===!0?0:1,l,c,g=null,d=0,u=null;function h(b,y){let m=!1,f=y.isScene===!0?y.background:null;f&&f.isTexture&&(f=e.get(f));const G=i.xr,x=G.getSession&&G.getSession();x&&x.environmentBlendMode==="additive"&&(f=null),f===null?p(o,a):f&&f.isColor&&(p(f,1),m=!0),(i.autoClear||m)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),f&&(f.isCubeTexture||f.mapping===nv)?(c===void 0&&(c=new as(new kp(1,1,1),new Bu({name:"BackgroundCubeMaterial",uniforms:df(da.cube.uniforms),vertexShader:da.cube.vertexShader,fragmentShader:da.cube.fragmentShader,side:Mi,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(B,M,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=f,c.material.uniforms.flipEnvMap.value=f.isCubeTexture&&f.isRenderTargetTexture===!1?-1:1,(g!==f||d!==f.version||u!==i.toneMapping)&&(c.material.needsUpdate=!0,g=f,d=f.version,u=i.toneMapping),b.unshift(c,c.geometry,c.material,0,0,null)):f&&f.isTexture&&(l===void 0&&(l=new as(new L3(2,2),new Bu({name:"BackgroundMaterial",uniforms:df(da.background.uniforms),vertexShader:da.background.vertexShader,fragmentShader:da.background.fragmentShader,side:Wp,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=f,f.matrixAutoUpdate===!0&&f.updateMatrix(),l.material.uniforms.uvTransform.value.copy(f.matrix),(g!==f||d!==f.version||u!==i.toneMapping)&&(l.material.needsUpdate=!0,g=f,d=f.version,u=i.toneMapping),b.unshift(l,l.geometry,l.material,0,0,null))}function p(b,y){t.buffers.color.setClear(b.r,b.g,b.b,y,s)}return{getClearColor:function(){return o},setClearColor:function(b,y=1){o.set(b),a=y,p(o,a)},getClearAlpha:function(){return a},setClearAlpha:function(b){a=b,p(o,a)},render:h}}function _he(i,e,t,n){const r=i.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=b(null);let c=l;function g(S,R,W,H,k){let _=!1;if(o){const Z=p(H,W,R);c!==Z&&(c=Z,u(c.object)),_=y(H,k),_&&m(H,k)}else{const Z=R.wireframe===!0;(c.geometry!==H.id||c.program!==W.id||c.wireframe!==Z)&&(c.geometry=H.id,c.program=W.id,c.wireframe=Z,_=!0)}S.isInstancedMesh===!0&&(_=!0),k!==null&&t.update(k,34963),_&&(E(S,R,W,H),k!==null&&i.bindBuffer(34963,t.get(k).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function u(S){return n.isWebGL2?i.bindVertexArray(S):s.bindVertexArrayOES(S)}function h(S){return n.isWebGL2?i.deleteVertexArray(S):s.deleteVertexArrayOES(S)}function p(S,R,W){const H=W.wireframe===!0;let k=a[S.id];k===void 0&&(k={},a[S.id]=k);let _=k[R.id];_===void 0&&(_={},k[R.id]=_);let Z=_[H];return Z===void 0&&(Z=b(d()),_[H]=Z),Z}function b(S){const R=[],W=[],H=[];for(let k=0;k<r;k++)R[k]=0,W[k]=0,H[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:W,attributeDivisors:H,object:S,attributes:{},index:null}}function y(S,R){const W=c.attributes,H=S.attributes;let k=0;for(const _ in H){const Z=W[_],T=H[_];if(Z===void 0||Z.attribute!==T||Z.data!==T.data)return!0;k++}return c.attributesNum!==k||c.index!==R}function m(S,R){const W={},H=S.attributes;let k=0;for(const _ in H){const Z=H[_],T={};T.attribute=Z,Z.data&&(T.data=Z.data),W[_]=T,k++}c.attributes=W,c.attributesNum=k,c.index=R}function f(){const S=c.newAttributes;for(let R=0,W=S.length;R<W;R++)S[R]=0}function G(S){x(S,0)}function x(S,R){const W=c.newAttributes,H=c.enabledAttributes,k=c.attributeDivisors;W[S]=1,H[S]===0&&(i.enableVertexAttribArray(S),H[S]=1),k[S]!==R&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](S,R),k[S]=R)}function B(){const S=c.newAttributes,R=c.enabledAttributes;for(let W=0,H=R.length;W<H;W++)R[W]!==S[W]&&(i.disableVertexAttribArray(W),R[W]=0)}function M(S,R,W,H,k,_){n.isWebGL2===!0&&(W===5124||W===5125)?i.vertexAttribIPointer(S,R,W,k,_):i.vertexAttribPointer(S,R,W,H,k,_)}function E(S,R,W,H){if(n.isWebGL2===!1&&(S.isInstancedMesh||H.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;f();const k=H.attributes,_=W.getAttributes(),Z=R.defaultAttributeValues;for(const T in _){const F=_[T];if(F.location>=0){let K=k[T];if(K===void 0&&(T==="instanceMatrix"&&S.instanceMatrix&&(K=S.instanceMatrix),T==="instanceColor"&&S.instanceColor&&(K=S.instanceColor)),K!==void 0){const j=K.normalized,O=K.itemSize,Y=t.get(K);if(Y===void 0)continue;const ee=Y.buffer,ye=Y.type,Ce=Y.bytesPerElement;if(K.isInterleavedBufferAttribute){const he=K.data,Ne=he.stride,He=K.offset;if(he&&he.isInstancedInterleavedBuffer){for(let ne=0;ne<F.locationSize;ne++)x(F.location+ne,he.meshPerAttribute);S.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let ne=0;ne<F.locationSize;ne++)G(F.location+ne);i.bindBuffer(34962,ee);for(let ne=0;ne<F.locationSize;ne++)M(F.location+ne,O/F.locationSize,ye,j,Ne*Ce,(He+O/F.locationSize*ne)*Ce)}else{if(K.isInstancedBufferAttribute){for(let he=0;he<F.locationSize;he++)x(F.location+he,K.meshPerAttribute);S.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let he=0;he<F.locationSize;he++)G(F.location+he);i.bindBuffer(34962,ee);for(let he=0;he<F.locationSize;he++)M(F.location+he,O/F.locationSize,ye,j,O*Ce,O/F.locationSize*he*Ce)}}else if(Z!==void 0){const j=Z[T];if(j!==void 0)switch(j.length){case 2:i.vertexAttrib2fv(F.location,j);break;case 3:i.vertexAttrib3fv(F.location,j);break;case 4:i.vertexAttrib4fv(F.location,j);break;default:i.vertexAttrib1fv(F.location,j)}}}}B()}function z(){I();for(const S in a){const R=a[S];for(const W in R){const H=R[W];for(const k in H)h(H[k].object),delete H[k];delete R[W]}delete a[S]}}function J(S){if(a[S.id]===void 0)return;const R=a[S.id];for(const W in R){const H=R[W];for(const k in H)h(H[k].object),delete H[k];delete R[W]}delete a[S.id]}function V(S){for(const R in a){const W=a[R];if(W[S.id]===void 0)continue;const H=W[S.id];for(const k in H)h(H[k].object),delete H[k];delete W[S.id]}}function I(){w(),c!==l&&(c=l,u(c.object))}function w(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:g,reset:I,resetDefaultState:w,dispose:z,releaseStatesOfGeometry:J,releaseStatesOfProgram:V,initAttributes:f,enableAttribute:G,disableUnusedAttributes:B}}function Vhe(i,e,t,n){const r=n.isWebGL2;let s;function o(c){s=c}function a(c,g){i.drawArrays(s,c,g),t.update(g,s,1)}function l(c,g,d){if(d===0)return;let u,h;if(r)u=i,h="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[h](s,c,g,d),t.update(g,s,d)}this.setMode=o,this.render=a,this.renderInstances=l}function Nhe(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const E=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(E){if(E==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";E="mediump"}return E==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,d=i.getParameter(34930),u=i.getParameter(35660),h=i.getParameter(3379),p=i.getParameter(34076),b=i.getParameter(34921),y=i.getParameter(36347),m=i.getParameter(36348),f=i.getParameter(36349),G=u>0,x=o||e.has("OES_texture_float"),B=G&&x,M=o?i.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:g,maxTextures:d,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:b,maxVertexUniforms:y,maxVaryings:m,maxFragmentUniforms:f,vertexTextures:G,floatFragmentTextures:x,floatVertexTextures:B,maxSamples:M}}function Ehe(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new dl,a=new ir,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,u,h){const p=d.length!==0||u||n!==0||r;return r=u,t=g(d,h,0),n=d.length,p},this.beginShadows=function(){s=!0,g(null)},this.endShadows=function(){s=!1,c()},this.setState=function(d,u,h){const p=d.clippingPlanes,b=d.clipIntersection,y=d.clipShadows,m=i.get(d);if(!r||p===null||p.length===0||s&&!y)s?g(null):c();else{const f=s?0:n,G=f*4;let x=m.clippingState||null;l.value=x,x=g(p,u,G,h);for(let B=0;B!==G;++B)x[B]=t[B];m.clippingState=x,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=f}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function g(d,u,h,p){const b=d!==null?d.length:0;let y=null;if(b!==0){if(y=l.value,p!==!0||y===null){const m=h+b*4,f=u.matrixWorldInverse;a.getNormalMatrix(f),(y===null||y.length<m)&&(y=new Float32Array(m));for(let G=0,x=h;G!==b;++G,x+=4)o.copy(d[G]).applyMatrix4(f,a),o.normal.toArray(y,x),y[x+3]=o.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,y}}function Hhe(i){let e=new WeakMap;function t(o,a){return a===jZ?o.mapping=Vp:a===qZ&&(o.mapping=Np),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===jZ||a===qZ)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new Dz(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class T3 extends E3{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=g*this.view.offsetY,l=a-g*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}T3.prototype.isOrthographicCamera=!0;class Zv extends Bu{constructor(e){super(e);this.type="RawShaderMaterial"}}Zv.prototype.isRawShaderMaterial=!0;const Cf=4,Pc=8,ha=Math.pow(2,Pc),Oz=[.125,.215,.35,.446,.526,.582],Jz=Pc-Cf+1+Oz.length,pf=20,X3=new T3,{_lodPlanes:Yp,_sizeLods:Qz,_sigmas:Rv}=Fhe(),jz=new Bt;let z3=null;const Su=(1+Math.sqrt(5))/2,mf=1/Su,qz=[new fe(1,1,1),new fe(-1,1,1),new fe(1,1,-1),new fe(-1,1,-1),new fe(0,Su,mf),new fe(0,Su,-mf),new fe(mf,0,Su),new fe(-mf,0,Su),new fe(Su,mf,0),new fe(-Su,mf,0)];class $z{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=Lhe(pf),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){z3=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=nk(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=tk(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Yp.length;e++)Yp[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(z3),e.scissorTest=!1,Mv(e,0,0,e.width,e.height)}_fromTexture(e,t){z3=this._renderer.getRenderTarget();const n=t||this._allocateTargets(e);return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(e){const t={magFilter:vr,minFilter:vr,generateMipmaps:!1,type:Dh,format:Tr,encoding:Fc,depthBuffer:!1},n=ek(t);return n.depthBuffer=!e,this._pingPongRenderTarget===null&&(this._pingPongRenderTarget=ek(t)),n}_compileMaterial(e){const t=new as(Yp[0],e);this._renderer.compile(t,X3)}_sceneToCubeUV(e,t,n,r){const s=90,o=1,a=new ls(s,o,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],g=this._renderer,d=g.autoClear,u=g.toneMapping;g.getClearColor(jz),g.toneMapping=Ec,g.autoClear=!1;const h=new Z3({name:"PMREM.Background",side:Mi,depthWrite:!1,depthTest:!1}),p=new as(new kp,h);let b=!1;const y=e.background;y?y.isColor&&(h.color.copy(y),e.background=null,b=!0):(h.color.copy(jz),b=!0);for(let m=0;m<6;m++){const f=m%3;f===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):f===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m])),Mv(r,f*ha,m>2?ha:0,ha,ha),g.setRenderTarget(r),b&&g.render(p,a),g.render(e,a)}p.geometry.dispose(),p.material.dispose(),g.toneMapping=u,g.autoClear=d,e.background=y}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Vp||e.mapping===Np;r?(this._cubemapShader===null&&(this._cubemapShader=nk()),this._cubemapShader.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectShader===null&&(this._equirectShader=tk());const s=r?this._cubemapShader:this._equirectShader,o=new as(Yp[0],s),a=s.uniforms;a.envMap.value=e,r||a.texelSize.value.set(1/e.image.width,1/e.image.height),Mv(t,0,0,3*ha,2*ha),n.setRenderTarget(t),n.render(o,X3)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<Jz;r++){const s=Math.sqrt(Rv[r]*Rv[r]-Rv[r-1]*Rv[r-1]),o=qz[(r-1)%qz.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,d=new as(Yp[r],c),u=c.uniforms,h=Qz[n]-1,p=isFinite(s)?Math.PI/(2*h):2*Math.PI/(2*pf-1),b=s/p,y=isFinite(s)?1+Math.floor(g*b):pf;y>pf&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${pf}`);const m=[];let f=0;for(let M=0;M<pf;++M){const E=M/b,z=Math.exp(-E*E/2);m.push(z),M===0?f+=z:M<y&&(f+=2*z)}for(let M=0;M<m.length;M++)m[M]=m[M]/f;u.envMap.value=e.texture,u.samples.value=y,u.weights.value=m,u.latitudinal.value=o==="latitudinal",a&&(u.poleAxis.value=a),u.dTheta.value=p,u.mipInt.value=Pc-n;const G=Qz[r],x=3*Math.max(0,ha-2*G),B=(r===0?0:2*ha)+2*G*(r>Pc-Cf?r-Pc+Cf:0);Mv(t,x,B,3*G,2*G),l.setRenderTarget(t),l.render(d,X3)}}function Fhe(){const i=[],e=[],t=[];let n=Pc;for(let r=0;r<Jz;r++){const s=Math.pow(2,n);e.push(s);let o=1/s;r>Pc-Cf?o=Oz[r-Pc+Cf-1]:r===0&&(o=0),t.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,g=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,u=6,h=3,p=2,b=1,y=new Float32Array(h*u*d),m=new Float32Array(p*u*d),f=new Float32Array(b*u*d);for(let x=0;x<d;x++){const B=x%3*2/3-1,M=x>2?0:-1,E=[B,M,0,B+2/3,M,0,B+2/3,M+1,0,B,M,0,B+2/3,M+1,0,B,M+1,0];y.set(E,h*u*x),m.set(g,p*u*x);const z=[x,x,x,x,x,x];f.set(z,b*u*x)}const G=new Jn;G.setAttribute("position",new _i(y,h)),G.setAttribute("uv",new _i(m,p)),G.setAttribute("faceIndex",new _i(f,b)),i.push(G),n>Cf&&n--}return{_lodPlanes:i,_sizeLods:e,_sigmas:t}}function ek(i){const e=new qs(3*ha,3*ha,i);return e.texture.mapping=nv,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Mv(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Lhe(i){const e=new Float32Array(i),t=new fe(0,1,0);return new Zv({name:"SphericalGaussianBlur",defines:{n:i},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t}},vertexShader:k3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Nc,depthTest:!1,depthWrite:!1})}function tk(){const i=new je(1,1);return new Zv({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:i}},vertexShader:k3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = texture2D ( envMap, uv ).rgb;
				uv.x += texelSize.x;
				vec3 tr = texture2D ( envMap, uv ).rgb;
				uv.y += texelSize.y;
				vec3 br = texture2D ( envMap, uv ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = texture2D ( envMap, uv ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

			}
		`,blending:Nc,depthTest:!1,depthWrite:!1})}function nk(){return new Zv({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:k3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Nc,depthTest:!1,depthWrite:!1})}function k3(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function The(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===jZ||l===qZ,g=l===Vp||l===Np;if(c||g)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new $z(i)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||g&&d&&r(d)){t===null&&(t=new $z(i));const u=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,u),a.addEventListener("dispose",s),u.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let g=0;g<c;g++)a[g]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function Xhe(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function zhe(i,e,t,n){const r={},s=new WeakMap;function o(d){const u=d.target;u.index!==null&&e.remove(u.index);for(const p in u.attributes)e.remove(u.attributes[p]);u.removeEventListener("dispose",o),delete r[u.id];const h=s.get(u);h&&(e.remove(h),s.delete(u)),n.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function a(d,u){return r[u.id]===!0||(u.addEventListener("dispose",o),r[u.id]=!0,t.memory.geometries++),u}function l(d){const u=d.attributes;for(const p in u)e.update(u[p],34962);const h=d.morphAttributes;for(const p in h){const b=h[p];for(let y=0,m=b.length;y<m;y++)e.update(b[y],34962)}}function c(d){const u=[],h=d.index,p=d.attributes.position;let b=0;if(h!==null){const f=h.array;b=h.version;for(let G=0,x=f.length;G<x;G+=3){const B=f[G+0],M=f[G+1],E=f[G+2];u.push(B,M,M,E,E,B)}}else{const f=p.array;b=p.version;for(let G=0,x=f.length/3-1;G<x;G+=3){const B=G+0,M=G+1,E=G+2;u.push(B,M,M,E,E,B)}}const y=new(Mz(u)?Kz:Yz)(u,1);y.version=b;const m=s.get(d);m&&e.remove(m),s.set(d,y)}function g(d){const u=s.get(d);if(u){const h=d.index;h!==null&&u.version<h.version&&c(d)}else c(d);return s.get(d)}return{get:a,update:l,getWireframeAttribute:g}}function khe(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}let a,l;function c(u){a=u.type,l=u.bytesPerElement}function g(u,h){i.drawElements(s,h,a,u*l),t.update(h,s,1)}function d(u,h,p){if(p===0)return;let b,y;if(r)b=i,y="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[y](s,h,a,u*l,p),t.update(h,s,p)}this.setMode=o,this.setIndex=c,this.render=g,this.renderInstances=d}function Yhe(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}class Y3 extends Xi{constructor(e=null,t=1,n=1,r=1){super(null);this.image={data:e,width:t,height:n,depth:r},this.magFilter=Wi,this.minFilter=Wi,this.wrapR=Gs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Y3.prototype.isDataTexture2DArray=!0;function Khe(i,e){return i[0]-e[0]}function Phe(i,e){return Math.abs(e[1])-Math.abs(i[1])}function ik(i,e){let t=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),i.divideScalar(t)}function Dhe(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new fe,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,g,d,u){const h=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=g.morphAttributes.position.length;let b=s.get(g);if(b===void 0||b.count!==p){let w=function(){V.dispose(),s.delete(g),g.removeEventListener("dispose",w)};b!==void 0&&b.texture.dispose();const f=g.morphAttributes.normal!==void 0,G=g.morphAttributes.position,x=g.morphAttributes.normal||[],B=g.attributes.position.count,M=f===!0?2:1;let E=B*M,z=1;E>e.maxTextureSize&&(z=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const J=new Float32Array(E*z*4*p),V=new Y3(J,E,z,p);V.format=Tr,V.type=mu,V.needsUpdate=!0;const I=M*4;for(let S=0;S<p;S++){const R=G[S],W=x[S],H=E*z*4*S;for(let k=0;k<R.count;k++){o.fromBufferAttribute(R,k),R.normalized===!0&&ik(o,R);const _=k*I;J[H+_+0]=o.x,J[H+_+1]=o.y,J[H+_+2]=o.z,J[H+_+3]=0,f===!0&&(o.fromBufferAttribute(W,k),W.normalized===!0&&ik(o,W),J[H+_+4]=o.x,J[H+_+5]=o.y,J[H+_+6]=o.z,J[H+_+7]=0)}}b={count:p,texture:V,size:new je(E,z)},s.set(g,b),g.addEventListener("dispose",w)}let y=0;for(let f=0;f<h.length;f++)y+=h[f];const m=g.morphTargetsRelative?1:1-y;u.getUniforms().setValue(i,"morphTargetBaseInfluence",m),u.getUniforms().setValue(i,"morphTargetInfluences",h),u.getUniforms().setValue(i,"morphTargetsTexture",b.texture,t),u.getUniforms().setValue(i,"morphTargetsTextureSize",b.size)}else{const p=h===void 0?0:h.length;let b=n[g.id];if(b===void 0||b.length!==p){b=[];for(let x=0;x<p;x++)b[x]=[x,0];n[g.id]=b}for(let x=0;x<p;x++){const B=b[x];B[0]=x,B[1]=h[x]}b.sort(Phe);for(let x=0;x<8;x++)x<p&&b[x][1]?(a[x][0]=b[x][0],a[x][1]=b[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(Khe);const y=g.morphAttributes.position,m=g.morphAttributes.normal;let f=0;for(let x=0;x<8;x++){const B=a[x],M=B[0],E=B[1];M!==Number.MAX_SAFE_INTEGER&&E?(y&&g.getAttribute("morphTarget"+x)!==y[M]&&g.setAttribute("morphTarget"+x,y[M]),m&&g.getAttribute("morphNormal"+x)!==m[M]&&g.setAttribute("morphNormal"+x,m[M]),r[x]=E,f+=E):(y&&g.hasAttribute("morphTarget"+x)===!0&&g.deleteAttribute("morphTarget"+x),m&&g.hasAttribute("morphNormal"+x)===!0&&g.deleteAttribute("morphNormal"+x),r[x]=0)}const G=g.morphTargetsRelative?1:1-f;u.getUniforms().setValue(i,"morphTargetBaseInfluence",G),u.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function Uhe(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,g=l.geometry,d=e.get(l,g);return r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class rk extends Xi{constructor(e=null,t=1,n=1,r=1){super(null);this.image={data:e,width:t,height:n,depth:r},this.magFilter=Wi,this.minFilter=Wi,this.wrapR=Gs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}rk.prototype.isDataTexture3D=!0;const sk=new Xi,ok=new Y3,ak=new rk,lk=new Gv,ck=[],gk=[],uk=new Float32Array(16),dk=new Float32Array(9),hk=new Float32Array(4);function Af(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=ck[r];if(s===void 0&&(s=new Float32Array(r),ck[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function Xr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Gr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Wv(i,e){let t=gk[e];t===void 0&&(t=new Int32Array(e),gk[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function Ohe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Jhe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Xr(t,e))return;i.uniform2fv(this.addr,e),Gr(t,e)}}function Qhe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Xr(t,e))return;i.uniform3fv(this.addr,e),Gr(t,e)}}function jhe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Xr(t,e))return;i.uniform4fv(this.addr,e),Gr(t,e)}}function qhe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Xr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Gr(t,e)}else{if(Xr(t,n))return;hk.set(n),i.uniformMatrix2fv(this.addr,!1,hk),Gr(t,n)}}function $he(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Xr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Gr(t,e)}else{if(Xr(t,n))return;dk.set(n),i.uniformMatrix3fv(this.addr,!1,dk),Gr(t,n)}}function efe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Xr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Gr(t,e)}else{if(Xr(t,n))return;uk.set(n),i.uniformMatrix4fv(this.addr,!1,uk),Gr(t,n)}}function tfe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function nfe(i,e){const t=this.cache;Xr(t,e)||(i.uniform2iv(this.addr,e),Gr(t,e))}function ife(i,e){const t=this.cache;Xr(t,e)||(i.uniform3iv(this.addr,e),Gr(t,e))}function rfe(i,e){const t=this.cache;Xr(t,e)||(i.uniform4iv(this.addr,e),Gr(t,e))}function sfe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function ofe(i,e){const t=this.cache;Xr(t,e)||(i.uniform2uiv(this.addr,e),Gr(t,e))}function afe(i,e){const t=this.cache;Xr(t,e)||(i.uniform3uiv(this.addr,e),Gr(t,e))}function lfe(i,e){const t=this.cache;Xr(t,e)||(i.uniform4uiv(this.addr,e),Gr(t,e))}function cfe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.safeSetTexture2D(e||sk,r)}function gfe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||ak,r)}function ufe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.safeSetTextureCube(e||lk,r)}function dfe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||ok,r)}function hfe(i){switch(i){case 5126:return Ohe;case 35664:return Jhe;case 35665:return Qhe;case 35666:return jhe;case 35674:return qhe;case 35675:return $he;case 35676:return efe;case 5124:case 35670:return tfe;case 35667:case 35671:return nfe;case 35668:case 35672:return ife;case 35669:case 35673:return rfe;case 5125:return sfe;case 36294:return ofe;case 36295:return afe;case 36296:return lfe;case 35678:case 36198:case 36298:case 36306:case 35682:return cfe;case 35679:case 36299:case 36307:return gfe;case 35680:case 36300:case 36308:case 36293:return ufe;case 36289:case 36303:case 36311:case 36292:return dfe}}function ffe(i,e){i.uniform1fv(this.addr,e)}function Ife(i,e){const t=Af(e,this.size,2);i.uniform2fv(this.addr,t)}function Cfe(i,e){const t=Af(e,this.size,3);i.uniform3fv(this.addr,t)}function pfe(i,e){const t=Af(e,this.size,4);i.uniform4fv(this.addr,t)}function mfe(i,e){const t=Af(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function Afe(i,e){const t=Af(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function bfe(i,e){const t=Af(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function yfe(i,e){i.uniform1iv(this.addr,e)}function vfe(i,e){i.uniform2iv(this.addr,e)}function xfe(i,e){i.uniform3iv(this.addr,e)}function wfe(i,e){i.uniform4iv(this.addr,e)}function Gfe(i,e){i.uniform1uiv(this.addr,e)}function Bfe(i,e){i.uniform2uiv(this.addr,e)}function Sfe(i,e){i.uniform3uiv(this.addr,e)}function Zfe(i,e){i.uniform4uiv(this.addr,e)}function Rfe(i,e,t){const n=e.length,r=Wv(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.safeSetTexture2D(e[s]||sk,r[s])}function Mfe(i,e,t){const n=e.length,r=Wv(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTexture3D(e[s]||ak,r[s])}function Wfe(i,e,t){const n=e.length,r=Wv(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.safeSetTextureCube(e[s]||lk,r[s])}function _fe(i,e,t){const n=e.length,r=Wv(t,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)t.setTexture2DArray(e[s]||ok,r[s])}function Vfe(i){switch(i){case 5126:return ffe;case 35664:return Ife;case 35665:return Cfe;case 35666:return pfe;case 35674:return mfe;case 35675:return Afe;case 35676:return bfe;case 5124:case 35670:return yfe;case 35667:case 35671:return vfe;case 35668:case 35672:return xfe;case 35669:case 35673:return wfe;case 5125:return Gfe;case 36294:return Bfe;case 36295:return Sfe;case 36296:return Zfe;case 35678:case 36198:case 36298:case 36306:case 35682:return Rfe;case 35679:case 36299:case 36307:return Mfe;case 35680:case 36300:case 36308:case 36293:return Wfe;case 36289:case 36303:case 36311:case 36292:return _fe}}function Nfe(i,e,t){this.id=i,this.addr=t,this.cache=[],this.setValue=hfe(e.type)}function fk(i,e,t){this.id=i,this.addr=t,this.cache=[],this.size=e.size,this.setValue=Vfe(e.type)}fk.prototype.updateCache=function(i){const e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),Gr(e,i)};function Ik(i){this.id=i,this.seq=[],this.map={}}Ik.prototype.setValue=function(i,e,t){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const o=n[r];o.setValue(i,e[o.id],t)}};const K3=/(\w+)(\])?(\[|\.)?/g;function Ck(i,e){i.seq.push(e),i.map[e.id]=e}function Efe(i,e,t){const n=i.name,r=n.length;for(K3.lastIndex=0;;){const s=K3.exec(n),o=K3.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){Ck(t,c===void 0?new Nfe(a,i,e):new fk(a,i,e));break}else{let d=t.map[a];d===void 0&&(d=new Ik(a),Ck(t,d)),t=d}}}function Dc(i,e){this.seq=[],this.map={};const t=i.getProgramParameter(e,35718);for(let n=0;n<t;++n){const r=i.getActiveUniform(e,n),s=i.getUniformLocation(e,r.name);Efe(r,s,this)}}Dc.prototype.setValue=function(i,e,t,n){const r=this.map[e];r!==void 0&&r.setValue(i,t,n)};Dc.prototype.setOptional=function(i,e,t){const n=e[t];n!==void 0&&this.setValue(i,t,n)};Dc.upload=function(i,e,t,n){for(let r=0,s=e.length;r!==s;++r){const o=e[r],a=t[o.id];a.needsUpdate!==!1&&o.setValue(i,a.value,n)}};Dc.seqWithValue=function(i,e){const t=[];for(let n=0,r=i.length;n!==r;++n){const s=i[n];s.id in e&&t.push(s)}return t};function pk(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let Hfe=0;function Ffe(i){const e=i.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function Lfe(i){switch(i){case Fc:return["Linear","( value )"];case On:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function mk(i,e,t){const n=i.getShaderParameter(e,35713),r=i.getShaderInfoLog(e).trim();return n&&r===""?"":t.toUpperCase()+`

`+r+`

`+Ffe(i.getShaderSource(e))}function Tfe(i,e){const t=Lfe(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Xfe(i,e){let t;switch(e){case cge:t="Linear";break;case gge:t="Reinhard";break;case uge:t="OptimizedCineon";break;case dge:t="ACESFilmic";break;case hge:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function zfe(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Kp).join(`
`)}function kfe(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Yfe(i,e){const t={},n=i.getProgramParameter(e,35721);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===35674&&(a=2),s.type===35675&&(a=3),s.type===35676&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function Kp(i){return i!==""}function Ak(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function bk(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Kfe=/^[ \t]*#include +<([\w\d./]+)>/gm;function P3(i){return i.replace(Kfe,Pfe)}function Pfe(i,e){const t=Ot[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return P3(t)}const Dfe=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ufe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yk(i){return i.replace(Ufe,vk).replace(Dfe,Ofe)}function Ofe(i,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),vk(i,e,t,n)}function vk(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function xk(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Jfe(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===OX?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===zce?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Mp&&(e="SHADOWMAP_TYPE_VSM"),e}function Qfe(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Vp:case Np:e="ENVMAP_TYPE_CUBE";break;case nv:case $Z:e="ENVMAP_TYPE_CUBE_UV";break}return e}function jfe(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Np:case $Z:e="ENVMAP_MODE_REFRACTION";break}return e}function qfe(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case tv:e="ENVMAP_BLENDING_MULTIPLY";break;case age:e="ENVMAP_BLENDING_MIX";break;case lge:e="ENVMAP_BLENDING_ADD";break}return e}function $fe(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=Jfe(t),c=Qfe(t),g=jfe(t),d=qfe(t),u=t.isWebGL2?"":zfe(t),h=kfe(s),p=r.createProgram();let b,y,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=[h].filter(Kp).join(`
`),b.length>0&&(b+=`
`),y=[u,h].filter(Kp).join(`
`),y.length>0&&(y+=`
`)):(b=[xk(t),"#define SHADER_NAME "+t.shaderName,h,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Kp).join(`
`),y=[u,xk(t),"#define SHADER_NAME "+t.shaderName,h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+g:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ec?"#define TONE_MAPPING":"",t.toneMapping!==Ec?Ot.tonemapping_pars_fragment:"",t.toneMapping!==Ec?Xfe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.transparent?"":"#define OPAQUE",Ot.encodings_pars_fragment,Tfe("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Kp).join(`
`)),o=P3(o),o=Ak(o,t),o=bk(o,t),a=P3(a),a=Ak(a,t),a=bk(a,t),o=yk(o),a=yk(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",t.glslVersion===Zz?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Zz?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const f=m+b+o,G=m+y+a,x=pk(r,35633,f),B=pk(r,35632,G);if(r.attachShader(p,x),r.attachShader(p,B),t.index0AttributeName!==void 0?r.bindAttribLocation(p,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(p,0,"position"),r.linkProgram(p),i.debug.checkShaderErrors){const z=r.getProgramInfoLog(p).trim(),J=r.getShaderInfoLog(x).trim(),V=r.getShaderInfoLog(B).trim();let I=!0,w=!0;if(r.getProgramParameter(p,35714)===!1){I=!1;const S=mk(r,x,"vertex"),R=mk(r,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(p,35715)+`

Program Info Log: `+z+`
`+S+`
`+R)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(J===""||V==="")&&(w=!1);w&&(this.diagnostics={runnable:I,programLog:z,vertexShader:{log:J,prefix:b},fragmentShader:{log:V,prefix:y}})}r.deleteShader(x),r.deleteShader(B);let M;this.getUniforms=function(){return M===void 0&&(M=new Dc(r,p)),M};let E;return this.getAttributes=function(){return E===void 0&&(E=Yfe(r,p)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(p),this.program=void 0},this.name=t.shaderName,this.id=Hfe++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=x,this.fragmentShader=B,this}let eIe=0;class tIe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(t.has(e)===!1){const n=new nIe;t.set(e,n)}return t.get(e)}}class nIe{constructor(){this.id=eIe++,this.usedTimes=0}}function iIe(i,e,t,n,r,s,o){const a=new Hz,l=new tIe,c=[],g=r.isWebGL2,d=r.logarithmicDepthBuffer,u=r.floatVertexTextures,h=r.maxVertexUniforms,p=r.vertexTextures;let b=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(I){const S=I.skeleton.bones;if(u)return 1024;{const W=Math.floor((h-20)/4),H=Math.min(W,S.length);return H<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+H+"."),0):H}}function f(I,w,S,R,W){const H=R.fog,k=I.isMeshStandardMaterial?R.environment:null,_=(I.isMeshStandardMaterial?t:e).get(I.envMap||k),Z=y[I.type],T=W.isSkinnedMesh?m(W):0;I.precision!==null&&(b=r.getMaxPrecision(I.precision),b!==I.precision&&console.warn("THREE.WebGLProgram.getParameters:",I.precision,"not supported, using",b,"instead."));let F,K,j,O;if(Z){const he=da[Z];F=he.vertexShader,K=he.fragmentShader}else F=I.vertexShader,K=I.fragmentShader,l.update(I),j=l.getVertexShaderID(I),O=l.getFragmentShaderID(I);const Y=i.getRenderTarget(),ee=I.alphaTest>0,ye=I.clearcoat>0;return{isWebGL2:g,shaderID:Z,shaderName:I.type,vertexShader:F,fragmentShader:K,defines:I.defines,customVertexShaderID:j,customFragmentShaderID:O,isRawShaderMaterial:I.isRawShaderMaterial===!0,glslVersion:I.glslVersion,precision:b,instancing:W.isInstancedMesh===!0,instancingColor:W.isInstancedMesh===!0&&W.instanceColor!==null,supportsVertexTextures:p,outputEncoding:Y===null?i.outputEncoding:Y.isXRRenderTarget===!0?Y.texture.encoding:Fc,map:!!I.map,matcap:!!I.matcap,envMap:!!_,envMapMode:_&&_.mapping,envMapCubeUV:!!_&&(_.mapping===nv||_.mapping===$Z),lightMap:!!I.lightMap,aoMap:!!I.aoMap,emissiveMap:!!I.emissiveMap,bumpMap:!!I.bumpMap,normalMap:!!I.normalMap,objectSpaceNormalMap:I.normalMapType===Hge,tangentSpaceNormalMap:I.normalMapType===jh,decodeVideoTexture:!!I.map&&I.map.isVideoTexture===!0&&I.map.encoding===On,clearcoat:ye,clearcoatMap:ye&&!!I.clearcoatMap,clearcoatRoughnessMap:ye&&!!I.clearcoatRoughnessMap,clearcoatNormalMap:ye&&!!I.clearcoatNormalMap,displacementMap:!!I.displacementMap,roughnessMap:!!I.roughnessMap,metalnessMap:!!I.metalnessMap,specularMap:!!I.specularMap,specularIntensityMap:!!I.specularIntensityMap,specularColorMap:!!I.specularColorMap,transparent:I.transparent,alphaMap:!!I.alphaMap,alphaTest:ee,gradientMap:!!I.gradientMap,sheen:I.sheen>0,sheenColorMap:!!I.sheenColorMap,sheenRoughnessMap:!!I.sheenRoughnessMap,transmission:I.transmission>0,transmissionMap:!!I.transmissionMap,thicknessMap:!!I.thicknessMap,combine:I.combine,vertexTangents:!!I.normalMap&&!!W.geometry&&!!W.geometry.attributes.tangent,vertexColors:I.vertexColors,vertexAlphas:I.vertexColors===!0&&!!W.geometry&&!!W.geometry.attributes.color&&W.geometry.attributes.color.itemSize===4,vertexUvs:!!I.map||!!I.bumpMap||!!I.normalMap||!!I.specularMap||!!I.alphaMap||!!I.emissiveMap||!!I.roughnessMap||!!I.metalnessMap||!!I.clearcoatMap||!!I.clearcoatRoughnessMap||!!I.clearcoatNormalMap||!!I.displacementMap||!!I.transmissionMap||!!I.thicknessMap||!!I.specularIntensityMap||!!I.specularColorMap||!!I.sheenColorMap||!!I.sheenRoughnessMap,uvsVertexOnly:!(!!I.map||!!I.bumpMap||!!I.normalMap||!!I.specularMap||!!I.alphaMap||!!I.emissiveMap||!!I.roughnessMap||!!I.metalnessMap||!!I.clearcoatNormalMap||I.transmission>0||!!I.transmissionMap||!!I.thicknessMap||!!I.specularIntensityMap||!!I.specularColorMap||I.sheen>0||!!I.sheenColorMap||!!I.sheenRoughnessMap)&&!!I.displacementMap,fog:!!H,useFog:I.fog,fogExp2:H&&H.isFogExp2,flatShading:!!I.flatShading,sizeAttenuation:I.sizeAttenuation,logarithmicDepthBuffer:d,skinning:W.isSkinnedMesh===!0&&T>0,maxBones:T,useVertexTexture:u,morphTargets:!!W.geometry&&!!W.geometry.morphAttributes.position,morphNormals:!!W.geometry&&!!W.geometry.morphAttributes.normal,morphTargetsCount:!!W.geometry&&!!W.geometry.morphAttributes.position?W.geometry.morphAttributes.position.length:0,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:I.dithering,shadowMapEnabled:i.shadowMap.enabled&&S.length>0,shadowMapType:i.shadowMap.type,toneMapping:I.toneMapped?i.toneMapping:Ec,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:I.premultipliedAlpha,doubleSided:I.side===Kh,flipSided:I.side===Mi,depthPacking:I.depthPacking!==void 0?I.depthPacking:!1,index0AttributeName:I.index0AttributeName,extensionDerivatives:I.extensions&&I.extensions.derivatives,extensionFragDepth:I.extensions&&I.extensions.fragDepth,extensionDrawBuffers:I.extensions&&I.extensions.drawBuffers,extensionShaderTextureLOD:I.extensions&&I.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||n.has("EXT_shader_texture_lod"),customProgramCacheKey:I.customProgramCacheKey()}}function G(I){const w=[];if(I.shaderID?w.push(I.shaderID):(w.push(I.customVertexShaderID),w.push(I.customFragmentShaderID)),I.defines!==void 0)for(const S in I.defines)w.push(S),w.push(I.defines[S]);return I.isRawShaderMaterial===!1&&(x(w,I),B(w,I),w.push(i.outputEncoding)),w.push(I.customProgramCacheKey),w.join()}function x(I,w){I.push(w.precision),I.push(w.outputEncoding),I.push(w.envMapMode),I.push(w.combine),I.push(w.vertexUvs),I.push(w.fogExp2),I.push(w.sizeAttenuation),I.push(w.maxBones),I.push(w.morphTargetsCount),I.push(w.numDirLights),I.push(w.numPointLights),I.push(w.numSpotLights),I.push(w.numHemiLights),I.push(w.numRectAreaLights),I.push(w.numDirLightShadows),I.push(w.numPointLightShadows),I.push(w.numSpotLightShadows),I.push(w.shadowMapType),I.push(w.toneMapping),I.push(w.numClippingPlanes),I.push(w.numClipIntersection)}function B(I,w){a.disableAll(),w.isWebGL2&&a.enable(0),w.supportsVertexTextures&&a.enable(1),w.instancing&&a.enable(2),w.instancingColor&&a.enable(3),w.map&&a.enable(4),w.matcap&&a.enable(5),w.envMap&&a.enable(6),w.envMapCubeUV&&a.enable(7),w.lightMap&&a.enable(8),w.aoMap&&a.enable(9),w.emissiveMap&&a.enable(10),w.bumpMap&&a.enable(11),w.normalMap&&a.enable(12),w.objectSpaceNormalMap&&a.enable(13),w.tangentSpaceNormalMap&&a.enable(14),w.clearcoat&&a.enable(15),w.clearcoatMap&&a.enable(16),w.clearcoatRoughnessMap&&a.enable(17),w.clearcoatNormalMap&&a.enable(18),w.displacementMap&&a.enable(19),w.specularMap&&a.enable(20),w.roughnessMap&&a.enable(21),w.metalnessMap&&a.enable(22),w.gradientMap&&a.enable(23),w.alphaMap&&a.enable(24),w.alphaTest&&a.enable(25),w.vertexColors&&a.enable(26),w.vertexAlphas&&a.enable(27),w.vertexUvs&&a.enable(28),w.vertexTangents&&a.enable(29),w.uvsVertexOnly&&a.enable(30),w.fog&&a.enable(31),I.push(a.mask),a.disableAll(),w.useFog&&a.enable(0),w.flatShading&&a.enable(1),w.logarithmicDepthBuffer&&a.enable(2),w.skinning&&a.enable(3),w.useVertexTexture&&a.enable(4),w.morphTargets&&a.enable(5),w.morphNormals&&a.enable(6),w.premultipliedAlpha&&a.enable(7),w.shadowMapEnabled&&a.enable(8),w.physicallyCorrectLights&&a.enable(9),w.doubleSided&&a.enable(10),w.flipSided&&a.enable(11),w.depthPacking&&a.enable(12),w.dithering&&a.enable(13),w.specularIntensityMap&&a.enable(14),w.specularColorMap&&a.enable(15),w.transmission&&a.enable(16),w.transmissionMap&&a.enable(17),w.thicknessMap&&a.enable(18),w.sheen&&a.enable(19),w.sheenColorMap&&a.enable(20),w.sheenRoughnessMap&&a.enable(21),w.decodeVideoTexture&&a.enable(22),w.transparent&&a.enable(23),I.push(a.mask)}function M(I){const w=y[I.type];let S;if(w){const R=da[w];S=$ge.clone(R.uniforms)}else S=I.uniforms;return S}function E(I,w){let S;for(let R=0,W=c.length;R<W;R++){const H=c[R];if(H.cacheKey===w){S=H,++S.usedTimes;break}}return S===void 0&&(S=new $fe(i,w,I,s),c.push(S)),S}function z(I){if(--I.usedTimes==0){const w=c.indexOf(I);c[w]=c[c.length-1],c.pop(),I.destroy()}}function J(I){l.remove(I)}function V(){l.dispose()}return{getParameters:f,getProgramCacheKey:G,getUniforms:M,acquireProgram:E,releaseProgram:z,releaseShaderCache:J,programs:c,dispose:V}}function rIe(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function sIe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function wk(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Gk(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(d,u,h,p,b,y){let m=i[e];return m===void 0?(m={id:d.id,object:d,geometry:u,material:h,groupOrder:p,renderOrder:d.renderOrder,z:b,group:y},i[e]=m):(m.id=d.id,m.object=d,m.geometry=u,m.material=h,m.groupOrder=p,m.renderOrder=d.renderOrder,m.z=b,m.group=y),e++,m}function a(d,u,h,p,b,y){const m=o(d,u,h,p,b,y);h.transmission>0?n.push(m):h.transparent===!0?r.push(m):t.push(m)}function l(d,u,h,p,b,y){const m=o(d,u,h,p,b,y);h.transmission>0?n.unshift(m):h.transparent===!0?r.unshift(m):t.unshift(m)}function c(d,u){t.length>1&&t.sort(d||sIe),n.length>1&&n.sort(u||wk),r.length>1&&r.sort(u||wk)}function g(){for(let d=e,u=i.length;d<u;d++){const h=i[d];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:g,sort:c}}function oIe(){let i=new WeakMap;function e(n,r){let s;return i.has(n)===!1?(s=new Gk,i.set(n,[s])):r>=i.get(n).length?(s=new Gk,i.get(n).push(s)):s=i.get(n)[r],s}function t(){i=new WeakMap}return{get:e,dispose:t}}function aIe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new fe,color:new Bt};break;case"SpotLight":t={position:new fe,direction:new fe,color:new Bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new fe,color:new Bt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new fe,skyColor:new Bt,groundColor:new Bt};break;case"RectAreaLight":t={color:new Bt,position:new fe,halfWidth:new fe,halfHeight:new fe};break}return i[e.id]=t,t}}}function lIe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let cIe=0;function gIe(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function uIe(i,e){const t=new aIe,n=lIe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)r.probe.push(new fe);const s=new fe,o=new Vt,a=new Vt;function l(g,d){let u=0,h=0,p=0;for(let J=0;J<9;J++)r.probe[J].set(0,0,0);let b=0,y=0,m=0,f=0,G=0,x=0,B=0,M=0;g.sort(gIe);const E=d!==!0?Math.PI:1;for(let J=0,V=g.length;J<V;J++){const I=g[J],w=I.color,S=I.intensity,R=I.distance,W=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)u+=w.r*S*E,h+=w.g*S*E,p+=w.b*S*E;else if(I.isLightProbe)for(let H=0;H<9;H++)r.probe[H].addScaledVector(I.sh.coefficients[H],S);else if(I.isDirectionalLight){const H=t.get(I);if(H.color.copy(I.color).multiplyScalar(I.intensity*E),I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,r.directionalShadow[b]=_,r.directionalShadowMap[b]=W,r.directionalShadowMatrix[b]=I.shadow.matrix,x++}r.directional[b]=H,b++}else if(I.isSpotLight){const H=t.get(I);if(H.position.setFromMatrixPosition(I.matrixWorld),H.color.copy(w).multiplyScalar(S*E),H.distance=R,H.coneCos=Math.cos(I.angle),H.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),H.decay=I.decay,I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,r.spotShadow[m]=_,r.spotShadowMap[m]=W,r.spotShadowMatrix[m]=I.shadow.matrix,M++}r.spot[m]=H,m++}else if(I.isRectAreaLight){const H=t.get(I);H.color.copy(w).multiplyScalar(S),H.halfWidth.set(I.width*.5,0,0),H.halfHeight.set(0,I.height*.5,0),r.rectArea[f]=H,f++}else if(I.isPointLight){const H=t.get(I);if(H.color.copy(I.color).multiplyScalar(I.intensity*E),H.distance=I.distance,H.decay=I.decay,I.castShadow){const k=I.shadow,_=n.get(I);_.shadowBias=k.bias,_.shadowNormalBias=k.normalBias,_.shadowRadius=k.radius,_.shadowMapSize=k.mapSize,_.shadowCameraNear=k.camera.near,_.shadowCameraFar=k.camera.far,r.pointShadow[y]=_,r.pointShadowMap[y]=W,r.pointShadowMatrix[y]=I.shadow.matrix,B++}r.point[y]=H,y++}else if(I.isHemisphereLight){const H=t.get(I);H.skyColor.copy(I.color).multiplyScalar(S*E),H.groundColor.copy(I.groundColor).multiplyScalar(S*E),r.hemi[G]=H,G++}}f>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=ot.LTC_FLOAT_1,r.rectAreaLTC2=ot.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=ot.LTC_HALF_1,r.rectAreaLTC2=ot.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=p;const z=r.hash;(z.directionalLength!==b||z.pointLength!==y||z.spotLength!==m||z.rectAreaLength!==f||z.hemiLength!==G||z.numDirectionalShadows!==x||z.numPointShadows!==B||z.numSpotShadows!==M)&&(r.directional.length=b,r.spot.length=m,r.rectArea.length=f,r.point.length=y,r.hemi.length=G,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=B,r.pointShadowMap.length=B,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=B,r.spotShadowMatrix.length=M,z.directionalLength=b,z.pointLength=y,z.spotLength=m,z.rectAreaLength=f,z.hemiLength=G,z.numDirectionalShadows=x,z.numPointShadows=B,z.numSpotShadows=M,r.version=cIe++)}function c(g,d){let u=0,h=0,p=0,b=0,y=0;const m=d.matrixWorldInverse;for(let f=0,G=g.length;f<G;f++){const x=g[f];if(x.isDirectionalLight){const B=r.directional[u];B.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(m),u++}else if(x.isSpotLight){const B=r.spot[p];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),B.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(m),p++}else if(x.isRectAreaLight){const B=r.rectArea[b];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),a.identity(),o.copy(x.matrixWorld),o.premultiply(m),a.extractRotation(o),B.halfWidth.set(x.width*.5,0,0),B.halfHeight.set(0,x.height*.5,0),B.halfWidth.applyMatrix4(a),B.halfHeight.applyMatrix4(a),b++}else if(x.isPointLight){const B=r.point[h];B.position.setFromMatrixPosition(x.matrixWorld),B.position.applyMatrix4(m),h++}else if(x.isHemisphereLight){const B=r.hemi[y];B.direction.setFromMatrixPosition(x.matrixWorld),B.direction.transformDirection(m),B.direction.normalize(),y++}}}return{setup:l,setupView:c,state:r}}function Bk(i,e){const t=new uIe(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(d){n.push(d)}function a(d){r.push(d)}function l(d){t.setup(n,d)}function c(d){t.setupView(n,d)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function dIe(i,e){let t=new WeakMap;function n(s,o=0){let a;return t.has(s)===!1?(a=new Bk(i,e),t.set(s,[a])):o>=t.get(s).length?(a=new Bk(i,e),t.get(s).push(a)):a=t.get(s)[o],a}function r(){t=new WeakMap}return{get:n,dispose:r}}class Sk extends xr{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=Nge,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Sk.prototype.isMeshDepthMaterial=!0;class Zk extends xr{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new fe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Zk.prototype.isMeshDistanceMaterial=!0;const hIe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fIe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Rk(i,e,t){let n=new Sv;const r=new je,s=new je,o=new _n,a=new Sk({depthPacking:Ege}),l=new Zk,c={},g=t.maxTextureSize,d={0:Mi,1:Wp,2:Kh},u=new Bu({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new je},radius:{value:4}},vertexShader:hIe,fragmentShader:fIe}),h=u.clone();h.defines.HORIZONTAL_PASS=1;const p=new Jn;p.setAttribute("position",new _i(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new as(p,u),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=OX,this.render=function(x,B,M){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||x.length===0)return;const E=i.getRenderTarget(),z=i.getActiveCubeFace(),J=i.getActiveMipmapLevel(),V=i.state;V.setBlending(Nc),V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);for(let I=0,w=x.length;I<w;I++){const S=x[I],R=S.shadow;if(R===void 0){console.warn("THREE.WebGLShadowMap:",S,"has no shadow.");continue}if(R.autoUpdate===!1&&R.needsUpdate===!1)continue;r.copy(R.mapSize);const W=R.getFrameExtents();if(r.multiply(W),s.copy(R.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(s.x=Math.floor(g/W.x),r.x=s.x*W.x,R.mapSize.x=s.x),r.y>g&&(s.y=Math.floor(g/W.y),r.y=s.y*W.y,R.mapSize.y=s.y)),R.map===null&&!R.isPointLightShadow&&this.type===Mp){const k={minFilter:vr,magFilter:vr,format:Tr};R.map=new qs(r.x,r.y,k),R.map.texture.name=S.name+".shadowMap",R.mapPass=new qs(r.x,r.y,k),R.camera.updateProjectionMatrix()}if(R.map===null){const k={minFilter:Wi,magFilter:Wi,format:Tr};R.map=new qs(r.x,r.y,k),R.map.texture.name=S.name+".shadowMap",R.camera.updateProjectionMatrix()}i.setRenderTarget(R.map),i.clear();const H=R.getViewportCount();for(let k=0;k<H;k++){const _=R.getViewport(k);o.set(s.x*_.x,s.y*_.y,s.x*_.z,s.y*_.w),V.viewport(o),R.updateMatrices(S,k),n=R.getFrustum(),G(B,M,R.camera,S,this.type)}!R.isPointLightShadow&&this.type===Mp&&m(R,M),R.needsUpdate=!1}y.needsUpdate=!1,i.setRenderTarget(E,z,J)};function m(x,B){const M=e.update(b);u.defines.VSM_SAMPLES!==x.blurSamples&&(u.defines.VSM_SAMPLES=x.blurSamples,h.defines.VSM_SAMPLES=x.blurSamples,u.needsUpdate=!0,h.needsUpdate=!0),u.uniforms.shadow_pass.value=x.map.texture,u.uniforms.resolution.value=x.mapSize,u.uniforms.radius.value=x.radius,i.setRenderTarget(x.mapPass),i.clear(),i.renderBufferDirect(B,null,M,u,b,null),h.uniforms.shadow_pass.value=x.mapPass.texture,h.uniforms.resolution.value=x.mapSize,h.uniforms.radius.value=x.radius,i.setRenderTarget(x.map),i.clear(),i.renderBufferDirect(B,null,M,h,b,null)}function f(x,B,M,E,z,J,V){let I=null;const w=E.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(w!==void 0?I=w:I=E.isPointLight===!0?l:a,i.localClippingEnabled&&M.clipShadows===!0&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0){const S=I.uuid,R=M.uuid;let W=c[S];W===void 0&&(W={},c[S]=W);let H=W[R];H===void 0&&(H=I.clone(),W[R]=H),I=H}return I.visible=M.visible,I.wireframe=M.wireframe,V===Mp?I.side=M.shadowSide!==null?M.shadowSide:M.side:I.side=M.shadowSide!==null?M.shadowSide:d[M.side],I.alphaMap=M.alphaMap,I.alphaTest=M.alphaTest,I.clipShadows=M.clipShadows,I.clippingPlanes=M.clippingPlanes,I.clipIntersection=M.clipIntersection,I.displacementMap=M.displacementMap,I.displacementScale=M.displacementScale,I.displacementBias=M.displacementBias,I.wireframeLinewidth=M.wireframeLinewidth,I.linewidth=M.linewidth,E.isPointLight===!0&&I.isMeshDistanceMaterial===!0&&(I.referencePosition.setFromMatrixPosition(E.matrixWorld),I.nearDistance=z,I.farDistance=J),I}function G(x,B,M,E,z){if(x.visible===!1)return;if(x.layers.test(B.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&z===Mp)&&(!x.frustumCulled||n.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,x.matrixWorld);const I=e.update(x),w=x.material;if(Array.isArray(w)){const S=I.groups;for(let R=0,W=S.length;R<W;R++){const H=S[R],k=w[H.materialIndex];if(k&&k.visible){const _=f(x,I,k,E,M.near,M.far,z);i.renderBufferDirect(M,null,I,_,x,H)}}}else if(w.visible){const S=f(x,I,w,E,M.near,M.far,z);i.renderBufferDirect(M,null,I,S,x,null)}}const V=x.children;for(let I=0,w=V.length;I<w;I++)G(V[I],B,M,E,z)}}function IIe(i,e,t){const n=t.isWebGL2;function r(){let U=!1;const Fe=new _n;let Ze=null;const Ye=new _n(0,0,0,0);return{setMask:function(me){Ze!==me&&!U&&(i.colorMask(me,me,me,me),Ze=me)},setLocked:function(me){U=me},setClear:function(me,Ge,Pe,ht,wt){wt===!0&&(me*=ht,Ge*=ht,Pe*=ht),Fe.set(me,Ge,Pe,ht),Ye.equals(Fe)===!1&&(i.clearColor(me,Ge,Pe,ht),Ye.copy(Fe))},reset:function(){U=!1,Ze=null,Ye.set(-1,0,0,0)}}}function s(){let U=!1,Fe=null,Ze=null,Ye=null;return{setTest:function(me){me?Y(2929):ee(2929)},setMask:function(me){Fe!==me&&!U&&(i.depthMask(me),Fe=me)},setFunc:function(me){if(Ze!==me){if(me)switch(me){case ege:i.depthFunc(512);break;case tge:i.depthFunc(519);break;case nge:i.depthFunc(513);break;case QZ:i.depthFunc(515);break;case ige:i.depthFunc(514);break;case rge:i.depthFunc(518);break;case sge:i.depthFunc(516);break;case oge:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);Ze=me}},setLocked:function(me){U=me},setClear:function(me){Ye!==me&&(i.clearDepth(me),Ye=me)},reset:function(){U=!1,Fe=null,Ze=null,Ye=null}}}function o(){let U=!1,Fe=null,Ze=null,Ye=null,me=null,Ge=null,Pe=null,ht=null,wt=null;return{setTest:function(nt){U||(nt?Y(2960):ee(2960))},setMask:function(nt){Fe!==nt&&!U&&(i.stencilMask(nt),Fe=nt)},setFunc:function(nt,un,Et){(Ze!==nt||Ye!==un||me!==Et)&&(i.stencilFunc(nt,un,Et),Ze=nt,Ye=un,me=Et)},setOp:function(nt,un,Et){(Ge!==nt||Pe!==un||ht!==Et)&&(i.stencilOp(nt,un,Et),Ge=nt,Pe=un,ht=Et)},setLocked:function(nt){U=nt},setClear:function(nt){wt!==nt&&(i.clearStencil(nt),wt=nt)},reset:function(){U=!1,Fe=null,Ze=null,Ye=null,me=null,Ge=null,Pe=null,ht=null,wt=null}}}const a=new r,l=new s,c=new o;let g={},d={},u=new WeakMap,h=[],p=null,b=!1,y=null,m=null,f=null,G=null,x=null,B=null,M=null,E=!1,z=null,J=null,V=null,I=null,w=null;const S=i.getParameter(35661);let R=!1,W=0;const H=i.getParameter(7938);H.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(H)[1]),R=W>=1):H.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),R=W>=2);let k=null,_={};const Z=i.getParameter(3088),T=i.getParameter(2978),F=new _n().fromArray(Z),K=new _n().fromArray(T);function j(U,Fe,Ze){const Ye=new Uint8Array(4),me=i.createTexture();i.bindTexture(U,me),i.texParameteri(U,10241,9728),i.texParameteri(U,10240,9728);for(let Ge=0;Ge<Ze;Ge++)i.texImage2D(Fe+Ge,0,6408,1,1,0,6408,5121,Ye);return me}const O={};O[3553]=j(3553,3553,1),O[34067]=j(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Y(2929),l.setFunc(QZ),Ie(!1),Be(UX),Y(2884),ne(Nc);function Y(U){g[U]!==!0&&(i.enable(U),g[U]=!0)}function ee(U){g[U]!==!1&&(i.disable(U),g[U]=!1)}function ye(U,Fe){return d[U]!==Fe?(i.bindFramebuffer(U,Fe),d[U]=Fe,n&&(U===36009&&(d[36160]=Fe),U===36160&&(d[36009]=Fe)),!0):!1}function Ce(U,Fe){let Ze=h,Ye=!1;if(U)if(Ze=u.get(Fe),Ze===void 0&&(Ze=[],u.set(Fe,Ze)),U.isWebGLMultipleRenderTargets){const me=U.texture;if(Ze.length!==me.length||Ze[0]!==36064){for(let Ge=0,Pe=me.length;Ge<Pe;Ge++)Ze[Ge]=36064+Ge;Ze.length=me.length,Ye=!0}}else Ze[0]!==36064&&(Ze[0]=36064,Ye=!0);else Ze[0]!==1029&&(Ze[0]=1029,Ye=!0);Ye&&(t.isWebGL2?i.drawBuffers(Ze):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ze))}function he(U){return p!==U?(i.useProgram(U),p=U,!0):!1}const Ne={[Ph]:32774,[Yce]:32778,[Kce]:32779};if(n)Ne[$X]=32775,Ne[ez]=32776;else{const U=e.get("EXT_blend_minmax");U!==null&&(Ne[$X]=U.MIN_EXT,Ne[ez]=U.MAX_EXT)}const He={[Pce]:0,[Dce]:1,[Uce]:768,[tz]:770,[$ce]:776,[jce]:774,[Jce]:772,[Oce]:769,[nz]:771,[qce]:775,[Qce]:773};function ne(U,Fe,Ze,Ye,me,Ge,Pe,ht){if(U===Nc){b===!0&&(ee(3042),b=!1);return}if(b===!1&&(Y(3042),b=!0),U!==kce){if(U!==y||ht!==E){if((m!==Ph||x!==Ph)&&(i.blendEquation(32774),m=Ph,x=Ph),ht)switch(U){case _p:i.blendFuncSeparate(1,771,1,771);break;case QX:i.blendFunc(1,1);break;case jX:i.blendFuncSeparate(0,769,0,1);break;case qX:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}else switch(U){case _p:i.blendFuncSeparate(770,771,1,771);break;case QX:i.blendFunc(770,1);break;case jX:i.blendFuncSeparate(0,769,0,1);break;case qX:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}f=null,G=null,B=null,M=null,y=U,E=ht}return}me=me||Fe,Ge=Ge||Ze,Pe=Pe||Ye,(Fe!==m||me!==x)&&(i.blendEquationSeparate(Ne[Fe],Ne[me]),m=Fe,x=me),(Ze!==f||Ye!==G||Ge!==B||Pe!==M)&&(i.blendFuncSeparate(He[Ze],He[Ye],He[Ge],He[Pe]),f=Ze,G=Ye,B=Ge,M=Pe),y=U,E=null}function de(U,Fe){U.side===Kh?ee(2884):Y(2884);let Ze=U.side===Mi;Fe&&(Ze=!Ze),Ie(Ze),U.blending===_p&&U.transparent===!1?ne(Nc):ne(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.premultipliedAlpha),l.setFunc(U.depthFunc),l.setTest(U.depthTest),l.setMask(U.depthWrite),a.setMask(U.colorWrite);const Ye=U.stencilWrite;c.setTest(Ye),Ye&&(c.setMask(U.stencilWriteMask),c.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),c.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),Xe(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),U.alphaToCoverage===!0?Y(32926):ee(32926)}function Ie(U){z!==U&&(U?i.frontFace(2304):i.frontFace(2305),z=U)}function Be(U){U!==Tce?(Y(2884),U!==J&&(U===UX?i.cullFace(1029):U===Xce?i.cullFace(1028):i.cullFace(1032))):ee(2884),J=U}function Re(U){U!==V&&(R&&i.lineWidth(U),V=U)}function Xe(U,Fe,Ze){U?(Y(32823),(I!==Fe||w!==Ze)&&(i.polygonOffset(Fe,Ze),I=Fe,w=Ze)):ee(32823)}function Le(U){U?Y(3089):ee(3089)}function Qe(U){U===void 0&&(U=33984+S-1),k!==U&&(i.activeTexture(U),k=U)}function et(U,Fe){k===null&&Qe();let Ze=_[k];Ze===void 0&&(Ze={type:void 0,texture:void 0},_[k]=Ze),(Ze.type!==U||Ze.texture!==Fe)&&(i.bindTexture(U,Fe||O[U]),Ze.type=U,Ze.texture=Fe)}function q(){const U=_[k];U!==void 0&&U.type!==void 0&&(i.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)}function X(){try{i.compressedTexImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function D(){try{i.texSubImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ge(){try{i.texSubImage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Se(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Me(){try{i.texStorage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function pe(){try{i.texStorage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function we(){try{i.texImage2D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function re(){try{i.texImage3D.apply(i,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function be(U){F.equals(U)===!1&&(i.scissor(U.x,U.y,U.z,U.w),F.copy(U))}function _e(U){K.equals(U)===!1&&(i.viewport(U.x,U.y,U.z,U.w),K.copy(U))}function Ee(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),g={},k=null,_={},d={},u=new WeakMap,h=[],p=null,b=!1,y=null,m=null,f=null,G=null,x=null,B=null,M=null,E=!1,z=null,J=null,V=null,I=null,w=null,F.set(0,0,i.canvas.width,i.canvas.height),K.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:Y,disable:ee,bindFramebuffer:ye,drawBuffers:Ce,useProgram:he,setBlending:ne,setMaterial:de,setFlipSided:Ie,setCullFace:Be,setLineWidth:Re,setPolygonOffset:Xe,setScissorTest:Le,activeTexture:Qe,bindTexture:et,unbindTexture:q,compressedTexImage2D:X,texImage2D:we,texImage3D:re,texStorage2D:Me,texStorage3D:pe,texSubImage2D:D,texSubImage3D:ge,compressedTexSubImage2D:Se,scissor:be,viewport:_e,reset:Ee}}function CIe(i,e,t,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,g=r.maxTextureSize,d=r.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,p=new WeakMap;let b,y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(X,D){return y?new OffscreenCanvas(X,D):Lp("canvas")}function f(X,D,ge,Se){let Me=1;if((X.width>Se||X.height>Se)&&(Me=Se/Math.max(X.width,X.height)),Me<1||D===!0)if(typeof HTMLImageElement!="undefined"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&X instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&X instanceof ImageBitmap){const pe=D?Tge:Math.floor,we=pe(Me*X.width),re=pe(Me*X.height);b===void 0&&(b=m(we,re));const be=ge?m(we,re):b;return be.width=we,be.height=re,be.getContext("2d").drawImage(X,0,0,we,re),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+X.width+"x"+X.height+") to ("+we+"x"+re+")."),be}else return"data"in X&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+X.width+"x"+X.height+")."),X;return X}function G(X){return Rz(X.width)&&Rz(X.height)}function x(X){return a?!1:X.wrapS!==Gs||X.wrapT!==Gs||X.minFilter!==Wi&&X.minFilter!==vr}function B(X,D){return X.generateMipmaps&&D&&X.minFilter!==Wi&&X.minFilter!==vr}function M(X){i.generateMipmap(X)}function E(X,D,ge,Se,Me=!1){if(a===!1)return D;if(X!==null){if(i[X]!==void 0)return i[X];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+X+"'")}let pe=D;return D===6403&&(ge===5126&&(pe=33326),ge===5131&&(pe=33325),ge===5121&&(pe=33321)),D===33319&&(ge===5126&&(pe=33328),ge===5131&&(pe=33327),ge===5121&&(pe=33323)),D===6408&&(ge===5126&&(pe=34836),ge===5131&&(pe=34842),ge===5121&&(pe=Se===On&&Me===!1?35907:32856),ge===32819&&(pe=32854),ge===32820&&(pe=32855)),(pe===33325||pe===33326||pe===33327||pe===33328||pe===34842||pe===34836)&&e.get("EXT_color_buffer_float"),pe}function z(X,D,ge){return B(X,ge)===!0||X.isFramebufferTexture&&X.minFilter!==Wi&&X.minFilter!==vr?Math.log2(Math.max(D.width,D.height))+1:X.mipmaps!==void 0&&X.mipmaps.length>0?X.mipmaps.length:X.isCompressedTexture&&Array.isArray(X.image)?D.mipmaps.length:1}function J(X){return X===Wi||X===rz||X===sz?9728:9729}function V(X){const D=X.target;D.removeEventListener("dispose",V),w(D),D.isVideoTexture&&p.delete(D),o.memory.textures--}function I(X){const D=X.target;D.removeEventListener("dispose",I),S(D)}function w(X){const D=n.get(X);D.__webglInit!==void 0&&(i.deleteTexture(D.__webglTexture),n.remove(X))}function S(X){const D=X.texture,ge=n.get(X),Se=n.get(D);if(!!X){if(Se.__webglTexture!==void 0&&(i.deleteTexture(Se.__webglTexture),o.memory.textures--),X.depthTexture&&X.depthTexture.dispose(),X.isWebGLCubeRenderTarget)for(let Me=0;Me<6;Me++)i.deleteFramebuffer(ge.__webglFramebuffer[Me]),ge.__webglDepthbuffer&&i.deleteRenderbuffer(ge.__webglDepthbuffer[Me]);else i.deleteFramebuffer(ge.__webglFramebuffer),ge.__webglDepthbuffer&&i.deleteRenderbuffer(ge.__webglDepthbuffer),ge.__webglMultisampledFramebuffer&&i.deleteFramebuffer(ge.__webglMultisampledFramebuffer),ge.__webglColorRenderbuffer&&i.deleteRenderbuffer(ge.__webglColorRenderbuffer),ge.__webglDepthRenderbuffer&&i.deleteRenderbuffer(ge.__webglDepthRenderbuffer);if(X.isWebGLMultipleRenderTargets)for(let Me=0,pe=D.length;Me<pe;Me++){const we=n.get(D[Me]);we.__webglTexture&&(i.deleteTexture(we.__webglTexture),o.memory.textures--),n.remove(D[Me])}n.remove(D),n.remove(X)}}let R=0;function W(){R=0}function H(){const X=R;return X>=l&&console.warn("THREE.WebGLTextures: Trying to use "+X+" texture units while this GPU supports only "+l),R+=1,X}function k(X,D){const ge=n.get(X);if(X.isVideoTexture&&Re(X),X.version>0&&ge.__version!==X.version){const Se=X.image;if(Se===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Se.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Y(ge,X,D);return}}t.activeTexture(33984+D),t.bindTexture(3553,ge.__webglTexture)}function _(X,D){const ge=n.get(X);if(X.version>0&&ge.__version!==X.version){Y(ge,X,D);return}t.activeTexture(33984+D),t.bindTexture(35866,ge.__webglTexture)}function Z(X,D){const ge=n.get(X);if(X.version>0&&ge.__version!==X.version){Y(ge,X,D);return}t.activeTexture(33984+D),t.bindTexture(32879,ge.__webglTexture)}function T(X,D){const ge=n.get(X);if(X.version>0&&ge.__version!==X.version){ee(ge,X,D);return}t.activeTexture(33984+D),t.bindTexture(34067,ge.__webglTexture)}const F={[e3]:10497,[Gs]:33071,[t3]:33648},K={[Wi]:9728,[rz]:9984,[sz]:9986,[vr]:9729,[fge]:9985,[iv]:9987};function j(X,D,ge){if(ge?(i.texParameteri(X,10242,F[D.wrapS]),i.texParameteri(X,10243,F[D.wrapT]),(X===32879||X===35866)&&i.texParameteri(X,32882,F[D.wrapR]),i.texParameteri(X,10240,K[D.magFilter]),i.texParameteri(X,10241,K[D.minFilter])):(i.texParameteri(X,10242,33071),i.texParameteri(X,10243,33071),(X===32879||X===35866)&&i.texParameteri(X,32882,33071),(D.wrapS!==Gs||D.wrapT!==Gs)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(X,10240,J(D.magFilter)),i.texParameteri(X,10241,J(D.minFilter)),D.minFilter!==Wi&&D.minFilter!==vr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Se=e.get("EXT_texture_filter_anisotropic");if(D.type===mu&&e.has("OES_texture_float_linear")===!1||a===!1&&D.type===Dh&&e.has("OES_texture_half_float_linear")===!1)return;(D.anisotropy>1||n.get(D).__currentAnisotropy)&&(i.texParameterf(X,Se.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,r.getMaxAnisotropy())),n.get(D).__currentAnisotropy=D.anisotropy)}}function O(X,D){X.__webglInit===void 0&&(X.__webglInit=!0,D.addEventListener("dispose",V),X.__webglTexture=i.createTexture(),o.memory.textures++)}function Y(X,D,ge){let Se=3553;D.isDataTexture2DArray&&(Se=35866),D.isDataTexture3D&&(Se=32879),O(X,D),t.activeTexture(33984+ge),t.bindTexture(Se,X.__webglTexture),i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);const Me=x(D)&&G(D.image)===!1;let pe=f(D.image,Me,!1,g);pe=Xe(D,pe);const we=G(pe)||a,re=s.convert(D.format,D.encoding);let be=s.convert(D.type),_e=E(D.internalFormat,re,be,D.encoding,D.isVideoTexture);j(Se,D,we);let Ee;const U=D.mipmaps,Fe=a&&D.isVideoTexture!==!0,Ze=X.__version===void 0,Ye=z(D,pe,we);if(D.isDepthTexture)_e=6402,a?D.type===mu?_e=36012:D.type===rv?_e=33190:D.type===Uh?_e=35056:_e=33189:D.type===mu&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===Au&&_e===6402&&D.type!==Ep&&D.type!==rv&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=Ep,be=s.convert(D.type)),D.format===Oh&&_e===6402&&(_e=34041,D.type!==Uh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Uh,be=s.convert(D.type))),Fe&&Ze?t.texStorage2D(3553,1,_e,pe.width,pe.height):t.texImage2D(3553,0,_e,pe.width,pe.height,0,re,be,null);else if(D.isDataTexture)if(U.length>0&&we){Fe&&Ze&&t.texStorage2D(3553,Ye,_e,U[0].width,U[0].height);for(let me=0,Ge=U.length;me<Ge;me++)Ee=U[me],Fe?t.texSubImage2D(3553,0,0,0,Ee.width,Ee.height,re,be,Ee.data):t.texImage2D(3553,me,_e,Ee.width,Ee.height,0,re,be,Ee.data);D.generateMipmaps=!1}else Fe?(Ze&&t.texStorage2D(3553,Ye,_e,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,pe.width,pe.height,re,be,pe.data)):t.texImage2D(3553,0,_e,pe.width,pe.height,0,re,be,pe.data);else if(D.isCompressedTexture){Fe&&Ze&&t.texStorage2D(3553,Ye,_e,U[0].width,U[0].height);for(let me=0,Ge=U.length;me<Ge;me++)Ee=U[me],D.format!==Tr?re!==null?Fe?t.compressedTexSubImage2D(3553,me,0,0,Ee.width,Ee.height,re,Ee.data):t.compressedTexImage2D(3553,me,_e,Ee.width,Ee.height,0,Ee.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fe?t.texSubImage2D(3553,me,0,0,Ee.width,Ee.height,re,be,Ee.data):t.texImage2D(3553,me,_e,Ee.width,Ee.height,0,re,be,Ee.data)}else if(D.isDataTexture2DArray)Fe?(Ze&&t.texStorage3D(35866,Ye,_e,pe.width,pe.height,pe.depth),t.texSubImage3D(35866,0,0,0,0,pe.width,pe.height,pe.depth,re,be,pe.data)):t.texImage3D(35866,0,_e,pe.width,pe.height,pe.depth,0,re,be,pe.data);else if(D.isDataTexture3D)Fe?(Ze&&t.texStorage3D(32879,Ye,_e,pe.width,pe.height,pe.depth),t.texSubImage3D(32879,0,0,0,0,pe.width,pe.height,pe.depth,re,be,pe.data)):t.texImage3D(32879,0,_e,pe.width,pe.height,pe.depth,0,re,be,pe.data);else if(D.isFramebufferTexture)Fe&&Ze?t.texStorage2D(3553,Ye,_e,pe.width,pe.height):t.texImage2D(3553,0,_e,pe.width,pe.height,0,re,be,null);else if(U.length>0&&we){Fe&&Ze&&t.texStorage2D(3553,Ye,_e,U[0].width,U[0].height);for(let me=0,Ge=U.length;me<Ge;me++)Ee=U[me],Fe?t.texSubImage2D(3553,me,0,0,re,be,Ee):t.texImage2D(3553,me,_e,re,be,Ee);D.generateMipmaps=!1}else Fe?(Ze&&t.texStorage2D(3553,Ye,_e,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,re,be,pe)):t.texImage2D(3553,0,_e,re,be,pe);B(D,we)&&M(Se),X.__version=D.version,D.onUpdate&&D.onUpdate(D)}function ee(X,D,ge){if(D.image.length!==6)return;O(X,D),t.activeTexture(33984+ge),t.bindTexture(34067,X.__webglTexture),i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);const Se=D&&(D.isCompressedTexture||D.image[0].isCompressedTexture),Me=D.image[0]&&D.image[0].isDataTexture,pe=[];for(let me=0;me<6;me++)!Se&&!Me?pe[me]=f(D.image[me],!1,!0,c):pe[me]=Me?D.image[me].image:D.image[me],pe[me]=Xe(D,pe[me]);const we=pe[0],re=G(we)||a,be=s.convert(D.format,D.encoding),_e=s.convert(D.type),Ee=E(D.internalFormat,be,_e,D.encoding),U=a&&D.isVideoTexture!==!0,Fe=X.__version===void 0;let Ze=z(D,we,re);j(34067,D,re);let Ye;if(Se){U&&Fe&&t.texStorage2D(34067,Ze,Ee,we.width,we.height);for(let me=0;me<6;me++){Ye=pe[me].mipmaps;for(let Ge=0;Ge<Ye.length;Ge++){const Pe=Ye[Ge];D.format!==Tr?be!==null?U?t.compressedTexSubImage2D(34069+me,Ge,0,0,Pe.width,Pe.height,be,Pe.data):t.compressedTexImage2D(34069+me,Ge,Ee,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):U?t.texSubImage2D(34069+me,Ge,0,0,Pe.width,Pe.height,be,_e,Pe.data):t.texImage2D(34069+me,Ge,Ee,Pe.width,Pe.height,0,be,_e,Pe.data)}}}else{Ye=D.mipmaps,U&&Fe&&(Ye.length>0&&Ze++,t.texStorage2D(34067,Ze,Ee,pe[0].width,pe[0].height));for(let me=0;me<6;me++)if(Me){U?t.texSubImage2D(34069+me,0,0,0,pe[me].width,pe[me].height,be,_e,pe[me].data):t.texImage2D(34069+me,0,Ee,pe[me].width,pe[me].height,0,be,_e,pe[me].data);for(let Ge=0;Ge<Ye.length;Ge++){const ht=Ye[Ge].image[me].image;U?t.texSubImage2D(34069+me,Ge+1,0,0,ht.width,ht.height,be,_e,ht.data):t.texImage2D(34069+me,Ge+1,Ee,ht.width,ht.height,0,be,_e,ht.data)}}else{U?t.texSubImage2D(34069+me,0,0,0,be,_e,pe[me]):t.texImage2D(34069+me,0,Ee,be,_e,pe[me]);for(let Ge=0;Ge<Ye.length;Ge++){const Pe=Ye[Ge];U?t.texSubImage2D(34069+me,Ge+1,0,0,be,_e,Pe.image[me]):t.texImage2D(34069+me,Ge+1,Ee,be,_e,Pe.image[me])}}}B(D,re)&&M(34067),X.__version=D.version,D.onUpdate&&D.onUpdate(D)}function ye(X,D,ge,Se,Me){const pe=s.convert(ge.format,ge.encoding),we=s.convert(ge.type),re=E(ge.internalFormat,pe,we,ge.encoding);n.get(D).__hasExternalTextures||(Me===32879||Me===35866?t.texImage3D(Me,0,re,D.width,D.height,D.depth,0,pe,we,null):t.texImage2D(Me,0,re,D.width,D.height,0,pe,we,null)),t.bindFramebuffer(36160,X),D.useRenderToTexture?h.framebufferTexture2DMultisampleEXT(36160,Se,Me,n.get(ge).__webglTexture,0,Be(D)):i.framebufferTexture2D(36160,Se,Me,n.get(ge).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ce(X,D,ge){if(i.bindRenderbuffer(36161,X),D.depthBuffer&&!D.stencilBuffer){let Se=33189;if(ge||D.useRenderToTexture){const Me=D.depthTexture;Me&&Me.isDepthTexture&&(Me.type===mu?Se=36012:Me.type===rv&&(Se=33190));const pe=Be(D);D.useRenderToTexture?h.renderbufferStorageMultisampleEXT(36161,pe,Se,D.width,D.height):i.renderbufferStorageMultisample(36161,pe,Se,D.width,D.height)}else i.renderbufferStorage(36161,Se,D.width,D.height);i.framebufferRenderbuffer(36160,36096,36161,X)}else if(D.depthBuffer&&D.stencilBuffer){const Se=Be(D);ge&&D.useRenderbuffer?i.renderbufferStorageMultisample(36161,Se,35056,D.width,D.height):D.useRenderToTexture?h.renderbufferStorageMultisampleEXT(36161,Se,35056,D.width,D.height):i.renderbufferStorage(36161,34041,D.width,D.height),i.framebufferRenderbuffer(36160,33306,36161,X)}else{const Se=D.isWebGLMultipleRenderTargets===!0?D.texture[0]:D.texture,Me=s.convert(Se.format,Se.encoding),pe=s.convert(Se.type),we=E(Se.internalFormat,Me,pe,Se.encoding),re=Be(D);ge&&D.useRenderbuffer?i.renderbufferStorageMultisample(36161,re,we,D.width,D.height):D.useRenderToTexture?h.renderbufferStorageMultisampleEXT(36161,re,we,D.width,D.height):i.renderbufferStorage(36161,we,D.width,D.height)}i.bindRenderbuffer(36161,null)}function he(X,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,X),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),k(D.depthTexture,0);const Se=n.get(D.depthTexture).__webglTexture,Me=Be(D);if(D.depthTexture.format===Au)D.useRenderToTexture?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,Se,0,Me):i.framebufferTexture2D(36160,36096,3553,Se,0);else if(D.depthTexture.format===Oh)D.useRenderToTexture?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,Se,0,Me):i.framebufferTexture2D(36160,33306,3553,Se,0);else throw new Error("Unknown depthTexture format")}function Ne(X){const D=n.get(X),ge=X.isWebGLCubeRenderTarget===!0;if(X.depthTexture&&!D.__autoAllocateDepthBuffer){if(ge)throw new Error("target.depthTexture not supported in Cube render targets");he(D.__webglFramebuffer,X)}else if(ge){D.__webglDepthbuffer=[];for(let Se=0;Se<6;Se++)t.bindFramebuffer(36160,D.__webglFramebuffer[Se]),D.__webglDepthbuffer[Se]=i.createRenderbuffer(),Ce(D.__webglDepthbuffer[Se],X,!1)}else t.bindFramebuffer(36160,D.__webglFramebuffer),D.__webglDepthbuffer=i.createRenderbuffer(),Ce(D.__webglDepthbuffer,X,!1);t.bindFramebuffer(36160,null)}function He(X,D,ge){const Se=n.get(X);D!==void 0&&ye(Se.__webglFramebuffer,X,X.texture,36064,3553),ge!==void 0&&Ne(X)}function ne(X){const D=X.texture,ge=n.get(X),Se=n.get(D);X.addEventListener("dispose",I),X.isWebGLMultipleRenderTargets!==!0&&(Se.__webglTexture===void 0&&(Se.__webglTexture=i.createTexture()),Se.__version=D.version,o.memory.textures++);const Me=X.isWebGLCubeRenderTarget===!0,pe=X.isWebGLMultipleRenderTargets===!0,we=D.isDataTexture3D||D.isDataTexture2DArray,re=G(X)||a;if(Me){ge.__webglFramebuffer=[];for(let be=0;be<6;be++)ge.__webglFramebuffer[be]=i.createFramebuffer()}else if(ge.__webglFramebuffer=i.createFramebuffer(),pe)if(r.drawBuffers){const be=X.texture;for(let _e=0,Ee=be.length;_e<Ee;_e++){const U=n.get(be[_e]);U.__webglTexture===void 0&&(U.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(X.useRenderbuffer)if(a){ge.__webglMultisampledFramebuffer=i.createFramebuffer(),ge.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,ge.__webglColorRenderbuffer);const be=s.convert(D.format,D.encoding),_e=s.convert(D.type),Ee=E(D.internalFormat,be,_e,D.encoding),U=Be(X);i.renderbufferStorageMultisample(36161,U,Ee,X.width,X.height),t.bindFramebuffer(36160,ge.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,ge.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),X.depthBuffer&&(ge.__webglDepthRenderbuffer=i.createRenderbuffer(),Ce(ge.__webglDepthRenderbuffer,X,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Me){t.bindTexture(34067,Se.__webglTexture),j(34067,D,re);for(let be=0;be<6;be++)ye(ge.__webglFramebuffer[be],X,D,36064,34069+be);B(D,re)&&M(34067),t.unbindTexture()}else if(pe){const be=X.texture;for(let _e=0,Ee=be.length;_e<Ee;_e++){const U=be[_e],Fe=n.get(U);t.bindTexture(3553,Fe.__webglTexture),j(3553,U,re),ye(ge.__webglFramebuffer,X,U,36064+_e,3553),B(U,re)&&M(3553)}t.unbindTexture()}else{let be=3553;we&&(a?be=D.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(be,Se.__webglTexture),j(be,D,re),ye(ge.__webglFramebuffer,X,D,36064,be),B(D,re)&&M(be),t.unbindTexture()}X.depthBuffer&&Ne(X)}function de(X){const D=G(X)||a,ge=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let Se=0,Me=ge.length;Se<Me;Se++){const pe=ge[Se];if(B(pe,D)){const we=X.isWebGLCubeRenderTarget?34067:3553,re=n.get(pe).__webglTexture;t.bindTexture(we,re),M(we),t.unbindTexture()}}}function Ie(X){if(X.useRenderbuffer)if(a){const D=X.width,ge=X.height;let Se=16384;const Me=[36064],pe=X.stencilBuffer?33306:36096;X.depthBuffer&&Me.push(pe),X.ignoreDepthForMultisampleCopy||(X.depthBuffer&&(Se|=256),X.stencilBuffer&&(Se|=1024));const we=n.get(X);t.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,we.__webglFramebuffer),X.ignoreDepthForMultisampleCopy&&(i.invalidateFramebuffer(36008,[pe]),i.invalidateFramebuffer(36009,[pe])),i.blitFramebuffer(0,0,D,ge,0,0,D,ge,Se,9728),i.invalidateFramebuffer(36008,Me),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Be(X){return a&&(X.useRenderbuffer||X.useRenderToTexture)?Math.min(d,X.samples):0}function Re(X){const D=o.render.frame;p.get(X)!==D&&(p.set(X,D),X.update())}function Xe(X,D){const ge=X.encoding,Se=X.format,Me=X.type;return X.isCompressedTexture===!0||X.isVideoTexture===!0||X.format===c3||ge!==Fc&&(ge===On?a===!1?e.has("EXT_sRGB")===!0&&Se===Tr?(X.format=c3,X.minFilter=vr,X.generateMipmaps=!1):D=yu.sRGBToLinear(D):(Se!==Tr||Me!==Hc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ge)),D}let Le=!1,Qe=!1;function et(X,D){X&&X.isWebGLRenderTarget&&(Le===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Le=!0),X=X.texture),k(X,D)}function q(X,D){X&&X.isWebGLCubeRenderTarget&&(Qe===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Qe=!0),X=X.texture),T(X,D)}this.allocateTextureUnit=H,this.resetTextureUnits=W,this.setTexture2D=k,this.setTexture2DArray=_,this.setTexture3D=Z,this.setTextureCube=T,this.rebindTextures=He,this.setupRenderTarget=ne,this.updateRenderTargetMipmap=de,this.updateMultisampleRenderTarget=Ie,this.setupDepthRenderbuffer=Ne,this.setupFrameBufferTexture=ye,this.safeSetTexture2D=et,this.safeSetTextureCube=q}function pIe(i,e,t){const n=t.isWebGL2;function r(s,o=null){let a;if(s===Hc)return 5121;if(s===mge)return 32819;if(s===Age)return 32820;if(s===Ige)return 5120;if(s===Cge)return 5122;if(s===Ep)return 5123;if(s===pge)return 5124;if(s===rv)return 5125;if(s===mu)return 5126;if(s===Dh)return n?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===bge)return 6406;if(s===Tr)return 6408;if(s===vge)return 6409;if(s===xge)return 6410;if(s===Au)return 6402;if(s===Oh)return 34041;if(s===wge)return 6403;if(s===yge)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===c3)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===Gge)return 36244;if(s===Bge)return 33319;if(s===Sge)return 33320;if(s===Zge)return 36249;if(s===n3||s===i3||s===r3||s===s3)if(o===On)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===n3)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===i3)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===r3)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===s3)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===n3)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===i3)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===r3)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===s3)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===oz||s===az||s===lz||s===cz)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===oz)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===az)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===lz)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===cz)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Rge)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===gz||s===uz)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===gz)return o===On?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===uz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===dz||s===hz||s===fz||s===Iz||s===Cz||s===pz||s===mz||s===Az||s===bz||s===yz||s===vz||s===xz||s===wz||s===Gz)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===dz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===hz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===fz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Iz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Cz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===pz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===mz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===Az)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===bz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===yz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===vz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===xz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===wz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===Gz)return o===On?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Bz)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===Bz)return o===On?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Uh)return n?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}class Mk extends ls{constructor(e=[]){super();this.cameras=e}}Mk.prototype.isArrayCamera=!0;class Pp extends fn{constructor(){super();this.type="Group"}}Pp.prototype.isGroup=!0;const mIe={type:"move"};class D3{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Pp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Pp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Pp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(r=t.getPose(e.targetRaySpace,n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(mIe))),c&&e.hand){o=!0;for(const b of e.hand.values()){const y=t.getJointPose(b,n);if(c.joints[b.jointName]===void 0){const f=new Pp;f.matrixAutoUpdate=!1,f.visible=!1,c.joints[b.jointName]=f,c.add(f)}const m=c.joints[b.jointName];y!==null&&(m.matrix.fromArray(y.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=y.radius),m.visible=y!==null}const g=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],u=g.position.distanceTo(d.position),h=.02,p=.005;c.inputState.pinching&&u>h+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&u<=h-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}}class U3 extends Xi{constructor(e,t,n,r,s,o,a,l,c,g){if(g=g!==void 0?g:Au,g!==Au&&g!==Oh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&g===Au&&(n=Ep),n===void 0&&g===Oh&&(n=Uh);super(null,r,s,o,a,l,g,n,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:Wi,this.minFilter=l!==void 0?l:Wi,this.flipY=!1,this.generateMipmaps=!1}}U3.prototype.isDepthTexture=!0;class AIe extends bu{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor";const l=e.extensions.has("WEBGL_multisampled_render_to_texture");let c=null,g=null,d=null,u=null,h=!1,p=null;const b=t.getContextAttributes();let y=null,m=null;const f=[],G=new Map,x=new ls;x.layers.enable(1),x.viewport=new _n;const B=new ls;B.layers.enable(2),B.viewport=new _n;const M=[x,B],E=new Mk;E.layers.enable(1),E.layers.enable(2);let z=null,J=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(T){let F=f[T];return F===void 0&&(F=new D3,f[T]=F),F.getTargetRaySpace()},this.getControllerGrip=function(T){let F=f[T];return F===void 0&&(F=new D3,f[T]=F),F.getGripSpace()},this.getHand=function(T){let F=f[T];return F===void 0&&(F=new D3,f[T]=F),F.getHandSpace()};function V(T){const F=G.get(T.inputSource);F&&F.dispatchEvent({type:T.type,data:T.inputSource})}function I(){G.forEach(function(T,F){T.disconnect(F)}),G.clear(),z=null,J=null,e.setRenderTarget(y),u=null,d=null,g=null,r=null,m=null,Z.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(T){s=T,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(T){a=T,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return d!==null?d:u},this.getBinding=function(){return g},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(T){if(r=T,r!==null){if(y=e.getRenderTarget(),r.addEventListener("select",V),r.addEventListener("selectstart",V),r.addEventListener("selectend",V),r.addEventListener("squeeze",V),r.addEventListener("squeezestart",V),r.addEventListener("squeezeend",V),r.addEventListener("end",I),r.addEventListener("inputsourceschange",w),b.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const F={antialias:r.renderState.layers===void 0?b.antialias:!0,alpha:b.alpha,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};u=new XRWebGLLayer(r,t,F),r.updateRenderState({baseLayer:u}),m=new qs(u.framebufferWidth,u.framebufferHeight,{format:Tr,type:Hc,encoding:e.outputEncoding})}else{h=b.antialias;let F=null,K=null,j=null;b.depth&&(j=b.stencil?35056:33190,F=b.stencil?Oh:Au,K=b.stencil?Uh:Ep);const O={colorFormat:e.outputEncoding===On?35907:32856,depthFormat:j,scaleFactor:s};g=new XRWebGLBinding(r,t),d=g.createProjectionLayer(O),r.updateRenderState({layers:[d]}),h?m=new C3(d.textureWidth,d.textureHeight,{format:Tr,type:Hc,depthTexture:new U3(d.textureWidth,d.textureHeight,K,void 0,void 0,void 0,void 0,void 0,void 0,F),stencilBuffer:b.stencil,ignoreDepth:d.ignoreDepthValues,useRenderToTexture:l,encoding:e.outputEncoding}):m=new qs(d.textureWidth,d.textureHeight,{format:Tr,type:Hc,depthTexture:new U3(d.textureWidth,d.textureHeight,K,void 0,void 0,void 0,void 0,void 0,void 0,F),stencilBuffer:b.stencil,ignoreDepth:d.ignoreDepthValues,encoding:e.outputEncoding})}m.isXRRenderTarget=!0,this.setFoveation(1),o=await r.requestReferenceSpace(a),Z.setContext(r),Z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function w(T){const F=r.inputSources;for(let K=0;K<f.length;K++)G.set(F[K],f[K]);for(let K=0;K<T.removed.length;K++){const j=T.removed[K],O=G.get(j);O&&(O.dispatchEvent({type:"disconnected",data:j}),G.delete(j))}for(let K=0;K<T.added.length;K++){const j=T.added[K],O=G.get(j);O&&O.dispatchEvent({type:"connected",data:j})}}const S=new fe,R=new fe;function W(T,F,K){S.setFromMatrixPosition(F.matrixWorld),R.setFromMatrixPosition(K.matrixWorld);const j=S.distanceTo(R),O=F.projectionMatrix.elements,Y=K.projectionMatrix.elements,ee=O[14]/(O[10]-1),ye=O[14]/(O[10]+1),Ce=(O[9]+1)/O[5],he=(O[9]-1)/O[5],Ne=(O[8]-1)/O[0],He=(Y[8]+1)/Y[0],ne=ee*Ne,de=ee*He,Ie=j/(-Ne+He),Be=Ie*-Ne;F.matrixWorld.decompose(T.position,T.quaternion,T.scale),T.translateX(Be),T.translateZ(Ie),T.matrixWorld.compose(T.position,T.quaternion,T.scale),T.matrixWorldInverse.copy(T.matrixWorld).invert();const Re=ee+Ie,Xe=ye+Ie,Le=ne-Be,Qe=de+(j-Be),et=Ce*ye/Xe*Re,q=he*ye/Xe*Re;T.projectionMatrix.makePerspective(Le,Qe,et,q,Re,Xe)}function H(T,F){F===null?T.matrixWorld.copy(T.matrix):T.matrixWorld.multiplyMatrices(F.matrixWorld,T.matrix),T.matrixWorldInverse.copy(T.matrixWorld).invert()}this.updateCamera=function(T){if(r===null)return;E.near=B.near=x.near=T.near,E.far=B.far=x.far=T.far,(z!==E.near||J!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),z=E.near,J=E.far);const F=T.parent,K=E.cameras;H(E,F);for(let O=0;O<K.length;O++)H(K[O],F);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),T.position.copy(E.position),T.quaternion.copy(E.quaternion),T.scale.copy(E.scale),T.matrix.copy(E.matrix),T.matrixWorld.copy(E.matrixWorld);const j=T.children;for(let O=0,Y=j.length;O<Y;O++)j[O].updateMatrixWorld(!0);K.length===2?W(E,x,B):E.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(u!==null)return u.fixedFoveation},this.setFoveation=function(T){d!==null&&(d.fixedFoveation=T),u!==null&&u.fixedFoveation!==void 0&&(u.fixedFoveation=T)};let k=null;function _(T,F){if(c=F.getViewerPose(o),p=F,c!==null){const j=c.views;u!==null&&(e.setRenderTargetFramebuffer(m,u.framebuffer),e.setRenderTarget(m));let O=!1;j.length!==E.cameras.length&&(E.cameras.length=0,O=!0);for(let Y=0;Y<j.length;Y++){const ee=j[Y];let ye=null;if(u!==null)ye=u.getViewport(ee);else{const he=g.getViewSubImage(d,ee);ye=he.viewport,Y===0&&(e.setRenderTargetTextures(m,he.colorTexture,d.ignoreDepthValues?void 0:he.depthStencilTexture),e.setRenderTarget(m))}const Ce=M[Y];Ce.matrix.fromArray(ee.transform.matrix),Ce.projectionMatrix.fromArray(ee.projectionMatrix),Ce.viewport.set(ye.x,ye.y,ye.width,ye.height),Y===0&&E.matrix.copy(Ce.matrix),O===!0&&E.cameras.push(Ce)}}const K=r.inputSources;for(let j=0;j<f.length;j++){const O=f[j],Y=K[j];O.update(Y,F,o)}k&&k(T,F),p=null}const Z=new Uz;Z.setAnimationLoop(_),this.setAnimationLoop=function(T){k=T},this.dispose=function(){}}}function bIe(i){function e(m,f){m.fogColor.value.copy(f.color),f.isFog?(m.fogNear.value=f.near,m.fogFar.value=f.far):f.isFogExp2&&(m.fogDensity.value=f.density)}function t(m,f,G,x,B){f.isMeshBasicMaterial?n(m,f):f.isMeshLambertMaterial?(n(m,f),l(m,f)):f.isMeshToonMaterial?(n(m,f),g(m,f)):f.isMeshPhongMaterial?(n(m,f),c(m,f)):f.isMeshStandardMaterial?(n(m,f),f.isMeshPhysicalMaterial?u(m,f,B):d(m,f)):f.isMeshMatcapMaterial?(n(m,f),h(m,f)):f.isMeshDepthMaterial?(n(m,f),p(m,f)):f.isMeshDistanceMaterial?(n(m,f),b(m,f)):f.isMeshNormalMaterial?(n(m,f),y(m,f)):f.isLineBasicMaterial?(r(m,f),f.isLineDashedMaterial&&s(m,f)):f.isPointsMaterial?o(m,f,G,x):f.isSpriteMaterial?a(m,f):f.isShadowMaterial?(m.color.value.copy(f.color),m.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function n(m,f){m.opacity.value=f.opacity,f.color&&m.diffuse.value.copy(f.color),f.emissive&&m.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.specularMap&&(m.specularMap.value=f.specularMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);const G=i.get(f).envMap;G&&(m.envMap.value=G,m.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=f.reflectivity,m.ior.value=f.ior,m.refractionRatio.value=f.refractionRatio),f.lightMap&&(m.lightMap.value=f.lightMap,m.lightMapIntensity.value=f.lightMapIntensity),f.aoMap&&(m.aoMap.value=f.aoMap,m.aoMapIntensity.value=f.aoMapIntensity);let x;f.map?x=f.map:f.specularMap?x=f.specularMap:f.displacementMap?x=f.displacementMap:f.normalMap?x=f.normalMap:f.bumpMap?x=f.bumpMap:f.roughnessMap?x=f.roughnessMap:f.metalnessMap?x=f.metalnessMap:f.alphaMap?x=f.alphaMap:f.emissiveMap?x=f.emissiveMap:f.clearcoatMap?x=f.clearcoatMap:f.clearcoatNormalMap?x=f.clearcoatNormalMap:f.clearcoatRoughnessMap?x=f.clearcoatRoughnessMap:f.specularIntensityMap?x=f.specularIntensityMap:f.specularColorMap?x=f.specularColorMap:f.transmissionMap?x=f.transmissionMap:f.thicknessMap?x=f.thicknessMap:f.sheenColorMap?x=f.sheenColorMap:f.sheenRoughnessMap&&(x=f.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix));let B;f.aoMap?B=f.aoMap:f.lightMap&&(B=f.lightMap),B!==void 0&&(B.isWebGLRenderTarget&&(B=B.texture),B.matrixAutoUpdate===!0&&B.updateMatrix(),m.uv2Transform.value.copy(B.matrix))}function r(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity}function s(m,f){m.dashSize.value=f.dashSize,m.totalSize.value=f.dashSize+f.gapSize,m.scale.value=f.scale}function o(m,f,G,x){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.size.value=f.size*G,m.scale.value=x*.5,f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);let B;f.map?B=f.map:f.alphaMap&&(B=f.alphaMap),B!==void 0&&(B.matrixAutoUpdate===!0&&B.updateMatrix(),m.uvTransform.value.copy(B.matrix))}function a(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.rotation.value=f.rotation,f.map&&(m.map.value=f.map),f.alphaMap&&(m.alphaMap.value=f.alphaMap),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);let G;f.map?G=f.map:f.alphaMap&&(G=f.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),m.uvTransform.value.copy(G.matrix))}function l(m,f){f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap)}function c(m,f){m.specular.value.copy(f.specular),m.shininess.value=Math.max(f.shininess,1e-4),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===Mi&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===Mi&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function g(m,f){f.gradientMap&&(m.gradientMap.value=f.gradientMap),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===Mi&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===Mi&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function d(m,f){m.roughness.value=f.roughness,m.metalness.value=f.metalness,f.roughnessMap&&(m.roughnessMap.value=f.roughnessMap),f.metalnessMap&&(m.metalnessMap.value=f.metalnessMap),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===Mi&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===Mi&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),i.get(f).envMap&&(m.envMapIntensity.value=f.envMapIntensity)}function u(m,f,G){d(m,f),m.ior.value=f.ior,f.sheen>0&&(m.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),m.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(m.sheenColorMap.value=f.sheenColorMap),f.sheenRoughnessMap&&(m.sheenRoughnessMap.value=f.sheenRoughnessMap)),f.clearcoat>0&&(m.clearcoat.value=f.clearcoat,m.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(m.clearcoatMap.value=f.clearcoatMap),f.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap),f.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),m.clearcoatNormalMap.value=f.clearcoatNormalMap,f.side===Mi&&m.clearcoatNormalScale.value.negate())),f.transmission>0&&(m.transmission.value=f.transmission,m.transmissionSamplerMap.value=G.texture,m.transmissionSamplerSize.value.set(G.width,G.height),f.transmissionMap&&(m.transmissionMap.value=f.transmissionMap),m.thickness.value=f.thickness,f.thicknessMap&&(m.thicknessMap.value=f.thicknessMap),m.attenuationDistance.value=f.attenuationDistance,m.attenuationColor.value.copy(f.attenuationColor)),m.specularIntensity.value=f.specularIntensity,m.specularColor.value.copy(f.specularColor),f.specularIntensityMap&&(m.specularIntensityMap.value=f.specularIntensityMap),f.specularColorMap&&(m.specularColorMap.value=f.specularColorMap)}function h(m,f){f.matcap&&(m.matcap.value=f.matcap),f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===Mi&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===Mi&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function p(m,f){f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}function b(m,f){f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),m.referencePosition.value.copy(f.referencePosition),m.nearDistance.value=f.nearDistance,m.farDistance.value=f.farDistance}function y(m,f){f.bumpMap&&(m.bumpMap.value=f.bumpMap,m.bumpScale.value=f.bumpScale,f.side===Mi&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,m.normalScale.value.copy(f.normalScale),f.side===Mi&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function yIe(){const i=Lp("canvas");return i.style.display="block",i}function wn(i={}){const e=i.canvas!==void 0?i.canvas:yIe(),t=i.context!==void 0?i.context:null,n=i.alpha!==void 0?i.alpha:!1,r=i.depth!==void 0?i.depth:!0,s=i.stencil!==void 0?i.stencil:!0,o=i.antialias!==void 0?i.antialias:!1,a=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,l=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,c=i.powerPreference!==void 0?i.powerPreference:"default",g=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let d=null,u=null;const h=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Fc,this.physicallyCorrectLights=!1,this.toneMapping=Ec,this.toneMappingExposure=1;const b=this;let y=!1,m=0,f=0,G=null,x=-1,B=null;const M=new _n,E=new _n;let z=null,J=e.width,V=e.height,I=1,w=null,S=null;const R=new _n(0,0,J,V),W=new _n(0,0,J,V);let H=!1;const k=new Sv;let _=!1,Z=!1,T=null;const F=new Vt,K=new fe,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function O(){return G===null?I:1}let Y=t;function ee(ie,P){for(let $=0;$<ie.length;$++){const le=ie[$],ae=e.getContext(le,P);if(ae!==null)return ae}return null}try{const ie={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:g};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${JZ}`),e.addEventListener("webglcontextlost",Ee,!1),e.addEventListener("webglcontextrestored",U,!1),Y===null){const P=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&P.shift(),Y=ee(P,ie),Y===null)throw ee(P)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Y.getShaderPrecisionFormat===void 0&&(Y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ie){throw console.error("THREE.WebGLRenderer: "+ie.message),ie}let ye,Ce,he,Ne,He,ne,de,Ie,Be,Re,Xe,Le,Qe,et,q,X,D,ge,Se,Me,pe,we,re;function be(){ye=new Xhe(Y),Ce=new Nhe(Y,ye,i),ye.init(Ce),we=new pIe(Y,ye,Ce),he=new IIe(Y,ye,Ce),Ne=new Yhe(Y),He=new rIe,ne=new CIe(Y,ye,he,He,Ce,we,Ne),de=new Hhe(b),Ie=new The(b),Be=new rue(Y,Ce),re=new _he(Y,ye,Be,Ce),Re=new zhe(Y,Be,Ne,re),Xe=new Uhe(Y,Re,Be,Ne),Se=new Dhe(Y,Ce,ne),X=new Ehe(He),Le=new iIe(b,de,Ie,ye,Ce,re,X),Qe=new bIe(He),et=new oIe,q=new dIe(ye,Ce),ge=new Whe(b,de,he,Xe,n,a),D=new Rk(b,Xe,Ce),Me=new Vhe(Y,ye,Ne,Ce),pe=new khe(Y,ye,Ne,Ce),Ne.programs=Le.programs,b.capabilities=Ce,b.extensions=ye,b.properties=He,b.renderLists=et,b.shadowMap=D,b.state=he,b.info=Ne}be();const _e=new AIe(b,Y);this.xr=_e,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const ie=ye.get("WEBGL_lose_context");ie&&ie.loseContext()},this.forceContextRestore=function(){const ie=ye.get("WEBGL_lose_context");ie&&ie.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(ie){ie!==void 0&&(I=ie,this.setSize(J,V,!1))},this.getSize=function(ie){return ie.set(J,V)},this.setSize=function(ie,P,$){if(_e.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}J=ie,V=P,e.width=Math.floor(ie*I),e.height=Math.floor(P*I),$!==!1&&(e.style.width=ie+"px",e.style.height=P+"px"),this.setViewport(0,0,ie,P)},this.getDrawingBufferSize=function(ie){return ie.set(J*I,V*I).floor()},this.setDrawingBufferSize=function(ie,P,$){J=ie,V=P,I=$,e.width=Math.floor(ie*$),e.height=Math.floor(P*$),this.setViewport(0,0,ie,P)},this.getCurrentViewport=function(ie){return ie.copy(M)},this.getViewport=function(ie){return ie.copy(R)},this.setViewport=function(ie,P,$,le){ie.isVector4?R.set(ie.x,ie.y,ie.z,ie.w):R.set(ie,P,$,le),he.viewport(M.copy(R).multiplyScalar(I).floor())},this.getScissor=function(ie){return ie.copy(W)},this.setScissor=function(ie,P,$,le){ie.isVector4?W.set(ie.x,ie.y,ie.z,ie.w):W.set(ie,P,$,le),he.scissor(E.copy(W).multiplyScalar(I).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(ie){he.setScissorTest(H=ie)},this.setOpaqueSort=function(ie){w=ie},this.setTransparentSort=function(ie){S=ie},this.getClearColor=function(ie){return ie.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor.apply(ge,arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha.apply(ge,arguments)},this.clear=function(ie,P,$){let le=0;(ie===void 0||ie)&&(le|=16384),(P===void 0||P)&&(le|=256),($===void 0||$)&&(le|=1024),Y.clear(le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ee,!1),e.removeEventListener("webglcontextrestored",U,!1),et.dispose(),q.dispose(),He.dispose(),de.dispose(),Ie.dispose(),Xe.dispose(),re.dispose(),Le.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Pe),_e.removeEventListener("sessionend",ht),T&&(T.dispose(),T=null),wt.stop()};function Ee(ie){ie.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function U(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const ie=Ne.autoReset,P=D.enabled,$=D.autoUpdate,le=D.needsUpdate,ae=D.type;be(),Ne.autoReset=ie,D.enabled=P,D.autoUpdate=$,D.needsUpdate=le,D.type=ae}function Fe(ie){const P=ie.target;P.removeEventListener("dispose",Fe),Ze(P)}function Ze(ie){Ye(ie),He.remove(ie)}function Ye(ie){const P=He.get(ie).programs;P!==void 0&&(P.forEach(function($){Le.releaseProgram($)}),ie.isShaderMaterial&&Le.releaseShaderCache(ie))}this.renderBufferDirect=function(ie,P,$,le,ae,xe){P===null&&(P=j);const Je=ae.isMesh&&ae.matrixWorld.determinant()<0,De=Yr(ie,P,$,le,ae);he.setMaterial(le,Je);let Ue=$.index;const st=$.attributes.position;if(Ue===null){if(st===void 0||st.count===0)return}else if(Ue.count===0)return;let ut=1;le.wireframe===!0&&(Ue=Re.getWireframeAttribute($),ut=2),re.setup(ae,le,De,$,Ue);let ct,mt=Me;Ue!==null&&(ct=Be.get(Ue),mt=pe,mt.setIndex(ct));const Pt=Ue!==null?Ue.count:st.count,ei=$.drawRange.start*ut,Ht=$.drawRange.count*ut,Ln=xe!==null?xe.start*ut:0,kt=xe!==null?xe.count*ut:1/0,St=Math.max(ei,Ln),Yt=Math.min(Pt,ei+Ht,Ln+kt)-1,yt=Math.max(0,Yt-St+1);if(yt!==0){if(ae.isMesh)le.wireframe===!0?(he.setLineWidth(le.wireframeLinewidth*O()),mt.setMode(1)):mt.setMode(4);else if(ae.isLine){let sn=le.linewidth;sn===void 0&&(sn=1),he.setLineWidth(sn*O()),ae.isLineSegments?mt.setMode(1):ae.isLineLoop?mt.setMode(2):mt.setMode(3)}else ae.isPoints?mt.setMode(0):ae.isSprite&&mt.setMode(4);if(ae.isInstancedMesh)mt.renderInstances(St,yt,ae.count);else if($.isInstancedBufferGeometry){const sn=Math.min($.instanceCount,$._maxInstanceCount);mt.renderInstances(St,yt,sn)}else mt.render(St,yt)}},this.compile=function(ie,P){u=q.get(ie),u.init(),p.push(u),ie.traverseVisible(function($){$.isLight&&$.layers.test(P.layers)&&(u.pushLight($),$.castShadow&&u.pushShadow($))}),u.setupLights(b.physicallyCorrectLights),ie.traverse(function($){const le=$.material;if(le)if(Array.isArray(le))for(let ae=0;ae<le.length;ae++){const xe=le[ae];en(xe,ie,$)}else en(le,ie,$)}),p.pop(),u=null};let me=null;function Ge(ie){me&&me(ie)}function Pe(){wt.stop()}function ht(){wt.start()}const wt=new Uz;wt.setAnimationLoop(Ge),typeof window!="undefined"&&wt.setContext(window),this.setAnimationLoop=function(ie){me=ie,_e.setAnimationLoop(ie),ie===null?wt.stop():wt.start()},_e.addEventListener("sessionstart",Pe),_e.addEventListener("sessionend",ht),this.render=function(ie,P){if(P!==void 0&&P.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;ie.autoUpdate===!0&&ie.updateMatrixWorld(),P.parent===null&&P.updateMatrixWorld(),_e.enabled===!0&&_e.isPresenting===!0&&(_e.cameraAutoUpdate===!0&&_e.updateCamera(P),P=_e.getCamera()),ie.isScene===!0&&ie.onBeforeRender(b,ie,P,G),u=q.get(ie,p.length),u.init(),p.push(u),F.multiplyMatrices(P.projectionMatrix,P.matrixWorldInverse),k.setFromProjectionMatrix(F),Z=this.localClippingEnabled,_=X.init(this.clippingPlanes,Z,P),d=et.get(ie,h.length),d.init(),h.push(d),nt(ie,P,0,b.sortObjects),d.finish(),b.sortObjects===!0&&d.sort(w,S),_===!0&&X.beginShadows();const $=u.state.shadowsArray;if(D.render($,ie,P),_===!0&&X.endShadows(),this.info.autoReset===!0&&this.info.reset(),ge.render(d,ie),u.setupLights(b.physicallyCorrectLights),P.isArrayCamera){const le=P.cameras;for(let ae=0,xe=le.length;ae<xe;ae++){const Je=le[ae];un(d,ie,Je,Je.viewport)}}else un(d,ie,P);G!==null&&(ne.updateMultisampleRenderTarget(G),ne.updateRenderTargetMipmap(G)),ie.isScene===!0&&ie.onAfterRender(b,ie,P),he.buffers.depth.setTest(!0),he.buffers.depth.setMask(!0),he.buffers.color.setMask(!0),he.setPolygonOffset(!1),re.resetDefaultState(),x=-1,B=null,p.pop(),p.length>0?u=p[p.length-1]:u=null,h.pop(),h.length>0?d=h[h.length-1]:d=null};function nt(ie,P,$,le){if(ie.visible===!1)return;if(ie.layers.test(P.layers)){if(ie.isGroup)$=ie.renderOrder;else if(ie.isLOD)ie.autoUpdate===!0&&ie.update(P);else if(ie.isLight)u.pushLight(ie),ie.castShadow&&u.pushShadow(ie);else if(ie.isSprite){if(!ie.frustumCulled||k.intersectsSprite(ie)){le&&K.setFromMatrixPosition(ie.matrixWorld).applyMatrix4(F);const Je=Xe.update(ie),De=ie.material;De.visible&&d.push(ie,Je,De,$,K.z,null)}}else if((ie.isMesh||ie.isLine||ie.isPoints)&&(ie.isSkinnedMesh&&ie.skeleton.frame!==Ne.render.frame&&(ie.skeleton.update(),ie.skeleton.frame=Ne.render.frame),!ie.frustumCulled||k.intersectsObject(ie))){le&&K.setFromMatrixPosition(ie.matrixWorld).applyMatrix4(F);const Je=Xe.update(ie),De=ie.material;if(Array.isArray(De)){const Ue=Je.groups;for(let st=0,ut=Ue.length;st<ut;st++){const ct=Ue[st],mt=De[ct.materialIndex];mt&&mt.visible&&d.push(ie,Je,mt,$,K.z,ct)}}else De.visible&&d.push(ie,Je,De,$,K.z,null)}}const xe=ie.children;for(let Je=0,De=xe.length;Je<De;Je++)nt(xe[Je],P,$,le)}function un(ie,P,$,le){const ae=ie.opaque,xe=ie.transmissive,Je=ie.transparent;u.setupLightsView($),xe.length>0&&Et(ae,P,$),le&&he.viewport(M.copy(le)),ae.length>0&&Jt(ae,P,$),xe.length>0&&Jt(xe,P,$),Je.length>0&&Jt(Je,P,$)}function Et(ie,P,$){if(T===null){const Je=o===!0&&Ce.isWebGL2===!0?C3:qs;T=new Je(1024,1024,{generateMipmaps:!0,type:we.convert(Dh)!==null?Dh:Hc,minFilter:iv,magFilter:Wi,wrapS:Gs,wrapT:Gs,useRenderToTexture:ye.has("WEBGL_multisampled_render_to_texture")})}const le=b.getRenderTarget();b.setRenderTarget(T),b.clear();const ae=b.toneMapping;b.toneMapping=Ec,Jt(ie,P,$),b.toneMapping=ae,ne.updateMultisampleRenderTarget(T),ne.updateRenderTargetMipmap(T),b.setRenderTarget(le)}function Jt(ie,P,$){const le=P.isScene===!0?P.overrideMaterial:null;for(let ae=0,xe=ie.length;ae<xe;ae++){const Je=ie[ae],De=Je.object,Ue=Je.geometry,st=le===null?Je.material:le,ut=Je.group;De.layers.test($.layers)&&sr(De,P,$,Ue,st,ut)}}function sr(ie,P,$,le,ae,xe){ie.onBeforeRender(b,P,$,le,ae,xe),ie.modelViewMatrix.multiplyMatrices($.matrixWorldInverse,ie.matrixWorld),ie.normalMatrix.getNormalMatrix(ie.modelViewMatrix),ae.onBeforeRender(b,P,$,le,ie,xe),ae.transparent===!0&&ae.side===Kh?(ae.side=Mi,ae.needsUpdate=!0,b.renderBufferDirect($,P,le,ae,ie,xe),ae.side=Wp,ae.needsUpdate=!0,b.renderBufferDirect($,P,le,ae,ie,xe),ae.side=Kh):b.renderBufferDirect($,P,le,ae,ie,xe),ie.onAfterRender(b,P,$,le,ae,xe)}function en(ie,P,$){P.isScene!==!0&&(P=j);const le=He.get(ie),ae=u.state.lights,xe=u.state.shadowsArray,Je=ae.state.version,De=Le.getParameters(ie,ae.state,xe,P,$),Ue=Le.getProgramCacheKey(De);let st=le.programs;le.environment=ie.isMeshStandardMaterial?P.environment:null,le.fog=P.fog,le.envMap=(ie.isMeshStandardMaterial?Ie:de).get(ie.envMap||le.environment),st===void 0&&(ie.addEventListener("dispose",Fe),st=new Map,le.programs=st);let ut=st.get(Ue);if(ut!==void 0){if(le.currentProgram===ut&&le.lightsStateVersion===Je)return qt(ie,De),ut}else De.uniforms=Le.getUniforms(ie),ie.onBuild($,De,b),ie.onBeforeCompile(De,b),ut=Le.acquireProgram(De,Ue),st.set(Ue,ut),le.uniforms=De.uniforms;const ct=le.uniforms;(!ie.isShaderMaterial&&!ie.isRawShaderMaterial||ie.clipping===!0)&&(ct.clippingPlanes=X.uniform),qt(ie,De),le.needsLights=cn(ie),le.lightsStateVersion=Je,le.needsLights&&(ct.ambientLightColor.value=ae.state.ambient,ct.lightProbe.value=ae.state.probe,ct.directionalLights.value=ae.state.directional,ct.directionalLightShadows.value=ae.state.directionalShadow,ct.spotLights.value=ae.state.spot,ct.spotLightShadows.value=ae.state.spotShadow,ct.rectAreaLights.value=ae.state.rectArea,ct.ltc_1.value=ae.state.rectAreaLTC1,ct.ltc_2.value=ae.state.rectAreaLTC2,ct.pointLights.value=ae.state.point,ct.pointLightShadows.value=ae.state.pointShadow,ct.hemisphereLights.value=ae.state.hemi,ct.directionalShadowMap.value=ae.state.directionalShadowMap,ct.directionalShadowMatrix.value=ae.state.directionalShadowMatrix,ct.spotShadowMap.value=ae.state.spotShadowMap,ct.spotShadowMatrix.value=ae.state.spotShadowMatrix,ct.pointShadowMap.value=ae.state.pointShadowMap,ct.pointShadowMatrix.value=ae.state.pointShadowMatrix);const mt=ut.getUniforms(),Pt=Dc.seqWithValue(mt.seq,ct);return le.currentProgram=ut,le.uniformsList=Pt,ut}function qt(ie,P){const $=He.get(ie);$.outputEncoding=P.outputEncoding,$.instancing=P.instancing,$.skinning=P.skinning,$.morphTargets=P.morphTargets,$.morphNormals=P.morphNormals,$.morphTargetsCount=P.morphTargetsCount,$.numClippingPlanes=P.numClippingPlanes,$.numIntersection=P.numClipIntersection,$.vertexAlphas=P.vertexAlphas,$.vertexTangents=P.vertexTangents,$.toneMapping=P.toneMapping}function Yr(ie,P,$,le,ae){P.isScene!==!0&&(P=j),ne.resetTextureUnits();const xe=P.fog,Je=le.isMeshStandardMaterial?P.environment:null,De=G===null?b.outputEncoding:G.isXRRenderTarget===!0?G.texture.encoding:Fc,Ue=(le.isMeshStandardMaterial?Ie:de).get(le.envMap||Je),st=le.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,ut=!!le.normalMap&&!!$.attributes.tangent,ct=!!$.morphAttributes.position,mt=!!$.morphAttributes.normal,Pt=$.morphAttributes.position?$.morphAttributes.position.length:0,ei=le.toneMapped?b.toneMapping:Ec,Ht=He.get(le),Ln=u.state.lights;if(_===!0&&(Z===!0||ie!==B)){const Bn=ie===B&&le.id===x;X.setState(le,ie,Bn)}let kt=!1;le.version===Ht.__version?(Ht.needsLights&&Ht.lightsStateVersion!==Ln.state.version||Ht.outputEncoding!==De||ae.isInstancedMesh&&Ht.instancing===!1||!ae.isInstancedMesh&&Ht.instancing===!0||ae.isSkinnedMesh&&Ht.skinning===!1||!ae.isSkinnedMesh&&Ht.skinning===!0||Ht.envMap!==Ue||le.fog&&Ht.fog!==xe||Ht.numClippingPlanes!==void 0&&(Ht.numClippingPlanes!==X.numPlanes||Ht.numIntersection!==X.numIntersection)||Ht.vertexAlphas!==st||Ht.vertexTangents!==ut||Ht.morphTargets!==ct||Ht.morphNormals!==mt||Ht.toneMapping!==ei||Ce.isWebGL2===!0&&Ht.morphTargetsCount!==Pt)&&(kt=!0):(kt=!0,Ht.__version=le.version);let St=Ht.currentProgram;kt===!0&&(St=en(le,P,ae));let Yt=!1,yt=!1,sn=!1;const Ft=St.getUniforms(),In=Ht.uniforms;if(he.useProgram(St.program)&&(Yt=!0,yt=!0,sn=!0),le.id!==x&&(x=le.id,yt=!0),Yt||B!==ie){if(Ft.setValue(Y,"projectionMatrix",ie.projectionMatrix),Ce.logarithmicDepthBuffer&&Ft.setValue(Y,"logDepthBufFC",2/(Math.log(ie.far+1)/Math.LN2)),B!==ie&&(B=ie,yt=!0,sn=!0),le.isShaderMaterial||le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshStandardMaterial||le.envMap){const Bn=Ft.map.cameraPosition;Bn!==void 0&&Bn.setValue(Y,K.setFromMatrixPosition(ie.matrixWorld))}(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial)&&Ft.setValue(Y,"isOrthographic",ie.isOrthographicCamera===!0),(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial||le.isShadowMaterial||ae.isSkinnedMesh)&&Ft.setValue(Y,"viewMatrix",ie.matrixWorldInverse)}if(ae.isSkinnedMesh){Ft.setOptional(Y,ae,"bindMatrix"),Ft.setOptional(Y,ae,"bindMatrixInverse");const Bn=ae.skeleton;Bn&&(Ce.floatVertexTextures?(Bn.boneTexture===null&&Bn.computeBoneTexture(),Ft.setValue(Y,"boneTexture",Bn.boneTexture,ne),Ft.setValue(Y,"boneTextureSize",Bn.boneTextureSize)):Ft.setOptional(Y,Bn,"boneMatrices"))}return!!$&&($.morphAttributes.position!==void 0||$.morphAttributes.normal!==void 0)&&Se.update(ae,$,le,St),(yt||Ht.receiveShadow!==ae.receiveShadow)&&(Ht.receiveShadow=ae.receiveShadow,Ft.setValue(Y,"receiveShadow",ae.receiveShadow)),yt&&(Ft.setValue(Y,"toneMappingExposure",b.toneMappingExposure),Ht.needsLights&&ln(In,sn),xe&&le.fog&&Qe.refreshFogUniforms(In,xe),Qe.refreshMaterialUniforms(In,le,I,V,T),Dc.upload(Y,Ht.uniformsList,In,ne)),le.isShaderMaterial&&le.uniformsNeedUpdate===!0&&(Dc.upload(Y,Ht.uniformsList,In,ne),le.uniformsNeedUpdate=!1),le.isSpriteMaterial&&Ft.setValue(Y,"center",ae.center),Ft.setValue(Y,"modelViewMatrix",ae.modelViewMatrix),Ft.setValue(Y,"normalMatrix",ae.normalMatrix),Ft.setValue(Y,"modelMatrix",ae.matrixWorld),St}function ln(ie,P){ie.ambientLightColor.needsUpdate=P,ie.lightProbe.needsUpdate=P,ie.directionalLights.needsUpdate=P,ie.directionalLightShadows.needsUpdate=P,ie.pointLights.needsUpdate=P,ie.pointLightShadows.needsUpdate=P,ie.spotLights.needsUpdate=P,ie.spotLightShadows.needsUpdate=P,ie.rectAreaLights.needsUpdate=P,ie.hemisphereLights.needsUpdate=P}function cn(ie){return ie.isMeshLambertMaterial||ie.isMeshToonMaterial||ie.isMeshPhongMaterial||ie.isMeshStandardMaterial||ie.isShadowMaterial||ie.isShaderMaterial&&ie.lights===!0}this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return f},this.getRenderTarget=function(){return G},this.setRenderTargetTextures=function(ie,P,$){He.get(ie.texture).__webglTexture=P,He.get(ie.depthTexture).__webglTexture=$;const le=He.get(ie);le.__hasExternalTextures=!0,le.__hasExternalTextures&&(le.__autoAllocateDepthBuffer=$===void 0,le.__autoAllocateDepthBuffer||ie.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),ie.useRenderToTexture=!1,ie.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(ie,P){const $=He.get(ie);$.__webglFramebuffer=P,$.__useDefaultFramebuffer=P===void 0},this.setRenderTarget=function(ie,P=0,$=0){G=ie,m=P,f=$;let le=!0;if(ie){const Ue=He.get(ie);Ue.__useDefaultFramebuffer!==void 0?(he.bindFramebuffer(36160,null),le=!1):Ue.__webglFramebuffer===void 0?ne.setupRenderTarget(ie):Ue.__hasExternalTextures&&ne.rebindTextures(ie,He.get(ie.texture).__webglTexture,He.get(ie.depthTexture).__webglTexture)}let ae=null,xe=!1,Je=!1;if(ie){const Ue=ie.texture;(Ue.isDataTexture3D||Ue.isDataTexture2DArray)&&(Je=!0);const st=He.get(ie).__webglFramebuffer;ie.isWebGLCubeRenderTarget?(ae=st[P],xe=!0):ie.useRenderbuffer?ae=He.get(ie).__webglMultisampledFramebuffer:ae=st,M.copy(ie.viewport),E.copy(ie.scissor),z=ie.scissorTest}else M.copy(R).multiplyScalar(I).floor(),E.copy(W).multiplyScalar(I).floor(),z=H;if(he.bindFramebuffer(36160,ae)&&Ce.drawBuffers&&le&&he.drawBuffers(ie,ae),he.viewport(M),he.scissor(E),he.setScissorTest(z),xe){const Ue=He.get(ie.texture);Y.framebufferTexture2D(36160,36064,34069+P,Ue.__webglTexture,$)}else if(Je){const Ue=He.get(ie.texture),st=P||0;Y.framebufferTextureLayer(36160,36064,Ue.__webglTexture,$||0,st)}x=-1},this.readRenderTargetPixels=function(ie,P,$,le,ae,xe,Je){if(!(ie&&ie.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let De=He.get(ie).__webglFramebuffer;if(ie.isWebGLCubeRenderTarget&&Je!==void 0&&(De=De[Je]),De){he.bindFramebuffer(36160,De);try{const Ue=ie.texture,st=Ue.format,ut=Ue.type;if(st!==Tr&&we.convert(st)!==Y.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ct=ut===Dh&&(ye.has("EXT_color_buffer_half_float")||Ce.isWebGL2&&ye.has("EXT_color_buffer_float"));if(ut!==Hc&&we.convert(ut)!==Y.getParameter(35738)&&!(ut===mu&&(Ce.isWebGL2||ye.has("OES_texture_float")||ye.has("WEBGL_color_buffer_float")))&&!ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Y.checkFramebufferStatus(36160)===36053?P>=0&&P<=ie.width-le&&$>=0&&$<=ie.height-ae&&Y.readPixels(P,$,le,ae,we.convert(st),we.convert(ut),xe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Ue=G!==null?He.get(G).__webglFramebuffer:null;he.bindFramebuffer(36160,Ue)}}},this.copyFramebufferToTexture=function(ie,P,$=0){if(P.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const le=Math.pow(2,-$),ae=Math.floor(P.image.width*le),xe=Math.floor(P.image.height*le);ne.setTexture2D(P,0),Y.copyTexSubImage2D(3553,$,0,0,ie.x,ie.y,ae,xe),he.unbindTexture()},this.copyTextureToTexture=function(ie,P,$,le=0){const ae=P.image.width,xe=P.image.height,Je=we.convert($.format),De=we.convert($.type);ne.setTexture2D($,0),Y.pixelStorei(37440,$.flipY),Y.pixelStorei(37441,$.premultiplyAlpha),Y.pixelStorei(3317,$.unpackAlignment),P.isDataTexture?Y.texSubImage2D(3553,le,ie.x,ie.y,ae,xe,Je,De,P.image.data):P.isCompressedTexture?Y.compressedTexSubImage2D(3553,le,ie.x,ie.y,P.mipmaps[0].width,P.mipmaps[0].height,Je,P.mipmaps[0].data):Y.texSubImage2D(3553,le,ie.x,ie.y,Je,De,P.image),le===0&&$.generateMipmaps&&Y.generateMipmap(3553),he.unbindTexture()},this.copyTextureToTexture3D=function(ie,P,$,le,ae=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const xe=ie.max.x-ie.min.x+1,Je=ie.max.y-ie.min.y+1,De=ie.max.z-ie.min.z+1,Ue=we.convert(le.format),st=we.convert(le.type);let ut;if(le.isDataTexture3D)ne.setTexture3D(le,0),ut=32879;else if(le.isDataTexture2DArray)ne.setTexture2DArray(le,0),ut=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Y.pixelStorei(37440,le.flipY),Y.pixelStorei(37441,le.premultiplyAlpha),Y.pixelStorei(3317,le.unpackAlignment);const ct=Y.getParameter(3314),mt=Y.getParameter(32878),Pt=Y.getParameter(3316),ei=Y.getParameter(3315),Ht=Y.getParameter(32877),Ln=$.isCompressedTexture?$.mipmaps[0]:$.image;Y.pixelStorei(3314,Ln.width),Y.pixelStorei(32878,Ln.height),Y.pixelStorei(3316,ie.min.x),Y.pixelStorei(3315,ie.min.y),Y.pixelStorei(32877,ie.min.z),$.isDataTexture||$.isDataTexture3D?Y.texSubImage3D(ut,ae,P.x,P.y,P.z,xe,Je,De,Ue,st,Ln.data):$.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Y.compressedTexSubImage3D(ut,ae,P.x,P.y,P.z,xe,Je,De,Ue,Ln.data)):Y.texSubImage3D(ut,ae,P.x,P.y,P.z,xe,Je,De,Ue,st,Ln),Y.pixelStorei(3314,ct),Y.pixelStorei(32878,mt),Y.pixelStorei(3316,Pt),Y.pixelStorei(3315,ei),Y.pixelStorei(32877,Ht),ae===0&&le.generateMipmaps&&Y.generateMipmap(ut),he.unbindTexture()},this.initTexture=function(ie){ne.setTexture2D(ie,0),he.unbindTexture()},this.resetState=function(){m=0,f=0,G=null,he.reset(),re.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}wn.prototype.isWebGLRenderer=!0;class vIe extends wn{}vIe.prototype.isWebGL1Renderer=!0;class Wk extends fn{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}Wk.prototype.isScene=!0;class Dp{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Hp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ua()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ua()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ua()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Dp.prototype.isInterleavedBuffer=!0;const mi=new fe;class Up{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.applyMatrix4(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.applyNormalMatrix(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.transformDirection(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new _i(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Up(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Up.prototype.isInterleavedBufferAttribute=!0;class _k extends xr{constructor(e){super();this.type="SpriteMaterial",this.color=new Bt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}_k.prototype.isSpriteMaterial=!0;let bf;const Op=new fe,yf=new fe,vf=new fe,xf=new je,Jp=new je,Vk=new Vt,_v=new fe,Qp=new fe,Vv=new fe,Nk=new je,O3=new je,Ek=new je;class xIe extends fn{constructor(e){super();if(this.type="Sprite",bf===void 0){bf=new Jn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Dp(t,5);bf.setIndex([0,1,2,0,2,3]),bf.setAttribute("position",new Up(n,3,0,!1)),bf.setAttribute("uv",new Up(n,2,3,!1))}this.geometry=bf,this.material=e!==void 0?e:new _k,this.center=new je(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),yf.setFromMatrixScale(this.matrixWorld),Vk.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),vf.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&yf.multiplyScalar(-vf.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;Nv(_v.set(-.5,-.5,0),vf,o,yf,r,s),Nv(Qp.set(.5,-.5,0),vf,o,yf,r,s),Nv(Vv.set(.5,.5,0),vf,o,yf,r,s),Nk.set(0,0),O3.set(1,0),Ek.set(1,1);let a=e.ray.intersectTriangle(_v,Qp,Vv,!1,Op);if(a===null&&(Nv(Qp.set(-.5,.5,0),vf,o,yf,r,s),O3.set(0,1),a=e.ray.intersectTriangle(_v,Vv,Qp,!1,Op),a===null))return;const l=e.ray.origin.distanceTo(Op);l<e.near||l>e.far||t.push({distance:l,point:Op.clone(),uv:vi.getUV(Op,_v,Qp,Vv,Nk,O3,Ek,new je),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}xIe.prototype.isSprite=!0;function Nv(i,e,t,n,r,s){xf.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(Jp.x=s*xf.x-r*xf.y,Jp.y=r*xf.x+s*xf.y):Jp.copy(xf),i.copy(e),i.x+=Jp.x,i.y+=Jp.y,i.applyMatrix4(Vk)}const Hk=new fe,Fk=new _n,Lk=new _n,wIe=new fe,Tk=new Vt;class Xk extends as{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Vt,this.bindMatrixInverse=new Vt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new _n,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;Fk.fromBufferAttribute(r.attributes.skinIndex,e),Lk.fromBufferAttribute(r.attributes.skinWeight,e),Hk.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=Lk.getComponent(s);if(o!==0){const a=Fk.getComponent(s);Tk.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(wIe.copy(Hk).applyMatrix4(Tk),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}Xk.prototype.isSkinnedMesh=!0;class GIe extends fn{constructor(){super();this.type="Bone"}}GIe.prototype.isBone=!0;class BIe extends Xi{constructor(e=null,t=1,n=1,r,s,o,a,l,c=Wi,g=Wi,d,u){super(null,o,a,l,c,g,r,s,d,u);this.image={data:e,width:t,height:n},this.magFilter=c,this.minFilter=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}BIe.prototype.isDataTexture=!0;class J3 extends _i{constructor(e,t,n,r=1){typeof n=="number"&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}J3.prototype.isInstancedBufferAttribute=!0;const zk=new Vt,kk=new Vt,Ev=[],jp=new as;class qp extends as{constructor(e,t,n){super(e,t);this.instanceMatrix=new J3(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(jp.geometry=this.geometry,jp.material=this.material,jp.material!==void 0)for(let s=0;s<r;s++){this.getMatrixAt(s,zk),kk.multiplyMatrices(n,zk),jp.matrixWorld=kk,jp.raycast(e,Ev);for(let o=0,a=Ev.length;o<a;o++){const l=Ev[o];l.instanceId=s,l.object=this,t.push(l)}Ev.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new J3(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}qp.prototype.isInstancedMesh=!0;class $p extends xr{constructor(e){super();this.type="LineBasicMaterial",this.color=new Bt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}$p.prototype.isLineBasicMaterial=!0;const Yk=new fe,Kk=new fe,Pk=new Vt,Q3=new sf,Hv=new rf;class j3 extends fn{constructor(e=new Jn,t=new $p){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)Yk.fromBufferAttribute(t,r-1),Kk.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Yk.distanceTo(Kk);e.setAttribute("lineDistance",new zi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Hv.copy(n.boundingSphere),Hv.applyMatrix4(r),Hv.radius+=s,e.ray.intersectsSphere(Hv)===!1)return;Pk.copy(r).invert(),Q3.copy(e.ray).applyMatrix4(Pk);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new fe,g=new fe,d=new fe,u=new fe,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const p=n.index,y=n.attributes.position;if(p!==null){const m=Math.max(0,o.start),f=Math.min(p.count,o.start+o.count);for(let G=m,x=f-1;G<x;G+=h){const B=p.getX(G),M=p.getX(G+1);if(c.fromBufferAttribute(y,B),g.fromBufferAttribute(y,M),Q3.distanceSqToSegment(c,g,u,d)>l)continue;u.applyMatrix4(this.matrixWorld);const z=e.ray.origin.distanceTo(u);z<e.near||z>e.far||t.push({distance:z,point:d.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,o.start),f=Math.min(y.count,o.start+o.count);for(let G=m,x=f-1;G<x;G+=h){if(c.fromBufferAttribute(y,G),g.fromBufferAttribute(y,G+1),Q3.distanceSqToSegment(c,g,u,d)>l)continue;u.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(u);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}j3.prototype.isLine=!0;const Dk=new fe,Uk=new fe;class q3 extends j3{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)Dk.fromBufferAttribute(t,r),Uk.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+Dk.distanceTo(Uk);e.setAttribute("lineDistance",new zi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}q3.prototype.isLineSegments=!0;class SIe extends j3{constructor(e,t){super(e,t);this.type="LineLoop"}}SIe.prototype.isLineLoop=!0;class Ok extends xr{constructor(e){super();this.type="PointsMaterial",this.color=new Bt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Ok.prototype.isPointsMaterial=!0;const Jk=new Vt,$3=new sf,Fv=new rf,Lv=new fe;class ZIe extends fn{constructor(e=new Jn,t=new Ok){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Fv.copy(n.boundingSphere),Fv.applyMatrix4(r),Fv.radius+=s,e.ray.intersectsSphere(Fv)===!1)return;Jk.copy(r).invert(),$3.copy(e.ray).applyMatrix4(Jk);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(n.isBufferGeometry){const c=n.index,d=n.attributes.position;if(c!==null){const u=Math.max(0,o.start),h=Math.min(c.count,o.start+o.count);for(let p=u,b=h;p<b;p++){const y=c.getX(p);Lv.fromBufferAttribute(d,y),Qk(Lv,y,l,r,e,t,this)}}else{const u=Math.max(0,o.start),h=Math.min(d.count,o.start+o.count);for(let p=u,b=h;p<b;p++)Lv.fromBufferAttribute(d,p),Qk(Lv,p,l,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ZIe.prototype.isPoints=!0;function Qk(i,e,t,n,r,s,o){const a=$3.distanceSqToPoint(i);if(a<t){const l=new fe;$3.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class RIe extends Xi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c);this.minFilter=o!==void 0?o:vr,this.magFilter=s!==void 0?s:vr,this.generateMipmaps=!1;const g=this;function d(){g.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}RIe.prototype.isVideoTexture=!0;class MIe extends Xi{constructor(e,t,n){super({width:e,height:t});this.format=n,this.magFilter=Wi,this.minFilter=Wi,this.generateMipmaps=!1,this.needsUpdate=!0}}MIe.prototype.isFramebufferTexture=!0;class WIe extends Xi{constructor(e,t,n,r,s,o,a,l,c,g,d,u){super(null,o,a,l,c,g,r,s,d,u);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}WIe.prototype.isCompressedTexture=!0;class _Ie extends Xi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c);this.needsUpdate=!0}}_Ie.prototype.isCanvasTexture=!0;new fe;new fe;new fe;new vi;class eo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const g=n[r],u=n[r+1]-g,h=(o-g)/u;return(r+h)/(s-1)}getTangent(e,t){const n=1e-4;let r=e-n,s=e+n;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new je:new fe);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new fe,r=[],s=[],o=[],a=new fe,l=new Vt;for(let h=0;h<=e;h++){const p=h/e;r[h]=this.getTangentAt(p,new fe)}s[0]=new fe,o[0]=new fe;let c=Number.MAX_VALUE;const g=Math.abs(r[0].x),d=Math.abs(r[0].y),u=Math.abs(r[0].z);g<=c&&(c=g,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),u<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let h=1;h<=e;h++){if(s[h]=s[h-1].clone(),o[h]=o[h-1].clone(),a.crossVectors(r[h-1],r[h]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(Bs(r[h-1].dot(r[h]),-1,1));s[h].applyMatrix4(l.makeRotationAxis(a,p))}o[h].crossVectors(r[h],s[h])}if(t===!0){let h=Math.acos(Bs(s[0].dot(s[e]),-1,1));h/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(h=-h);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(r[p],h*p)),o[p].crossVectors(r[p],s[p])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Tv extends eo{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new je,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const g=Math.cos(this.aRotation),d=Math.sin(this.aRotation),u=l-this.aX,h=c-this.aY;l=u*g-h*d+this.aX,c=u*d+h*g+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Tv.prototype.isEllipseCurve=!0;class jk extends Tv{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o);this.type="ArcCurve"}}jk.prototype.isArcCurve=!0;function eR(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,g,d){let u=(o-s)/c-(a-s)/(c+g)+(a-o)/g,h=(a-o)/g-(l-o)/(g+d)+(l-a)/d;u*=g,h*=g,r(o,a,u,h)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const Xv=new fe,tR=new eR,nR=new eR,iR=new eR;class qk extends eo{constructor(e=[],t=!1,n="centripetal",r=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new fe){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,g;this.closed||a>0?c=r[(a-1)%s]:(Xv.subVectors(r[0],r[1]).add(r[0]),c=Xv);const d=r[a%s],u=r[(a+1)%s];if(this.closed||a+2<s?g=r[(a+2)%s]:(Xv.subVectors(r[s-1],r[s-2]).add(r[s-1]),g=Xv),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(d),h),b=Math.pow(d.distanceToSquared(u),h),y=Math.pow(u.distanceToSquared(g),h);b<1e-4&&(b=1),p<1e-4&&(p=b),y<1e-4&&(y=b),tR.initNonuniformCatmullRom(c.x,d.x,u.x,g.x,p,b,y),nR.initNonuniformCatmullRom(c.y,d.y,u.y,g.y,p,b,y),iR.initNonuniformCatmullRom(c.z,d.z,u.z,g.z,p,b,y)}else this.curveType==="catmullrom"&&(tR.initCatmullRom(c.x,d.x,u.x,g.x,this.tension),nR.initCatmullRom(c.y,d.y,u.y,g.y,this.tension),iR.initCatmullRom(c.z,d.z,u.z,g.z,this.tension));return n.set(tR.calc(l),nR.calc(l),iR.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new fe().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}qk.prototype.isCatmullRomCurve3=!0;function $k(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function VIe(i,e){const t=1-i;return t*t*e}function NIe(i,e){return 2*(1-i)*i*e}function EIe(i,e){return i*i*e}function e0(i,e,t,n){return VIe(i,e)+NIe(i,t)+EIe(i,n)}function HIe(i,e){const t=1-i;return t*t*t*e}function FIe(i,e){const t=1-i;return 3*t*t*i*e}function LIe(i,e){return 3*(1-i)*i*i*e}function TIe(i,e){return i*i*i*e}function t0(i,e,t,n,r){return HIe(i,e)+FIe(i,t)+LIe(i,n)+TIe(i,r)}class rR extends eo{constructor(e=new je,t=new je,n=new je,r=new je){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new je){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(t0(e,r.x,s.x,o.x,a.x),t0(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}rR.prototype.isCubicBezierCurve=!0;class eY extends eo{constructor(e=new fe,t=new fe,n=new fe,r=new fe){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new fe){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(t0(e,r.x,s.x,o.x,a.x),t0(e,r.y,s.y,o.y,a.y),t0(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}eY.prototype.isCubicBezierCurve3=!0;class zv extends eo{constructor(e=new je,t=new je){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new je){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new je;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}zv.prototype.isLineCurve=!0;class XIe extends eo{constructor(e=new fe,t=new fe){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new fe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sR extends eo{constructor(e=new je,t=new je,n=new je){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new je){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(e0(e,r.x,s.x,o.x),e0(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}sR.prototype.isQuadraticBezierCurve=!0;class tY extends eo{constructor(e=new fe,t=new fe,n=new fe){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new fe){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(e0(e,r.x,s.x,o.x),e0(e,r.y,s.y,o.y),e0(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}tY.prototype.isQuadraticBezierCurve3=!0;class oR extends eo{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new je){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],g=r[o>r.length-2?r.length-1:o+1],d=r[o>r.length-3?r.length-1:o+2];return n.set($k(a,l.x,c.x,g.x,d.x),$k(a,l.y,c.y,g.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new je().fromArray(r))}return this}}oR.prototype.isSplineCurve=!0;var nY=Object.freeze({__proto__:null,ArcCurve:jk,CatmullRomCurve3:qk,CubicBezierCurve:rR,CubicBezierCurve3:eY,EllipseCurve:Tv,LineCurve:zv,LineCurve3:XIe,QuadraticBezierCurve:sR,QuadraticBezierCurve3:tY,SplineCurve:oR});class zIe extends eo{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zv(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o&&o.isEllipseCurve?e*2:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const g=l[c];n&&n.equals(g)||(t.push(g),n=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new nY[r.type]().fromJSON(r))}return this}}class aR extends zIe{constructor(e){super();this.type="Path",this.currentPoint=new je,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new zv(this.currentPoint.clone(),new je(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new sR(this.currentPoint.clone(),new je(e,t),new je(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new rR(this.currentPoint.clone(),new je(e,t),new je(n,r),new je(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new oR(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+c,t+g,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new Tv(e,t,n,r,s,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const g=c.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class n0 extends aR{constructor(e){super(e);this.uuid=ua(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new aR().fromJSON(r))}return this}}const kIe={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=iY(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,g,d,u,h;if(n&&(s=UIe(i,e,s,t)),i.length>80*t){a=c=i[0],l=g=i[1];for(let p=t;p<r;p+=t)d=i[p],u=i[p+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>g&&(g=u);h=Math.max(c-a,g-l),h=h!==0?1/h:0}return i0(s,o,t,a,l,h),o}};function iY(i,e,t,n,r){let s,o;if(r===rCe(i,e,t,n)>0)for(s=e;s<t;s+=n)o=oY(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=oY(s,i[s],i[s+1],o);return o&&kv(o,o.next)&&(s0(o),o=o.next),o}function Uc(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(kv(t,t.next)||$n(t.prev,t,t.next)===0)){if(s0(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function i0(i,e,t,n,r,s,o){if(!i)return;!o&&s&&qIe(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?KIe(i,n,r,s):YIe(i)){e.push(l.i/t),e.push(i.i/t),e.push(c.i/t),s0(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=PIe(Uc(i),e,t),i0(i,e,t,n,r,s,2)):o===2&&DIe(i,e,t,n,r,s):i0(Uc(i),e,t,n,r,s,1);break}}}function YIe(i){const e=i.prev,t=i,n=i.next;if($n(e,t,n)>=0)return!1;let r=i.next.next;for(;r!==i.prev;){if(wf(e.x,e.y,t.x,t.y,n.x,n.y,r.x,r.y)&&$n(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function KIe(i,e,t,n){const r=i.prev,s=i,o=i.next;if($n(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,g=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,d=lR(a,l,e,t,n),u=lR(c,g,e,t,n);let h=i.prevZ,p=i.nextZ;for(;h&&h.z>=d&&p&&p.z<=u;){if(h!==i.prev&&h!==i.next&&wf(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&$n(h.prev,h,h.next)>=0||(h=h.prevZ,p!==i.prev&&p!==i.next&&wf(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&$n(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;h&&h.z>=d;){if(h!==i.prev&&h!==i.next&&wf(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&$n(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==i.prev&&p!==i.next&&wf(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&$n(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function PIe(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!kv(r,s)&&rY(r,n,n.next,s)&&r0(r,s)&&r0(s,r)&&(e.push(r.i/t),e.push(n.i/t),e.push(s.i/t),s0(n),s0(n.next),n=i=s),n=n.next}while(n!==i);return Uc(n)}function DIe(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&tCe(o,a)){let l=sY(o,a);o=Uc(o,o.next),l=Uc(l,l.next),i0(o,e,t,n,r,s),i0(l,e,t,n,r,s);return}a=a.next}o=o.next}while(o!==i)}function UIe(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=iY(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(eCe(c));for(r.sort(OIe),s=0;s<r.length;s++)JIe(r[s],t),t=Uc(t,t.next);return t}function OIe(i,e){return i.x-e.x}function JIe(i,e){if(e=QIe(i,e),e){const t=sY(e,i);Uc(e,e.next),Uc(t,t.next)}}function QIe(i,e){let t=e;const n=i.x,r=i.y;let s=-1/0,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const u=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=n&&u>s){if(s=u,u===n){if(r===t.y)return t;if(r===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===s)return o;const a=o,l=o.x,c=o.y;let g=1/0,d;t=o;do n>=t.x&&t.x>=l&&n!==t.x&&wf(r<c?n:s,r,l,c,r<c?s:n,r,t.x,t.y)&&(d=Math.abs(r-t.y)/(n-t.x),r0(t,i)&&(d<g||d===g&&(t.x>o.x||t.x===o.x&&jIe(o,t)))&&(o=t,g=d)),t=t.next;while(t!==a);return o}function jIe(i,e){return $n(i.prev,i,e.prev)<0&&$n(e.next,i,i.next)<0}function qIe(i,e,t,n){let r=i;do r.z===null&&(r.z=lR(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,$Ie(r)}function $Ie(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function lR(i,e,t,n,r){return i=32767*(i-t)*r,e=32767*(e-n)*r,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function eCe(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function wf(i,e,t,n,r,s,o,a){return(r-o)*(e-a)-(i-o)*(s-a)>=0&&(i-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(r-o)*(n-a)>=0}function tCe(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!nCe(i,e)&&(r0(i,e)&&r0(e,i)&&iCe(i,e)&&($n(i.prev,i,e.prev)||$n(i,e.prev,e))||kv(i,e)&&$n(i.prev,i,i.next)>0&&$n(e.prev,e,e.next)>0)}function $n(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function kv(i,e){return i.x===e.x&&i.y===e.y}function rY(i,e,t,n){const r=Kv($n(i,e,t)),s=Kv($n(i,e,n)),o=Kv($n(t,n,i)),a=Kv($n(t,n,e));return!!(r!==s&&o!==a||r===0&&Yv(i,t,e)||s===0&&Yv(i,n,e)||o===0&&Yv(t,i,n)||a===0&&Yv(t,e,n))}function Yv(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function Kv(i){return i>0?1:i<0?-1:0}function nCe(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&rY(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function r0(i,e){return $n(i.prev,i,i.next)<0?$n(i,e,i.next)>=0&&$n(i,i.prev,e)>=0:$n(i,e,i.prev)<0||$n(i,i.next,e)<0}function iCe(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function sY(i,e){const t=new cR(i.i,i.x,i.y),n=new cR(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function oY(i,e,t,n){const r=new cR(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function s0(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function cR(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rCe(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class Oc{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return Oc.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];aY(e),lY(n,e);let o=e.length;t.forEach(aY);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,lY(n,t[l]);const a=kIe.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function aY(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function lY(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Gf extends Jn{constructor(e=new n0([new je(.5,.5),new je(-.5,.5),new je(-.5,-.5),new je(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new zi(r,3)),this.setAttribute("uv",new zi(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1;let d=t.depth!==void 0?t.depth:1,u=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:h-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,f=t.UVGenerator!==void 0?t.UVGenerator:sCe;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let G,x=!1,B,M,E,z;m&&(G=m.getSpacedPoints(g),x=!0,u=!1,B=m.computeFrenetFrames(g,!1),M=new fe,E=new fe,z=new fe),u||(y=0,h=0,p=0,b=0);const J=a.extractPoints(c);let V=J.shape;const I=J.holes;if(!Oc.isClockWise(V)){V=V.reverse();for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];Oc.isClockWise(Ie)&&(I[ne]=Ie.reverse())}}const S=Oc.triangulateShape(V,I),R=V;for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];V=V.concat(Ie)}function W(ne,de,Ie){return de||console.error("THREE.ExtrudeGeometry: vec does not exist"),de.clone().multiplyScalar(Ie).add(ne)}const H=V.length,k=S.length;function _(ne,de,Ie){let Be,Re,Xe;const Le=ne.x-de.x,Qe=ne.y-de.y,et=Ie.x-ne.x,q=Ie.y-ne.y,X=Le*Le+Qe*Qe,D=Le*q-Qe*et;if(Math.abs(D)>Number.EPSILON){const ge=Math.sqrt(X),Se=Math.sqrt(et*et+q*q),Me=de.x-Qe/ge,pe=de.y+Le/ge,we=Ie.x-q/Se,re=Ie.y+et/Se,be=((we-Me)*q-(re-pe)*et)/(Le*q-Qe*et);Be=Me+Le*be-ne.x,Re=pe+Qe*be-ne.y;const _e=Be*Be+Re*Re;if(_e<=2)return new je(Be,Re);Xe=Math.sqrt(_e/2)}else{let ge=!1;Le>Number.EPSILON?et>Number.EPSILON&&(ge=!0):Le<-Number.EPSILON?et<-Number.EPSILON&&(ge=!0):Math.sign(Qe)===Math.sign(q)&&(ge=!0),ge?(Be=-Qe,Re=Le,Xe=Math.sqrt(X)):(Be=Le,Re=Qe,Xe=Math.sqrt(X/2))}return new je(Be/Xe,Re/Xe)}const Z=[];for(let ne=0,de=R.length,Ie=de-1,Be=ne+1;ne<de;ne++,Ie++,Be++)Ie===de&&(Ie=0),Be===de&&(Be=0),Z[ne]=_(R[ne],R[Ie],R[Be]);const T=[];let F,K=Z.concat();for(let ne=0,de=I.length;ne<de;ne++){const Ie=I[ne];F=[];for(let Be=0,Re=Ie.length,Xe=Re-1,Le=Be+1;Be<Re;Be++,Xe++,Le++)Xe===Re&&(Xe=0),Le===Re&&(Le=0),F[Be]=_(Ie[Be],Ie[Xe],Ie[Le]);T.push(F),K=K.concat(F)}for(let ne=0;ne<y;ne++){const de=ne/y,Ie=h*Math.cos(de*Math.PI/2),Be=p*Math.sin(de*Math.PI/2)+b;for(let Re=0,Xe=R.length;Re<Xe;Re++){const Le=W(R[Re],Z[Re],Be);ye(Le.x,Le.y,-Ie)}for(let Re=0,Xe=I.length;Re<Xe;Re++){const Le=I[Re];F=T[Re];for(let Qe=0,et=Le.length;Qe<et;Qe++){const q=W(Le[Qe],F[Qe],Be);ye(q.x,q.y,-Ie)}}}const j=p+b;for(let ne=0;ne<H;ne++){const de=u?W(V[ne],K[ne],j):V[ne];x?(E.copy(B.normals[0]).multiplyScalar(de.x),M.copy(B.binormals[0]).multiplyScalar(de.y),z.copy(G[0]).add(E).add(M),ye(z.x,z.y,z.z)):ye(de.x,de.y,0)}for(let ne=1;ne<=g;ne++)for(let de=0;de<H;de++){const Ie=u?W(V[de],K[de],j):V[de];x?(E.copy(B.normals[ne]).multiplyScalar(Ie.x),M.copy(B.binormals[ne]).multiplyScalar(Ie.y),z.copy(G[ne]).add(E).add(M),ye(z.x,z.y,z.z)):ye(Ie.x,Ie.y,d/g*ne)}for(let ne=y-1;ne>=0;ne--){const de=ne/y,Ie=h*Math.cos(de*Math.PI/2),Be=p*Math.sin(de*Math.PI/2)+b;for(let Re=0,Xe=R.length;Re<Xe;Re++){const Le=W(R[Re],Z[Re],Be);ye(Le.x,Le.y,d+Ie)}for(let Re=0,Xe=I.length;Re<Xe;Re++){const Le=I[Re];F=T[Re];for(let Qe=0,et=Le.length;Qe<et;Qe++){const q=W(Le[Qe],F[Qe],Be);x?ye(q.x,q.y+G[g-1].y,G[g-1].x+Ie):ye(q.x,q.y,d+Ie)}}}O(),Y();function O(){const ne=r.length/3;if(u){let de=0,Ie=H*de;for(let Be=0;Be<k;Be++){const Re=S[Be];Ce(Re[2]+Ie,Re[1]+Ie,Re[0]+Ie)}de=g+y*2,Ie=H*de;for(let Be=0;Be<k;Be++){const Re=S[Be];Ce(Re[0]+Ie,Re[1]+Ie,Re[2]+Ie)}}else{for(let de=0;de<k;de++){const Ie=S[de];Ce(Ie[2],Ie[1],Ie[0])}for(let de=0;de<k;de++){const Ie=S[de];Ce(Ie[0]+H*g,Ie[1]+H*g,Ie[2]+H*g)}}n.addGroup(ne,r.length/3-ne,0)}function Y(){const ne=r.length/3;let de=0;ee(R,de),de+=R.length;for(let Ie=0,Be=I.length;Ie<Be;Ie++){const Re=I[Ie];ee(Re,de),de+=Re.length}n.addGroup(ne,r.length/3-ne,1)}function ee(ne,de){let Ie=ne.length;for(;--Ie>=0;){const Be=Ie;let Re=Ie-1;Re<0&&(Re=ne.length-1);for(let Xe=0,Le=g+y*2;Xe<Le;Xe++){const Qe=H*Xe,et=H*(Xe+1),q=de+Be+Qe,X=de+Re+Qe,D=de+Re+et,ge=de+Be+et;he(q,X,D,ge)}}}function ye(ne,de,Ie){l.push(ne),l.push(de),l.push(Ie)}function Ce(ne,de,Ie){Ne(ne),Ne(de),Ne(Ie);const Be=r.length/3,Re=f.generateTopUV(n,r,Be-3,Be-2,Be-1);He(Re[0]),He(Re[1]),He(Re[2])}function he(ne,de,Ie,Be){Ne(ne),Ne(de),Ne(Be),Ne(de),Ne(Ie),Ne(Be);const Re=r.length/3,Xe=f.generateSideWallUV(n,r,Re-6,Re-3,Re-2,Re-1);He(Xe[0]),He(Xe[1]),He(Xe[3]),He(Xe[1]),He(Xe[2]),He(Xe[3])}function Ne(ne){r.push(l[ne*3+0]),r.push(l[ne*3+1]),r.push(l[ne*3+2])}function He(ne){s.push(ne.x),s.push(ne.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return oCe(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new nY[r.type]().fromJSON(r)),new Gf(n,e.options)}}const sCe={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],g=e[r*3+1];return[new je(s,o),new je(a,l),new je(c,g)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],g=e[n*3+1],d=e[n*3+2],u=e[r*3],h=e[r*3+1],p=e[r*3+2],b=e[s*3],y=e[s*3+1],m=e[s*3+2];return Math.abs(a-g)<Math.abs(o-c)?[new je(o,1-l),new je(c,1-d),new je(u,1-p),new je(b,1-m)]:[new je(a,1-l),new je(g,1-d),new je(h,1-p),new je(y,1-m)]}};function oCe(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class gR extends Jn{constructor(e=new n0([new je(0,.5),new je(-.5,-.5),new je(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let g=0;g<e.length;g++)c(e[g]),this.addGroup(a,l,g),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new zi(r,3)),this.setAttribute("normal",new zi(s,3)),this.setAttribute("uv",new zi(o,2));function c(g){const d=r.length/3,u=g.extractPoints(t);let h=u.shape;const p=u.holes;Oc.isClockWise(h)===!1&&(h=h.reverse());for(let y=0,m=p.length;y<m;y++){const f=p[y];Oc.isClockWise(f)===!0&&(p[y]=f.reverse())}const b=Oc.triangulateShape(h,p);for(let y=0,m=p.length;y<m;y++){const f=p[y];h=h.concat(f)}for(let y=0,m=h.length;y<m;y++){const f=h[y];r.push(f.x,f.y,0),s.push(0,0,1),o.push(f.x,f.y)}for(let y=0,m=b.length;y<m;y++){const f=b[y],G=f[0]+d,x=f[1]+d,B=f[2]+d;n.push(G,x,B),l+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return aCe(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new gR(n,e.curveSegments)}}function aCe(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class lCe extends xr{constructor(e){super();this.type="ShadowMaterial",this.color=new Bt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}lCe.prototype.isShadowMaterial=!0;class cY extends xr{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Bt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jh,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}cY.prototype.isMeshStandardMaterial=!0;class cCe extends cY{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new je(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Bs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Bt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Bt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Bt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}cCe.prototype.isMeshPhysicalMaterial=!0;class gCe extends xr{constructor(e){super();this.type="MeshPhongMaterial",this.color=new Bt(16777215),this.specular=new Bt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jh,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}gCe.prototype.isMeshPhongMaterial=!0;class uCe extends xr{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Bt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jh,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}uCe.prototype.isMeshToonMaterial=!0;class dCe extends xr{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jh,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}dCe.prototype.isMeshNormalMaterial=!0;class hCe extends xr{constructor(e){super();this.type="MeshLambertMaterial",this.color=new Bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}hCe.prototype.isMeshLambertMaterial=!0;class fCe extends xr{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Bt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jh,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}fCe.prototype.isMeshMatcapMaterial=!0;class ICe extends $p{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}ICe.prototype.isLineDashedMaterial=!0;const Qn={arraySlice:function(i,e,t){return Qn.isTypedArray(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)},convertArray:function(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n},sortedArray:function(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r},flattenJSON:function(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)},subclip:function(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],g=c.getValueSize(),d=[],u=[];for(let h=0;h<c.times.length;++h){const p=c.times[h]*r;if(!(p<t||p>=n)){d.push(c.times[h]);for(let b=0;b<g;++b)u.push(c.values[h*g+b])}}d.length!==0&&(c.times=Qn.convertArray(d,c.times.constructor),c.values=Qn.convertArray(u,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===l});if(c===void 0)continue;let g=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=d/3);let u=0;const h=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);const p=a.times.length-1;let b;if(s<=a.times[0]){const m=g,f=d-g;b=Qn.arraySlice(a.values,m,f)}else if(s>=a.times[p]){const m=p*d+g,f=m+d-g;b=Qn.arraySlice(a.values,m,f)}else{const m=a.createInterpolant(),f=g,G=d-g;m.evaluate(s),b=Qn.arraySlice(m.resultBuffer,f,G)}l==="quaternion"&&new rr().fromArray(b).normalize().conjugate().toArray(b);const y=c.times.length;for(let m=0;m<y;++m){const f=m*h+u;if(l==="quaternion")rr.multiplyQuaternionsFlat(c.values,f,b,0,c.values,f);else{const G=h-u*2;for(let x=0;x<G;++x)c.values[f+x]-=b[x]}}}return i.blendMode=Sz,i}};class Jc{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,s)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,s,e)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Jc.prototype.beforeStart_=Jc.prototype.copySampleValue_;Jc.prototype.afterEnd_=Jc.prototype.copySampleValue_;class CCe extends Jc{constructor(e,t,n,r){super(e,t,n,r);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Jh,endingEnd:Jh}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Qh:s=e,a=2*t-n;break;case av:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Qh:o=e,l=2*n-t;break;case av:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,g=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*g,this._offsetNext=o*g}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),b=p*p,y=b*p,m=-u*y+2*u*b-u*p,f=(1+u)*y+(-1.5-2*u)*b+(-.5+u)*p+1,G=(-1-h)*y+(1.5+h)*b+.5*p,x=h*y-h*b;for(let B=0;B!==a;++B)s[B]=m*o[g+B]+f*o[c+B]+G*o[l+B]+x*o[d+B];return s}}class gY extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,g=(n-t)/(r-t),d=1-g;for(let u=0;u!==a;++u)s[u]=o[c+u]*d+o[l+u]*g;return s}}class pCe extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fa{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Qn.convertArray(t,this.TimeBufferType),this.values=Qn.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Qn.convertArray(e.times,Array),values:Qn.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new pCe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new gY(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CCe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sv:t=this.InterpolantFactoryMethodDiscrete;break;case ov:t=this.InterpolantFactoryMethodLinear;break;case o3:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sv;case this.InterpolantFactoryMethodLinear:return ov;case this.InterpolantFactoryMethodSmooth:return o3}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=Qn.arraySlice(n,s,o),this.values=Qn.arraySlice(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&Qn.isTypedArray(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=Qn.arraySlice(this.times),t=Qn.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===o3,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],g=e[a+1];if(c!==g&&(a!==1||c!==e[0]))if(r)l=!0;else{const d=a*n,u=d-n,h=d+n;for(let p=0;p!==n;++p){const b=t[d+p];if(b!==t[u+p]||b!==t[h+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*n,u=o*n;for(let h=0;h!==n;++h)t[u+h]=t[d+h]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=Qn.arraySlice(e,0,o),this.values=Qn.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Qn.arraySlice(this.times,0),t=Qn.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}fa.prototype.TimeBufferType=Float32Array;fa.prototype.ValueBufferType=Float32Array;fa.prototype.DefaultInterpolation=ov;class Bf extends fa{}Bf.prototype.ValueTypeName="bool";Bf.prototype.ValueBufferType=Array;Bf.prototype.DefaultInterpolation=sv;Bf.prototype.InterpolantFactoryMethodLinear=void 0;Bf.prototype.InterpolantFactoryMethodSmooth=void 0;class uY extends fa{}uY.prototype.ValueTypeName="color";class Pv extends fa{}Pv.prototype.ValueTypeName="number";class mCe extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let g=c+a;c!==g;c+=4)rr.slerpFlat(s,0,o,c-a,o,c,l);return s}}class o0 extends fa{InterpolantFactoryMethodLinear(e){return new mCe(this.times,this.values,this.getValueSize(),e)}}o0.prototype.ValueTypeName="quaternion";o0.prototype.DefaultInterpolation=ov;o0.prototype.InterpolantFactoryMethodSmooth=void 0;class Sf extends fa{}Sf.prototype.ValueTypeName="string";Sf.prototype.ValueBufferType=Array;Sf.prototype.DefaultInterpolation=sv;Sf.prototype.InterpolantFactoryMethodLinear=void 0;Sf.prototype.InterpolantFactoryMethodSmooth=void 0;class Dv extends fa{}Dv.prototype.ValueTypeName="vector";class dY{constructor(e,t=-1,n,r=a3){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=ua(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(bCe(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(fa.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const g=Qn.getKeyframeOrder(l);l=Qn.sortedArray(l,1,g),c=Qn.sortedArray(c,1,g),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new Pv(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],g=c.name.match(s);if(g&&g.length>1){const d=g[1];let u=r[d];u||(r[d]=u=[]),u.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(d,u,h,p,b){if(h.length!==0){const y=[],m=[];Qn.flattenJSON(h,y,m,p),y.length!==0&&b.push(new d(u,y,m))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const u=c[d].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const h={};let p;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(let b=0;b<u[p].morphTargets.length;b++)h[u[p].morphTargets[b]]=-1;for(const b in h){const y=[],m=[];for(let f=0;f!==u[p].morphTargets.length;++f){const G=u[p];y.push(G.time),m.push(G.morphTarget===b?1:0)}r.push(new Pv(".morphTargetInfluence["+b+"]",y,m))}l=h.length*(o||1)}else{const h=".bones["+t[d].name+"]";n(Dv,h+".position",u,"pos",r),n(o0,h+".quaternion",u,"rot",r),n(Dv,h+".scale",u,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ACe(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Pv;case"vector":case"vector2":case"vector3":case"vector4":return Dv;case"color":return uY;case"quaternion":return o0;case"bool":case"boolean":return Bf;case"string":return Sf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function bCe(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ACe(i.type);if(i.times===void 0){const t=[],n=[];Qn.flattenJSON(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Zf={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class yCe{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(g){a++,s===!1&&r.onStart!==void 0&&r.onStart(g,o,a),s=!0},this.itemEnd=function(g){o++,r.onProgress!==void 0&&r.onProgress(g,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return l?l(g):g},this.setURLModifier=function(g){return l=g,this},this.addHandler=function(g,d){return c.push(g,d),this},this.removeHandler=function(g){const d=c.indexOf(g);return d!==-1&&c.splice(d,2),this},this.getHandler=function(g){for(let d=0,u=c.length;d<u;d+=2){const h=c[d],p=c[d+1];if(h.global&&(h.lastIndex=0),h.test(g))return p}return null}}}const vCe=new yCe;class Qc{constructor(e){this.manager=e!==void 0?e:vCe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const hl={};class xCe extends Qc{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Zf.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(hl[e]!==void 0){hl[e].push({onLoad:t,onProgress:n,onError:r});return}hl[e]=[],hl[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body.getReader===void 0)return c;const g=hl[e],d=c.body.getReader(),u=c.headers.get("Content-Length"),h=u?parseInt(u):0,p=h!==0;let b=0;const y=new ReadableStream({start(m){f();function f(){d.read().then(({done:G,value:x})=>{if(G)m.close();else{b+=x.byteLength;const B=new ProgressEvent("progress",{lengthComputable:p,loaded:b,total:h});for(let M=0,E=g.length;M<E;M++){const z=g[M];z.onProgress&&z.onProgress(B)}m.enqueue(x),f()}})}}});return new Response(y)}else throw Error(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(g=>new DOMParser().parseFromString(g,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),u=d&&d[1]?d[1].toLowerCase():void 0,h=new TextDecoder(u);return c.arrayBuffer().then(p=>h.decode(p))}}}).then(c=>{Zf.add(e,c);const g=hl[e];delete hl[e];for(let d=0,u=g.length;d<u;d++){const h=g[d];h.onLoad&&h.onLoad(c)}}).catch(c=>{const g=hl[e];if(g===void 0)throw this.manager.itemError(e),c;delete hl[e];for(let d=0,u=g.length;d<u;d++){const h=g[d];h.onError&&h.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class hY extends Qc{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Zf.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Lp("img");function l(){g(),Zf.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){g(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function g(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class wCe extends Qc{constructor(e){super(e)}load(e,t,n,r){const s=new Gv,o=new hY(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(g){s.images[c]=g,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class GCe extends Qc{constructor(e){super(e)}load(e,t,n,r){const s=new Xi,o=new hY(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class Ia extends fn{constructor(e,t=1){super();this.type="Light",this.color=new Bt(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Ia.prototype.isLight=!0;class BCe extends Ia{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(fn.DefaultUp),this.updateMatrix(),this.groundColor=new Bt(t)}copy(e){return Ia.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}BCe.prototype.isHemisphereLight=!0;const fY=new Vt,IY=new fe,CY=new fe;class uR{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new je(512,512),this.map=null,this.mapPass=null,this.matrix=new Vt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Sv,this._frameExtents=new je(1,1),this._viewportCount=1,this._viewports=[new _n(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;IY.setFromMatrixPosition(e.matrixWorld),t.position.copy(IY),CY.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(CY),t.updateMatrixWorld(),fY.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fY),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class pY extends uR{constructor(){super(new ls(50,1,.5,500));this.focus=1}updateMatrices(e){const t=this.camera,n=u3*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}pY.prototype.isSpotLightShadow=!0;class SCe extends Ia{constructor(e,t,n=0,r=Math.PI/3,s=0,o=1){super(e,t);this.type="SpotLight",this.position.copy(fn.DefaultUp),this.updateMatrix(),this.target=new fn,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.shadow=new pY}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SCe.prototype.isSpotLight=!0;const mY=new Vt,a0=new fe,dR=new fe;class AY extends uR{constructor(){super(new ls(90,1,.5,500));this._frameExtents=new je(4,2),this._viewportCount=6,this._viewports=[new _n(2,1,1,1),new _n(0,1,1,1),new _n(3,1,1,1),new _n(1,1,1,1),new _n(3,0,1,1),new _n(1,0,1,1)],this._cubeDirections=[new fe(1,0,0),new fe(-1,0,0),new fe(0,0,1),new fe(0,0,-1),new fe(0,1,0),new fe(0,-1,0)],this._cubeUps=[new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,0,1),new fe(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),a0.setFromMatrixPosition(e.matrixWorld),n.position.copy(a0),dR.copy(n.position),dR.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(dR),n.updateMatrixWorld(),r.makeTranslation(-a0.x,-a0.y,-a0.z),mY.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mY)}}AY.prototype.isPointLightShadow=!0;class ZCe extends Ia{constructor(e,t,n=0,r=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new AY}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}ZCe.prototype.isPointLight=!0;class bY extends uR{constructor(){super(new T3(-5,5,5,-5,.5,500))}}bY.prototype.isDirectionalLightShadow=!0;class RCe extends Ia{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(fn.DefaultUp),this.updateMatrix(),this.target=new fn,this.shadow=new bY}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}RCe.prototype.isDirectionalLight=!0;class MCe extends Ia{constructor(e,t){super(e,t);this.type="AmbientLight"}}MCe.prototype.isAmbientLight=!0;class WCe extends Ia{constructor(e,t,n=10,r=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}WCe.prototype.isRectAreaLight=!0;class yY{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new fe)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}yY.prototype.isSphericalHarmonics3=!0;class hR extends Ia{constructor(e=new yY,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}hR.prototype.isLightProbe=!0;class _Ce{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class VCe extends Jn{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}VCe.prototype.isInstancedBufferGeometry=!0;class NCe extends Qc{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Zf.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Zf.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}NCe.prototype.isImageBitmapLoader=!0;let Uv;const ECe={getContext:function(){return Uv===void 0&&(Uv=new(window.AudioContext||window.webkitAudioContext)),Uv},setContext:function(i){Uv=i}};class HCe extends Qc{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new xCe(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const l=a.slice(0);ECe.getContext().decodeAudioData(l,function(g){t(g)})}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}}class FCe extends hR{constructor(e,t,n=1){super(void 0,n);const r=new Bt().set(e),s=new Bt().set(t),o=new fe(r.r,r.g,r.b),a=new fe(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}FCe.prototype.isHemisphereLightProbe=!0;class LCe extends hR{constructor(e,t=1){super(void 0,t);const n=new Bt().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}LCe.prototype.isAmbientLightProbe=!0;class TCe extends fn{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class XCe{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){rr.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;rr.multiplyQuaternionsFlat(e,o,e,t,e,n),rr.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const fR="\\[\\]\\.:\\/",zCe=new RegExp("["+fR+"]","g"),IR="[^"+fR+"]",kCe="[^"+fR.replace("\\.","")+"]",YCe=/((?:WC+[\/:])*)/.source.replace("WC",IR),KCe=/(WCOD+)?/.source.replace("WCOD",kCe),PCe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",IR),DCe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",IR),UCe=new RegExp("^"+YCe+KCe+PCe+DCe+"$"),OCe=["material","materials","bones"];class JCe{constructor(e,t,n){const r=n||yn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class yn{constructor(e,t,n){this.path=t,this.parsedPath=n||yn.parseTrackName(t),this.node=yn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new yn.Composite(e,t,n):new yn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(zCe,"")}static parseTrackName(e){const t=UCe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);OCe.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=yn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===c){c=g;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}yn.Composite=JCe;yn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};yn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};yn.prototype.GetterByBindingType=[yn.prototype._getValue_direct,yn.prototype._getValue_array,yn.prototype._getValue_arrayElement,yn.prototype._getValue_toArray];yn.prototype.SetterByBindingTypeAndVersioning=[[yn.prototype._setValue_direct,yn.prototype._setValue_direct_setNeedsUpdate,yn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[yn.prototype._setValue_array,yn.prototype._setValue_array_setNeedsUpdate,yn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[yn.prototype._setValue_arrayElement,yn.prototype._setValue_arrayElement_setNeedsUpdate,yn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[yn.prototype._setValue_fromArray,yn.prototype._setValue_fromArray_setNeedsUpdate,yn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class QCe{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Jh,endingEnd:Jh};for(let c=0;c!==o;++c){const g=s[c].createInterpolant(null);a[c]=g,g.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Wge,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case Sz:for(let g=0,d=l.length;g!==d;++g)l[g].evaluate(o),c[g].accumulateAdditive(a);break;case a3:default:for(let g=0,d=l.length;g!==d;++g)l[g].evaluate(o),c[g].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===_ge;if(e===0)return s===-1?r:o&&(s&1)==1?t-r:r;if(n===Mge){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)==1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Qh,r.endingEnd=Qh):(e?r.endingStart=this.zeroSlopeAtStart?Qh:Jh:r.endingStart=av,t?r.endingEnd=this.zeroSlopeAtEnd?Qh:Jh:r.endingEnd=av)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}class jCe extends bu{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let g=c[l];g===void 0&&(g={},c[l]=g);for(let d=0;d!==s;++d){const u=r[d],h=u.name;let p=g[h];if(p!==void 0)++p.referenceCount,o[d]=p;else{if(p=o[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,h));continue}const b=t&&t._propertyBindings[d].binding.parsedPath;p=new XCe(yn.create(n,h,b),u.ValueTypeName,u.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,h),o[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++==0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount==0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],g=e._byClipCacheIndex;c._byClipCacheIndex=g,l[g]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,u=(e._localRoot||this._root).uuid;delete d[u],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount==0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new gY(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?dY.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=a3),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===n)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const g=new QCe(this,o,t,n);return this._bindAction(g,c),this._addInactiveAction(g,a,s),g}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?dY.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const g=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=g,t[g]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}jCe.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class qCe extends Dp{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}qCe.prototype.isInstancedInterleavedBuffer=!0;const jc=new fe,Ov=new Vt,CR=new Vt;class $Ce extends q3{constructor(e){const t=vY(e),n=new Jn,r=[],s=[],o=new Bt(0,0,1),a=new Bt(0,1,0);for(let c=0;c<t.length;c++){const g=t[c];g.parent&&g.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new zi(r,3)),n.setAttribute("color",new zi(s,3));const l=new $p({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");CR.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(Ov.multiplyMatrices(CR,a.matrixWorld),jc.setFromMatrixPosition(Ov),r.setXYZ(o,jc.x,jc.y,jc.z),Ov.multiplyMatrices(CR,a.parent.matrixWorld),jc.setFromMatrixPosition(Ov),r.setXYZ(o+1,jc.x,jc.y,jc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function vY(i){const e=[];i&&i.isBone&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,vY(i.children[t]));return e}class epe extends q3{constructor(e=10,t=10,n=4473924,r=8947848){n=new Bt(n),r=new Bt(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let u=0,h=0,p=-a;u<=t;u++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const b=u===s?n:r;b.toArray(c,h),h+=3,b.toArray(c,h),h+=3,b.toArray(c,h),h+=3,b.toArray(c,h),h+=3}const g=new Jn;g.setAttribute("position",new zi(l,3)),g.setAttribute("color",new zi(c,3));const d=new $p({vertexColors:!0,toneMapped:!1});super(g,d);this.type="GridHelper"}}const tpe=new Float32Array(1);new Int32Array(tpe.buffer);eo.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(eo.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i};aR.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};epe.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};$Ce.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Qc.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),_Ce.extractUrlBase(i)};Qc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};So.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};So.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};So.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};So.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};So.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};rf.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Sv.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};ir.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};ir.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};ir.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};ir.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};ir.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};ir.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};Vt.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};Vt.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};Vt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new fe().setFromMatrixColumn(this,3)};Vt.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};Vt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Vt.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Vt.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Vt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Vt.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};Vt.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Vt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Vt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Vt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Vt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Vt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Vt.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Vt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Vt.prototype.makeFrustum=function(i,e,t,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,n,t,r,s)};Vt.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};dl.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};rr.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};rr.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};sf.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};sf.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};sf.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};vi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};vi.prototype.barycoordFromPoint=function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)};vi.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};vi.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};vi.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};vi.barycoordFromPoint=function(i,e,t,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),vi.getBarycoord(i,e,t,n,r)};vi.normal=function(i,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),vi.getNormal(i,e,t,n)};n0.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};n0.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Gf(this,i)};n0.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new gR(this,i)};je.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};je.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};je.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};fe.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};fe.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};fe.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};fe.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};fe.prototype.getColumnFromMatrix=function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)};fe.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};fe.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};fe.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};fe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};_n.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};_n.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};fn.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};fn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};fn.prototype.translate=function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)};fn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};fn.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(fn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});as.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(as.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Vge},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Xk.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};ls.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)};Object.defineProperties(Ia.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(_i.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Fp},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Fp)}}});_i.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Fp:Hp),this};_i.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},_i.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Jn.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};Jn.prototype.addAttribute=function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new _i(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)};Jn.prototype.addDrawCall=function(i,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)};Jn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Jn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Jn.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};Jn.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Jn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Dp.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Fp:Hp),this};Dp.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Gf.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Gf.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Gf.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Wk.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(xr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Bt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===JX}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Bu.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});wn.prototype.clearTarget=function(i,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,t,n)};wn.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};wn.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};wn.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};wn.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};wn.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};wn.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};wn.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};wn.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};wn.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};wn.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};wn.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};wn.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};wn.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};wn.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};wn.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};wn.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};wn.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};wn.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};wn.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};wn.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};wn.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};wn.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};wn.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};wn.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(wn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?On:Fc}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(Rk.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(qs.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});TCe.prototype.load=function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new HCe().load(i,function(n){e.setBuffer(n)}),this};H3.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)};H3.prototype.clear=function(i,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,t,n)};yu.crossOrigin=void 0;yu.loadTexture=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new GCe;r.setCrossOrigin(this.crossOrigin);const s=r.load(i,t,void 0,n);return e&&(s.mapping=e),s};yu.loadTextureCube=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new wCe;r.setCrossOrigin(this.crossOrigin);const s=r.load(i,t,void 0,n);return e&&(s.mapping=e),s};yu.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};yu.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:JZ}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=JZ);var pR={exports:{}},Rf=typeof Reflect=="object"?Reflect:null,xY=Rf&&typeof Rf.apply=="function"?Rf.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Jv;Rf&&typeof Rf.ownKeys=="function"?Jv=Rf.ownKeys:Object.getOwnPropertySymbols?Jv=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Jv=function(e){return Object.getOwnPropertyNames(e)};function npe(i){console&&console.warn&&console.warn(i)}var wY=Number.isNaN||function(e){return e!==e};function Gn(){Gn.init.call(this)}pR.exports=Gn;pR.exports.once=ope;Gn.EventEmitter=Gn;Gn.prototype._events=void 0;Gn.prototype._eventsCount=0;Gn.prototype._maxListeners=void 0;var GY=10;function Qv(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Gn,"defaultMaxListeners",{enumerable:!0,get:function(){return GY},set:function(i){if(typeof i!="number"||i<0||wY(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");GY=i}});Gn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Gn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||wY(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function BY(i){return i._maxListeners===void 0?Gn.defaultMaxListeners:i._maxListeners}Gn.prototype.getMaxListeners=function(){return BY(this)};Gn.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")xY(l,this,t);else for(var c=l.length,g=WY(l,c),n=0;n<c;++n)xY(g[n],this,t);return!0};function SY(i,e,t,n){var r,s,o;if(Qv(t),s=i._events,s===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),s=i._events),o=s[e]),o===void 0)o=s[e]=t,++i._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),r=BY(i),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=e,a.count=o.length,npe(a)}return i}Gn.prototype.addListener=function(e,t){return SY(this,e,t,!1)};Gn.prototype.on=Gn.prototype.addListener;Gn.prototype.prependListener=function(e,t){return SY(this,e,t,!0)};function ipe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ZY(i,e,t){var n={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},r=ipe.bind(n);return r.listener=t,n.wrapFn=r,r}Gn.prototype.once=function(e,t){return Qv(t),this.on(e,ZY(this,e,t)),this};Gn.prototype.prependOnceListener=function(e,t){return Qv(t),this.prependListener(e,ZY(this,e,t)),this};Gn.prototype.removeListener=function(e,t){var n,r,s,o,a;if(Qv(t),r=this._events,r===void 0)return this;if(n=r[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():rpe(n,s),n.length===1&&(r[e]=n[0]),r.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Gn.prototype.off=Gn.prototype.removeListener;Gn.prototype.removeAllListeners=function(e){var t,n,r;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function RY(i,e,t){var n=i._events;if(n===void 0)return[];var r=n[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?spe(r):WY(r,r.length)}Gn.prototype.listeners=function(e){return RY(this,e,!0)};Gn.prototype.rawListeners=function(e){return RY(this,e,!1)};Gn.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):MY.call(i,e)};Gn.prototype.listenerCount=MY;function MY(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Gn.prototype.eventNames=function(){return this._eventsCount>0?Jv(this._events):[]};function WY(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i[n];return t}function rpe(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function spe(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function ope(i,e){return new Promise(function(t,n){function r(o){i.removeListener(e,s),n(o)}function s(){typeof i.removeListener=="function"&&i.removeListener("error",r),t([].slice.call(arguments))}_Y(i,e,s,{once:!0}),e!=="error"&&ape(i,r,{once:!0})})}function ape(i,e,t){typeof i.on=="function"&&_Y(i,"error",e,t)}function _Y(i,e,t,n){if(typeof i.on=="function")n.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function r(s){n.once&&i.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var lpe=pR.exports;function cpe(i,e){var t=atob(i);if(e){for(var n=new Uint8Array(t.length),r=0,s=t.length;r<s;++r)n[r]=t.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return t}function gpe(i,e,t){var n=e===void 0?null:e,r=t===void 0?!1:t,s=cpe(i,r),o=s.indexOf(`
`,10)+1,a=s.substring(o)+(n?"//# sourceMappingURL="+n:""),l=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(l)}function upe(i,e,t){var n;return function(s){return n=n||gpe(i,e,t),new Worker(n,s)}}var dpe=upe("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQogIGNvbnN0IG1heG1pbkEgPSBbXTsKICBjb25zdCBtYXhtaW5CID0gW107CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgM2QgYm94IHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNpemUgPSAxCiAgICogICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gbmV3IENBTk5PTi5WZWMzKHNpemUsIHNpemUsIHNpemUpCiAgICogICAgIGNvbnN0IGJveFNoYXBlID0gbmV3IENBTk5PTi5Cb3goaGFsZkV4dGVudHMpCiAgICogICAgIGNvbnN0IGJveEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogYm94U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib3hCb2R5KQogICAqLwogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKCiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwogIGNvbnN0IEJPRFlfU0xFRVBfU1RBVEVTID0gewogICAgLyoqIEFXQUtFICovCiAgICBBV0FLRTogMCwKCiAgICAvKiogU0xFRVBZICovCiAgICBTTEVFUFk6IDEsCgogICAgLyoqIFNMRUVQSU5HICovCiAgICBTTEVFUElORzogMgogIH07CiAgLyoqCiAgICogQm9keVNsZWVwU3RhdGUKICAgKi8KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYWxsIGJvZHkgdHlwZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZSgxKQogICAqICAgICBjb25zdCBib2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsKICAgKiAgICAgICBtYXNzOiAxLAogICAqICAgICAgIHNoYXBlLAogICAqICAgICB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHkpCiAgICovCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnZsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IDE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW5pdFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMudmVsb2NpdHkpIHsKICAgICAgICB0aGlzLnZlbG9jaXR5LmNvcHkob3B0aW9ucy52ZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5mb3JjZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG1hc3MgPSB0eXBlb2Ygb3B0aW9ucy5tYXNzID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubWFzcyA6IDA7CiAgICAgIHRoaXMubWFzcyA9IG1hc3M7CiAgICAgIHRoaXMuaW52TWFzcyA9IG1hc3MgPiAwID8gMS4wIC8gbWFzcyA6IDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBvcHRpb25zLm1hdGVyaWFsIHx8IG51bGw7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmxpbmVhckRhbXBpbmcgPT09ICdudW1iZXInID8gb3B0aW9ucy5saW5lYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy50eXBlID0gbWFzcyA8PSAwLjAgPyBCb2R5LlNUQVRJQyA6IEJvZHkuRFlOQU1JQzsKCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50eXBlID09PSB0eXBlb2YgQm9keS5TVEFUSUMpIHsKICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAgIH0KCiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHR5cGVvZiBvcHRpb25zLmFsbG93U2xlZXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbGxvd1NsZWVwIDogdHJ1ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgOiAwLjE7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwVGltZUxpbWl0IDogMTsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICB0aGlzLnRvcnF1ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuc2hhcGVzID0gW107CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gW107CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5pbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuZml4ZWRSb3RhdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZpeGVkUm90YXRpb24gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5maXhlZFJvdGF0aW9uIDogZmFsc2U7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5hbmd1bGFyRGFtcGluZyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ3VsYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy5saW5lYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmxpbmVhckZhY3RvcikgewogICAgICAgIHRoaXMubGluZWFyRmFjdG9yLmNvcHkob3B0aW9ucy5saW5lYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IuY29weShvcHRpb25zLmFuZ3VsYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSAwOwogICAgICB0aGlzLndsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmlzVHJpZ2dlciA9IEJvb2xlYW4ob3B0aW9ucy5pc1RyaWdnZXIpOwoKICAgICAgaWYgKG9wdGlvbnMuc2hhcGUpIHsKICAgICAgICB0aGlzLmFkZFNoYXBlKG9wdGlvbnMuc2hhcGUpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFdha2UgdGhlIGJvZHkgdXAuCiAgICAgKi8KCgogICAgd2FrZVVwKCkgewogICAgICBjb25zdCBwcmV2U3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwoKICAgICAgaWYgKHByZXZTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5Lndha2V1cEV2ZW50KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBGb3JjZSBib2R5IHNsZWVwCiAgICAgKi8KCgogICAgc2xlZXAoKSB7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBJTkc7CiAgICAgIHRoaXMudmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZXN0ZXAgdG8gdXBkYXRlIGludGVybmFsIHNsZWVwIHRpbWVyIGFuZCBjaGFuZ2Ugc2xlZXAgc3RhdGUgaWYgbmVlZGVkLgogICAgICogQHBhcmFtIHRpbWUgVGhlIHdvcmxkIHRpbWUgaW4gc2Vjb25kcwogICAgICovCgoKICAgIHNsZWVwVGljayh0aW1lKSB7CiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBjb25zdCBzbGVlcFN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgdGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkID0gdGhpcy5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgc3BlZWRTcXVhcmVkIDwgc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBZOyAvLyBTbGVlcHkKCiAgICAgICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gdGltZTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVweUV2ZW50KTsKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHNwZWVkU3F1YXJlZCA+IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLndha2VVcCgpOyAvLyBXYWtlIHVwCiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiB0aW1lIC0gdGhpcy50aW1lTGFzdFNsZWVweSA+IHRoaXMuc2xlZXBUaW1lTGltaXQpIHsKICAgICAgICAgIHRoaXMuc2xlZXAoKTsgLy8gU2xlZXBpbmcKCiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcEV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSWYgdGhlIGJvZHkgaXMgc2xlZXBpbmcsIGl0IHNob3VsZCBiZSBpbW1vdmFibGUgLyBoYXZlIGluZmluaXRlIG1hc3MgZHVyaW5nIHNvbHZlLiBXZSBzb2x2ZSBpdCBieSBoYXZpbmcgYSBzZXBhcmF0ZSAic29sdmUgbWFzcyIuCiAgICAgKi8KCgogICAgdXBkYXRlU29sdmVNYXNzUHJvcGVydGllcygpIHsKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLnNldFplcm8oKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLnNldFplcm8oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IHRoaXMuaW52TWFzczsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYSk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgcG9pbnQgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvTG9jYWxGcmFtZSh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQod29ybGRWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CgogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7IGVsc2UgewogICAgICAgIGNvbnN0IG0xID0gdWl3X20xOwogICAgICAgIGNvbnN0IG0yID0gdWl3X20yOwogICAgICAgIG0xLnNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24odGhpcy5xdWF0ZXJuaW9uKTsKICAgICAgICBtMS50cmFuc3Bvc2UobTIpOwogICAgICAgIG0xLnNjYWxlKEksIG0xKTsKICAgICAgICBtMS5tbXVsdChtMiwgdGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgcG9pbnQgb2YgdGhlIGJvZHkuIFRoaXMgY291bGQgZm9yIGV4YW1wbGUgYmUgYSBwb2ludCBvbiB0aGUgQm9keSBzdXJmYWNlLgogICAgICogQXBwbHlpbmcgZm9yY2UgdGhpcyB3YXkgd2lsbCBhZGQgdG8gQm9keS5mb3JjZSBhbmQgQm9keS50b3JxdWUuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGFtb3VudCBvZiBmb3JjZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZShmb3JjZSwgcmVsYXRpdmVQb2ludCkgewogICAgICBpZiAocmVsYXRpdmVQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50KSB7CiAgICAgIGlmIChsb2NhbFBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB3b3JsZEZvcmNlID0gQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZTsKICAgICAgY29uc3QgcmVsYXRpdmVQb2ludFdvcmxkID0gQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkOyAvLyBUcmFuc2Zvcm0gdGhlIGZvcmNlIHZlY3RvciB0byB3b3JsZCBzcGFjZQoKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxGb3JjZSwgd29ybGRGb3JjZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlGb3JjZSh3b3JsZEZvcmNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0b3JxdWUgdG8gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gdG9ycXVlIFRoZSBhbW91bnQgb2YgdG9ycXVlIHRvIGFkZC4KICAgICAqLwoKCiAgICBhcHBseVRvcnF1ZSh0b3JxdWUpIHsKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIHRoaXMudG9ycXVlLnZhZGQodG9ycXVlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGltcHVsc2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBbiBpbXB1bHNlIGlzIGEgZm9yY2UgYWRkZWQgdG8gYSBib2R5IGR1cmluZyBhIHNob3J0IHBlcmlvZCBvZiB0aW1lIChpbXB1bHNlID0gZm9yY2UgKiB0aW1lKS4KICAgICAqIEltcHVsc2VzIHdpbGwgYmUgYWRkZWQgdG8gQm9keS52ZWxvY2l0eSBhbmQgQm9keS5hbmd1bGFyVmVsb2NpdHkuCiAgICAgKiBAcGFyYW0gaW1wdWxzZSBUaGUgYW1vdW50IG9mIGltcHVsc2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHBvaW50IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBib2R5IGNlbnRlcgoKCiAgICAgIGNvbnN0IHIgPSByZWxhdGl2ZVBvaW50OyAvLyBDb21wdXRlIHByb2R1Y2VkIGNlbnRyYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3QgdmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG87CiAgICAgIHZlbG8uY29weShpbXB1bHNlKTsKICAgICAgdmVsby5zY2FsZSh0aGlzLmludk1hc3MsIHZlbG8pOyAvLyBBZGQgbGluZWFyIGltcHVsc2UKCiAgICAgIHRoaXMudmVsb2NpdHkudmFkZCh2ZWxvLCB0aGlzLnZlbG9jaXR5KTsgLy8gQ29tcHV0ZSBwcm9kdWNlZCByb3RhdGlvbmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHJvdFZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvOwogICAgICByLmNyb3NzKGltcHVsc2UsIHJvdFZlbG8pOwogICAgICAvKgogICAgICAgcm90VmVsby54ICo9IHRoaXMuaW52SW5lcnRpYS54OwogICAgICAgcm90VmVsby55ICo9IHRoaXMuaW52SW5lcnRpYS55OwogICAgICAgcm90VmVsby56ICo9IHRoaXMuaW52SW5lcnRpYS56OwogICAgICAgKi8KCiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkLnZtdWx0KHJvdFZlbG8sIHJvdFZlbG8pOyAvLyBBZGQgcm90YXRpb25hbCBJbXB1bHNlCgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS52YWRkKHJvdFZlbG8sIHRoaXMuYW5ndWxhclZlbG9jaXR5KTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgbG9jYWxseS1kZWZpbmVkIGltcHVsc2UgdG8gYSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgZm9yY2UgdmVjdG9yIHRvIGFwcGx5LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGJvZHkgZnJhbWUuCiAgICAgKiBAcGFyYW0gbG9jYWxQb2ludCBBIGxvY2FsIHBvaW50IGluIHRoZSBib2R5IHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUxvY2FsSW1wdWxzZShsb2NhbEltcHVsc2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIG5ldyBNYXQzKCk7CiAgY29uc3QgQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfdXBkYXRlTWFzc1Byb3BlcnRpZXNfaGFsZkV4dGVudHMgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KICBjbGFzcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBmb3IgY29sbGlzaW9ucyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIHRydWUsIHRoZSBicm9hZHBoYXNlIHVzZXMgYm91bmRpbmcgYm94ZXMgZm9yIGludGVyc2VjdGlvbiB0ZXN0cywgZWxzZSBpdCB1c2VzIGJvdW5kaW5nIHNwaGVyZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIGlmIHRoZSBvYmplY3RzIGluIHRoZSB3b3JsZCBtb3ZlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGAke2lkMX0sJHtpZDJ9YCA6IGAke2lkMn0sJHtpZDF9YDsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgogIGNvbnN0IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfciA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUXVhdGVybmlvbigpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcCA9IHsKICAgIGtleXM6IFtdCiAgfTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMSA9IFtdOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyID0gW107CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KICBjbGFzcyBOYWl2ZUJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgdGhlIGNvbGxpc2lvbiBwYWlycyBpbiB0aGUgcGh5c2ljcyB3b3JsZAogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IG4gPSBib2RpZXMubGVuZ3RoOwogICAgICBsZXQgYmk7CiAgICAgIGxldCBiajsgLy8gTmFpdmUgTl4yIGZ0dyEKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gaTsgaisrKSB7CiAgICAgICAgICBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwogIGNsYXNzIFJheWNhc3RSZXN1bHQgewogICAgLyoqCiAgICAgKiByYXlGcm9tV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogcmF5VG9Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXROb3JtYWxXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXRQb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhhc0hpdAogICAgICovCgogICAgLyoqCiAgICAgKiBzaGFwZQogICAgICovCgogICAgLyoqCiAgICAgKiBib2R5CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGUgaGl0IHRyaWFuZ2xlLCBpZiB0aGUgaGl0IHNoYXBlIHdhcyBhIHRyaW1lc2gKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzdGFuY2UgdG8gdGhlIGhpdC4gV2lsbCBiZSBzZXQgdG8gLTEgaWYgdGhlcmUgd2FzIG5vIGhpdAogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgcmF5IHNob3VsZCBzdG9wIHRyYXZlcnNpbmcgdGhlIGJvZGllcwogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKCiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCiAgY29uc3QgUkFZX01PREVTID0gewogICAgLyoqIENMT1NFU1QgKi8KICAgIENMT1NFU1Q6IDEsCgogICAgLyoqIEFOWSAqLwogICAgQU5ZOiAyLAoKICAgIC8qKiBBTEwgKi8KICAgIEFMTDogNAogIH07CiAgLyoqCiAgICogUmF5TW9kZQogICAqLwoKICBfU2hhcGUkdHlwZXMkU1BIRVJFID0gU2hhcGUudHlwZXMuU1BIRVJFOwogIF9TaGFwZSR0eXBlcyRQTEFORSA9IFNoYXBlLnR5cGVzLlBMQU5FOwogIF9TaGFwZSR0eXBlcyRCT1ggPSBTaGFwZS50eXBlcy5CT1g7CiAgX1NoYXBlJHR5cGVzJENZTElOREVSID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgX1NoYXBlJHR5cGVzJENPTlZFWFBPID0gU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTjsKICBfU2hhcGUkdHlwZXMkSEVJR0hURkkgPSBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRDsKICBfU2hhcGUkdHlwZXMkVFJJTUVTSCA9IFNoYXBlLnR5cGVzLlRSSU1FU0g7CgogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwogIGNsYXNzIFJheSB7CiAgICAvKioKICAgICAqIGZyb20KICAgICAqLwoKICAgIC8qKgogICAgICogdG8KICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwcmVjaXNpb24gb2YgdGhlIHJheS4gVXNlZCB3aGVuIGNoZWNraW5nIHBhcmFsbGVsaXR5IGV0Yy4KICAgICAqIEBkZWZhdWx0IDAuMDAwMQogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gYGZhbHNlYCBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgUmF5IHRvIHRha2UgYGNvbGxpc2lvblJlc3BvbnNlYCBmbGFncyBpbnRvIGFjY291bnQgb24gYm9kaWVzIGFuZCBzaGFwZXMuCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSByYXkgc2tpcHMgYW55IGhpdHMgd2l0aCBub3JtYWwuZG90KHJheURpcmVjdGlvbikgPCAwLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyTWFzawogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyR3JvdXAKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbnRlcnNlY3Rpb24gbW9kZS4gU2hvdWxkIGJlIFJheS5BTlksIFJheS5BTEwgb3IgUmF5LkNMT1NFU1QuCiAgICAgKiBAZGVmYXVsdCBSQVkuQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEN1cnJlbnQgcmVzdWx0IG9iamVjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogV2lsbCBiZSBzZXQgdG8gYHRydWVgIGR1cmluZyBpbnRlcnNlY3RXb3JsZCgpIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VyLXByb3ZpZGVkIHJlc3VsdCBjYWxsYmFjay4gV2lsbCBiZSB1c2VkIGlmIG1vZGUgaXMgUmF5LkFMTC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ0xPU0VTVAogICAgICovCgogICAgLyoqCiAgICAgKiBBTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQUxMCiAgICAgKi8KICAgIGdldCBbX1NoYXBlJHR5cGVzJFNQSEVSRV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkUExBTkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0UGxhbmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQk9YXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEJveDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDWUxJTkRFUl0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ09OVkVYUE9dKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEhFSUdIVEZJXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFRSSU1FU0hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0VHJpbWVzaDsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcihmcm9tLCB0bykgewogICAgICBpZiAoZnJvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgZnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0byA9PT0gdm9pZCAwKSB7CiAgICAgICAgdG8gPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLmZyb20gPSBmcm9tLmNsb25lKCk7CiAgICAgIHRoaXMudG8gPSB0by5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gMC4wMDAxOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0cnVlOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSBmYWxzZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSAtMTsKICAgICAgdGhpcy5tb2RlID0gUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwoKICAgICAgdGhpcy5jYWxsYmFjayA9IHJlc3VsdCA9PiB7fTsKICAgIH0KICAgIC8qKgogICAgICogRG8gaXRlcnNlY3Rpb24gYWdhaW5zdCBhbGwgYm9kaWVzIGluIHRoZSBnaXZlbiBXb3JsZC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZywgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCgoKICAgIGludGVyc2VjdFdvcmxkKHdvcmxkLCBvcHRpb25zKSB7CiAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZSB8fCBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG9wdGlvbnMucmVzdWx0IHx8IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9ICEhb3B0aW9ucy5za2lwQmFja2ZhY2VzOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IC0xOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CgogICAgICBpZiAob3B0aW9ucy5mcm9tKSB7CiAgICAgICAgdGhpcy5mcm9tLmNvcHkob3B0aW9ucy5mcm9tKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG8pIHsKICAgICAgICB0aGlzLnRvLmNvcHkob3B0aW9ucy50byk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIHx8ICgoKSA9PiB7fSk7CgogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnJlc3VsdC5yZXNldCgpOwogICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB0aGlzLmdldEFBQkIodG1wQUFCQiQxKTsKICAgICAgdG1wQXJyYXkubGVuZ3RoID0gMDsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5hYWJiUXVlcnkod29ybGQsIHRtcEFBQkIkMSwgdG1wQXJyYXkpOwogICAgICB0aGlzLmludGVyc2VjdEJvZGllcyh0bXBBcnJheSk7CiAgICAgIHJldHVybiB0aGlzLmhhc0hpdDsKICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYSBib2R5LCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9keShib2R5LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2U7CgogICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhYm9keS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCh0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHhpID0gaW50ZXJzZWN0Qm9keV94aTsKICAgICAgY29uc3QgcWkgPSBpbnRlcnNlY3RCb2R5X3FpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSBib2R5LnNoYXBlcy5sZW5ndGg7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IGJvZHkuc2hhcGVzW2ldOwoKICAgICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhc2hhcGUuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwCiAgICAgICAgfQoKICAgICAgICBib2R5LnF1YXRlcm5pb24ubXVsdChib2R5LnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLnZtdWx0KGJvZHkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgeGkudmFkZChib2R5LnBvc2l0aW9uLCB4aSk7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RTaGFwZShzaGFwZSwgcWksIHhpLCBib2R5KTsKCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhbiBhcnJheSBib2RpZXMsIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAcGFyYW0gYm9kaWVzIEFuIGFycmF5IG9mIEJvZHkgb2JqZWN0cy4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICoKICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2RpZXMoYm9kaWVzLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYm9kaWVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuaW50ZXJzZWN0Qm9keShib2RpZXNbaV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAgKi8KCgogICAgdXBkYXRlRGlyZWN0aW9uKCkgewogICAgICB0aGlzLnRvLnZzdWIodGhpcy5mcm9tLCB0aGlzLmRpcmVjdGlvbik7CiAgICAgIHRoaXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgfQoKICAgIGludGVyc2VjdFNoYXBlKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOyAvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZQoKICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgdGhpcy5kaXJlY3Rpb24sIHBvc2l0aW9uKTsKCiAgICAgIGlmIChkaXN0YW5jZSA+IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBpbnRlcnNlY3RNZXRob2QgPSB0aGlzW3NoYXBlLnR5cGVdOwoKICAgICAgaWYgKGludGVyc2VjdE1ldGhvZCkgewogICAgICAgIGludGVyc2VjdE1ldGhvZC5jYWxsKHRoaXMsIHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgc2hhcGUpOwogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdEJveChib3gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXgoYm94LmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpOwogICAgfQoKICAgIF9pbnRlcnNlY3RQbGFuZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBuZXcgVmVjMygwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICBjb25zdCBsZW4gPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9Gcm9tID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgIHRvLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9UbyA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwoKICAgICAgaWYgKHBsYW5lVG9Gcm9tICogcGxhbmVUb1RvID4gMCkgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBhcmUgb24gdGhlIHNhbWUgc2lkZSBvZiB0aGUgcGxhbmUuLi4gYmFpbCBvdXQKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmcm9tLmRpc3RhbmNlVG8odG8pIDwgcGxhbmVUb0Zyb20pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG5fZG90X2RpciA9IHdvcmxkTm9ybWFsLmRvdChkaXJlY3Rpb24pOwoKICAgICAgaWYgKE1hdGguYWJzKG5fZG90X2RpcikgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcGxhbmVQb2ludFRvRnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRpcl9zY2FsZWRfd2l0aF90ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgcGxhbmVQb2ludFRvRnJvbSk7CiAgICAgIGNvbnN0IHQgPSAtd29ybGROb3JtYWwuZG90KHBsYW5lUG9pbnRUb0Zyb20pIC8gbl9kb3RfZGlyOwogICAgICBkaXJlY3Rpb24uc2NhbGUodCwgZGlyX3NjYWxlZF93aXRoX3QpOwogICAgICBmcm9tLnZhZGQoZGlyX3NjYWxlZF93aXRoX3QsIGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHdvcmxkIEFBQkIgb2YgdGhlIHJheS4KICAgICAqLwoKCiAgICBnZXRBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgewogICAgICAgIGxvd2VyQm91bmQsCiAgICAgICAgdXBwZXJCb3VuZAogICAgICB9ID0gYWFiYjsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBsb3dlckJvdW5kLnggPSBNYXRoLm1pbih0by54LCBmcm9tLngpOwogICAgICBsb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0by55LCBmcm9tLnkpOwogICAgICBsb3dlckJvdW5kLnogPSBNYXRoLm1pbih0by56LCBmcm9tLnopOwogICAgICB1cHBlckJvdW5kLnggPSBNYXRoLm1heCh0by54LCBmcm9tLngpOwogICAgICB1cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0by55LCBmcm9tLnkpOwogICAgICB1cHBlckJvdW5kLnogPSBNYXRoLm1heCh0by56LCBmcm9tLnopOwogICAgfQoKICAgIF9pbnRlcnNlY3RIZWlnaHRmaWVsZChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgc2hhcGUuZGF0YTsKICAgICAgc2hhcGUuZWxlbWVudFNpemU7IC8vIENvbnZlcnQgdGhlIHJheSB0byBsb2NhbCBoZWlnaHRmaWVsZCBjb29yZGluYXRlcwoKICAgICAgY29uc3QgbG9jYWxSYXkgPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheTsgLy9uZXcgUmF5KHRoaXMuZnJvbSwgdGhpcy50byk7CgogICAgICBsb2NhbFJheS5mcm9tLmNvcHkodGhpcy5mcm9tKTsKICAgICAgbG9jYWxSYXkudG8uY29weSh0aGlzLnRvKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS5mcm9tLCBsb2NhbFJheS5mcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS50bywgbG9jYWxSYXkudG8pOwogICAgICBsb2NhbFJheS51cGRhdGVEaXJlY3Rpb24oKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBjb25zdCBpbmRleCA9IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4OwogICAgICBsZXQgaU1pblg7CiAgICAgIGxldCBpTWluWTsKICAgICAgbGV0IGlNYXhYOwogICAgICBsZXQgaU1heFk7IC8vIFNldCB0byBtYXgKCiAgICAgIGlNaW5YID0gaU1pblkgPSAwOwogICAgICBpTWF4WCA9IGlNYXhZID0gc2hhcGUuZGF0YS5sZW5ndGggLSAxOwogICAgICBjb25zdCBhYWJiID0gbmV3IEFBQkIoKTsKICAgICAgbG9jYWxSYXkuZ2V0QUFCQihhYWJiKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWluWCA9IE1hdGgubWF4KGlNaW5YLCBpbmRleFswXSk7CiAgICAgIGlNaW5ZID0gTWF0aC5tYXgoaU1pblksIGluZGV4WzFdKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWF4WCA9IE1hdGgubWluKGlNYXhYLCBpbmRleFswXSArIDEpOwogICAgICBpTWF4WSA9IE1hdGgubWluKGlNYXhZLCBpbmRleFsxXSArIDEpOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzaGFwZS5nZXRBYWJiQXRJbmRleChpLCBqLCBhYWJiKTsKCiAgICAgICAgICBpZiAoIWFhYmIub3ZlcmxhcHNSYXkobG9jYWxSYXkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSAvLyBMb3dlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKCiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdFNwaGVyZShzcGhlcmUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgciA9IHNwaGVyZS5yYWRpdXM7CiAgICAgIGNvbnN0IGEgPSAodG8ueCAtIGZyb20ueCkgKiogMiArICh0by55IC0gZnJvbS55KSAqKiAyICsgKHRvLnogLSBmcm9tLnopICoqIDI7CiAgICAgIGNvbnN0IGIgPSAyICogKCh0by54IC0gZnJvbS54KSAqIChmcm9tLnggLSBwb3NpdGlvbi54KSArICh0by55IC0gZnJvbS55KSAqIChmcm9tLnkgLSBwb3NpdGlvbi55KSArICh0by56IC0gZnJvbS56KSAqIChmcm9tLnogLSBwb3NpdGlvbi56KSk7CiAgICAgIGNvbnN0IGMgPSAoZnJvbS54IC0gcG9zaXRpb24ueCkgKiogMiArIChmcm9tLnkgLSBwb3NpdGlvbi55KSAqKiAyICsgKGZyb20ueiAtIHBvc2l0aW9uLnopICoqIDIgLSByICoqIDI7CiAgICAgIGNvbnN0IGRlbHRhID0gYiAqKiAyIC0gNCAqIGEgKiBjOwogICAgICBjb25zdCBpbnRlcnNlY3Rpb25Qb2ludCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQ7CiAgICAgIGNvbnN0IG5vcm1hbCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsOwoKICAgICAgaWYgKGRlbHRhIDwgMCkgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgIC8vIHNpbmdsZSBpbnRlcnNlY3Rpb24gcG9pbnQKICAgICAgICBmcm9tLmxlcnAodG8sIGRlbHRhLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGQxID0gKC1iIC0gTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwogICAgICAgIGNvbnN0IGQyID0gKC1iICsgTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwoKICAgICAgICBpZiAoZDEgPj0gMCAmJiBkMSA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQxLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkMiA+PSAwICYmIGQyIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDIsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdENvbnZleChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0Q29udmV4X25vcm1hbDsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBvcHRpb25zICYmIG9wdGlvbnMuZmFjZUxpc3QgfHwgbnVsbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGZhY2VzID0gc2hhcGUuZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzaGFwZS5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8odG8pOwogICAgICBjb25zdCBOZmFjZXMgPSBmYWNlTGlzdCA/IGZhY2VMaXN0Lmxlbmd0aCA6IGZhY2VzLmxlbmd0aDsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBqID0gMDsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGogPCBOZmFjZXM7IGorKykgewogICAgICAgIGNvbnN0IGZpID0gZmFjZUxpc3QgPyBmYWNlTGlzdFtqXSA6IGo7CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ZpXTsKICAgICAgICBjb25zdCBmYWNlTm9ybWFsID0gbm9ybWFsc1tmaV07CiAgICAgICAgY29uc3QgcSA9IHF1YXQ7CiAgICAgICAgY29uc3QgeCA9IHBvc2l0aW9uOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIHZlY3Rvci5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KHZlY3RvciwgdmVjdG9yKTsKICAgICAgICB2ZWN0b3IudmFkZCh4LCB2ZWN0b3IpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICB2ZWN0b3IudnN1Yihmcm9tLCB2ZWN0b3IpOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICAgIHEudm11bHQoZmFjZU5vcm1hbCwgbm9ybWFsKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gZGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAoKICAgICAgICBpZiAoTWF0aC5hYnMoZG90KSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBpZiAoZG90IDwgMCkgewogICAgICAgIC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBkaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChmcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIGEgaXMgdGhlIHBvaW50IHdlIGNvbXBhcmUgcG9pbnRzIGIgYW5kIGMgd2l0aC4KCiAgICAgICAgYS5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KGEsIGEpOwogICAgICAgIHgudmFkZChhLCBhKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDE7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgZmFjZS5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgIC8vIFRyYW5zZm9ybSAzIHZlcnRpY2VzIHRvIHdvcmxkIGNvb3JkcwogICAgICAgICAgYi5jb3B5KHZlcnRpY2VzW2ZhY2VbaV1dKTsKICAgICAgICAgIGMuY29weSh2ZXJ0aWNlc1tmYWNlW2kgKyAxXV0pOwogICAgICAgICAgcS52bXVsdChiLCBiKTsKICAgICAgICAgIHEudm11bHQoYywgYyk7CiAgICAgICAgICB4LnZhZGQoYiwgYik7CiAgICAgICAgICB4LnZhZGQoYywgYyk7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlVG8oZnJvbSk7CgogICAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykpIHx8IGRpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgZmkpOwogICAgICAgIH0gLy8gfQoKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBPcHRpbWl6ZSBieSB0cmFuc2Zvcm1pbmcgdGhlIHdvcmxkIHRvIGxvY2FsIHNwYWNlIGZpcnN0LgogICAgICogQHRvZG8gVXNlIE9jdHJlZSBsb29rdXAKICAgICAqLwoKCiAgICBfaW50ZXJzZWN0VHJpbWVzaChtZXNoLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX25vcm1hbDsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXM7CiAgICAgIGNvbnN0IHRyZWVUcmFuc2Zvcm0gPSBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm07CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGxvY2FsRGlyZWN0aW9uID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbjsKICAgICAgY29uc3QgbG9jYWxGcm9tID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb207CiAgICAgIGNvbnN0IGxvY2FsVG8gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG87CiAgICAgIGNvbnN0IHdvcmxkSW50ZXJzZWN0UG9pbnQgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQ7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGluZGljZXMgPSBtZXNoLmluZGljZXM7CiAgICAgIG1lc2gudmVydGljZXM7IC8vIGNvbnN0IG5vcm1hbHMgPSBtZXNoLmZhY2VOb3JtYWxzCgogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICB0cmVlVHJhbnNmb3JtLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pOwogICAgICB0cmVlVHJhbnNmb3JtLnF1YXRlcm5pb24uY29weShxdWF0KTsgLy8gVHJhbnNmb3JtIHJheSB0byBsb2NhbCBzcGFjZSEKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGRpcmVjdGlvbiwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGZyb20sIGxvY2FsRnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgdG8sIGxvY2FsVG8pOwogICAgICBsb2NhbFRvLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbFRvLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbFRvLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbEZyb20ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsRnJvbS55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxGcm9tLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbFRvLnZzdWIobG9jYWxGcm9tLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIGxvY2FsRGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZVNxdWFyZWQgPSBsb2NhbEZyb20uZGlzdGFuY2VTcXVhcmVkKGxvY2FsVG8pOwogICAgICBtZXNoLnRyZWUucmF5UXVlcnkodGhpcywgdHJlZVRyYW5zZm9ybSwgdHJpYW5nbGVzKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgdHJpYW5nbGVzSW5kZXggPSB0cmlhbmdsZXNbaV07CiAgICAgICAgbWVzaC5nZXROb3JtYWwodHJpYW5nbGVzSW5kZXgsIG5vcm1hbCk7IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDNdLCBhKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgYS52c3ViKGxvY2FsRnJvbSwgdmVjdG9yKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gbG9jYWxEaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCiAgICAgICAgLy8gaWYgKE1hdGguYWJzKCBkb3QgKSA8IHRoaXMucHJlY2lzaW9uKXsKICAgICAgICAvLyAgICAgY29udGludWU7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBsb2NhbERpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGxvY2FsRnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBHZXQgdHJpYW5nbGUgdmVydGljZXMKCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAxXSwgYik7CiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAyXSwgYyk7CiAgICAgICAgY29uc3Qgc3F1YXJlZERpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VTcXVhcmVkKGxvY2FsRnJvbSk7CgogICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpKSB8fCBzcXVhcmVkRGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZVNxdWFyZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gdHJhbnNmb3JtIGludGVyc2VjdHBvaW50IGFuZCBub3JtYWwgdG8gd29ybGQKCgogICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUocXVhdCwgbm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBpbnRlcnNlY3RQb2ludCwgd29ybGRJbnRlcnNlY3RQb2ludCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIHdvcmxkSW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIHRyaWFuZ2xlc0luZGV4KTsKICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgaW50ZXJzZWN0aW9ucyBzaG91bGQgY29udGludWUKICAgICAqLwoKCiAgICByZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgaGl0RmFjZUluZGV4KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8oaGl0UG9pbnRXb3JsZCk7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OyAvLyBTa2lwIGJhY2sgZmFjZXM/CgogICAgICBpZiAodGhpcy5za2lwQmFja2ZhY2VzICYmIG5vcm1hbC5kb3QodGhpcy5kaXJlY3Rpb24pID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmVzdWx0LmhpdEZhY2VJbmRleCA9IHR5cGVvZiBoaXRGYWNlSW5kZXggIT09ICd1bmRlZmluZWQnID8gaGl0RmFjZUluZGV4IDogLTE7CgogICAgICBzd2l0Y2ggKHRoaXMubW9kZSkgewogICAgICAgIGNhc2UgUmF5LkFMTDoKICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5jYWxsYmFjayhyZXN1bHQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkNMT1NFU1Q6CiAgICAgICAgICAvLyBTdG9yZSBpZiBjbG9zZXIgdGhhbiBjdXJyZW50IGNsb3Nlc3QKICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHJlc3VsdC5kaXN0YW5jZSB8fCAhcmVzdWx0Lmhhc0hpdCkgewogICAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkFOWToKICAgICAgICAgIC8vIFJlcG9ydCBhbmQgc3RvcC4KICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0LnNob3VsZFN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXMgcGVyICJCYXJ5Y2VudHJpYyBUZWNobmlxdWUiIGFzIG5hbWVkCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9kZWZhdWx0Lmh0bWwgaGVyZX0gYnV0IHdpdGhvdXQgdGhlIGRpdmlzaW9uCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50SW5UcmlhbmdsZShwLCBhLCBiLCBjKSB7CiAgICAgIGMudnN1YihhLCB2MCk7CiAgICAgIGIudnN1YihhLCB2MSk7CiAgICAgIHAudnN1YihhLCB2Mik7CiAgICAgIGNvbnN0IGRvdDAwID0gdjAuZG90KHYwKTsKICAgICAgY29uc3QgZG90MDEgPSB2MC5kb3QodjEpOwogICAgICBjb25zdCBkb3QwMiA9IHYwLmRvdCh2Mik7CiAgICAgIGNvbnN0IGRvdDExID0gdjEuZG90KHYxKTsKICAgICAgY29uc3QgZG90MTIgPSB2MS5kb3QodjIpOwogICAgICBsZXQgdTsKICAgICAgbGV0IHY7CiAgICAgIHJldHVybiAodSA9IGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSA+PSAwICYmICh2ID0gZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpID49IDAgJiYgdSArIHYgPCBkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMTsKICAgIH0KCiAgfQogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFJheWNhc3RSZXN1bHQoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhPcHRpb25zID0gewogICAgZmFjZUxpc3Q6IFswXQogIH07CiAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5ID0gbmV3IFJheSgpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4ID0gW107CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KCiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCiAgY2xhc3MgU0FQQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBMaXN0IG9mIGJvZGllcyBjdXJyZW50bHkgaW4gdGhlIGJyb2FkcGhhc2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEF4aXMgdG8gc29ydCB0aGUgYm9kaWVzIGFsb25nLgogICAgICogU2V0IHRvIDAgZm9yIHggYXhpcywgYW5kIDEgZm9yIHkgYXhpcy4KICAgICAqIEZvciBiZXN0IHBlcmZvcm1hbmNlLCBwaWNrIHRoZSBheGlzIHdoZXJlIGJvZGllcyBhcmUgbW9zdCBkaXN0cmlidXRlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAsIGFsb25nIHRoZSBnaXZlbiBTQVAgYXhpcy4KICAgICAqLwogICAgc3RhdGljIGNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSB7CiAgICAgIGxldCBiaVBvczsKICAgICAgbGV0IGJqUG9zOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueDsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLng7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi55OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLno7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi56OwogICAgICB9CgogICAgICBjb25zdCByaSA9IGJpLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICByaiA9IGJqLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICBib3VuZEEyID0gYmlQb3MgKyByaSwKICAgICAgICAgICAgYm91bmRCMSA9IGJqUG9zIC0gcmo7CiAgICAgIHJldHVybiBib3VuZEIxIDwgYm91bmRBMjsKICAgIH0gLy8gTm90ZTogdGhlc2UgYXJlIGlkZW50aWNhbCwgc2F2ZSBmb3IgeC95L3ogbG93ZXJib3VuZAoKICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFgKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFgoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnggPD0gdi5hYWJiLmxvd2VyQm91bmQueCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WQogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WShhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueSA8PSB2LmFhYmIubG93ZXJCb3VuZC55KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRaCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRaKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC56IDw9IHYuYWFiYi5sb3dlckJvdW5kLnopIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcih3b3JsZCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmF4aXNMaXN0ID0gW107CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKCiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGF4aXNMaXN0LnB1c2goZXZlbnQuYm9keSk7CiAgICAgIH07CgogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBjb25zdCBpZHggPSBheGlzTGlzdC5pbmRleE9mKGV2ZW50LmJvZHkpOwoKICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgYXhpc0xpc3Quc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKHdvcmxkKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZCh3b3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSB3b3JsZAogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7CiAgICAgIC8vIENsZWFyIHRoZSBvbGQgYXhpcyBhcnJheQogICAgICB0aGlzLmF4aXNMaXN0Lmxlbmd0aCA9IDA7IC8vIEFkZCBhbGwgYm9kaWVzIGZyb20gdGhlIG5ldyB3b3JsZAoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLmF4aXNMaXN0LnB1c2god29ybGQuYm9kaWVzW2ldKTsKICAgICAgfSAvLyBSZW1vdmUgb2xkIGhhbmRsZXJzLCBpZiBhbnkKCgogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOyAvLyBBZGQgaGFuZGxlcnMgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIGJvZGllcy4KCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbGxlY3QgYWxsIGNvbGxpc2lvbiBwYWlycwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0gLy8gTG9vayB0aHJvdWdoIHRoZSBsaXN0CgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgTjsgaisrKSB7CiAgICAgICAgICBjb25zdCBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIVNBUEJyb2FkcGhhc2UuY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHAxLCBwMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc29ydExpc3QoKSB7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGNvbnN0IE4gPSBheGlzTGlzdC5sZW5ndGg7IC8vIFVwZGF0ZSBBQUJCcwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiaS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGJpLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29ydCB0aGUgbGlzdAoKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRYKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRZKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRaKGF4aXNMaXN0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgdmFyaWFuY2Ugb2YgdGhlIGJvZHkgcG9zaXRpb25zIGFuZCBlc3RpbWF0ZXMgdGhlIGJlc3QgYXhpcyB0byB1c2UuCiAgICAgKiBXaWxsIGF1dG9tYXRpY2FsbHkgc2V0IHByb3BlcnR5IGBheGlzSW5kZXhgLgogICAgICovCgoKICAgIGF1dG9EZXRlY3RBeGlzKCkgewogICAgICBsZXQgc3VtWCA9IDA7CiAgICAgIGxldCBzdW1YMiA9IDA7CiAgICAgIGxldCBzdW1ZID0gMDsKICAgICAgbGV0IHN1bVkyID0gMDsKICAgICAgbGV0IHN1bVogPSAwOwogICAgICBsZXQgc3VtWjIgPSAwOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaW52TiA9IDEgLyBOOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgY29uc3QgY2VudGVyWCA9IGIucG9zaXRpb24ueDsKICAgICAgICBzdW1YICs9IGNlbnRlclg7CiAgICAgICAgc3VtWDIgKz0gY2VudGVyWCAqIGNlbnRlclg7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGIucG9zaXRpb24ueTsKICAgICAgICBzdW1ZICs9IGNlbnRlclk7CiAgICAgICAgc3VtWTIgKz0gY2VudGVyWSAqIGNlbnRlclk7CiAgICAgICAgY29uc3QgY2VudGVyWiA9IGIucG9zaXRpb24uejsKICAgICAgICBzdW1aICs9IGNlbnRlclo7CiAgICAgICAgc3VtWjIgKz0gY2VudGVyWiAqIGNlbnRlclo7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZhcmlhbmNlWCA9IHN1bVgyIC0gc3VtWCAqIHN1bVggKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVkgPSBzdW1ZMiAtIHN1bVkgKiBzdW1ZICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VaID0gc3VtWjIgLSBzdW1aICogc3VtWiAqIGludk47CgogICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VZKSB7CiAgICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWikgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhcmlhbmNlWSA+IHZhcmlhbmNlWikgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRzKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGtleSBpbiBkZWZhdWx0cykgewogICAgICAgIGlmICghKGtleSBpbiBvcHRpb25zKSkgewogICAgICAgICAgb3B0aW9uc1trZXldID0gZGVmYXVsdHNba2V5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNvbGxpZGVDb25uZWN0ZWQ6IHRydWUsCiAgICAgICAgd2FrZVVwQm9kaWVzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLmJvZHlBID0gYm9keUE7CiAgICAgIHRoaXMuYm9keUIgPSBib2R5QjsKICAgICAgdGhpcy5pZCA9IENvbnN0cmFpbnQuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9IG9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKCiAgICAgIGlmIChvcHRpb25zLndha2VVcEJvZGllcykgewogICAgICAgIGlmIChib2R5QSkgewogICAgICAgICAgYm9keUEud2FrZVVwKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYm9keUIpIHsKICAgICAgICAgIGJvZHlCLndha2VVcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYWxsIHRoZSBlcXVhdGlvbnMgd2l0aCBkYXRhLgogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXRob2QgdXBkYXRlKCkgbm90IGltcGxtZW1lbnRlZCBpbiB0aGlzIENvbnN0cmFpbnQgc3ViY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBlbmFibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBkaXNhYmxlKCkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXFzW2ldLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICB9CiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBbiBlbGVtZW50IGNvbnRhaW5pbmcgNiBlbnRyaWVzLCAzIHNwYXRpYWwgYW5kIDMgcm90YXRpb25hbCBkZWdyZWVzIG9mIGZyZWVkb20uCiAgICovCgogIGNsYXNzIEphY29iaWFuRWxlbWVudCB7CiAgICAvKioKICAgICAqIHNwYXRpYWwKICAgICAqLwoKICAgIC8qKgogICAgICogcm90YXRpb25hbAogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CgogIC8qKgogICAqIEVxdWF0aW9uIGJhc2UgY2xhc3MuCiAgICoKICAgKiBgYWAsIGBiYCBhbmQgYGVwc2AgYXJlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQxNS9sZWN0dXJlcy9TUE9PS2xhYm5vdGVzLnBkZiBTUE9PS30gcGFyYW1ldGVycyB0aGF0IGRlZmF1bHQgdG8gYDAuMGAuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NjaHRlcHBlL2Nhbm5vbi5qcy9pc3N1ZXMvMjM4I2lzc3VlY29tbWVudC0xNDcxNzIzMjcgdGhpcyBleGNoYW5nZX0gZm9yIG1vcmUgZGV0YWlscyBvbiBDYW5ub24ncyBwaHlzaWNzIGltcGxlbWVudGF0aW9uLgogICAqLwogIGNsYXNzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTWluaW11bSAocmVhZDogbmVnYXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXhpbXVtIChyZWFkOiBwb3NpdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgbnVtYmVyLCBwcm9wb3J0aW9uYWwgdG8gdGhlIGZvcmNlIGFkZGVkIHRvIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJpLCBiaiwgbWluRm9yY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtaW5Gb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWluRm9yY2UgPSAtMWU2OwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICB0aGlzLmlkID0gRXF1YXRpb24uaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWluRm9yY2UgPSBtaW5Gb3JjZTsKICAgICAgdGhpcy5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB0aGlzLmJpID0gYmk7CiAgICAgIHRoaXMuYmogPSBiajsKICAgICAgdGhpcy5hID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuYiA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmVwcyA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSBuZXcgSmFjb2JpYW5FbGVtZW50KCk7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5tdWx0aXBsaWVyID0gMDsKICAgICAgdGhpcy5zZXRTcG9va1BhcmFtcygxZTcsIDQsIDEgLyA2MCk7IC8vIFNldCB0eXBpY2FsIHNwb29rIHBhcmFtcwogICAgfQogICAgLyoqCiAgICAgKiBSZWNhbGN1bGF0ZXMgYSwgYiwgYW5kIGVwcy4KICAgICAqCiAgICAgKiBUaGUgRXF1YXRpb24gY29uc3RydWN0b3Igc2V0cyB0eXBpY2FsIFNQT09LIHBhcmFtZXRlcnMgYXMgc3VjaDoKICAgICAqICogYHN0aWZmbmVzc2AgPSAxZTcKICAgICAqICogYHJlbGF4YXRpb25gID0gNAogICAgICogKiBgdGltZVN0ZXBgPSAxIC8gNjAsIF9ub3RlIHRoZSBoYXJkY29kZWQgcmVmcmVzaCByYXRlLl8KICAgICAqLwoKCiAgICBzZXRTcG9va1BhcmFtcyhzdGlmZm5lc3MsIHJlbGF4YXRpb24sIHRpbWVTdGVwKSB7CiAgICAgIGNvbnN0IGQgPSByZWxheGF0aW9uOwogICAgICBjb25zdCBrID0gc3RpZmZuZXNzOwogICAgICBjb25zdCBoID0gdGltZVN0ZXA7CiAgICAgIHRoaXMuYSA9IDQuMCAvIChoICogKDEgKyA0ICogZCkpOwogICAgICB0aGlzLmIgPSA0LjAgKiBkIC8gKDEgKyA0ICogZCk7CiAgICAgIHRoaXMuZXBzID0gNC4wIC8gKGggKiBoICogayAqICgxICsgNCAqIGQpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgU1BPT0sgZXF1YXRpb24KICAgICAqLwoKCiAgICBjb21wdXRlQihhLCBiLCBoKSB7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR3EgPSB0aGlzLmNvbXB1dGVHcSgpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICByZXR1cm4gLUdxICogYSAtIEdXICogYiAtIEdpTWYgKiBoOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKnEsIHdoZXJlIHEgYXJlIHRoZSBnZW5lcmFsaXplZCBib2R5IGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdxKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB4aSA9IGJpLnBvc2l0aW9uOwogICAgICBjb25zdCB4aiA9IGJqLnBvc2l0aW9uOwogICAgICByZXR1cm4gR0Euc3BhdGlhbC5kb3QoeGkpICsgR0Iuc3BhdGlhbC5kb3QoeGopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKlcsIHdoZXJlIFcgYXJlIHRoZSBib2R5IHZlbG9jaXRpZXMKICAgICAqLwoKCiAgICBjb21wdXRlR1coKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHZqID0gYmoudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyh2aSwgd2kpICsgR0IubXVsdGlwbHlWZWN0b3JzKHZqLCB3aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqV2xhbWJkYSwgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHV2xhbWJkYSgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52bGFtYmRhOwogICAgICBjb25zdCB2aiA9IGJqLnZsYW1iZGE7CiAgICAgIGNvbnN0IHdpID0gYmkud2xhbWJkYTsKICAgICAgY29uc3Qgd2ogPSBiai53bGFtYmRhOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqZiwgd2hlcmUgTSBpcyB0aGUgbWFzcyBtYXRyaXggd2l0aCBkaWFnb25hbCBibG9ja3MgZm9yIGVhY2ggYm9keSwgYW5kIGYgYXJlIHRoZSBmb3JjZXMgb24gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBjb21wdXRlR2lNZigpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgZmkgPSBiaS5mb3JjZTsKICAgICAgY29uc3QgdGkgPSBiaS50b3JxdWU7CiAgICAgIGNvbnN0IGZqID0gYmouZm9yY2U7CiAgICAgIGNvbnN0IHRqID0gYmoudG9ycXVlOwogICAgICBjb25zdCBpbnZNYXNzaSA9IGJpLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52TWFzc2ogPSBiai5pbnZNYXNzU29sdmU7CiAgICAgIGZpLnNjYWxlKGludk1hc3NpLCBpTWZpKTsKICAgICAgZmouc2NhbGUoaW52TWFzc2osIGlNZmopOwogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdCh0aSwgaW52SWlfdm11bHRfdGF1aSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRqLCBpbnZJal92bXVsdF90YXVqKTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyhpTWZpLCBpbnZJaV92bXVsdF90YXVpKSArIEdCLm11bHRpcGx5VmVjdG9ycyhpTWZqLCBpbnZJal92bXVsdF90YXVqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqRycKICAgICAqLwoKCiAgICBjb21wdXRlR2lNR3QoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52SWkgPSBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgY29uc3QgaW52SWogPSBiai5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgbGV0IHJlc3VsdCA9IGludk1hc3NpICsgaW52TWFzc2o7CiAgICAgIGludklpLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdBLnJvdGF0aW9uYWwpOwogICAgICBpbnZJai52bXVsdChHQi5yb3RhdGlvbmFsLCB0bXApOwogICAgICByZXN1bHQgKz0gdG1wLmRvdChHQi5yb3RhdGlvbmFsKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGNvbnN0cmFpbnQgdmVsb2NpdHkgdG8gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBhZGRUb1dsYW1iZGEoZGVsdGFsYW1iZGEpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdGVtcCA9IGFkZFRvV2xhbWJkYV90ZW1wOyAvLyBBZGQgdG8gbGluZWFyIHZlbG9jaXR5CiAgICAgIC8vIHZfbGFtYmRhICs9IGludihNKSAqIGRlbHRhX2xhbWJhICogRwoKICAgICAgYmkudmxhbWJkYS5hZGRTY2FsZWRWZWN0b3IoYmkuaW52TWFzc1NvbHZlICogZGVsdGFsYW1iZGEsIEdBLnNwYXRpYWwsIGJpLnZsYW1iZGEpOwogICAgICBiai52bGFtYmRhLmFkZFNjYWxlZFZlY3Rvcihiai5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Iuc3BhdGlhbCwgYmoudmxhbWJkYSk7IC8vIEFkZCB0byBhbmd1bGFyIHZlbG9jaXR5CgogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQS5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmkud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJpLndsYW1iZGEpOwogICAgICBiai5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQi5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmoud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJqLndsYW1iZGEpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBkZW5vbWluYXRvciBwYXJ0IG9mIHRoZSBTUE9PSyBlcXVhdGlvbjogQyA9IEcqaW52KE0pKkcnICsgZXBzCiAgICAgKi8KCgogICAgY29tcHV0ZUMoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVHaU1HdCgpICsgdGhpcy5lcHM7CiAgICB9CgogIH0KICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb250YWN0L25vbi1wZW5ldHJhdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICovCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzCgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwogIGNsYXNzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5QS4KICAgICAqLwoKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHBpdm90QSBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlBIHdoaWNoIGJvZHlBIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIGJvZHlCIEJvZHkgdGhhdCB3aWxsIGJlIGNvbnN0cmFpbmVkIGluIGEgc2ltaWxhciB3YXkgdG8gdGhlIHNhbWUgcG9pbnQgYXMgYm9keUEuIFdlIHdpbGwgdGhlcmVmb3JlIGdldCBhIGxpbmsgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuIElmIG5vdCBzcGVjaWZpZWQsIGJvZHlBIHdpbGwgYmUgY29uc3RyYWluZWQgdG8gYSBzdGF0aWMgcG9pbnQuCiAgICAgKiBAcGFyYW0gcGl2b3RCIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUIgd2hpY2ggYm9keUIgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKHBpdm90QSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHBpdm90QiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uZSBlcXVhdGlvbi4gV29ya3MgdG8ga2VlcCB0aGUgZ2l2ZW4gYm9keSB3b3JsZCB2ZWN0b3JzIGFsaWduZWQsIG9yIHRpbHRlZCB3aXRoaW4gYSBnaXZlbiBhbmdsZSBmcm9tIGVhY2ggb3RoZXIuCiAgICovCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDI7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQyOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gVGhlIGFuZ2xlIGJldHdlZW4gdHdvIHZlY3RvciBpczoKICAgICAgLy8gY29zKHRoZXRhKSA9IGEgKiBiIC8gKGxlbmd0aChhKSAqIGxlbmd0aChiKSA9IHsgbGVuKGEpID0gbGVuKGIpID0gMSB9ID0gYSAqIGIKICAgICAgLy8gZyA9IGEgKiBiCiAgICAgIC8vIGdkb3QgPSAoYiB4IGEpICogd2kgKyAoYSB4IGIpICogd2oKICAgICAgLy8gRyA9IFswIGJ4YSAwIGF4Yl0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBjb25zdHJhaW50LiBXb3JrcyB0byBrZWVwIHRoZSBsb2NhbCB2ZWN0b3JzIG9ydGhvZ29uYWwgdG8gZWFjaCBvdGhlciBpbiB3b3JsZCBzcGFjZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLm1heEFuZ2xlID0gTWF0aC5QSSAvIDI7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDE7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQxOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gZyA9IG5pICogbmoKICAgICAgLy8gZ2RvdCA9IChuaiB4IG5pKSAqIHdpICsgKG5pIHggbmopICogd2oKICAgICAgLy8gRyA9IFswIG5qeG5pIDAgbml4bmpdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5tYXhBbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgQ29uZSBUd2lzdCBjb25zdHJhaW50LCB1c2VmdWwgZm9yIHJhZ2RvbGxzLgogICAqLwogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9ICEhb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNvbmVFcXVhdGlvbiA9IG5ldyBDb25lRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgdCA9IHRoaXMudHdpc3RFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdHlwZW9mIG9wdGlvbnMudHdpc3RBbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnR3aXN0QW5nbGUgOiAwOyAvLyBNYWtlIHRoZSBjb25lIGVxdWF0aW9uIHB1c2ggdGhlIGJvZGllcyB0b3dhcmQgdGhlIGNvbmUgYXhpcywgbm90IG91dHdhcmQKCiAgICAgIGMubWF4Rm9yY2UgPSAwOwogICAgICBjLm1pbkZvcmNlID0gLW1heEZvcmNlOyAvLyBNYWtlIHRoZSB0d2lzdCBlcXVhdGlvbiBhZGQgdG9ycXVlIHRvd2FyZCB0aGUgaW5pdGlhbCBwb3NpdGlvbgoKICAgICAgdC5tYXhGb3JjZSA9IDA7CiAgICAgIHQubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goYywgdCk7CiAgICB9CgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgY29uZSA9IHRoaXMuY29uZUVxdWF0aW9uOwogICAgICBjb25zdCB0d2lzdCA9IHRoaXMudHdpc3RFcXVhdGlvbjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFVwZGF0ZSB0aGUgYXhlcyB0byB0aGUgY29uZSBjb25zdHJhaW50CgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQSwgY29uZS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNCLCBjb25lLmF4aXNCKTsgLy8gVXBkYXRlIHRoZSB3b3JsZCBheGVzIGluIHRoZSB0d2lzdCBjb25zdHJhaW50CgogICAgICB0aGlzLmF4aXNBLnRhbmdlbnRzKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICB0aGlzLmF4aXNCLnRhbmdlbnRzKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBjb25lLmFuZ2xlID0gdGhpcy5hbmdsZTsKICAgICAgdHdpc3QubWF4QW5nbGUgPSB0aGlzLnR3aXN0QW5nbGU7CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCiAgY2xhc3MgRGlzdGFuY2VDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkaXN0YW5jZSBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIGRpc3RhbmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwogIGNsYXNzIExvY2tDb25zdHJhaW50IGV4dGVuZHMgUG9pbnRUb1BvaW50Q29uc3RyYWludCB7CiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnhCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy55QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMueUIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnpBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsKICAgICAgdGhpcy56QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7IC8vIC4uLmFuZCB0aGUgZm9sbG93aW5nIHJvdGF0aW9uYWwgZXF1YXRpb25zIHdpbGwga2VlcCBhbGwgcm90YXRpb25hbCBET0YncyBpbiBwbGFjZQoKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyMSwgcjIsIHIzKTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uOwogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjI7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVGhlc2UgdmVjdG9yIHBhaXJzIG11c3QgYmUgb3J0aG9nb25hbAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEEsIHIxLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUIsIHIxLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUEsIHIyLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekIsIHIyLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekEsIHIzLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEIsIHIzLmF4aXNCKTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1vdG9yIHZlbG9jaXR5LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIHRoaXMuYmk7CiAgICAgIHRoaXMuYmo7CiAgICAgIGNvbnN0IGF4aXNBID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIGcgPSAwCiAgICAgIC8vIGdkb3QgPSBheGlzQSAqIHdpIC0gYXhpc0IgKiB3agogICAgICAvLyBnZG90ID0gRyAqIFcgPSBHICogW3ZpIHdpIHZqIHdqXQogICAgICAvLyA9PgogICAgICAvLyBHID0gWzAgYXhpc0EgMCAtYXhpc0JdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkoYXhpc0EpOwogICAgICBheGlzQi5uZWdhdGUoR0Iucm90YXRpb25hbCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKSAtIHRoaXMudGFyZ2V0VmVsb2NpdHk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQi5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByb3RhdGlvbmFsMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb24gPSBuZXcgUm90YXRpb25hbE1vdG9yRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtYXhGb3JjZSk7CiAgICAgIG1vdG9yLmVuYWJsZWQgPSBmYWxzZTsgLy8gTm90IGVuYWJsZWQgYnkgZGVmYXVsdAogICAgICAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocm90YXRpb25hbDEsIHJvdGF0aW9uYWwyLCBtb3Rvcik7CiAgICB9CiAgICAvKioKICAgICAqIGVuYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZW5hYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogZGlzYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZGlzYWJsZU1vdG9yKCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3RvclNwZWVkCiAgICAgKi8KCgogICAgc2V0TW90b3JTcGVlZChzcGVlZCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24udGFyZ2V0VmVsb2NpdHkgPSBzcGVlZDsKICAgIH0KICAgIC8qKgogICAgICogc2V0TW90b3JNYXhGb3JjZQogICAgICovCgoKICAgIHNldE1vdG9yTWF4Rm9yY2UobWF4Rm9yY2UpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3Qgd29ybGRBeGlzQSA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMTsKICAgICAgY29uc3Qgd29ybGRBeGlzQiA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMjsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBHZXQgd29ybGQgYXhlcwoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdChheGlzQSwgd29ybGRBeGlzQSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQoYXhpc0IsIHdvcmxkQXhpc0IpOwogICAgICB3b3JsZEF4aXNBLnRhbmdlbnRzKHIxLmF4aXNBLCByMi5heGlzQSk7CiAgICAgIHIxLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CiAgICAgIHIyLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CgogICAgICBpZiAodGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQpIHsKICAgICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0EsIG1vdG9yLmF4aXNBKTsKICAgICAgICBib2R5Qi5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0IsIG1vdG9yLmF4aXNCKTsKICAgICAgfQogICAgfQoKICB9CiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25zdHJhaW5zIHRoZSBzbGlwcGluZyBpbiBhIGNvbnRhY3QgYWxvbmcgYSB0YW5nZW50CiAgICovCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50ID0gbmV3IFZlYzMoKTsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanh0ID0gRnJpY3Rpb25FcXVhdGlvbl9jb21wdXRlQl90ZW1wMjsKICAgICAgY29uc3QgdCA9IHRoaXMudDsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICByaS5jcm9zcyh0LCByaXh0KTsKICAgICAgcmouY3Jvc3ModCwgcmp4dCk7IC8vIEcgPSBbLXQgLXJpeHQgdCByanh0XQogICAgICAvLyBBbmQgcmVtZW1iZXIsIHRoaXMgaXMgYSBwdXJlIHZlbG9jaXR5IGNvbnN0cmFpbnQsIGcgaXMgYWx3YXlzIHplcm8hCgogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIHQubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXh0Lm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KHQpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4dCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogRGVmaW5lcyB3aGF0IGhhcHBlbnMgd2hlbiB0d28gbWF0ZXJpYWxzIG1lZXQuCiAgICogQHRvZG8gUmVmYWN0b3IgbWF0ZXJpYWxzIHRvIG1hdGVyaWFsQSBhbmQgbWF0ZXJpYWxCCiAgICovCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CiAgQ29udGFjdE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwogIGNsYXNzIE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogTWF0ZXJpYWwgbmFtZS4KICAgICAqIElmIG9wdGlvbnMgaXMgYSBzdHJpbmcsIG5hbWUgd2lsbCBiZSBzZXQgdG8gdGhhdCBzdHJpbmcuCiAgICAgKiBAdG9kbyBEZXByZWNhdGUgdGhpcwogICAgICovCgogICAgLyoqIE1hdGVyaWFsIGlkLiAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSBmcmljdGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlc3RpdHV0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgcmVzdGl0dXRpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbldvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBheGxlV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgc3VzcGVuc2lvblJlc3RMZW5ndGg6IDEsCiAgICAgICAgc3VzcGVuc2lvbk1heExlbmd0aDogMiwKICAgICAgICByYWRpdXM6IDEsCiAgICAgICAgc3VzcGVuc2lvblN0aWZmbmVzczogMTAwLAogICAgICAgIGRhbXBpbmdDb21wcmVzc2lvbjogMTAsCiAgICAgICAgZGFtcGluZ1JlbGF4YXRpb246IDEwLAogICAgICAgIGZyaWN0aW9uU2xpcDogMTAuNSwKICAgICAgICBmb3J3YXJkQWNjZWxlcmF0aW9uOiAxLAogICAgICAgIHNpZGVBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc3RlZXJpbmc6IDAsCiAgICAgICAgcm90YXRpb246IDAsCiAgICAgICAgZGVsdGFSb3RhdGlvbjogMCwKICAgICAgICByb2xsSW5mbHVlbmNlOiAwLjAxLAogICAgICAgIG1heFN1c3BlbnNpb25Gb3JjZTogTnVtYmVyLk1BWF9WQUxVRSwKICAgICAgICBpc0Zyb250V2hlZWw6IHRydWUsCiAgICAgICAgY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOiAxLAogICAgICAgIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OiAwLAogICAgICAgIHN1c3BlbnNpb25Gb3JjZTogMCwKICAgICAgICBzbGlwSW5mbzogMCwKICAgICAgICBza2lkSW5mbzogMCwKICAgICAgICBzdXNwZW5zaW9uTGVuZ3RoOiAwLAogICAgICAgIG1heFN1c3BlbnNpb25UcmF2ZWw6IDEsCiAgICAgICAgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogZmFsc2UsCiAgICAgICAgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogLTAuMQogICAgICB9KTsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSBvcHRpb25zLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsID0gb3B0aW9ucy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbkxvY2FsID0gb3B0aW9ucy5kaXJlY3Rpb25Mb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbldvcmxkID0gb3B0aW9ucy5kaXJlY3Rpb25Xb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmF4bGVMb2NhbCA9IG9wdGlvbnMuYXhsZUxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZVdvcmxkID0gb3B0aW9ucy5heGxlV29ybGQuY2xvbmUoKTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgIHRoaXMuc3VzcGVuc2lvbk1heExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvbk1heExlbmd0aDsKICAgICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1czsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gb3B0aW9ucy5zdXNwZW5zaW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IG9wdGlvbnMuZGFtcGluZ0NvbXByZXNzaW9uOwogICAgICB0aGlzLmRhbXBpbmdSZWxheGF0aW9uID0gb3B0aW9ucy5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSBvcHRpb25zLmZyaWN0aW9uU2xpcDsKICAgICAgdGhpcy5mb3J3YXJkQWNjZWxlcmF0aW9uID0gb3B0aW9ucy5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICB0aGlzLnNpZGVBY2NlbGVyYXRpb24gPSBvcHRpb25zLnNpZGVBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc3RlZXJpbmcgPSAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5yb2xsSW5mbHVlbmNlID0gb3B0aW9ucy5yb2xsSW5mbHVlbmNlOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25Gb3JjZSA9IG9wdGlvbnMubWF4U3VzcGVuc2lvbkZvcmNlOwogICAgICB0aGlzLmVuZ2luZUZvcmNlID0gMDsKICAgICAgdGhpcy5icmFrZSA9IDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gb3B0aW9ucy5pc0Zyb250V2hlZWw7CiAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgdGhpcy5zbGlwSW5mbyA9IDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSAwOwogICAgICB0aGlzLnN1c3BlbnNpb25MZW5ndGggPSAwOwogICAgICB0aGlzLnNpZGVJbXB1bHNlID0gMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgIHRoaXMucmF5Y2FzdFJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMud29ybGRUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgICAgIHRoaXMuaXNJbkNvbnRhY3QgPSBmYWxzZTsKICAgIH0KCiAgICB1cGRhdGVXaGVlbChjaGFzc2lzKSB7CiAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSB0aGlzLnJheWNhc3RSZXN1bHQ7CgogICAgICBpZiAodGhpcy5pc0luQ29udGFjdCkgewogICAgICAgIGNvbnN0IHByb2plY3QgPSByYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChyYXljYXN0UmVzdWx0LmRpcmVjdGlvbldvcmxkKTsKICAgICAgICByYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXMuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocmVscG9zLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKHByb2plY3QgPj0gLTAuMSkgewogICAgICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIHByb2plY3Q7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gcHJvalZlbCAqIGludjsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBOb3QgaW4gY29udGFjdCA6IHBvc2l0aW9uIHdoZWVsIGluIGEgbmljZSAocmVzdCBsZW5ndGgpIHBvc2l0aW9uCiAgICAgICAgcmF5Y2FzdFJlc3VsdC5zdXNwZW5zaW9uTGVuZ3RoID0gdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQuc2NhbGUoLTEsIHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQpOwogICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogVmVoaWNsZSBoZWxwZXIgY2xhc3MgdGhhdCBjYXN0cyByYXlzIGZyb20gdGhlIHdoZWVsIHBvc2l0aW9ucyB0b3dhcmRzIHRoZSBncm91bmQgYW5kIGFwcGxpZXMgZm9yY2VzLgogICAqLwogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM0ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM1ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM2ID0gbmV3IFZlYzMoKTsKICBuZXcgUmF5KCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3JheXZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FzdFJheV90YXJnZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGRpcmVjdGlvbnMgPSBbbmV3IFZlYzMoMSwgMCwgMCksIG5ldyBWZWMzKDAsIDEsIDApLCBuZXcgVmVjMygwLCAwLCAxKV07CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gbmV3IFZlYzMoKTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9heGxlID0gW107CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fZm9yd2FyZFdTID0gW107CiAgY29uc3Qgc2lkZUZyaWN0aW9uU3RpZmZuZXNzMiA9IDE7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY2FsY1JvbGxpbmdGcmljdGlvbihib2R5MCwgYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQsIG1heEltcHVsc2UpIHsKICAgIGxldCBqMSA9IDA7CiAgICBjb25zdCBjb250YWN0UG9zV29ybGQgPSBmcmljdGlvblBvc1dvcmxkOyAvLyBjb25zdCByZWxfcG9zMSA9IG5ldyBWZWMzKCk7CiAgICAvLyBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CgogICAgY29uc3QgdmVsMSA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMTsKICAgIGNvbnN0IHZlbDIgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDsgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTAucG9zaXRpb24sIHJlbF9wb3MxKTsKICAgIC8vIGNvbnRhY3RQb3NXb3JsZC52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMik7CgogICAgYm9keTAuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwxKTsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KGNvbnRhY3RQb3NXb3JsZCwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHZyZWwgPSBmcmljdGlvbkRpcmVjdGlvbldvcmxkLmRvdCh2ZWwpOwogICAgY29uc3QgZGVub20wID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5MCwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCk7CiAgICBjb25zdCBkZW5vbTEgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkxLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IHJlbGF4YXRpb24gPSAxOwogICAgY29uc3QgamFjRGlhZ0FCSW52ID0gcmVsYXhhdGlvbiAvIChkZW5vbTAgKyBkZW5vbTEpOyAvLyBjYWxjdWxhdGUgaiB0aGF0IG1vdmVzIHVzIHRvIHplcm8gcmVsYXRpdmUgdmVsb2NpdHkKCiAgICBqMSA9IC12cmVsICogamFjRGlhZ0FCSW52OwoKICAgIGlmIChtYXhJbXB1bHNlIDwgajEpIHsKICAgICAgajEgPSBtYXhJbXB1bHNlOwogICAgfQoKICAgIGlmIChqMSA8IC1tYXhJbXB1bHNlKSB7CiAgICAgIGoxID0gLW1heEltcHVsc2U7CiAgICB9CgogICAgcmV0dXJuIGoxOwogIH0KCiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbSA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keSwgcG9zLCBub3JtYWwpIHsKICAgIGNvbnN0IHIwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMDsKICAgIGNvbnN0IGMwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMDsKICAgIGNvbnN0IHZlYyA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfdmVjOwogICAgY29uc3QgbSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbTsKICAgIHBvcy52c3ViKGJvZHkucG9zaXRpb24sIHIwKTsKICAgIHIwLmNyb3NzKG5vcm1hbCwgYzApOwogICAgYm9keS5pbnZJbmVydGlhV29ybGQudm11bHQoYzAsIG0pOwogICAgbS5jcm9zcyhyMCwgdmVjKTsKICAgIHJldHVybiBib2R5Lmludk1hc3MgKyBub3JtYWwuZG90KHZlYyk7CiAgfQoKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwgPSBuZXcgVmVjMygpOyAvLyBiaWxhdGVyYWwgY29uc3RyYWludCBiZXR3ZWVuIHR3byBkeW5hbWljIG9iamVjdHMKCiAgZnVuY3Rpb24gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChib2R5MSwgcG9zMSwgYm9keTIsIHBvczIsIG5vcm1hbCkgewogICAgY29uc3Qgbm9ybWFsTGVuU3FyID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICBpZiAobm9ybWFsTGVuU3FyID4gMS4xKSB7CiAgICAgIHJldHVybiAwOyAvLyBubyBpbXB1bHNlCiAgICB9IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgIC8vIHBvczEudnN1Yihib2R5MS5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gcG9zMi52c3ViKGJvZHkyLnBvc2l0aW9uLCByZWxfcG9zMik7CgoKICAgIGNvbnN0IHZlbDEgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDE7CiAgICBjb25zdCB2ZWwyID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyOwogICAgY29uc3QgdmVsID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWw7CiAgICBib2R5MS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChwb3MxLCB2ZWwxKTsKICAgIGJvZHkyLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczIsIHZlbDIpOwogICAgdmVsMS52c3ViKHZlbDIsIHZlbCk7CiAgICBjb25zdCByZWxfdmVsID0gbm9ybWFsLmRvdCh2ZWwpOwogICAgY29uc3QgY29udGFjdERhbXBpbmcgPSAwLjI7CiAgICBjb25zdCBtYXNzVGVybSA9IDEgLyAoYm9keTEuaW52TWFzcyArIGJvZHkyLmludk1hc3MpOwogICAgY29uc3QgaW1wdWxzZSA9IC1jb250YWN0RGFtcGluZyAqIHJlbF92ZWwgKiBtYXNzVGVybTsKICAgIHJldHVybiBpbXB1bHNlOwogIH0KCiAgLyoqCiAgICogU3BoZXJpY2FsIHNoYXBlCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzID0gMQogICAqICAgICBjb25zdCBzcGhlcmVTaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKHJhZGl1cykKICAgKiAgICAgY29uc3Qgc3BoZXJlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBzcGhlcmVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHNwaGVyZUJvZHkpCiAgICovCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXMgIT09IHVuZGVmaW5lZCA/IHJhZGl1cyA6IDEuMDsKCiAgICAgIGlmICh0aGlzLnJhZGl1cyA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzcGhlcmUgcmFkaXVzIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYSAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IEkgPSAyLjAgKiBtYXNzICogdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyAvIDUuMDsKICAgICAgdGFyZ2V0LnggPSBJOwogICAgICB0YXJnZXQueSA9IEk7CiAgICAgIHRhcmdldC56ID0gSTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKiB2b2x1bWUgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIE1hdGgucG93KHRoaXMucmFkaXVzLCAzKSAvIDMuMDsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHRoaXMucmFkaXVzOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIGNvbnN0IHIgPSB0aGlzLnJhZGl1czsKICAgICAgY29uc3QgYXhlcyA9IFsneCcsICd5JywgJ3onXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGF4ID0gYXhlc1tpXTsKICAgICAgICBtaW5bYXhdID0gcG9zW2F4XSAtIHI7CiAgICAgICAgbWF4W2F4XSA9IHBvc1theF0gKyByOwogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEN5bGluZGVyIGNsYXNzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1c1RvcCA9IDAuNQogICAqICAgICBjb25zdCByYWRpdXNCb3R0b20gPSAwLjUKICAgKiAgICAgY29uc3QgaGVpZ2h0ID0gMgogICAqICAgICBjb25zdCBudW1TZWdtZW50cyA9IDEyCiAgICogICAgIGNvbnN0IGN5bGluZGVyU2hhcGUgPSBuZXcgQ0FOTk9OLkN5bGluZGVyKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKQogICAqICAgICBjb25zdCBjeWxpbmRlckJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY3lsaW5kZXJTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGN5bGluZGVyQm9keSkKICAgKi8KCiAgY2xhc3MgQ3lsaW5kZXIgZXh0ZW5kcyBDb252ZXhQb2x5aGVkcm9uIHsKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4gKi8KCiAgICAvKiogVGhlIG51bWJlciBvZiBzZWdtZW50cyB0byBidWlsZCB0aGUgY3lsaW5kZXIgb3V0IG9mLiAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHJhZGl1c1RvcCBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIHJhZGl1c0JvdHRvbSBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4KICAgICAqIEBwYXJhbSBudW1TZWdtZW50cyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKSB7CiAgICAgIGlmIChyYWRpdXNUb3AgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c1RvcCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c0JvdHRvbSA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChoZWlnaHQgPT09IHZvaWQgMCkgewogICAgICAgIGhlaWdodCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChudW1TZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbnVtU2VnbWVudHMgPSA4OwogICAgICB9CgogICAgICBpZiAocmFkaXVzVG9wIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGN5bGluZGVyIHJhZGl1c1RvcCBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzQm90dG9tIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgY29uc3QgTiA9IG51bVNlZ21lbnRzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBheGVzID0gW107CiAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgIGNvbnN0IGJvdHRvbWZhY2UgPSBbXTsKICAgICAgY29uc3QgdG9wZmFjZSA9IFtdOwogICAgICBjb25zdCBjb3MgPSBNYXRoLmNvczsKICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW47IC8vIEZpcnN0IGJvdHRvbSBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKDApLCAtaGVpZ2h0ICogMC41LCByYWRpdXNCb3R0b20gKiBjb3MoMCkpKTsKICAgICAgYm90dG9tZmFjZS5wdXNoKDApOyAvLyBGaXJzdCB0b3AgcG9pbnQKCiAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbigwKSwgaGVpZ2h0ICogMC41LCByYWRpdXNUb3AgKiBjb3MoMCkpKTsKICAgICAgdG9wZmFjZS5wdXNoKDEpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCB0aGV0YSA9IDIgKiBNYXRoLlBJIC8gTiAqIChpICsgMSk7CiAgICAgICAgY29uc3QgdGhldGFOID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAwLjUpOwoKICAgICAgICBpZiAoaSA8IE4gLSAxKSB7CiAgICAgICAgICAvLyBCb3R0b20KICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c0JvdHRvbSAqIHNpbih0aGV0YSksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIGJvdHRvbWZhY2UucHVzaCgyICogaSArIDIpOyAvLyBUb3AKCiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNUb3AgKiBzaW4odGhldGEpLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIHRvcGZhY2UucHVzaCgyICogaSArIDMpOyAvLyBGYWNlCgogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMiAqIGkgKyAzLCAyICogaSArIDJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMSwgMF0pOyAvLyBDb25uZWN0CiAgICAgICAgfSAvLyBBeGlzOiB3ZSBjYW4gY3V0IG9mZiBoYWxmIG9mIHRoZW0gaWYgd2UgaGF2ZSBldmVuIG51bWJlciBvZiBzZWdtZW50cwoKCiAgICAgICAgaWYgKE4gJSAyID09PSAxIHx8IGkgPCBOIC8gMikgewogICAgICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKC1zaW4odGhldGFOKSwgMCwgY29zKHRoZXRhTikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZhY2VzLnB1c2goYm90dG9tZmFjZSk7CiAgICAgIGF4ZXMucHVzaChuZXcgVmVjMygwLCAxLCAwKSk7IC8vIFJlb3JkZXIgdG9wIGZhY2UKCiAgICAgIGNvbnN0IHRlbXAgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wZmFjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRlbXAucHVzaCh0b3BmYWNlW3RvcGZhY2UubGVuZ3RoIC0gaSAtIDFdKTsKICAgICAgfQoKICAgICAgZmFjZXMucHVzaCh0ZW1wKTsKICAgICAgc3VwZXIoewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMudHlwZSA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogICAgICB0aGlzLnJhZGl1c1RvcCA9IHJhZGl1c1RvcDsKICAgICAgdGhpcy5yYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b207CiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLm51bVNlZ21lbnRzID0gbnVtU2VnbWVudHM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogUGFydGljbGUgc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGFydGljbGVTaGFwZSA9IG5ldyBDQU5OT04uUGFydGljbGUoKQogICAqICAgICBjb25zdCBwYXJ0aWNsZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogcGFydGljbGVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHBhcnRpY2xlQm9keSkKICAgKi8KICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CgogIC8qKgogICAqIEEgcGxhbmUsIGZhY2luZyBpbiB0aGUgWiBkaXJlY3Rpb24uIFRoZSBwbGFuZSBoYXMgaXRzIHN1cmZhY2UgYXQgej0wIGFuZCBldmVyeXRoaW5nIGJlbG93IHo9MCBpcyBhc3N1bWVkIHRvIGJlIHNvbGlkIHBsYW5lLiBUbyBtYWtlIHRoZSBwbGFuZSBmYWNlIGluIHNvbWUgb3RoZXIgZGlyZWN0aW9uIHRoYW4geiwgeW91IG11c3QgcHV0IGl0IGluc2lkZSBhIEJvZHkgYW5kIHJvdGF0ZSB0aGF0IGJvZHkuIFNlZSB0aGUgZGVtb3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGxhbmVTaGFwZSA9IG5ldyBDQU5OT04uUGxhbmUoKQogICAqICAgICBjb25zdCBwbGFuZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAwLCBzaGFwZTogIHBsYW5lU2hhcGUgfSkKICAgKiAgICAgcGxhbmVCb2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJIC8gMiwgMCwgMCkgLy8gbWFrZSBpdCBmYWNlIHVwCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGxhbmVCb2R5KQogICAqLwogIGNsYXNzIFBsYW5lIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHdvcmxkTm9ybWFsICovCgogICAgLyoqIHdvcmxkTm9ybWFsTmVlZHNVcGRhdGUgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUExBTkUKICAgICAgfSk7IC8vIFdvcmxkIG9yaWVudGVkIG5vcm1hbAoKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KICBjb25zdCB0ZW1wTm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KICBjbGFzcyBIZWlnaHRmaWVsZCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXggdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2luZyBiZXR3ZWVuIHRoZSBkYXRhIHBvaW50cyBpbiBYIGFuZCBZIGRpcmVjdGlvbi4KICAgICAqIEB0b2RvIGVsZW1lbnRTaXplWCBhbmQgWQogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkYXRhIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZGF0YSwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIG1heFZhbHVlOiBudWxsLAogICAgICAgIG1pblZhbHVlOiBudWxsLAogICAgICAgIGVsZW1lbnRTaXplOiAxCiAgICAgIH0pOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuSEVJR0hURklFTEQKICAgICAgfSk7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIGAke3hpfV8ke3lpfV8ke2dldFVwcGVyVHJpYW5nbGUgPyAxIDogMH1gOwogICAgfQoKICAgIGdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CgogICAgc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCBjb252ZXgsIG9mZnNldCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXSA9IHsKICAgICAgICBjb252ZXgsCiAgICAgICAgb2Zmc2V0CiAgICAgIH07CiAgICB9CgogICAgY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBmcm9tIHRoZSBoZWlnaHRmaWVsZAogICAgICovCgoKICAgIGdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgICAgIGIuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICAgIGMuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgICAgYi5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgICAgYy5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgaW4gdGhlIHRlcnJhaW4gaW4gdGhlIGZvcm0gb2YgYSB0cmlhbmd1bGFyIGNvbnZleCBzaGFwZS4KICAgICAqLwoKCiAgICBnZXRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucGlsbGFyQ29udmV4OwogICAgICBsZXQgb2Zmc2V0UmVzdWx0ID0gdGhpcy5waWxsYXJPZmZzZXQ7CgogICAgICBpZiAodGhpcy5jYWNoZUVuYWJsZWQpIHsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpOwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBkYXRhLmNvbnZleDsKICAgICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gZGF0YS5vZmZzZXQ7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICAgIG9mZnNldFJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSByZXN1bHQ7CiAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBvZmZzZXRSZXN1bHQ7CiAgICAgIH0KCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZmFjZXMgPSByZXN1bHQuZmFjZXM7IC8vIFJldXNlIHZlcnRzIGlmIHBvc3NpYmxlCgogICAgICByZXN1bHQudmVydGljZXMubGVuZ3RoID0gNjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgaWYgKCFyZXN1bHQudmVydGljZXNbaV0pIHsKICAgICAgICAgIHJlc3VsdC52ZXJ0aWNlc1tpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFJldXNlIGZhY2VzIGlmIHBvc3NpYmxlCgoKICAgICAgZmFjZXMubGVuZ3RoID0gNTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgaWYgKCFmYWNlc1tpXSkgewogICAgICAgICAgZmFjZXNbaV0gPSBbXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gcmVzdWx0LnZlcnRpY2VzOwogICAgICBjb25zdCBoID0gKE1hdGgubWluKGRhdGFbeGldW3lpXSwgZGF0YVt4aSArIDFdW3lpXSwgZGF0YVt4aV1beWkgKyAxXSwgZGF0YVt4aSArIDFdW3lpICsgMV0pIC0gdGhpcy5taW5WYWx1ZSkgLyAyICsgdGhpcy5taW5WYWx1ZTsKCiAgICAgIGlmICghZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuMjUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyB0b3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gLXggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAwOwogICAgICAgIGZhY2VzWzJdWzFdID0gMjsKICAgICAgICBmYWNlc1syXVsyXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bM10gPSAzOyAvLyAteSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDE7CiAgICAgICAgZmFjZXNbM11bMV0gPSAwOwogICAgICAgIGZhY2VzWzNdWzJdID0gMzsKICAgICAgICBmYWNlc1szXVszXSA9IDQ7IC8vICt4eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA1OwogICAgICAgIGZhY2VzWzRdWzJdID0gMjsKICAgICAgICBmYWNlc1s0XVszXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyBUb3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gK3ggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAyOwogICAgICAgIGZhY2VzWzJdWzFdID0gNTsKICAgICAgICBmYWNlc1syXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbMl1bM10gPSAwOyAvLyAreSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDM7CiAgICAgICAgZmFjZXNbM11bMV0gPSA0OwogICAgICAgIGZhY2VzWzNdWzJdID0gMTsKICAgICAgICBmYWNlc1szXVszXSA9IDA7IC8vIC14eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDE7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA0OwogICAgICAgIGZhY2VzWzRdWzJdID0gNTsKICAgICAgICBmYWNlc1s0XVszXSA9IDI7CiAgICAgIH0KCiAgICAgIHJlc3VsdC5jb21wdXRlTm9ybWFscygpOwogICAgICByZXN1bHQuY29tcHV0ZUVkZ2VzKCk7CiAgICAgIHJlc3VsdC51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB0aGlzLnNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgcmVzdWx0LCBvZmZzZXRSZXN1bHQpOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHRlcnJhaW4gaXMgaW5maW5pdGUKICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoqIEBUT0RPIGRvIGl0IHByb3Blcmx5ICovCiAgICAgIG1pbi5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CiAgICAgIG1heC5zZXQoTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIFVzZSB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBtaW4vbWF4IHZhbHVlcwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBzID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IG5ldyBWZWMzKGRhdGEubGVuZ3RoICogcywgZGF0YVswXS5sZW5ndGggKiBzLCBNYXRoLm1heChNYXRoLmFicyh0aGlzLm1heFZhbHVlKSwgTWF0aC5hYnModGhpcy5taW5WYWx1ZSkpKS5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgaGVpZ2h0IHZhbHVlcyBmcm9tIGFuIGltYWdlLiBDdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3Nlci4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRzRnJvbUltYWdlKGltYWdlLCBzY2FsZSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB6LAogICAgICAgIHkKICAgICAgfSA9IHNjYWxlOwogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgY29uc3QgbWF0cml4ID0gdGhpcy5kYXRhOwogICAgICBtYXRyaXgubGVuZ3RoID0gMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IE1hdGguYWJzKHgpIC8gaW1hZ2VEYXRhLndpZHRoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuaGVpZ2h0OyBpKyspIHsKICAgICAgICBjb25zdCByb3cgPSBbXTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWFnZURhdGEud2lkdGg7IGorKykgewogICAgICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNF07CiAgICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMV07CiAgICAgICAgICBjb25zdCBjID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMl07CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSAoYSArIGIgKyBjKSAvIDQgLyAyNTUgKiB6OwoKICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICByb3cucHVzaChoZWlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnVuc2hpZnQoaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh5IDwgMCkgewogICAgICAgICAgbWF0cml4LnVuc2hpZnQocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0cml4LnB1c2gocm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfQoKICB9CiAgY29uc3QgZ2V0SGVpZ2h0QXRfaWR4ID0gW107CiAgY29uc3QgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UxID0gbmV3IFZlYzMoKTsgLy8gZnJvbSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXJ5Y2VudHJpY19jb29yZGluYXRlX3N5c3RlbQoKICBmdW5jdGlvbiBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcmVzdWx0KSB7CiAgICByZXN1bHQueCA9ICgoYnkgLSBjeSkgKiAoeCAtIGN4KSArIChjeCAtIGJ4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnkgPSAoKGN5IC0gYXkpICogKHggLSBjeCkgKyAoYXggLSBjeCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC56ID0gMSAtIHJlc3VsdC54IC0gcmVzdWx0Lnk7CiAgfQoKICAvKioKICAgKiBPY3RyZWVOb2RlCiAgICovCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CiAgY29uc3QgaGFsZkRpYWdvbmFsID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBBQUJCID0gbmV3IEFBQkIoKTsKCiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KICBjbGFzcyBUcmltZXNoIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiB2ZXJ0aWNlcwogICAgICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VycywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIHRyaWFuZ2xlIGNvbnNpc3RzIG9mLiBUaGUgbGVuZ3RoIG9mIHRoaXMgYXJyYXkgaXMgdGh1cyAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdHJpYW5nbGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbm9ybWFscyBkYXRhLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbG9jYWwgQUFCQiBvZiB0aGUgbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlcyB0byB2ZXJ0ZXggcGFpcnMsIG1ha2luZyB1cCBhbGwgdW5pcXVlIGVkZ2VzIGluIHRoZSB0cmltZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBzY2FsaW5nIG9mIHRoZSBtZXNoLiBVc2UgLnNldFNjYWxlKCkgdG8gc2V0IGl0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXhlZCB0cmlhbmdsZXMuIFVzZSAudXBkYXRlVHJlZSgpIHRvIHVwZGF0ZSBpdC4KICAgICAqLwogICAgY29uc3RydWN0b3IodmVydGljZXMsIGluZGljZXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlRSSU1FU0gKICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYCR7YX1fJHtifWAgOiBgJHtifV8ke2F9YDsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KICBjb25zdCBjb21wdXRlTm9ybWFsc19uID0gbmV3IFZlYzMoKTsKICBjb25zdCB1bnNjYWxlZEFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICBjb25zdCBhYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2xpX2FhYmIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWUgPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2FhYmIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwogIGNsYXNzIFNvbHZlciB7CiAgICAvKioKICAgICAqIEFsbCBlcXVhdGlvbnMgdG8gYmUgc29sdmVkCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcyEKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdAogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgcmV0dXJuICgvLyBTaG91bGQgcmV0dXJuIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBkb25lIQogICAgICAgIDAKICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgYWRkRXF1YXRpb24oZXEpIHsKICAgICAgaWYgKGVxLmVuYWJsZWQgJiYgIWVxLmJpLmlzVHJpZ2dlciAmJiAhZXEuYmouaXNUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgcmVtb3ZlRXF1YXRpb24oZXEpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IGkgPSBlcXMuaW5kZXhPZihlcSk7CgogICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICBlcXMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbGwgZXF1YXRpb25zCiAgICAgKi8KCgogICAgcmVtb3ZlQWxsRXF1YXRpb25zKCkgewogICAgICB0aGlzLmVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gR2F1c3MtU2VpZGVsIHNvbHZlci4KICAgKiBAdG9kbyBUaGUgc3Bvb2sgcGFyYW1ldGVycyBzaG91bGQgYmUgc3BlY2lmaWVkIGZvciBlYWNoIGNvbnN0cmFpbnQsIG5vdCBnbG9iYWxseS4KICAgKiBAc2VlIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDA5L2xlY3R1cmVzL3Nwb29rbm90ZXMucGRmCiAgICovCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9sYW1iZGEgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9pbnZDcyA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX0JzID0gW107CgogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCiAgY2xhc3MgU3BsaXRTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqIHN1YnNvbHZlciAqLwogICAgY29uc3RydWN0b3Ioc3Vic29sdmVyKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICAgIHRoaXMuc3Vic29sdmVyID0gc3Vic29sdmVyOwogICAgICB0aGlzLm5vZGVzID0gW107CiAgICAgIHRoaXMubm9kZVBvb2wgPSBbXTsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlICh0aGlzLm5vZGVQb29sLmxlbmd0aCA8IDEyOCkgewogICAgICAgIHRoaXMubm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY3JlYXRlTm9kZQogICAgICovCgoKICAgIGNyZWF0ZU5vZGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYm9keTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgZXFzOiBbXSwKICAgICAgICB2aXNpdGVkOiBmYWxzZQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSB0aGUgc3Vic3lzdGVtcwogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgY29uc3Qgbm9kZXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlczsKICAgICAgY29uc3Qgbm9kZVBvb2wgPSB0aGlzLm5vZGVQb29sOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3Qgc3Vic29sdmVyID0gdGhpcy5zdWJzb2x2ZXI7IC8vIENyZWF0ZSBuZWVkZWQgbm9kZXMsIHJldXNlIGlmIHBvc3NpYmxlCgogICAgICB3aGlsZSAobm9kZVBvb2wubGVuZ3RoIDwgTmJvZGllcykgewogICAgICAgIG5vZGVQb29sLnB1c2godGhpcy5jcmVhdGVOb2RlKCkpOwogICAgICB9CgogICAgICBub2Rlcy5sZW5ndGggPSBOYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOYm9kaWVzOyBpKyspIHsKICAgICAgICBub2Rlc1tpXSA9IG5vZGVQb29sW2ldOwogICAgICB9IC8vIFJlc2V0IG5vZGUgdmFsdWVzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICBub2RlLmJvZHkgPSBib2RpZXNbaV07CiAgICAgICAgbm9kZS5jaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIG5vZGUuZXFzLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOZXE7IGsrKykgewogICAgICAgIGNvbnN0IGVxID0gZXF1YXRpb25zW2tdOwogICAgICAgIGNvbnN0IGkgPSBib2RpZXMuaW5kZXhPZihlcS5iaSk7CiAgICAgICAgY29uc3QgaiA9IGJvZGllcy5pbmRleE9mKGVxLmJqKTsKICAgICAgICBjb25zdCBuaSA9IG5vZGVzW2ldOwogICAgICAgIGNvbnN0IG5qID0gbm9kZXNbal07CiAgICAgICAgbmkuY2hpbGRyZW4ucHVzaChuaik7CiAgICAgICAgbmkuZXFzLnB1c2goZXEpOwogICAgICAgIG5qLmNoaWxkcmVuLnB1c2gobmkpOwogICAgICAgIG5qLmVxcy5wdXNoKGVxKTsKICAgICAgfQoKICAgICAgbGV0IGNoaWxkOwogICAgICBsZXQgbiA9IDA7CiAgICAgIGxldCBlcXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9lcXM7CiAgICAgIHN1YnNvbHZlci50b2xlcmFuY2UgPSB0aGlzLnRvbGVyYW5jZTsKICAgICAgc3Vic29sdmVyLml0ZXJhdGlvbnMgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IGR1bW15V29ybGQgPSBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlcykpIHsKICAgICAgICBlcXMubGVuZ3RoID0gMDsKICAgICAgICBkdW1teVdvcmxkLmJvZGllcy5sZW5ndGggPSAwOwogICAgICAgIGJmcyhjaGlsZCwgdmlzaXRGdW5jLCBkdW1teVdvcmxkLmJvZGllcywgZXFzKTsKICAgICAgICBjb25zdCBOZXFzID0gZXFzLmxlbmd0aDsKICAgICAgICBlcXMgPSBlcXMuc29ydChzb3J0QnlJZCk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgICAgIHN1YnNvbHZlci5hZGRFcXVhdGlvbihlcXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgc3Vic29sdmVyLnNvbHZlKGR0LCBkdW1teVdvcmxkKTsKICAgICAgICBzdWJzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7CiAgICAgICAgbisrOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KCiAgfSAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3Vic3lzdGVtcwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQoKICAvKioKICAgKiBGb3IgcG9vbGluZyBvYmplY3RzIHRoYXQgY2FuIGJlIHJldXNlZC4KICAgKi8KICBjbGFzcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgICAgdGhpcy50eXBlID0gT2JqZWN0OwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KICAgIHJlbGVhc2UoKSB7CiAgICAgIGNvbnN0IE5hcmdzID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYXJnczsgaSsrKSB7CiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2goaSA8IDAgfHwgYXJndW1lbnRzLmxlbmd0aCA8PSBpID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBvYmplY3QKICAgICAqLwoKCiAgICBnZXQoKSB7CiAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0T2JqZWN0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5wb3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYW4gb2JqZWN0LiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZWFjaCBzdWJjbGFzcy4KICAgICAqLwoKCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29uc3RydWN0T2JqZWN0KCkgbm90IGltcGxlbWVudGVkIGluIHRoaXMgUG9vbCBzdWJjbGFzcyB5ZXQhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gU2VsZiwgZm9yIGNoYWluaW5nCiAgICAgKi8KCgogICAgcmVzaXplKHNpemUpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMub2JqZWN0czsKCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA+IHNpemUpIHsKICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICB9CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wdXNoKHRoaXMuY29uc3RydWN0T2JqZWN0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQoKICAvKioKICAgKiBWZWMzUG9vbAogICAqLwoKICBjbGFzcyBWZWMzUG9vbCBleHRlbmRzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMudHlwZSA9IFZlYzM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB2ZWN0b3IKICAgICAqLwogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKICBjb25zdCBDT0xMSVNJT05fVFlQRVMgPSB7CiAgICBzcGhlcmVTcGhlcmU6IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHNwaGVyZVBsYW5lOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5QTEFORSwKICAgIGJveEJveDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQk9YLAogICAgc3BoZXJlQm94OiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBwbGFuZUJveDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBjb252ZXhDb252ZXg6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVDb252ZXg6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBwbGFuZUNvbnZleDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgYm94Q29udmV4OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgc3BoZXJlSGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgYm94SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgY29udmV4SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRCwKICAgIHNwaGVyZVBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHBsYW5lUGFydGljbGU6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBib3hQYXJ0aWNsZTogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBjb252ZXhQYXJ0aWNsZTogU2hhcGUudHlwZXMuUEFSVElDTEUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgY3lsaW5kZXJDeWxpbmRlcjogU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVDeWxpbmRlcjogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwbGFuZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgYm94Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgY29udmV4Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwYXJ0aWNsZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgc3BoZXJlVHJpbWVzaDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuVFJJTUVTSCwKICAgIHBsYW5lVHJpbWVzaDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5UUklNRVNICiAgfTsKCiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwogIGNsYXNzIE5hcnJvd3BoYXNlIHsKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmFnZSBvZiBwb29sZWQgY29udGFjdCBwb2ludHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvb2xlZCB2ZWN0b3JzLgogICAgICovCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGxhbmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVQbGFuZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveENvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lUGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveFBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94UGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5oZWlnaHRmaWVsZEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wYXJ0aWNsZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFydGljbGVDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVUcmltZXNoXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICBjb25zdCBtdWcgPSBmcmljdGlvbiAqIHdvcmxkLmdyYXZpdHkubGVuZ3RoKCk7CiAgICAgICAgbGV0IHJlZHVjZWRNYXNzID0gYm9keUEuaW52TWFzcyArIGJvZHlCLmludk1hc3M7CgogICAgICAgIGlmIChyZWR1Y2VkTWFzcyA+IDApIHsKICAgICAgICAgIHJlZHVjZWRNYXNzID0gMSAvIHJlZHVjZWRNYXNzOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcG9vbCA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGMxLmJpID0gYzIuYmkgPSBib2R5QTsKICAgICAgICBjMS5iaiA9IGMyLmJqID0gYm9keUI7CiAgICAgICAgYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcgKiByZWR1Y2VkTWFzczsKICAgICAgICBjMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnICogcmVkdWNlZE1hc3M7IC8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwoKICAgICAgICBjMS5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzEucmouY29weShjb250YWN0RXF1YXRpb24ucmopOwogICAgICAgIGMyLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMi5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7IC8vIENvbnN0cnVjdCB0YW5nZW50cwoKICAgICAgICBjb250YWN0RXF1YXRpb24ubmkudGFuZ2VudHMoYzEudCwgYzIudCk7IC8vIFNldCBzcG9vayBwYXJhbXMKCiAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gY29udGFjdEVxdWF0aW9uLmVuYWJsZWQ7CiAgICAgICAgb3V0QXJyYXkucHVzaChjMSwgYzIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRha2UgdGhlIGF2ZXJhZ2UgTiBsYXRlc3QgY29udGFjdCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAgKi8KCgogICAgY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cykgewogICAgICAvLyBUaGUgbGFzdCBjb250YWN0RXF1YXRpb24KICAgICAgbGV0IGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxXTsgLy8gQ3JlYXRlIHRoZSByZXN1bHQ6IHR3byAiYXZlcmFnZSIgZnJpY3Rpb24gZXF1YXRpb25zCgogICAgICBpZiAoIXRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjLCB0aGlzLmZyaWN0aW9uUmVzdWx0KSB8fCBudW1Db250YWN0cyA9PT0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZjEgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMl07CiAgICAgIGNvbnN0IGYyID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICBhdmVyYWdlTm9ybWFsLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zZXRaZXJvKCk7CiAgICAgIGNvbnN0IGJvZHlBID0gYy5iaTsKICAgICAgYy5iajsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBudW1Db250YWN0czsgaSsrKSB7CiAgICAgICAgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDEgLSBpXTsKCiAgICAgICAgaWYgKGMuYmkgIT09IGJvZHlBKSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZhZGQoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZzdWIoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgaW52TnVtQ29udGFjdHMgPSAxIC8gbnVtQ29udGFjdHM7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaSk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaik7CiAgICAgIGYyLnJpLmNvcHkoZjEucmkpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUKCiAgICAgIGYyLnJqLmNvcHkoZjEucmopOwogICAgICBhdmVyYWdlTm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBhdmVyYWdlTm9ybWFsLnRhbmdlbnRzKGYxLnQsIGYyLnQpOyAvLyByZXR1cm4gZXE7CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFsbCBjb250YWN0cyBiZXR3ZWVuIGEgbGlzdCBvZiBib2R5IHBhaXJzCiAgICAgKiBAcGFyYW0gcDEgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcDIgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFycmF5IHRvIHN0b3JlIGdlbmVyYXRlZCBjb250YWN0cwogICAgICogQHBhcmFtIG9sZGNvbnRhY3RzIE9wdGlvbmFsLiBBcnJheSBvZiByZXVzYWJsZSBjb250YWN0IG9iamVjdHMKICAgICAqLwoKCiAgICBnZXRDb250YWN0cyhwMSwgcDIsIHdvcmxkLCByZXN1bHQsIG9sZGNvbnRhY3RzLCBmcmljdGlvblJlc3VsdCwgZnJpY3Rpb25Qb29sKSB7CiAgICAgIC8vIFNhdmUgb2xkIGNvbnRhY3Qgb2JqZWN0cwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBvbGRjb250YWN0czsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IGZyaWN0aW9uUG9vbDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBmcmljdGlvblJlc3VsdDsKICAgICAgY29uc3QgcWkgPSB0bXBRdWF0MTsKICAgICAgY29uc3QgcWogPSB0bXBRdWF0MjsKICAgICAgY29uc3QgeGkgPSB0bXBWZWMxOwogICAgICBjb25zdCB4aiA9IHRtcFZlYzI7CgogICAgICBmb3IgKGxldCBrID0gMCwgTiA9IHAxLmxlbmd0aDsgayAhPT0gTjsgaysrKSB7CiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGJvZGllcwogICAgICAgIGNvbnN0IGJpID0gcDFba107CiAgICAgICAgY29uc3QgYmogPSBwMltrXTsgLy8gR2V0IGNvbnRhY3QgbWF0ZXJpYWwKCiAgICAgICAgbGV0IGJvZHlDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGJvZHlDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganVzdFRlc3QgPSBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuU1RBVElDIHx8IGJpLnR5cGUgJiBCb2R5LlNUQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUMgfHwgYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQzsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaS5zaGFwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJpLnF1YXRlcm5pb24ubXVsdChiaS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgICAgYmkucXVhdGVybmlvbi52bXVsdChiaS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICAgIHhpLnZhZGQoYmkucG9zaXRpb24sIHhpKTsKICAgICAgICAgIGNvbnN0IHNpID0gYmkuc2hhcGVzW2ldOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmouc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIC8vIENvbXB1dGUgd29ybGQgdHJhbnNmb3JtIG9mIHNoYXBlcwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLm11bHQoYmouc2hhcGVPcmllbnRhdGlvbnNbal0sIHFqKTsKICAgICAgICAgICAgYmoucXVhdGVybmlvbi52bXVsdChiai5zaGFwZU9mZnNldHNbal0sIHhqKTsKICAgICAgICAgICAgeGoudmFkZChiai5wb3NpdGlvbiwgeGopOwogICAgICAgICAgICBjb25zdCBzaiA9IGJqLnNoYXBlc1tqXTsKCiAgICAgICAgICAgIGlmICghKHNpLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzai5jb2xsaXNpb25GaWx0ZXJHcm91cCAmJiBzai5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2kuY29sbGlzaW9uRmlsdGVyR3JvdXApKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSAvLyBHZXQgY29sbGlzaW9uIG1hdGVyaWFsCgoKICAgICAgICAgICAgbGV0IHNoYXBlQ29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChzaS5tYXRlcmlhbCAmJiBzai5tYXRlcmlhbCkgewogICAgICAgICAgICAgIHNoYXBlQ29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKHNpLm1hdGVyaWFsLCBzai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gc2hhcGVDb250YWN0TWF0ZXJpYWwgfHwgYm9keUNvbnRhY3RNYXRlcmlhbCB8fCB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOyAvLyBHZXQgY29udGFjdHMKCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVySW5kZXggPSBzaS50eXBlIHwgc2oudHlwZTsKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzW3Jlc29sdmVySW5kZXhdOwoKICAgICAgICAgICAgaWYgKHJlc29sdmVyKSB7CiAgICAgICAgICAgICAgbGV0IHJldHZhbCA9IGZhbHNlOyAvLyBUTyBETzogaW52ZXN0aWdhdGUgd2h5IHNwaGVyZVBhcnRpY2xlIGFuZCBjb252ZXhQYXJ0aWNsZQogICAgICAgICAgICAgIC8vIHJlc29sdmVycyBleHBlY3Qgc2kgYW5kIHNqIHNoYXBlcyB0byBiZSBpbiByZXZlcnNlIG9yZGVyCiAgICAgICAgICAgICAgLy8gKGkuZS4gbGFyZ2VyIGludGVnZXIgdmFsdWUgdHlwZSBmaXJzdCBpbnN0ZWFkIG9mIHNtYWxsZXIgZmlyc3QpCgogICAgICAgICAgICAgIGlmIChzaS50eXBlIDwgc2oudHlwZSkgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0dmFsICYmIGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciBvdmVybGFwCiAgICAgICAgICAgICAgICB3b3JsZC5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgICAgICAgICAgICB3b3JsZC5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVTcGhlcmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgcmV0dXJuIHhpLmRpc3RhbmNlU3F1YXJlZCh4aikgPCAoc2kucmFkaXVzICsgc2oucmFkaXVzKSAqKiAyOwogICAgICB9IC8vIFdlIHdpbGwgaGF2ZSBvbmx5IG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQoKCiAgICAgIGNvbnN0IGNvbnRhY3RFcSA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICB4ai52c3ViKHhpLCBjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEubmkubm9ybWFsaXplKCk7IC8vIENvbnRhY3QgcG9pbnQgbG9jYXRpb25zCgogICAgICBjb250YWN0RXEucmkuY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmouY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmkuc2NhbGUoc2kucmFkaXVzLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmouc2NhbGUoLXNqLnJhZGl1cywgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJpLnZhZGQoeGksIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yaS52c3ViKGJpLnBvc2l0aW9uLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmoudmFkZCh4aiwgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJqLnZzdWIoYmoucG9zaXRpb24sIGNvbnRhY3RFcS5yaik7CiAgICAgIHRoaXMucmVzdWx0LnB1c2goY29udGFjdEVxKTsKICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcSwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICB9CgogICAgc3BoZXJlUGxhbmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gV2Ugd2lsbCBoYXZlIG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQogICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHIubmkuc2V0KDAsIDAsIDEpOwogICAgICBxai52bXVsdChyLm5pLCByLm5pKTsKICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIGJvZHkgaSBpcyB0aGUgc3BoZXJlLCBmbGlwIG5vcm1hbAoKICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gTmVlZGVkPwogICAgICAvLyBWZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QgcG9pbnQKCiAgICAgIHIubmkuc2NhbGUoc2kucmFkaXVzLCByLnJpKTsgLy8gUHJvamVjdCBkb3duIHNwaGVyZSBvbiBwbGFuZQoKICAgICAgeGkudnN1Yih4aiwgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKTsKICAgICAgci5uaS5zY2FsZShyLm5pLmRvdChwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpLCBwbGFuZV90b19zcGhlcmVfb3J0aG8pOwogICAgICBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUudnN1YihwbGFuZV90b19zcGhlcmVfb3J0aG8sIHIucmopOyAvLyBUaGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byBwbGFuZQoKICAgICAgaWYgKC1wb2ludF9vbl9wbGFuZV90b19zcGhlcmUuZG90KHIubmkpIDw9IHNpLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgoKICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveEJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7IC8vIHdlIHJlZmVyIHRvIHRoZSBib3ggYXMgYm9keSBqCgogICAgICBjb25zdCBzaWRlcyA9IHNwaGVyZUJveF9zaWRlczsKICAgICAgeGkudnN1Yih4aiwgYm94X3RvX3NwaGVyZSk7CiAgICAgIHNqLmdldFNpZGVOb3JtYWxzKHNpZGVzLCBxaik7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gU3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIHBlbmV0cmF0aW9uIGluZm8KCiAgICAgIGNvbnN0IHNpZGVfbnMgPSBzcGhlcmVCb3hfc2lkZV9uczsKICAgICAgY29uc3Qgc2lkZV9uczEgPSBzcGhlcmVCb3hfc2lkZV9uczE7CiAgICAgIGNvbnN0IHNpZGVfbnMyID0gc3BoZXJlQm94X3NpZGVfbnMyOwogICAgICBsZXQgc2lkZV9oID0gbnVsbDsKICAgICAgbGV0IHNpZGVfcGVuZXRyYXRpb25zID0gMDsKICAgICAgbGV0IHNpZGVfZG90MSA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDIgPSAwOwogICAgICBsZXQgc2lkZV9kaXN0YW5jZSA9IG51bGw7CgogICAgICBmb3IgKGxldCBpZHggPSAwLCBuc2lkZXMgPSBzaWRlcy5sZW5ndGg7IGlkeCAhPT0gbnNpZGVzICYmIGZvdW5kID09PSBmYWxzZTsgaWR4KyspIHsKICAgICAgICAvLyBHZXQgdGhlIHBsYW5lIHNpZGUgbm9ybWFsIChucykKICAgICAgICBjb25zdCBucyA9IHNwaGVyZUJveF9uczsKICAgICAgICBucy5jb3B5KHNpZGVzW2lkeF0pOwogICAgICAgIGNvbnN0IGggPSBucy5sZW5ndGgoKTsKICAgICAgICBucy5ub3JtYWxpemUoKTsgLy8gVGhlIG5vcm1hbC9kaXN0YW5jZSBkb3QgcHJvZHVjdCB0ZWxscyB3aGljaCBzaWRlIG9mIHRoZSBwbGFuZSB3ZSBhcmUKCiAgICAgICAgY29uc3QgZG90ID0gYm94X3RvX3NwaGVyZS5kb3QobnMpOwoKICAgICAgICBpZiAoZG90IDwgaCArIFIgJiYgZG90ID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIHRoZSBvdGhlciB0d28gZGltZW5zaW9ucwogICAgICAgICAgY29uc3QgbnMxID0gc3BoZXJlQm94X25zMTsKICAgICAgICAgIGNvbnN0IG5zMiA9IHNwaGVyZUJveF9uczI7CiAgICAgICAgICBuczEuY29weShzaWRlc1soaWR4ICsgMSkgJSAzXSk7CiAgICAgICAgICBuczIuY29weShzaWRlc1soaWR4ICsgMikgJSAzXSk7CiAgICAgICAgICBjb25zdCBoMSA9IG5zMS5sZW5ndGgoKTsKICAgICAgICAgIGNvbnN0IGgyID0gbnMyLmxlbmd0aCgpOwogICAgICAgICAgbnMxLm5vcm1hbGl6ZSgpOwogICAgICAgICAgbnMyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgY29uc3QgZG90MSA9IGJveF90b19zcGhlcmUuZG90KG5zMSk7CiAgICAgICAgICBjb25zdCBkb3QyID0gYm94X3RvX3NwaGVyZS5kb3QobnMyKTsKCiAgICAgICAgICBpZiAoZG90MSA8IGgxICYmIGRvdDEgPiAtaDEgJiYgZG90MiA8IGgyICYmIGRvdDIgPiAtaDIpIHsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKGRvdCAtIGggLSBSKTsKCiAgICAgICAgICAgIGlmIChzaWRlX2Rpc3RhbmNlID09PSBudWxsIHx8IGRpc3QgPCBzaWRlX2Rpc3RhbmNlKSB7CiAgICAgICAgICAgICAgc2lkZV9kaXN0YW5jZSA9IGRpc3Q7CiAgICAgICAgICAgICAgc2lkZV9kb3QxID0gZG90MTsKICAgICAgICAgICAgICBzaWRlX2RvdDIgPSBkb3QyOwogICAgICAgICAgICAgIHNpZGVfaCA9IGg7CiAgICAgICAgICAgICAgc2lkZV9ucy5jb3B5KG5zKTsKICAgICAgICAgICAgICBzaWRlX25zMS5jb3B5KG5zMSk7CiAgICAgICAgICAgICAgc2lkZV9uczIuY29weShuczIpOwogICAgICAgICAgICAgIHNpZGVfcGVuZXRyYXRpb25zKys7CgogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc2lkZV9wZW5ldHJhdGlvbnMpIHsKICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgc2lkZV9ucy5zY2FsZSgtUiwgci5yaSk7IC8vIFNwaGVyZSByCgogICAgICAgIHIubmkuY29weShzaWRlX25zKTsKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHNob3VsZCBiZSBvdXQgb2Ygc3BoZXJlCgogICAgICAgIHNpZGVfbnMuc2NhbGUoc2lkZV9oLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMS5zY2FsZShzaWRlX2RvdDEsIHNpZGVfbnMxKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczEsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMyLnNjYWxlKHNpZGVfZG90Miwgc2lkZV9uczIpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMiwgci5yaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0gLy8gQ2hlY2sgY29ybmVycwoKCiAgICAgIGxldCByaiA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IDIgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gMiAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgIT09IDIgJiYgIWZvdW5kOyBsKyspIHsKICAgICAgICAgICAgcmouc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGopIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaykgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCgogICAgICAgICAgICB4ai52YWRkKHJqLCBzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgc3BoZXJlX3RvX2Nvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLmNvcHkocmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShyaik7CiAgICAgIHJqID0gbnVsbDsgLy8gQ2hlY2sgZWRnZXMKCiAgICAgIGNvbnN0IGVkZ2VUYW5nZW50ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBlZGdlQ2VudGVyID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCByID0gdjNwb29sLmdldCgpOyAvLyByID0gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlcgoKICAgICAgY29uc3Qgb3J0aG9nb25hbCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZGlzdCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgTnNpZGVzID0gc2lkZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5zaWRlcyAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGlmIChqICUgMyAhPT0gayAlIDMpIHsKICAgICAgICAgICAgLy8gR2V0IGVkZ2UgdGFuZ2VudAogICAgICAgICAgICBzaWRlc1trXS5jcm9zcyhzaWRlc1tqXSwgZWRnZVRhbmdlbnQpOwogICAgICAgICAgICBlZGdlVGFuZ2VudC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgc2lkZXNbal0udmFkZChzaWRlc1trXSwgZWRnZUNlbnRlcik7CiAgICAgICAgICAgIHIuY29weSh4aSk7CiAgICAgICAgICAgIHIudnN1YihlZGdlQ2VudGVyLCByKTsKICAgICAgICAgICAgci52c3ViKHhqLCByKTsKICAgICAgICAgICAgY29uc3Qgb3J0aG9ub3JtID0gci5kb3QoZWRnZVRhbmdlbnQpOyAvLyBkaXN0YW5jZSBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCgogICAgICAgICAgICBlZGdlVGFuZ2VudC5zY2FsZShvcnRob25vcm0sIG9ydGhvZ29uYWwpOyAvLyBWZWN0b3IgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgogICAgICAgICAgICAvLyBGaW5kIHRoZSB0aGlyZCBzaWRlIG9ydGhvZ29uYWwgdG8gdGhpcyBvbmUKCiAgICAgICAgICAgIGxldCBsID0gMDsKCiAgICAgICAgICAgIHdoaWxlIChsID09PSBqICUgMyB8fCBsID09PSBrICUgMykgewogICAgICAgICAgICAgIGwrKzsKICAgICAgICAgICAgfSAvLyB2ZWMgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgcHJvamVjdGVkIHRvIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIHRoZSBlZGdlIHRhbmdlbnQKCgogICAgICAgICAgICBkaXN0LmNvcHkoeGkpOwogICAgICAgICAgICBkaXN0LnZzdWIob3J0aG9nb25hbCwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1YihlZGdlQ2VudGVyLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKHhqLCBkaXN0KTsgLy8gRGlzdGFuY2VzIGluIHRhbmdlbnQgZGlyZWN0aW9uIGFuZCBkaXN0YW5jZSBpbiB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byBpdAoKICAgICAgICAgICAgY29uc3QgdGRpc3QgPSBNYXRoLmFicyhvcnRob25vcm0pOwogICAgICAgICAgICBjb25zdCBuZGlzdCA9IGRpc3QubGVuZ3RoKCk7CgogICAgICAgICAgICBpZiAodGRpc3QgPCBzaWRlc1tsXS5sZW5ndGgoKSAmJiBuZGlzdCA8IFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgZWRnZUNlbnRlci52YWRkKG9ydGhvZ29uYWwsIHJlcy5yaik7IC8vIGJveCByagoKICAgICAgICAgICAgICByZXMucmouY29weShyZXMucmopOwogICAgICAgICAgICAgIGRpc3QubmVnYXRlKHJlcy5uaSk7CiAgICAgICAgICAgICAgcmVzLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGosIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5zY2FsZShSLCByZXMucmkpOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1YihiaS5wb3NpdGlvbiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmoudmFkZCh4aiwgcmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmoudnN1Yihiai5wb3NpdGlvbiwgcmVzLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHJlcyk7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHJlcywgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKGVkZ2VUYW5nZW50LCBlZGdlQ2VudGVyLCByLCBvcnRob2dvbmFsLCBkaXN0KTsKICAgIH0KCiAgICBwbGFuZUJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzai5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5pZCA9IHNqLmlkOwogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleChzaSwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKCiAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzaS5maW5kU2VwYXJhdGluZ0F4aXMoc2osIHhpLCBxaSwgeGosIHFqLCBzZXBBeGlzLCBmYWNlTGlzdEEsIGZhY2VMaXN0QikpIHsKICAgICAgICBjb25zdCByZXMgPSBbXTsKICAgICAgICBjb25zdCBxID0gY29udmV4Q29udmV4X3E7CiAgICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLCBxaSwgc2osIHhqLCBxaiwgc2VwQXhpcywgLTEwMCwgMTAwLCByZXMpOwogICAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICAgIHNlcEF4aXMubmVnYXRlKHIubmkpOwogICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAgICAgICBxLnNjYWxlKHJlc1tqXS5kZXB0aCwgcSk7CiAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAgICAgICByai5jb3B5KHJlc1tqXS5wb2ludCk7IC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKCiAgICAgICAgICByaS52c3ViKHhpLCByaSk7CiAgICAgICAgICByai52c3ViKHhqLCByaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZUNvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCB2M3Bvb2wgPSB0aGlzLnYzcG9vbDsKICAgICAgeGkudnN1Yih4aiwgY29udmV4X3RvX3NwaGVyZSk7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzai5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZmFjZXMgPSBzai5mYWNlczsKICAgICAgY29uc3QgdmVydHMgPSBzai52ZXJ0aWNlczsKICAgICAgY29uc3QgUiA9IHNpLnJhZGl1czsKICAgICAgLy8gICAgIHJldHVybjsKICAgICAgLy8gfQoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIENoZWNrIGNvcm5lcnMKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB2ZXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgogICAgICAgIGNvbnN0IHdvcmxkQ29ybmVyID0gc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyOwogICAgICAgIHFqLnZtdWx0KHYsIHdvcmxkQ29ybmVyKTsKICAgICAgICB4ai52YWRkKHdvcmxkQ29ybmVyLCB3b3JsZENvcm5lcik7CiAgICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lcjsKICAgICAgICB3b3JsZENvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gLy8gQ2hlY2sgc2lkZSAocGxhbmUpIGludGVyc2VjdGlvbnMKCgogICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtYWwgPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tpXTsgLy8gR2V0IHdvcmxkLXRyYW5zZm9ybWVkIG5vcm1hbCBvZiB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbDsKICAgICAgICBxai52bXVsdChub3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gR2V0IGEgd29ybGQgdmVydGV4IGZyb20gdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGRQb2ludCA9IHNwaGVyZUNvbnZleF93b3JsZFBvaW50OwogICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbMF1dLCB3b3JsZFBvaW50KTsKICAgICAgICB3b3JsZFBvaW50LnZhZGQoeGosIHdvcmxkUG9pbnQpOyAvLyBHZXQgYSBwb2ludCBvbiB0aGUgc3BoZXJlLCBjbG9zZXN0IHRvIHRoZSBmYWNlIG5vcm1hbAoKICAgICAgICBjb25zdCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lOwogICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOwogICAgICAgIHhpLnZhZGQod29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOyAvLyBWZWN0b3IgZnJvbSBhIGZhY2UgcG9pbnQgdG8gdGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNwaGVyZQoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYyA9IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYzsKICAgICAgICB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUudnN1Yih3b3JsZFBvaW50LCBwZW5ldHJhdGlvblZlYyk7IC8vIFRoZSBwZW5ldHJhdGlvbi4gTmVnYXRpdmUgdmFsdWUgbWVhbnMgb3ZlcmxhcC4KCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSBwZW5ldHJhdGlvblZlYy5kb3Qod29ybGROb3JtYWwpOwogICAgICAgIGNvbnN0IHdvcmxkUG9pbnRUb1NwaGVyZSA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQ7CiAgICAgICAgeGkudnN1Yih3b3JsZFBvaW50LCB3b3JsZFBvaW50VG9TcGhlcmUpOwoKICAgICAgICBpZiAocGVuZXRyYXRpb24gPCAwICYmIHdvcmxkUG9pbnRUb1NwaGVyZS5kb3Qod29ybGROb3JtYWwpID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIGlmIHRoZSBzcGhlcmUgaXMgaW5zaWRlIHRoZSBmYWNlIHBvbHlnb24KICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0cyA9IFtdOyAvLyBGYWNlIHZlcnRpY2VzLCBpbiB3b3JsZCBjb29yZHMKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTnZlcnRzID0gZmFjZS5sZW5ndGg7IGogIT09IE52ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlW2pdXSwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICB4ai52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIGZhY2VWZXJ0cy5wdXNoKHdvcmxkVmVydGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocG9pbnRJblBvbHlnb24oZmFjZVZlcnRzLCB3b3JsZE5vcm1hbCwgeGkpKSB7CiAgICAgICAgICAgIC8vIElzIHRoZSBzcGhlcmUgY2VudGVyIGluIHRoZSBmYWNlIHBvbHlnb24/CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgci5yaSk7IC8vIENvbnRhY3Qgb2Zmc2V0LCBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gY29udGFjdAoKICAgICAgICAgICAgd29ybGROb3JtYWwubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgcG9pbnRpbmcgb3V0IG9mIHNwaGVyZQoKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtcGVuZXRyYXRpb24sIHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCBwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsgLy94aS52c3ViKHhqKS52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpLnZhZGQocGVuZXRyYXRpb25WZWMyICwgci5yaik7CgogICAgICAgICAgICB4aS52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQsIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25WZWMyLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25TcGhlcmVQb2ludCk7CiAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47IC8vIFdlIG9ubHkgZXhwZWN0ICpvbmUqIGZhY2UgY29udGFjdAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gRWRnZT8KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGZhY2UubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAvLyBHZXQgdHdvIHdvcmxkIHRyYW5zZm9ybWVkIHZlcnRpY2VzCiAgICAgICAgICAgICAgY29uc3QgdjEgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDEpICUgZmFjZS5sZW5ndGhdXSwgdjEpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAyKSAlIGZhY2UubGVuZ3RoXV0sIHYyKTsKICAgICAgICAgICAgICB4ai52YWRkKHYxLCB2MSk7CiAgICAgICAgICAgICAgeGoudmFkZCh2MiwgdjIpOyAvLyBDb25zdHJ1Y3QgZWRnZSB2ZWN0b3IKCiAgICAgICAgICAgICAgY29uc3QgZWRnZSA9IHNwaGVyZUNvbnZleF9lZGdlOwogICAgICAgICAgICAgIHYyLnZzdWIodjEsIGVkZ2UpOyAvLyBDb25zdHJ1Y3QgdGhlIHNhbWUgdmVjdG9yLCBidXQgbm9ybWFsaXplZAoKICAgICAgICAgICAgICBjb25zdCBlZGdlVW5pdCA9IHNwaGVyZUNvbnZleF9lZGdlVW5pdDsKICAgICAgICAgICAgICBlZGdlLnVuaXQoZWRnZVVuaXQpOyAvLyBwIGlzIHhpIHByb2plY3RlZCBvbnRvIHRoZSBlZGdlCgogICAgICAgICAgICAgIGNvbnN0IHAgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjFfdG9feGkgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgeGkudnN1Yih2MSwgdjFfdG9feGkpOwogICAgICAgICAgICAgIGNvbnN0IGRvdCA9IHYxX3RvX3hpLmRvdChlZGdlVW5pdCk7CiAgICAgICAgICAgICAgZWRnZVVuaXQuc2NhbGUoZG90LCBwKTsKICAgICAgICAgICAgICBwLnZhZGQodjEsIHApOyAvLyBDb21wdXRlIGEgdmVjdG9yIGZyb20gcCB0byB0aGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKCiAgICAgICAgICAgICAgY29uc3QgeGlfdG9fcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBwLnZzdWIoeGksIHhpX3RvX3ApOyAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgLy8gQU5EIGlmIHAgaXMgaW4gYmV0d2VlbiB2MSBhbmQgdjIKCiAgICAgICAgICAgICAgaWYgKGRvdCA+IDAgJiYgZG90ICogZG90IDwgZWRnZS5sZW5ndGhTcXVhcmVkKCkgJiYgeGlfdG9fcC5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgICAgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgICAgLy8gRWRnZSBjb250YWN0IQogICAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgICAgcC52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aSwgci5uaSk7CiAgICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgci5uaS5zY2FsZShSLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHBsYW5lQ29udmV4KHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBwbGFuZVBvc2l0aW9uLCBjb252ZXhQb3NpdGlvbiwgcGxhbmVRdWF0LCBjb252ZXhRdWF0LCBwbGFuZUJvZHksIGNvbnZleEJvZHksIHNpLCBzaiwganVzdFRlc3QpIHsKICAgICAgLy8gU2ltcGx5IHJldHVybiB0aGUgcG9pbnRzIGJlaGluZCB0aGUgcGxhbmUuCiAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gcGxhbmVDb252ZXhfdjsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBwbGFuZUNvbnZleF9ub3JtYWw7CiAgICAgIHdvcmxkTm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgcGxhbmVRdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKICAgICAgY29uc3QgcmVscG9zID0gcGxhbmVDb252ZXhfcmVscG9zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGNvbnZleFNoYXBlLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGNvbnZleCB2ZXJ0ZXgKICAgICAgICB3b3JsZFZlcnRleC5jb3B5KGNvbnZleFNoYXBlLnZlcnRpY2VzW2ldKTsKICAgICAgICBjb252ZXhRdWF0LnZtdWx0KHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgY29udmV4UG9zaXRpb24udmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIHdvcmxkVmVydGV4LnZzdWIocGxhbmVQb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCBjb252ZXhCb2R5LCBwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgc2ksIHNqKTsgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZUNvbnZleF9wcm9qZWN0ZWQ7CiAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSh3b3JsZE5vcm1hbC5kb3QocmVscG9zKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOwogICAgICAgICAgcHJvamVjdGVkLnZzdWIocGxhbmVQb3NpdGlvbiwgci5yaSk7IC8vIEZyb20gcGxhbmUgdG8gdmVydGV4IHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIHIubmkuY29weSh3b3JsZE5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwgb3V0IGZyb20gcGxhbmUKICAgICAgICAgIC8vIHJqIGlzIG5vdyBqdXN0IHRoZSB2ZWN0b3IgZnJvbSB0aGUgY29udmV4IGNlbnRlciB0byB0aGUgdmVydGV4CgogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihjb252ZXhQb3NpdGlvbiwgci5yaik7IC8vIE1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIGJvZHkKCiAgICAgICAgICByLnJpLnZhZGQocGxhbmVQb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmoudmFkZChjb252ZXhQb3NpdGlvbiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoY29udmV4Qm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICB9CiAgICB9CgogICAgYm94Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZUhlaWdodGZpZWxkKHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBzcGhlcmVQb3MsIGhmUG9zLCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMjsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSBjYW4ndCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsU3BoZXJlUG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxTcGhlcmVQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHNCZWZvcmUgPSByZXN1bHQubGVuZ3RoOwogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzID0gcmVzdWx0Lmxlbmd0aCAtIG51bUNvbnRhY3RzQmVmb3JlOwoKICAgICAgICAgIGlmIChudW1Db250YWN0cyA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLyoKICAgICAgICAgICAgLy8gU2tpcCBhbGwgYnV0IDEKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBudW1Db250YWN0cyAtIDE7IGsrKykgewogICAgICAgICAgICAgICAgcmVzdWx0LnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAqLwoKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBib3hIZWlnaHRmaWVsZChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleEhlaWdodGZpZWxkKGNvbnZleFNoYXBlLCBoZlNoYXBlLCBjb252ZXhQb3MsIGhmUG9zLCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCByYWRpdXMgPSBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAyOwogICAgICBjb25zdCBmYWNlTGlzdCA9IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0OyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxDb252ZXhQb3MgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgY29udmV4UG9zLCBsb2NhbENvbnZleFBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlJ3JlIGNhbnQgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbENvbnZleFBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsQ29udmV4UG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gVGhlIG5vcm1hbCBpcyB0aGUgdW5pdCB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHBhcnRpY2xlIGNlbnRlcgogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVNwaGVyZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHhpLnZzdWIoeGosIG5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbmd0aFNxdWFyZWQgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKGxlbmd0aFNxdWFyZWQgPD0gc2oucmFkaXVzICogc2oucmFkaXVzKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICByLnJqLmNvcHkobm9ybWFsKTsKICAgICAgICByLnJqLnNjYWxlKHNqLnJhZGl1cywgci5yaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlUGxhbmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBiai5xdWF0ZXJuaW9uLnZtdWx0KG5vcm1hbCwgbm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBjb25zdCByZWxwb3MgPSBwYXJ0aWNsZVBsYW5lX3JlbHBvczsKICAgICAgeGkudnN1Yihiai5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgY29uc3QgZG90ID0gbm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQogICAgICAgIC8vIEdldCBwYXJ0aWNsZSBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQ7CiAgICAgICAgbm9ybWFsLnNjYWxlKG5vcm1hbC5kb3QoeGkpLCBwcm9qZWN0ZWQpOwogICAgICAgIHhpLnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvL3Byb2plY3RlZC52YWRkKGJqLnBvc2l0aW9uLHByb2plY3RlZCk7CiAgICAgICAgLy8gcmogaXMgbm93IHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgci5yai5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hQYXJ0aWNsZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleFBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGxldCBwZW5ldHJhdGVkRmFjZUluZGV4ID0gLTE7CiAgICAgIGNvbnN0IHBlbmV0cmF0ZWRGYWNlTm9ybWFsID0gY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWw7CiAgICAgIGNvbnN0IHdvcmxkUGVuZXRyYXRpb25WZWMgPSBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjOwogICAgICBsZXQgbWluUGVuZXRyYXRpb24gPSBudWxsOwoKICAgICAgY29uc3QgbG9jYWwgPSBjb252ZXhQYXJ0aWNsZV9sb2NhbDsKICAgICAgbG9jYWwuY29weSh4aSk7CiAgICAgIGxvY2FsLnZzdWIoeGosIGxvY2FsKTsgLy8gQ29udmVydCBwb3NpdGlvbiB0byByZWxhdGl2ZSB0aGUgY29udmV4IG9yaWdpbgoKICAgICAgcWouY29uanVnYXRlKGNxaik7CiAgICAgIGNxai52bXVsdChsb2NhbCwgbG9jYWwpOwoKICAgICAgaWYgKHNqLnBvaW50SXNJbnNpZGUobG9jYWwpKSB7CiAgICAgICAgaWYgKHNqLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSkgewogICAgICAgICAgc2ouY29tcHV0ZVdvcmxkVmVydGljZXMoeGosIHFqKTsKICAgICAgICB9CgogICAgICAgIGlmIChzai53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZEZhY2VOb3JtYWxzKHFqKTsKICAgICAgICB9IC8vIEZvciBlYWNoIHdvcmxkIHBvbHlnb24gaW4gdGhlIHBvbHloZWRyYQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IHNqLmZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzOyBpKyspIHsKICAgICAgICAgIC8vIENvbnN0cnVjdCB3b3JsZCBmYWNlIHZlcnRpY2VzCiAgICAgICAgICBjb25zdCB2ZXJ0cyA9IFtzai53b3JsZFZlcnRpY2VzW3NqLmZhY2VzW2ldWzBdXV07CiAgICAgICAgICBjb25zdCBub3JtYWwgPSBzai53b3JsZEZhY2VOb3JtYWxzW2ldOyAvLyBDaGVjayBob3cgbXVjaCB0aGUgcGFydGljbGUgcGVuZXRyYXRlcyB0aGUgcG9seWdvbiBwbGFuZS4KCiAgICAgICAgICB4aS52c3ViKHZlcnRzWzBdLCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlKTsKICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gLW5vcm1hbC5kb3QoY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CgogICAgICAgICAgaWYgKG1pblBlbmV0cmF0aW9uID09PSBudWxsIHx8IE1hdGguYWJzKHBlbmV0cmF0aW9uKSA8IE1hdGguYWJzKG1pblBlbmV0cmF0aW9uKSkgewogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWluUGVuZXRyYXRpb24gPSBwZW5ldHJhdGlvbjsKICAgICAgICAgICAgcGVuZXRyYXRlZEZhY2VJbmRleCA9IGk7CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLmNvcHkobm9ybWFsKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChwZW5ldHJhdGVkRmFjZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgLy8gU2V0dXAgY29udGFjdAogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5zY2FsZShtaW5QZW5ldHJhdGlvbiwgd29ybGRQZW5ldHJhdGlvblZlYyk7IC8vIHJqIGlzIHRoZSBwYXJ0aWNsZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGZhY2UKCiAgICAgICAgICB3b3JsZFBlbmV0cmF0aW9uVmVjLnZhZGQoeGksIHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52c3ViKHhqLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHIucmouY29weSh3b3JsZFBlbmV0cmF0aW9uVmVjKTsgLy9jb25zdCBwcm9qZWN0ZWRUb0ZhY2UgPSB4aS52c3ViKHhqKS52YWRkKHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgLy9wcm9qZWN0ZWRUb0ZhY2UuY29weShyLnJqKTsKICAgICAgICAgIC8vcWoudm11bHQoci5yaixyLnJqKTsKCiAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICAgIGNvbnN0IHJqID0gci5yajsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ1BvaW50IGZvdW5kIGluc2lkZSBjb252ZXgsIGJ1dCBkaWQgbm90IGZpbmQgcGVuZXRyYXRpbmcgZmFjZSEnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBoZWlnaHRmaWVsZEN5bGluZGVyKGhmU2hhcGUsIGNvbnZleFNoYXBlLCBoZlBvcywgY29udmV4UG9zLCBoZlF1YXQsIGNvbnZleFF1YXQsIGhmQm9keSwgY29udmV4Qm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkKGNvbnZleFNoYXBlLCBoZlNoYXBlLCBjb252ZXhQb3MsIGhmUG9zLCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBwYXJ0aWNsZUN5bGluZGVyKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVUcmltZXNoKHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHNwaGVyZVBvcywgdHJpbWVzaFBvcywgc3BoZXJlUXVhdCwgdHJpbWVzaFF1YXQsIHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZWRnZVZlcnRleEEgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhBOwogICAgICBjb25zdCBlZGdlVmVydGV4QiA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEI7CiAgICAgIGNvbnN0IGVkZ2VWZWN0b3IgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3I7CiAgICAgIGNvbnN0IGVkZ2VWZWN0b3JVbml0ID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdDsKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zOwogICAgICBjb25zdCB0bXAgPSBzcGhlcmVUcmltZXNoX3RtcDsKICAgICAgY29uc3QgbG9jYWxTcGhlcmVBQUJCID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkI7CiAgICAgIGNvbnN0IHYyID0gc3BoZXJlVHJpbWVzaF92MjsKICAgICAgY29uc3QgcmVscG9zID0gc3BoZXJlVHJpbWVzaF9yZWxwb3M7CiAgICAgIGNvbnN0IHRyaWFuZ2xlcyA9IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzOyAvLyBDb252ZXJ0IHNwaGVyZSBwb3NpdGlvbiB0byBsb2NhbCBpbiB0aGUgdHJpbWVzaAoKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBhYWJiIG9mIHRoZSBzcGhlcmUgbG9jYWxseSBpbiB0aGUgdHJpbWVzaAoKICAgICAgY29uc3Qgc3BoZXJlUmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBsb2NhbFNwaGVyZUFBQkIubG93ZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCAtIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSAtIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiAtIHNwaGVyZVJhZGl1cyk7CiAgICAgIGxvY2FsU3BoZXJlQUFCQi51cHBlckJvdW5kLnNldChsb2NhbFNwaGVyZVBvcy54ICsgc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy55ICsgc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy56ICsgc3BoZXJlUmFkaXVzKTsKICAgICAgdHJpbWVzaFNoYXBlLmdldFRyaWFuZ2xlc0luQUFCQihsb2NhbFNwaGVyZUFBQkIsIHRyaWFuZ2xlcyk7IC8vZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUuaW5kaWNlcy5sZW5ndGggLyAzOyBpKyspIHRyaWFuZ2xlcy5wdXNoKGkpOyAvLyBBbGwKICAgICAgLy8gVmVydGljZXMKCiAgICAgIGNvbnN0IHYgPSBzcGhlcmVUcmltZXNoX3Y7CiAgICAgIGNvbnN0IHJhZGl1c1NxdWFyZWQgPSBzcGhlcmVTaGFwZS5yYWRpdXMgKiBzcGhlcmVTaGFwZS5yYWRpdXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyBqXSwgdik7IC8vIENoZWNrIHZlcnRleCBvdmVybGFwIGluIHNwaGVyZQoKICAgICAgICAgIHYudnN1Yihsb2NhbFNwaGVyZVBvcywgcmVscG9zKTsKCiAgICAgICAgICBpZiAocmVscG9zLmxlbmd0aFNxdWFyZWQoKSA8PSByYWRpdXNTcXVhcmVkKSB7CiAgICAgICAgICAgIC8vIFNhZmUgdXAKICAgICAgICAgICAgdjIuY29weSh2KTsKICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB2Miwgdik7CiAgICAgICAgICAgIHYudnN1YihzcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICByLm5pLmNvcHkocmVscG9zKTsKICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gcmkgaXMgdGhlIHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gdGhlIHNwaGVyZSBzdXJmYWNlCgogICAgICAgICAgICByLnJpLmNvcHkoci5uaSk7CiAgICAgICAgICAgIHIucmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgICByLnJqLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOyAvLyBTdG9yZSByZXN1bHQKCiAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2hlY2sgYWxsIGVkZ2VzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIGVkZ2VWZXJ0ZXhBKTsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIChqICsgMSkgJSAzXSwgZWRnZVZlcnRleEIpOwogICAgICAgICAgZWRnZVZlcnRleEIudnN1YihlZGdlVmVydGV4QSwgZWRnZVZlY3Rvcik7IC8vIFByb2plY3Qgc3BoZXJlIHBvc2l0aW9uIHRvIHRoZSBlZGdlCgogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QiwgdG1wKTsKICAgICAgICAgIGNvbnN0IHBvc2l0aW9uQWxvbmdFZGdlQiA9IHRtcC5kb3QoZWRnZVZlY3Rvcik7CiAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhBLCB0bXApOwogICAgICAgICAgbGV0IHBvc2l0aW9uQWxvbmdFZGdlQSA9IHRtcC5kb3QoZWRnZVZlY3Rvcik7CgogICAgICAgICAgaWYgKHBvc2l0aW9uQWxvbmdFZGdlQSA+IDAgJiYgcG9zaXRpb25BbG9uZ0VkZ2VCIDwgMCkgewogICAgICAgICAgICAvLyBOb3cgY2hlY2sgdGhlIG9ydGhvZ29uYWwgZGlzdGFuY2UgZnJvbSBlZGdlIHRvIHNwaGVyZSBjZW50ZXIKICAgICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuY29weShlZGdlVmVjdG9yKTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHBvc2l0aW9uQWxvbmdFZGdlQSA9IHRtcC5kb3QoZWRnZVZlY3RvclVuaXQpOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5zY2FsZShwb3NpdGlvbkFsb25nRWRnZUEsIHRtcCk7CiAgICAgICAgICAgIHRtcC52YWRkKGVkZ2VWZXJ0ZXhBLCB0bXApOyAvLyB0bXAgaXMgbm93IHRoZSBzcGhlcmUgY2VudGVyIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgZWRnZSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSB0cmltZXNoIGZyYW1lCgogICAgICAgICAgICBjb25zdCBkaXN0ID0gdG1wLmRpc3RhbmNlVG8obG9jYWxTcGhlcmVQb3MpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPCBzcGhlcmVTaGFwZS5yYWRpdXMpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHRtcCwgdG1wKTsKICAgICAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5uaSwgci5uaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5yaSwgci5yaSk7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gVHJpYW5nbGUgZmFjZXMKCgogICAgICBjb25zdCB2YSA9IHNwaGVyZVRyaW1lc2hfdmE7CiAgICAgIGNvbnN0IHZiID0gc3BoZXJlVHJpbWVzaF92YjsKICAgICAgY29uc3QgdmMgPSBzcGhlcmVUcmltZXNoX3ZjOwogICAgICBjb25zdCBub3JtYWwgPSBzcGhlcmVUcmltZXNoX25vcm1hbDsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldFRyaWFuZ2xlVmVydGljZXModHJpYW5nbGVzW2ldLCB2YSwgdmIsIHZjKTsKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0Tm9ybWFsKHRyaWFuZ2xlc1tpXSwgbm9ybWFsKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHZhLCB0bXApOwogICAgICAgIGxldCBkaXN0ID0gdG1wLmRvdChub3JtYWwpOwogICAgICAgIG5vcm1hbC5zY2FsZShkaXN0LCB0bXApOwogICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIodG1wLCB0bXApOyAvLyB0bXAgaXMgbm93IHRoZSBzcGhlcmUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSB0cmlhbmdsZSBwbGFuZQoKICAgICAgICBkaXN0ID0gdG1wLmRpc3RhbmNlVG8obG9jYWxTcGhlcmVQb3MpOwoKICAgICAgICBpZiAoUmF5LnBvaW50SW5UcmlhbmdsZSh0bXAsIHZhLCB2YiwgdmMpICYmIGRpc3QgPCBzcGhlcmVTaGFwZS5yYWRpdXMpIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICB0bXAudnN1Yihsb2NhbFNwaGVyZVBvcywgci5uaSk7CiAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHRtcCwgdG1wKTsKICAgICAgICAgIHRtcC52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5yaSwgci5yaSk7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CgogICAgcGxhbmVUcmltZXNoKHBsYW5lU2hhcGUsIHRyaW1lc2hTaGFwZSwgcGxhbmVQb3MsIHRyaW1lc2hQb3MsIHBsYW5lUXVhdCwgdHJpbWVzaFF1YXQsIHBsYW5lQm9keSwgdHJpbWVzaEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBNYWtlIGNvbnRhY3RzIQogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgbm9ybWFsID0gcGxhbmVUcmltZXNoX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgcGxhbmVRdWF0LnZtdWx0KG5vcm1hbCwgbm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaW1lc2hTaGFwZS52ZXJ0aWNlcy5sZW5ndGggLyAzOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgdmVydGV4IGZyb20gdHJpbWVzaAogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgoaSwgdik7IC8vIFNhZmUgdXAKCiAgICAgICAgY29uc3QgdjIgPSBuZXcgVmVjMygpOwogICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB2Miwgdik7IC8vIENoZWNrIHBsYW5lIHNpZGUKCiAgICAgICAgY29uc3QgcmVscG9zID0gcGxhbmVUcmltZXNoX3JlbHBvczsKICAgICAgICB2LnZzdWIocGxhbmVQb3MsIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gbm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCBwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCiAgICAgICAgICAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lVHJpbWVzaF9wcm9qZWN0ZWQ7CiAgICAgICAgICBub3JtYWwuc2NhbGUocmVscG9zLmRvdChub3JtYWwpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgdi52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy8gcmkgaXMgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICAgIHIucmkuY29weShwcm9qZWN0ZWQpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLmNvcHkodik7CiAgICAgICAgICByLnJqLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOyAvLyBTdG9yZSByZXN1bHQKCiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBjb252ZXhUcmltZXNoKAogICAgLy8gICBzaTogQ29udmV4UG9seWhlZHJvbiwgc2o6IFRyaW1lc2gsIHhpOiBWZWMzLCB4ajogVmVjMywgcWk6IFF1YXRlcm5pb24sIHFqOiBRdWF0ZXJuaW9uLAogICAgLy8gICBiaTogQm9keSwgYmo6IEJvZHksIHJzaT86IFNoYXBlIHwgbnVsbCwgcnNqPzogU2hhcGUgfCBudWxsLAogICAgLy8gICBmYWNlTGlzdEE/OiBudW1iZXJbXSB8IG51bGwsIGZhY2VMaXN0Qj86IG51bWJlcltdIHwgbnVsbCwKICAgIC8vICkgewogICAgLy8gICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CiAgICAvLyAgIGlmKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cyl7CiAgICAvLyAgICAgICByZXR1cm47CiAgICAvLyAgIH0KICAgIC8vICAgLy8gQ29uc3RydWN0IGEgdGVtcCBodWxsIGZvciBlYWNoIHRyaWFuZ2xlCiAgICAvLyAgIGNvbnN0IGh1bGxCID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgIC8vICAgaHVsbEIuZmFjZXMgPSBbWzAsMSwyXV07CiAgICAvLyAgIGNvbnN0IHZhID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogICAgLy8gICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGh1bGxCLnZlcnRpY2VzID0gWwogICAgLy8gICAgICAgdmEsCiAgICAvLyAgICAgICB2YiwKICAgIC8vICAgICAgIHZjCiAgICAvLyAgIF07CiAgICAvLyAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2ouaW5kaWNlcy5sZW5ndGggLyAzOyBpKyspIHsKICAgIC8vICAgICAgIGNvbnN0IHRyaWFuZ2xlTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgIC8vICAgICAgIHNqLmdldE5vcm1hbChpLCB0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICBodWxsQi5mYWNlTm9ybWFscyA9IFt0cmlhbmdsZU5vcm1hbF07CiAgICAvLyAgICAgICBzai5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIHZhLCB2YiwgdmMpOwogICAgLy8gICAgICAgbGV0IGQgPSBzaS50ZXN0U2VwQXhpcyh0cmlhbmdsZU5vcm1hbCwgaHVsbEIsIHhpLCBxaSwgeGosIHFqKTsKICAgIC8vICAgICAgIGlmKCFkKXsKICAgIC8vICAgICAgICAgICB0cmlhbmdsZU5vcm1hbC5zY2FsZSgtMSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgICAgIGQgPSBzaS50ZXN0U2VwQXhpcyh0cmlhbmdsZU5vcm1hbCwgaHVsbEIsIHhpLCBxaSwgeGosIHFqKTsKICAgIC8vICAgICAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgLy8gICAgICAgICAgIH0KICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGNvbnN0IHJlczogQ29udmV4UG9seWhlZHJvbkNvbnRhY3RQb2ludFtdID0gW107CiAgICAvLyAgICAgICBjb25zdCBxID0gY29udmV4Q29udmV4X3E7CiAgICAvLyAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGkscWksaHVsbEIseGoscWosdHJpYW5nbGVOb3JtYWwsLTEwMCwxMDAscmVzKTsKICAgIC8vICAgICAgIGZvcihsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKyl7CiAgICAvLyAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLGJqLHNpLHNqLHJzaSxyc2opLAogICAgLy8gICAgICAgICAgICAgICByaSA9IHIucmksCiAgICAvLyAgICAgICAgICAgICAgIHJqID0gci5yajsKICAgIC8vICAgICAgICAgICByLm5pLmNvcHkodHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgLy8gICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgLy8gICAgICAgICAgIHEubXVsdChyZXNbal0uZGVwdGgsIHEpOwogICAgLy8gICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgIC8vICAgICAgICAgICByai5jb3B5KHJlc1tqXS5wb2ludCk7CiAgICAvLyAgICAgICAgICAgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQogICAgLy8gICAgICAgICAgIHJpLnZzdWIoeGkscmkpOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoeGoscmopOwogICAgLy8gICAgICAgICAgIC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCiAgICAvLyAgICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgLy8gICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgIC8vICAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAvLyAgICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgLy8gICAgICAgICAgIHJlc3VsdC5wdXNoKHIpOwogICAgLy8gICAgICAgfQogICAgLy8gICB9CiAgICAvLyB9CgoKICB9CiAgY29uc3QgYXZlcmFnZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRCID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0MSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgdG1wUXVhdDIgPSBuZXcgUXVhdGVybmlvbigpOwoKICBjb25zdCBwbGFuZVRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZVRyaW1lc2hfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhBID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZhID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZiID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lX3RvX3NwaGVyZV9vcnRobyA9IG5ldyBWZWMzKCk7IC8vIFNlZSBodHRwOi8vYnVsbGV0cGh5c2ljcy5jb20vQnVsbGV0L0J1bGxldEZ1bGwvU3BoZXJlVHJpYW5nbGVEZXRlY3Rvcl84Y3BwX3NvdXJjZS5odG1sCgogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX3Z0cCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHZlcnRzLCBub3JtYWwsIHApIHsKICAgIGxldCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICBjb25zdCBOID0gdmVydHMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBHZXQgZWRnZSB0byB0aGUgbmV4dCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IGVkZ2UgPSBwb2ludEluUG9seWdvbl9lZGdlOwogICAgICB2ZXJ0c1soaSArIDEpICUgTl0udnN1Yih2LCBlZGdlKTsgLy8gR2V0IGNyb3NzIHByb2R1Y3QgYmV0d2VlbiBwb2x5Z29uIG5vcm1hbCBhbmQgdGhlIGVkZ2UKCiAgICAgIGNvbnN0IGVkZ2VfeF9ub3JtYWwgPSBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsOyAvL2NvbnN0IGVkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwoKICAgICAgZWRnZS5jcm9zcyhub3JtYWwsIGVkZ2VfeF9ub3JtYWwpOyAvLyBHZXQgdmVjdG9yIGJldHdlZW4gcG9pbnQgYW5kIGN1cnJlbnQgdmVydGV4CgogICAgICBjb25zdCB2ZXJ0ZXhfdG9fcCA9IHBvaW50SW5Qb2x5Z29uX3Z0cDsKICAgICAgcC52c3ViKHYsIHZlcnRleF90b19wKTsgLy8gVGhpcyBkb3QgcHJvZHVjdCBkZXRlcm1pbmVzIHdoaWNoIHNpZGUgb2YgdGhlIGVkZ2UgdGhlIHBvaW50IGlzCgogICAgICBjb25zdCByID0gZWRnZV94X25vcm1hbC5kb3QodmVydGV4X3RvX3ApOyAvLyBJZiBhbGwgc3VjaCBkb3QgcHJvZHVjdHMgaGF2ZSBzYW1lIHNpZ24sIHdlIGFyZSBpbnNpZGUgdGhlIHBvbHlnb24uCgogICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwgfHwgciA+IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IHRydWUgfHwgciA8PSAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCkgewogICAgICAgICAgcG9zaXRpdmVSZXN1bHQgPSByID4gMDsKICAgICAgICB9CgogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICB9CiAgICB9IC8vIElmIHdlIGdvdCBoZXJlLCBhbGwgZG90IHByb2R1Y3RzIHdlcmUgb2YgdGhlIHNhbWUgc2lnbi4KCgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBjb25zdCBib3hfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlcyA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKICBjb25zdCBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2VVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZENvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4Q29udmV4X3NlcEF4aXMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9xID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOyAvLyBXSVAKCiAgY29uc3QgY3FqID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV9sb2NhbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3QgPSBbMF07CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CgogIGNsYXNzIE92ZXJsYXBLZWVwZXIgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5jdXJyZW50ID0gW107CiAgICAgIHRoaXMucHJldmlvdXMgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogZ2V0S2V5CiAgICAgKi8KCgogICAgZ2V0S2V5KGksIGopIHsKICAgICAgaWYgKGogPCBpKSB7CiAgICAgICAgY29uc3QgdGVtcCA9IGo7CiAgICAgICAgaiA9IGk7CiAgICAgICAgaSA9IHRlbXA7CiAgICAgIH0KCiAgICAgIHJldHVybiBpIDw8IDE2IHwgajsKICAgIH0KICAgIC8qKgogICAgICogc2V0CiAgICAgKi8KCgogICAgc2V0KGksIGopIHsKICAgICAgLy8gSW5zZXJ0aW9uIHNvcnQuIFRoaXMgd2F5IHRoZSBkaWZmIHdpbGwgaGF2ZSBsaW5lYXIgY29tcGxleGl0eS4KICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkoaSwgaik7CiAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIGxldCBpbmRleCA9IDA7CgogICAgICB3aGlsZSAoa2V5ID4gY3VycmVudFtpbmRleF0pIHsKICAgICAgICBpbmRleCsrOwogICAgICB9CgogICAgICBpZiAoa2V5ID09PSBjdXJyZW50W2luZGV4XSkgewogICAgICAgIHJldHVybjsgLy8gUGFpciB3YXMgYWxyZWFkeSBhZGRlZAogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gY3VycmVudC5sZW5ndGggLSAxOyBqID49IGluZGV4OyBqLS0pIHsKICAgICAgICBjdXJyZW50W2ogKyAxXSA9IGN1cnJlbnRbal07CiAgICAgIH0KCiAgICAgIGN1cnJlbnRbaW5kZXhdID0ga2V5OwogICAgfQogICAgLyoqCiAgICAgKiB0aWNrCiAgICAgKi8KCgogICAgdGljaygpIHsKICAgICAgY29uc3QgdG1wID0gdGhpcy5jdXJyZW50OwogICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnByZXZpb3VzOwogICAgICB0aGlzLnByZXZpb3VzID0gdG1wOwogICAgICB0aGlzLmN1cnJlbnQubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogZ2V0RGlmZgogICAgICovCgoKICAgIGdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscykgewogICAgICBjb25zdCBhID0gdGhpcy5jdXJyZW50OwogICAgICBjb25zdCBiID0gdGhpcy5wcmV2aW91czsKICAgICAgY29uc3QgYWwgPSBhLmxlbmd0aDsKICAgICAgY29uc3QgYmwgPSBiLmxlbmd0aDsKICAgICAgbGV0IGogPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbDsgaSsrKSB7CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgY29uc3Qga2V5QSA9IGFbaV07CgogICAgICAgIHdoaWxlIChrZXlBID4gYltqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgPSBrZXlBID09PSBiW2pdOwoKICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB1bnBhY2tBbmRQdXNoKGFkZGl0aW9ucywga2V5QSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUIgPSBiW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QiA+IGFbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0gYVtqXSA9PT0ga2V5QjsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChyZW1vdmFscywga2V5Qik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KCiAgZnVuY3Rpb24gdW5wYWNrQW5kUHVzaChhcnJheSwga2V5KSB7CiAgICBhcnJheS5wdXNoKChrZXkgJiAweGZmZmYwMDAwKSA+PiAxNiwga2V5ICYgMHgwMDAwZmZmZik7CiAgfQoKICBjb25zdCBnZXRLZXkgPSAoaSwgaikgPT4gaSA8IGogPyBgJHtpfS0ke2p9YCA6IGAke2p9LSR7aX1gOwogIC8qKgogICAqIFR1cGxlRGljdGlvbmFyeQogICAqLwoKCiAgY2xhc3MgVHVwbGVEaWN0aW9uYXJ5IHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmRhdGEgPSB7CiAgICAgICAga2V5czogW10KICAgICAgfTsKICAgIH0KCiAgICAvKiogZ2V0ICovCiAgICBnZXQoaSwgaikgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7CiAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KICAgIC8qKiBzZXQgKi8KCgogICAgc2V0KGksIGosIHZhbHVlKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsgLy8gQ2hlY2sgaWYga2V5IGFscmVhZHkgZXhpc3RzCgogICAgICBpZiAoIXRoaXMuZ2V0KGksIGopKSB7CiAgICAgICAgdGhpcy5kYXRhLmtleXMucHVzaChrZXkpOwogICAgICB9CgogICAgICB0aGlzLmRhdGFba2V5XSA9IHZhbHVlOwogICAgfQogICAgLyoqIGRlbGV0ZSAqLwoKCiAgICBkZWxldGUoaSwgaikgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7CiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kYXRhLmtleXMuaW5kZXhPZihrZXkpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KCiAgICAgIGRlbGV0ZSB0aGlzLmRhdGFba2V5XTsKICAgIH0KICAgIC8qKiByZXNldCAqLwoKCiAgICByZXNldCgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3Qga2V5cyA9IGRhdGEua2V5czsKCiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBrZXkgPSBrZXlzLnBvcCgpOwogICAgICAgIGRlbGV0ZSBkYXRhW2tleV07CiAgICAgIH0KICAgIH0KCiAgfQoKICAvKioKICAgKiBUaGUgcGh5c2ljcyB3b3JsZAogICAqLwogIGNsYXNzIFdvcmxkIGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBDdXJyZW50bHkgLyBsYXN0IHVzZWQgdGltZXN0ZXAuIElzIHNldCB0byAtMSBpZiBub3QgYXZhaWxhYmxlLiBUaGlzIHZhbHVlIGlzIHVwZGF0ZWQgYmVmb3JlIGVhY2ggaW50ZXJuYWwgc3RlcCwgd2hpY2ggbWVhbnMgdGhhdCBpdCBpcyAiZnJlc2giIGluc2lkZSBldmVudCBjYWxsYmFja3MuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1ha2VzIGJvZGllcyBnbyB0byBzbGVlcCB3aGVuIHRoZXkndmUgYmVlbiBpbmFjdGl2ZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgY3VycmVudCBjb250YWN0cyAoaW5zdGFuY2VzIG9mIENvbnRhY3RFcXVhdGlvbikgaW4gdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBIb3cgb2Z0ZW4gdG8gbm9ybWFsaXplIHF1YXRlcm5pb25zLiBTZXQgdG8gMCBmb3IgZXZlcnkgc3RlcCwgMSBmb3IgZXZlcnkgc2Vjb25kIGV0Yy4uIEEgbGFyZ2VyIHZhbHVlIGluY3JlYXNlcyBwZXJmb3JtYW5jZS4gSWYgYm9kaWVzIHRlbmQgdG8gZXhwbG9kZSwgc2V0IHRvIGEgc21hbGxlciB2YWx1ZSAoemVybyB0byBiZSBzdXJlIG5vdGhpbmcgY2FuIGdvIHdyb25nKS4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgdG8gdXNlIGZhc3QgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBJdCBpcyBvZnRlbiBlbm91Z2ggYWNjdXJhdGUgdG8gdXNlLgogICAgICogSWYgYm9kaWVzIHRlbmQgdG8gZXhwbG9kZSwgc2V0IHRvIGZhbHNlLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdhbGwtY2xvY2sgdGltZSBzaW5jZSBzaW11bGF0aW9uIHN0YXJ0LgogICAgICovCgogICAgLyoqCiAgICAgKiBOdW1iZXIgb2YgdGltZXN0ZXBzIHRha2VuIHNpbmNlIHN0YXJ0LgogICAgICovCgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGFuZCBsYXN0IHRpbWVzdGVwIHNpemVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZ3Jhdml0eSBvZiB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBicm9hZHBoYXNlIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBOYWl2ZUJyb2FkcGhhc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGJvZGllcyBpbiB0aGlzIHdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRydWUgaWYgYW55IGJvZGllcyBhcmUgbm90IHNsZWVwaW5nLCBmYWxzZSBpZiBldmVyeSBib2R5IGlzIHNsZWVwaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgc29sdmVyIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBHU1NvbHZlcgogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25NYXRyaXgKICAgICAqLwoKICAgIC8qKgogICAgICogQ29sbGlzaW9uTWF0cml4IGZyb20gdGhlIHByZXZpb3VzIHN0ZXAuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBhZGRlZCBjb250YWN0bWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIHRvIGxvb2sgdXAgYSBDb250YWN0TWF0ZXJpYWwgZ2l2ZW4gdHdvIGluc3RhbmNlcyBvZiBNYXRlcmlhbC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWF0ZXJpYWwgb2YgdGhlIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhpcyBjb250YWN0IG1hdGVyaWFsIGlzIHVzZWQgaWYgbm8gc3VpdGFibGUgY29udGFjdG1hdGVyaWFsIGlzIGZvdW5kIGZvciBhIGNvbnRhY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRpbWUgYWNjdW11bGF0b3IgZm9yIGludGVycG9sYXRpb24uCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vZ2FtZS1waHlzaWNzL2ZpeC15b3VyLXRpbWVzdGVwLwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kdCA9IC0xOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSAhIW9wdGlvbnMuYWxsb3dTbGVlcDsKICAgICAgdGhpcy5jb250YWN0cyA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gW107CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgPSBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwIDogMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgOiBmYWxzZTsKICAgICAgdGhpcy50aW1lID0gMC4wOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSAwOwogICAgICB0aGlzLmRlZmF1bHRfZHQgPSAxIC8gNjA7CiAgICAgIHRoaXMubmV4dElkID0gMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmdyYXZpdHkpIHsKICAgICAgICB0aGlzLmdyYXZpdHkuY29weShvcHRpb25zLmdyYXZpdHkpOwogICAgICB9CgogICAgICB0aGlzLmJyb2FkcGhhc2UgPSBvcHRpb25zLmJyb2FkcGhhc2UgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYnJvYWRwaGFzZSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKICAgICAgdGhpcy5ib2RpZXMgPSBbXTsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKICAgICAgdGhpcy5zb2x2ZXIgPSBvcHRpb25zLnNvbHZlciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5zb2x2ZXIgOiBuZXcgR1NTb2x2ZXIoKTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gbmV3IE5hcnJvd3BoYXNlKHRoaXMpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gbmV3IEFycmF5Q29sbGlzaW9uTWF0cml4KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlciA9IG5ldyBPdmVybGFwS2VlcGVyKCk7CiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlID0gbmV3IFR1cGxlRGljdGlvbmFyeSgpOwogICAgICB0aGlzLmRlZmF1bHRNYXRlcmlhbCA9IG5ldyBNYXRlcmlhbCgnZGVmYXVsdCcpOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSBuZXcgQ29udGFjdE1hdGVyaWFsKHRoaXMuZGVmYXVsdE1hdGVyaWFsLCB0aGlzLmRlZmF1bHRNYXRlcmlhbCwgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMAogICAgICB9KTsKICAgICAgdGhpcy5kb1Byb2ZpbGluZyA9IGZhbHNlOwogICAgICB0aGlzLnByb2ZpbGUgPSB7CiAgICAgICAgc29sdmU6IDAsCiAgICAgICAgbWFrZUNvbnRhY3RDb25zdHJhaW50czogMCwKICAgICAgICBicm9hZHBoYXNlOiAwLAogICAgICAgIGludGVncmF0ZTogMCwKICAgICAgICBuYXJyb3dwaGFzZTogMAogICAgICB9OwogICAgICB0aGlzLmFjY3VtdWxhdG9yID0gMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gW107CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdhZGRCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdyZW1vdmVCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB7fTsKICAgICAgdGhpcy5icm9hZHBoYXNlLnNldFdvcmxkKHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbnRhY3QgbWF0ZXJpYWwgYmV0d2VlbiBtYXRlcmlhbHMgbTEgYW5kIG0yCiAgICAgKiBAcmV0dXJuIFRoZSBjb250YWN0IG1hdGVyaWFsIGlmIGl0IHdhcyBmb3VuZC4KICAgICAqLwoKCiAgICBnZXRDb250YWN0TWF0ZXJpYWwobTEsIG0yKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmdldChtMS5pZCwgbTIuaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdG9yZSBvbGQgY29sbGlzaW9uIHN0YXRlIGluZm8KICAgICAqLwoKCiAgICBjb2xsaXNpb25NYXRyaXhUaWNrKCkgewogICAgICBjb25zdCB0ZW1wID0gdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91czsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHRoaXMuY29sbGlzaW9uTWF0cml4OwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHRlbXA7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnJlc2V0KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci50aWNrKCk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIGNvbnN0cmFpbnQgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgYWRkQ29uc3RyYWludChjKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHMucHVzaChjKTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnN0cmFpbnQKICAgICAqLwoKCiAgICByZW1vdmVDb25zdHJhaW50KGMpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb25zdHJhaW50cy5pbmRleE9mKGMpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmNvbnN0cmFpbnRzLnNwbGljZShpZHgsIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheWNhc3QgdGVzdAogICAgICogQGRlcHJlY2F0ZWQgVXNlIC5yYXljYXN0QWxsLCAucmF5Y2FzdENsb3Nlc3Qgb3IgLnJheWNhc3RBbnkgaW5zdGVhZC4KICAgICAqLwoKCiAgICByYXlUZXN0KGZyb20sIHRvLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFJheWNhc3RSZXN1bHQpIHsKICAgICAgICAvLyBEbyByYXljYXN0Q2xvc2VzdAogICAgICAgIHRoaXMucmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIERvIHJheWNhc3RBbGwKICAgICAgICB0aGlzLnJheWNhc3RBbGwoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0IGFnYWluc3QgYWxsIGJvZGllcy4gVGhlIHByb3ZpZGVkIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggaGl0IHdpdGggYSBSYXljYXN0UmVzdWx0IGFzIHNpbmdsZSBhcmd1bWVudC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbGwoZnJvbSwgdG8sIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5BTEw7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHN0b3AgYXQgdGhlIGZpcnN0IHJlc3VsdC4gTm90ZSB0aGF0IHRoZSBvcmRlciBpcyByYW5kb20gLSBidXQgdGhlIG1ldGhvZCBpcyBmYXN0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdEFueShmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5BTlk7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0LCBhbmQgcmV0dXJuIGluZm9ybWF0aW9uIG9mIHRoZSBjbG9zZXN0IGhpdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCBvcHRpb25zLCByZXN1bHQpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkNMT1NFU1Q7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHJpZ2lkIGJvZHkgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKiBAdG9kbyBJZiB0aGUgc2ltdWxhdGlvbiBoYXMgbm90IHlldCBzdGFydGVkLCB3aHkgcmVjcmV0ZSBhbmQgY29weSBhcnJheXMgZm9yIGVhY2ggYm9keT8gQWNjdW11bGF0ZSBpbiBkeW5hbWljIGFycmF5cyBpbiB0aGlzIGNhc2UuCiAgICAgKiBAdG9kbyBBZGRpbmcgYW4gYXJyYXkgb2YgYm9kaWVzIHNob3VsZCBiZSBwb3NzaWJsZS4gVGhpcyB3b3VsZCBzYXZlIHNvbWUgbG9vcHMgdG9vCiAgICAgKi8KCgogICAgYWRkQm9keShib2R5KSB7CiAgICAgIGlmICh0aGlzLmJvZGllcy5pbmNsdWRlcyhib2R5KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgYm9keS5pbmRleCA9IHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgICAgdGhpcy5ib2RpZXMucHVzaChib2R5KTsKICAgICAgYm9keS53b3JsZCA9IHRoaXM7CiAgICAgIGJvZHkuaW5pdFBvc2l0aW9uLmNvcHkoYm9keS5wb3NpdGlvbik7CiAgICAgIGJvZHkuaW5pdFZlbG9jaXR5LmNvcHkoYm9keS52ZWxvY2l0eSk7CiAgICAgIGJvZHkudGltZUxhc3RTbGVlcHkgPSB0aGlzLnRpbWU7CgogICAgICBpZiAoYm9keSBpbnN0YW5jZW9mIEJvZHkpIHsKICAgICAgICBib2R5LmluaXRBbmd1bGFyVmVsb2NpdHkuY29weShib2R5LmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgICAgYm9keS5pbml0UXVhdGVybmlvbi5jb3B5KGJvZHkucXVhdGVybmlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldE51bU9iamVjdHModGhpcy5ib2RpZXMubGVuZ3RoKTsKICAgICAgdGhpcy5hZGRCb2R5RXZlbnQuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXBbYm9keS5pZF0gPSBib2R5OwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5hZGRCb2R5RXZlbnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSByaWdpZCBib2R5IGZyb20gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgcmVtb3ZlQm9keShib2R5KSB7CiAgICAgIGJvZHkud29ybGQgPSBudWxsOwogICAgICBjb25zdCBuID0gdGhpcy5ib2RpZXMubGVuZ3RoIC0gMTsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IGlkeCA9IGJvZGllcy5pbmRleE9mKGJvZHkpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICBib2RpZXMuc3BsaWNlKGlkeCwgMSk7IC8vIFRvZG86IHNob3VsZCB1c2UgYSBnYXJiYWdlIGZyZWUgbWV0aG9kCiAgICAgICAgLy8gUmVjb21wdXRlIGluZGV4CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS5pbmRleCA9IGk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKG4pOwogICAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICAgIGRlbGV0ZSB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdOwogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLnJlbW92ZUJvZHlFdmVudCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRCb2R5QnlJZChpZCkgewogICAgICByZXR1cm4gdGhpcy5pZFRvQm9keU1hcFtpZF07CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE1ha2UgYSBmYXN0ZXIgbWFwCiAgICAgKi8KCgogICAgZ2V0U2hhcGVCeUlkKGlkKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZXMgPSBib2RpZXNbaV0uc2hhcGVzOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbal07CgogICAgICAgICAgaWYgKHNoYXBlLmlkID09PSBpZCkgewogICAgICAgICAgICByZXR1cm4gc2hhcGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQWRkcyBhIGNvbnRhY3QgbWF0ZXJpYWwgdG8gdGhlIFdvcmxkCiAgICAgKi8KCgogICAgYWRkQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgLy8gQWRkIGNvbnRhY3QgbWF0ZXJpYWwKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnB1c2goY21hdCk7IC8vIEFkZCBjdXJyZW50IGNvbnRhY3QgbWF0ZXJpYWwgdG8gdGhlIG1hdGVyaWFsIHRhYmxlCgogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLnNldChjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQsIGNtYXQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGEgY29udGFjdCBtYXRlcmlhbCBmcm9tIHRoZSBXb3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICBjb25zdCBpZHggPSB0aGlzLmNvbnRhY3RtYXRlcmlhbHMuaW5kZXhPZihjbWF0KTsKCiAgICAgIGlmIChpZHggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuZGVsZXRlKGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHNpbXVsYXRpb24gZm9yd2FyZCBrZWVwaW5nIHRyYWNrIG9mIGxhc3QgY2FsbGVkIHRpbWUKICAgICAqIHRvIGJlIGFibGUgdG8gc3RlcCB0aGUgd29ybGQgYXQgYSBmaXhlZCByYXRlLCBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZHQgVGhlIGZpeGVkIHRpbWUgc3RlcCBzaXplIHRvIHVzZSAoZGVmYXVsdDogMSAvIDYwKS4KICAgICAqIEBwYXJhbSBtYXhTdWJTdGVwcyBNYXhpbXVtIG51bWJlciBvZiBmaXhlZCBzdGVwcyB0byB0YWtlIHBlciBmdW5jdGlvbiBjYWxsIChkZWZhdWx0OiAxMCkuCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vcG9zdC9maXhfeW91cl90aW1lc3RlcC8KICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gUnVuIHRoZSBzaW11bGF0aW9uIGluZGVwZW5kZW50bHkgb2YgZnJhbWVyYXRlIGV2ZXJ5IDEgLyA2MCBtcwogICAgICogICAgIHdvcmxkLmZpeGVkU3RlcCgpCiAgICAgKi8KCgogICAgZml4ZWRTdGVwKGR0LCBtYXhTdWJTdGVwcykgewogICAgICBpZiAoZHQgPT09IHZvaWQgMCkgewogICAgICAgIGR0ID0gMSAvIDYwOwogICAgICB9CgogICAgICBpZiAobWF4U3ViU3RlcHMgPT09IHZvaWQgMCkgewogICAgICAgIG1heFN1YlN0ZXBzID0gMTA7CiAgICAgIH0KCiAgICAgIGNvbnN0IHRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAvIDEwMDA7IC8vIHNlY29uZHMKCiAgICAgIGlmICghdGhpcy5sYXN0Q2FsbFRpbWUpIHsKICAgICAgICB0aGlzLnN0ZXAoZHQsIHVuZGVmaW5lZCwgbWF4U3ViU3RlcHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDYWxsZWQgPSB0aW1lIC0gdGhpcy5sYXN0Q2FsbFRpbWU7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CiAgICAgIH0KCiAgICAgIHRoaXMubGFzdENhbGxUaW1lID0gdGltZTsKICAgIH0KICAgIC8qKgogICAgICogU3RlcCB0aGUgcGh5c2ljcyB3b3JsZCBmb3J3YXJkIGluIHRpbWUuCiAgICAgKgogICAgICogVGhlcmUgYXJlIHR3byBtb2Rlcy4gVGhlIHNpbXBsZSBtb2RlIGlzIGZpeGVkIHRpbWVzdGVwcGluZyB3aXRob3V0IGludGVycG9sYXRpb24uIEluIHRoaXMgY2FzZSB5b3Ugb25seSB1c2UgdGhlIGZpcnN0IGFyZ3VtZW50LiBUaGUgc2Vjb25kIGNhc2UgdXNlcyBpbnRlcnBvbGF0aW9uLiBJbiB0aGF0IHlvdSBhbHNvIHByb3ZpZGUgdGhlIHRpbWUgc2luY2UgdGhlIGZ1bmN0aW9uIHdhcyBsYXN0IHVzZWQsIGFzIHdlbGwgYXMgdGhlIG1heGltdW0gZml4ZWQgdGltZXN0ZXBzIHRvIHRha2UuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UuCiAgICAgKiBAcGFyYW0gdGltZVNpbmNlTGFzdENhbGxlZCBUaGUgdGltZSBlbGFwc2VkIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCBjYWxsZWQuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL3dlYi5hcmNoaXZlLm9yZy93ZWIvMjAxODA0MjYxNTQ1MzEvaHR0cDovL2J1bGxldHBoeXNpY3Mub3JnL21lZGlhd2lraS0xLjUuOC9pbmRleC5waHAvU3RlcHBpbmdfVGhlX1dvcmxkI1doYXRfZG9fdGhlX3BhcmFtZXRlcnNfdG9fYnREeW5hbWljc1dvcmxkOjpzdGVwU2ltdWxhdGlvbl9tZWFuLjNGCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIGZpeGVkIHRpbWVzdGVwcGluZyB3aXRob3V0IGludGVycG9sYXRpb24KICAgICAqICAgICB3b3JsZC5zdGVwKDEgLyA2MCkKICAgICAqLwoKCiAgICBzdGVwKGR0LCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcykgewogICAgICBpZiAobWF4U3ViU3RlcHMgPT09IHZvaWQgMCkgewogICAgICAgIG1heFN1YlN0ZXBzID0gMTA7CiAgICAgIH0KCiAgICAgIGlmICh0aW1lU2luY2VMYXN0Q2FsbGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyBGaXhlZCwgc2ltcGxlIHN0ZXBwaW5nCiAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOyAvLyBJbmNyZW1lbnQgdGltZQoKICAgICAgICB0aGlzLnRpbWUgKz0gZHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY2N1bXVsYXRvciArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICAgIGNvbnN0IHQwID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgbGV0IHN1YnN0ZXBzID0gMDsKCiAgICAgICAgd2hpbGUgKHRoaXMuYWNjdW11bGF0b3IgPj0gZHQgJiYgc3Vic3RlcHMgPCBtYXhTdWJTdGVwcykgewogICAgICAgICAgLy8gRG8gZml4ZWQgc3RlcHMgdG8gY2F0Y2ggdXAKICAgICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsKICAgICAgICAgIHRoaXMuYWNjdW11bGF0b3IgLT0gZHQ7CiAgICAgICAgICBzdWJzdGVwcysrOwoKICAgICAgICAgIGlmIChwZXJmb3JtYW5jZS5ub3coKSAtIHQwID4gZHQgKiAxMDAwKSB7CiAgICAgICAgICAgIC8vIFRoZSBmcmFtZXJhdGUgaXMgbm90IGludGVyYWN0aXZlIGFueW1vcmUuCiAgICAgICAgICAgIC8vIFdlIGFyZSBiZWxvdyB0aGUgdGFyZ2V0IGZyYW1lcmF0ZS4KICAgICAgICAgICAgLy8gQmV0dGVyIGJhaWwgb3V0LgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IC8vIFJlbW92ZSB0aGUgZXhjZXNzIGFjY3VtdWxhdG9yLCBzaW5jZSB3ZSBtYXkgbm90CiAgICAgICAgLy8gaGF2ZSBoYWQgZW5vdWdoIHN1YnN0ZXBzIGF2YWlsYWJsZSB0byBjYXRjaCB1cAoKCiAgICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHRoaXMuYWNjdW11bGF0b3IgJSBkdDsKICAgICAgICBjb25zdCB0ID0gdGhpcy5hY2N1bXVsYXRvciAvIGR0OwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gdGhpcy5ib2RpZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmJvZGllc1tqXTsKICAgICAgICAgIGIucHJldmlvdXNQb3NpdGlvbi5sZXJwKGIucG9zaXRpb24sIHQsIGIuaW50ZXJwb2xhdGVkUG9zaXRpb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24uc2xlcnAoYi5xdWF0ZXJuaW9uLCB0LCBiLmludGVycG9sYXRlZFF1YXRlcm5pb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24ubm9ybWFsaXplKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnRpbWUgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgfQogICAgfQoKICAgIGludGVybmFsU3RlcChkdCkgewogICAgICB0aGlzLmR0ID0gZHQ7CiAgICAgIGNvbnN0IGNvbnRhY3RzID0gdGhpcy5jb250YWN0czsKICAgICAgY29uc3QgcDEgPSBXb3JsZF9zdGVwX3AxOwogICAgICBjb25zdCBwMiA9IFdvcmxkX3N0ZXBfcDI7CiAgICAgIGNvbnN0IE4gPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBzb2x2ZXIgPSB0aGlzLnNvbHZlcjsKICAgICAgY29uc3QgZ3Jhdml0eSA9IHRoaXMuZ3Jhdml0eTsKICAgICAgY29uc3QgZG9Qcm9maWxpbmcgPSB0aGlzLmRvUHJvZmlsaW5nOwogICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5wcm9maWxlOwogICAgICBjb25zdCBEWU5BTUlDID0gQm9keS5EWU5BTUlDOwogICAgICBsZXQgcHJvZmlsaW5nU3RhcnQgPSAtSW5maW5pdHk7CiAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gdGhpcy5jb25zdHJhaW50czsKICAgICAgY29uc3QgZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBXb3JsZF9zdGVwX2ZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICBncmF2aXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBneCA9IGdyYXZpdHkueDsKICAgICAgY29uc3QgZ3kgPSBncmF2aXR5Lnk7CiAgICAgIGNvbnN0IGd6ID0gZ3Jhdml0eS56OwogICAgICBsZXQgaSA9IDA7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBncmF2aXR5IHRvIGFsbCBvYmplY3RzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlID09PSBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgZiA9IGJpLmZvcmNlOwogICAgICAgICAgY29uc3QgbSA9IGJpLm1hc3M7CiAgICAgICAgICBmLnggKz0gbSAqIGd4OwogICAgICAgICAgZi55ICs9IG0gKiBneTsKICAgICAgICAgIGYueiArPSBtICogZ3o7CiAgICAgICAgfQogICAgICB9IC8vIFVwZGF0ZSBzdWJzeXN0ZW1zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIE5zdWJzeXN0ZW1zID0gdGhpcy5zdWJzeXN0ZW1zLmxlbmd0aDsgaSAhPT0gTnN1YnN5c3RlbXM7IGkrKykgewogICAgICAgIHRoaXMuc3Vic3lzdGVtc1tpXS51cGRhdGUoKTsKICAgICAgfSAvLyBDb2xsaXNpb24gZGV0ZWN0aW9uCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgcDEubGVuZ3RoID0gMDsgLy8gQ2xlYW4gdXAgcGFpciBhcnJheXMgZnJvbSBsYXN0IHN0ZXAKCiAgICAgIHAyLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5jb2xsaXNpb25QYWlycyh0aGlzLCBwMSwgcDIpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5icm9hZHBoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBSZW1vdmUgY29uc3RyYWluZWQgcGFpcnMgd2l0aCBjb2xsaWRlQ29ubmVjdGVkID09IGZhbHNlCgoKICAgICAgbGV0IE5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5jb25zdHJhaW50czsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGNvbnN0cmFpbnRzW2ldOwoKICAgICAgICBpZiAoIWMuY29sbGlkZUNvbm5lY3RlZCkgewogICAgICAgICAgZm9yIChsZXQgaiA9IHAxLmxlbmd0aCAtIDE7IGogPj0gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgIGlmIChjLmJvZHlBID09PSBwMVtqXSAmJiBjLmJvZHlCID09PSBwMltqXSB8fCBjLmJvZHlCID09PSBwMVtqXSAmJiBjLmJvZHlBID09PSBwMltqXSkgewogICAgICAgICAgICAgIHAxLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICBwMi5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4VGljaygpOyAvLyBHZW5lcmF0ZSBjb250YWN0cwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgY29uc3Qgb2xkY29udGFjdHMgPSBXb3JsZF9zdGVwX29sZENvbnRhY3RzOwogICAgICBjb25zdCBOb2xkQ29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkQ29udGFjdHM7IGkrKykgewogICAgICAgIG9sZGNvbnRhY3RzLnB1c2goY29udGFjdHNbaV0pOwogICAgICB9CgogICAgICBjb250YWN0cy5sZW5ndGggPSAwOyAvLyBUcmFuc2ZlciBGcmljdGlvbkVxdWF0aW9uIGZyb20gY3VycmVudCBsaXN0IHRvIHRoZSBwb29sIGZvciByZXVzZQoKICAgICAgY29uc3QgTm9sZEZyaWN0aW9uRXF1YXRpb25zID0gdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkRnJpY3Rpb25FcXVhdGlvbnM7IGkrKykgewogICAgICAgIGZyaWN0aW9uRXF1YXRpb25Qb29sLnB1c2godGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5uYXJyb3dwaGFzZS5nZXRDb250YWN0cyhwMSwgcDIsIHRoaXMsIGNvbnRhY3RzLCBvbGRjb250YWN0cywgLy8gVG8gYmUgcmV1c2VkCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMsIGZyaWN0aW9uRXF1YXRpb25Qb29sKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubmFycm93cGhhc2UgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIExvb3Agb3ZlciBhbGwgY29sbGlzaW9ucwoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gQWRkIGFsbCBmcmljdGlvbiBlcXMKCgogICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbih0aGlzLmZyaWN0aW9uRXF1YXRpb25zW2ldKTsKICAgICAgfQoKICAgICAgY29uc3QgbmNvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IG5jb250YWN0czsgaysrKSB7CiAgICAgICAgLy8gQ3VycmVudCBjb250YWN0CiAgICAgICAgY29uc3QgYyA9IGNvbnRhY3RzW2tdOyAvLyBHZXQgY3VycmVudCBjb2xsaXNpb24gaW5kZWNlcwoKICAgICAgICBjb25zdCBiaSA9IGMuYmk7CiAgICAgICAgY29uc3QgYmogPSBjLmJqOwogICAgICAgIGNvbnN0IHNpID0gYy5zaTsKICAgICAgICBjb25zdCBzaiA9IGMuc2o7IC8vIEdldCBjb2xsaXNpb24gcHJvcGVydGllcwoKICAgICAgICBsZXQgY207CgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgY20gPSB0aGlzLmdldENvbnRhY3RNYXRlcmlhbChiaS5tYXRlcmlhbCwgYmoubWF0ZXJpYWwpIHx8IHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY20gPSB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSAvLyBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKCgogICAgICAgIGNtLmZyaWN0aW9uOyAvLyBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgICAgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGlmIChiaS5tYXRlcmlhbC5mcmljdGlvbiA+PSAwICYmIGJqLm1hdGVyaWFsLmZyaWN0aW9uID49IDApIHsKICAgICAgICAgICAgYmkubWF0ZXJpYWwuZnJpY3Rpb24gKiBiai5tYXRlcmlhbC5mcmljdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGMucmVzdGl0dXRpb24gPSBiaS5tYXRlcmlhbC5yZXN0aXR1dGlvbiAqIGJqLm1hdGVyaWFsLnJlc3RpdHV0aW9uOwogICAgICAgICAgfQogICAgICAgIH0gLy8gYy5zZXRTcG9va1BhcmFtcygKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLAogICAgICAgIC8vICAgICAgICAgICBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLAogICAgICAgIC8vICAgICAgICAgICBkdAogICAgICAgIC8vICAgICAgICk7CgoKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24oYyk7IC8vIC8vIEFkZCBmcmljdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICAgICAgLy8gaWYobXUgPiAwKXsKICAgICAgICAvLyAJLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICAvLyAJY29uc3QgbXVnID0gbXUgKiBnbm9ybTsKICAgICAgICAvLyAJY29uc3QgcmVkdWNlZE1hc3MgPSAoYmkuaW52TWFzcyArIGJqLmludk1hc3MpOwogICAgICAgIC8vIAlpZihyZWR1Y2VkTWFzcyA+IDApewogICAgICAgIC8vIAkJcmVkdWNlZE1hc3MgPSAxL3JlZHVjZWRNYXNzOwogICAgICAgIC8vIAl9CiAgICAgICAgLy8gCWNvbnN0IHBvb2wgPSBmcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgICAvLyAJY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAljb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJpLGJqLG11ZypyZWR1Y2VkTWFzcyk7CiAgICAgICAgLy8gCXRoaXMuZnJpY3Rpb25FcXVhdGlvbnMucHVzaChjMSwgYzIpOwogICAgICAgIC8vIAljMS5iaSA9IGMyLmJpID0gYmk7CiAgICAgICAgLy8gCWMxLmJqID0gYzIuYmogPSBiajsKICAgICAgICAvLyAJYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcqcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCWMxLm1heEZvcmNlID0gYzIubWF4Rm9yY2UgPSBtdWcqcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCS8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwogICAgICAgIC8vIAljMS5yaS5jb3B5KGMucmkpOwogICAgICAgIC8vIAljMS5yai5jb3B5KGMucmopOwogICAgICAgIC8vIAljMi5yaS5jb3B5KGMucmkpOwogICAgICAgIC8vIAljMi5yai5jb3B5KGMucmopOwogICAgICAgIC8vIAkvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKICAgICAgICAvLyAJYy5uaS50YW5nZW50cyhjMS50LCBjMi50KTsKICAgICAgICAvLyAgICAgICAgICAgLy8gU2V0IHNwb29rIHBhcmFtcwogICAgICAgIC8vICAgICAgICAgICBjMS5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgZHQpOwogICAgICAgIC8vICAgICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgZHQpOwogICAgICAgIC8vICAgICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGMuZW5hYmxlZDsKICAgICAgICAvLyAJLy8gQWRkIGVxdWF0aW9ucyB0byBzb2x2ZXIKICAgICAgICAvLyAJc29sdmVyLmFkZEVxdWF0aW9uKGMxKTsKICAgICAgICAvLyAJc29sdmVyLmFkZEVxdWF0aW9uKGMyKTsKICAgICAgICAvLyB9CgogICAgICAgIGlmIChiaS5hbGxvd1NsZWVwICYmIGJpLnR5cGUgPT09IEJvZHkuRFlOQU1JQyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HICYmIGJqLnNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgYmoudHlwZSAhPT0gQm9keS5TVEFUSUMpIHsKICAgICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZEIgPSBiai52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyBiai5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWRCID0gYmouc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgICAgaWYgKHNwZWVkU3F1YXJlZEIgPj0gc3BlZWRMaW1pdFNxdWFyZWRCICogMikgewogICAgICAgICAgICBiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiai5hbGxvd1NsZWVwICYmIGJqLnR5cGUgPT09IEJvZHkuRFlOQU1JQyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HICYmIGJpLnNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgYmkudHlwZSAhPT0gQm9keS5TVEFUSUMpIHsKICAgICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZEEgPSBiaS52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyBiaS5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWRBID0gYmkuc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgICAgaWYgKHNwZWVkU3F1YXJlZEEgPj0gc3BlZWRMaW1pdFNxdWFyZWRBICogMikgewogICAgICAgICAgICBiai53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIE5vdyB3ZSBrbm93IHRoYXQgaSBhbmQgaiBhcmUgaW4gY29udGFjdC4gU2V0IGNvbGxpc2lvbiBtYXRyaXggc3RhdGUKCgogICAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldChiaSwgYmosIHRydWUpOwoKICAgICAgICBpZiAoIXRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMuZ2V0KGJpLCBiaikpIHsKICAgICAgICAgIC8vIEZpcnN0IGNvbnRhY3QhCiAgICAgICAgICAvLyBXZSByZXVzZSB0aGUgY29sbGlkZUV2ZW50IG9iamVjdCwgb3RoZXJ3aXNlIHdlIHdpbGwgZW5kIHVwIGNyZWF0aW5nIG5ldyBvYmplY3RzIGZvciBlYWNoIG5ldyBjb250YWN0LCBldmVuIGlmIHRoZXJlJ3Mgbm8gZXZlbnQgbGlzdGVuZXIgYXR0YWNoZWQuCiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5ib2R5ID0gYmo7CiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5jb250YWN0ID0gYzsKICAgICAgICAgIGJpLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJpOwogICAgICAgICAgYmouZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnNldChiaS5pZCwgYmouaWQpOwogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICB9CgogICAgICB0aGlzLmVtaXRDb250YWN0RXZlbnRzKCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm1ha2VDb250YWN0Q29uc3RyYWludHMgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gV2FrZSB1cCBib2RpZXMKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UpIHsKICAgICAgICAgIGJpLndha2VVcCgpOwogICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSAvLyBBZGQgdXNlci1hZGRlZCBjb25zdHJhaW50cwoKCiAgICAgIE5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5jb25zdHJhaW50czsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGNvbnN0cmFpbnRzW2ldOwogICAgICAgIGMudXBkYXRlKCk7CgogICAgICAgIGZvciAobGV0IGogPSAwLCBOZXEgPSBjLmVxdWF0aW9ucy5sZW5ndGg7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICBjb25zdCBlcSA9IGMuZXF1YXRpb25zW2pdOwogICAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGVxKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29sdmUgdGhlIGNvbnN0cmFpbmVkIHN5c3RlbQoKCiAgICAgIHNvbHZlci5zb2x2ZShkdCwgdGhpcyk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLnNvbHZlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBSZW1vdmUgYWxsIGNvbnRhY3RzIGZyb20gc29sdmVyCgoKICAgICAgc29sdmVyLnJlbW92ZUFsbEVxdWF0aW9ucygpOyAvLyBBcHBseSBkYW1waW5nLCBzZWUgaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2J1bGxldC9pc3N1ZXMvZGV0YWlsP2lkPTc0IGZvciBkZXRhaWxzCgogICAgICBjb25zdCBwb3cgPSBNYXRoLnBvdzsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSAmIERZTkFNSUMpIHsKICAgICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMgYm9kaWVzCiAgICAgICAgICBjb25zdCBsZCA9IHBvdygxLjAgLSBiaS5saW5lYXJEYW1waW5nLCBkdCk7CiAgICAgICAgICBjb25zdCB2ID0gYmkudmVsb2NpdHk7CiAgICAgICAgICB2LnNjYWxlKGxkLCB2KTsKICAgICAgICAgIGNvbnN0IGF2ID0gYmkuYW5ndWxhclZlbG9jaXR5OwoKICAgICAgICAgIGlmIChhdikgewogICAgICAgICAgICBjb25zdCBhZCA9IHBvdygxLjAgLSBiaS5hbmd1bGFyRGFtcGluZywgZHQpOwogICAgICAgICAgICBhdi5zY2FsZShhZCwgYXYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50KTsgLy8gTGVhcCBmcm9nCiAgICAgIC8vIHZuZXcgPSB2ICsgaCpmL20KICAgICAgLy8geG5ldyA9IHggKyBoKnZuZXcKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHN0ZXBudW1iZXIgPSB0aGlzLnN0ZXBudW1iZXI7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemUgPSBzdGVwbnVtYmVyICUgKHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgKyAxKSA9PT0gMDsKICAgICAgY29uc3QgcXVhdE5vcm1hbGl6ZUZhc3QgPSB0aGlzLnF1YXROb3JtYWxpemVGYXN0OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgYm9kaWVzW2ldLmludGVncmF0ZShkdCwgcXVhdE5vcm1hbGl6ZSwgcXVhdE5vcm1hbGl6ZUZhc3QpOwogICAgICB9CgogICAgICB0aGlzLmNsZWFyRm9yY2VzKCk7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5kaXJ0eSA9IHRydWU7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmludGVncmF0ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gVXBkYXRlIHN0ZXAgbnVtYmVyCgoKICAgICAgdGhpcy5zdGVwbnVtYmVyICs9IDE7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQpOyAvLyBTbGVlcGluZyB1cGRhdGUKCiAgICAgIGxldCBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwoKICAgICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmkuc2xlZXBUaWNrKHRoaXMudGltZSk7CgogICAgICAgICAgaWYgKGJpLnNsZWVwU3RhdGUgIT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gaGFzQWN0aXZlQm9kaWVzOwogICAgfQoKICAgIGVtaXRDb250YWN0RXZlbnRzKCkgewogICAgICBjb25zdCBoYXNCZWdpbkNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0IHx8IGhhc0VuZENvbnRhY3QpIHsKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgYWRkaXRpb25zLmxlbmd0aCA9IHJlbW92YWxzLmxlbmd0aCA9IDA7CiAgICAgIGNvbnN0IGhhc0JlZ2luU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpblNoYXBlQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRTaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZFNoYXBlQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0IHx8IGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpblNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZFNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgYWxsIGJvZHkgZm9yY2VzIGluIHRoZSB3b3JsZCB0byB6ZXJvLgogICAgICovCgoKICAgIGNsZWFyRm9yY2VzKCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBiLmZvcmNlOwogICAgICAgIGIudG9ycXVlOwogICAgICAgIGIuZm9yY2Uuc2V0KDAsIDAsIDApOwogICAgICAgIGIudG9ycXVlLnNldCgwLCAwLCAwKTsKICAgICAgfQogICAgfQoKICB9IC8vIFRlbXAgc3R1ZmYKCiAgbmV3IEFBQkIoKTsKICBjb25zdCB0bXBSYXkgPSBuZXcgUmF5KCk7IC8vIHBlcmZvcm1hbmNlLm5vdygpIGZhbGxiYWNrIG9uIERhdGUubm93KCkKCiAgY29uc3QgcGVyZm9ybWFuY2UgPSBnbG9iYWxUaGlzLnBlcmZvcm1hbmNlIHx8IHt9OwoKICBpZiAoIXBlcmZvcm1hbmNlLm5vdykgewogICAgbGV0IG5vd09mZnNldCA9IERhdGUubm93KCk7CgogICAgaWYgKHBlcmZvcm1hbmNlLnRpbWluZyAmJiBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0KSB7CiAgICAgIG5vd09mZnNldCA9IHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7CiAgICB9CgogICAgcGVyZm9ybWFuY2Uubm93ID0gKCkgPT4gRGF0ZS5ub3coKSAtIG5vd09mZnNldDsKICB9CgogIG5ldyBWZWMzKCk7IC8vIERpc3BhdGNoZWQgYWZ0ZXIgdGhlIHdvcmxkIGhhcyBzdGVwcGVkIGZvcndhcmQgaW4gdGltZS4KICAvLyBSZXVzYWJsZSBldmVudCBvYmplY3RzIHRvIHNhdmUgbWVtb3J5LgoKICBjb25zdCBXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncG9zdFN0ZXAnCiAgfTsgLy8gRGlzcGF0Y2hlZCBiZWZvcmUgdGhlIHdvcmxkIHN0ZXBzIGZvcndhcmQgaW4gdGltZS4KCiAgY29uc3QgV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncHJlU3RlcCcKICB9OwogIGNvbnN0IFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50ID0gewogICAgdHlwZTogQm9keS5DT0xMSURFX0VWRU5UX05BTUUsCiAgICBib2R5OiBudWxsLAogICAgY29udGFjdDogbnVsbAogIH07IC8vIFBvb2xzIGZvciB1bnVzZWQgb2JqZWN0cwoKICBjb25zdCBXb3JsZF9zdGVwX29sZENvbnRhY3RzID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbCA9IFtdOyAvLyBSZXVzYWJsZSBhcnJheXMgZm9yIGNvbGxpc2lvbiBwYWlycwoKICBjb25zdCBXb3JsZF9zdGVwX3AxID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9wMiA9IFtdOyAvLyBTdHVmZiBmb3IgZW1pdENvbnRhY3RFdmVudHMKCiAgY29uc3QgYWRkaXRpb25zID0gW107CiAgY29uc3QgcmVtb3ZhbHMgPSBbXTsKICBjb25zdCBiZWdpbkNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpbkNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgZW5kQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZENvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgYmVnaW5TaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpblNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKICBjb25zdCBlbmRTaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRTaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CgogIGNvbnN0IGFkZENvbnRhY3RNYXRlcmlhbCA9ICh3b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIF9yZWYsIHV1aWQpID0+IHsKICAgIGxldCBbbWF0ZXJpYWxBLCBtYXRlcmlhbEIsIG9wdGlvbnNdID0gX3JlZjsKICAgIGNvbnN0IG1hdEEgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEEpOwogICAgY29uc3QgbWF0QiA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsQik7CiAgICBjb25zdCBjb250YWN0TWF0ZXJpYWwgPSBuZXcgQ29udGFjdE1hdGVyaWFsKG1hdEEsIG1hdEIsIG9wdGlvbnMpOwogICAgY29udGFjdE1hdGVyaWFsLnV1aWQgPSB1dWlkOwogICAgd29ybGQuYWRkQ29udGFjdE1hdGVyaWFsKGNvbnRhY3RNYXRlcmlhbCk7CiAgfTsKICBjb25zdCByZW1vdmVDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNtVVVJRCkgPT4gewogICAgY29uc3QgaW5kZXggPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLmZpbmRJbmRleChfcmVmMiA9PiB7CiAgICAgIGxldCB7CiAgICAgICAgdXVpZAogICAgICB9ID0gX3JlZjI7CiAgICAgIHJldHVybiB1dWlkID09PSBjbVVVSUQ7CiAgICB9KTsKICAgIGNvbnN0IFt7CiAgICAgIGlkOiBpCiAgICB9LCB7CiAgICAgIGlkOiBqCiAgICB9XSA9IHdvcmxkLmNvbnRhY3RtYXRlcmlhbHNbaW5kZXhdLm1hdGVyaWFsczsKICAgIHdvcmxkLmNvbnRhY3RtYXRlcmlhbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgIGRlbGV0ZSB3b3JsZC5jb250YWN0TWF0ZXJpYWxUYWJsZS5kYXRhW2kgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YF07CiAgfTsKCiAgbGV0IG1hdGVyaWFsSWQgPSAwOwogIGNvbnN0IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeSA9IG1hdGVyaWFscyA9PiBmdW5jdGlvbiAobmFtZU9yT3B0aW9ucykgewogICAgaWYgKG5hbWVPck9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICBuYW1lT3JPcHRpb25zID0ge307CiAgICB9CgogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwoKICBjb25zdCBwcmVwYXJlU3BoZXJlID0gYXJncyA9PiBBcnJheS5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXTsKCiAgY29uc3QgcHJlcGFyZUNvbnZleFBvbHloZWRyb24gPSBfcmVmMiA9PiB7CiAgICBsZXQgW3YsIGZhY2VzLCBuLCBhLCBib3VuZGluZ1NwaGVyZVJhZGl1c10gPSBfcmVmMjsKICAgIHJldHVybiBbewogICAgICBheGVzOiBhID8gYS5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICBib3VuZGluZ1NwaGVyZVJhZGl1cywKICAgICAgZmFjZXMsCiAgICAgIG5vcm1hbHM6IG4gPyBuLm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICAgIHZlcnRpY2VzOiB2ID8gdi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkCiAgICB9XTsKICB9OwoKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCgogICAgICBjYXNlICdDb252ZXhQb2x5aGVkcm9uJzoKICAgICAgICByZXR1cm4gbmV3IENvbnZleFBvbHloZWRyb24oLi4ucHJlcGFyZUNvbnZleFBvbHloZWRyb24oYXJncykpOwoKICAgICAgY2FzZSAnQ3lsaW5kZXInOgogICAgICAgIHJldHVybiBuZXcgQ3lsaW5kZXIoLi4uYXJncyk7CiAgICAgIC8vIFsgcmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMgXSA9IGFyZ3MKCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKCiAgICAgIGNhc2UgJ1BhcnRpY2xlJzoKICAgICAgICByZXR1cm4gbmV3IFBhcnRpY2xlKCk7CiAgICAgIC8vIG5vIGFyZ3MKCiAgICAgIGNhc2UgJ1BsYW5lJzoKICAgICAgICByZXR1cm4gbmV3IFBsYW5lKCk7CiAgICAgIC8vIG5vIGFyZ3MsIGluZmluaXRlIHggYW5kIHkKCiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKCiAgICAgIGNhc2UgJ1RyaW1lc2gnOgogICAgICAgIHJldHVybiBuZXcgVHJpbWVzaCguLi5hcmdzKTsKICAgICAgLy8gW3ZlcnRpY2VzLCBpbmRpY2VzXSA9IGFyZ3MKICAgIH0KICB9CiAgLyoqCiAgICogQGZ1bmN0aW9uCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy51dWlkCiAgICogQHBhcmFtIHtCb2R5UHJvcHN9IG9wdGlvbnMucHJvcHMKICAgKiBAcGFyYW0ge0JvZHlTaGFwZVR5cGV9IG9wdGlvbnMudHlwZQogICAqIEBwYXJhbSB7KG1hdGVyaWFsT3B0aW9uczogTWF0ZXJpYWxPcHRpb25zKSA9PiBNYXRlcmlhbCA9fSBvcHRpb25zLmNyZWF0ZU1hdGVyaWFsCiAgICogQHJldHVybnMge0JvZHl9CiAgICovCgoKICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uID0gWzAsIDAsIDBdLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7IC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKCiAgICBpZiAoY29sbGlzaW9uUmVzcG9uc2UgIT09IHVuZGVmaW5lZCkgewogICAgICBib2R5LmNvbGxpc2lvblJlc3BvbnNlID0gY29sbGlzaW9uUmVzcG9uc2U7CiAgICB9CgogICAgaWYgKHR5cGUgPT09ICdDb21wb3VuZCcpIHsKICAgICAgc2hhcGVzLmZvckVhY2goX3JlZjMgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYXJncywKICAgICAgICAgIHBvc2l0aW9uLAogICAgICAgICAgcm90YXRpb24sCiAgICAgICAgICBtYXRlcmlhbCwKICAgICAgICAgIC4uLmV4dHJhCiAgICAgICAgfSA9IF9yZWYzOwogICAgICAgIGNvbnN0IHNoYXBlQm9keSA9IGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncyksIHBvc2l0aW9uID8gbmV3IFZlYzMoLi4ucG9zaXRpb24pIDogdW5kZWZpbmVkLCByb3RhdGlvbiA/IG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUV1bGVyKC4uLnJvdGF0aW9uKSA6IHVuZGVmaW5lZCk7CiAgICAgICAgaWYgKG1hdGVyaWFsKSBzaGFwZUJvZHkubWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbCk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzaGFwZUJvZHksIGV4dHJhKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpKTsKICAgIH0KCiAgICBib2R5LnBvc2l0aW9uLnNldChwb3NpdGlvblswXSwgcG9zaXRpb25bMV0sIHBvc2l0aW9uWzJdKTsKICAgIGJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIocm90YXRpb25bMF0sIHJvdGF0aW9uWzFdLCByb3RhdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGJvZHkgPSBwcm9wc1RvQm9keSh7CiAgICAgICAgY3JlYXRlTWF0ZXJpYWwsCiAgICAgICAgcHJvcHM6IHByb3BzW2ldLAogICAgICAgIHR5cGUsCiAgICAgICAgdXVpZDogdXVpZFtpXQogICAgICB9KTsKICAgICAgc3RhdGUud29ybGQuYWRkQm9keShib2R5KTsKICAgICAgaWYgKHByb3BzW2ldLm9uQ29sbGlkZSkgYm9keS5hZGRFdmVudExpc3RlbmVyKCdjb2xsaWRlJywgX3JlZjIgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYm9keSwKICAgICAgICAgIHRhcmdldCwKICAgICAgICAgIGNvbnRhY3QKICAgICAgICB9ID0gX3JlZjI7CiAgICAgICAgaWYgKCFib2R5LnV1aWQgfHwgIXRhcmdldC51dWlkKSByZXR1cm47CiAgICAgICAgY29uc3QgewogICAgICAgICAgbmksCiAgICAgICAgICByaSwKICAgICAgICAgIHJqLAogICAgICAgICAgYmksCiAgICAgICAgICBiaiwKICAgICAgICAgIGlkCiAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgIH0sCiAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogdXNlIGlkIGluc3RlYWQgb2YgdXVpZAogICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJqOiBiai51dWlkLAogICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICBpZCwKICAgICAgICAgICAgaW1wYWN0VmVsb2NpdHk6IGNvbnRhY3QuZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpLAogICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICByajogcmoudG9BcnJheSgpCiAgICAgICAgICB9LAogICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgdHlwZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBjb25zdCB0cmlwbGV0VG9WZWMzID0gdCA9PiB0ID8gbmV3IFZlYzMoLi4udCkgOiB1bmRlZmluZWQ7CgogIGNvbnN0IGFkZENvbnN0cmFpbnQgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgYXhpc0EsCiAgICAgICAgYXhpc0IsCiAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBtYXhGb3JjZSwKICAgICAgICBtYXhNdWx0aXBsaWVyLAogICAgICAgIHBpdm90QSwKICAgICAgICBwaXZvdEIsCiAgICAgICAgdHdpc3RBbmdsZSwKICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgfV0sCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgbGV0IGNvbnN0cmFpbnQ7CgogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ1BvaW50VG9Qb2ludCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgdHJpcGxldFRvVmVjMyhwaXZvdEIpLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnRGlzdGFuY2UnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgRGlzdGFuY2VDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIGRpc3RhbmNlLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgd2FrZVVwQm9kaWVzCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgY29uc3RyYWludC51dWlkID0gdXVpZDsKICAgIHN0YXRlLndvcmxkLmFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7CgogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwoKICAgICAgICBpZiAobXVsdGlwbGllciA+IG1heE11bHRpcGxpZXIpIHsKICAgICAgICAgIGNvbnN0cmFpbnQuZGlzYWJsZSgpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdID0gcG9zdFN0ZXBDb25zdHJhaW50OwogICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB0b1VwcGVyY2FzZShzdHIpIHsKICAgIHJldHVybiBzdHIudG9VcHBlckNhc2UoKTsKICB9CgogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwoKICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5yZXN1bHQgfHwgIW9wdGlvbnMucmVzdWx0LmJvZHkpIHJldHVybjsKICAgICAgY29uc3QgewogICAgICAgIGJvZHksCiAgICAgICAgc2hhcGUsCiAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgY29uc3QgYm9keVVVSUQgPSBib2R5LnV1aWQ7CiAgICAgIGlmICghYm9keVVVSUQpIHJldHVybjsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgYm9keTogYm9keVVVSUQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICByYXk6IHsKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgIGRpcmVjdGlvbjogcmF5LmRpcmVjdGlvbi50b0FycmF5KCksCiAgICAgICAgICBmcm9tLAogICAgICAgICAgdG8sCiAgICAgICAgICB1dWlkCiAgICAgICAgfSwKICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgc2hhcGU6IHNoYXBlID8geyAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogIH07CgogIGNvbnN0IGFkZFJheWNhc3RWZWhpY2xlID0gKHN0YXRlLCBkYXRhKSA9PiB7CiAgICBjb25zdCBbY2hhc3Npc0JvZHksIHdoZWVscywgd2hlZWxJbmZvcywgaW5kZXhGb3J3YXJkQXhpcywgaW5kZXhSaWdodEF4aXMsIGluZGV4VXBBeGlzXSA9IGRhdGEucHJvcHM7CiAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgIGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgIGluZGV4UmlnaHRBeGlzLAogICAgICBpbmRleFVwQXhpcwogICAgfSk7CiAgICB2ZWhpY2xlLndvcmxkID0gc3RhdGUud29ybGQ7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBheGxlTG9jYWwsCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLAogICAgICAgIGRpcmVjdGlvbkxvY2FsLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IHdoZWVsSW5mb3NbaV07CiAgICAgIHZlaGljbGUuYWRkV2hlZWwoewogICAgICAgIGF4bGVMb2NhbDogdHJpcGxldFRvVmVjMyhheGxlTG9jYWwpLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogdHJpcGxldFRvVmVjMyhjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiB0cmlwbGV0VG9WZWMzKGRpcmVjdGlvbkxvY2FsKSwKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwoKICAgIGNvbnN0IHBvc3RTdGVwID0gKCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlaGljbGUud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IHZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgIH0KICAgIH07CgogICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXSA9IHsKICAgICAgcG9zdFN0ZXAsCiAgICAgIHByZVN0ZXAsCiAgICAgIHZlaGljbGUKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgcHJlU3RlcCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHBvc3RTdGVwKTsKICB9OwoKICBjb25zdCBhZGRTcHJpbmcgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgZGFtcGluZywKICAgICAgICBsb2NhbEFuY2hvckEsCiAgICAgICAgbG9jYWxBbmNob3JCLAogICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgc3RpZmZuZXNzLAogICAgICAgIHdvcmxkQW5jaG9yQSwKICAgICAgICB3b3JsZEFuY2hvckIKICAgICAgfV0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgIGRhbXBpbmcsCiAgICAgIGxvY2FsQW5jaG9yQTogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckEpLAogICAgICBsb2NhbEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JCKSwKICAgICAgcmVzdExlbmd0aCwKICAgICAgc3RpZmZuZXNzLAogICAgICB3b3JsZEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JBKSwKICAgICAgd29ybGRBbmNob3JCOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQikKICAgIH0pOwogICAgc3ByaW5nLnV1aWQgPSB1dWlkOwoKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKCiAgICBzdGF0ZS5zcHJpbmdzW3V1aWRdID0gcG9zdFN0ZXBTcHJpbmc7CiAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0gPSBzcHJpbmc7IC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAoKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBlbWl0RW5kQ29udGFjdChfcmVmMikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjI7CiAgICBpZiAoIShib2R5QSAhPSBudWxsICYmIGJvZHlBLnV1aWQpIHx8ICEoYm9keUIgIT0gbnVsbCAmJiBib2R5Qi51dWlkKSkgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJwogICAgfSk7CiAgfQoKICBjb25zdCBpbml0ID0gKHN0YXRlLCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgYWxsb3dTbGVlcCwKICAgICAgYXhpc0luZGV4ID0gMCwKICAgICAgYnJvYWRwaGFzZSwKICAgICAgZGVmYXVsdENvbnRhY3RNYXRlcmlhbCwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgc3RhdGUud29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChncmF2aXR5WzBdLCBncmF2aXR5WzFdLCBncmF2aXR5WzJdKTsKICAgIHN0YXRlLndvcmxkLnF1YXROb3JtYWxpemVGYXN0ID0gcXVhdE5vcm1hbGl6ZUZhc3Q7CiAgICBzdGF0ZS53b3JsZC5xdWF0Tm9ybWFsaXplU2tpcCA9IHF1YXROb3JtYWxpemVTa2lwOwoKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KCiAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IHRvbGVyYW5jZTsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgfQoKICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgPSBicm9hZHBoYXNlID09PSAnU0FQJyA/IG5ldyBTQVBCcm9hZHBoYXNlKHN0YXRlLndvcmxkKSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKCiAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0JywgZW1pdEJlZ2luQ29udGFjdCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdlbmRDb250YWN0JywgZW1pdEVuZENvbnRhY3QpOwogICAgT2JqZWN0LmFzc2lnbihzdGF0ZS53b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLCBkZWZhdWx0Q29udGFjdE1hdGVyaWFsKTsKICB9OwoKICBjb25zdCBpc1FvclYgPSB2ID0+IHYgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uIHx8IHYgaW5zdGFuY2VvZiBWZWMzOwoKICBjb25zdCBzdGVwID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwb3NpdGlvbnMsCiAgICAgIHByb3BzOiB7CiAgICAgICAgbWF4U3ViU3RlcHMsCiAgICAgICAgc3RlcFNpemUsCiAgICAgICAgdGltZVNpbmNlTGFzdENhbGxlZAogICAgICB9LAogICAgICBxdWF0ZXJuaW9ucwogICAgfSA9IF9yZWY7CiAgICBzdGF0ZS53b3JsZC5zdGVwKHN0ZXBTaXplLCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQoKICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwoKICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXMoc3RhdGUuc3Vic2NyaXB0aW9ucykpIHsKICAgICAgY29uc3QgW3V1aWQsIHR5cGUsIHRhcmdldCA9ICdib2RpZXMnXSA9IHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdOwogICAgICBjb25zdCB7CiAgICAgICAgYm9kaWVzLAogICAgICAgIHZlaGljbGVzCiAgICAgIH0gPSBzdGF0ZTsKICAgICAgY29uc3QgdmFsdWUgPSB0YXJnZXQgPT09ICd2ZWhpY2xlcycgPyAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB2ZWhpY2xlc1t1dWlkXS52ZWhpY2xlW3R5cGVdIDogLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgYm9kaWVzW3V1aWRdW3R5cGVdOwogICAgICBjb25zdCBzZXJpYWxpemFibGVWYWx1ZSA9IGlzUW9yVih2YWx1ZSkgPyB2YWx1ZS50b0FycmF5KCkgOiB2YWx1ZTsKICAgICAgb2JzZXJ2YXRpb25zLnB1c2goW051bWJlcihpZCksIHNlcmlhbGl6YWJsZVZhbHVlLCAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB0eXBlXSk7CiAgICB9CgogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CgogICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiB7CiAgICAgICAgaWYgKGJvZHkudXVpZCkgYm9kaWVzLnB1c2goYm9keS51dWlkKTsKICAgICAgICByZXR1cm4gYm9kaWVzOwogICAgICB9LCBbXSk7CiAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICB9CgogICAgc2VsZi5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9zaXRpb25zLmJ1ZmZlciwgcXVhdGVybmlvbnMuYnVmZmVyXSk7CiAgfTsKCiAgY29uc3Qgc3RhdGUgPSB7CiAgICBib2RpZXM6IHt9LAogICAgYm9kaWVzTmVlZFN5bmNpbmc6IGZhbHNlLAogICAgY29uc3RyYWludHM6IHt9LAogICAgbWF0ZXJpYWxzOiB7fSwKICAgIHJheXM6IHt9LAogICAgc3ByaW5nSW5zdGFuY2VzOiB7fSwKICAgIHNwcmluZ3M6IHt9LAogICAgc3Vic2NyaXB0aW9uczoge30sCiAgICB2ZWhpY2xlczoge30sCiAgICB3b3JsZDogbmV3IFdvcmxkKCkKICB9OwoKICAvLy8gPHJlZmVyZW5jZSBuby1kZWZhdWx0LWxpYj0idHJ1ZSIvPgoKICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKCiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGJvZGllcywgYm9keSkgPT4gYm9keS51dWlkID8geyAuLi5ib2RpZXMsCiAgICAgIFtib2R5LnV1aWRdOiBib2R5CiAgICB9IDogYm9kaWVzLCB7fSk7CiAgfQoKICBjb25zdCBicm9hZHBoYXNlcyA9IHsKICAgIE5haXZlQnJvYWRwaGFzZSwKICAgIFNBUEJyb2FkcGhhc2UKICB9OwogIGNvbnN0IGNyZWF0ZU1hdGVyaWFsID0gY3JlYXRlTWF0ZXJpYWxGYWN0b3J5KHN0YXRlLm1hdGVyaWFscyk7CgogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKCiAgICBzd2l0Y2ggKGRhdGEub3ApIHsKICAgICAgY2FzZSAnaW5pdCc6CiAgICAgICAgewogICAgICAgICAgaW5pdChzdGF0ZSwgZGF0YS5wcm9wcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzdGVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGVwKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS51dWlkLmxlbmd0aDsgaSsrKSBzdGF0ZS53b3JsZC5yZW1vdmVCb2R5KHN0YXRlLmJvZGllc1tkYXRhLnV1aWRbaV1dKTsKCiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICd1bnN1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNbZGF0YS5wcm9wc107CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRQb3NpdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucG9zaXRpb24uc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRWZWxvY2l0eSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0udmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QW5ndWxhckZhY3Rvcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TWF0ZXJpYWwnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLm1hdGVyaWFsID0gZGF0YS5wcm9wcyA/IGNyZWF0ZU1hdGVyaWFsKGRhdGEucHJvcHMpIDogbnVsbDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldExpbmVhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFsbG93U2xlZXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFsbG93U2xlZXAgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0U2xlZXBTcGVlZExpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcFNwZWVkTGltaXQgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlckdyb3VwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJNYXNrJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25GaWx0ZXJNYXNrID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRGaXhlZFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5maXhlZFJvdGF0aW9uID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uaXNUcmlnZ2VyID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmdyYXZpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRJdGVyYXRpb25zJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci5pdGVyYXRpb25zID0gZGF0YS5wcm9wczsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbYCR7ZGF0YS5wcm9wc31Ccm9hZHBoYXNlYF0gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBeGlzSW5kZXgnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5icm9hZHBoYXNlIGluc3RhbmNlb2YgU0FQQnJvYWRwaGFzZSkgewogICAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBkYXRhLnByb3BzID09PSB1bmRlZmluZWQgfHwgZGF0YS5wcm9wcyA9PT0gbnVsbCA/IDAgOiBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUZvcmNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5SW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsSW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlUb3JxdWUnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5VG9ycXVlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKF9yZWYyID0+IHsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHV1aWQKICAgICAgICAgIH0gPSBfcmVmMjsKICAgICAgICAgIHJldHVybiB1dWlkID09PSBkYXRhLnV1aWQ7CiAgICAgICAgfSkubWFwKGMgPT4gc3RhdGUud29ybGQucmVtb3ZlQ29uc3RyYWludChjKSk7CgogICAgICAgIGlmIChzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF07CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmVuYWJsZSgpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Rpc2FibGVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkubWFwKGMgPT4gYy5kaXNhYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5kaXNhYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JTcGVlZCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5zZXRNb3RvclNwZWVkKGRhdGEucHJvcHMpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBhZGRTcHJpbmcoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nU3RpZmZuZXNzJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5zdGlmZm5lc3MgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdEYW1waW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5kYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZVNwcmluZyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW2RhdGEudXVpZF0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5JzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5yYXlzW2RhdGEudXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgYWRkUmF5Y2FzdFZlaGljbGUoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFJheWNhc3RWZWhpY2xlU3RlZXJpbmdWYWx1ZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVCcmFrZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JyYWtlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICBhZGRDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhLnByb3BzLCBkYXRhLnV1aWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICd3YWtlVXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLndha2VVcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2xlZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgfTsKCn0pKCk7Cgo=",null,!1);class hpe extends lpe{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.worker.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.worker.postMessage({op:"setBroadphase",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.worker.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.worker.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.worker.postMessage({op:"setTolerance",props:e})}constructor(e){let{allowSleep:t=!1,axisIndex:n=0,broadphase:r="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},gravity:o=[0,-9.81,0],iterations:a=5,quatNormalizeFast:l=!1,quatNormalizeSkip:c=0,size:g=1e3,solver:d="GS",tolerance:u=.001}=e;super();this.worker=new dpe,this.config={allowSleep:t,axisIndex:n,broadphase:r,defaultContactMaterial:s,gravity:o,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:c,size:g,solver:d,tolerance:u},this.buffers={positions:new Float32Array(g*3),quaternions:new Float32Array(g*4)},this.worker.onmessage=h=>{if(h.data.op==="frame"){this.buffers.positions=h.data.positions,this.buffers.quaternions=h.data.quaternions,this.emit(h.data.op,h.data);return}this.emit(h.data.type,h.data)}}addBodies(e){let{props:t,type:n,uuid:r}=e;this.worker.postMessage({op:"addBodies",props:t,type:n,uuid:r})}addConstraint(e){let{props:[t,n,r],type:s,uuid:o}=e;this.worker.postMessage({op:"addConstraint",props:[t,n,r],type:s,uuid:o})}addContactMaterial(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"addContactMaterial",props:t,uuid:n})}addRay(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"addRay",props:t,uuid:n})}addRaycastVehicle(e){let{props:[t,n,r,s,o,a],uuid:l}=e;this.worker.postMessage({op:"addRaycastVehicle",props:[t,n,r,s,o,a],uuid:l})}addSpring(e){let{props:[t,n,r],uuid:s}=e;this.worker.postMessage({op:"addSpring",props:[t,n,r],uuid:s})}applyForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyForce",props:t,uuid:n})}applyImpulse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyImpulse",props:t,uuid:n})}applyLocalForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyLocalForce",props:t,uuid:n})}applyLocalImpulse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}applyTorque(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyTorque",props:t,uuid:n})}disableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraintMotor",uuid:t})}enableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:r,gravity:s,iterations:o,quatNormalizeFast:a,quatNormalizeSkip:l,solver:c,tolerance:g}=this.config;this.worker.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:r,gravity:s,iterations:o,quatNormalizeFast:a,quatNormalizeSkip:l,solver:c,tolerance:g}})}removeBodies(e){let{uuid:t}=e;this.worker.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.worker.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.worker.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAllowSleep",props:t,uuid:n})}setAngularDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularDamping",props:t,uuid:n})}setAngularFactor(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularFactor",props:t,uuid:n})}setAngularVelocity(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularVelocity",props:t,uuid:n})}setCollisionFilterGroup(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}setCollisionFilterMask(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}setCollisionResponse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionResponse",props:t,uuid:n})}setConstraintMotorMaxForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}setConstraintMotorSpeed(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}setFixedRotation(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setFixedRotation",props:t,uuid:n})}setIsTrigger(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setIsTrigger",props:t,uuid:n})}setLinearDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setLinearDamping",props:t,uuid:n})}setLinearFactor(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setLinearFactor",props:t,uuid:n})}setMass(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setMass",props:t,uuid:n})}setMaterial(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setMaterial",props:t,uuid:n})}setPosition(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setPosition",props:t,uuid:n})}setQuaternion(e){let{props:[t,n,r,s],uuid:o}=e;this.worker.postMessage({op:"setQuaternion",props:[t,n,r,s],uuid:o})}setRaycastVehicleBrake(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}setRotation(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRotation",props:t,uuid:n})}setSleepSpeedLimit(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}setSleepTimeLimit(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}setSpringDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringDamping",props:t,uuid:n})}setSpringRestLength(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringRestLength",props:t,uuid:n})}setSpringStiffness(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringStiffness",props:t,uuid:n})}setUserData(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setUserData",props:t,uuid:n})}setVelocity(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setVelocity",props:t,uuid:n})}sleep(e){let{uuid:t}=e;this.worker.postMessage({op:"sleep",uuid:t})}step(e){const{buffers:{positions:t,quaternions:n}}=this;!t.byteLength&&!n.byteLength||this.worker.postMessage({op:"step",positions:t,props:e,quaternions:n},[t.buffer,n.buffer])}subscribe(e){let{props:{id:t,target:n,type:r},uuid:s}=e;this.worker.postMessage({op:"subscribe",props:{id:t,target:n,type:r},uuid:s})}terminate(){this.worker.terminate()}unsubscribe(e){let{props:t}=e;this.worker.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.worker.postMessage({op:"wakeUp",uuid:t})}}class fl{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new se);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new se);const n=this.elements,r=e.x,s=e.y,o=e.z;return t.x=n[0]*r+n[1]*s+n[2]*o,t.y=n[3]*r+n[4]*s+n[5]*o,t.z=n[6]*r+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new fl);const n=this.elements,r=e.elements,s=t.elements,o=n[0],a=n[1],l=n[2],c=n[3],g=n[4],d=n[5],u=n[6],h=n[7],p=n[8],b=r[0],y=r[1],m=r[2],f=r[3],G=r[4],x=r[5],B=r[6],M=r[7],E=r[8];return s[0]=o*b+a*f+l*B,s[1]=o*y+a*G+l*M,s[2]=o*m+a*x+l*E,s[3]=c*b+g*f+d*B,s[4]=c*y+g*G+d*M,s[5]=c*m+g*x+d*E,s[6]=u*b+h*f+p*B,s[7]=u*y+h*G+p*M,s[8]=u*m+h*x+p*E,t}scale(e,t){t===void 0&&(t=new fl);const n=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*n[3*s+0],r[3*s+1]=e.y*n[3*s+1],r[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new se);const n=3,r=4,s=[];let o,a;for(o=0;o<n*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const c=l;let g;const d=4;let u;do{if(o=c-l,s[o+r*o]===0){for(a=o+1;a<c;a++)if(s[o+r*a]!==0){g=d;do u=d-g,s[u+r*o]+=s[u+r*a];while(--g);break}}if(s[o+r*o]!==0)for(a=o+1;a<c;a++){const h=s[o+r*a]/s[o+r*o];g=d;do u=d-g,s[u+r*a]=u<=o?0:s[u+r*a]-s[u+r*o]*h;while(--g)}}while(--l);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new fl);const t=3,n=6,r=fpe;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+n*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let c;const g=n;let d;do{if(s=l-a,r[s+n*s]===0){for(o=s+1;o<l;o++)if(r[s+n*o]!==0){c=g;do d=g-c,r[d+n*s]+=r[d+n*o];while(--c);break}}if(r[s+n*s]!==0)for(o=s+1;o<l;o++){const u=r[s+n*o]/r[s+n*s];c=g;do d=g-c,r[d+n*o]=d<=s?0:r[d+n*o]-r[d+n*s]*u;while(--c)}}while(--a);s=2;do{o=s-1;do{const u=r[s+n*o]/r[s+n*s];c=n;do d=n-c,r[d+n*o]=r[d+n*o]-r[d+n*s]*u;while(--c)}while(o--)}while(--s);s=2;do{const u=1/r[s+n*s];c=n;do d=n-c,r[d+n*s]=r[d+n*s]*u;while(--c)}while(s--);s=2;do{o=2;do{if(d=r[t+o+n*s],isNaN(d)||d===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,d)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,r=e.z,s=e.w,o=t+t,a=n+n,l=r+r,c=t*o,g=t*a,d=t*l,u=n*a,h=n*l,p=r*l,b=s*o,y=s*a,m=s*l,f=this.elements;return f[3*0+0]=1-(u+p),f[3*0+1]=g-m,f[3*0+2]=d+y,f[3*1+0]=g+m,f[3*1+1]=1-(c+p),f[3*1+2]=h-b,f[3*2+0]=d-y,f[3*2+1]=h+b,f[3*2+2]=1-(c+u),this}transpose(e){e===void 0&&(e=new fl);const t=this.elements,n=e.elements;let r;return n[0]=t[0],n[4]=t[4],n[8]=t[8],r=t[1],n[1]=t[3],n[3]=r,r=t[2],n[2]=t[6],n[6]=r,r=t[5],n[5]=t[7],n[7]=r,e}}const fpe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class se{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new se);const n=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return t.x=a*s-l*r,t.y=l*n-o*s,t.z=o*r-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new se(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new se(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new fl([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,r=Math.sqrt(e*e+t*t+n*n);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new se);const t=this.x,n=this.y,r=this.z;let s=Math.sqrt(t*t+n*n+r*r);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(a-r)*(a-r))}distanceSquared(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new se);const n=this.x,r=this.y,s=this.z;return t.x=e*n,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new se),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new se),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new se),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const r=Ipe,s=1/n;r.set(this.x*s,this.y*s,this.z*s);const o=Cpe;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const r=this.x,s=this.y,o=this.z;n.x=r+(e.x-r)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(VY),VY.almostEquals(e,t)}clone(){return new se(this.x,this.y,this.z)}}se.ZERO=new se(0,0,0);se.UNIT_X=new se(1,0,0);se.UNIT_Y=new se(0,1,0);se.UNIT_Z=new se(0,0,1);const Ipe=new se,Cpe=new se,VY=new se;class to{constructor(e){e===void 0&&(e={}),this.lowerBound=new se,this.upperBound=new se,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,r){const s=this.lowerBound,o=this.upperBound,a=n;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,NY),c=NY),c.x>o.x&&(o.x=c.x),c.x<s.x&&(s.x=c.x),c.y>o.y&&(o.y=c.y),c.y<s.y&&(s.y=c.y),c.z>o.z&&(o.z=c.z),c.z<s.z&&(s.z=c.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new to().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,a=r.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,l=r.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&n.x>=s.x&&t.y<=r.y&&n.y>=s.y&&t.z<=r.z&&n.z>=s.z}getCorners(e,t,n,r,s,o,a,l){const c=this.lowerBound,g=this.upperBound;e.copy(c),t.set(g.x,c.y,c.z),n.set(g.x,g.y,c.z),r.set(c.x,g.y,g.z),s.set(g.x,c.y,g.z),o.set(c.x,g.y,c.z),a.set(c.x,c.y,g.z),l.copy(g)}toLocalFrame(e,t){const n=EY,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7];this.getCorners(r,s,o,a,l,c,g,d);for(let u=0;u!==8;u++){const h=n[u];e.pointToLocal(h,h)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=EY,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7];this.getCorners(r,s,o,a,l,c,g,d);for(let u=0;u!==8;u++){const h=n[u];e.pointToWorld(h,h)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-n.x)*r,l=(this.upperBound.x-n.x)*r,c=(this.lowerBound.y-n.y)*s,g=(this.upperBound.y-n.y)*s,d=(this.lowerBound.z-n.z)*o,u=(this.upperBound.z-n.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(c,g)),Math.min(d,u)),p=Math.min(Math.min(Math.max(a,l),Math.max(c,g)),Math.max(d,u));return!(p<0||h>p)}}const NY=new se,EY=[new se,new se,new se,new se,new se,new se,new se,new se];class zr{constructor(e,t,n,r){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new se),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=ppe,r=mpe;e.tangents(n,r),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new zr);const n=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,c=e.z,g=e.w;return t.x=n*g+o*a+r*c-s*l,t.y=r*g+o*l+s*a-n*c,t.z=s*g+o*c+n*l-r*a,t.w=o*g-n*a-r*l-s*c,t}inverse(e){e===void 0&&(e=new zr);const t=this.x,n=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new zr),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new se);const n=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,c=this.w,g=c*n+a*s-l*r,d=c*r+l*n-o*s,u=c*s+o*r-a*n,h=-o*n-a*r-l*s;return t.x=g*c+h*-o+d*-l-u*-a,t.y=d*c+h*-a+u*-o-g*-l,t.z=u*c+h*-l+g*-a-d*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,r,s;const o=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":const g=o*a+l*c;if(g>.499&&(n=2*Math.atan2(o,c),r=Math.PI/2,s=0),g<-.499&&(n=-2*Math.atan2(o,c),r=-Math.PI/2,s=0),n===void 0){const d=o*o,u=a*a,h=l*l;n=Math.atan2(2*a*c-2*o*l,1-2*u-2*h),r=Math.asin(2*g),s=Math.atan2(2*o*c-2*a*l,1-2*d-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=r,e.x=s}setFromEuler(e,t,n,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(n/2),l=Math.sin(e/2),c=Math.sin(t/2),g=Math.sin(n/2);return r==="XYZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="YXZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="ZXY"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="ZYX"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="YZX"?(this.x=l*o*a+s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a-l*c*g):r==="XZY"&&(this.x=l*o*a-s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a+l*c*g),this}clone(){return new zr(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new zr);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,c=e.y,g=e.z,d=e.w,u,h,p,b,y;return h=r*l+s*c+o*g+a*d,h<0&&(h=-h,l=-l,c=-c,g=-g,d=-d),1-h>1e-6?(u=Math.acos(h),p=Math.sin(u),b=Math.sin((1-t)*u)/p,y=Math.sin(t*u)/p):(b=1-t,y=t),n.x=b*r+y*l,n.y=b*s+y*c,n.z=b*o+y*g,n.w=b*a+y*d,n}integrate(e,t,n,r){r===void 0&&(r=new zr);const s=e.x*n.x,o=e.y*n.y,a=e.z*n.z,l=this.x,c=this.y,g=this.z,d=this.w,u=t*.5;return r.x+=u*(s*d+o*g-a*c),r.y+=u*(o*d+a*l-s*g),r.z+=u*(a*d+s*c-o*l),r.w+=u*(-s*l-o*c-a*g),r}}const ppe=new se,mpe=new se,Ape={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class vt{constructor(e){e===void 0&&(e={}),this.id=vt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}vt.idCounter=0;vt.types=Ape;class cs{constructor(e){e===void 0&&(e={}),this.position=new se,this.quaternion=new zr,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return cs.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return cs.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new se),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,r){return r===void 0&&(r=new se),n.vsub(e,r),t.conjugate(HY),HY.vmult(r,r),r}static pointToWorldFrame(e,t,n,r){return r===void 0&&(r=new se),t.vmult(n,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new se),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,r){return r===void 0&&(r=new se),t.w*=-1,t.vmult(n,r),t.w*=-1,r}}const HY=new zr;new se;new se;new se;new se;new se,new se,new se,new se,new se,new se,new se,new se;new se;new zr;new to;new fl;new fl;new fl;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new zr;new se;new se;new se;new se;class mR{constructor(){this.rayFromWorld=new se,this.rayToWorld=new se,this.hitNormalWorld=new se,this.hitPointWorld=new se,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let FY,LY,TY,XY,zY,kY,YY;const AR={CLOSEST:1,ANY:2,ALL:4};FY=vt.types.SPHERE;LY=vt.types.PLANE;TY=vt.types.BOX;XY=vt.types.CYLINDER;zY=vt.types.CONVEXPOLYHEDRON;kY=vt.types.HEIGHTFIELD;YY=vt.types.TRIMESH;class Br{get[FY](){return this._intersectSphere}get[LY](){return this._intersectPlane}get[TY](){return this._intersectBox}get[XY](){return this._intersectConvex}get[zY](){return this._intersectConvex}get[kY](){return this._intersectHeightfield}get[YY](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new se),t===void 0&&(t=new se),this.from=e.clone(),this.to=t.clone(),this.direction=new se,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Br.ANY,this.result=new mR,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Br.ANY,this.result=t.result||new mR,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask!="undefined"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup!="undefined"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse!="undefined"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(KY),bR.length=0,e.broadphase.aabbQuery(e,KY,bR),this.intersectBodies(bR),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)==0||(e.collisionFilterGroup&this.collisionFilterMask)==0)return;const r=bpe,s=ype;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(n&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,r=e.length;!this.result.shouldStop&&n<r;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,r){const s=this.from;if(Epe(s,this.direction,n)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,n,r,e)}_intersectBox(e,t,n,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,r,s)}_intersectPlane(e,t,n,r,s){const o=this.from,a=this.to,l=this.direction,c=new se(0,0,1);t.vmult(c,c);const g=new se;o.vsub(n,g);const d=g.dot(c);a.vsub(n,g);const u=g.dot(c);if(d*u>0||o.distanceTo(a)<d)return;const h=c.dot(l);if(Math.abs(h)<this.precision)return;const p=new se,b=new se,y=new se;o.vsub(n,p);const m=-c.dot(p)/h;l.scale(m,b),o.vadd(b,y),this.reportIntersection(c,y,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),n.x=Math.max(r.x,s.x),n.y=Math.max(r.y,s.y),n.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,n,r,s){e.data,e.elementSize;const o=vpe;o.from.copy(this.from),o.to.copy(this.to),cs.pointToLocalFrame(n,t,o.from,o.from),cs.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const a=xpe;let l,c,g,d;l=c=0,g=d=e.data.length-1;const u=new to;o.getAABB(u),e.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(u.upperBound.x,u.upperBound.y,a,!0),g=Math.min(g,a[0]+1),d=Math.min(d,a[1]+1);for(let h=l;h<g;h++)for(let p=c;p<d;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,u),!!u.overlapsRay(o)){if(e.getConvexTrianglePillar(h,p,!1),cs.pointToWorldFrame(n,t,e.pillarOffset,jv),this._intersectConvex(e.pillarConvex,t,jv,r,s,PY),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),cs.pointToWorldFrame(n,t,e.pillarOffset,jv),this._intersectConvex(e.pillarConvex,t,jv,r,s,PY)}}}_intersectSphere(e,t,n,r,s){const o=this.from,a=this.to,l=e.radius,c=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,g=2*((a.x-o.x)*(o.x-n.x)+(a.y-o.y)*(o.y-n.y)+(a.z-o.z)*(o.z-n.z)),d=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-l**2,u=g**2-4*c*d,h=wpe,p=Gpe;if(!(u<0))if(u===0)o.lerp(a,u,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1);else{const b=(-g-Math.sqrt(u))/(2*c),y=(-g+Math.sqrt(u))/(2*c);if(b>=0&&b<=1&&(o.lerp(a,b,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(o.lerp(a,y,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1))}}_intersectConvex(e,t,n,r,s,o){const a=Bpe,l=DY,c=o&&o.faceList||null,g=e.faces,d=e.vertices,u=e.faceNormals,h=this.direction,p=this.from,b=this.to,y=p.distanceTo(b),m=c?c.length:g.length,f=this.result;for(let G=0;!f.shouldStop&&G<m;G++){const x=c?c[G]:G,B=g[x],M=u[x],E=t,z=n;l.copy(d[B[0]]),E.vmult(l,l),l.vadd(z,l),l.vsub(p,l),E.vmult(M,a);const J=h.dot(a);if(Math.abs(J)<this.precision)continue;const V=a.dot(l)/J;if(!(V<0)){h.scale(V,gs),gs.vadd(p,gs),Mo.copy(d[B[0]]),E.vmult(Mo,Mo),z.vadd(Mo,Mo);for(let I=1;!f.shouldStop&&I<B.length-1;I++){Ca.copy(d[B[I]]),pa.copy(d[B[I+1]]),E.vmult(Ca,Ca),E.vmult(pa,pa),z.vadd(Ca,Ca),z.vadd(pa,pa);const w=gs.distanceTo(p);!(Br.pointInTriangle(gs,Mo,Ca,pa)||Br.pointInTriangle(gs,Ca,Mo,pa))||w>y||this.reportIntersection(a,gs,s,r,x)}}}}_intersectTrimesh(e,t,n,r,s,o){const a=Spe,l=Vpe,c=Npe,g=DY,d=Zpe,u=Rpe,h=Mpe,p=_pe,b=Wpe,y=e.indices;e.vertices;const m=this.from,f=this.to,G=this.direction;c.position.copy(n),c.quaternion.copy(t),cs.vectorToLocalFrame(n,t,G,d),cs.pointToLocalFrame(n,t,m,u),cs.pointToLocalFrame(n,t,f,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,h.vsub(u,d),d.normalize();const x=u.distanceSquared(h);e.tree.rayQuery(this,c,l);for(let B=0,M=l.length;!this.result.shouldStop&&B!==M;B++){const E=l[B];e.getNormal(E,a),e.getVertex(y[E*3],Mo),Mo.vsub(u,g);const z=d.dot(a),J=a.dot(g)/z;if(J<0)continue;d.scale(J,gs),gs.vadd(u,gs),e.getVertex(y[E*3+1],Ca),e.getVertex(y[E*3+2],pa);const V=gs.distanceSquared(u);!(Br.pointInTriangle(gs,Ca,Mo,pa)||Br.pointInTriangle(gs,Mo,Ca,pa))||V>x||(cs.vectorToWorldFrame(t,a,b),cs.pointToWorldFrame(n,t,gs,p),this.reportIntersection(b,p,s,r,E))}l.length=0}reportIntersection(e,t,n,r,s){const o=this.from,a=this.to,l=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof s!="undefined"?s:-1,this.mode){case Br.ALL:this.hasHit=!0,c.set(o,a,e,t,n,r,l),c.hasHit=!0,this.callback(c);break;case Br.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,n,r,l));break;case Br.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,n,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,n,r){r.vsub(t,Zu),n.vsub(t,l0),e.vsub(t,yR);const s=Zu.dot(Zu),o=Zu.dot(l0),a=Zu.dot(yR),l=l0.dot(l0),c=l0.dot(yR);let g,d;return(g=l*a-o*c)>=0&&(d=s*c-o*a)>=0&&g+d<s*l-o*o}}Br.CLOSEST=AR.CLOSEST;Br.ANY=AR.ANY;Br.ALL=AR.ALL;const KY=new to,bR=[],l0=new se,yR=new se,bpe=new se,ype=new zr,gs=new se,Mo=new se,Ca=new se,pa=new se;new se;new mR;const PY={faceList:[0]},jv=new se,vpe=new Br,xpe=[],wpe=new se,Gpe=new se,Bpe=new se;new se;new se;const DY=new se,Spe=new se,Zpe=new se,Rpe=new se,Mpe=new se,Wpe=new se,_pe=new se;new to;const Vpe=[],Npe=new cs,Zu=new se,qv=new se;function Epe(i,e,t){t.vsub(i,Zu);const n=Zu.dot(e);return e.scale(n,qv),qv.vadd(i,qv),t.distanceTo(qv)}new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new Br;new se;new se;new se;new se(1,0,0),new se(0,1,0),new se(0,0,1);new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new to;new se;new to;new se;new se;new se;new se;new se;new se;new se;new to;new se;new cs;new to;vt.types.SPHERE,vt.types.SPHERE|vt.types.PLANE,vt.types.BOX|vt.types.BOX,vt.types.SPHERE|vt.types.BOX,vt.types.PLANE|vt.types.BOX,vt.types.CONVEXPOLYHEDRON,vt.types.SPHERE|vt.types.CONVEXPOLYHEDRON,vt.types.PLANE|vt.types.CONVEXPOLYHEDRON,vt.types.BOX|vt.types.CONVEXPOLYHEDRON,vt.types.SPHERE|vt.types.HEIGHTFIELD,vt.types.BOX|vt.types.HEIGHTFIELD,vt.types.CONVEXPOLYHEDRON|vt.types.HEIGHTFIELD,vt.types.PARTICLE|vt.types.SPHERE,vt.types.PLANE|vt.types.PARTICLE,vt.types.BOX|vt.types.PARTICLE,vt.types.PARTICLE|vt.types.CONVEXPOLYHEDRON,vt.types.CYLINDER,vt.types.SPHERE|vt.types.CYLINDER,vt.types.PLANE|vt.types.CYLINDER,vt.types.BOX|vt.types.CYLINDER,vt.types.CONVEXPOLYHEDRON|vt.types.CYLINDER,vt.types.HEIGHTFIELD|vt.types.CYLINDER,vt.types.PARTICLE|vt.types.CYLINDER,vt.types.SPHERE|vt.types.TRIMESH,vt.types.PLANE|vt.types.TRIMESH;new se;new se;new se;new se;new se;new zr;new zr;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new to;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se,new se,new se,new se,new se,new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new zr;new se;new se;new se;new se;new se;new se;new se;new se;new se;new to;new Br;const c0=globalThis.performance||{};if(!c0.now){let i=Date.now();c0.timing&&c0.timing.navigationStart&&(i=c0.timing.navigationStart),c0.now=()=>Date.now()-i}new se;const UY=ue.exports.createContext(null),Hpe=()=>{const i=ue.exports.useContext(UY);if(!i)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return i},Fpe=new fe,Lpe=new fe(1,1,1),Tpe=new rr,$v=new Vt;function OY(i,e,t,n){return i!==void 0?($v.compose(Fpe.fromArray(e,i*3),Tpe.fromArray(t,i*4),n?n.scale:Lpe),n&&(n.matrixAutoUpdate=!1,n.matrix.copy($v)),$v):$v.identity()}const Xpe=i=>{let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:r,defaultContactMaterial:s={contactEquationStiffness:1e6},gravity:o=[0,-9.81,0],isPaused:a=!1,iterations:l=5,maxSubSteps:c=10,quatNormalizeFast:g=!1,quatNormalizeSkip:d=0,shouldInvalidate:u=!0,size:h=1e3,solver:p="GS",stepSize:b=1/60,tolerance:y=.001}=i;const{invalidate:m}=Wce(),[{bodies:f,events:G,refs:x,subscriptions:B,worker:M}]=ue.exports.useState(()=>({bodies:{},events:{},refs:{},subscriptions:{},worker:new hpe({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:s,gravity:o,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:d,size:h,solver:p,tolerance:y})}));let E=0;const z=ue.exports.useCallback((W,H)=>{a||(E+=H,M.step({maxSubSteps:c,stepSize:b,timeSinceLastCalled:E}),E=0)},[a,c,b]),J=W=>{var H;let O=W,{body:k,contact:Y}=O,ee=Y,{bi:_,bj:Z}=ee,T=Gt(ee,["bi","bj"]),ye=O,{target:F}=ye,K=Gt(ye,["body","contact","target"]);const j=(H=G[F])==null?void 0:H.collide;j&&j(Oe({body:x[k],contact:Oe({bi:x[_],bj:x[Z]},T),target:x[F]},K))},V=W=>{var H,k;let{bodyA:_,bodyB:Z}=W;const T=(H=G[_])==null?void 0:H.collideBegin;T&&T({body:x[Z],op:"event",target:x[_],type:"collideBegin"});const F=(k=G[Z])==null?void 0:k.collideBegin;F&&F({body:x[_],op:"event",target:x[Z],type:"collideBegin"})},I=W=>{var H,k;let{bodyA:_,bodyB:Z}=W;const T=(H=G[_])==null?void 0:H.collideEnd;T&&T({body:x[Z],op:"event",target:x[_],type:"collideEnd"});const F=(k=G[Z])==null?void 0:k.collideEnd;F&&F({body:x[_],op:"event",target:x[Z],type:"collideEnd"})},w=W=>{let{active:H,bodies:k=[],observations:_,positions:Z,quaternions:T}=W;for(let F=0;F<k.length;F++)f[k[F]]=F;if(_.forEach(F=>{let[K,j,O]=F;const ee=(B[K]||{})[O];ee&&ee(j)}),H){for(const F of Object.values(x))if(F instanceof qp)for(let K=0;K<F.count;K++){const j=f[`${F.uuid}/${K}`];j!==void 0&&F.setMatrixAt(K,OY(j,Z,T)),F.instanceMatrix.needsUpdate=!0}else OY(f[F.uuid],Z,T,F);u&&m()}},S=W=>{var H;let K=W,{body:k,ray:j}=K,O=j,{uuid:_}=O,Z=Gt(O,["uuid"]),T=Gt(K,["body","ray"]);const F=(H=G[_])==null?void 0:H.rayhit;F&&F(Oe({body:k?x[k]:null,ray:Oe({uuid:_},Z)},T))};_ce(z),ue.exports.useLayoutEffect(()=>(M.init(),M.on("collide",J),M.on("collideBegin",V),M.on("collideEnd",I),M.on("frame",w),M.on("rayhit",S),()=>{M.terminate(),M.removeAllListeners()}),[]),ue.exports.useEffect(()=>{M.axisIndex=t},[t]),ue.exports.useEffect(()=>{M.broadphase=n},[n]),ue.exports.useEffect(()=>{M.gravity=o},[o]),ue.exports.useEffect(()=>{M.iterations=l},[l]),ue.exports.useEffect(()=>{M.tolerance=y},[y]);const R=ue.exports.useMemo(()=>({bodies:f,events:G,refs:x,subscriptions:B,worker:M}),[f,G,x,B,M]);return $e(UY.Provider,{value:R,children:r})};class Il{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new oe);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new oe);const n=this.elements,r=e.x,s=e.y,o=e.z;return t.x=n[0]*r+n[1]*s+n[2]*o,t.y=n[3]*r+n[4]*s+n[5]*o,t.z=n[6]*r+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Il);const n=this.elements,r=e.elements,s=t.elements,o=n[0],a=n[1],l=n[2],c=n[3],g=n[4],d=n[5],u=n[6],h=n[7],p=n[8],b=r[0],y=r[1],m=r[2],f=r[3],G=r[4],x=r[5],B=r[6],M=r[7],E=r[8];return s[0]=o*b+a*f+l*B,s[1]=o*y+a*G+l*M,s[2]=o*m+a*x+l*E,s[3]=c*b+g*f+d*B,s[4]=c*y+g*G+d*M,s[5]=c*m+g*x+d*E,s[6]=u*b+h*f+p*B,s[7]=u*y+h*G+p*M,s[8]=u*m+h*x+p*E,t}scale(e,t){t===void 0&&(t=new Il);const n=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*n[3*s+0],r[3*s+1]=e.y*n[3*s+1],r[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new oe);const n=3,r=4,s=[];let o,a;for(o=0;o<n*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const c=l;let g;const d=4;let u;do{if(o=c-l,s[o+r*o]===0){for(a=o+1;a<c;a++)if(s[o+r*a]!==0){g=d;do u=d-g,s[u+r*o]+=s[u+r*a];while(--g);break}}if(s[o+r*o]!==0)for(a=o+1;a<c;a++){const h=s[o+r*a]/s[o+r*o];g=d;do u=d-g,s[u+r*a]=u<=o?0:s[u+r*a]-s[u+r*o]*h;while(--g)}}while(--l);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new Il);const t=3,n=6,r=zpe;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+n*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let c;const g=n;let d;do{if(s=l-a,r[s+n*s]===0){for(o=s+1;o<l;o++)if(r[s+n*o]!==0){c=g;do d=g-c,r[d+n*s]+=r[d+n*o];while(--c);break}}if(r[s+n*s]!==0)for(o=s+1;o<l;o++){const u=r[s+n*o]/r[s+n*s];c=g;do d=g-c,r[d+n*o]=d<=s?0:r[d+n*o]-r[d+n*s]*u;while(--c)}}while(--a);s=2;do{o=s-1;do{const u=r[s+n*o]/r[s+n*s];c=n;do d=n-c,r[d+n*o]=r[d+n*o]-r[d+n*s]*u;while(--c)}while(o--)}while(--s);s=2;do{const u=1/r[s+n*s];c=n;do d=n-c,r[d+n*s]=r[d+n*s]*u;while(--c)}while(s--);s=2;do{o=2;do{if(d=r[t+o+n*s],isNaN(d)||d===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,d)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,r=e.z,s=e.w,o=t+t,a=n+n,l=r+r,c=t*o,g=t*a,d=t*l,u=n*a,h=n*l,p=r*l,b=s*o,y=s*a,m=s*l,f=this.elements;return f[3*0+0]=1-(u+p),f[3*0+1]=g-m,f[3*0+2]=d+y,f[3*1+0]=g+m,f[3*1+1]=1-(c+p),f[3*1+2]=h-b,f[3*2+0]=d-y,f[3*2+1]=h+b,f[3*2+2]=1-(c+u),this}transpose(e){e===void 0&&(e=new Il);const t=this.elements,n=e.elements;let r;return n[0]=t[0],n[4]=t[4],n[8]=t[8],r=t[1],n[1]=t[3],n[3]=r,r=t[2],n[2]=t[6],n[6]=r,r=t[5],n[5]=t[7],n[7]=r,e}}const zpe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class oe{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new oe);const n=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return t.x=a*s-l*r,t.y=l*n-o*s,t.z=o*r-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new oe(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new oe(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Il([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,r=Math.sqrt(e*e+t*t+n*n);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new oe);const t=this.x,n=this.y,r=this.z;let s=Math.sqrt(t*t+n*n+r*r);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(a-r)*(a-r))}distanceSquared(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new oe);const n=this.x,r=this.y,s=this.z;return t.x=e*n,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new oe),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new oe),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new oe),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const r=kpe,s=1/n;r.set(this.x*s,this.y*s,this.z*s);const o=Ype;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const r=this.x,s=this.y,o=this.z;n.x=r+(e.x-r)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(JY),JY.almostEquals(e,t)}clone(){return new oe(this.x,this.y,this.z)}}oe.ZERO=new oe(0,0,0);oe.UNIT_X=new oe(1,0,0);oe.UNIT_Y=new oe(0,1,0);oe.UNIT_Z=new oe(0,0,1);const kpe=new oe,Ype=new oe,JY=new oe;class no{constructor(e){e===void 0&&(e={}),this.lowerBound=new oe,this.upperBound=new oe,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,r){const s=this.lowerBound,o=this.upperBound,a=n;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,QY),c=QY),c.x>o.x&&(o.x=c.x),c.x<s.x&&(s.x=c.x),c.y>o.y&&(o.y=c.y),c.y<s.y&&(s.y=c.y),c.z>o.z&&(o.z=c.z),c.z<s.z&&(s.z=c.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new no().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,a=r.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,l=r.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&n.x>=s.x&&t.y<=r.y&&n.y>=s.y&&t.z<=r.z&&n.z>=s.z}getCorners(e,t,n,r,s,o,a,l){const c=this.lowerBound,g=this.upperBound;e.copy(c),t.set(g.x,c.y,c.z),n.set(g.x,g.y,c.z),r.set(c.x,g.y,g.z),s.set(g.x,c.y,g.z),o.set(c.x,g.y,c.z),a.set(c.x,c.y,g.z),l.copy(g)}toLocalFrame(e,t){const n=jY,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7];this.getCorners(r,s,o,a,l,c,g,d);for(let u=0;u!==8;u++){const h=n[u];e.pointToLocal(h,h)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=jY,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],g=n[6],d=n[7];this.getCorners(r,s,o,a,l,c,g,d);for(let u=0;u!==8;u++){const h=n[u];e.pointToWorld(h,h)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-n.x)*r,l=(this.upperBound.x-n.x)*r,c=(this.lowerBound.y-n.y)*s,g=(this.upperBound.y-n.y)*s,d=(this.lowerBound.z-n.z)*o,u=(this.upperBound.z-n.z)*o,h=Math.max(Math.max(Math.min(a,l),Math.min(c,g)),Math.min(d,u)),p=Math.min(Math.min(Math.max(a,l),Math.max(c,g)),Math.max(d,u));return!(p<0||h>p)}}const QY=new oe,jY=[new oe,new oe,new oe,new oe,new oe,new oe,new oe,new oe];class kr{constructor(e,t,n,r){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new oe),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=Kpe,r=Ppe;e.tangents(n,r),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new kr);const n=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,c=e.z,g=e.w;return t.x=n*g+o*a+r*c-s*l,t.y=r*g+o*l+s*a-n*c,t.z=s*g+o*c+n*l-r*a,t.w=o*g-n*a-r*l-s*c,t}inverse(e){e===void 0&&(e=new kr);const t=this.x,n=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new kr),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new oe);const n=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,c=this.w,g=c*n+a*s-l*r,d=c*r+l*n-o*s,u=c*s+o*r-a*n,h=-o*n-a*r-l*s;return t.x=g*c+h*-o+d*-l-u*-a,t.y=d*c+h*-a+u*-o-g*-l,t.z=u*c+h*-l+g*-a-d*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,r,s;const o=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":const g=o*a+l*c;if(g>.499&&(n=2*Math.atan2(o,c),r=Math.PI/2,s=0),g<-.499&&(n=-2*Math.atan2(o,c),r=-Math.PI/2,s=0),n===void 0){const d=o*o,u=a*a,h=l*l;n=Math.atan2(2*a*c-2*o*l,1-2*u-2*h),r=Math.asin(2*g),s=Math.atan2(2*o*c-2*a*l,1-2*d-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=r,e.x=s}setFromEuler(e,t,n,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(n/2),l=Math.sin(e/2),c=Math.sin(t/2),g=Math.sin(n/2);return r==="XYZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="YXZ"?(this.x=l*o*a+s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="ZXY"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a-l*c*g):r==="ZYX"?(this.x=l*o*a-s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a+l*c*g):r==="YZX"?(this.x=l*o*a+s*c*g,this.y=s*c*a+l*o*g,this.z=s*o*g-l*c*a,this.w=s*o*a-l*c*g):r==="XZY"&&(this.x=l*o*a-s*c*g,this.y=s*c*a-l*o*g,this.z=s*o*g+l*c*a,this.w=s*o*a+l*c*g),this}clone(){return new kr(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new kr);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,c=e.y,g=e.z,d=e.w,u,h,p,b,y;return h=r*l+s*c+o*g+a*d,h<0&&(h=-h,l=-l,c=-c,g=-g,d=-d),1-h>1e-6?(u=Math.acos(h),p=Math.sin(u),b=Math.sin((1-t)*u)/p,y=Math.sin(t*u)/p):(b=1-t,y=t),n.x=b*r+y*l,n.y=b*s+y*c,n.z=b*o+y*g,n.w=b*a+y*d,n}integrate(e,t,n,r){r===void 0&&(r=new kr);const s=e.x*n.x,o=e.y*n.y,a=e.z*n.z,l=this.x,c=this.y,g=this.z,d=this.w,u=t*.5;return r.x+=u*(s*d+o*g-a*c),r.y+=u*(o*d+a*l-s*g),r.z+=u*(a*d+s*c-o*l),r.w+=u*(-s*l-o*c-a*g),r}}const Kpe=new oe,Ppe=new oe,Dpe={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class xt{constructor(e){e===void 0&&(e={}),this.id=xt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}xt.idCounter=0;xt.types=Dpe;class us{constructor(e){e===void 0&&(e={}),this.position=new oe,this.quaternion=new kr,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return us.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return us.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new oe),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,r){return r===void 0&&(r=new oe),n.vsub(e,r),t.conjugate(qY),qY.vmult(r,r),r}static pointToWorldFrame(e,t,n,r){return r===void 0&&(r=new oe),t.vmult(n,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new oe),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,r){return r===void 0&&(r=new oe),t.w*=-1,t.vmult(n,r),t.w*=-1,r}}const qY=new kr;new oe;new oe;new oe;new oe;new oe,new oe,new oe,new oe,new oe,new oe,new oe,new oe;new oe;new kr;new no;new Il;new Il;new Il;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new kr;new oe;new oe;new oe;new oe;class vR{constructor(){this.rayFromWorld=new oe,this.rayToWorld=new oe,this.hitNormalWorld=new oe,this.hitPointWorld=new oe,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let $Y,eK,tK,nK,iK,rK,sK;const xR={CLOSEST:1,ANY:2,ALL:4};$Y=xt.types.SPHERE;eK=xt.types.PLANE;tK=xt.types.BOX;nK=xt.types.CYLINDER;iK=xt.types.CONVEXPOLYHEDRON;rK=xt.types.HEIGHTFIELD;sK=xt.types.TRIMESH;class Sr{get[$Y](){return this._intersectSphere}get[eK](){return this._intersectPlane}get[tK](){return this._intersectBox}get[nK](){return this._intersectConvex}get[iK](){return this._intersectConvex}get[rK](){return this._intersectHeightfield}get[sK](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new oe),t===void 0&&(t=new oe),this.from=e.clone(),this.to=t.clone(),this.direction=new oe,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Sr.ANY,this.result=new vR,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Sr.ANY,this.result=t.result||new vR,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask!="undefined"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup!="undefined"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse!="undefined"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(oK),wR.length=0,e.broadphase.aabbQuery(e,oK,wR),this.intersectBodies(wR),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)==0||(e.collisionFilterGroup&this.collisionFilterMask)==0)return;const r=Upe,s=Ope;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(n&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,r=e.length;!this.result.shouldStop&&n<r;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,r){const s=this.from;if(l0e(s,this.direction,n)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,n,r,e)}_intersectBox(e,t,n,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,r,s)}_intersectPlane(e,t,n,r,s){const o=this.from,a=this.to,l=this.direction,c=new oe(0,0,1);t.vmult(c,c);const g=new oe;o.vsub(n,g);const d=g.dot(c);a.vsub(n,g);const u=g.dot(c);if(d*u>0||o.distanceTo(a)<d)return;const h=c.dot(l);if(Math.abs(h)<this.precision)return;const p=new oe,b=new oe,y=new oe;o.vsub(n,p);const m=-c.dot(p)/h;l.scale(m,b),o.vadd(b,y),this.reportIntersection(c,y,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),n.x=Math.max(r.x,s.x),n.y=Math.max(r.y,s.y),n.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,n,r,s){e.data,e.elementSize;const o=Jpe;o.from.copy(this.from),o.to.copy(this.to),us.pointToLocalFrame(n,t,o.from,o.from),us.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const a=Qpe;let l,c,g,d;l=c=0,g=d=e.data.length-1;const u=new no;o.getAABB(u),e.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(u.upperBound.x,u.upperBound.y,a,!0),g=Math.min(g,a[0]+1),d=Math.min(d,a[1]+1);for(let h=l;h<g;h++)for(let p=c;p<d;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,u),!!u.overlapsRay(o)){if(e.getConvexTrianglePillar(h,p,!1),us.pointToWorldFrame(n,t,e.pillarOffset,ex),this._intersectConvex(e.pillarConvex,t,ex,r,s,aK),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),us.pointToWorldFrame(n,t,e.pillarOffset,ex),this._intersectConvex(e.pillarConvex,t,ex,r,s,aK)}}}_intersectSphere(e,t,n,r,s){const o=this.from,a=this.to,l=e.radius,c=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,g=2*((a.x-o.x)*(o.x-n.x)+(a.y-o.y)*(o.y-n.y)+(a.z-o.z)*(o.z-n.z)),d=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-l**2,u=g**2-4*c*d,h=jpe,p=qpe;if(!(u<0))if(u===0)o.lerp(a,u,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1);else{const b=(-g-Math.sqrt(u))/(2*c),y=(-g+Math.sqrt(u))/(2*c);if(b>=0&&b<=1&&(o.lerp(a,b,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(o.lerp(a,y,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,s,r,-1))}}_intersectConvex(e,t,n,r,s,o){const a=$pe,l=lK,c=o&&o.faceList||null,g=e.faces,d=e.vertices,u=e.faceNormals,h=this.direction,p=this.from,b=this.to,y=p.distanceTo(b),m=c?c.length:g.length,f=this.result;for(let G=0;!f.shouldStop&&G<m;G++){const x=c?c[G]:G,B=g[x],M=u[x],E=t,z=n;l.copy(d[B[0]]),E.vmult(l,l),l.vadd(z,l),l.vsub(p,l),E.vmult(M,a);const J=h.dot(a);if(Math.abs(J)<this.precision)continue;const V=a.dot(l)/J;if(!(V<0)){h.scale(V,ds),ds.vadd(p,ds),Wo.copy(d[B[0]]),E.vmult(Wo,Wo),z.vadd(Wo,Wo);for(let I=1;!f.shouldStop&&I<B.length-1;I++){ma.copy(d[B[I]]),Aa.copy(d[B[I+1]]),E.vmult(ma,ma),E.vmult(Aa,Aa),z.vadd(ma,ma),z.vadd(Aa,Aa);const w=ds.distanceTo(p);!(Sr.pointInTriangle(ds,Wo,ma,Aa)||Sr.pointInTriangle(ds,ma,Wo,Aa))||w>y||this.reportIntersection(a,ds,s,r,x)}}}}_intersectTrimesh(e,t,n,r,s,o){const a=e0e,l=o0e,c=a0e,g=lK,d=t0e,u=n0e,h=i0e,p=s0e,b=r0e,y=e.indices;e.vertices;const m=this.from,f=this.to,G=this.direction;c.position.copy(n),c.quaternion.copy(t),us.vectorToLocalFrame(n,t,G,d),us.pointToLocalFrame(n,t,m,u),us.pointToLocalFrame(n,t,f,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,h.vsub(u,d),d.normalize();const x=u.distanceSquared(h);e.tree.rayQuery(this,c,l);for(let B=0,M=l.length;!this.result.shouldStop&&B!==M;B++){const E=l[B];e.getNormal(E,a),e.getVertex(y[E*3],Wo),Wo.vsub(u,g);const z=d.dot(a),J=a.dot(g)/z;if(J<0)continue;d.scale(J,ds),ds.vadd(u,ds),e.getVertex(y[E*3+1],ma),e.getVertex(y[E*3+2],Aa);const V=ds.distanceSquared(u);!(Sr.pointInTriangle(ds,ma,Wo,Aa)||Sr.pointInTriangle(ds,Wo,ma,Aa))||V>x||(us.vectorToWorldFrame(t,a,b),us.pointToWorldFrame(n,t,ds,p),this.reportIntersection(b,p,s,r,E))}l.length=0}reportIntersection(e,t,n,r,s){const o=this.from,a=this.to,l=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof s!="undefined"?s:-1,this.mode){case Sr.ALL:this.hasHit=!0,c.set(o,a,e,t,n,r,l),c.hasHit=!0,this.callback(c);break;case Sr.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,n,r,l));break;case Sr.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,n,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,n,r){r.vsub(t,Ru),n.vsub(t,g0),e.vsub(t,GR);const s=Ru.dot(Ru),o=Ru.dot(g0),a=Ru.dot(GR),l=g0.dot(g0),c=g0.dot(GR);let g,d;return(g=l*a-o*c)>=0&&(d=s*c-o*a)>=0&&g+d<s*l-o*o}}Sr.CLOSEST=xR.CLOSEST;Sr.ANY=xR.ANY;Sr.ALL=xR.ALL;const oK=new no,wR=[],g0=new oe,GR=new oe,Upe=new oe,Ope=new kr,ds=new oe,Wo=new oe,ma=new oe,Aa=new oe;new oe;new vR;const aK={faceList:[0]},ex=new oe,Jpe=new Sr,Qpe=[],jpe=new oe,qpe=new oe,$pe=new oe;new oe;new oe;const lK=new oe,e0e=new oe,t0e=new oe,n0e=new oe,i0e=new oe,r0e=new oe,s0e=new oe;new no;const o0e=[],a0e=new us,Ru=new oe,tx=new oe;function l0e(i,e,t){t.vsub(i,Ru);const n=Ru.dot(e);return e.scale(n,tx),tx.vadd(i,tx),t.distanceTo(tx)}new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new Sr;new oe;new oe;new oe;new oe(1,0,0),new oe(0,1,0),new oe(0,0,1);new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new no;new oe;new no;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new no;new oe;new us;new no;xt.types.SPHERE,xt.types.SPHERE|xt.types.PLANE,xt.types.BOX|xt.types.BOX,xt.types.SPHERE|xt.types.BOX,xt.types.PLANE|xt.types.BOX,xt.types.CONVEXPOLYHEDRON,xt.types.SPHERE|xt.types.CONVEXPOLYHEDRON,xt.types.PLANE|xt.types.CONVEXPOLYHEDRON,xt.types.BOX|xt.types.CONVEXPOLYHEDRON,xt.types.SPHERE|xt.types.HEIGHTFIELD,xt.types.BOX|xt.types.HEIGHTFIELD,xt.types.CONVEXPOLYHEDRON|xt.types.HEIGHTFIELD,xt.types.PARTICLE|xt.types.SPHERE,xt.types.PLANE|xt.types.PARTICLE,xt.types.BOX|xt.types.PARTICLE,xt.types.PARTICLE|xt.types.CONVEXPOLYHEDRON,xt.types.CYLINDER,xt.types.SPHERE|xt.types.CYLINDER,xt.types.PLANE|xt.types.CYLINDER,xt.types.BOX|xt.types.CYLINDER,xt.types.CONVEXPOLYHEDRON|xt.types.CYLINDER,xt.types.HEIGHTFIELD|xt.types.CYLINDER,xt.types.PARTICLE|xt.types.CYLINDER,xt.types.SPHERE|xt.types.TRIMESH,xt.types.PLANE|xt.types.TRIMESH;new oe;new oe;new oe;new oe;new oe;new kr;new kr;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new no;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe,new oe,new oe,new oe,new oe,new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new kr;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new oe;new no;new Sr;const u0=globalThis.performance||{};if(!u0.now){let i=Date.now();u0.timing&&u0.timing.navigationStart&&(i=u0.timing.navigationStart),u0.now=()=>Date.now()-i}new oe;const c0e=ue.exports.createContext(null),g0e=()=>ue.exports.useContext(c0e);new rr;new fe(1,1,1);new fe;const cK=new fn;function u0e(i){const e=ue.exports.useRef(null);return i&&typeof i!="function"?i:e}function gK(i){return i.charAt(0).toUpperCase()+i.slice(1)}function Zr(i,e){const t=e===void 0?"":`/${e}`;return typeof i=="function"?null:i&&i.current&&`${i.current.uuid}${t}`}const d0e=new Gu,h0e=new rr,f0e=i=>e=>i(d0e.setFromQuaternion(h0e.fromArray(e)).toArray());let uK=0;function BR(i,e,t,n,r,s){return s===void 0&&(s="bodies"),o=>{const a=uK++;t[a]={[n]:o};const l=Zr(i,r);return l&&e.subscribe({props:{id:a,target:s,type:n},uuid:l}),()=>{delete t[a],e.unsubscribe({props:a})}}}function dK(i,e){i.userData=e.userData||{},i.position.set(...e.position||[0,0,0]),i.rotation.set(...e.rotation||[0,0,0]),i.updateMatrix()}function hK(i,e,t){let{onCollide:n,onCollideBegin:r,onCollideEnd:s}=e;i[t]={collide:n,collideBegin:r,collideEnd:s}}function fK(i,e,t,n,r){r===void 0&&(r=[]);const s=u0e(n),{events:o,refs:a,subscriptions:l,worker:c}=Hpe(),g=g0e();ue.exports.useLayoutEffect(()=>{s.current||(s.current=new fn);const u=s.current,h=c,p=u instanceof qp?(u.instanceMatrix.setUsage(Fp),u.count):1,b=u instanceof qp?new Array(p).fill(0).map((m,f)=>`${u.uuid}/${f}`):[u.uuid],y=u instanceof qp?b.map((m,f)=>{const G=e(f);return dK(cK,G),u.setMatrixAt(f,cK.matrix),u.instanceMatrix.needsUpdate=!0,a[m]=u,g==null||g.add(m,G,i),hK(o,G,m),pt(Oe({},G),{args:t(G.args)})}):b.map((m,f)=>{const G=e(f);return dK(u,G),a[m]=u,g==null||g.add(m,G,i),hK(o,G,m),pt(Oe({},G),{args:t(G.args)})});return h.addBodies({props:y.map(m=>{let M=m,{onCollide:f,onCollideBegin:G,onCollideEnd:x}=M,B=Gt(M,["onCollide","onCollideBegin","onCollideEnd"]);return Oe({onCollide:Boolean(f)},B)}),type:i,uuid:b}),()=>{b.forEach(m=>{delete a[m],g==null||g.remove(m),delete o[m]}),h.removeBodies({uuid:b})}},r);const d=ue.exports.useMemo(()=>{const u=(f,G)=>{const x=`set${gK(f)}`;return{set:B=>{const M=Zr(s,G);M&&c[x]({props:B,uuid:M})},subscribe:BR(s,c,l,f,G)}},h=f=>({copy:x=>{let{w:B,x:M,y:E,z}=x;const J=Zr(s,f);J&&c.setQuaternion({props:[M,E,z,B],uuid:J})},set:(x,B,M,E)=>{const z=Zr(s,f);z&&c.setQuaternion({props:[x,B,M,E],uuid:z})},subscribe:BR(s,c,l,"quaternion",f)}),p=f=>({copy:G=>{let{x,y:B,z:M}=G;const E=Zr(s,f);E&&c.setRotation({props:[x,B,M],uuid:E})},set:(G,x,B)=>{const M=Zr(s,f);M&&c.setRotation({props:[G,x,B],uuid:M})},subscribe:G=>{const x=uK++,B="bodies",M="quaternion",E=Zr(s,f);return l[x]={[M]:f0e(G)},E&&c.subscribe({props:{id:x,target:B,type:M},uuid:E}),()=>{delete l[x],c.unsubscribe({props:x})}}}),b=(f,G)=>{const x=`set${gK(f)}`;return{copy:B=>{let{x:M,y:E,z}=B;const J=Zr(s,G);J&&c[x]({props:[M,E,z],uuid:J})},set:(B,M,E)=>{const z=Zr(s,G);z&&c[x]({props:[B,M,E],uuid:z})},subscribe:BR(s,c,l,f,G)}};function y(f){return{allowSleep:u("allowSleep",f),angularDamping:u("angularDamping",f),angularFactor:b("angularFactor",f),angularVelocity:b("angularVelocity",f),applyForce(G,x){const B=Zr(s,f);B&&c.applyForce({props:[G,x],uuid:B})},applyImpulse(G,x){const B=Zr(s,f);B&&c.applyImpulse({props:[G,x],uuid:B})},applyLocalForce(G,x){const B=Zr(s,f);B&&c.applyLocalForce({props:[G,x],uuid:B})},applyLocalImpulse(G,x){const B=Zr(s,f);B&&c.applyLocalImpulse({props:[G,x],uuid:B})},applyTorque(G){const x=Zr(s,f);x&&c.applyTorque({props:[G],uuid:x})},collisionFilterGroup:u("collisionFilterGroup",f),collisionFilterMask:u("collisionFilterMask",f),collisionResponse:u("collisionResponse",f),fixedRotation:u("fixedRotation",f),isTrigger:u("isTrigger",f),linearDamping:u("linearDamping",f),linearFactor:b("linearFactor",f),mass:u("mass",f),material:u("material",f),position:b("position",f),quaternion:h(f),rotation:p(f),sleep(){const G=Zr(s,f);G&&c.sleep({uuid:G})},sleepSpeedLimit:u("sleepSpeedLimit",f),sleepTimeLimit:u("sleepTimeLimit",f),userData:u("userData",f),velocity:b("velocity",f),wakeUp(){const G=Zr(s,f);G&&c.wakeUp({uuid:G})}}}const m={};return pt(Oe({},y(void 0)),{at:f=>m[f]||(m[f]=y(f))})},[]);return[s,d]}function E0e(i,e,t){return e===void 0&&(e=null),fK("Plane",i,()=>[],e,t)}function H0e(i,e,t){return e===void 0&&(e=null),fK("Sphere",i,function(n){if(n===void 0&&(n=[1]),!Array.isArray(n))throw new Error("useSphere args must be an array");return[n[0]]},e,t)}const F0e=i=>$e(ue.exports.Suspense,{fallback:null,children:$e(Xpe,Oe({},i))}),IK={type:"change"},SR={type:"start"},CK={type:"end"};class L0e extends Ja{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new te,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ng.ROTATE,MIDDLE:Ng.DOLLY,RIGHT:Ng.PAN},this.touches={ONE:Eg.ROTATE,TWO:Eg.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(re){re.addEventListener("keydown",q),this._domElementKeyEvents=re},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(IK),n.update(),s=r.NONE},this.update=function(){const re=new te,be=new Zi().setFromUnitVectors(e.up,new te(0,1,0)),_e=be.clone().invert(),Ee=new te,U=new Zi,Fe=2*Math.PI;return function(){const Ye=n.object.position;re.copy(Ye).sub(n.target),re.applyQuaternion(be),a.setFromVector3(re),n.autoRotate&&s===r.NONE&&J(E()),n.enableDamping?(a.theta+=l.theta*n.dampingFactor,a.phi+=l.phi*n.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let me=n.minAzimuthAngle,Ge=n.maxAzimuthAngle;return isFinite(me)&&isFinite(Ge)&&(me<-Math.PI?me+=Fe:me>Math.PI&&(me-=Fe),Ge<-Math.PI?Ge+=Fe:Ge>Math.PI&&(Ge-=Fe),me<=Ge?a.theta=Math.max(me,Math.min(Ge,a.theta)):a.theta=a.theta>(me+Ge)/2?Math.max(me,a.theta):Math.min(Ge,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),n.enableDamping===!0?n.target.addScaledVector(g,n.dampingFactor):n.target.add(g),re.setFromSpherical(a),re.applyQuaternion(_e),Ye.copy(n.target).add(re),n.object.lookAt(n.target),n.enableDamping===!0?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,g.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),g.set(0,0,0)),c=1,d||Ee.distanceToSquared(n.object.position)>o||8*(1-U.dot(n.object.quaternion))>o?(n.dispatchEvent(IK),Ee.copy(n.object.position),U.copy(n.object.quaternion),d=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",ge),n.domElement.removeEventListener("pointerdown",Ie),n.domElement.removeEventListener("pointercancel",Xe),n.domElement.removeEventListener("wheel",et),n.domElement.removeEventListener("pointermove",Be),n.domElement.removeEventListener("pointerup",Re),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",q)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new LZ,l=new LZ;let c=1;const g=new te;let d=!1;const u=new Ke,h=new Ke,p=new Ke,b=new Ke,y=new Ke,m=new Ke,f=new Ke,G=new Ke,x=new Ke,B=[],M={};function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function z(){return Math.pow(.95,n.zoomSpeed)}function J(re){l.theta-=re}function V(re){l.phi-=re}const I=function(){const re=new te;return function(_e,Ee){re.setFromMatrixColumn(Ee,0),re.multiplyScalar(-_e),g.add(re)}}(),w=function(){const re=new te;return function(_e,Ee){n.screenSpacePanning===!0?re.setFromMatrixColumn(Ee,1):(re.setFromMatrixColumn(Ee,0),re.crossVectors(n.object.up,re)),re.multiplyScalar(_e),g.add(re)}}(),S=function(){const re=new te;return function(_e,Ee){const U=n.domElement;if(n.object.isPerspectiveCamera){const Fe=n.object.position;re.copy(Fe).sub(n.target);let Ze=re.length();Ze*=Math.tan(n.object.fov/2*Math.PI/180),I(2*_e*Ze/U.clientHeight,n.object.matrix),w(2*Ee*Ze/U.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(I(_e*(n.object.right-n.object.left)/n.object.zoom/U.clientWidth,n.object.matrix),w(Ee*(n.object.top-n.object.bottom)/n.object.zoom/U.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R(re){n.object.isPerspectiveCamera?c/=re:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*re)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function W(re){n.object.isPerspectiveCamera?c*=re:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/re)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function H(re){u.set(re.clientX,re.clientY)}function k(re){f.set(re.clientX,re.clientY)}function _(re){b.set(re.clientX,re.clientY)}function Z(re){h.set(re.clientX,re.clientY),p.subVectors(h,u).multiplyScalar(n.rotateSpeed);const be=n.domElement;J(2*Math.PI*p.x/be.clientHeight),V(2*Math.PI*p.y/be.clientHeight),u.copy(h),n.update()}function T(re){G.set(re.clientX,re.clientY),x.subVectors(G,f),x.y>0?R(z()):x.y<0&&W(z()),f.copy(G),n.update()}function F(re){y.set(re.clientX,re.clientY),m.subVectors(y,b).multiplyScalar(n.panSpeed),S(m.x,m.y),b.copy(y),n.update()}function K(re){re.deltaY<0?W(z()):re.deltaY>0&&R(z()),n.update()}function j(re){let be=!1;switch(re.code){case n.keys.UP:S(0,n.keyPanSpeed),be=!0;break;case n.keys.BOTTOM:S(0,-n.keyPanSpeed),be=!0;break;case n.keys.LEFT:S(n.keyPanSpeed,0),be=!0;break;case n.keys.RIGHT:S(-n.keyPanSpeed,0),be=!0;break}be&&(re.preventDefault(),n.update())}function O(){if(B.length===1)u.set(B[0].pageX,B[0].pageY);else{const re=.5*(B[0].pageX+B[1].pageX),be=.5*(B[0].pageY+B[1].pageY);u.set(re,be)}}function Y(){if(B.length===1)b.set(B[0].pageX,B[0].pageY);else{const re=.5*(B[0].pageX+B[1].pageX),be=.5*(B[0].pageY+B[1].pageY);b.set(re,be)}}function ee(){const re=B[0].pageX-B[1].pageX,be=B[0].pageY-B[1].pageY,_e=Math.sqrt(re*re+be*be);f.set(0,_e)}function ye(){n.enableZoom&&ee(),n.enablePan&&Y()}function Ce(){n.enableZoom&&ee(),n.enableRotate&&O()}function he(re){if(B.length==1)h.set(re.pageX,re.pageY);else{const _e=we(re),Ee=.5*(re.pageX+_e.x),U=.5*(re.pageY+_e.y);h.set(Ee,U)}p.subVectors(h,u).multiplyScalar(n.rotateSpeed);const be=n.domElement;J(2*Math.PI*p.x/be.clientHeight),V(2*Math.PI*p.y/be.clientHeight),u.copy(h)}function Ne(re){if(B.length===1)y.set(re.pageX,re.pageY);else{const be=we(re),_e=.5*(re.pageX+be.x),Ee=.5*(re.pageY+be.y);y.set(_e,Ee)}m.subVectors(y,b).multiplyScalar(n.panSpeed),S(m.x,m.y),b.copy(y)}function He(re){const be=we(re),_e=re.pageX-be.x,Ee=re.pageY-be.y,U=Math.sqrt(_e*_e+Ee*Ee);G.set(0,U),x.set(0,Math.pow(G.y/f.y,n.zoomSpeed)),R(x.y),f.copy(G)}function ne(re){n.enableZoom&&He(re),n.enablePan&&Ne(re)}function de(re){n.enableZoom&&He(re),n.enableRotate&&he(re)}function Ie(re){n.enabled!==!1&&(B.length===0&&(n.domElement.setPointerCapture(re.pointerId),n.domElement.addEventListener("pointermove",Be),n.domElement.addEventListener("pointerup",Re)),Se(re),re.pointerType==="touch"?X(re):Le(re))}function Be(re){n.enabled!==!1&&(re.pointerType==="touch"?D(re):Qe(re))}function Re(re){Me(re),B.length===0&&(n.domElement.releasePointerCapture(re.pointerId),n.domElement.removeEventListener("pointermove",Be),n.domElement.removeEventListener("pointerup",Re)),n.dispatchEvent(CK),s=r.NONE}function Xe(re){Me(re)}function Le(re){let be;switch(re.button){case 0:be=n.mouseButtons.LEFT;break;case 1:be=n.mouseButtons.MIDDLE;break;case 2:be=n.mouseButtons.RIGHT;break;default:be=-1}switch(be){case Ng.DOLLY:if(n.enableZoom===!1)return;k(re),s=r.DOLLY;break;case Ng.ROTATE:if(re.ctrlKey||re.metaKey||re.shiftKey){if(n.enablePan===!1)return;_(re),s=r.PAN}else{if(n.enableRotate===!1)return;H(re),s=r.ROTATE}break;case Ng.PAN:if(re.ctrlKey||re.metaKey||re.shiftKey){if(n.enableRotate===!1)return;H(re),s=r.ROTATE}else{if(n.enablePan===!1)return;_(re),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(SR)}function Qe(re){if(n.enabled!==!1)switch(s){case r.ROTATE:if(n.enableRotate===!1)return;Z(re);break;case r.DOLLY:if(n.enableZoom===!1)return;T(re);break;case r.PAN:if(n.enablePan===!1)return;F(re);break}}function et(re){n.enabled===!1||n.enableZoom===!1||s!==r.NONE||(re.preventDefault(),n.dispatchEvent(SR),K(re),n.dispatchEvent(CK))}function q(re){n.enabled===!1||n.enablePan===!1||j(re)}function X(re){switch(pe(re),B.length){case 1:switch(n.touches.ONE){case Eg.ROTATE:if(n.enableRotate===!1)return;O(),s=r.TOUCH_ROTATE;break;case Eg.PAN:if(n.enablePan===!1)return;Y(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(n.touches.TWO){case Eg.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ye(),s=r.TOUCH_DOLLY_PAN;break;case Eg.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ce(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(SR)}function D(re){switch(pe(re),s){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;he(re),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;Ne(re),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ne(re),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;de(re),n.update();break;default:s=r.NONE}}function ge(re){n.enabled!==!1&&re.preventDefault()}function Se(re){B.push(re)}function Me(re){delete M[re.pointerId];for(let be=0;be<B.length;be++)if(B[be].pointerId==re.pointerId){B.splice(be,1);return}}function pe(re){let be=M[re.pointerId];be===void 0&&(be=new Ke,M[re.pointerId]=be),be.set(re.pageX,re.pageY)}function we(re){const be=re.pointerId===B[0].pointerId?B[1]:B[0];return M[be.pointerId]}n.domElement.addEventListener("contextmenu",ge),n.domElement.addEventListener("pointerdown",Ie),n.domElement.addEventListener("pointercancel",Xe),n.domElement.addEventListener("wheel",et,{passive:!1}),this.update()}}export{C0e as A,m0e as B,v0e as C,N0e as D,ca as E,y0e as F,S0e as G,R0e as H,PO as I,OI as J,M0e as L,Yy as M,w0e as N,L0e as O,Fa as P,G0e as R,aa as S,B0e as T,Ke as V,jI as a,x0e as b,A0e as c,WU as d,Hj as e,p0e as f,UU as g,b0e as h,g2 as i,$e as j,W0e as k,nl as l,Mc as m,tl as n,kX as o,KC as p,FT as q,ue as r,H0e as s,Wce as t,Z0e as u,Ra as v,F0e as w,E0e as x,V0e as y,_ce as z};
